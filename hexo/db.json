{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"source/images/33/1.png","path":"images/33/1.png","modified":0,"renderable":0},{"_id":"source/images/33/2.png","path":"images/33/2.png","modified":0,"renderable":0},{"_id":"source/images/23/1.png","path":"images/23/1.png","modified":0,"renderable":0},{"_id":"source/images/23/3.png","path":"images/23/3.png","modified":0,"renderable":0},{"_id":"source/images/23/4.png","path":"images/23/4.png","modified":0,"renderable":0},{"_id":"source/images/23/6.png","path":"images/23/6.png","modified":0,"renderable":0},{"_id":"source/images/23/5.png","path":"images/23/5.png","modified":0,"renderable":0},{"_id":"source/images/23/2.png","path":"images/23/2.png","modified":0,"renderable":0},{"_id":"source/images/32/1.png","path":"images/32/1.png","modified":0,"renderable":0},{"_id":"source/images/32/3.png","path":"images/32/3.png","modified":0,"renderable":0},{"_id":"source/images/38/1.png","path":"images/38/1.png","modified":0,"renderable":0},{"_id":"source/images/38/2.png","path":"images/38/2.png","modified":0,"renderable":0},{"_id":"source/images/44/1.png","path":"images/44/1.png","modified":0,"renderable":0},{"_id":"source/images/32/2.png","path":"images/32/2.png","modified":0,"renderable":0},{"_id":"source/images/34/1.png","path":"images/34/1.png","modified":0,"renderable":0},{"_id":"source/images/34/2.png","path":"images/34/2.png","modified":0,"renderable":0},{"_id":"source/images/34/4.png","path":"images/34/4.png","modified":0,"renderable":0},{"_id":"source/images/34/6.png","path":"images/34/6.png","modified":0,"renderable":0},{"_id":"source/images/34/3.png","path":"images/34/3.png","modified":0,"renderable":0},{"_id":"source/images/34/5.png","path":"images/34/5.png","modified":0,"renderable":0},{"_id":"source/images/36/1.png","path":"images/36/1.png","modified":0,"renderable":0},{"_id":"source/images/36/2.png","path":"images/36/2.png","modified":0,"renderable":0},{"_id":"source/images/45/1.png","path":"images/45/1.png","modified":0,"renderable":0},{"_id":"source/images/45/2.png","path":"images/45/2.png","modified":0,"renderable":0},{"_id":"source/images/45/3.png","path":"images/45/3.png","modified":0,"renderable":0},{"_id":"source/images/45/4.png","path":"images/45/4.png","modified":0,"renderable":0},{"_id":"source/images/45/5.png","path":"images/45/5.png","modified":0,"renderable":0},{"_id":"source/images/45/6.png","path":"images/45/6.png","modified":0,"renderable":0},{"_id":"source/images/45/7.png","path":"images/45/7.png","modified":0,"renderable":0},{"_id":"source/images/47/2.png","path":"images/47/2.png","modified":0,"renderable":0},{"_id":"source/images/47/3.png","path":"images/47/3.png","modified":0,"renderable":0},{"_id":"source/images/47/1.png","path":"images/47/1.png","modified":0,"renderable":0},{"_id":"source/images/57/1.png","path":"images/57/1.png","modified":0,"renderable":0},{"_id":"source/images/57/2.png","path":"images/57/2.png","modified":0,"renderable":0},{"_id":"source/images/52/1.png","path":"images/52/1.png","modified":0,"renderable":0},{"_id":"source/images/58/1.png","path":"images/58/1.png","modified":0,"renderable":0},{"_id":"source/images/56/1.png","path":"images/56/1.png","modified":0,"renderable":0},{"_id":"source/images/50/1.png","path":"images/50/1.png","modified":0,"renderable":0},{"_id":"source/images/50/2.png","path":"images/50/2.png","modified":0,"renderable":0},{"_id":"source/images/49/1.png","path":"images/49/1.png","modified":0,"renderable":0},{"_id":"source/images/49/3.png","path":"images/49/3.png","modified":0,"renderable":0},{"_id":"source/images/49/2.png","path":"images/49/2.png","modified":0,"renderable":0},{"_id":"source/images/49/4.png","path":"images/49/4.png","modified":0,"renderable":0},{"_id":"source/images/49/5.png","path":"images/49/5.png","modified":0,"renderable":0},{"_id":"source/images/static/ariana-avatar.png","path":"images/static/ariana-avatar.png","modified":0,"renderable":0},{"_id":"source/images/static/cat-logo.svg","path":"images/static/cat-logo.svg","modified":0,"renderable":0},{"_id":"source/images/51/1.png","path":"images/51/1.png","modified":0,"renderable":0},{"_id":"source/images/51/10.png","path":"images/51/10.png","modified":0,"renderable":0},{"_id":"source/images/51/11.png","path":"images/51/11.png","modified":0,"renderable":0},{"_id":"source/images/51/12.png","path":"images/51/12.png","modified":0,"renderable":0},{"_id":"source/images/51/3.png","path":"images/51/3.png","modified":0,"renderable":0},{"_id":"source/images/51/5.png","path":"images/51/5.png","modified":0,"renderable":0},{"_id":"source/images/51/6.png","path":"images/51/6.png","modified":0,"renderable":0},{"_id":"source/images/51/7.png","path":"images/51/7.png","modified":0,"renderable":0},{"_id":"source/images/51/8.png","path":"images/51/8.png","modified":0,"renderable":0},{"_id":"source/images/51/2.png","path":"images/51/2.png","modified":0,"renderable":0},{"_id":"source/images/51/4.png","path":"images/51/4.png","modified":0,"renderable":0},{"_id":"source/images/51/9.png","path":"images/51/9.png","modified":0,"renderable":0},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/all.min.css","path":"fontawesome/all.min.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/brands.min.css","path":"fontawesome/brands.min.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/duotone.min.css","path":"fontawesome/duotone.min.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/fontawesome.min.css","path":"fontawesome/fontawesome.min.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/light.min.css","path":"fontawesome/light.min.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/sharp-solid.min.css","path":"fontawesome/sharp-solid.min.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/solid.min.css","path":"fontawesome/solid.min.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/regular.min.css","path":"fontawesome/regular.min.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/svg-with-js.min.css","path":"fontawesome/svg-with-js.min.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/thin.min.css","path":"fontawesome/thin.min.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/v4-font-face.min.css","path":"fontawesome/v4-font-face.min.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/v4-shims.min.css","path":"fontawesome/v4-shims.min.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/v5-font-face.min.css","path":"fontawesome/v5-font-face.min.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/tailwind.source.css","path":"css/tailwind.source.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build.js","path":"js/build.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/assets/hbe.style.css","path":"assets/hbe.style.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/assets/odometer-theme-minimal.css","path":"assets/odometer-theme-minimal.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/images/bookmark-placeholder.svg","path":"images/bookmark-placeholder.svg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/images/loading.svg","path":"images/loading.svg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/images/redefine-avatar.svg","path":"images/redefine-avatar.svg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/images/redefine-favicon.svg","path":"images/redefine-favicon.svg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/images/redefine-logo.svg","path":"images/redefine-logo.svg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/images/redefine-og.webp","path":"images/redefine-og.webp","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/images/wallhaven-wqery6-dark.webp","path":"images/wallhaven-wqery6-dark.webp","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/images/wallhaven-wqery6-light.webp","path":"images/wallhaven-wqery6-light.webp","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/images/redefine-logo.webp","path":"images/redefine-logo.webp","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-brands-400.ttf","path":"webfonts/fa-brands-400.ttf","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-brands-400.woff2","path":"webfonts/fa-brands-400.woff2","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-duotone-900.ttf","path":"webfonts/fa-duotone-900.ttf","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-duotone-900.woff2","path":"webfonts/fa-duotone-900.woff2","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-light-300.woff2","path":"webfonts/fa-light-300.woff2","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-light-300.ttf","path":"webfonts/fa-light-300.ttf","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-regular-400.ttf","path":"webfonts/fa-regular-400.ttf","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-sharp-solid-900.ttf","path":"webfonts/fa-sharp-solid-900.ttf","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-sharp-solid-900.woff2","path":"webfonts/fa-sharp-solid-900.woff2","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-solid-900.ttf","path":"webfonts/fa-solid-900.ttf","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-solid-900.woff2","path":"webfonts/fa-solid-900.woff2","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-thin-100.ttf","path":"webfonts/fa-thin-100.ttf","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-regular-400.woff2","path":"webfonts/fa-regular-400.woff2","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-thin-100.woff2","path":"webfonts/fa-thin-100.woff2","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-v4compatibility.ttf","path":"webfonts/fa-v4compatibility.ttf","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-v4compatibility.woff2","path":"webfonts/fa-v4compatibility.woff2","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/build/tailwind.css","path":"css/build/tailwind.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/animated.styl","path":"css/common/animated.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/basic.styl","path":"css/common/basic.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/colors.styl","path":"css/common/colors.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/markdown.styl","path":"css/common/markdown.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/redefine-theme.styl","path":"css/common/redefine-theme.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/theme.styl","path":"css/common/theme.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/variables.styl","path":"css/common/variables.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/main.js","path":"js/build/main.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/main.js.map","path":"js/build/main.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/utils.js","path":"js/build/utils.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/utils.js.map","path":"js/build/utils.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/layouts/bookmarkNav.js","path":"js/layouts/bookmarkNav.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/layouts/categoryList.js","path":"js/layouts/categoryList.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/layouts/essays.js","path":"js/layouts/essays.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/layouts/lazyload.js","path":"js/layouts/lazyload.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/layouts/navbarShrink.js","path":"js/layouts/navbarShrink.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/layouts/toc.js","path":"js/layouts/toc.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/APlayer.min.js","path":"js/libs/APlayer.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/APlayer.min.js.map","path":"js/libs/APlayer.min.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/Swup.min.js","path":"js/libs/Swup.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/Swup.min.js.map","path":"js/libs/Swup.min.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/SwupPreloadPlugin.min.js","path":"js/libs/SwupPreloadPlugin.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/SwupPreloadPlugin.min.js.map","path":"js/libs/SwupPreloadPlugin.min.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/SwupProgressPlugin.min.js","path":"js/libs/SwupProgressPlugin.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/SwupScriptsPlugin.min.js","path":"js/libs/SwupScriptsPlugin.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/SwupScrollPlugin.min.js","path":"js/libs/SwupScrollPlugin.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/SwupScrollPlugin.min.js.map","path":"js/libs/SwupScrollPlugin.min.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/SwupSlideTheme.min.js","path":"js/libs/SwupSlideTheme.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/Typed.min.js","path":"js/libs/Typed.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/anime.min.js","path":"js/libs/anime.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/mermaid.min.js","path":"js/libs/mermaid.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/mermaid.min.js.map","path":"js/libs/mermaid.min.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/minimasonry.min.js","path":"js/libs/minimasonry.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/moment-with-locales.min.js","path":"js/libs/moment-with-locales.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/moment.min.js","path":"js/libs/moment.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/odometer.min.js","path":"js/libs/odometer.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/pangu.min.js","path":"js/libs/pangu.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/pjax.min.js","path":"js/libs/pjax.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/waline.mjs","path":"js/libs/waline.mjs","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/waline.mjs.map","path":"js/libs/waline.mjs.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/plugins/aplayer.js","path":"js/plugins/aplayer.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/plugins/hbe.js","path":"js/plugins/hbe.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/plugins/masonry.js","path":"js/plugins/masonry.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/plugins/mermaid.js","path":"js/plugins/mermaid.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/plugins/pangu.js","path":"js/plugins/pangu.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/plugins/tabs.js","path":"js/plugins/tabs.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/plugins/typed.js","path":"js/plugins/typed.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/tools/codeBlock.js","path":"js/tools/codeBlock.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/tools/imageViewer.js","path":"js/tools/imageViewer.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/tools/lightDarkSwitch.js","path":"js/tools/lightDarkSwitch.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/tools/localSearch.js","path":"js/tools/localSearch.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/tools/runtime.js","path":"js/tools/runtime.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/tools/tocToggle.js","path":"js/tools/tocToggle.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/tools/scrollTopBottom.js","path":"js/tools/scrollTopBottom.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/article-content.styl","path":"css/layout/article-content.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/archive-content.styl","path":"css/layout/archive-content.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/animations.styl","path":"css/layout/animations.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/bookmarks.styl","path":"css/layout/bookmarks.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/category-content.styl","path":"css/layout/category-content.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/category-list.styl","path":"css/layout/category-list.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/home-content.styl","path":"css/layout/home-content.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/home-sidebar.styl","path":"css/layout/home-sidebar.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/page.styl","path":"css/layout/page.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/tag-content.styl","path":"css/layout/tag-content.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fonts/Chillax/Chillax-Variable.eot","path":"fonts/Chillax/Chillax-Variable.eot","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fonts/Chillax/Chillax-Variable.ttf","path":"fonts/Chillax/Chillax-Variable.ttf","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fonts/Chillax/Chillax-Variable.woff2","path":"fonts/Chillax/Chillax-Variable.woff2","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fonts/Chillax/Chillax-Variable.woff","path":"fonts/Chillax/Chillax-Variable.woff","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fonts/Geist/GeistVF.ttf","path":"fonts/Geist/GeistVF.ttf","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fonts/Chillax/chillax.css","path":"fonts/Chillax/chillax.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fonts/Geist/GeistVF.woff","path":"fonts/Geist/GeistVF.woff","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fonts/Geist/GeistVF.woff2","path":"fonts/Geist/GeistVF.woff2","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fonts/Geist/geist.css","path":"fonts/Geist/geist.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fonts/GeistMono/GeistMonoVF.ttf","path":"fonts/GeistMono/GeistMonoVF.ttf","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fonts/GeistMono/GeistMonoVF.woff","path":"fonts/GeistMono/GeistMonoVF.woff","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fonts/GeistMono/GeistMonoVF.woff2","path":"fonts/GeistMono/GeistMonoVF.woff2","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/fonts/GeistMono/geist-mono.css","path":"fonts/GeistMono/geist-mono.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/code-theme.styl","path":"css/common/codeblock/code-theme.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/code-block.styl","path":"css/common/codeblock/code-block.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/highlight.styl","path":"css/common/codeblock/highlight.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/APlayer.min.js","path":"js/build/libs/APlayer.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/Swup.min.js","path":"js/build/libs/Swup.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/SwupPreloadPlugin.min.js","path":"js/build/libs/SwupPreloadPlugin.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/SwupProgressPlugin.min.js","path":"js/build/libs/SwupProgressPlugin.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/SwupScriptsPlugin.min.js","path":"js/build/libs/SwupScriptsPlugin.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/Typed.min.js","path":"js/build/libs/Typed.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/SwupSlideTheme.min.js","path":"js/build/libs/SwupSlideTheme.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/SwupScrollPlugin.min.js","path":"js/build/libs/SwupScrollPlugin.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/anime.min.js","path":"js/build/libs/anime.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/mermaid.min.js","path":"js/build/libs/mermaid.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/odometer.min.js","path":"js/build/libs/odometer.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/moment-with-locales.min.js","path":"js/build/libs/moment-with-locales.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/minimasonry.min.js","path":"js/build/libs/minimasonry.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/pangu.min.js","path":"js/build/libs/pangu.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/aplayer.js.map","path":"js/build/plugins/aplayer.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/pjax.min.js","path":"js/build/libs/pjax.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/moment.min.js","path":"js/build/libs/moment.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/aplayer.js","path":"js/build/plugins/aplayer.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/hbe.js","path":"js/build/plugins/hbe.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/mermaid.js","path":"js/build/plugins/mermaid.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/hbe.js.map","path":"js/build/plugins/hbe.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/masonry.js.map","path":"js/build/plugins/masonry.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/mermaid.js.map","path":"js/build/plugins/mermaid.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/masonry.js","path":"js/build/plugins/masonry.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/tabs.js","path":"js/build/plugins/tabs.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/pangu.js","path":"js/build/plugins/pangu.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/pangu.js.map","path":"js/build/plugins/pangu.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/typed.js","path":"js/build/plugins/typed.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/typed.js.map","path":"js/build/plugins/typed.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/tabs.js.map","path":"js/build/plugins/tabs.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/codeBlock.js","path":"js/build/tools/codeBlock.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/codeBlock.js.map","path":"js/build/tools/codeBlock.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/imageViewer.js","path":"js/build/tools/imageViewer.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/imageViewer.js.map","path":"js/build/tools/imageViewer.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/lightDarkSwitch.js","path":"js/build/tools/lightDarkSwitch.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/lightDarkSwitch.js.map","path":"js/build/tools/lightDarkSwitch.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/localSearch.js","path":"js/build/tools/localSearch.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/localSearch.js.map","path":"js/build/tools/localSearch.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/runtime.js","path":"js/build/tools/runtime.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/scrollTopBottom.js","path":"js/build/tools/scrollTopBottom.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/runtime.js.map","path":"js/build/tools/runtime.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/scrollTopBottom.js.map","path":"js/build/tools/scrollTopBottom.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/bookmarkNav.js","path":"js/build/layouts/bookmarkNav.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/tocToggle.js","path":"js/build/tools/tocToggle.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/tocToggle.js.map","path":"js/build/tools/tocToggle.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/bookmarkNav.js.map","path":"js/build/layouts/bookmarkNav.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/essays.js.map","path":"js/build/layouts/essays.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/lazyload.js","path":"js/build/layouts/lazyload.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/categoryList.js.map","path":"js/build/layouts/categoryList.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/essays.js","path":"js/build/layouts/essays.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/lazyload.js.map","path":"js/build/layouts/lazyload.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/categoryList.js","path":"js/build/layouts/categoryList.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/navbarShrink.js.map","path":"js/build/layouts/navbarShrink.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/navbarShrink.js","path":"js/build/layouts/navbarShrink.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/toc.js.map","path":"js/build/layouts/toc.js.map","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/toc.js","path":"js/build/layouts/toc.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/light/atom-one-light.styl","path":"css/common/codeblock/hljs-themes/light/atom-one-light.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/light/default.styl","path":"css/common/codeblock/hljs-themes/light/default.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/light/github.styl","path":"css/common/codeblock/hljs-themes/light/github.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/dark/a11y-dark.styl","path":"css/common/codeblock/hljs-themes/dark/a11y-dark.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/dark/agate.styl","path":"css/common/codeblock/hljs-themes/dark/agate.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/dark/atom-one-dark.styl","path":"css/common/codeblock/hljs-themes/dark/atom-one-dark.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/dark/github-dark.styl","path":"css/common/codeblock/hljs-themes/dark/github-dark.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/dark/monokai-sublime.styl","path":"css/common/codeblock/hljs-themes/dark/monokai-sublime.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/dark/night-owl.styl","path":"css/common/codeblock/hljs-themes/dark/night-owl.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/dark/nord.styl","path":"css/common/codeblock/hljs-themes/dark/nord.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/dark/tokyo-night-dark.styl","path":"css/common/codeblock/hljs-themes/dark/tokyo-night-dark.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/dark/vs2015.styl","path":"css/common/codeblock/hljs-themes/dark/vs2015.styl","modified":0,"renderable":1}],"Cache":[{"_id":"source/about/index.md","hash":"ba297d64672e5d51bdab18853b9430fc0732edb4","modified":1747709248686},{"_id":"source/categories/index.md","hash":"d5f1317984d7bcf34e852ea406275e8e2d2a91d0","modified":1747709248686},{"_id":"source/_posts/1-vue3应用的创建&使用.md","hash":"8f0e37b480a616c797147746b8e5a16238ffa6e7","modified":1747709248682},{"_id":"source/_posts/10-v-model.md","hash":"64d398fa0d8701728eed7db87582620cb4548ffc","modified":1747709248682},{"_id":"source/_posts/12-vue3侦听器.md","hash":"330c758efb1cbf802f669c32361cb25a5d8684e6","modified":1747709248682},{"_id":"source/_posts/11-vue3生命周期.md","hash":"2f8b19131a83322cfcce80df6844f47b4230637a","modified":1747709248682},{"_id":"source/_posts/13-vue3模板引用.md","hash":"fc28052e809f23269b10e69f4eaad88c44b6949e","modified":1747709248682},{"_id":"source/_posts/14-vue3组件基础.md","hash":"0ee3c9d48f01de675cca59ccce26726c28f36f0f","modified":1747709248682},{"_id":"source/_posts/15-vue3组件注册.md","hash":"aafdceb526a289f66a5ba89bbba1502f9545272a","modified":1747709248682},{"_id":"source/_posts/16-vue3 props & emits.md","hash":"0e5dff37407a3da7168bdb53255b94c8f580a779","modified":1747709248682},{"_id":"source/_posts/17-vue3组件v-model.md","hash":"3be749427a00429fc775ff87dd6d943bc6a8393d","modified":1747709248682},{"_id":"source/_posts/18-vue3继承attributes.md","hash":"fd5b4b8228c8d962fe85930f5e014ac4eb8ff81a","modified":1747709248682},{"_id":"source/_posts/2-vue指令语法.md","hash":"2cf272e068397b1b9bcd2390a98d4f0e079f1ee7","modified":1747709248683},{"_id":"source/_posts/20-vue3依赖注入.md","hash":"27f3e7b2a1c89050af588da665d29dcb67f27833","modified":1747709248683},{"_id":"source/_posts/21-浏览器输入url后发生了什么.md","hash":"47d5b3247f65688b2d6cb32afebb7ce9d7940e65","modified":1747709248683},{"_id":"source/.DS_Store","hash":"ed00ee7236ec1ef529fa5f8ee7a698175cff6764","modified":1748945875083},{"_id":"source/_posts/22-浏览器解析url过程.md","hash":"c47e738ea857b4ca5456c1ed3ba48194f8045837","modified":1747709248683},{"_id":"source/_posts/23-投放链接防重定向.md","hash":"344ec0ce33c9dfe77ab8c4773562311110de64c8","modified":1747709248683},{"_id":"source/_posts/19-vue插槽.md","hash":"8c18891623d151c6b850938fa951a141267da124","modified":1747709248682},{"_id":"source/_posts/28-interface&type.md","hash":"5a3320bbbd55889577f0f083c4baba17da7a9dac","modified":1747709248683},{"_id":"source/_posts/25-DNS.md","hash":"ff0f64939bc876857056b44cd4b293935c23fcb9","modified":1747709248683},{"_id":"source/_posts/31-北大区块链-密码学基础.md","hash":"422b25101f2703e23bc9d8e377a530b07336ab4f","modified":1747709248684},{"_id":"source/_posts/27-三次握手&四次挥手.md","hash":"538e1815b2dccd5995e528c4f8bb04958e7a414d","modified":1747709248683},{"_id":"source/_posts/26-CDN.md","hash":"2a3f21b02f328c54038deca7e492705144870ecd","modified":1747709248683},{"_id":"source/_posts/30-北大区块链-简介.md","hash":"07e869cf33977cebac55230b3a8212b2539db530","modified":1747709248684},{"_id":"source/_posts/24-浏览器缓存与304状态码.md","hash":"cca38196e17239f4ac1ca06fb459037c3734a450","modified":1747709248683},{"_id":"source/_posts/3-vue3响应式.md","hash":"35db681bdd24e81aa4f63de83a13ae2b281e3d48","modified":1747709248683},{"_id":"source/_posts/29-TCP.md","hash":"cc0f4fe8c5c90d3a6f34e2e1ae66a7ff757664b1","modified":1747709248683},{"_id":"source/_posts/32-北大区块链-数据结构.md","hash":"027ea385d8916dcf46ccb0b11a27f8d8df58b864","modified":1747709248684},{"_id":"source/_posts/33-北大区块链-共识协议.md","hash":"f1156a5a11e5745043e393c7963d245eefd4dfb0","modified":1747709248684},{"_id":"source/_posts/34-北大区块链-BTC系统实现.md","hash":"701fe7b70e29fdb7e79b25438db60e20cffc7868","modified":1747709248684},{"_id":"source/_posts/37-北大区块链-BTC挖矿.md","hash":"709f461e6eb312cb73288d1920af9363914155a1","modified":1747709248684},{"_id":"source/_posts/36-北大区块链-挖矿难度.md","hash":"e74d63ee9aa71d6c59d88b5297581661886bfbfc","modified":1747709248684},{"_id":"source/_posts/38-北大区块链-BTC脚本.md","hash":"fa32e3cf3688a14ce98e31cace23c5296fac5bac","modified":1747709248684},{"_id":"source/_posts/35-北大区块链-BTC网络.md","hash":"c25c690e99245673322e5a6e60919811f9bd5193","modified":1747709248684},{"_id":"source/_posts/4-vue3计算属性.md","hash":"2050d4d448ebabebc79c35eb52cfcd6546da4c27","modified":1747709248685},{"_id":"source/_posts/39-北大区块链-BTC分叉.md","hash":"b9637a52b30a9aac2012527013ecd1cb8521c756","modified":1747709248684},{"_id":"source/_posts/40-北大区块链-课堂回答.md","hash":"82290b34526d95b0f8b115c605d050386772c0e9","modified":1747709248685},{"_id":"source/_posts/43-北大区块链-ETH概述.md","hash":"2b6f19fe0f9d9ff3d4c6d07e964db31f37fdf94a","modified":1747709248685},{"_id":"source/_posts/42-北大区块链-BTC引发的思考.md","hash":"22825c65078e5415e5c41c6aa53a8c2aee4e793d","modified":1747709248685},{"_id":"source/_posts/41-北大区块链-BTC匿名性.md","hash":"8bc16de459459e1f474a2900f441d9ff014d3d7b","modified":1747709248685},{"_id":"source/_posts/46-北大区块链-ETH交易树&收据树.md","hash":"c666ab84f9fdbff712cd40353e9eba0b0793bcb4","modified":1747709248685},{"_id":"source/_posts/45-北大区块链-ETH状态树.md","hash":"04a8dd97b300ab9c9274e4835b51e7390fc6998d","modified":1747709248685},{"_id":"source/_posts/48-北大区块链-ETH挖矿算法.md","hash":"eb67e8dce26870f5b1bcb817cc0da1224335bb5f","modified":1747709248685},{"_id":"source/_posts/47-北大区块链-GHOST协议.md","hash":"da97dcd6b11cc972b6e1f65359f1383116a89f6d","modified":1747709248685},{"_id":"source/_posts/49-北大区块链-ETH挖矿难度调整.md","hash":"f195a40bd7495eb606f681dc00295b9bc83f544d","modified":1747709248685},{"_id":"source/_posts/5-为什么vue组件添加scoped后某些组件样式不生效.md","hash":"52a024896ac05704cb22966533189b558060301d","modified":1747709248685},{"_id":"source/_posts/50-北大区块链-POS.md","hash":"297c386b102fdb8a28ac91a2a84a3e8a843b0a30","modified":1747709248685},{"_id":"source/_posts/44-北大区块链-ETH账户.md","hash":"3197a0053c64f6c507cb997690c4785efc05acd6","modified":1747709248685},{"_id":"source/_posts/53-北大区块链-反思.md","hash":"cb050c79515c2786f43cc1b4fd99790d61cc15d1","modified":1747709248686},{"_id":"source/_posts/52-北大区块链-The DAO.md","hash":"a13a8900f311c908830a513c7ab36d115667190e","modified":1747709248686},{"_id":"source/_posts/54-北大区块链-美链.md","hash":"8ac6989a664fff72882b028670ebdde6bff386bd","modified":1747709248686},{"_id":"source/_posts/56-React1.md","hash":"9fbfd3119ae264d89e092b38c6c71905d0d51319","modified":1747715791092},{"_id":"source/_posts/55-北大区块链-课程总结.md","hash":"68070f9f2b7c2ebfa314d25647c6e730cabef228","modified":1747709248686},{"_id":"source/_posts/51-北大区块链-智能合约.md","hash":"dd5838b1b01a065c0140bfe0367c9cf262ffea4c","modified":1747709248686},{"_id":"source/_posts/58-React3.md","hash":"4876501f09f8e9e05f3fb0c225090cff92077ca8","modified":1747715797358},{"_id":"source/_posts/6-vue class与style绑定.md","hash":"6b59bf79340e87a2e796d17775f84f239fa2f2b2","modified":1747709248686},{"_id":"source/_posts/57-React2.md","hash":"7b6be6072a359c23f1869f7cf51a604d82117fbc","modified":1747715794107},{"_id":"source/_posts/64-IB-Rust-所有权.md","hash":"6220c3babf7920eec6c714e20495fc5c7c0ade14","modified":1747902459535},{"_id":"source/_posts/62-IB-Rust-流程控制.md","hash":"ce6fc79a4975bb186178ce3ed63d18b66a3769ce","modified":1747818703006},{"_id":"source/_posts/60-IB-Rust-变量&可变类型.md","hash":"12e054c779860357d593e7a50f7e4f5dc418cb75","modified":1747812710446},{"_id":"source/_posts/59-IB-Rust-环境搭建.md","hash":"5fe9feaeec771ef91131474fbb42597a650e25bf","modified":1747812650725},{"_id":"source/_posts/66-IB-Rust-数组与切片.md","hash":"c3c24b8dd6ae96e52f31eb87f5b957a053870a6b","modified":1747982178193},{"_id":"source/_posts/65-IB-Rust-引用.md","hash":"bac45af13c2c6b0ce48073d8d8d2f010bb1b88f2","modified":1747905741278},{"_id":"source/_posts/7-v-for.md","hash":"c99fc9d5c10fba99b95b7ee661545673a95b4642","modified":1747709248686},{"_id":"source/_posts/8-js事件.md","hash":"ce8b00e9b8e6852500ee920f61907d741f2ccc1b","modified":1747709248686},{"_id":"source/_posts/63-IB-Rust-基础类型.md","hash":"0f15955c1fb75148e3d655e43c6b0d66018e4c6e","modified":1747821405477},{"_id":"source/_posts/9-vue事件处理.md","hash":"89e02d141f34b90c5dde3af3c05652f39b53d21c","modified":1747709248686},{"_id":"source/tags/index.md","hash":"6ff8c6b2f63bf64abb7373b6d325c0a4141b22cb","modified":1747709248744},{"_id":"source/images/23/3.png","hash":"d5a8fcbcd09ae494d6021b71e5c9ff73f52e57dc","modified":1747709248689},{"_id":"source/_posts/61-IB-Rust-函数.md","hash":"b4f79a5562d37bac4d2ef310020830bf5f68a63c","modified":1747812694188},{"_id":"source/images/34/4.png","hash":"0a018dc7b3aa81b9006e050fb8c4c88bc6050cab","modified":1747709248698},{"_id":"source/images/36/1.png","hash":"378577c5cc781fc7d06a81a401466715ff5d1cdd","modified":1747709248699},{"_id":"source/images/34/1.png","hash":"6558eda0d55ecdb9718ec7570d9962c5c140b469","modified":1747709248695},{"_id":"source/images/36/2.png","hash":"42eddac3b10d18c3f2a27378f44960a47584188a","modified":1747709248699},{"_id":"source/images/45/2.png","hash":"93aa987f3c091f7cfa274faca179977d49c8f96b","modified":1747709248704},{"_id":"source/images/34/5.png","hash":"eddd03bf142c0ba9eae0f76afb1eac407ee308b5","modified":1747709248698},{"_id":"source/images/static/cat-logo.svg","hash":"cac182628229ed9b12b976e161d848eb37f5132b","modified":1747732362943},{"_id":"source/images/51/11.png","hash":"6e2ec92684368bfa43740a248db94c7cdb471c20","modified":1747709248727},{"_id":"source/images/33/2.png","hash":"d897d46233e6adde085c48adec42fc069b05db08","modified":1747709248695},{"_id":"source/images/44/1.png","hash":"355f3d84ab2b69d02967ea304ced73b68d8eb741","modified":1747709248703},{"_id":"source/images/45/1.png","hash":"cd690d66d9a3a0b000da031df4b05578d330bd7a","modified":1747709248703},{"_id":"source/images/58/1.png","hash":"f3778b3a22fd1ee1b597301815929c2599716247","modified":1747709248744},{"_id":"source/images/47/1.png","hash":"51ff1033f763bdfe0963fc2223a9d96362b6f2c9","modified":1747709248716},{"_id":"source/images/50/1.png","hash":"758427d15e6b80547e5280ccf986851d3b120bb8","modified":1747709248722},{"_id":"source/images/50/2.png","hash":"3b9bcd30df64c672b7827f85d595c958d9368c67","modified":1747709248723},{"_id":"source/images/51/5.png","hash":"20a759ec1f4b34286d36ec25f5a5ce1fadc21e16","modified":1747709248732},{"_id":"source/images/33/1.png","hash":"3e9421c86aa84f0a9e8c255c0a7254aa6c5254b5","modified":1747709248694},{"_id":"source/images/23/1.png","hash":"ca699ef4b5bd1cb72fe0c5d9be261b9372a18e7c","modified":1747709248688},{"_id":"source/images/32/1.png","hash":"9e55cac15cc8537577aa9987d000918ea930693a","modified":1747709248693},{"_id":"source/images/32/3.png","hash":"5d0982f343fc57342dc3d86454924c1f7e44abea","modified":1747709248694},{"_id":"source/images/38/2.png","hash":"4dff552e46814b86b0c2108d96521acc3dda0ddd","modified":1747709248702},{"_id":"source/images/34/6.png","hash":"6aedb85fcb999821da59c652da300d734dfae27f","modified":1747709248699},{"_id":"source/images/47/3.png","hash":"e9ab45e5ecea7729410dd9ca4ed17a8dd4c6b769","modified":1747709248717},{"_id":"source/images/47/2.png","hash":"5bcfcb48e7e821755f67609c3f1a236704feae1a","modified":1747709248716},{"_id":"source/images/45/7.png","hash":"5fc6eeabfcb9fee47e97f2a2a34d1a5f1a91e1ad","modified":1747709248716},{"_id":"source/images/49/1.png","hash":"ef3f86a77c161d8f8860b55b4225593e115813a5","modified":1747709248718},{"_id":"source/images/49/3.png","hash":"ba9c0f9ee93459d59fe26f1f13f29253df1757e1","modified":1747709248720},{"_id":"source/images/49/2.png","hash":"4af649204e3f104039a89ecc4864515e10248a41","modified":1747709248719},{"_id":"source/images/51/10.png","hash":"7449e5fb03e6cc104cf8d93794ba1118ffff66c8","modified":1747709248727},{"_id":"source/images/51/2.png","hash":"2fe51fb12bd7d1b2ab66a2f988162dc54bab9672","modified":1747709248729},{"_id":"source/images/51/4.png","hash":"ca0ca7d959d09d61cba593f2546986b2ffa3d7ec","modified":1747709248731},{"_id":"source/images/51/9.png","hash":"f4831acc623dd29b512f31e01d86efa01ed12aa0","modified":1747709248737},{"_id":"source/images/23/6.png","hash":"ebcbf194871ceabd233fc8811790afd8b92d2fa9","modified":1747709248692},{"_id":"source/images/23/4.png","hash":"685a4c2939d10cd8dd543535f54252bde9f435a4","modified":1747709248690},{"_id":"source/images/23/5.png","hash":"4cbbcc728a8582ed0e253941395ec454fef9d94b","modified":1747709248691},{"_id":"source/images/32/2.png","hash":"d63706e62822e2195108d055d492c9fc6bc7d2ac","modified":1747709248694},{"_id":"source/images/49/4.png","hash":"ef1a8e81a54dc7bdce101ae3c4d3cdaafb926131","modified":1747709248721},{"_id":"source/images/56/1.png","hash":"e3db518f97c76b8c454c20de5bef453d3c22e8ea","modified":1747709248739},{"_id":"source/images/51/12.png","hash":"e95b3b7b91d661c53a6c4caf95dcb6da9043d7d8","modified":1747709248729},{"_id":"source/images/51/6.png","hash":"7368bacb20a3ebb81a95db598dc8dfd901a887ef","modified":1747709248733},{"_id":"source/images/51/8.png","hash":"5797a082ad522dfcf608e12825d48dfdb10b6c23","modified":1747709248735},{"_id":"source/images/51/3.png","hash":"8246a63a7f595c4e98c402df93c0f007b01e63f7","modified":1747709248730},{"_id":"source/images/51/7.png","hash":"d56c39ed3b1871d66ec37213000b717b63f32ae5","modified":1747709248734},{"_id":"source/images/49/5.png","hash":"ffd70c7278718573a948735b333b4326cb12bf1a","modified":1747709248722},{"_id":"source/images/34/2.png","hash":"cb3b0fe1f0e73f76ce311deb8f8cfbf407e7af9a","modified":1747709248697},{"_id":"source/images/52/1.png","hash":"6af86ed0b8fbb962092c62b8d8888088355c966e","modified":1747709248738},{"_id":"source/images/45/6.png","hash":"932dfc2d48fa759d77be6ef1f5ddcb9af9dd44a7","modified":1747709248715},{"_id":"source/images/57/2.png","hash":"a08b4c3a0ab22697a2889aa3a305912e9a998d54","modified":1747709248743},{"_id":"source/images/static/ariana-avatar.png","hash":"723b9e324155c45b6de43ec390661256e7d1b50e","modified":1747732660000},{"_id":"source/images/23/2.png","hash":"f8eaf927423895525567970f3de77685efdef46e","modified":1747709248689},{"_id":"source/images/34/3.png","hash":"4a206254fa3de2210417c766b60e0f655fe1cf0a","modified":1747709248698},{"_id":"source/images/38/1.png","hash":"4e0686e328314174537a09b58f461f4cb9805f51","modified":1747709248702},{"_id":"node_modules/hexo-theme-redefine/CONTRIBUTING.md","hash":"c6ef834f602b7ae02e2863a2a857e0ce8d392f15","modified":1747712626322},{"_id":"node_modules/hexo-theme-redefine/.coderabbit.yaml","hash":"ba28a5250f22db9a8eb9cd1ee282285eddd848a8","modified":1747712626931},{"_id":"node_modules/hexo-theme-redefine/CODE_OF_CONDUCT.md","hash":"61a6276ef54989b7a1325f3ecb3183a4dfdf50cb","modified":1747712626322},{"_id":"node_modules/hexo-theme-redefine/DONATION.md","hash":"08e105bad07d733efb98543a034f930c569f5c2f","modified":1747712626323},{"_id":"node_modules/hexo-theme-redefine/README.md","hash":"44578ceb782516967dc0de15fbbc1a78c0986aed","modified":1747712626324},{"_id":"node_modules/hexo-theme-redefine/package.json","hash":"1b4d36f90309f4e28b4266ef76f76202d7f38b10","modified":1747712625984},{"_id":"node_modules/hexo-theme-redefine/README_zh-CN.md","hash":"7f7ced9ebf32ab9561ce5bd54445c9622dda6fb1","modified":1747712626323},{"_id":"node_modules/hexo-theme-redefine/README_zh-TW.md","hash":"07acc04ccf38f40b5f6be18529c283ab11bec9c3","modified":1747712626324},{"_id":"node_modules/hexo-theme-redefine/LICENSE","hash":"1de7bacb4fbbd7b6d391a69abfe174c2509ec303","modified":1747712625528},{"_id":"node_modules/hexo-theme-redefine/languages/en.yml","hash":"4cc09fff6895fd864044d7c11f8638ab92d98453","modified":1747712626933},{"_id":"node_modules/hexo-theme-redefine/tailwind.config.js","hash":"63797b8595e3a59c1cdaad7c9268a292fc9c558c","modified":1747712625982},{"_id":"node_modules/hexo-theme-redefine/vercel.json","hash":"357c1fd2678f8ae4a9a852a1a6888c8eca774551","modified":1747712625984},{"_id":"node_modules/hexo-theme-redefine/scripts/config-export.js","hash":"b10185069cd3f3fd7873982e259e402d5f146a58","modified":1747712625646},{"_id":"node_modules/hexo-theme-redefine/_config.yml","hash":"c2721e3cd69d2308a5e46a84394ebbff6a21555e","modified":1747712626931},{"_id":"node_modules/hexo-theme-redefine/scripts/data-handle.js","hash":"c72188b7dd0596d618ecbd3deb1b49ef257014df","modified":1747712625646},{"_id":"node_modules/hexo-theme-redefine/languages/ja.yml","hash":"6da103d89685ddf6da4c367efd699c6fc1a15f84","modified":1747712626933},{"_id":"node_modules/hexo-theme-redefine/languages/fr.yml","hash":"a249af0bd206f10ce78b186b8f0ef6c483ddfcad","modified":1747712626933},{"_id":"node_modules/hexo-theme-redefine/languages/zh-CN.yml","hash":"67d93982759d79f38afadeef871c80b08c21c7ca","modified":1747712626935},{"_id":"node_modules/hexo-theme-redefine/languages/zh-TW.yml","hash":"218fcc4db1d2211bd9839895d7ad6b70a5d50897","modified":1747712626936},{"_id":"node_modules/hexo-theme-redefine/layout/404.ejs","hash":"8456f112fc12bbb1c83cd190d0ce83ee474bd297","modified":1747712625599},{"_id":"node_modules/hexo-theme-redefine/.husky/pre-commit","hash":"843996b47615c2f8c1037db9183de3006166ac1d","modified":1747712625528},{"_id":"node_modules/hexo-theme-redefine/layout/archive.ejs","hash":"8456f112fc12bbb1c83cd190d0ce83ee474bd297","modified":1747712625600},{"_id":"node_modules/hexo-theme-redefine/layout/category.ejs","hash":"8456f112fc12bbb1c83cd190d0ce83ee474bd297","modified":1747712625600},{"_id":"node_modules/hexo-theme-redefine/layout/layout.ejs","hash":"ecf818cd11e363c1a33e7105ac415d8c192c1f73","modified":1747712625601},{"_id":"node_modules/hexo-theme-redefine/layout/index.ejs","hash":"f5fee4e079a9c2c23059ebde4cd89ec723e310c6","modified":1747712625601},{"_id":"node_modules/hexo-theme-redefine/layout/tags.ejs","hash":"8456f112fc12bbb1c83cd190d0ce83ee474bd297","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/layout/tag.ejs","hash":"8456f112fc12bbb1c83cd190d0ce83ee474bd297","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/scripts/filters/delete-mask-handle.js","hash":"088e205976a09c8ee7afec6445847ed4b3aef71f","modified":1747712625646},{"_id":"node_modules/hexo-theme-redefine/scripts/filters/encrypt.js","hash":"bf6b90842991a25af590af76f10d7164ea34abcb","modified":1747712625646},{"_id":"node_modules/hexo-theme-redefine/scripts/filters/link-handle.js","hash":"d168d78034c5fa5a75978f47185b50fd79ba54cf","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/scripts/filters/lazyload-handle.js","hash":"f8ae44311e6463e887c07a41910ebade8766bac2","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/scripts/events/404.js","hash":"169245d7b2af1ff401cf76e718c28b4e38f637c7","modified":1747712625613},{"_id":"node_modules/hexo-theme-redefine/scripts/filters/stylus-handle.js","hash":"8a8bf069ce096bd7b42952c8e50c3c89758cbc13","modified":1747712625980},{"_id":"node_modules/hexo-theme-redefine/scripts/filters/table-handle.js","hash":"c500c45cd9221788df1f31939c5399eabb62ebb5","modified":1747712625982},{"_id":"node_modules/hexo-theme-redefine/scripts/filters/img-handle.js","hash":"b396fe7b6cbc331f2952aa7561f96c1f250d8c52","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/scripts/events/welcome.js","hash":"7b1e16ef62edfc63ab06b390867aad0ede9589fb","modified":1747712625984},{"_id":"node_modules/hexo-theme-redefine/scripts/modules/btn.js","hash":"aa7a34ff5fb0a624163c38fffe0746cef44d2ea3","modified":1747712625645},{"_id":"node_modules/hexo-theme-redefine/scripts/modules/btns.js","hash":"a91492e772287114527a3fbc85f0c7c1c1b15eb3","modified":1747712625645},{"_id":"node_modules/hexo-theme-redefine/scripts/modules/note-large.js","hash":"ed719ca36bcbfbfd86d4ade5825e8adbbecf29fe","modified":1747712625978},{"_id":"node_modules/hexo-theme-redefine/scripts/modules/note.js","hash":"d3a0c043246adc0082387c9e39908c18e953d858","modified":1747712625978},{"_id":"node_modules/hexo-theme-redefine/scripts/helpers/page-helpers.js","hash":"beaeb760eaa92bb63272d21d0d99ab64b78980e8","modified":1747712625979},{"_id":"node_modules/hexo-theme-redefine/scripts/helpers/theme-helpers.js","hash":"0674a7bb30878f7eb6e5711e5ac05542d863082b","modified":1747712625982},{"_id":"node_modules/hexo-theme-redefine/layout/post.ejs","hash":"f5fee4e079a9c2c23059ebde4cd89ec723e310c6","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/layout/page.ejs","hash":"3dc83dae73b48b3e6ae65bdaf6106ec711c88ecd","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/scripts/modules/folding.js","hash":"cfa6646c1350c557430149bd52578c6cac59063b","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/scripts/helpers/recommendation-helpers.js","hash":"b9ede93bfd16af13871625d2d127bf79d99724d1","modified":1747712625980},{"_id":"node_modules/hexo-theme-redefine/scripts/helpers/meta-helpers.js","hash":"5484677eb8064880019642f139e4a29f21cab495","modified":1747712625921},{"_id":"node_modules/hexo-theme-redefine/scripts/helpers/waline-helpers.js","hash":"9f2c3d6c4c7cf6212d28be0729816cd66921bd67","modified":1747712625984},{"_id":"node_modules/hexo-theme-redefine/scripts/modules/tabs.js","hash":"74e3b0cdd009206f7b78b04dcb96eccd86e7a996","modified":1747712625982},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/light.min.css","hash":"18a176eb2486db4e938e568083fa578b641ccc83","modified":1747712625597},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/sharp-solid.min.css","hash":"7d1a13c6b8178b29f5bcb1a639a1998fc9de16c4","modified":1747712625597},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/regular.min.css","hash":"d27c4fed54dacff688010e51f611d950dd6e0aca","modified":1747712625597},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/solid.min.css","hash":"e727feabedb171fb0b398151870d7739ef4e2432","modified":1747712625597},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/v4-font-face.min.css","hash":"0be987628c8b485b39f064da41c90f15c0596c1f","modified":1747712625599},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/svg-with-js.min.css","hash":"f4c08e37c4d44b3ed7a3f377d1cb5d7fca4d04bc","modified":1747712625598},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/v5-font-face.min.css","hash":"260ea7a5e0b89963a5dcf2600a4decdf0f408f3f","modified":1747712625599},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/thin.min.css","hash":"3d46be31379b07ffb24d69c6c915725eaa2e89e9","modified":1747712625599},{"_id":"node_modules/hexo-theme-redefine/source/css/style.styl","hash":"0d78bda29a5b0446074ed724f4f9fe772d4b15cc","modified":1747712626333},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/v4-shims.min.css","hash":"96f037860b8e9b59af8e47571ea98791616dbfd8","modified":1747712625599},{"_id":"node_modules/hexo-theme-redefine/source/css/tailwind.source.css","hash":"1dc3152fe841290f3bd56074f726df975ab91b6e","modified":1747712625599},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/brands.min.css","hash":"5119c35bbd273d2ea2501997827f6d644da93164","modified":1747712625566},{"_id":"node_modules/hexo-theme-redefine/source/assets/odometer-theme-minimal.css","hash":"793c31feb38e241a5ff6ecc5e65e61751507d728","modified":1747712625597},{"_id":"node_modules/hexo-theme-redefine/source/images/bookmark-placeholder.svg","hash":"255a1236bab60d2871da31e4f0db947b44931df6","modified":1747712626335},{"_id":"node_modules/hexo-theme-redefine/source/js/build.js","hash":"61eb4760cefeffa79550f3f7387e701d554a0709","modified":1747712625645},{"_id":"node_modules/hexo-theme-redefine/source/images/loading.svg","hash":"938c2a41c8ba18e37ed659e481696e40a4c8f3a4","modified":1747712626335},{"_id":"node_modules/hexo-theme-redefine/source/images/redefine-avatar.svg","hash":"d0d20061bda08894a82d7691b660be7c6aaa0608","modified":1747712626335},{"_id":"node_modules/hexo-theme-redefine/source/images/redefine-favicon.svg","hash":"420f930a1df64a3c4391ff80326a8a2d7d5a6418","modified":1747712626335},{"_id":"node_modules/hexo-theme-redefine/source/js/main.js","hash":"cee5f0dcb5b1f0f7f952e24d31cce2bd785b29cc","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/source/js/utils.js","hash":"5efa4c652a1e7f4852fb8df9bf60de170b4b41db","modified":1747712625984},{"_id":"node_modules/hexo-theme-redefine/source/images/redefine-og.webp","hash":"44fb793383da185808ed682d7dd916e10eb65b4d","modified":1747712626658},{"_id":"node_modules/hexo-theme-redefine/source/assets/hbe.style.css","hash":"29be8fc47be885e9954e310cbc68dfadd3b4cee6","modified":1747712625596},{"_id":"node_modules/hexo-theme-redefine/source/images/redefine-logo.svg","hash":"472776b6f013aad44706fee6c94201c96ee83932","modified":1747712626335},{"_id":"node_modules/hexo-theme-redefine/source/images/wallhaven-wqery6-light.webp","hash":"d25389973d0359b78f1e9c74a850ef425690ba40","modified":1747712626671},{"_id":"node_modules/hexo-theme-redefine/source/images/redefine-logo.webp","hash":"0a07e3fb6d9125dee44798c8c110187b16fb42a9","modified":1747712626654},{"_id":"node_modules/hexo-theme-redefine/source/images/wallhaven-wqery6-dark.webp","hash":"d0066e0b025ae748448a3d6a96165d45a55d2f22","modified":1747712626660},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-v4compatibility.ttf","hash":"b54531dd09c5089eb93b12ce8f90ff521855ff8a","modified":1747712626643},{"_id":"node_modules/hexo-theme-redefine/.github/ISSUE_TEMPLATE/bug-chinese.yml","hash":"73df1f0aabb527a9e3c131d0f0eda0db8b7a1f3b","modified":1747712626932},{"_id":"node_modules/hexo-theme-redefine/.github/ISSUE_TEMPLATE/bug-english.yml","hash":"bf91936a78a2e444dbaf916755f502cc0abe7be3","modified":1747712626932},{"_id":"node_modules/hexo-theme-redefine/.github/ISSUE_TEMPLATE/enhancement-chinese.yml","hash":"1ea9f2b52f53e5d1525bb22709bcf37da5a6da01","modified":1747712626933},{"_id":"node_modules/hexo-theme-redefine/.github/ISSUE_TEMPLATE/enhancement-english.yml","hash":"d072e75c10673fb70be74f89dff8b1bae6df0c8f","modified":1747712626933},{"_id":"node_modules/hexo-theme-redefine/.github/workflows/aliyun-cdn-publish.yml","hash":"18975c5422509b0fb7c3b6ddd788eac65802781a","modified":1747712626932},{"_id":"node_modules/hexo-theme-redefine/.github/workflows/build-and-commit.yml","hash":"6cb6834cd753e38dadb25c6492347ddd247935ea","modified":1747712626932},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-v4compatibility.woff2","hash":"d02b1adc81fd5bec023e25a7770779b99d6dd742","modified":1747712626919},{"_id":"node_modules/hexo-theme-redefine/.github/workflows/npm-publish.yml","hash":"3379098cb32de9ee4f6e69eb91505a4d3a2f37e6","modified":1747712626933},{"_id":"node_modules/hexo-theme-redefine/layout/components/scripts.ejs","hash":"373cbbf8fe0a39fc3de14579e0b3ae20cb429998","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/layout/utils/image-viewer.ejs","hash":"2f31d56e7ed88dadeacffa5af69931461f4fb4f9","modified":1747712625601},{"_id":"node_modules/hexo-theme-redefine/layout/pages/page-template.ejs","hash":"75a41b963a4ed3fcae846163bc674d8d185a27a9","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/layout/components/swup.ejs","hash":"ac0263cdb945ad99876a246db43801213b45b309","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/layout/utils/local-search.ejs","hash":"06ad51a60648100fcf8a750c471a48bd1c9b31b8","modified":1747712625601},{"_id":"node_modules/hexo-theme-redefine/layout/utils/posts-list.ejs","hash":"80dd9ff9b135b582c32c5506d237db71fa742be5","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/layout/utils/side-tools.ejs","hash":"c915643e05f1038549e353a371d72f5bb38c2040","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/layout/utils/paginator.ejs","hash":"cb0a8fca60575195f65510c1a52a7145c819de14","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/scripts/filters/lib/hbe.default.js","hash":"fee2c92011ef007121b992193bbab0f3b196d873","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/.github/workflows/stale-issues.yml","hash":"4ae03f0bd4aaf5ccaa08205af07218d406e921da","modified":1747712626935},{"_id":"node_modules/hexo-theme-redefine/source/css/common/colors.styl","hash":"e4a5336757de7b04c01d8c2a2b4bb1de885c6ae0","modified":1747712626331},{"_id":"node_modules/hexo-theme-redefine/source/css/common/animated.styl","hash":"1d5a026f3a023031772fdca7d7359bbe7a28548a","modified":1747712626329},{"_id":"node_modules/hexo-theme-redefine/source/css/common/basic.styl","hash":"81bab41a756832a86a6c06df1ea298e4849435f9","modified":1747712626330},{"_id":"node_modules/hexo-theme-redefine/source/css/common/redefine-theme.styl","hash":"068b95881387ee2b70ba94a6489ee21171f26bf3","modified":1747712626333},{"_id":"node_modules/hexo-theme-redefine/source/css/common/variables.styl","hash":"961f936e6d08372bdc1e9379e7d1288410e4a319","modified":1747712626334},{"_id":"node_modules/hexo-theme-redefine/.github/workflows/production-deployment.yml","hash":"d411d426c6df79ac7e487401f0f11206c245d1c1","modified":1747712626934},{"_id":"node_modules/hexo-theme-redefine/.github/workflows/preview-deployment.yml","hash":"7fa8860dd2ba4ffc11fbfa1a7d57140af2a0abf0","modified":1747712626933},{"_id":"node_modules/hexo-theme-redefine/source/js/build/main.js.map","hash":"b089351e96e8f99395ac9b44aea257364a475dca","modified":1747712625987},{"_id":"node_modules/hexo-theme-redefine/source/js/build/main.js","hash":"2fcd1ce192bb34997c2e962d9c98a389573969ac","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/source/css/common/theme.styl","hash":"0c5eedb57874c91babdb603b1daef35d70a7c150","modified":1747712626333},{"_id":"node_modules/hexo-theme-redefine/source/js/build/utils.js","hash":"5a3707671ffb8544ef6e90c3713c4da785f06488","modified":1747712625983},{"_id":"node_modules/hexo-theme-redefine/source/css/build/tailwind.css","hash":"298ca1975af73e8101d77491566de03543a56a65","modified":1747712625599},{"_id":"node_modules/hexo-theme-redefine/source/css/common/markdown.styl","hash":"b356d00c6c6557cf7708a02080b163dc0b667184","modified":1747712626332},{"_id":"node_modules/hexo-theme-redefine/source/js/build/utils.js.map","hash":"d9a1eed23a96de49c30ebccb52620e24204ea10e","modified":1747712626294},{"_id":"node_modules/hexo-theme-redefine/source/js/layouts/categoryList.js","hash":"eb1af2cd0726f56ff7861222ea543315fe295a17","modified":1747712625646},{"_id":"node_modules/hexo-theme-redefine/source/js/layouts/bookmarkNav.js","hash":"3155ed3e6e2aa2e32dbd9e4e06b863e63c2a9b9d","modified":1747712625644},{"_id":"node_modules/hexo-theme-redefine/source/js/layouts/lazyload.js","hash":"c06323d68bbdebbb685db5010e7655b8ed0caf42","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/source/js/layouts/essays.js","hash":"df82365c7287710dd876e452f8ef4e1d87b8c09e","modified":1747712625646},{"_id":"node_modules/hexo-theme-redefine/source/js/layouts/navbarShrink.js","hash":"3e80bf9ef719b2ddb2d1c4b67eb169d2ef52dbb8","modified":1747712625978},{"_id":"node_modules/hexo-theme-redefine/source/js/layouts/toc.js","hash":"7a768982f6cb1f40552cce063d5743fe862db762","modified":1747712625982},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/APlayer.min.js","hash":"22caa28ff6b41a16ff40f15d38f1739e22359478","modified":1747712625643},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/Swup.min.js","hash":"cc054d34e74a1feecfae75064f6a4d6107607396","modified":1747712625981},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/SwupPreloadPlugin.min.js","hash":"d911512891ecbe1935203bcd3d93427ad75e45c8","modified":1747712625981},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/SwupProgressPlugin.min.js","hash":"fd30fe1c43072017f67bbaac18b962a5ac218711","modified":1747712625981},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/SwupScriptsPlugin.min.js","hash":"b17f3434035f1339d6f9cd5c8a055d2a1b6602e9","modified":1747712625982},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/SwupSlideTheme.min.js","hash":"e9d143780e879d958164b1356b7f918ec25e838a","modified":1747712625982},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/Typed.min.js","hash":"e8ce2b674a637b0c0396a3106c1aedf10186249c","modified":1747712625983},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/SwupScrollPlugin.min.js","hash":"6c3afca9bb98f79d14516c093f27e3e50a3fd82e","modified":1747712625982},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/SwupPreloadPlugin.min.js.map","hash":"40513fec1323b601667876a97a9ef8a0c88bff63","modified":1747712626292},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/SwupScrollPlugin.min.js.map","hash":"63cf04ba556b256379e103ef7d3ba12d629449a4","modified":1747712626293},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/minimasonry.min.js","hash":"9681cc509cb8aa733d36aad032e6e8acdb33c08c","modified":1747712625921},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/odometer.min.js","hash":"fe5beb60997c84ab2f91b54535c4221443cdd21f","modified":1747712625978},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/moment.min.js","hash":"20bd76acf8e950e5cf7243f60e1192705dacca7d","modified":1747712625978},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/pjax.min.js","hash":"3d796e5be9cdd4067c94e190ea2482d7fdb4856c","modified":1747712625979},{"_id":"node_modules/hexo-theme-redefine/source/js/plugins/aplayer.js","hash":"f2818445cfbdbf936f136c3d0f983583c581d77e","modified":1747712625620},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/pangu.min.js","hash":"ebc25ecdbf464407c5886f024d13f1f6da51ec85","modified":1747712625979},{"_id":"node_modules/hexo-theme-redefine/source/js/plugins/pangu.js","hash":"25af6a33c9176a00f21f45cf5cfad0eb7d473841","modified":1747712625979},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/anime.min.js","hash":"47cb482a8a488620a793d50ba8f6752324b46af3","modified":1747712625620},{"_id":"node_modules/hexo-theme-redefine/source/js/plugins/mermaid.js","hash":"303254d382869ed618025fcb328426bd10314583","modified":1747712625648},{"_id":"node_modules/hexo-theme-redefine/source/js/plugins/masonry.js","hash":"92734a30a21f8b16f20aa75208f6c082890275fb","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/source/js/plugins/tabs.js","hash":"964ec5c25a8d78763ba2ba9bfbd5b1b49ed05381","modified":1747712625982},{"_id":"node_modules/hexo-theme-redefine/source/js/plugins/hbe.js","hash":"f7bd9258359dc8f70c6faec3f4fe22a1852d9bf1","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/source/js/tools/codeBlock.js","hash":"344e6c83e6ffda22f6e5bc724d603066b49a7d8b","modified":1747712625646},{"_id":"node_modules/hexo-theme-redefine/source/js/plugins/typed.js","hash":"f46f636a32e7569a9ff8b8b301bf860e598bd4fe","modified":1747712625983},{"_id":"node_modules/hexo-theme-redefine/source/js/tools/runtime.js","hash":"eb0374b6f033f7ac25f49b1b079aa163e14b0fcd","modified":1747712625980},{"_id":"node_modules/hexo-theme-redefine/source/js/tools/tocToggle.js","hash":"c2224ff0370fcf109e94194613b9480a3913c82d","modified":1747712625983},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/archive-content.styl","hash":"4e329547447c716c986e0b4a4f54afc59fc6b486","modified":1747712626330},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/animations.styl","hash":"2c48fec80bd56164bff297727d06ab5c343b3b41","modified":1747712626330},{"_id":"node_modules/hexo-theme-redefine/source/js/tools/imageViewer.js","hash":"33c4e4a28cf66be0cb3f181acae082a5a5404a89","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/source/js/tools/lightDarkSwitch.js","hash":"97b7e68f871dc218fceca77b85ac051c7c6306af","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/category-content.styl","hash":"1221a4e0fa2ab5c49e886e0a5bb6dc1d23d969e8","modified":1747712626331},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/category-list.styl","hash":"aaccab4fb21e25086323e7e418e7fea945f551be","modified":1747712626331},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/page.styl","hash":"ffc2622357f1556a95fc8f138b7e8ac27b0bba2c","modified":1747712626333},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/home-sidebar.styl","hash":"daad28f2c004f7afe335080d67e977660829d63e","modified":1747712626332},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/article-content.styl","hash":"94771695782abe5e723918a1319a953fbd2031e0","modified":1747712626330},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/home-content.styl","hash":"65a5184a667966f5c5387662de77da512faa4e0e","modified":1747712626332},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/tag-content.styl","hash":"3d08edcfbd866627f5681c368d5c61270ba2f682","modified":1747712626334},{"_id":"node_modules/hexo-theme-redefine/source/js/tools/localSearch.js","hash":"f6e59f65c676457198c2cf5d78bd06052499ee38","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/source/js/tools/scrollTopBottom.js","hash":"9e54fa4310bb98ea5ba61780a9ef56d05d475203","modified":1747712625980},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/bookmarks.styl","hash":"a89f96f73d9f1d51e455b53bbcf13d003d672d33","modified":1747712626330},{"_id":"node_modules/hexo-theme-redefine/source/fonts/Chillax/Chillax-Variable.woff2","hash":"fc5d99b40db9deca7d151f9bd16b96ff160828b7","modified":1747712626692},{"_id":"node_modules/hexo-theme-redefine/source/fonts/Chillax/Chillax-Variable.woff","hash":"fc0e791429c274c4c9312d810e7ae9503cab34ab","modified":1747712626673},{"_id":"node_modules/hexo-theme-redefine/source/fonts/Chillax/chillax.css","hash":"210179f53c6bce91a12ca6db9129184cc1549c36","modified":1747712625567},{"_id":"node_modules/hexo-theme-redefine/source/fonts/Geist/GeistVF.woff2","hash":"772998a8569a6caa04927d876fbe9e0fb859658b","modified":1747712626931},{"_id":"node_modules/hexo-theme-redefine/source/fonts/Geist/geist.css","hash":"17f37a09d6192f06b2190f8319114238b0a2ec8c","modified":1747712625596},{"_id":"node_modules/hexo-theme-redefine/source/fonts/GeistMono/geist-mono.css","hash":"b89d5af7e04df579c8ad62c0ea445ff7d16eec11","modified":1747712625596},{"_id":"node_modules/hexo-theme-redefine/layout/components/header/head.ejs","hash":"1287e5913f72f6624ff375dc51c939823c55d4da","modified":1747712625601},{"_id":"node_modules/hexo-theme-redefine/layout/components/header/navbar.ejs","hash":"e520f72c4d5116bd0f4c65f3efe617e0a494e2fb","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/source/fonts/GeistMono/GeistMonoVF.woff2","hash":"11e9a061ce255fc4cc45ac3eeb8cab09a49f5ccc","modified":1747712626925},{"_id":"node_modules/hexo-theme-redefine/layout/components/header/progress-bar.ejs","hash":"e552f0f5e6ab6398ab42eef1788f7c0dcb8f4c18","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/layout/components/header/preloader.ejs","hash":"a450ba1381dd43d348a3f538bb17ffbd1d332cad","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/layout/components/comments/comment.ejs","hash":"98c2db06626a82f24886cd8b77118014ef8aa6e2","modified":1747712625600},{"_id":"node_modules/hexo-theme-redefine/layout/components/comments/giscus.ejs","hash":"afa08ddc80ae3f1c57d9b85d2625f11751801540","modified":1747712625601},{"_id":"node_modules/hexo-theme-redefine/layout/components/footer/footer.ejs","hash":"acb56ecba5c231f5c8c6701de6d54e3d654948a2","modified":1747712625600},{"_id":"node_modules/hexo-theme-redefine/layout/components/comments/waline.ejs","hash":"35239e49743c6b7f40014bd753bff9c415b5fcbb","modified":1747712625603},{"_id":"node_modules/hexo-theme-redefine/layout/components/comments/twikoo.ejs","hash":"49d230c1a732e0f3504a57dfd169738156ed22ba","modified":1747712625603},{"_id":"node_modules/hexo-theme-redefine/layout/components/comments/gitalk.ejs","hash":"f94607c4bb12f5c2325e674e25a428dae742e99e","modified":1747712625601},{"_id":"node_modules/hexo-theme-redefine/layout/pages/category/category-detail.ejs","hash":"ee99263b6761e9865b06d427597435e69b40dda9","modified":1747712625600},{"_id":"node_modules/hexo-theme-redefine/layout/pages/category/categories.ejs","hash":"fe6e11590c28cc8462a04580868aa6b8b472a9d1","modified":1747712625600},{"_id":"node_modules/hexo-theme-redefine/layout/components/plugins/aplayer.ejs","hash":"2d34a3583ac0b2b08b6ae035e8d3f97c51db070c","modified":1747712625600},{"_id":"node_modules/hexo-theme-redefine/layout/components/sidebar/author.ejs","hash":"422aed0f3f67529c1ea87ee43f8f680ffc531b45","modified":1747712625600},{"_id":"node_modules/hexo-theme-redefine/layout/components/sidebar/statistics.ejs","hash":"4329363d232de541e1cb8f24eb59c1a8bacc9b9c","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/layout/pages/archive/archive.ejs","hash":"11fb21fe971157a1a6053ecbd6de9ffbe8ba88a8","modified":1747712625600},{"_id":"node_modules/hexo-theme-redefine/layout/components/sidebar/avatar.ejs","hash":"47cd8318471493c82f5e5983550145d4fd0a2ddc","modified":1747712625600},{"_id":"node_modules/hexo-theme-redefine/layout/pages/bookmarks/bookmarks.ejs","hash":"38ab41cfe2d31ee145af229b3b65ac8743821e0d","modified":1747712625600},{"_id":"node_modules/hexo-theme-redefine/layout/pages/notfound/notfound.ejs","hash":"5e90d8519d19a31234de10a33983b8d70aed94a2","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/layout/pages/friends/friends-link.ejs","hash":"c4a8555880ab546a9bc829386c4fc2b43cdcece2","modified":1747712625601},{"_id":"node_modules/hexo-theme-redefine/layout/pages/home/home-article.ejs","hash":"b54a0df26341fa5f26a6e1eedb91cd11014d50c5","modified":1747712625601},{"_id":"node_modules/hexo-theme-redefine/layout/pages/home/home-background.ejs","hash":"dd120259ab091b8087d0194ea2291676556efad8","modified":1747712625601},{"_id":"node_modules/hexo-theme-redefine/layout/pages/home/home-sidebar.ejs","hash":"8df645c6e1878187909d749639ecce6edc0ee72c","modified":1747712625601},{"_id":"node_modules/hexo-theme-redefine/layout/pages/home/home-content.ejs","hash":"6985ec3528866f90ce882564556c30c151050061","modified":1747712625601},{"_id":"node_modules/hexo-theme-redefine/layout/pages/home/home-banner.ejs","hash":"0e0a29a652e5063d89bee3037c3410865f6852a7","modified":1747712625601},{"_id":"node_modules/hexo-theme-redefine/layout/pages/post/toc.ejs","hash":"c3bd7f4632ded1b59a2479028070fa2b292d8c5e","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/layout/pages/post/article-info.ejs","hash":"f42db25cc0f4e3bbce5b8602365025dd37d643d0","modified":1747712625600},{"_id":"node_modules/hexo-theme-redefine/layout/pages/masonry/masonry.ejs","hash":"c45f6faf5ccd4db3bd5533eacb6333744a480e27","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/layout/pages/post/article-content.ejs","hash":"8b0b987406057f2eb2ade99f6d68ef5577e14a79","modified":1747712625600},{"_id":"node_modules/hexo-theme-redefine/layout/pages/post/post-tools.ejs","hash":"5336e36394250d2f25d26432262061c752b1868a","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/layout/pages/post/article-copyright.ejs","hash":"8e97d76ded33d1e334c376451e2f3d5fd177a958","modified":1747712625600},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/code-theme.styl","hash":"79d13151f771a7a967fbf18eab955354466335a8","modified":1747712626331},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/code-block.styl","hash":"e6a793c6b2c54549db8226fcb13ee3c4b3a1c45d","modified":1747712626331},{"_id":"node_modules/hexo-theme-redefine/layout/pages/tag/tag-detail.ejs","hash":"8864356337a301a123e85fb3aec6f3d9b1f2197c","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/layout/pages/tag/tags.ejs","hash":"ff59878833eb2a72fda7c78690a36a9c0c522c76","modified":1747712625602},{"_id":"node_modules/hexo-theme-redefine/layout/pages/shuoshuo/essays.ejs","hash":"7d9e7de29e1dab92c333affd5c592e2ee2e92293","modified":1747712625600},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/highlight.styl","hash":"35cfa277f1f2ea3c3876e50ac56c7401e1b8a4c7","modified":1747712626332},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/APlayer.min.js","hash":"22caa28ff6b41a16ff40f15d38f1739e22359478","modified":1747712625621},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/SwupPreloadPlugin.min.js","hash":"d911512891ecbe1935203bcd3d93427ad75e45c8","modified":1747712625981},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/SwupProgressPlugin.min.js","hash":"fd30fe1c43072017f67bbaac18b962a5ac218711","modified":1747712625981},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/SwupSlideTheme.min.js","hash":"e9d143780e879d958164b1356b7f918ec25e838a","modified":1747712625982},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/SwupScriptsPlugin.min.js","hash":"b17f3434035f1339d6f9cd5c8a055d2a1b6602e9","modified":1747712625981},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/Swup.min.js","hash":"cc054d34e74a1feecfae75064f6a4d6107607396","modified":1747712625980},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/Typed.min.js","hash":"e8ce2b674a637b0c0396a3106c1aedf10186249c","modified":1747712625983},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/SwupScrollPlugin.min.js","hash":"6c3afca9bb98f79d14516c093f27e3e50a3fd82e","modified":1747712625982},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/odometer.min.js","hash":"fe5beb60997c84ab2f91b54535c4221443cdd21f","modified":1747712625978},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/minimasonry.min.js","hash":"9681cc509cb8aa733d36aad032e6e8acdb33c08c","modified":1747712625921},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/aplayer.js.map","hash":"daefe65fb99e2f7699f3fd25ec90b7f38469da5d","modified":1747712625984},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/anime.min.js","hash":"47cb482a8a488620a793d50ba8f6752324b46af3","modified":1747712625618},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/pangu.min.js","hash":"ebc25ecdbf464407c5886f024d13f1f6da51ec85","modified":1747712625979},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/hbe.js","hash":"383a946a2be735bc30c0bb331bbee335fe5b6942","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/aplayer.js","hash":"bef8536cb25306f78f80c1744c07544a46dac970","modified":1747712625620},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/pjax.min.js","hash":"3d796e5be9cdd4067c94e190ea2482d7fdb4856c","modified":1747712625979},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/mermaid.js","hash":"2deee4201b637c54c1be0e1b686a97050fb37cce","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/moment.min.js","hash":"20bd76acf8e950e5cf7243f60e1192705dacca7d","modified":1747712625969},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/hbe.js.map","hash":"53deed7e9b802b964ff90d3303f957238f2b1421","modified":1747712625987},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/masonry.js.map","hash":"b2d93754a64f84ef67528d320de69561fc763525","modified":1747712625987},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/mermaid.js.map","hash":"5a8b4e15316517af607d3c12cf4a6e3447cfec22","modified":1747712625987},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/pangu.js","hash":"e96959eb39ca702242aca08c75f2230aa1bda7e4","modified":1747712625979},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/masonry.js","hash":"b5b44a6d4b74beea1938334b3558bd3d1caec07a","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/tabs.js","hash":"b14b70e316e3151d591f03cbaf3c70c11ae5aad5","modified":1747712625982},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/codeBlock.js.map","hash":"fe609e1f8c1d028eca5e131b6a98cd71547be39c","modified":1747712625986},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/typed.js.map","hash":"4840c94f7639cee4615916ce2cabd172a565a71c","modified":1747712626293},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/tabs.js.map","hash":"218abee3893ecdee6f6c633b9fd13520a4eefabf","modified":1747712626293},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/pangu.js.map","hash":"27d5318b81541274c3026e4892ee43ba2c410951","modified":1747712626287},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/codeBlock.js","hash":"8aa8e62cdc3891c9c608c1f52866aeab8cef0457","modified":1747712625646},{"_id":"node_modules/hexo-theme-redefine/source/js/build/plugins/typed.js","hash":"d8999de0b92fe1e1c9061040d6e95a9b607caa23","modified":1747712625983},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/lightDarkSwitch.js.map","hash":"0fd195af186727b3b6f8a7d29035f35f7375e5a1","modified":1747712625987},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/localSearch.js","hash":"4ddb3808f9216b848a14e66c813ae883d0f883b1","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/imageViewer.js","hash":"310f06d38245235e1a65a5a7f1a6f673647faa6f","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/imageViewer.js.map","hash":"6bf89edc74bc48b0e6f616d1ac0b0bb52df09353","modified":1747712625987},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/runtime.js","hash":"99d9fbc2022a12dd7f9bab4f88384f563f3f51e8","modified":1747712625980},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/lightDarkSwitch.js","hash":"dee772cad8a9ab42d54b6ea99599534524c47f18","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/runtime.js.map","hash":"43ed778e985cbf71e7d62c5960da98a431ad43e3","modified":1747712626287},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/scrollTopBottom.js.map","hash":"76a041bbbd0d49426322c4fc1ee05bf327ffb7bd","modified":1747712626287},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/bookmarkNav.js","hash":"a92d80fb49180a2700e069451c3ee9fde3f7cde0","modified":1747712625644},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/localSearch.js.map","hash":"86630e1b406ad10fe0450ccc49fbf07154fab9e5","modified":1747712625987},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/tocToggle.js","hash":"978bc1a31f8026ac9522198bca3c892ebf3551bc","modified":1747712625982},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/scrollTopBottom.js","hash":"037720022f64622f244682c176c5f0ab8f1efb54","modified":1747712625980},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/essays.js.map","hash":"60c58a3fc229cd497ad782e6f2b642e6be600e4c","modified":1747712625987},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/lazyload.js","hash":"eacb006bd852a3c9881438b75d45e72d87914ad7","modified":1747712625647},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/essays.js","hash":"fbd5599508c60dc20fa90a9f37db27770e3773d5","modified":1747712625646},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/lazyload.js.map","hash":"d365d984dfa37411397b36c69e24e4d5d0b32bee","modified":1747712625987},{"_id":"node_modules/hexo-theme-redefine/source/js/build/tools/tocToggle.js.map","hash":"6fd262220a32c784f194d21c7e514f21122bde2f","modified":1747712626293},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/categoryList.js.map","hash":"fb9f8f83a1d0510eaa510fe58891de555d4839a8","modified":1747712625986},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/categoryList.js","hash":"cd8e7825b6dce79cac97e6047f9a80f0fb893213","modified":1747712625646},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/bookmarkNav.js.map","hash":"ba215231cccf6495570205bf974a83142592a22b","modified":1747712625986},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/navbarShrink.js.map","hash":"275dbb4ded89c2d2d805edbbf678475139bcc442","modified":1747712626287},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_modules/notes.styl","hash":"37b2a4a0669414c74498ed0ecae873c90b15fe6e","modified":1747712626333},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_modules/aplayer.styl","hash":"5d9b58f0d5226ef2a2a67502577539115ae29942","modified":1747712626330},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/toc.js","hash":"892929c5bb2293804f4c5f911dd901969f08ef67","modified":1747712625982},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_modules/folding.styl","hash":"b5e5c2407eb83ae4b3ee4ed73490dcd41edef705","modified":1747712626331},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_modules/tabs.styl","hash":"fb5f2f223f7d4ed86d3693fdc0977362f456212e","modified":1747712626333},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/archive-list.styl","hash":"d57516e1723b807d38cb7955a9a1422dd03ac820","modified":1747712626330},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_modules/buttons.styl","hash":"32be9cf72f19b588b6e0db6b6e23146293b64268","modified":1747712626330},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/404.styl","hash":"16215f6fe664d1ddc5744a626405bc774dc30f70","modified":1747712626329},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/article-copyright-info.styl","hash":"12fad2f674e8a7ad009cabecf4e98b65d5ed8b1e","modified":1747712626330},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/article-meta-info.styl","hash":"141ae2639ac760ced89887cce139adbc76c18cea","modified":1747712626330},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/footer.styl","hash":"0dc8796e312215e45e1daf566a495c00480b68e3","modified":1747712626331},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/home-banner.styl","hash":"9f0fb6bd26e73bf07c556a3c1f552997234cb81c","modified":1747712626332},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/navbarShrink.js","hash":"181c0c7e45f0c3a099d272b7c531559cd0d4fdbf","modified":1747712625978},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/image-viewer.styl","hash":"6c8eeb7a96cae110cd9a684a3a5076148b8154d8","modified":1747712626332},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/local-search.styl","hash":"45e7580258bc2d85cc12313abcc24cba9e531e00","modified":1747712626332},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/page-template.styl","hash":"e2e1826427e1fc5f88d4c31ddd508818a0b0d87d","modified":1747712626333},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/post-tools.styl","hash":"d602c2fe191d2c639f7cd8c4d0ee618f8c80f5c1","modified":1747712626333},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/progress-bar.styl","hash":"d3715280d9b62d89ccd1b79ab5e5f030669f4d88","modified":1747712626333},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/paginator.styl","hash":"53421b731f3d7ed34a3a4c87405e06ae3d6519e0","modified":1747712626333},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/toc.styl","hash":"13949981a5afa2b0483da1836af5999d992961f9","modified":1747712626334},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/tagcloud.styl","hash":"cb12c8ef44b5e597eb971d3341919fe9569da709","modified":1747712626333},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/side-tools.styl","hash":"995982b8c228f7386d352042f64587d06663716e","modified":1747712626333},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/comments/comment.styl","hash":"71529ec72f356c78f75a752e5400c1197aa5ea96","modified":1747712626331},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/navbar.styl","hash":"b95efbade2b4cfd8000fd8238bdbd3de522b319e","modified":1747712626333},{"_id":"node_modules/hexo-theme-redefine/source/js/build/layouts/toc.js.map","hash":"9a413e8dbc2ff2a6fc21eb2899e59d5af75942a3","modified":1747712626293},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/light/default.styl","hash":"c2b8d16ba4dffdd3bae4db4f817bc18cdd7c1d60","modified":1747712626331},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/comments/gitalk.styl","hash":"85f26189ec6dee13a0a743687e7b5391f170c33f","modified":1747712626331},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/light/github.styl","hash":"a2a15ed938b319c369569845bf35d00c6624d136","modified":1747712626332},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/comments/twikoo.styl","hash":"448cbc045bcffa2d666094b81dd99eb980676fff","modified":1747712626334},{"_id":"node_modules/hexo-theme-redefine/source/css/layout/_partials/comments/waline.styl","hash":"0663e8e50eff65afb4dbcbc7c4758d8acdd1d368","modified":1747712626334},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/light/atom-one-light.styl","hash":"99de67d507bd6ffed5993097a6ce2be6422480b1","modified":1747712626330},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/dark/a11y-dark.styl","hash":"457e0df301f4dc1cc96371e65173b94bec0161fe","modified":1747712626329},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/dark/agate.styl","hash":"a33ce49622c788e5d8bba32573e0b701e4cb7ead","modified":1747712626329},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/dark/monokai-sublime.styl","hash":"803773d8c6dd5ecf957596ca57584a6618f373ac","modified":1747712626332},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/dark/github-dark.styl","hash":"fab5f7f62407b66f8b5f2837b178ef5b09a4badc","modified":1747712626331},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/dark/night-owl.styl","hash":"07c331a0c45051e93d24e10688425f1e30f0e99f","modified":1747712626333},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/dark/vs2015.styl","hash":"c54d91bf767efe0671c4dfbe874fac678cfde117","modified":1747712626334},{"_id":"source/images/57/1.png","hash":"a97d26a98091df7ac6bbc3437ed1b7d7ec2b7959","modified":1747709248742},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/dark/atom-one-dark.styl","hash":"8802725310cf86c4a179d874072188f31d10b224","modified":1747712626330},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/dark/tokyo-night-dark.styl","hash":"2ae8e43a87b18bb899ac9c802d3774232160b8e7","modified":1747712626334},{"_id":"node_modules/hexo-theme-redefine/source/css/common/codeblock/hljs-themes/dark/nord.styl","hash":"9b88c9e8bca2b8995fdc71519c01a9c80121161c","modified":1747712626333},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-brands-400.woff2","hash":"a358912d781e6249a8d291e4ce9ebd0a9ab9452e","modified":1747712626710},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/Swup.min.js.map","hash":"f74755d9318a86939791027767f631472b876207","modified":1747712626292},{"_id":"node_modules/hexo-theme-redefine/source/fonts/Geist/GeistVF.ttf","hash":"9a531509e4e768e9102d11f5d7d293e3f04d9c64","modified":1747712626652},{"_id":"node_modules/hexo-theme-redefine/source/fonts/Geist/GeistVF.woff","hash":"d06c767b3837999a8b98426e4eb16ca0a8080880","modified":1747712626689},{"_id":"node_modules/hexo-theme-redefine/source/fonts/GeistMono/GeistMonoVF.woff","hash":"fd8c986a8767d59a36e2d194299466720c916ee2","modified":1747712626680},{"_id":"node_modules/hexo-theme-redefine/source/fonts/GeistMono/GeistMonoVF.ttf","hash":"d72ec9d729305fc24f38e1ba69174e93b700cd69","modified":1747712626648},{"_id":"source/images/45/4.png","hash":"0d0b8b5ab59a6cc04449ad5cb4d12744324d4bcf","modified":1747709248710},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/fontawesome.min.css","hash":"44e6d666b45a6875e4fce11159876129e7a1cceb","modified":1747712625596},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-brands-400.ttf","hash":"ba9322d66c19f635e15e458cc39fcb509818332f","modified":1747712626374},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/APlayer.min.js.map","hash":"31a19da0f0cb6b00ec212eafa847f31af86788df","modified":1747712625986},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/waline.mjs","hash":"d94e0f396776a003b603d6e90a732a548c2fda33","modified":1747712626329},{"_id":"node_modules/hexo-theme-redefine/source/fonts/Chillax/Chillax-Variable.ttf","hash":"01aafadc0ca4ace59127a5594a8f534e83b84879","modified":1747712626343},{"_id":"node_modules/hexo-theme-redefine/source/fonts/Chillax/Chillax-Variable.eot","hash":"50a4e2ab17155fe7449e0ee488a6242180f3b256","modified":1747712625613},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-sharp-solid-900.woff2","hash":"74d0af1108ab8157993ca03cef80e89e35e2408d","modified":1747712626839},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/duotone.min.css","hash":"0becc4b085bd9d377a8ff4b5160f8e19c8ec27a0","modified":1747712625583},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-solid-900.woff2","hash":"e73d164db2aff2c91d18c07da03e8db9d0c5dfd4","modified":1747712626866},{"_id":"source/images/45/5.png","hash":"fa34f1e0d70aadab4cff097a53818f66ee162f6f","modified":1747709248713},{"_id":"source/images/51/1.png","hash":"abfae8289e2eb7983ece94d7a04593dcc65bd356","modified":1747709248727},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/moment-with-locales.min.js","hash":"dd1c67b36c800c00b7901f17af6200b26f2bb42c","modified":1747712625968},{"_id":"source/images/45/3.png","hash":"a3ed1188c99fd0c8906cceb32b9b64a8be5fb02a","modified":1747709248707},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-light-300.woff2","hash":"def760895375328ccdcf62b2b9b9001a21947acd","modified":1747712626784},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-duotone-900.woff2","hash":"2cc24434345b80a844a6bda1139539fe41e4df53","modified":1747712626746},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/moment-with-locales.min.js","hash":"dd1c67b36c800c00b7901f17af6200b26f2bb42c","modified":1747712625936},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-regular-400.woff2","hash":"486fed640153de1de84f460834c73daef060ed20","modified":1747712626820},{"_id":"node_modules/hexo-theme-redefine/source/fontawesome/all.min.css","hash":"630bf0e29410ec27622f65d1270c6bc435cdff21","modified":1747712625566},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-thin-100.woff2","hash":"e0a4482c20f6b67784df54965539a317a3bd681b","modified":1747712626918},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-sharp-solid-900.ttf","hash":"0d710cd7bd1b7ff574e88bb812de82babe45e415","modified":1747712626555},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-solid-900.ttf","hash":"40b536c3667547db70ee9ca6f3c94fbc33e0cab7","modified":1747712626586},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-regular-400.ttf","hash":"cdec068700dc440530e5bbeff7e8bb33a01b4132","modified":1747712626528},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/waline.mjs.map","hash":"37c5b3e6aa5e1b70358426345a1a1329d6b896d3","modified":1747712626322},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-light-300.ttf","hash":"cc5d9f4f994c82e23f58cdde1eec8792d81633c7","modified":1747712626477},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-thin-100.ttf","hash":"c1fee6e6986b14533ce022afada5fbe10c0f6562","modified":1747712626642},{"_id":"node_modules/hexo-theme-redefine/source/webfonts/fa-duotone-900.ttf","hash":"e0313a772ea710cb5ea4bd08f5dedb0a0025f8ca","modified":1747712626430},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/mermaid.min.js","hash":"22eeb45e4dfff78a42bc8dad60d3a8ff64968a9d","modified":1747712625921},{"_id":"node_modules/hexo-theme-redefine/source/js/build/libs/mermaid.min.js","hash":"22eeb45e4dfff78a42bc8dad60d3a8ff64968a9d","modified":1747712625816},{"_id":"node_modules/hexo-theme-redefine/source/js/libs/mermaid.min.js.map","hash":"2e1a632f0588c4370188887d79a10ff8b38a49b5","modified":1747712626287},{"_id":"public/images/33/1.png","hash":"f0870db10d00241ead7355b013063b385e249a0b","modified":1747982150856},{"_id":"public/images/33/2.png","hash":"2e9f160f2b54e26c7c63858d086c589d2ecb64a0","modified":1747982150856},{"_id":"public/images/23/1.png","hash":"6f206decd5842d38639c631617ef7158c51114bf","modified":1747982150856},{"_id":"public/images/23/3.png","hash":"ceda418d5fb7fe2d43812440a6e486ab6b3ac0f3","modified":1747982150856},{"_id":"public/images/23/4.png","hash":"468038eab13f06deb663e47dc578cb31cb3eceb3","modified":1747982150856},{"_id":"public/images/23/6.png","hash":"a2640cf31570867ffa41c3983b7ce31787624774","modified":1747982150856},{"_id":"public/images/23/5.png","hash":"10f3635fd4d680b925d3dcec241cdca7a85564e5","modified":1747982150856},{"_id":"public/images/23/2.png","hash":"a560f696e50d5647b6500b3817465c1a0e948c56","modified":1747982150856},{"_id":"public/images/32/1.png","hash":"9007918936c01fe8c40b423f725cc1ee33d80baf","modified":1747982150856},{"_id":"public/images/32/3.png","hash":"02d1fd1bb168bd2f5b7889641425d81e66f286a7","modified":1747982150856},{"_id":"public/images/38/1.png","hash":"adcb9dc71476e9d0ab36b4b7e6ca5bdf46241606","modified":1747982150856},{"_id":"public/images/38/2.png","hash":"3243c2d7d82543468e1cfc3a133a74283eda2aee","modified":1747982150856},{"_id":"public/images/44/1.png","hash":"d39948218a38ad9cfe7144024f74497d3b690def","modified":1747982150856},{"_id":"public/images/32/2.png","hash":"4e2f0d1e6d5de64967d4356ebd82e20ccbd0beac","modified":1747982150856},{"_id":"public/images/34/1.png","hash":"8c57f13eb83b1252b13f2c74708f22d509a8eabe","modified":1747982150856},{"_id":"public/images/34/2.png","hash":"fb75c3fc07ea068fb45f2f08ec1321f975704ab5","modified":1747982150856},{"_id":"public/images/34/4.png","hash":"b6d86a959f6343b725bb733e469e883e8d4431f3","modified":1747982150856},{"_id":"public/images/34/6.png","hash":"ba02f29c51b94e86ae625f01cbf257d63e44d68f","modified":1747982150856},{"_id":"public/images/34/3.png","hash":"2e158c4fa135bc52dbc9ae15d007841036c260dc","modified":1747982150856},{"_id":"public/images/34/5.png","hash":"371b0649e88d44ab1ff11548b3eabe0b2205710a","modified":1747982150856},{"_id":"public/images/36/1.png","hash":"420f7285227a257aa260b2deb61d6dd04be1ddbd","modified":1747982150856},{"_id":"public/images/36/2.png","hash":"2ff593f828edae1fc60dda01fe40a6081906021c","modified":1747982150856},{"_id":"public/images/45/1.png","hash":"74e2833b7f8e76f2ca49d6c39cad9b6350da659c","modified":1747982150856},{"_id":"public/images/45/2.png","hash":"40177353553c21de9a7d080b674621f83c503529","modified":1747982150856},{"_id":"public/images/45/3.png","hash":"63c296ca4d444ec6b90d3540065a0cf8b3b066da","modified":1747982150856},{"_id":"public/images/45/4.png","hash":"d5ab96346dd0a027b6f80fe5d36449504cf5137e","modified":1747982150856},{"_id":"public/images/45/5.png","hash":"194fd3c17d993130b9274b59b927a9847dbad4e7","modified":1747982150856},{"_id":"public/images/45/6.png","hash":"96921c5fde7486d07119ef30cda2b2852cfa740e","modified":1747982150856},{"_id":"public/images/45/7.png","hash":"818b104314bd3db36ed2c635fde63081518e3260","modified":1747982150856},{"_id":"public/images/47/2.png","hash":"72aef97bf8a48606dbc67b8888cdf91f32358a60","modified":1747982150856},{"_id":"public/images/47/3.png","hash":"c6124156ed38bf8adfce0c8a4a4a7853bf7b1871","modified":1747982150856},{"_id":"public/images/47/1.png","hash":"7a0cd52f0a03dbe0213e3258c061885781168d9f","modified":1747982150856},{"_id":"public/images/57/1.png","hash":"6eb0061c68d951a3522c7e9f2dce8576c271801d","modified":1747982150856},{"_id":"public/images/57/2.png","hash":"bbc83104a4685c3aa124a4e683e59e31977d7a8a","modified":1747982150856},{"_id":"public/images/58/1.png","hash":"95efbdad691e30a1b50b49ffdb29cc8dbacc8704","modified":1747982150856},{"_id":"public/images/56/1.png","hash":"731750678c6e246c40fad695c93551455a2f17e3","modified":1747982150856},{"_id":"public/images/50/1.png","hash":"4f847c1eb455f9819ed559145d2db2a304307495","modified":1747982150856},{"_id":"public/images/52/1.png","hash":"b3e65cb34d8e23f959c50dd3c5139653f7d58ae0","modified":1747982150856},{"_id":"public/images/49/1.png","hash":"287a096f2a5ac4ace9b24bb227ef8606ea6c96f2","modified":1747982150856},{"_id":"public/images/50/2.png","hash":"700c47d1a13ace9af491e812ec59ef662bb80e32","modified":1747982150856},{"_id":"public/images/49/3.png","hash":"b81f94c8935f0dea0083c22b798486f53574619f","modified":1747982150856},{"_id":"public/images/49/2.png","hash":"bb929c61d81fa69b6af2272a7833a1f57e41193c","modified":1747982150856},{"_id":"public/images/49/4.png","hash":"84569adf89189919b02ad0640996a70dc6f287ea","modified":1747982150856},{"_id":"public/images/49/5.png","hash":"6932e059d4800a2c8b42e7f7180690e51f4ef023","modified":1747982150856},{"_id":"public/images/static/ariana-avatar.png","hash":"004b8be737f998ff44eab80fd0a70cbcc96599e0","modified":1747982150856},{"_id":"public/images/static/cat-logo.svg","hash":"f8679bec92b4bc295eec4090893a003030dc8340","modified":1747982150856},{"_id":"public/images/51/1.png","hash":"0a7417c6ffb549eadfab756962209985dfa9de5f","modified":1747982150856},{"_id":"public/images/51/10.png","hash":"71b82de82dd86b11daa1c7fd6625fd6205c90cea","modified":1747982150856},{"_id":"public/images/51/11.png","hash":"12cc905ee27dbf06110f5fd6a8a1f248e61e2b49","modified":1747982150856},{"_id":"public/images/51/12.png","hash":"0ff6b5ad877778454692eb30d11e301294d808d0","modified":1747982150856},{"_id":"public/images/51/3.png","hash":"3a71955e0529be9fec7596eafb9448ef02e585ff","modified":1747982150856},{"_id":"public/images/51/5.png","hash":"31c049261d03e4c8acdfc94001d73d6f217d73ec","modified":1747982150856},{"_id":"public/images/51/6.png","hash":"1182c0b014b2552dde4479d2d08c561acd4c16b2","modified":1747982150856},{"_id":"public/images/51/7.png","hash":"01779ad6005a4f46a5570273277c41ed4984ac87","modified":1747982150856},{"_id":"public/images/51/8.png","hash":"ca966ddc6695a0d1b4b2c29d9de1d6a569b26a4c","modified":1747982150856},{"_id":"public/images/51/2.png","hash":"3826b328025546994207be678da4735a5e8ef320","modified":1747982150856},{"_id":"public/images/51/4.png","hash":"64440665e540841fdc68d4bd377e20d3f4002ce3","modified":1747982150856},{"_id":"public/images/51/9.png","hash":"dcf48c69421a21a44f86ff08c761209ec8268461","modified":1747982150856},{"_id":"public/images/bookmark-placeholder.svg","hash":"d4a9e563bf6ece0cee23d87d6725e3c57df9c782","modified":1747982150856},{"_id":"public/images/loading.svg","hash":"a0d7478cd95cdcfc4ecec5d6c0a9f3d2a9c03b51","modified":1747982150856},{"_id":"public/images/redefine-avatar.svg","hash":"574ea402ffbba0205744e8080f9ca755d5989988","modified":1747982150856},{"_id":"public/images/redefine-favicon.svg","hash":"cdbbde55b1a9107c122e6ff05d0962cfd2ff242e","modified":1747982150856},{"_id":"public/images/redefine-logo.svg","hash":"04f9649050979d2e3dad989455c987f8dcbd3f79","modified":1747982150856},{"_id":"public/search.json","hash":"8de4e3d1cc0a841365a28c2f01527647b476da11","modified":1749630291624},{"_id":"public/404.html","hash":"a4b4773befe25141395e5e3dff90054f1bb138d6","modified":1749630291624},{"_id":"public/about/index.html","hash":"e6a214c058cc10883a478fde2ed404f5f3a0b9b5","modified":1749630291624},{"_id":"public/categories/index.html","hash":"79fa89a9ccef06767bd03f4ef52b464352ae2155","modified":1749630291624},{"_id":"public/tags/index.html","hash":"17790554bc89b30ffb59ea5a9b6f92fb324ef51c","modified":1749630291624},{"_id":"public/2025/05/22/66-IB-Rust-数组与切片/index.html","hash":"001b6842629bd8a15e0fd0ec94329d1447921165","modified":1749630291624},{"_id":"public/2025/05/22/65-IB-Rust-引用/index.html","hash":"53c0401bc7b39585d062cfdfe19c083e16294f24","modified":1749630291624},{"_id":"public/2025/05/22/64-IB-Rust-所有权/index.html","hash":"261b1a63bfad2c3f6d895e8981b6d749a4ab2d8d","modified":1749630291624},{"_id":"public/2025/05/21/63-IB-Rust-基础类型/index.html","hash":"90d2e930dac00bae7206c98a3f5dfc22ee4f8e4b","modified":1749630291624},{"_id":"public/2025/05/21/62-IB-Rust-流程控制/index.html","hash":"40a00553437492124c0ed19056bbd6e6f12b4c26","modified":1749630291624},{"_id":"public/2025/05/21/61-IB-Rust-函数/index.html","hash":"7132f18dd268c5fb378a05e1b5759099055405f1","modified":1749630291624},{"_id":"public/2025/05/20/60-IB-Rust-变量&可变类型/index.html","hash":"0f41560b98f8dddbd9353e4033f9f5db4dc25ceb","modified":1749630291624},{"_id":"public/2025/05/20/59-IB-Rust-环境搭建/index.html","hash":"081a2c11561c8afa6ccad87c35730004756da28a","modified":1749630291624},{"_id":"public/2025/01/25/58-React3/index.html","hash":"e8064b2a75c7daade0a3b87a6c8696558b72bed1","modified":1749630291624},{"_id":"public/2025/01/24/57-React2/index.html","hash":"df6ee5d79d1d322d93eea616bce7d8cd4d3882b1","modified":1749630291624},{"_id":"public/2025/01/22/56-React1/index.html","hash":"b19a1a787976ecdeafab8cfeea10658ec6c19247","modified":1749630291624},{"_id":"public/2025/01/22/55-北大区块链-课程总结/index.html","hash":"75fa4fde1b48d6de4a82ff9f72a9a56fe9daa7d4","modified":1749630291624},{"_id":"public/2025/01/21/54-北大区块链-美链/index.html","hash":"3ea24c274a710474b02bf449ac55c64fcc8a6354","modified":1749630291624},{"_id":"public/2025/01/21/53-北大区块链-反思/index.html","hash":"018953037c2941ca9526fdd0b0438b3448be55db","modified":1749630291624},{"_id":"public/2025/01/21/52-北大区块链-The DAO/index.html","hash":"aefd5d6be66e0d5256ca23fe60234df092d0e4e1","modified":1749630291624},{"_id":"public/2025/01/19/51-北大区块链-智能合约/index.html","hash":"7cc79ee1c6336c726a3f9c46a4fac2309ae301e4","modified":1749630291624},{"_id":"public/2025/01/19/50-北大区块链-POS/index.html","hash":"7af02114ee1fc1fd189fde9bc59dc864ab55d092","modified":1749630291624},{"_id":"public/2025/01/18/49-北大区块链-ETH挖矿难度调整/index.html","hash":"d0bd443285d3526c381846fb346ce544fcc1c7ed","modified":1749630291624},{"_id":"public/2025/01/18/48-北大区块链-ETH挖矿算法/index.html","hash":"79f5918ac964e489f7becbe2e918f81089e246d2","modified":1749630291624},{"_id":"public/2025/01/16/47-北大区块链-GHOST协议/index.html","hash":"58c70649a2e2c5dda3ad3489d9c95d0c10c78891","modified":1749630291624},{"_id":"public/2025/01/16/46-北大区块链-ETH交易树&收据树/index.html","hash":"5bfa83ee955ba6bde26fe3e5f551b82923cf26b3","modified":1749630291624},{"_id":"public/2025/01/15/45-北大区块链-ETH状态树/index.html","hash":"942fe63dc282ef5ec204a4f68ee7efcefce422ed","modified":1749630291624},{"_id":"public/2025/01/15/44-北大区块链-ETH账户/index.html","hash":"c83682515ca8f2f07c54fe7a9b6c0e2eeb6daf78","modified":1749630291624},{"_id":"public/2025/01/15/43-北大区块链-ETH概述/index.html","hash":"545c1a7e5bf8e573b6466d0a925294a2f618d59e","modified":1749630291624},{"_id":"public/2025/01/15/42-北大区块链-BTC引发的思考/index.html","hash":"8b093c73458f9886c9dc24d18b07c08c67e3b984","modified":1749630291624},{"_id":"public/2025/01/15/41-北大区块链-BTC匿名性/index.html","hash":"1ea488760e6866fc3cb9d4d9d5f9be36ef5601f7","modified":1749630291624},{"_id":"public/2025/01/15/40-北大区块链-课堂回答/index.html","hash":"5b1f714cf2a90ca2c9b8d8cabe97252ec57e998d","modified":1749630291624},{"_id":"public/2025/01/14/39-北大区块链-BTC分叉/index.html","hash":"6d4ebc083dca29c825383d2d649c6fa10afcaf16","modified":1749630291624},{"_id":"public/2025/01/14/38-北大区块链-BTC脚本/index.html","hash":"9caa7ac84d9aef0d2d61bddbd226587870688cf3","modified":1749630291624},{"_id":"public/2025/01/13/37-北大区块链-BTC挖矿/index.html","hash":"6442d0b00761d911825ee9a3bacb86f3c8cbe9a9","modified":1749630291624},{"_id":"public/2025/01/13/36-北大区块链-挖矿难度/index.html","hash":"f2f260fed3e51c66128bfdff8a67079c53c236c5","modified":1749630291624},{"_id":"public/2025/01/13/35-北大区块链-BTC网络/index.html","hash":"36aa4c81e4746c6b936d057e815d1eef6c8ef1ca","modified":1749630291624},{"_id":"public/2025/01/12/34-北大区块链-BTC系统实现/index.html","hash":"3de1c22597dfac61536dece66d9ff1f3dc715e09","modified":1749630291624},{"_id":"public/2025/01/02/33-北大区块链-共识协议/index.html","hash":"e9c0264880c142bf289811f29ec1cc264a291ecc","modified":1749630291624},{"_id":"public/2025/01/02/32-北大区块链-数据结构/index.html","hash":"8744730d431a63d5051603fd4f3797ad81893ed1","modified":1749630291624},{"_id":"public/2025/01/02/31-北大区块链-密码学基础/index.html","hash":"ffb980cdc2fa8e314fe70e8b439c20355c826b6f","modified":1749630291624},{"_id":"public/2025/01/02/30-北大区块链-简介/index.html","hash":"bb5d6be972b532c2e63b03e16920617a123e79be","modified":1749630291624},{"_id":"public/2024/11/05/29-TCP/index.html","hash":"030f03b313552bc182fcae2a7de920cdf6776cdb","modified":1749630291624},{"_id":"public/2024/11/05/28-interface&type/index.html","hash":"476bb4ae1262615e4eec2439b2011a96506957ea","modified":1749630291624},{"_id":"public/2024/11/04/27-三次握手&四次挥手/index.html","hash":"4abba8128cdf7a303a1ec499d116f4d58532bcfa","modified":1749630291624},{"_id":"public/2024/10/29/26-CDN/index.html","hash":"6400c1820113d22ae250d79bfc0921f42da7b804","modified":1749630291624},{"_id":"public/2024/10/18/25-DNS/index.html","hash":"f42b253b3a50186bc73e7cdce106619275a4e564","modified":1749630291624},{"_id":"public/2024/10/16/24-浏览器缓存与304状态码/index.html","hash":"9fac5d0367a44fd59bdba7b11a36d7e84a072323","modified":1749630291624},{"_id":"public/2024/10/14/23-投放链接防重定向/index.html","hash":"bd97671ae79df8f3cdc1a075ca20a42a88737584","modified":1749630291624},{"_id":"public/2024/10/14/22-浏览器解析url过程/index.html","hash":"6e61ebb2cb254ed3c6939ca48b3f2a653a8f17d9","modified":1749630291624},{"_id":"public/2024/10/10/21-浏览器输入url后发生了什么/index.html","hash":"f08a78701aad8475f456c1e233a88557a5ca658c","modified":1749630291624},{"_id":"public/2023/12/28/20-vue3依赖注入/index.html","hash":"7ae3f77f908bcd0ee58d51e48a0839305a508cb7","modified":1749630291624},{"_id":"public/2023/12/26/19-vue插槽/index.html","hash":"82b935ac8481e5e63bc1922142a48f844f7cfe9a","modified":1749630291624},{"_id":"public/2023/12/21/18-vue3继承attributes/index.html","hash":"3be60872e9403cd72c732c0ee75baa4245b993d5","modified":1749630291624},{"_id":"public/2023/12/15/17-vue3组件v-model/index.html","hash":"869783f9d56745c64075c9c4444572bcf72656ee","modified":1749630291624},{"_id":"public/2023/12/15/16-vue3 props & emits/index.html","hash":"0bf837e51c19760cf00371e1c8edab657ccb8126","modified":1749630291624},{"_id":"public/2023/12/13/15-vue3组件注册/index.html","hash":"7c830479bcc3eb9a42ce6d920abf3e7d0af64b3b","modified":1749630291624},{"_id":"public/2023/12/11/14-vue3组件基础/index.html","hash":"c9062f8474b1bf9e9eb97775853ea80ec81ce8a6","modified":1749630291624},{"_id":"public/2023/12/08/13-vue3模板引用/index.html","hash":"5a4f3e0f3e5d25912f8544489fd49adf1f1a1522","modified":1749630291624},{"_id":"public/2023/12/07/12-vue3侦听器/index.html","hash":"8f80d2e7f4951f164f74a37ca5ef13b447381d28","modified":1749630291624},{"_id":"public/2023/12/05/10-v-model/index.html","hash":"8513cf71a80aeb9ea34be256920f74b5f3a65b77","modified":1749630291624},{"_id":"public/2023/11/30/9-vue事件处理/index.html","hash":"eea9aae975eeb2f6b8908f23c9f9ae0e7c1f2d77","modified":1749630291624},{"_id":"public/2023/11/29/8-js事件/index.html","hash":"ae4b9b4965fbddf770312ddff4e7e27b0b3f1764","modified":1749630291624},{"_id":"public/2023/12/05/11-vue3生命周期/index.html","hash":"9920fb85f0243180e9f1ea030d17eed43a20e7d5","modified":1749630291624},{"_id":"public/2023/11/29/7-v-for/index.html","hash":"028dd6af0ee3ba8dac1e58bb6ec96cfdbb2c2e04","modified":1749630291624},{"_id":"public/2023/11/28/6-vue class与style绑定/index.html","hash":"84e9e6479bda7d3ee9aa02bfffa6d8ed0a658ecc","modified":1749630291624},{"_id":"public/2023/11/14/5-为什么vue组件添加scoped后某些组件样式不生效/index.html","hash":"d8ca45db1097d38f5350a9560d90c5f4fe633869","modified":1749630291624},{"_id":"public/2023/11/07/4-vue3计算属性/index.html","hash":"d5d7a4971d88cc0685bfd45eb85b6ea56e17432d","modified":1749630291624},{"_id":"public/2023/11/06/3-vue3响应式/index.html","hash":"e32639c0652b30a7220a951d9a8e960766213e61","modified":1749630291624},{"_id":"public/2023/11/06/2-vue指令语法/index.html","hash":"e8c02a4fcc4e8d785780187bbf3620bbe5a5ea57","modified":1749630291624},{"_id":"public/2023/11/06/1-vue3应用的创建&使用/index.html","hash":"12f0f55ba5459692eb78acd75968480044b2f238","modified":1749630291624},{"_id":"public/archives/index.html","hash":"05ae16c86f67ee7632f05564092f030e75c34d7c","modified":1749630291624},{"_id":"public/archives/page/2/index.html","hash":"c545a28cb668dc93a55c649fb92f7cfd2917099e","modified":1749630291624},{"_id":"public/archives/page/3/index.html","hash":"c2e7d333e01073d923faf22bf4c93c5e4be9c0ef","modified":1749630291624},{"_id":"public/archives/page/4/index.html","hash":"134a919c76b3859bcbf8c861c866590fecac0e99","modified":1749630291624},{"_id":"public/archives/page/5/index.html","hash":"1e374049c8dd360c3b1a1c3e32724c3bc01fe1fa","modified":1749630291624},{"_id":"public/archives/page/6/index.html","hash":"adb9aee50e383a25cfb9511bf265da627c5f0659","modified":1749630291624},{"_id":"public/archives/page/7/index.html","hash":"3365c91dec661d56cd431448536ec4c76fcd3f4e","modified":1749630291624},{"_id":"public/archives/2023/index.html","hash":"7db9f0fa75f13bfd7b3d7976eae44c7e0c8165fc","modified":1749630291624},{"_id":"public/archives/2023/11/index.html","hash":"08914237aa95375bc395341ed90738b252566df9","modified":1749630291624},{"_id":"public/archives/2023/page/2/index.html","hash":"0603ffd52d3df8cadc2b26a9047ece53f9ec0292","modified":1749630291624},{"_id":"public/archives/2023/12/index.html","hash":"854eca0f04d37024783b6075e132bbd8c7485435","modified":1749630291624},{"_id":"public/archives/2023/12/page/2/index.html","hash":"ba7c16d5cef37cfb6517a699874bc55ff782de8c","modified":1749630291624},{"_id":"public/archives/2024/10/index.html","hash":"b6b8be72214179163593f1665a6cb33088d165d6","modified":1749630291624},{"_id":"public/archives/2024/index.html","hash":"5466e3679d8e25bfc151a6976c81ebb399bc9752","modified":1749630291624},{"_id":"public/archives/2024/11/index.html","hash":"99823eb95925047ff43407f75eae4eca2dee29df","modified":1749630291624},{"_id":"public/archives/2025/index.html","hash":"92d2862400bd164587267bf8b5de6cea309d69ad","modified":1749630291624},{"_id":"public/archives/2025/page/2/index.html","hash":"c55fd4bcbaff9e4c83b8c275f817a007ef51fa68","modified":1749630291624},{"_id":"public/archives/2025/page/3/index.html","hash":"e77ecb9fea4f9e38fc37db8709164fc3c4513a29","modified":1749630291624},{"_id":"public/archives/2025/page/4/index.html","hash":"f851fe189f9e6c9fbd28c5348e30ad85ee559989","modified":1749630291624},{"_id":"public/archives/2025/01/index.html","hash":"31c7d8224537aaf7221d49b69341a5035977d80e","modified":1749630291624},{"_id":"public/archives/2025/01/page/2/index.html","hash":"00fb0a21ddea5a0c972634375b158f8278db1862","modified":1749630291624},{"_id":"public/archives/2025/01/page/3/index.html","hash":"46c23c074f282e3071a2e0cda21ab6c50e02a86f","modified":1749630291624},{"_id":"public/archives/2025/05/index.html","hash":"bdfc242ffe7e74b707760b39fcf4a935f66c1829","modified":1749630291624},{"_id":"public/categories/vue3-文档/index.html","hash":"51c4fb6ec6b59d8162bf18d0712a5f0b1ed947c4","modified":1749630291624},{"_id":"public/categories/vue3-文档/page/2/index.html","hash":"a0b77446b66f581a811698ecff9595b9fccdf1f8","modified":1749630291624},{"_id":"public/categories/vue-文档/index.html","hash":"073267fe0db2f59456931762ebe8106ba8159b03","modified":1749630291624},{"_id":"public/categories/计算机网络-综合/index.html","hash":"ff09e05b59eb903a65722df29c489ebc6ec66f36","modified":1749630291624},{"_id":"public/categories/计算机网络-url/index.html","hash":"be61e4ccd94d384f7aa82eb1ad16ee08324cab3a","modified":1749630291624},{"_id":"public/categories/计算机网络-状态码/index.html","hash":"ceb7d913e4d5419e8f84e59a99ef29f6f92c8d4d","modified":1749630291624},{"_id":"public/categories/计算机网络-DNS/index.html","hash":"5f038249a883821a39d0a9c7edaa9db5d3f3e402","modified":1749630291624},{"_id":"public/categories/计算机网络-CDN/index.html","hash":"9d38f56a69cc2f50dde664ecf69eb855f2103b27","modified":1749630291624},{"_id":"public/categories/计算机网络-TCP/index.html","hash":"c1c5365d2da9c328c95c598c1c5bf5c09a876cd4","modified":1749630291624},{"_id":"public/categories/计算机网络-状态码/计算机网络-浏览器/index.html","hash":"d9875be7873f761729aeebedfe442af2ea0cce0b","modified":1749630291624},{"_id":"public/categories/Web3-北大肖臻-区块链技术与应用/index.html","hash":"569ee525164c1808fcc84d6ddadbab6ab144db37","modified":1749630291624},{"_id":"public/categories/Web3-北大肖臻-区块链技术与应用/page/2/index.html","hash":"170ae3ae41d68b249be681a6fcd3d3aa38f8581b","modified":1749630291624},{"_id":"public/categories/Web3-北大肖臻-区块链技术与应用/page/3/index.html","hash":"36610d98a2adf66855d054895c2e3401285bc516","modified":1749630291624},{"_id":"public/categories/vue-样式/index.html","hash":"bc26b1b370e6ac6df5c47878f782d3d4efd92b61","modified":1749630291624},{"_id":"public/categories/React-基础课程/index.html","hash":"756db89c99073fa8b3dcff233c3095fa38a57bfb","modified":1749630291624},{"_id":"public/categories/Rust-IB课程/index.html","hash":"e642e591ed17140b97e9253b8297f15fbcbbcc38","modified":1749630291624},{"_id":"public/categories/JavaScript-事件/index.html","hash":"7ea3c591fb25a52b80ab5157608a59531bb84c7c","modified":1749630291624},{"_id":"public/categories/vue-样式/vue3-文档/index.html","hash":"957a9a948c9f72cc896d64e58f2d3f5f19bdb2be","modified":1749630291624},{"_id":"public/index.html","hash":"68bc48d11a9bb3b387e330f0297e4e59ae36f8aa","modified":1749630291624},{"_id":"public/page/2/index.html","hash":"e22a88f128a7bad066886d3dfff783c3c45f68a9","modified":1749630291624},{"_id":"public/page/3/index.html","hash":"2876c6ec3fc16691c1a74b9cf63fd8e314e7b90b","modified":1749630291624},{"_id":"public/page/4/index.html","hash":"686bde103ba13ff548636c6200942dc4075332af","modified":1749630291624},{"_id":"public/page/5/index.html","hash":"46e3939d3a81d5cd6682beb78296265ce2b6fbee","modified":1749630291624},{"_id":"public/page/6/index.html","hash":"7884080a3a74bd1f44df74e9d064e8cda8d9982a","modified":1749630291624},{"_id":"public/page/7/index.html","hash":"243a681a2de6af32621a843480bc3624b76b9dee","modified":1749630291624},{"_id":"public/tags/vue3/index.html","hash":"3a9ffb5ed01e9dcf08b98e764226532aa07ace08","modified":1749630291624},{"_id":"public/tags/vue3/page/2/index.html","hash":"d71c262956a322a7523e40635b394af930b52be3","modified":1749630291624},{"_id":"public/tags/vue/index.html","hash":"138017817fd266a2a6d9f794442be55c8ff6acde","modified":1749630291624},{"_id":"public/tags/vue/page/2/index.html","hash":"243e59eecbc1fdc0f67385135a301c024439982c","modified":1749630291624},{"_id":"public/tags/面经/index.html","hash":"a01db9c571dba71f9db7db202c40761e8ba079ed","modified":1749630291624},{"_id":"public/tags/计算机网络/index.html","hash":"e43ab2bb62b146d487d9c0b40706bcbeedadaff4","modified":1749630291624},{"_id":"public/tags/url/index.html","hash":"3d79c37900a0f04634942f901e007e2edb3712cf","modified":1749630291624},{"_id":"public/tags/实践问题/index.html","hash":"d3aaa89dfc56227de7a62bdb51d035cd8c4b2dd7","modified":1749630291624},{"_id":"public/tags/状态码/index.html","hash":"d022170e2c59818a014e6bc0bf7c6d65fea50f9f","modified":1749630291624},{"_id":"public/tags/浏览器/index.html","hash":"92435ba235f72f5e53ac6d380b5360f59f3bc147","modified":1749630291624},{"_id":"public/tags/DNS/index.html","hash":"2684e6eaccb60cecd9e2e4c9e340019e5c7b7a2a","modified":1749630291624},{"_id":"public/tags/CDN/index.html","hash":"468c76e2eebfdfb7b79127764c7c468b5f57a117","modified":1749630291624},{"_id":"public/tags/TCP/index.html","hash":"61fc6ac97df0d9b4d59e2a96f351940502a7f180","modified":1749630291624},{"_id":"public/tags/web3/page/2/index.html","hash":"211ebbfe3d41f7faf8f5b453fe55e2ba37615c10","modified":1749630291624},{"_id":"public/tags/web3/index.html","hash":"9220a2d62b12c41b3a922952140a9dea674ad9e3","modified":1749630291624},{"_id":"public/tags/web3/page/3/index.html","hash":"6a6654bc3295fcd60168b1244b0e37f09a974352","modified":1749630291624},{"_id":"public/tags/密码学/index.html","hash":"93fd7be17048785853265010c3bc7cf086891550","modified":1749630291624},{"_id":"public/tags/数据结构/index.html","hash":"3d93b9db91bcc83c8a8efaa1beb8f571520ede53","modified":1749630291624},{"_id":"public/tags/共识协议/index.html","hash":"318367047a5e70465911a6c03c628e211d7860f5","modified":1749630291624},{"_id":"public/tags/BTC/index.html","hash":"d96e83cc5baca6c68a8602e6b48dada683597813","modified":1749630291624},{"_id":"public/tags/ETH/index.html","hash":"b29eb5bda8af1e7c92c14d1e8c29078a3c90cef7","modified":1749630291624},{"_id":"public/tags/ETH/page/2/index.html","hash":"ac915e5ff907720ebd0e622fac72e6cd9af08d08","modified":1749630291624},{"_id":"public/tags/POS/index.html","hash":"0cfd803c60426e1f890186a3cff1c4be6361ad51","modified":1749630291624},{"_id":"public/tags/智能合约/index.html","hash":"35f6d23b06ad8b704cb11e2778489eb36b529df2","modified":1749630291624},{"_id":"public/tags/React/index.html","hash":"67a337a0974dbbbe55694809fe2bc6b9b09ee97c","modified":1749630291624},{"_id":"public/tags/Rust/index.html","hash":"55d73ac7e82edb13f70d67cd3231f9c15ef83f3e","modified":1749630291624},{"_id":"public/tags/JavaScript/index.html","hash":"830f10d0632bea9cd881635d89add07c86ea2dab","modified":1749630291624},{"_id":"public/images/wallhaven-wqery6-dark.webp","hash":"d0066e0b025ae748448a3d6a96165d45a55d2f22","modified":1747982150856},{"_id":"public/images/redefine-logo.webp","hash":"0a07e3fb6d9125dee44798c8c110187b16fb42a9","modified":1747982150856},{"_id":"public/images/redefine-og.webp","hash":"44fb793383da185808ed682d7dd916e10eb65b4d","modified":1747982150856},{"_id":"public/images/wallhaven-wqery6-light.webp","hash":"d25389973d0359b78f1e9c74a850ef425690ba40","modified":1747982150856},{"_id":"public/webfonts/fa-v4compatibility.woff2","hash":"d02b1adc81fd5bec023e25a7770779b99d6dd742","modified":1747982150856},{"_id":"public/js/build/utils.js.map","hash":"d9a1eed23a96de49c30ebccb52620e24204ea10e","modified":1747982150856},{"_id":"public/webfonts/fa-v4compatibility.ttf","hash":"b54531dd09c5089eb93b12ce8f90ff521855ff8a","modified":1747982150856},{"_id":"public/js/build/main.js.map","hash":"b089351e96e8f99395ac9b44aea257364a475dca","modified":1747982150856},{"_id":"public/js/libs/SwupPreloadPlugin.min.js.map","hash":"40513fec1323b601667876a97a9ef8a0c88bff63","modified":1747982150856},{"_id":"public/js/libs/SwupScrollPlugin.min.js.map","hash":"63cf04ba556b256379e103ef7d3ba12d629449a4","modified":1747982150856},{"_id":"public/fonts/Chillax/Chillax-Variable.woff","hash":"fc0e791429c274c4c9312d810e7ae9503cab34ab","modified":1747982150856},{"_id":"public/fonts/Chillax/Chillax-Variable.woff2","hash":"fc5d99b40db9deca7d151f9bd16b96ff160828b7","modified":1747982150856},{"_id":"public/fonts/Geist/GeistVF.woff2","hash":"772998a8569a6caa04927d876fbe9e0fb859658b","modified":1747982150856},{"_id":"public/js/build/plugins/masonry.js.map","hash":"b2d93754a64f84ef67528d320de69561fc763525","modified":1747982150856},{"_id":"public/js/build/plugins/aplayer.js.map","hash":"daefe65fb99e2f7699f3fd25ec90b7f38469da5d","modified":1747982150856},{"_id":"public/fonts/GeistMono/GeistMonoVF.woff2","hash":"11e9a061ce255fc4cc45ac3eeb8cab09a49f5ccc","modified":1747982150856},{"_id":"public/js/build/plugins/pangu.js.map","hash":"27d5318b81541274c3026e4892ee43ba2c410951","modified":1747982150856},{"_id":"public/js/build/plugins/hbe.js.map","hash":"53deed7e9b802b964ff90d3303f957238f2b1421","modified":1747982150856},{"_id":"public/js/build/plugins/mermaid.js.map","hash":"5a8b4e15316517af607d3c12cf4a6e3447cfec22","modified":1747982150856},{"_id":"public/js/build/plugins/typed.js.map","hash":"4840c94f7639cee4615916ce2cabd172a565a71c","modified":1747982150856},{"_id":"public/js/build/plugins/tabs.js.map","hash":"218abee3893ecdee6f6c633b9fd13520a4eefabf","modified":1747982150856},{"_id":"public/js/plugins/hbe.js","hash":"f7bd9258359dc8f70c6faec3f4fe22a1852d9bf1","modified":1747982150856},{"_id":"public/js/build/tools/localSearch.js.map","hash":"86630e1b406ad10fe0450ccc49fbf07154fab9e5","modified":1747982150856},{"_id":"public/js/build/tools/lightDarkSwitch.js.map","hash":"0fd195af186727b3b6f8a7d29035f35f7375e5a1","modified":1747982150856},{"_id":"public/js/build/tools/imageViewer.js.map","hash":"6bf89edc74bc48b0e6f616d1ac0b0bb52df09353","modified":1747982150856},{"_id":"public/js/build/tools/codeBlock.js.map","hash":"fe609e1f8c1d028eca5e131b6a98cd71547be39c","modified":1747982150856},{"_id":"public/js/build/tools/runtime.js.map","hash":"43ed778e985cbf71e7d62c5960da98a431ad43e3","modified":1747982150856},{"_id":"public/js/build/tools/scrollTopBottom.js.map","hash":"76a041bbbd0d49426322c4fc1ee05bf327ffb7bd","modified":1747982150856},{"_id":"public/js/build/layouts/essays.js.map","hash":"60c58a3fc229cd497ad782e6f2b642e6be600e4c","modified":1747982150856},{"_id":"public/js/build/layouts/categoryList.js.map","hash":"fb9f8f83a1d0510eaa510fe58891de555d4839a8","modified":1747982150856},{"_id":"public/js/build/layouts/bookmarkNav.js.map","hash":"ba215231cccf6495570205bf974a83142592a22b","modified":1747982150856},{"_id":"public/js/build/layouts/lazyload.js.map","hash":"d365d984dfa37411397b36c69e24e4d5d0b32bee","modified":1747982150856},{"_id":"public/js/build/tools/tocToggle.js.map","hash":"6fd262220a32c784f194d21c7e514f21122bde2f","modified":1747982150856},{"_id":"public/js/build/layouts/navbarShrink.js.map","hash":"275dbb4ded89c2d2d805edbbf678475139bcc442","modified":1747982150856},{"_id":"public/css/hbe.style.css","hash":"29be8fc47be885e9954e310cbc68dfadd3b4cee6","modified":1747982150856},{"_id":"public/js/build/layouts/toc.js.map","hash":"9a413e8dbc2ff2a6fc21eb2899e59d5af75942a3","modified":1747982150856},{"_id":"public/webfonts/fa-brands-400.woff2","hash":"a358912d781e6249a8d291e4ce9ebd0a9ab9452e","modified":1747982150856},{"_id":"public/js/libs/Swup.min.js.map","hash":"f74755d9318a86939791027767f631472b876207","modified":1747982150856},{"_id":"public/fonts/Geist/GeistVF.woff","hash":"d06c767b3837999a8b98426e4eb16ca0a8080880","modified":1747982150856},{"_id":"public/fonts/Geist/GeistVF.ttf","hash":"9a531509e4e768e9102d11f5d7d293e3f04d9c64","modified":1747982150856},{"_id":"public/fonts/GeistMono/GeistMonoVF.ttf","hash":"d72ec9d729305fc24f38e1ba69174e93b700cd69","modified":1747982150856},{"_id":"public/fonts/GeistMono/GeistMonoVF.woff","hash":"fd8c986a8767d59a36e2d194299466720c916ee2","modified":1747982150856},{"_id":"public/fontawesome/light.min.css","hash":"18a176eb2486db4e938e568083fa578b641ccc83","modified":1747982150856},{"_id":"public/fontawesome/brands.min.css","hash":"5119c35bbd273d2ea2501997827f6d644da93164","modified":1747982150856},{"_id":"public/fontawesome/duotone.min.css","hash":"0becc4b085bd9d377a8ff4b5160f8e19c8ec27a0","modified":1747982150856},{"_id":"public/fontawesome/sharp-solid.min.css","hash":"7d1a13c6b8178b29f5bcb1a639a1998fc9de16c4","modified":1747982150856},{"_id":"public/fontawesome/all.min.css","hash":"630bf0e29410ec27622f65d1270c6bc435cdff21","modified":1747982150856},{"_id":"public/fontawesome/solid.min.css","hash":"e727feabedb171fb0b398151870d7739ef4e2432","modified":1747982150856},{"_id":"public/fontawesome/svg-with-js.min.css","hash":"f4c08e37c4d44b3ed7a3f377d1cb5d7fca4d04bc","modified":1747982150856},{"_id":"public/fontawesome/thin.min.css","hash":"3d46be31379b07ffb24d69c6c915725eaa2e89e9","modified":1747982150856},{"_id":"public/fontawesome/regular.min.css","hash":"d27c4fed54dacff688010e51f611d950dd6e0aca","modified":1747982150856},{"_id":"public/fontawesome/v5-font-face.min.css","hash":"260ea7a5e0b89963a5dcf2600a4decdf0f408f3f","modified":1747982150856},{"_id":"public/css/tailwind.source.css","hash":"0ad0b810bf503365e117e7ab7642fabdf63986bb","modified":1747982150856},{"_id":"public/js/build.js","hash":"0a87f149b253d3bd7d3e225dc66cdd4ab5dc48c8","modified":1747982150856},{"_id":"public/js/main.js","hash":"fd645c7274599919ec027ec36975572ef24d1d1c","modified":1747982150856},{"_id":"public/fontawesome/v4-shims.min.css","hash":"96f037860b8e9b59af8e47571ea98791616dbfd8","modified":1747982150856},{"_id":"public/css/style.css","hash":"cfd2723640cfe3aaa3850dea81e89c68438274b6","modified":1747982150856},{"_id":"public/js/utils.js","hash":"a16d3005f1b6e3ed3ecb83ac7338d97d835400a7","modified":1747982150856},{"_id":"public/assets/hbe.style.css","hash":"e94a573eb11412493b6146a057535776d068efb7","modified":1747982150856},{"_id":"public/assets/odometer-theme-minimal.css","hash":"c526d6574eeb0c56d560a2f44c806c0117de78fe","modified":1747982150856},{"_id":"public/css/common/animated.css","hash":"4e2396fc57829f7a0fcbd02147a0d756a2f2c3d0","modified":1747982150856},{"_id":"public/css/build/tailwind.css","hash":"298ca1975af73e8101d77491566de03543a56a65","modified":1747982150856},{"_id":"public/fontawesome/fontawesome.min.css","hash":"44e6d666b45a6875e4fce11159876129e7a1cceb","modified":1747982150856},{"_id":"public/css/common/markdown.css","hash":"e38355bda676d4f44aa840b3acaf00dc960c42b5","modified":1747982150856},{"_id":"public/css/common/basic.css","hash":"75f476430fa0b20be3ce76ada12ba669c015dda0","modified":1747982150856},{"_id":"public/css/common/colors.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1747982150856},{"_id":"public/css/common/variables.css","hash":"a570073ce55a9b83627d76ac40dd243b7bbda38d","modified":1747982150856},{"_id":"public/css/common/theme.css","hash":"a570073ce55a9b83627d76ac40dd243b7bbda38d","modified":1747982150856},{"_id":"public/css/common/redefine-theme.css","hash":"b9211ac9cbb0eeb20fdf671487e418c85cf69180","modified":1747982150856},{"_id":"public/js/layouts/essays.js","hash":"a19004a0326dc76d356892dbc62292a285778c6b","modified":1747982150856},{"_id":"public/js/layouts/navbarShrink.js","hash":"9d2e5fef64f545e5ec18fa800f369c2dd39bae23","modified":1747982150856},{"_id":"public/js/layouts/toc.js","hash":"b6548c0e2e9690fb4a5bb0ec18baa72326a9354f","modified":1747982150856},{"_id":"public/js/build/main.js","hash":"589b1179c1fb8ba9e745dc4dcffcce3ec0922729","modified":1747982150856},{"_id":"public/js/layouts/bookmarkNav.js","hash":"067f45494bf6dc6482c7a5c9013d63c0c91f9f22","modified":1747982150856},{"_id":"public/js/layouts/categoryList.js","hash":"d3d60c34c8ce9fa124e13c7565978760e3599bf5","modified":1747982150856},{"_id":"public/js/libs/SwupPreloadPlugin.min.js","hash":"d911512891ecbe1935203bcd3d93427ad75e45c8","modified":1747982150856},{"_id":"public/js/libs/Swup.min.js","hash":"cc054d34e74a1feecfae75064f6a4d6107607396","modified":1747982150856},{"_id":"public/js/build/utils.js","hash":"ea14576c6f2e36bb5c70fcce61b337de961edc54","modified":1747982150856},{"_id":"public/js/libs/SwupProgressPlugin.min.js","hash":"fd30fe1c43072017f67bbaac18b962a5ac218711","modified":1747982150856},{"_id":"public/js/libs/SwupScriptsPlugin.min.js","hash":"b17f3434035f1339d6f9cd5c8a055d2a1b6602e9","modified":1747982150856},{"_id":"public/js/libs/SwupSlideTheme.min.js","hash":"e9d143780e879d958164b1356b7f918ec25e838a","modified":1747982150856},{"_id":"public/js/libs/Typed.min.js","hash":"e8ce2b674a637b0c0396a3106c1aedf10186249c","modified":1747982150856},{"_id":"public/js/layouts/lazyload.js","hash":"4eace9fc93e7d824085e78aa435e40b3cd87b550","modified":1747982150856},{"_id":"public/js/libs/SwupScrollPlugin.min.js","hash":"6c3afca9bb98f79d14516c093f27e3e50a3fd82e","modified":1747982150856},{"_id":"public/js/libs/minimasonry.min.js","hash":"9681cc509cb8aa733d36aad032e6e8acdb33c08c","modified":1747982150856},{"_id":"public/js/libs/anime.min.js","hash":"47cb482a8a488620a793d50ba8f6752324b46af3","modified":1747982150856},{"_id":"public/fontawesome/v4-font-face.min.css","hash":"0be987628c8b485b39f064da41c90f15c0596c1f","modified":1747982150856},{"_id":"public/js/libs/odometer.min.js","hash":"fe5beb60997c84ab2f91b54535c4221443cdd21f","modified":1747982150856},{"_id":"public/js/libs/pangu.min.js","hash":"ebc25ecdbf464407c5886f024d13f1f6da51ec85","modified":1747982150856},{"_id":"public/js/libs/moment.min.js","hash":"20bd76acf8e950e5cf7243f60e1192705dacca7d","modified":1747982150856},{"_id":"public/js/plugins/aplayer.js","hash":"9a0826dac136dd720c8f62d9c1ac8bbc29c26e2d","modified":1747982150856},{"_id":"public/js/plugins/masonry.js","hash":"c1fdb5d9f6544cf19d36d4112c85afaded3fc916","modified":1747982150856},{"_id":"public/js/libs/APlayer.min.js","hash":"22caa28ff6b41a16ff40f15d38f1739e22359478","modified":1747982150856},{"_id":"public/js/plugins/mermaid.js","hash":"8a83ea6c83ec2990e65983326efa163cae3cd050","modified":1747982150856},{"_id":"public/js/libs/pjax.min.js","hash":"3d796e5be9cdd4067c94e190ea2482d7fdb4856c","modified":1747982150856},{"_id":"public/js/plugins/pangu.js","hash":"e4a9e57c9035f3a3cb2904f64839fda208bc2ed2","modified":1747982150856},{"_id":"public/js/plugins/typed.js","hash":"dea436e3404f3802ca752c6098841d59c81252db","modified":1747982150856},{"_id":"public/js/plugins/tabs.js","hash":"5be23a96d4640f43694c9d5dd9136e641b936269","modified":1747982150856},{"_id":"public/js/tools/codeBlock.js","hash":"64593d23e1fa8d160731ed23b0cc23645126a500","modified":1747982150856},{"_id":"public/js/tools/imageViewer.js","hash":"1f07feac701c001d7dd2e88b4de7fb17ebb960e7","modified":1747982150856},{"_id":"public/js/libs/moment-with-locales.min.js","hash":"dd1c67b36c800c00b7901f17af6200b26f2bb42c","modified":1747982150856},{"_id":"public/js/tools/lightDarkSwitch.js","hash":"6a26ed3714db81987aa022f22be985f0f0548281","modified":1747982150856},{"_id":"public/js/tools/tocToggle.js","hash":"4181e9ab7528cc978fc05676fb4ada667f63216e","modified":1747982150856},{"_id":"public/js/tools/localSearch.js","hash":"29f737a44cdc5d5622fe45e81ff1845e0ccad78e","modified":1747982150856},{"_id":"public/js/tools/scrollTopBottom.js","hash":"56907e71e5ef31a008d91487605b582cec555196","modified":1747982150856},{"_id":"public/css/layout/animations.css","hash":"490558eeb4a7ad72d59e5be64289a9d6fbe9cd9d","modified":1747982150856},{"_id":"public/js/tools/runtime.js","hash":"07c898f41f58f01515ea30e5f31421c89cbde29b","modified":1747982150856},{"_id":"public/css/layout/archive-content.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1747982150856},{"_id":"public/css/layout/category-content.css","hash":"150f5c59f2879e5364c74178df31355665606cbf","modified":1747982150856},{"_id":"public/css/layout/bookmarks.css","hash":"e8366a67b3301fb83d075f8d5385c2c1e0827d08","modified":1747982150856},{"_id":"public/css/layout/home-sidebar.css","hash":"2699481b1a0f0e7bd7b7c706d25bbd767d1284bf","modified":1747982150856},{"_id":"public/css/layout/category-list.css","hash":"aef3de3a8e780634170ac329c1c6a46a75e9267d","modified":1747982150856},{"_id":"public/css/layout/home-content.css","hash":"4547da94657df882fb15064686b56ff0ee333cfa","modified":1747982150856},{"_id":"public/css/layout/page.css","hash":"2d0c3d9cef60a9ac714b35ab07feb27880ae781a","modified":1747982150856},{"_id":"public/css/layout/article-content.css","hash":"78a99c2519765002ec307ed6cdb58c2913748839","modified":1747982150856},{"_id":"public/css/layout/tag-content.css","hash":"804ef8bcd72418ef7108703fda49a10c26fbf19d","modified":1747982150856},{"_id":"public/fonts/Chillax/chillax.css","hash":"85f2404cbd2e8a78dcb8d3335e4f7b3c33dbdb05","modified":1747982150856},{"_id":"public/fonts/Geist/geist.css","hash":"c74d4b28d9a1280f2958ce3f0417b863dec698e7","modified":1747982150856},{"_id":"public/fonts/GeistMono/geist-mono.css","hash":"615d9aeaf00e11485d3e5a5a68ed2a125dd94056","modified":1747982150856},{"_id":"public/css/common/codeblock/code-block.css","hash":"1f57e499f644444e3ca9727f7d20b689fbb7da6b","modified":1747982150856},{"_id":"public/css/common/codeblock/code-theme.css","hash":"9245390229e2ce40f95c59e73c8cf46c9625c0b3","modified":1747982150856},{"_id":"public/js/build/libs/SwupProgressPlugin.min.js","hash":"fd30fe1c43072017f67bbaac18b962a5ac218711","modified":1747982150856},{"_id":"public/js/build/libs/Swup.min.js","hash":"cc054d34e74a1feecfae75064f6a4d6107607396","modified":1747982150856},{"_id":"public/js/build/libs/SwupPreloadPlugin.min.js","hash":"d911512891ecbe1935203bcd3d93427ad75e45c8","modified":1747982150856},{"_id":"public/js/build/libs/SwupSlideTheme.min.js","hash":"e9d143780e879d958164b1356b7f918ec25e838a","modified":1747982150856},{"_id":"public/js/build/libs/SwupScriptsPlugin.min.js","hash":"b17f3434035f1339d6f9cd5c8a055d2a1b6602e9","modified":1747982150856},{"_id":"public/js/build/libs/SwupScrollPlugin.min.js","hash":"6c3afca9bb98f79d14516c093f27e3e50a3fd82e","modified":1747982150856},{"_id":"public/js/build/libs/odometer.min.js","hash":"fe5beb60997c84ab2f91b54535c4221443cdd21f","modified":1747982150856},{"_id":"public/js/build/libs/Typed.min.js","hash":"e8ce2b674a637b0c0396a3106c1aedf10186249c","modified":1747982150856},{"_id":"public/js/build/libs/APlayer.min.js","hash":"22caa28ff6b41a16ff40f15d38f1739e22359478","modified":1747982150856},{"_id":"public/js/build/libs/anime.min.js","hash":"47cb482a8a488620a793d50ba8f6752324b46af3","modified":1747982150856},{"_id":"public/js/build/libs/minimasonry.min.js","hash":"9681cc509cb8aa733d36aad032e6e8acdb33c08c","modified":1747982150856},{"_id":"public/js/build/libs/pjax.min.js","hash":"3d796e5be9cdd4067c94e190ea2482d7fdb4856c","modified":1747982150856},{"_id":"public/js/build/plugins/aplayer.js","hash":"b88bdae4a16d26fb84356d2ff46b39888fb4892b","modified":1747982150856},{"_id":"public/js/build/plugins/hbe.js","hash":"283fea05801b71507cd16a2da70ffd07dee7c078","modified":1747982150856},{"_id":"public/css/common/codeblock/highlight.css","hash":"0e94be92cc76d9e9b39ad53e3eb947cfb3c898af","modified":1747982150856},{"_id":"public/js/build/plugins/pangu.js","hash":"e4a9e57c9035f3a3cb2904f64839fda208bc2ed2","modified":1747982150856},{"_id":"public/js/build/plugins/tabs.js","hash":"5be23a96d4640f43694c9d5dd9136e641b936269","modified":1747982150856},{"_id":"public/js/build/libs/moment-with-locales.min.js","hash":"dd1c67b36c800c00b7901f17af6200b26f2bb42c","modified":1747982150856},{"_id":"public/js/build/plugins/mermaid.js","hash":"8a83ea6c83ec2990e65983326efa163cae3cd050","modified":1747982150856},{"_id":"public/js/build/libs/pangu.min.js","hash":"ebc25ecdbf464407c5886f024d13f1f6da51ec85","modified":1747982150856},{"_id":"public/js/build/plugins/masonry.js","hash":"ab7f6cac4ac6562e427abfd83cc1f8bd87d74f74","modified":1747982150856},{"_id":"public/js/build/tools/codeBlock.js","hash":"f84c3b388f691f289c95d5d845212947653fb167","modified":1747982150856},{"_id":"public/js/build/plugins/typed.js","hash":"d0263de7667c4017c8da6a5dacdf8c31d7d462ff","modified":1747982150856},{"_id":"public/js/build/tools/imageViewer.js","hash":"101e997971623aa88eb0d98aaf9e2e05f7406893","modified":1747982150856},{"_id":"public/js/build/tools/scrollTopBottom.js","hash":"d87b447487e1529c8f4c992d9107b24dbe8628d2","modified":1747982150856},{"_id":"public/js/build/tools/lightDarkSwitch.js","hash":"84d2c6960ada7f8e53b9edf80329ee9e0a3207f4","modified":1747982150856},{"_id":"public/js/build/tools/runtime.js","hash":"07c898f41f58f01515ea30e5f31421c89cbde29b","modified":1747982150856},{"_id":"public/js/build/tools/tocToggle.js","hash":"05c6e96805f2480383261145f3d3c8565923a3a8","modified":1747982150856},{"_id":"public/js/build/layouts/bookmarkNav.js","hash":"067f45494bf6dc6482c7a5c9013d63c0c91f9f22","modified":1747982150856},{"_id":"public/js/build/layouts/lazyload.js","hash":"5a5241f345479826d81c1460d06f80bfef954292","modified":1747982150856},{"_id":"public/js/build/layouts/essays.js","hash":"a19004a0326dc76d356892dbc62292a285778c6b","modified":1747982150856},{"_id":"public/js/build/tools/localSearch.js","hash":"cb0153b861fed94b1cd36dccced202a6e698891a","modified":1747982150856},{"_id":"public/js/build/layouts/categoryList.js","hash":"d3d60c34c8ce9fa124e13c7565978760e3599bf5","modified":1747982150856},{"_id":"public/js/build/layouts/toc.js","hash":"dddb745e7b743cac8485b8db8c6ab2ac94ac93ef","modified":1747982150856},{"_id":"public/js/build/libs/moment.min.js","hash":"20bd76acf8e950e5cf7243f60e1192705dacca7d","modified":1747982150856},{"_id":"public/js/build/layouts/navbarShrink.js","hash":"ebe16242bee45511ad5cde693d42c0b3690accbc","modified":1747982150856},{"_id":"public/css/common/codeblock/hljs-themes/light/atom-one-light.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1747982150856},{"_id":"public/css/common/codeblock/hljs-themes/dark/a11y-dark.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1747982150856},{"_id":"public/css/common/codeblock/hljs-themes/light/default.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1747982150856},{"_id":"public/css/common/codeblock/hljs-themes/dark/agate.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1747982150856},{"_id":"public/css/common/codeblock/hljs-themes/light/github.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1747982150856},{"_id":"public/css/common/codeblock/hljs-themes/dark/monokai-sublime.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1747982150856},{"_id":"public/css/common/codeblock/hljs-themes/dark/github-dark.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1747982150856},{"_id":"public/css/common/codeblock/hljs-themes/dark/atom-one-dark.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1747982150856},{"_id":"public/css/common/codeblock/hljs-themes/dark/night-owl.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1747982150856},{"_id":"public/css/common/codeblock/hljs-themes/dark/nord.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1747982150856},{"_id":"public/css/common/codeblock/hljs-themes/dark/vs2015.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1747982150856},{"_id":"public/css/common/codeblock/hljs-themes/dark/tokyo-night-dark.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1747982150856},{"_id":"public/webfonts/fa-brands-400.ttf","hash":"ba9322d66c19f635e15e458cc39fcb509818332f","modified":1747982150856},{"_id":"public/js/libs/APlayer.min.js.map","hash":"31a19da0f0cb6b00ec212eafa847f31af86788df","modified":1747982150856},{"_id":"public/js/libs/waline.mjs","hash":"d94e0f396776a003b603d6e90a732a548c2fda33","modified":1747982150856},{"_id":"public/fonts/Chillax/Chillax-Variable.eot","hash":"50a4e2ab17155fe7449e0ee488a6242180f3b256","modified":1747982150856},{"_id":"public/fonts/Chillax/Chillax-Variable.ttf","hash":"01aafadc0ca4ace59127a5594a8f534e83b84879","modified":1747982150856},{"_id":"public/webfonts/fa-sharp-solid-900.woff2","hash":"74d0af1108ab8157993ca03cef80e89e35e2408d","modified":1747982150856},{"_id":"public/webfonts/fa-solid-900.woff2","hash":"e73d164db2aff2c91d18c07da03e8db9d0c5dfd4","modified":1747982150856},{"_id":"public/js/libs/mermaid.min.js","hash":"22eeb45e4dfff78a42bc8dad60d3a8ff64968a9d","modified":1747982150856},{"_id":"public/js/build/libs/mermaid.min.js","hash":"22eeb45e4dfff78a42bc8dad60d3a8ff64968a9d","modified":1747982150856},{"_id":"public/webfonts/fa-duotone-900.woff2","hash":"2cc24434345b80a844a6bda1139539fe41e4df53","modified":1747982150856},{"_id":"public/webfonts/fa-light-300.woff2","hash":"def760895375328ccdcf62b2b9b9001a21947acd","modified":1747982150856},{"_id":"public/webfonts/fa-regular-400.woff2","hash":"486fed640153de1de84f460834c73daef060ed20","modified":1747982150856},{"_id":"public/webfonts/fa-thin-100.woff2","hash":"e0a4482c20f6b67784df54965539a317a3bd681b","modified":1747982150856},{"_id":"public/webfonts/fa-sharp-solid-900.ttf","hash":"0d710cd7bd1b7ff574e88bb812de82babe45e415","modified":1747982150856},{"_id":"public/webfonts/fa-solid-900.ttf","hash":"40b536c3667547db70ee9ca6f3c94fbc33e0cab7","modified":1747982150856},{"_id":"public/webfonts/fa-regular-400.ttf","hash":"cdec068700dc440530e5bbeff7e8bb33a01b4132","modified":1747982150856},{"_id":"public/js/libs/waline.mjs.map","hash":"37c5b3e6aa5e1b70358426345a1a1329d6b896d3","modified":1747982150856},{"_id":"public/webfonts/fa-light-300.ttf","hash":"cc5d9f4f994c82e23f58cdde1eec8792d81633c7","modified":1747982150856},{"_id":"public/webfonts/fa-thin-100.ttf","hash":"c1fee6e6986b14533ce022afada5fbe10c0f6562","modified":1747982150856},{"_id":"public/webfonts/fa-duotone-900.ttf","hash":"e0313a772ea710cb5ea4bd08f5dedb0a0025f8ca","modified":1747982150856},{"_id":"public/js/libs/mermaid.min.js.map","hash":"2e1a632f0588c4370188887d79a10ff8b38a49b5","modified":1747982150856},{"_id":"source/_posts/67-IB-Rust-字符串.md","hash":"1ee060ae6d174a06c69e04fefff132aaf20ca8d3","modified":1748091859533},{"_id":"public/2025/05/23/67-IB-Rust-字符串/index.html","hash":"b722393a5f5a41f308c2984b209ef19bbd6585ac","modified":1749630291624},{"_id":"source/_posts/68-IB-enum元组.md","hash":"04bbe6f3ec63b46edd6adf520ccc0ba5423983aa","modified":1748272754270},{"_id":"public/2025/05/24/68-IB-enum元组/index.html","hash":"39482f4d93f3d73aa008037bd2f3bed34f1b9dda","modified":1748272800647},{"_id":"source/_posts/68-IB-Rust-enum元组.md","hash":"bf5e8d51c0036fd4d69c70f24118d95ea167d14c","modified":1748272902441},{"_id":"source/_posts/69-IB-Rust-结构体.md","hash":"5f741f60be87f50462a90310a93e271afe9db7dc","modified":1748339518090},{"_id":"public/2025/05/26/69-IB-Rust-结构体/index.html","hash":"a71cc80a21796e8c1848addb5a636623b75f330d","modified":1749630291624},{"_id":"public/2025/05/24/68-IB-Rust-enum元组/index.html","hash":"6260588bd5d6b2ab9ddbb213d5a72b287f0c665a","modified":1749630291624},{"_id":"public/categories/Rust-IB课程/page/2/index.html","hash":"2d2dabdcc5564f464509aee0eb69f5d1c16a6168","modified":1749630291624},{"_id":"public/tags/Rust/page/2/index.html","hash":"5c7f70862c5d77840011b9f49dd5f67891cfe479","modified":1749630291624},{"_id":"public/archives/2025/05/page/2/index.html","hash":"d1cf011beecee0aa30b012c42d7021d43d4eb296","modified":1749630291624},{"_id":"source/_posts/70-IB-Rust-模式匹配.md","hash":"713cd1bab2e6ebd3a3ab95fb9d7cdfe7034d49c7","modified":1748441998038},{"_id":"public/2025/05/27/70-IB-Rust-模式匹配/index.html","hash":"d1131e98fa6ed5f2d2b2fbf10f88796020887591","modified":1749630291624},{"_id":"public/archives/2025/page/5/index.html","hash":"833ce2650117710386f3997064c3b2d12ed2ffc6","modified":1749630291624},{"_id":"source/_posts/71-IB-Rust-常见集合.md","hash":"0227f863d9c81be9082d7660c9a33bd4284272c0","modified":1748533627546},{"_id":"public/2025/05/28/71-IB-Rust-常见集合/index.html","hash":"8b80717974846d77c7b577792d6f95f20a94b521","modified":1749630291624},{"_id":"public/archives/page/8/index.html","hash":"af740f237f6adbb727933d37e766cba3dc9502c2","modified":1749630291624},{"_id":"public/page/8/index.html","hash":"c2339d3c52c1c4a010390d78f76d26e7541d1b7e","modified":1749630291624},{"_id":"source/_posts/72-IB-Rust-返回值与错误处理.md","hash":"82b9eed0e8e67d6e242bc6ebe8badd1bb59887dd","modified":1748941372882},{"_id":"public/2025/06/02/72-IB-Rust-返回值与错误处理/index.html","hash":"a644f2b294130b6565de9761a2ce26004d47570d","modified":1749630291624},{"_id":"public/archives/2025/06/index.html","hash":"9fa7c82a30dd44ae27d5e7ff98cd6ad1d06c3a6f","modified":1749630291624},{"_id":"source/_posts/73-IB-Rust-模块化.md","hash":"bb81363fc2410e4fe10003d3dee81e3192a8dbc1","modified":1748945876815},{"_id":"public/2025/06/03/73-IB-Rust-模块化/index.html","hash":"d98dafcbbcbd474842d66f11814bd1148ed27f27","modified":1749630291624},{"_id":"source/_posts/74-IB-Rust-智能指针-box.md","hash":"922d62b8a66adea16e44f47a02651b845d9c3ce8","modified":1749137846139},{"_id":"public/2025/06/04/74-IB-Rust-智能指针-box/index.html","hash":"6654e06c74ddfee5fa8afed6ec10ec0edc935b7d","modified":1749630291624},{"_id":"source/_posts/75-IB-Rust-泛型.md","hash":"fc94bdf6a430e431fba66b9780edd4fc4a19ece1","modified":1749137781044},{"_id":"public/2025/06/05/75-IB-Rust-泛型/index.html","hash":"348b1e75b8ef2a62b6323f945351d91a9bdc83d9","modified":1749630291624},{"_id":"source/_posts/76-IB-Rust-生命周期.md","hash":"b9a7403f6db55b91a6f936c33f5d04bc114e60da","modified":1749451102373},{"_id":"source/_posts/78-IB-Rust-trait特性.md","hash":"54570abfb33ab8b7eb416bf4dec2b7681c66da3e","modified":1749630210247},{"_id":"source/_posts/77-IB-Rust-智能指针2.md","hash":"9e5c29799cf3e0ff7a08f428fc4c5e735ec3d639","modified":1749563747474},{"_id":"public/2025/06/10/78-IB-Rust-trait特性/index.html","hash":"b6ce22c4523a48af6a122afe2166600f9c86a9de","modified":1749630291624},{"_id":"public/2025/06/09/77-IB-Rust-智能指针2/index.html","hash":"78be5cceb826106ed41695c7bbeb7daaabe3f26c","modified":1749630291624},{"_id":"public/2025/06/05/76-IB-Rust-生命周期/index.html","hash":"71241f8625a6957aaa1c23c356b7e0cd4bcc13d6","modified":1749630291624}],"Category":[{"name":"vue3 - 文档","_id":"cmb0ffvu300046kpre1lyeaso"},{"name":"vue - 文档","_id":"cmb0ffvu5000a6kprf18408rs"},{"name":"计算机网络 - 综合","_id":"cmb0ffvu800196kpr90lggvka"},{"name":"计算机网络 - url","_id":"cmb0ffvu8001j6kprbsxa6s4w"},{"name":"计算机网络 - 状态码","_id":"cmb0ffvu9001y6kprdfyw1sd7"},{"name":"计算机网络 - DNS","_id":"cmb0ffvua00266kpr55az6zlu"},{"name":"计算机网络 - CDN","_id":"cmb0ffvua002d6kpr4knh45zf"},{"name":"计算机网络 - TCP","_id":"cmb0ffvub002m6kprd64f82ql"},{"name":"计算机网络 - 浏览器","parent":"cmb0ffvu9001y6kprdfyw1sd7","_id":"cmb0ffvub002z6kpr0oybhrsc"},{"name":"Web3 - 北大肖臻-区块链技术与应用","_id":"cmb0ffvuc00376kpr0zhr5y5s"},{"name":"vue - 样式","_id":"cmb0ffvuf005k6kpr5iqc2ffn"},{"name":"React - 基础课程","_id":"cmb0ffvug005u6kpr8sbc8yuu"},{"name":"Rust - IB课程","_id":"cmb0ffvuh006h6kpr88qy16s1"},{"name":"JavaScript - 事件","_id":"cmb0ffvui007k6kprgmwage6b"},{"name":"vue3 - 文档","parent":"cmb0ffvuf005k6kpr5iqc2ffn","_id":"cmb0ffvui007q6kprer7qaajt"}],"Data":[],"Page":[{"title":"about","date":"2023-11-03T02:23:39.000Z","_content":"# About me\n>\n>我是一枚01年的前端程序媛，23年从华东师大毕业，现工作于京东。\n>\n>本站用于记录日常的学习，很高兴和大家分享～(●’◡’●)ﾉ\n\n# Learning path\n>\n>路漫漫其修远兮，吾将上下而求索\n>\n>- 目前主要用 Vue2\n>- Vue3 & 微信小程序 会用但不熟\n>- React 在学习中\n>- 微前端用过 iframe，打算试试 qiankun\n>- 后端 & 数据库 有时间也要学\n>- ......\n\n# Hobbies\n>\n>兴趣广泛，热爱生活 ♥\n>\n>- 美食：吃吃吃什么的最治愈啦！\n>- 唱歌：喜欢欧美流行乐，Ariana Grande & Taylor Swift 的歌是心头爱\n>- 跳舞：最近在跳爵士舞，处于驯服四肢的阶段 ◔ ‸◔？\n>- 运动：钟爱散步、跳操等低强度养生运动\n>- 读书：爱读心理学书籍和小说经典\n\n# Contact\n>\n>qq邮箱：<2695969122@qq.com>\n","source":"about/index.md","raw":"---\ntitle: about\ndate: 2023-11-03 10:23:39\n---\n# About me\n>\n>我是一枚01年的前端程序媛，23年从华东师大毕业，现工作于京东。\n>\n>本站用于记录日常的学习，很高兴和大家分享～(●’◡’●)ﾉ\n\n# Learning path\n>\n>路漫漫其修远兮，吾将上下而求索\n>\n>- 目前主要用 Vue2\n>- Vue3 & 微信小程序 会用但不熟\n>- React 在学习中\n>- 微前端用过 iframe，打算试试 qiankun\n>- 后端 & 数据库 有时间也要学\n>- ......\n\n# Hobbies\n>\n>兴趣广泛，热爱生活 ♥\n>\n>- 美食：吃吃吃什么的最治愈啦！\n>- 唱歌：喜欢欧美流行乐，Ariana Grande & Taylor Swift 的歌是心头爱\n>- 跳舞：最近在跳爵士舞，处于驯服四肢的阶段 ◔ ‸◔？\n>- 运动：钟爱散步、跳操等低强度养生运动\n>- 读书：爱读心理学书籍和小说经典\n\n# Contact\n>\n>qq邮箱：<2695969122@qq.com>\n","updated":"2025-05-20T02:47:28.686Z","path":"about/index.html","comments":1,"layout":"page","_id":"cmb0ffvu000006kprasgvdawx","content":"<h1 id=\"About-me\"><a href=\"#About-me\" class=\"headerlink\" title=\"About me\"></a>About me</h1><blockquote>\n<p>我是一枚01年的前端程序媛，23年从华东师大毕业，现工作于京东。</p>\n<p>本站用于记录日常的学习，很高兴和大家分享～(●’◡’●)ﾉ</p>\n</blockquote>\n<h1 id=\"Learning-path\"><a href=\"#Learning-path\" class=\"headerlink\" title=\"Learning path\"></a>Learning path</h1><blockquote>\n<p>路漫漫其修远兮，吾将上下而求索</p>\n<ul>\n<li>目前主要用 Vue2</li>\n<li>Vue3 &amp; 微信小程序 会用但不熟</li>\n<li>React 在学习中</li>\n<li>微前端用过 iframe，打算试试 qiankun</li>\n<li>后端 &amp; 数据库 有时间也要学</li>\n<li>……</li>\n</ul>\n</blockquote>\n<h1 id=\"Hobbies\"><a href=\"#Hobbies\" class=\"headerlink\" title=\"Hobbies\"></a>Hobbies</h1><blockquote>\n<p>兴趣广泛，热爱生活 ♥</p>\n<ul>\n<li>美食：吃吃吃什么的最治愈啦！</li>\n<li>唱歌：喜欢欧美流行乐，Ariana Grande &amp; Taylor Swift 的歌是心头爱</li>\n<li>跳舞：最近在跳爵士舞，处于驯服四肢的阶段 ◔ ‸◔？</li>\n<li>运动：钟爱散步、跳操等低强度养生运动</li>\n<li>读书：爱读心理学书籍和小说经典</li>\n</ul>\n</blockquote>\n<h1 id=\"Contact\"><a href=\"#Contact\" class=\"headerlink\" title=\"Contact\"></a>Contact</h1><blockquote>\n<p>qq邮箱：<a class=\"link\"   href=\"mailto:&#x32;&#x36;&#x39;&#x35;&#57;&#54;&#x39;&#x31;&#x32;&#50;&#x40;&#x71;&#113;&#x2e;&#x63;&#x6f;&#109;\" >&#x32;&#x36;&#x39;&#x35;&#57;&#54;&#x39;&#x31;&#x32;&#50;&#x40;&#x71;&#113;&#x2e;&#x63;&#x6f;&#109;<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"About-me\"><a href=\"#About-me\" class=\"headerlink\" title=\"About me\"></a>About me</h1><blockquote>\n<p>我是一枚01年的前端程序媛，23年从华东师大毕业，现工作于京东。</p>\n<p>本站用于记录日常的学习，很高兴和大家分享～(●’◡’●)ﾉ</p>\n</blockquote>\n<h1 id=\"Learning-path\"><a href=\"#Learning-path\" class=\"headerlink\" title=\"Learning path\"></a>Learning path</h1><blockquote>\n<p>路漫漫其修远兮，吾将上下而求索</p>\n<ul>\n<li>目前主要用 Vue2</li>\n<li>Vue3 &amp; 微信小程序 会用但不熟</li>\n<li>React 在学习中</li>\n<li>微前端用过 iframe，打算试试 qiankun</li>\n<li>后端 &amp; 数据库 有时间也要学</li>\n<li>……</li>\n</ul>\n</blockquote>\n<h1 id=\"Hobbies\"><a href=\"#Hobbies\" class=\"headerlink\" title=\"Hobbies\"></a>Hobbies</h1><blockquote>\n<p>兴趣广泛，热爱生活 ♥</p>\n<ul>\n<li>美食：吃吃吃什么的最治愈啦！</li>\n<li>唱歌：喜欢欧美流行乐，Ariana Grande &amp; Taylor Swift 的歌是心头爱</li>\n<li>跳舞：最近在跳爵士舞，处于驯服四肢的阶段 ◔ ‸◔？</li>\n<li>运动：钟爱散步、跳操等低强度养生运动</li>\n<li>读书：爱读心理学书籍和小说经典</li>\n</ul>\n</blockquote>\n<h1 id=\"Contact\"><a href=\"#Contact\" class=\"headerlink\" title=\"Contact\"></a>Contact</h1><blockquote>\n<p>qq邮箱：<a class=\"link\"   href=\"mailto:&#x32;&#x36;&#x39;&#x35;&#57;&#54;&#x39;&#x31;&#x32;&#50;&#x40;&#x71;&#113;&#x2e;&#x63;&#x6f;&#109;\" >&#x32;&#x36;&#x39;&#x35;&#57;&#54;&#x39;&#x31;&#x32;&#50;&#x40;&#x71;&#113;&#x2e;&#x63;&#x6f;&#109;<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</blockquote>\n","_processedHighlight":true},{"title":"categories","date":"2023-11-02T09:58:43.000Z","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2023-11-02 17:58:43\n---\n","updated":"2025-05-20T02:47:28.686Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cmb0ffvu300026kprbd9i25ng","content":"","site":{"data":{}},"excerpt":"","more":"","_processedHighlight":true},{"title":"tags","date":"2023-11-02T10:43:02.000Z","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2023-11-02 18:43:02\n---\n","updated":"2025-05-20T02:47:28.744Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cmb0ffvu400066kpra1ax71p2","content":"","site":{"data":{}},"excerpt":"","more":"","_processedHighlight":true}],"Post":[{"title":"vue3 应用的创建&使用","date":"2023-11-06T03:27:47.000Z","_content":"\n## 创建应用\n\n``` bash\nnpm create vue@latest\n```\n\n## 通过CDN使用vue\n\n这里使用了提供 npm 包服务的 CDN —— unpkg\n\n``` html\n<script src=\"https://unpkg.com/vue@3/dist/vue.global.js\"></script>\n```\n\n### DOM 中的根组件模板\n\n当根组件没有设置 template 选项时，Vue 将自动使用容器的 innerHTML 作为模板\n\n这种方式通常用于此种“无构建步骤”（通过 CDN 使用 vue）的应用程序\n\n``` html\n<div id=\"app\">\n  <button @click=\"count++\">{{ count }}</button>\n</div>\n```\n\n``` js\nimport { createApp } from 'vue';\n\nconst app = createApp({\n  data() {\n    return {\n      count: 0\n    }\n  }\n}).mount('#app');\n```\n\n### 全局构建\n\n上述链接使用 *全局构建* 版本的 Vue，所有顶层 API 都暴露为全局 Vue 对象的属性\n\n``` html\n<script src=\"https://unpkg.com/vue@3/dist/vue.global.js\"></script>\n<div id=\"app\">{{ message }}</div>\n\n<script>\n  const { createApp, ref } = Vue;\n/**  1. 创建应用并挂载 */\n  createApp({\n    setup() {\n      const message = ref('Hello world!');\n      return {\n        message\n      };\n    }\n  }).mount('#app');\n  \n  /**  2. 分步骤 */\n  // // a. 创建应用\n  // const app = createApp({\n  //   setup() {\n  //     const message = ref('Hello world!');\n  //     return {\n  //       message\n  //     }\n  //   };\n  // });\n  // // b. 挂载\n  // app.mount('#app');\n</script>\n```\n\n### 导入映射表（Import maps）\n\n不使用完整的 CDN URL 引入，而使用 es6 的导入映射表（import maps）\n\n``` html\n<script type=\"importmap\">\n  {\n    \"imports\": {\n      \"vue\": \"https://unpkg.com/vue@3/dist/vue.global.js\"\n    }\n  }\n</script>\n<div id=\"app\">{{ message }}</div>\n\n<script type=\"module\">\n  import { createApp, ref } from \"vue\";\n\n  createApp({\n    setup() {\n      const message = ref(\"Hello world!\");\n      return {\n        message\n      };\n    }\n  }).mount('#app');\n</script>\n```\n\n### 拆分模块\n\n将代码拆分为单独的 js 文件以便管理\n\n出于安全原因，es 模块只能通过 http 协议工作，所以需要使用本地的 http 服务器，通过 http 协议提供 index.html。比如：安装 Node.js，在 html 文件所在的文件夹运行 ``npx serve``\n\n``` html\n<!-- index.html -->\n<div id=\"app\"></div>\n\n<script type=\"module\">\n  import { createApp } from 'vue';\n  import MyComponent from './my-component.js';\n  createApp(MyComponent).mount('#app');\n</script>\n```\n\n``` js\n// my-component.js\nimport { ref } from 'vue';\n\nexport default {\n  setup() {\n    const count = ref(0);\n    return { count };\n  },\n  template: `<div>count is {{ count }}</div>`\n}\n```\n","source":"_posts/1-vue3应用的创建&使用.md","raw":"---\ntitle: vue3 应用的创建&使用\ndate: 2023-11-06 11:27:47\ntags:\n    - vue3\n    - vue\ncategories:\n    - vue3\n      - 文档\n---\n\n## 创建应用\n\n``` bash\nnpm create vue@latest\n```\n\n## 通过CDN使用vue\n\n这里使用了提供 npm 包服务的 CDN —— unpkg\n\n``` html\n<script src=\"https://unpkg.com/vue@3/dist/vue.global.js\"></script>\n```\n\n### DOM 中的根组件模板\n\n当根组件没有设置 template 选项时，Vue 将自动使用容器的 innerHTML 作为模板\n\n这种方式通常用于此种“无构建步骤”（通过 CDN 使用 vue）的应用程序\n\n``` html\n<div id=\"app\">\n  <button @click=\"count++\">{{ count }}</button>\n</div>\n```\n\n``` js\nimport { createApp } from 'vue';\n\nconst app = createApp({\n  data() {\n    return {\n      count: 0\n    }\n  }\n}).mount('#app');\n```\n\n### 全局构建\n\n上述链接使用 *全局构建* 版本的 Vue，所有顶层 API 都暴露为全局 Vue 对象的属性\n\n``` html\n<script src=\"https://unpkg.com/vue@3/dist/vue.global.js\"></script>\n<div id=\"app\">{{ message }}</div>\n\n<script>\n  const { createApp, ref } = Vue;\n/**  1. 创建应用并挂载 */\n  createApp({\n    setup() {\n      const message = ref('Hello world!');\n      return {\n        message\n      };\n    }\n  }).mount('#app');\n  \n  /**  2. 分步骤 */\n  // // a. 创建应用\n  // const app = createApp({\n  //   setup() {\n  //     const message = ref('Hello world!');\n  //     return {\n  //       message\n  //     }\n  //   };\n  // });\n  // // b. 挂载\n  // app.mount('#app');\n</script>\n```\n\n### 导入映射表（Import maps）\n\n不使用完整的 CDN URL 引入，而使用 es6 的导入映射表（import maps）\n\n``` html\n<script type=\"importmap\">\n  {\n    \"imports\": {\n      \"vue\": \"https://unpkg.com/vue@3/dist/vue.global.js\"\n    }\n  }\n</script>\n<div id=\"app\">{{ message }}</div>\n\n<script type=\"module\">\n  import { createApp, ref } from \"vue\";\n\n  createApp({\n    setup() {\n      const message = ref(\"Hello world!\");\n      return {\n        message\n      };\n    }\n  }).mount('#app');\n</script>\n```\n\n### 拆分模块\n\n将代码拆分为单独的 js 文件以便管理\n\n出于安全原因，es 模块只能通过 http 协议工作，所以需要使用本地的 http 服务器，通过 http 协议提供 index.html。比如：安装 Node.js，在 html 文件所在的文件夹运行 ``npx serve``\n\n``` html\n<!-- index.html -->\n<div id=\"app\"></div>\n\n<script type=\"module\">\n  import { createApp } from 'vue';\n  import MyComponent from './my-component.js';\n  createApp(MyComponent).mount('#app');\n</script>\n```\n\n``` js\n// my-component.js\nimport { ref } from 'vue';\n\nexport default {\n  setup() {\n    const count = ref(0);\n    return { count };\n  },\n  template: `<div>count is {{ count }}</div>`\n}\n```\n","slug":"1-vue3应用的创建&使用","published":1,"updated":"2025-05-20T02:47:28.682Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu100016kpre02t1xfg","content":"<h2 id=\"创建应用\"><a href=\"#创建应用\" class=\"headerlink\" title=\"创建应用\"></a>创建应用</h2><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm create vue@latest</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"通过CDN使用vue\"><a href=\"#通过CDN使用vue\" class=\"headerlink\" title=\"通过CDN使用vue\"></a>通过CDN使用vue</h2><p>这里使用了提供 npm 包服务的 CDN —— unpkg</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://unpkg.com/vue@3/dist/vue.global.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"DOM-中的根组件模板\"><a href=\"#DOM-中的根组件模板\" class=\"headerlink\" title=\"DOM 中的根组件模板\"></a>DOM 中的根组件模板</h3><p>当根组件没有设置 template 选项时，Vue 将自动使用容器的 innerHTML 作为模板</p>\n<p>这种方式通常用于此种“无构建步骤”（通过 CDN 使用 vue）的应用程序</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;count++&quot;</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createApp &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"title function_\">createApp</span>(&#123;</span><br><span class=\"line\">  <span class=\"title function_\">data</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"attr\">count</span>: <span class=\"number\">0</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;).<span class=\"title function_\">mount</span>(<span class=\"string\">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"全局构建\"><a href=\"#全局构建\" class=\"headerlink\" title=\"全局构建\"></a>全局构建</h3><p>上述链接使用 <em>全局构建</em> 版本的 Vue，所有顶层 API 都暴露为全局 Vue 对象的属性</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://unpkg.com/vue@3/dist/vue.global.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">const</span> &#123; createApp, ref &#125; = <span class=\"title class_\">Vue</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"comment\">/**  1. 创建应用并挂载 */</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">createApp</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">const</span> message = <span class=\"title function_\">ref</span>(<span class=\"string\">&#x27;Hello world!&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        message</span></span><br><span class=\"line\"><span class=\"language-javascript\">      &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;).<span class=\"title function_\">mount</span>(<span class=\"string\">&#x27;#app&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">  </span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">/**  2. 分步骤 */</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// // a. 创建应用</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// const app = createApp(&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">//   setup() &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">//     const message = ref(&#x27;Hello world!&#x27;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">//     return &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">//       message</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">//     &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">//   &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// // b. 挂载</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// app.mount(&#x27;#app&#x27;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"导入映射表（Import-maps）\"><a href=\"#导入映射表（Import-maps）\" class=\"headerlink\" title=\"导入映射表（Import maps）\"></a>导入映射表（Import maps）</h3><p>不使用完整的 CDN URL 引入，而使用 es6 的导入映射表（import maps）</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;importmap&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"string\">&quot;imports&quot;</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"string\">&quot;vue&quot;</span>: <span class=\"string\">&quot;https://unpkg.com/vue@3/dist/vue.global.js&quot;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;module&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">import</span> &#123; createApp, ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;vue&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">createApp</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">const</span> message = <span class=\"title function_\">ref</span>(<span class=\"string\">&quot;Hello world!&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        message</span></span><br><span class=\"line\"><span class=\"language-javascript\">      &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;).<span class=\"title function_\">mount</span>(<span class=\"string\">&#x27;#app&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"拆分模块\"><a href=\"#拆分模块\" class=\"headerlink\" title=\"拆分模块\"></a>拆分模块</h3><p>将代码拆分为单独的 js 文件以便管理</p>\n<p>出于安全原因，es 模块只能通过 http 协议工作，所以需要使用本地的 http 服务器，通过 http 协议提供 index.html。比如：安装 Node.js，在 html 文件所在的文件夹运行 <code>npx serve</code></p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- index.html --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;module&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">import</span> &#123; createApp &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">import</span> <span class=\"title class_\">MyComponent</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./my-component.js&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">createApp</span>(<span class=\"title class_\">MyComponent</span>).<span class=\"title function_\">mount</span>(<span class=\"string\">&#x27;#app&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// my-component.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> count = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123; count &#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">template</span>: <span class=\"string\">`&lt;div&gt;count is &#123;&#123; count &#125;&#125;&lt;/div&gt;`</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"创建应用\"><a href=\"#创建应用\" class=\"headerlink\" title=\"创建应用\"></a>创建应用</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm create vue@latest</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"通过CDN使用vue\"><a href=\"#通过CDN使用vue\" class=\"headerlink\" title=\"通过CDN使用vue\"></a>通过CDN使用vue</h2><p>这里使用了提供 npm 包服务的 CDN —— unpkg</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://unpkg.com/vue@3/dist/vue.global.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"DOM-中的根组件模板\"><a href=\"#DOM-中的根组件模板\" class=\"headerlink\" title=\"DOM 中的根组件模板\"></a>DOM 中的根组件模板</h3><p>当根组件没有设置 template 选项时，Vue 将自动使用容器的 innerHTML 作为模板</p>\n<p>这种方式通常用于此种“无构建步骤”（通过 CDN 使用 vue）的应用程序</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;count++&quot;</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createApp &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"title function_\">createApp</span>(&#123;</span><br><span class=\"line\">  <span class=\"title function_\">data</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"attr\">count</span>: <span class=\"number\">0</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;).<span class=\"title function_\">mount</span>(<span class=\"string\">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"全局构建\"><a href=\"#全局构建\" class=\"headerlink\" title=\"全局构建\"></a>全局构建</h3><p>上述链接使用 <em>全局构建</em> 版本的 Vue，所有顶层 API 都暴露为全局 Vue 对象的属性</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://unpkg.com/vue@3/dist/vue.global.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">const</span> &#123; createApp, ref &#125; = <span class=\"title class_\">Vue</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"comment\">/**  1. 创建应用并挂载 */</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">createApp</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">const</span> message = <span class=\"title function_\">ref</span>(<span class=\"string\">&#x27;Hello world!&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        message</span></span><br><span class=\"line\"><span class=\"language-javascript\">      &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;).<span class=\"title function_\">mount</span>(<span class=\"string\">&#x27;#app&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">  </span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">/**  2. 分步骤 */</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// // a. 创建应用</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// const app = createApp(&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">//   setup() &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">//     const message = ref(&#x27;Hello world!&#x27;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">//     return &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">//       message</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">//     &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">//   &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// // b. 挂载</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// app.mount(&#x27;#app&#x27;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"导入映射表（Import-maps）\"><a href=\"#导入映射表（Import-maps）\" class=\"headerlink\" title=\"导入映射表（Import maps）\"></a>导入映射表（Import maps）</h3><p>不使用完整的 CDN URL 引入，而使用 es6 的导入映射表（import maps）</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;importmap&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"string\">&quot;imports&quot;</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"string\">&quot;vue&quot;</span>: <span class=\"string\">&quot;https://unpkg.com/vue@3/dist/vue.global.js&quot;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;module&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">import</span> &#123; createApp, ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;vue&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">createApp</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">const</span> message = <span class=\"title function_\">ref</span>(<span class=\"string\">&quot;Hello world!&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        message</span></span><br><span class=\"line\"><span class=\"language-javascript\">      &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;).<span class=\"title function_\">mount</span>(<span class=\"string\">&#x27;#app&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"拆分模块\"><a href=\"#拆分模块\" class=\"headerlink\" title=\"拆分模块\"></a>拆分模块</h3><p>将代码拆分为单独的 js 文件以便管理</p>\n<p>出于安全原因，es 模块只能通过 http 协议工作，所以需要使用本地的 http 服务器，通过 http 协议提供 index.html。比如：安装 Node.js，在 html 文件所在的文件夹运行 <code>npx serve</code></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- index.html --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;module&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">import</span> &#123; createApp &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">import</span> <span class=\"title class_\">MyComponent</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./my-component.js&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">createApp</span>(<span class=\"title class_\">MyComponent</span>).<span class=\"title function_\">mount</span>(<span class=\"string\">&#x27;#app&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// my-component.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> count = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123; count &#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">template</span>: <span class=\"string\">`&lt;div&gt;count is &#123;&#123; count &#125;&#125;&lt;/div&gt;`</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"v-model","date":"2023-12-05T02:31:56.000Z","_content":"\n## 基础\n\n``` html\n<input\n    :value=\"text\"\n    @input=\"event => text = event.target.value\" />\n```\n\n用 v-model 简化：\n\n``` html\n<input v-model=\"text\" />\n```\n\n## 类型\n\n### 单行\n\n``` html\n<p>{{ message }}</p>\n<input v-model=\"message\" placeholder=\"edit\" />\n```\n\n### 多行\n\n``` html\n<p>{{ message }}</p>\n<textarea v-model=\"message\" placeholder=\"edit\"></textarea>\n```\n\n### 复选框\n\nlabel 标签 for 属性的作用：用户点击 label 标签时，浏览器会将焦点转移到与 for 属性值相匹配的表单控件上，从而提高表单的可访问性和易用性。\n\n``` html\n<div>Checked names: {{ checkedNames }}</div>\n\n<input type=\"checkbox\" id=\"jack\" value=\"Jack\" v-model=\"checkedNames\">\n<label for=\"jack\">Jack</label>\n\n<input type=\"checkbox\" id=\"john\" value=\"John\" v-model=\"checkedNames\">\n<label for=\"john\">John</label>\n\n<input type=\"checkbox\" id=\"mike\" value=\"Mike\" v-model=\"checkedNames\">\n<label for=\"mike\">Mike</label>\n```\n\n### 单选\n\n``` html\n<div>Picked: {{ picked }}</div>\n\n<input type=\"radio\" id=\"one\" value=\"One\" v-model=\"picked\" />\n<label for=\"one\">One</label>\n\n<input type=\"radio\" id=\"two\" value=\"Two\" v-model=\"picked\" />\n<label for=\"two\">Two</label>\n```\n\n### 选择器\n\n单个：\n\n``` html\n<div>Selected: {{ selected }}</div>\n\n<select v-model=\"selected\">\n  <option disabled value=\"\">Please select one</option>\n  <option>A</option>\n  <option>B</option>\n  <option>C</option>\n</select>\n```\n\n多个（将值绑定到数组上）：\n\n``` html\n<div>Selected: {{ selected }}</div>\n\n<select v-model=\"selected\" multiple>\n  <option>A</option>\n  <option>B</option>\n  <option>C</option>\n</select>\n```\n\n## 修饰符\n\n### .lazy\n\n.lazy 修饰符表示在 \"change\" 事件而不是 \"input\" 事件触发时更新：\n\n这意味着数据将在失去焦点后才会同步到视图中，而不是每次输入时都同步。可以用于减少输入框频繁更新视图的情况，尤其是在处理大量输入时可以提高性能。\n\n``` html\n<input v-model.lazy=\"msg\" />\n```\n\n### .number\n\n让用户输入自动转换为数字，如果该值无法被 parseFloat() 处理，则将返回原始值。\n\nnumber 修饰符会在输入框有 type=\"number\" 时自动启用。\n\n``` html\n<input v-model.lazy=\"msg\" />\n```\n\n### .trim\n\n默认自动去除用户输入内容中两端的空格：\n\n``` html\n<input v-model.trim=\"msg\" />\n```\n","source":"_posts/10-v-model.md","raw":"---\ntitle: v-model\ndate: 2023-12-05 10:31:56\ntags: \n    - vue\ncategories:\n    - vue\n      - 文档\n---\n\n## 基础\n\n``` html\n<input\n    :value=\"text\"\n    @input=\"event => text = event.target.value\" />\n```\n\n用 v-model 简化：\n\n``` html\n<input v-model=\"text\" />\n```\n\n## 类型\n\n### 单行\n\n``` html\n<p>{{ message }}</p>\n<input v-model=\"message\" placeholder=\"edit\" />\n```\n\n### 多行\n\n``` html\n<p>{{ message }}</p>\n<textarea v-model=\"message\" placeholder=\"edit\"></textarea>\n```\n\n### 复选框\n\nlabel 标签 for 属性的作用：用户点击 label 标签时，浏览器会将焦点转移到与 for 属性值相匹配的表单控件上，从而提高表单的可访问性和易用性。\n\n``` html\n<div>Checked names: {{ checkedNames }}</div>\n\n<input type=\"checkbox\" id=\"jack\" value=\"Jack\" v-model=\"checkedNames\">\n<label for=\"jack\">Jack</label>\n\n<input type=\"checkbox\" id=\"john\" value=\"John\" v-model=\"checkedNames\">\n<label for=\"john\">John</label>\n\n<input type=\"checkbox\" id=\"mike\" value=\"Mike\" v-model=\"checkedNames\">\n<label for=\"mike\">Mike</label>\n```\n\n### 单选\n\n``` html\n<div>Picked: {{ picked }}</div>\n\n<input type=\"radio\" id=\"one\" value=\"One\" v-model=\"picked\" />\n<label for=\"one\">One</label>\n\n<input type=\"radio\" id=\"two\" value=\"Two\" v-model=\"picked\" />\n<label for=\"two\">Two</label>\n```\n\n### 选择器\n\n单个：\n\n``` html\n<div>Selected: {{ selected }}</div>\n\n<select v-model=\"selected\">\n  <option disabled value=\"\">Please select one</option>\n  <option>A</option>\n  <option>B</option>\n  <option>C</option>\n</select>\n```\n\n多个（将值绑定到数组上）：\n\n``` html\n<div>Selected: {{ selected }}</div>\n\n<select v-model=\"selected\" multiple>\n  <option>A</option>\n  <option>B</option>\n  <option>C</option>\n</select>\n```\n\n## 修饰符\n\n### .lazy\n\n.lazy 修饰符表示在 \"change\" 事件而不是 \"input\" 事件触发时更新：\n\n这意味着数据将在失去焦点后才会同步到视图中，而不是每次输入时都同步。可以用于减少输入框频繁更新视图的情况，尤其是在处理大量输入时可以提高性能。\n\n``` html\n<input v-model.lazy=\"msg\" />\n```\n\n### .number\n\n让用户输入自动转换为数字，如果该值无法被 parseFloat() 处理，则将返回原始值。\n\nnumber 修饰符会在输入框有 type=\"number\" 时自动启用。\n\n``` html\n<input v-model.lazy=\"msg\" />\n```\n\n### .trim\n\n默认自动去除用户输入内容中两端的空格：\n\n``` html\n<input v-model.trim=\"msg\" />\n```\n","slug":"10-v-model","published":1,"updated":"2025-05-20T02:47:28.682Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu300036kpra4362192","content":"<h2 id=\"基础\"><a href=\"#基础\" class=\"headerlink\" title=\"基础\"></a>基础</h2><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:value</span>=<span class=\"string\">&quot;text&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    @<span class=\"attr\">input</span>=<span class=\"string\">&quot;event =&gt; text = event.target.value&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>用 v-model 简化：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;text&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"类型\"><a href=\"#类型\" class=\"headerlink\" title=\"类型\"></a>类型</h2><h3 id=\"单行\"><a href=\"#单行\" class=\"headerlink\" title=\"单行\"></a>单行</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;message&quot;</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">&quot;edit&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"多行\"><a href=\"#多行\" class=\"headerlink\" title=\"多行\"></a>多行</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">textarea</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;message&quot;</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">&quot;edit&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">textarea</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"复选框\"><a href=\"#复选框\" class=\"headerlink\" title=\"复选框\"></a>复选框</h3><p>label 标签 for 属性的作用：用户点击 label 标签时，浏览器会将焦点转移到与 for 属性值相匹配的表单控件上，从而提高表单的可访问性和易用性。</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>Checked names: &#123;&#123; checkedNames &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;jack&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;Jack&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;checkedNames&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;jack&quot;</span>&gt;</span>Jack<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;john&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;John&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;checkedNames&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;john&quot;</span>&gt;</span>John<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;mike&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;Mike&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;checkedNames&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;mike&quot;</span>&gt;</span>Mike<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"单选\"><a href=\"#单选\" class=\"headerlink\" title=\"单选\"></a>单选</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>Picked: &#123;&#123; picked &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;radio&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;one&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;One&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;picked&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;one&quot;</span>&gt;</span>One<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;radio&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;two&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;Two&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;picked&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;two&quot;</span>&gt;</span>Two<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"选择器\"><a href=\"#选择器\" class=\"headerlink\" title=\"选择器\"></a>选择器</h3><p>单个：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>Selected: &#123;&#123; selected &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;selected&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">disabled</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span>Please select one<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">option</span>&gt;</span>A<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">option</span>&gt;</span>B<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">option</span>&gt;</span>C<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>多个（将值绑定到数组上）：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>Selected: &#123;&#123; selected &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;selected&quot;</span> <span class=\"attr\">multiple</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">option</span>&gt;</span>A<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">option</span>&gt;</span>B<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">option</span>&gt;</span>C<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"修饰符\"><a href=\"#修饰符\" class=\"headerlink\" title=\"修饰符\"></a>修饰符</h2><h3 id=\"lazy\"><a href=\"#lazy\" class=\"headerlink\" title=\".lazy\"></a>.lazy</h3><p>.lazy 修饰符表示在 “change” 事件而不是 “input” 事件触发时更新：</p>\n<p>这意味着数据将在失去焦点后才会同步到视图中，而不是每次输入时都同步。可以用于减少输入框频繁更新视图的情况，尤其是在处理大量输入时可以提高性能。</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">v-model.lazy</span>=<span class=\"string\">&quot;msg&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"number\"><a href=\"#number\" class=\"headerlink\" title=\".number\"></a>.number</h3><p>让用户输入自动转换为数字，如果该值无法被 parseFloat() 处理，则将返回原始值。</p>\n<p>number 修饰符会在输入框有 type&#x3D;”number” 时自动启用。</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">v-model.lazy</span>=<span class=\"string\">&quot;msg&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"trim\"><a href=\"#trim\" class=\"headerlink\" title=\".trim\"></a>.trim</h3><p>默认自动去除用户输入内容中两端的空格：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">v-model.trim</span>=<span class=\"string\">&quot;msg&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"基础\"><a href=\"#基础\" class=\"headerlink\" title=\"基础\"></a>基础</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:value</span>=<span class=\"string\">&quot;text&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    @<span class=\"attr\">input</span>=<span class=\"string\">&quot;event =&gt; text = event.target.value&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>用 v-model 简化：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;text&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"类型\"><a href=\"#类型\" class=\"headerlink\" title=\"类型\"></a>类型</h2><h3 id=\"单行\"><a href=\"#单行\" class=\"headerlink\" title=\"单行\"></a>单行</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;message&quot;</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">&quot;edit&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"多行\"><a href=\"#多行\" class=\"headerlink\" title=\"多行\"></a>多行</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">textarea</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;message&quot;</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">&quot;edit&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">textarea</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"复选框\"><a href=\"#复选框\" class=\"headerlink\" title=\"复选框\"></a>复选框</h3><p>label 标签 for 属性的作用：用户点击 label 标签时，浏览器会将焦点转移到与 for 属性值相匹配的表单控件上，从而提高表单的可访问性和易用性。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>Checked names: &#123;&#123; checkedNames &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;jack&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;Jack&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;checkedNames&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;jack&quot;</span>&gt;</span>Jack<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;john&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;John&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;checkedNames&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;john&quot;</span>&gt;</span>John<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;mike&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;Mike&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;checkedNames&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;mike&quot;</span>&gt;</span>Mike<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"单选\"><a href=\"#单选\" class=\"headerlink\" title=\"单选\"></a>单选</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>Picked: &#123;&#123; picked &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;radio&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;one&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;One&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;picked&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;one&quot;</span>&gt;</span>One<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;radio&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;two&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;Two&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;picked&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;two&quot;</span>&gt;</span>Two<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"选择器\"><a href=\"#选择器\" class=\"headerlink\" title=\"选择器\"></a>选择器</h3><p>单个：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>Selected: &#123;&#123; selected &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;selected&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">disabled</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span>Please select one<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">option</span>&gt;</span>A<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">option</span>&gt;</span>B<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">option</span>&gt;</span>C<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>多个（将值绑定到数组上）：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>Selected: &#123;&#123; selected &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;selected&quot;</span> <span class=\"attr\">multiple</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">option</span>&gt;</span>A<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">option</span>&gt;</span>B<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">option</span>&gt;</span>C<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"修饰符\"><a href=\"#修饰符\" class=\"headerlink\" title=\"修饰符\"></a>修饰符</h2><h3 id=\"lazy\"><a href=\"#lazy\" class=\"headerlink\" title=\".lazy\"></a>.lazy</h3><p>.lazy 修饰符表示在 “change” 事件而不是 “input” 事件触发时更新：</p>\n<p>这意味着数据将在失去焦点后才会同步到视图中，而不是每次输入时都同步。可以用于减少输入框频繁更新视图的情况，尤其是在处理大量输入时可以提高性能。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">v-model.lazy</span>=<span class=\"string\">&quot;msg&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"number\"><a href=\"#number\" class=\"headerlink\" title=\".number\"></a>.number</h3><p>让用户输入自动转换为数字，如果该值无法被 parseFloat() 处理，则将返回原始值。</p>\n<p>number 修饰符会在输入框有 type&#x3D;”number” 时自动启用。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">v-model.lazy</span>=<span class=\"string\">&quot;msg&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"trim\"><a href=\"#trim\" class=\"headerlink\" title=\".trim\"></a>.trim</h3><p>默认自动去除用户输入内容中两端的空格：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">v-model.trim</span>=<span class=\"string\">&quot;msg&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"vue3 生命周期","date":"2023-12-05T03:14:09.000Z","_content":"\n## vue3 生命周期图示\n\n<img src=\"https://cn.vuejs.org/assets/lifecycle.16e4c08e.png\" />\n\n## 注册生命钩子\n\n### 用法\n\n``` html\n<script setup>\nimport { onMounted } from 'vue';\n\nonMounted(() => {\n    console.log('now mounted');\n});\n</script>\n```\n\n调用 onMounted 时，Vue 会自动将回调函数注册到当前正被初始化的组件实例上，所以该钩子应当被同步注册。\n\n这并不意味对 onMounted 的调用必须放在 setup() 或 ```<script setup>``` 内的词法上下文中。\n\nonMounted() 也可以在一个外部函数中调用，只要调用栈是同步的，且最终起源自 setup() 就可以。\n","source":"_posts/11-vue3生命周期.md","raw":"---\ntitle: vue3 生命周期\ndate: 2023-12-05 11:14:09\ntags:\n    - vue3\n    - vue\ncategories:\n    - vue3\n      - 文档\n---\n\n## vue3 生命周期图示\n\n<img src=\"https://cn.vuejs.org/assets/lifecycle.16e4c08e.png\" />\n\n## 注册生命钩子\n\n### 用法\n\n``` html\n<script setup>\nimport { onMounted } from 'vue';\n\nonMounted(() => {\n    console.log('now mounted');\n});\n</script>\n```\n\n调用 onMounted 时，Vue 会自动将回调函数注册到当前正被初始化的组件实例上，所以该钩子应当被同步注册。\n\n这并不意味对 onMounted 的调用必须放在 setup() 或 ```<script setup>``` 内的词法上下文中。\n\nonMounted() 也可以在一个外部函数中调用，只要调用栈是同步的，且最终起源自 setup() 就可以。\n","slug":"11-vue3生命周期","published":1,"updated":"2025-05-20T02:47:28.682Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu400076kpr7h945avy","content":"<h2 id=\"vue3-生命周期图示\"><a href=\"#vue3-生命周期图示\" class=\"headerlink\" title=\"vue3 生命周期图示\"></a>vue3 生命周期图示</h2><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://cn.vuejs.org/assets/lifecycle.16e4c08e.png\"\n                      \n                >\n\n<h2 id=\"注册生命钩子\"><a href=\"#注册生命钩子\" class=\"headerlink\" title=\"注册生命钩子\"></a>注册生命钩子</h2><h3 id=\"用法\"><a href=\"#用法\" class=\"headerlink\" title=\"用法\"></a>用法</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; onMounted &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">onMounted</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;now mounted&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>调用 onMounted 时，Vue 会自动将回调函数注册到当前正被初始化的组件实例上，所以该钩子应当被同步注册。</p>\n<p>这并不意味对 onMounted 的调用必须放在 setup() 或 <code>&lt;script setup&gt;</code> 内的词法上下文中。</p>\n<p>onMounted() 也可以在一个外部函数中调用，只要调用栈是同步的，且最终起源自 setup() 就可以。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"vue3-生命周期图示\"><a href=\"#vue3-生命周期图示\" class=\"headerlink\" title=\"vue3 生命周期图示\"></a>vue3 生命周期图示</h2><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://cn.vuejs.org/assets/lifecycle.16e4c08e.png\"\n                      \n                >\n\n<h2 id=\"注册生命钩子\"><a href=\"#注册生命钩子\" class=\"headerlink\" title=\"注册生命钩子\"></a>注册生命钩子</h2><h3 id=\"用法\"><a href=\"#用法\" class=\"headerlink\" title=\"用法\"></a>用法</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; onMounted &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">onMounted</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;now mounted&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>调用 onMounted 时，Vue 会自动将回调函数注册到当前正被初始化的组件实例上，所以该钩子应当被同步注册。</p>\n<p>这并不意味对 onMounted 的调用必须放在 setup() 或 <code>&lt;script setup&gt;</code> 内的词法上下文中。</p>\n<p>onMounted() 也可以在一个外部函数中调用，只要调用栈是同步的，且最终起源自 setup() 就可以。</p>\n","_processedHighlight":true},{"title":"vue3 侦听器","date":"2023-12-07T10:22:34.000Z","_content":"\n## 基本用法\n\n``` html\n<script setup>\nimport { ref, watch } from 'vue';\n\nconst initVal = ref('');\n\nwatch(initVal, (newVal, oldVal) => {\n    ...\n});\n</script>\n```\n\n## 侦听数据源类型\n\nref（包括计算属性 computed）、响应式对象、getter 函数、多个数据源组成的数组\n\n``` js\nconst x = ref(0), y = ref(0);\n\n// ref\nwatch(x, (newX) => {\n    console.log(`x is ${newX}`);\n});\n\n// getter 函数\nwatch(\n    () => x.value + y.value,\n    (sum) => {\n        console.log(`sum is ${sum}`);\n    }\n);\n\n// 多个数据源组成的数组\nwatch(\n    [x, () => y.value],\n    ([newX, newY], [oldX, oldY]) => {\n        console.log(`x is ${newX} y is ${newY}`);\n    }\n);\n```\n\n## 侦听响应式对象的属性值\n\n不能直接监听响应式对象的属性值，而是使用返回该属性的 getter 函数\n\n``` js\nconst obj = reactive({ count: 0 });\n\n// 错误，因为 obj.count 是一个 number\nwatch(obj.count, () => {\n    .console.log(`count is: ${count}`)\n});\n\n// 正确，使用一个 getter 函数\nwatch(\n    () => obj.count,\n    (count) => {\n      console.log(`count is: ${count}`)\n    }\n);\n```\n\n## 深层侦听器\n\n给 watch 传响应式对象，会隐式创建深层监听器\n\n``` js\nconst obj = reactive({ count: 0 });\n\nwatch(obj, (newVal, oldVal) => {\n    ...\n});\n\nobj.count++; // 属性变更时触发\n```\n\n返回一个响应对象的 getter 函数，只在返回不同对象时才会触发回调\n\n``` js\nwatch(\n    () => source.obj,\n    () => {\n        ... // 仅当 test.obj 被替换时触发\n    }\n);\n```\n\n可以显示添加 deep，转为深层侦听器\n\n``` js\nwatch(\n    () => source.obj,\n    () => {\n        ... // 仅当 test.obj 被替换时触发\n    },\n    { deep: true }\n);\n```\n\n## 创建时立即执行的侦听器\n\n创建侦听器时，立即执行\n\n``` js\nwatch(source, \n    (newVal, oldVal) => {}, \n    { immediate: true });\n```\n","source":"_posts/12-vue3侦听器.md","raw":"---\ntitle: vue3 侦听器\ndate: 2023-12-07 18:22:34\ntags:\n    - vue3\n    - vue\ncategories:\n    - vue3\n      - 文档\n---\n\n## 基本用法\n\n``` html\n<script setup>\nimport { ref, watch } from 'vue';\n\nconst initVal = ref('');\n\nwatch(initVal, (newVal, oldVal) => {\n    ...\n});\n</script>\n```\n\n## 侦听数据源类型\n\nref（包括计算属性 computed）、响应式对象、getter 函数、多个数据源组成的数组\n\n``` js\nconst x = ref(0), y = ref(0);\n\n// ref\nwatch(x, (newX) => {\n    console.log(`x is ${newX}`);\n});\n\n// getter 函数\nwatch(\n    () => x.value + y.value,\n    (sum) => {\n        console.log(`sum is ${sum}`);\n    }\n);\n\n// 多个数据源组成的数组\nwatch(\n    [x, () => y.value],\n    ([newX, newY], [oldX, oldY]) => {\n        console.log(`x is ${newX} y is ${newY}`);\n    }\n);\n```\n\n## 侦听响应式对象的属性值\n\n不能直接监听响应式对象的属性值，而是使用返回该属性的 getter 函数\n\n``` js\nconst obj = reactive({ count: 0 });\n\n// 错误，因为 obj.count 是一个 number\nwatch(obj.count, () => {\n    .console.log(`count is: ${count}`)\n});\n\n// 正确，使用一个 getter 函数\nwatch(\n    () => obj.count,\n    (count) => {\n      console.log(`count is: ${count}`)\n    }\n);\n```\n\n## 深层侦听器\n\n给 watch 传响应式对象，会隐式创建深层监听器\n\n``` js\nconst obj = reactive({ count: 0 });\n\nwatch(obj, (newVal, oldVal) => {\n    ...\n});\n\nobj.count++; // 属性变更时触发\n```\n\n返回一个响应对象的 getter 函数，只在返回不同对象时才会触发回调\n\n``` js\nwatch(\n    () => source.obj,\n    () => {\n        ... // 仅当 test.obj 被替换时触发\n    }\n);\n```\n\n可以显示添加 deep，转为深层侦听器\n\n``` js\nwatch(\n    () => source.obj,\n    () => {\n        ... // 仅当 test.obj 被替换时触发\n    },\n    { deep: true }\n);\n```\n\n## 创建时立即执行的侦听器\n\n创建侦听器时，立即执行\n\n``` js\nwatch(source, \n    (newVal, oldVal) => {}, \n    { immediate: true });\n```\n","slug":"12-vue3侦听器","published":1,"updated":"2025-05-20T02:47:28.682Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu400086kprgqazh7xs","content":"<h2 id=\"基本用法\"><a href=\"#基本用法\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h2><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref, watch &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> initVal = <span class=\"title function_\">ref</span>(<span class=\"string\">&#x27;&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">watch</span>(initVal, <span class=\"function\">(<span class=\"params\">newVal, oldVal</span>) =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    ...</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"侦听数据源类型\"><a href=\"#侦听数据源类型\" class=\"headerlink\" title=\"侦听数据源类型\"></a>侦听数据源类型</h2><p>ref（包括计算属性 computed）、响应式对象、getter 函数、多个数据源组成的数组</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> x = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>), y = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ref</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(x, <span class=\"function\">(<span class=\"params\">newX</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`x is <span class=\"subst\">$&#123;newX&#125;</span>`</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// getter 函数</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(</span><br><span class=\"line\">    <span class=\"function\">() =&gt;</span> x.<span class=\"property\">value</span> + y.<span class=\"property\">value</span>,</span><br><span class=\"line\">    <span class=\"function\">(<span class=\"params\">sum</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`sum is <span class=\"subst\">$&#123;sum&#125;</span>`</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 多个数据源组成的数组</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(</span><br><span class=\"line\">    [x, <span class=\"function\">() =&gt;</span> y.<span class=\"property\">value</span>],</span><br><span class=\"line\">    <span class=\"function\">(<span class=\"params\">[newX, newY], [oldX, oldY]</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`x is <span class=\"subst\">$&#123;newX&#125;</span> y is <span class=\"subst\">$&#123;newY&#125;</span>`</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"侦听响应式对象的属性值\"><a href=\"#侦听响应式对象的属性值\" class=\"headerlink\" title=\"侦听响应式对象的属性值\"></a>侦听响应式对象的属性值</h2><p>不能直接监听响应式对象的属性值，而是使用返回该属性的 getter 函数</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> obj = <span class=\"title function_\">reactive</span>(&#123; <span class=\"attr\">count</span>: <span class=\"number\">0</span> &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 错误，因为 obj.count 是一个 number</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(obj.<span class=\"property\">count</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    .<span class=\"property\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`count is: <span class=\"subst\">$&#123;count&#125;</span>`</span>)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 正确，使用一个 getter 函数</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(</span><br><span class=\"line\">    <span class=\"function\">() =&gt;</span> obj.<span class=\"property\">count</span>,</span><br><span class=\"line\">    <span class=\"function\">(<span class=\"params\">count</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`count is: <span class=\"subst\">$&#123;count&#125;</span>`</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"深层侦听器\"><a href=\"#深层侦听器\" class=\"headerlink\" title=\"深层侦听器\"></a>深层侦听器</h2><p>给 watch 传响应式对象，会隐式创建深层监听器</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> obj = <span class=\"title function_\">reactive</span>(&#123; <span class=\"attr\">count</span>: <span class=\"number\">0</span> &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(obj, <span class=\"function\">(<span class=\"params\">newVal, oldVal</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">obj.<span class=\"property\">count</span>++; <span class=\"comment\">// 属性变更时触发</span></span><br></pre></td></tr></table></figure></div>\n\n<p>返回一个响应对象的 getter 函数，只在返回不同对象时才会触发回调</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">watch</span>(</span><br><span class=\"line\">    <span class=\"function\">() =&gt;</span> source.<span class=\"property\">obj</span>,</span><br><span class=\"line\">    <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        ... <span class=\"comment\">// 仅当 test.obj 被替换时触发</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure></div>\n\n<p>可以显示添加 deep，转为深层侦听器</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">watch</span>(</span><br><span class=\"line\">    <span class=\"function\">() =&gt;</span> source.<span class=\"property\">obj</span>,</span><br><span class=\"line\">    <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        ... <span class=\"comment\">// 仅当 test.obj 被替换时触发</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123; <span class=\"attr\">deep</span>: <span class=\"literal\">true</span> &#125;</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"创建时立即执行的侦听器\"><a href=\"#创建时立即执行的侦听器\" class=\"headerlink\" title=\"创建时立即执行的侦听器\"></a>创建时立即执行的侦听器</h2><p>创建侦听器时，立即执行</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">watch</span>(source, </span><br><span class=\"line\">    <span class=\"function\">(<span class=\"params\">newVal, oldVal</span>) =&gt;</span> &#123;&#125;, </span><br><span class=\"line\">    &#123; <span class=\"attr\">immediate</span>: <span class=\"literal\">true</span> &#125;);</span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"基本用法\"><a href=\"#基本用法\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref, watch &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> initVal = <span class=\"title function_\">ref</span>(<span class=\"string\">&#x27;&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">watch</span>(initVal, <span class=\"function\">(<span class=\"params\">newVal, oldVal</span>) =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    ...</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"侦听数据源类型\"><a href=\"#侦听数据源类型\" class=\"headerlink\" title=\"侦听数据源类型\"></a>侦听数据源类型</h2><p>ref（包括计算属性 computed）、响应式对象、getter 函数、多个数据源组成的数组</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> x = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>), y = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ref</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(x, <span class=\"function\">(<span class=\"params\">newX</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`x is <span class=\"subst\">$&#123;newX&#125;</span>`</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// getter 函数</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(</span><br><span class=\"line\">    <span class=\"function\">() =&gt;</span> x.<span class=\"property\">value</span> + y.<span class=\"property\">value</span>,</span><br><span class=\"line\">    <span class=\"function\">(<span class=\"params\">sum</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`sum is <span class=\"subst\">$&#123;sum&#125;</span>`</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 多个数据源组成的数组</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(</span><br><span class=\"line\">    [x, <span class=\"function\">() =&gt;</span> y.<span class=\"property\">value</span>],</span><br><span class=\"line\">    <span class=\"function\">(<span class=\"params\">[newX, newY], [oldX, oldY]</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`x is <span class=\"subst\">$&#123;newX&#125;</span> y is <span class=\"subst\">$&#123;newY&#125;</span>`</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"侦听响应式对象的属性值\"><a href=\"#侦听响应式对象的属性值\" class=\"headerlink\" title=\"侦听响应式对象的属性值\"></a>侦听响应式对象的属性值</h2><p>不能直接监听响应式对象的属性值，而是使用返回该属性的 getter 函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> obj = <span class=\"title function_\">reactive</span>(&#123; <span class=\"attr\">count</span>: <span class=\"number\">0</span> &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 错误，因为 obj.count 是一个 number</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(obj.<span class=\"property\">count</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    .<span class=\"property\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`count is: <span class=\"subst\">$&#123;count&#125;</span>`</span>)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 正确，使用一个 getter 函数</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(</span><br><span class=\"line\">    <span class=\"function\">() =&gt;</span> obj.<span class=\"property\">count</span>,</span><br><span class=\"line\">    <span class=\"function\">(<span class=\"params\">count</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`count is: <span class=\"subst\">$&#123;count&#125;</span>`</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"深层侦听器\"><a href=\"#深层侦听器\" class=\"headerlink\" title=\"深层侦听器\"></a>深层侦听器</h2><p>给 watch 传响应式对象，会隐式创建深层监听器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> obj = <span class=\"title function_\">reactive</span>(&#123; <span class=\"attr\">count</span>: <span class=\"number\">0</span> &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(obj, <span class=\"function\">(<span class=\"params\">newVal, oldVal</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">obj.<span class=\"property\">count</span>++; <span class=\"comment\">// 属性变更时触发</span></span><br></pre></td></tr></table></figure>\n\n<p>返回一个响应对象的 getter 函数，只在返回不同对象时才会触发回调</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">watch</span>(</span><br><span class=\"line\">    <span class=\"function\">() =&gt;</span> source.<span class=\"property\">obj</span>,</span><br><span class=\"line\">    <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        ... <span class=\"comment\">// 仅当 test.obj 被替换时触发</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>可以显示添加 deep，转为深层侦听器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">watch</span>(</span><br><span class=\"line\">    <span class=\"function\">() =&gt;</span> source.<span class=\"property\">obj</span>,</span><br><span class=\"line\">    <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        ... <span class=\"comment\">// 仅当 test.obj 被替换时触发</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123; <span class=\"attr\">deep</span>: <span class=\"literal\">true</span> &#125;</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建时立即执行的侦听器\"><a href=\"#创建时立即执行的侦听器\" class=\"headerlink\" title=\"创建时立即执行的侦听器\"></a>创建时立即执行的侦听器</h2><p>创建侦听器时，立即执行</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">watch</span>(source, </span><br><span class=\"line\">    <span class=\"function\">(<span class=\"params\">newVal, oldVal</span>) =&gt;</span> &#123;&#125;, </span><br><span class=\"line\">    &#123; <span class=\"attr\">immediate</span>: <span class=\"literal\">true</span> &#125;);</span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"vue3 模板引用","date":"2023-12-08T10:22:28.000Z","_content":"\n## 基础\n\n``` html\n<input ref=\"myInput\" />\n\n<script setup>\n    import { ref, onMounted } from 'vue';\n\n    const myInput = ref(null); // 必须和模版中的 ref 同名\n    \n    onMounted(() => {\n        myInput.value.focus(); // 自动聚焦\n    });\n</script>\n```\n\n只能在组件挂载后访问模板引用，因为初次渲染时模板引用为 null\n\n比如：\n\n``` js\nwatchEffect(() => {\n  if (input.value) {\n    input.value.focus()\n  } else {\n    // 此时还未挂载，或此元素已卸载（例如 v-if=false）\n  }\n})\n```\n\n## 列表引用\n\n``` html\n<script setup>\nimport { ref, onMounted } from 'vue';\n\nconst list = ref([\n    /* ... */\n]);\nconst itemRefs = ref([]);\nonMounted(() => {\n    console.log(itemRefs.value);\n});\n</script>\n\n<template>\n    <ul>\n        <li v-for=\"item in list\" ref=\"itemRefs\">{{ item }}</li>\n    </ul>\n</template>\n```\n\n## 函数模板引用\n\n每次组件更新时会调用 handleRef：\n\n``` html\n<input :ref=\"handleRef(el)\" />\n\n<script setup>\nconst handleRef = (el) => {\n    /*  将 el 赋给 ref 变量 */\n};\n</script>\n```\n\n## 组件上的 ref\n\n引用获得的值是组件实例：\n\n``` html\n<script setup>\nimport { ref, onMounted } from 'vue';\nimport Child from './Child.vue';\n\nconst child = ref(null);\nonMounted(() => {\n    // child.value 是 <Child/> 组件实例\n});\n</script>\n\n<template>\n    <Child ref=\"child\" />\n</template>\n```\n\n### 父组件对子组件访问权\n\n#### 1. 选项式 API 或 不使用 ```<script setup>```\n\n父组件对子组件的所有属性和方法有完全的访问权（大多情况下应使用 props 和 emit）。\n\n#### 2. 使用 ```<script setup>```\n\n子组件默认私有，除非子组件在其中通过 defineExpose 宏显示暴露。\n\n```html\n<script setup>\nimport { ref } from 'vue';\n\nconst a = 1, b = ref(2);\n\n// 编译器宏无需导入\ndefineExpose({\n    a,\n    b\n});\n</script>\n```\n","source":"_posts/13-vue3模板引用.md","raw":"---\ntitle: vue3 模板引用\ndate: 2023-12-08 18:22:28\ntags:\n    - vue3\n    - vue\ncategories:\n    - vue3\n      - 文档\n---\n\n## 基础\n\n``` html\n<input ref=\"myInput\" />\n\n<script setup>\n    import { ref, onMounted } from 'vue';\n\n    const myInput = ref(null); // 必须和模版中的 ref 同名\n    \n    onMounted(() => {\n        myInput.value.focus(); // 自动聚焦\n    });\n</script>\n```\n\n只能在组件挂载后访问模板引用，因为初次渲染时模板引用为 null\n\n比如：\n\n``` js\nwatchEffect(() => {\n  if (input.value) {\n    input.value.focus()\n  } else {\n    // 此时还未挂载，或此元素已卸载（例如 v-if=false）\n  }\n})\n```\n\n## 列表引用\n\n``` html\n<script setup>\nimport { ref, onMounted } from 'vue';\n\nconst list = ref([\n    /* ... */\n]);\nconst itemRefs = ref([]);\nonMounted(() => {\n    console.log(itemRefs.value);\n});\n</script>\n\n<template>\n    <ul>\n        <li v-for=\"item in list\" ref=\"itemRefs\">{{ item }}</li>\n    </ul>\n</template>\n```\n\n## 函数模板引用\n\n每次组件更新时会调用 handleRef：\n\n``` html\n<input :ref=\"handleRef(el)\" />\n\n<script setup>\nconst handleRef = (el) => {\n    /*  将 el 赋给 ref 变量 */\n};\n</script>\n```\n\n## 组件上的 ref\n\n引用获得的值是组件实例：\n\n``` html\n<script setup>\nimport { ref, onMounted } from 'vue';\nimport Child from './Child.vue';\n\nconst child = ref(null);\nonMounted(() => {\n    // child.value 是 <Child/> 组件实例\n});\n</script>\n\n<template>\n    <Child ref=\"child\" />\n</template>\n```\n\n### 父组件对子组件访问权\n\n#### 1. 选项式 API 或 不使用 ```<script setup>```\n\n父组件对子组件的所有属性和方法有完全的访问权（大多情况下应使用 props 和 emit）。\n\n#### 2. 使用 ```<script setup>```\n\n子组件默认私有，除非子组件在其中通过 defineExpose 宏显示暴露。\n\n```html\n<script setup>\nimport { ref } from 'vue';\n\nconst a = 1, b = ref(2);\n\n// 编译器宏无需导入\ndefineExpose({\n    a,\n    b\n});\n</script>\n```\n","slug":"13-vue3模板引用","published":1,"updated":"2025-05-20T02:47:28.682Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu400096kpr6tzu5owl","content":"<h2 id=\"基础\"><a href=\"#基础\" class=\"headerlink\" title=\"基础\"></a>基础</h2><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;myInput&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">import</span> &#123; ref, onMounted &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">const</span> myInput = <span class=\"title function_\">ref</span>(<span class=\"literal\">null</span>); <span class=\"comment\">// 必须和模版中的 ref 同名</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    </span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">onMounted</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        myInput.<span class=\"property\">value</span>.<span class=\"title function_\">focus</span>(); <span class=\"comment\">// 自动聚焦</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>只能在组件挂载后访问模板引用，因为初次渲染时模板引用为 null</p>\n<p>比如：</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">watchEffect</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (input.<span class=\"property\">value</span>) &#123;</span><br><span class=\"line\">    input.<span class=\"property\">value</span>.<span class=\"title function_\">focus</span>()</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 此时还未挂载，或此元素已卸载（例如 v-if=false）</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"列表引用\"><a href=\"#列表引用\" class=\"headerlink\" title=\"列表引用\"></a>列表引用</h2><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref, onMounted &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> list = <span class=\"title function_\">ref</span>([</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">/* ... */</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> itemRefs = <span class=\"title function_\">ref</span>([]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">onMounted</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(itemRefs.<span class=\"property\">value</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;item in list&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;itemRefs&quot;</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"函数模板引用\"><a href=\"#函数模板引用\" class=\"headerlink\" title=\"函数模板引用\"></a>函数模板引用</h2><p>每次组件更新时会调用 handleRef：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">:ref</span>=<span class=\"string\">&quot;handleRef(el)&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> <span class=\"title function_\">handleRef</span> = (<span class=\"params\">el</span>) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">/*  将 el 赋给 ref 变量 */</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"组件上的-ref\"><a href=\"#组件上的-ref\" class=\"headerlink\" title=\"组件上的 ref\"></a>组件上的 ref</h2><p>引用获得的值是组件实例：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref, onMounted &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">Child</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./Child.vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> child = <span class=\"title function_\">ref</span>(<span class=\"literal\">null</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">onMounted</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">// child.value 是 &lt;Child/&gt; 组件实例</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Child</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;child&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"父组件对子组件访问权\"><a href=\"#父组件对子组件访问权\" class=\"headerlink\" title=\"父组件对子组件访问权\"></a>父组件对子组件访问权</h3><h4 id=\"1-选项式-API-或-不使用\"><a href=\"#1-选项式-API-或-不使用\" class=\"headerlink\" title=\"1. 选项式 API 或 不使用 &lt;script setup&gt;\"></a>1. 选项式 API 或 不使用 <code>&lt;script setup&gt;</code></h4><p>父组件对子组件的所有属性和方法有完全的访问权（大多情况下应使用 props 和 emit）。</p>\n<h4 id=\"2-使用\"><a href=\"#2-使用\" class=\"headerlink\" title=\"2. 使用 &lt;script setup&gt;\"></a>2. 使用 <code>&lt;script setup&gt;</code></h4><p>子组件默认私有，除非子组件在其中通过 defineExpose 宏显示暴露。</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> a = <span class=\"number\">1</span>, b = <span class=\"title function_\">ref</span>(<span class=\"number\">2</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"comment\">// 编译器宏无需导入</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineExpose</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    a,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    b</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"基础\"><a href=\"#基础\" class=\"headerlink\" title=\"基础\"></a>基础</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;myInput&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">import</span> &#123; ref, onMounted &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">const</span> myInput = <span class=\"title function_\">ref</span>(<span class=\"literal\">null</span>); <span class=\"comment\">// 必须和模版中的 ref 同名</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    </span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">onMounted</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        myInput.<span class=\"property\">value</span>.<span class=\"title function_\">focus</span>(); <span class=\"comment\">// 自动聚焦</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>只能在组件挂载后访问模板引用，因为初次渲染时模板引用为 null</p>\n<p>比如：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">watchEffect</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (input.<span class=\"property\">value</span>) &#123;</span><br><span class=\"line\">    input.<span class=\"property\">value</span>.<span class=\"title function_\">focus</span>()</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 此时还未挂载，或此元素已卸载（例如 v-if=false）</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"列表引用\"><a href=\"#列表引用\" class=\"headerlink\" title=\"列表引用\"></a>列表引用</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref, onMounted &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> list = <span class=\"title function_\">ref</span>([</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">/* ... */</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> itemRefs = <span class=\"title function_\">ref</span>([]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">onMounted</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(itemRefs.<span class=\"property\">value</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;item in list&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;itemRefs&quot;</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"函数模板引用\"><a href=\"#函数模板引用\" class=\"headerlink\" title=\"函数模板引用\"></a>函数模板引用</h2><p>每次组件更新时会调用 handleRef：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">:ref</span>=<span class=\"string\">&quot;handleRef(el)&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> <span class=\"title function_\">handleRef</span> = (<span class=\"params\">el</span>) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">/*  将 el 赋给 ref 变量 */</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"组件上的-ref\"><a href=\"#组件上的-ref\" class=\"headerlink\" title=\"组件上的 ref\"></a>组件上的 ref</h2><p>引用获得的值是组件实例：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref, onMounted &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">Child</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./Child.vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> child = <span class=\"title function_\">ref</span>(<span class=\"literal\">null</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">onMounted</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">// child.value 是 &lt;Child/&gt; 组件实例</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Child</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;child&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"父组件对子组件访问权\"><a href=\"#父组件对子组件访问权\" class=\"headerlink\" title=\"父组件对子组件访问权\"></a>父组件对子组件访问权</h3><h4 id=\"1-选项式-API-或-不使用\"><a href=\"#1-选项式-API-或-不使用\" class=\"headerlink\" title=\"1. 选项式 API 或 不使用 &lt;script setup&gt;\"></a>1. 选项式 API 或 不使用 <code>&lt;script setup&gt;</code></h4><p>父组件对子组件的所有属性和方法有完全的访问权（大多情况下应使用 props 和 emit）。</p>\n<h4 id=\"2-使用\"><a href=\"#2-使用\" class=\"headerlink\" title=\"2. 使用 &lt;script setup&gt;\"></a>2. 使用 <code>&lt;script setup&gt;</code></h4><p>子组件默认私有，除非子组件在其中通过 defineExpose 宏显示暴露。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> a = <span class=\"number\">1</span>, b = <span class=\"title function_\">ref</span>(<span class=\"number\">2</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"comment\">// 编译器宏无需导入</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineExpose</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    a,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    b</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"vue3 组件基础","date":"2023-12-11T10:35:48.000Z","_content":"\n## 基础\n\n### 父传子\n\ndefineProps 是仅在 ```<script setup>``` 中可用的编译宏命令\n\n``` html\n<script setup>\ndefineProps(['title', 'content']);\n</script>\n\n<template>{{ title }}{{ content }}</template>\n```\n\n### 子传父\n\ndefineEmits 是仅在 ```<script setup>``` 中可用的编译宏命令\n\n``` html\n<script setup>\nconst emit = defineEmits('enlarge-text');\n\nemit('enlarg-text'); // 抛出事件\n</script>\n```\n\n## slot 插槽\n\n子组件：\n\n``` html\n<template>\n    <div class=\"child\">\n        <span>123</span>\n        <slot />\n    </div>\n</template>\n```\n\n父组件：\n\n``` html\n<template>\n    <child-component>\n        <span>hahaha<span>\n    </child-component>\n</template>\n```\n\n子组件渲染结果为：\n\n``` html\n<template>\n    <div class=\"child\">\n        <span>123</span>\n        <span>hahaha</span>\n    </div>\n</template>\n```\n\n## 子组件标签\n\n### 子组件有关闭标签\n\n父组件可以子组件传递 slot 内容\n\n``` html\n<my-component></my-component>\n```\n\n### 子组件无关闭标签\n\n父组件无法向子组件传递 slot 内容\n\n``` html\n<my-component />\n```\n\n## 动态组件\n\n通过 component 组件，和 :is 属性切换动态组件\n\n``` html\n<template>\n    <!-- 点击切换 tab -->\n    <button v-for=\"tab in tabs\" @click=\"curTab = tab\">\n       {{ tab }}\n    </button>\n    <!-- 动态组件 -->\n   <component :is=\"tabs[curTab]\"></component>\n</template>\n\n<script setup>\nimport Home from './Home.vue';\nimport Posts from './Posts.vue';\nimport Archive from './Archive.vue';\nimport { ref } from 'vue';\n\nconst curTab = ref('Home'); // 初始展示 Home 组件\n\nconst tabs = {\n    Home,\n    Posts,\n    Archive\n};\n</script>\n```\n\n## 元素位置限制\n\n某些元素对于放在其中的元素类型有限制：```<ul>, <ol>, <table>, <select>```\n\n某些元素仅在特定元素中才会显示：```<li>, <tr>, <option>```\n\n``` html\n<table>\n    <!-- 自定组件在 <table> 中不生效 -->\n    <post-row></post-row>\n</table>\n```\n\n解决方案（使用 is 属性）：\n\n``` html\n<table>\n    <tr is=\"vue:post-row\"></tr>\n</table>\n```\n","source":"_posts/14-vue3组件基础.md","raw":"---\ntitle: vue3 组件基础\ndate: 2023-12-11 18:35:48\ntags:\n    - vue3\n    - vue\ncategories:\n    - vue3\n      - 文档\n---\n\n## 基础\n\n### 父传子\n\ndefineProps 是仅在 ```<script setup>``` 中可用的编译宏命令\n\n``` html\n<script setup>\ndefineProps(['title', 'content']);\n</script>\n\n<template>{{ title }}{{ content }}</template>\n```\n\n### 子传父\n\ndefineEmits 是仅在 ```<script setup>``` 中可用的编译宏命令\n\n``` html\n<script setup>\nconst emit = defineEmits('enlarge-text');\n\nemit('enlarg-text'); // 抛出事件\n</script>\n```\n\n## slot 插槽\n\n子组件：\n\n``` html\n<template>\n    <div class=\"child\">\n        <span>123</span>\n        <slot />\n    </div>\n</template>\n```\n\n父组件：\n\n``` html\n<template>\n    <child-component>\n        <span>hahaha<span>\n    </child-component>\n</template>\n```\n\n子组件渲染结果为：\n\n``` html\n<template>\n    <div class=\"child\">\n        <span>123</span>\n        <span>hahaha</span>\n    </div>\n</template>\n```\n\n## 子组件标签\n\n### 子组件有关闭标签\n\n父组件可以子组件传递 slot 内容\n\n``` html\n<my-component></my-component>\n```\n\n### 子组件无关闭标签\n\n父组件无法向子组件传递 slot 内容\n\n``` html\n<my-component />\n```\n\n## 动态组件\n\n通过 component 组件，和 :is 属性切换动态组件\n\n``` html\n<template>\n    <!-- 点击切换 tab -->\n    <button v-for=\"tab in tabs\" @click=\"curTab = tab\">\n       {{ tab }}\n    </button>\n    <!-- 动态组件 -->\n   <component :is=\"tabs[curTab]\"></component>\n</template>\n\n<script setup>\nimport Home from './Home.vue';\nimport Posts from './Posts.vue';\nimport Archive from './Archive.vue';\nimport { ref } from 'vue';\n\nconst curTab = ref('Home'); // 初始展示 Home 组件\n\nconst tabs = {\n    Home,\n    Posts,\n    Archive\n};\n</script>\n```\n\n## 元素位置限制\n\n某些元素对于放在其中的元素类型有限制：```<ul>, <ol>, <table>, <select>```\n\n某些元素仅在特定元素中才会显示：```<li>, <tr>, <option>```\n\n``` html\n<table>\n    <!-- 自定组件在 <table> 中不生效 -->\n    <post-row></post-row>\n</table>\n```\n\n解决方案（使用 is 属性）：\n\n``` html\n<table>\n    <tr is=\"vue:post-row\"></tr>\n</table>\n```\n","slug":"14-vue3组件基础","published":1,"updated":"2025-05-20T02:47:28.682Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu5000c6kpr0mi2bxee","content":"<h2 id=\"基础\"><a href=\"#基础\" class=\"headerlink\" title=\"基础\"></a>基础</h2><h3 id=\"父传子\"><a href=\"#父传子\" class=\"headerlink\" title=\"父传子\"></a>父传子</h3><p>defineProps 是仅在 <code>&lt;script setup&gt;</code> 中可用的编译宏命令</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineProps</span>([<span class=\"string\">&#x27;title&#x27;</span>, <span class=\"string\">&#x27;content&#x27;</span>]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span>&#123;&#123; title &#125;&#125;&#123;&#123; content &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"子传父\"><a href=\"#子传父\" class=\"headerlink\" title=\"子传父\"></a>子传父</h3><p>defineEmits 是仅在 <code>&lt;script setup&gt;</code> 中可用的编译宏命令</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> emit = <span class=\"title function_\">defineEmits</span>(<span class=\"string\">&#x27;enlarge-text&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">emit</span>(<span class=\"string\">&#x27;enlarg-text&#x27;</span>); <span class=\"comment\">// 抛出事件</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"slot-插槽\"><a href=\"#slot-插槽\" class=\"headerlink\" title=\"slot 插槽\"></a>slot 插槽</h2><p>子组件：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;child&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>123<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">slot</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>父组件：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">child-component</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>hahaha<span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">child-component</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>子组件渲染结果为：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;child&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>123<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>hahaha<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"子组件标签\"><a href=\"#子组件标签\" class=\"headerlink\" title=\"子组件标签\"></a>子组件标签</h2><h3 id=\"子组件有关闭标签\"><a href=\"#子组件有关闭标签\" class=\"headerlink\" title=\"子组件有关闭标签\"></a>子组件有关闭标签</h3><p>父组件可以子组件传递 slot 内容</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">my-component</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">my-component</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"子组件无关闭标签\"><a href=\"#子组件无关闭标签\" class=\"headerlink\" title=\"子组件无关闭标签\"></a>子组件无关闭标签</h3><p>父组件无法向子组件传递 slot 内容</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">my-component</span> /&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"动态组件\"><a href=\"#动态组件\" class=\"headerlink\" title=\"动态组件\"></a>动态组件</h2><p>通过 component 组件，和 :is 属性切换动态组件</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 点击切换 tab --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;tab in tabs&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;curTab = tab&quot;</span>&gt;</span></span><br><span class=\"line\">       &#123;&#123; tab &#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 动态组件 --&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">component</span> <span class=\"attr\">:is</span>=<span class=\"string\">&quot;tabs[curTab]&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">component</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">Home</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./Home.vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">Posts</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./Posts.vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">Archive</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./Archive.vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> curTab = <span class=\"title function_\">ref</span>(<span class=\"string\">&#x27;Home&#x27;</span>); <span class=\"comment\">// 初始展示 Home 组件</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> tabs = &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title class_\">Home</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title class_\">Posts</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title class_\">Archive</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"元素位置限制\"><a href=\"#元素位置限制\" class=\"headerlink\" title=\"元素位置限制\"></a>元素位置限制</h2><p>某些元素对于放在其中的元素类型有限制：<code>&lt;ul&gt;, &lt;ol&gt;, &lt;table&gt;, &lt;select&gt;</code></p>\n<p>某些元素仅在特定元素中才会显示：<code>&lt;li&gt;, &lt;tr&gt;, &lt;option&gt;</code></p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 自定组件在 &lt;table&gt; 中不生效 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">post-row</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">post-row</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>解决方案（使用 is 属性）：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">tr</span> <span class=\"attr\">is</span>=<span class=\"string\">&quot;vue:post-row&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"基础\"><a href=\"#基础\" class=\"headerlink\" title=\"基础\"></a>基础</h2><h3 id=\"父传子\"><a href=\"#父传子\" class=\"headerlink\" title=\"父传子\"></a>父传子</h3><p>defineProps 是仅在 <code>&lt;script setup&gt;</code> 中可用的编译宏命令</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineProps</span>([<span class=\"string\">&#x27;title&#x27;</span>, <span class=\"string\">&#x27;content&#x27;</span>]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span>&#123;&#123; title &#125;&#125;&#123;&#123; content &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"子传父\"><a href=\"#子传父\" class=\"headerlink\" title=\"子传父\"></a>子传父</h3><p>defineEmits 是仅在 <code>&lt;script setup&gt;</code> 中可用的编译宏命令</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> emit = <span class=\"title function_\">defineEmits</span>(<span class=\"string\">&#x27;enlarge-text&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">emit</span>(<span class=\"string\">&#x27;enlarg-text&#x27;</span>); <span class=\"comment\">// 抛出事件</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"slot-插槽\"><a href=\"#slot-插槽\" class=\"headerlink\" title=\"slot 插槽\"></a>slot 插槽</h2><p>子组件：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;child&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>123<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">slot</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>父组件：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">child-component</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>hahaha<span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">child-component</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>子组件渲染结果为：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;child&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>123<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>hahaha<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"子组件标签\"><a href=\"#子组件标签\" class=\"headerlink\" title=\"子组件标签\"></a>子组件标签</h2><h3 id=\"子组件有关闭标签\"><a href=\"#子组件有关闭标签\" class=\"headerlink\" title=\"子组件有关闭标签\"></a>子组件有关闭标签</h3><p>父组件可以子组件传递 slot 内容</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">my-component</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">my-component</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"子组件无关闭标签\"><a href=\"#子组件无关闭标签\" class=\"headerlink\" title=\"子组件无关闭标签\"></a>子组件无关闭标签</h3><p>父组件无法向子组件传递 slot 内容</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">my-component</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"动态组件\"><a href=\"#动态组件\" class=\"headerlink\" title=\"动态组件\"></a>动态组件</h2><p>通过 component 组件，和 :is 属性切换动态组件</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 点击切换 tab --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;tab in tabs&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;curTab = tab&quot;</span>&gt;</span></span><br><span class=\"line\">       &#123;&#123; tab &#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 动态组件 --&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">component</span> <span class=\"attr\">:is</span>=<span class=\"string\">&quot;tabs[curTab]&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">component</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">Home</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./Home.vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">Posts</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./Posts.vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">Archive</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./Archive.vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> curTab = <span class=\"title function_\">ref</span>(<span class=\"string\">&#x27;Home&#x27;</span>); <span class=\"comment\">// 初始展示 Home 组件</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> tabs = &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title class_\">Home</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title class_\">Posts</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title class_\">Archive</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"元素位置限制\"><a href=\"#元素位置限制\" class=\"headerlink\" title=\"元素位置限制\"></a>元素位置限制</h2><p>某些元素对于放在其中的元素类型有限制：<code>&lt;ul&gt;, &lt;ol&gt;, &lt;table&gt;, &lt;select&gt;</code></p>\n<p>某些元素仅在特定元素中才会显示：<code>&lt;li&gt;, &lt;tr&gt;, &lt;option&gt;</code></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 自定组件在 &lt;table&gt; 中不生效 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">post-row</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">post-row</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>解决方案（使用 is 属性）：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">tr</span> <span class=\"attr\">is</span>=<span class=\"string\">&quot;vue:post-row&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"vue3 组件注册","date":"2023-12-13T07:16:29.000Z","_content":"\n## 全局注册\n\n所有子组件可以使用全局注册的组件。\n\n使用 vue 应用实例的 .component() 方法：\n\n``` js\nimport { createApp } from 'vue';\nconst app = createApp({});\n\napp.component('myComponent',{\n    // 组件的实现\n});\n```\n\n对于单文件组件：\n\n``` js\nimport MyComponent from './App.vue'\n\napp.component('MyComponent', MyComponent);\n```\n\n链式：\n\n``` js\napp.\n    component('ComponentA', ComponentA).\n    component('ComponentB', ComponentB).\n    component('ComponentC', ComponentC);\n```\n\n## 局部注册\n\n### 优点\n\n1. tree-shaking：全局注册的组件，即使不用，也会出现在打包后的 JS 文件中；而局部注册会移除未使用的组件。\n2. 依赖关系明确：全局注册使大型项目中组件的依赖关系不够明确；而局部组件使组件间的依赖关系更加明确。\n","source":"_posts/15-vue3组件注册.md","raw":"---\ntitle: vue3 组件注册\ndate: 2023-12-13 15:16:29\ntags:\n    - vue3\n    - vue\ncategories:\n    - vue3\n      - 文档\n---\n\n## 全局注册\n\n所有子组件可以使用全局注册的组件。\n\n使用 vue 应用实例的 .component() 方法：\n\n``` js\nimport { createApp } from 'vue';\nconst app = createApp({});\n\napp.component('myComponent',{\n    // 组件的实现\n});\n```\n\n对于单文件组件：\n\n``` js\nimport MyComponent from './App.vue'\n\napp.component('MyComponent', MyComponent);\n```\n\n链式：\n\n``` js\napp.\n    component('ComponentA', ComponentA).\n    component('ComponentB', ComponentB).\n    component('ComponentC', ComponentC);\n```\n\n## 局部注册\n\n### 优点\n\n1. tree-shaking：全局注册的组件，即使不用，也会出现在打包后的 JS 文件中；而局部注册会移除未使用的组件。\n2. 依赖关系明确：全局注册使大型项目中组件的依赖关系不够明确；而局部组件使组件间的依赖关系更加明确。\n","slug":"15-vue3组件注册","published":1,"updated":"2025-05-20T02:47:28.682Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu5000d6kpr8bnlek9i","content":"<h2 id=\"全局注册\"><a href=\"#全局注册\" class=\"headerlink\" title=\"全局注册\"></a>全局注册</h2><p>所有子组件可以使用全局注册的组件。</p>\n<p>使用 vue 应用实例的 .component() 方法：</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createApp &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"title function_\">createApp</span>(&#123;&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">component</span>(<span class=\"string\">&#x27;myComponent&#x27;</span>,&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 组件的实现</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></div>\n\n<p>对于单文件组件：</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">MyComponent</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./App.vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">component</span>(<span class=\"string\">&#x27;MyComponent&#x27;</span>, <span class=\"title class_\">MyComponent</span>);</span><br></pre></td></tr></table></figure></div>\n\n<p>链式：</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.</span><br><span class=\"line\">    <span class=\"title function_\">component</span>(<span class=\"string\">&#x27;ComponentA&#x27;</span>, <span class=\"title class_\">ComponentA</span>).</span><br><span class=\"line\">    <span class=\"title function_\">component</span>(<span class=\"string\">&#x27;ComponentB&#x27;</span>, <span class=\"title class_\">ComponentB</span>).</span><br><span class=\"line\">    <span class=\"title function_\">component</span>(<span class=\"string\">&#x27;ComponentC&#x27;</span>, <span class=\"title class_\">ComponentC</span>);</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"局部注册\"><a href=\"#局部注册\" class=\"headerlink\" title=\"局部注册\"></a>局部注册</h2><h3 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h3><ol>\n<li>tree-shaking：全局注册的组件，即使不用，也会出现在打包后的 JS 文件中；而局部注册会移除未使用的组件。</li>\n<li>依赖关系明确：全局注册使大型项目中组件的依赖关系不够明确；而局部组件使组件间的依赖关系更加明确。</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"全局注册\"><a href=\"#全局注册\" class=\"headerlink\" title=\"全局注册\"></a>全局注册</h2><p>所有子组件可以使用全局注册的组件。</p>\n<p>使用 vue 应用实例的 .component() 方法：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createApp &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"title function_\">createApp</span>(&#123;&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">component</span>(<span class=\"string\">&#x27;myComponent&#x27;</span>,&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 组件的实现</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>对于单文件组件：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">MyComponent</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./App.vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">component</span>(<span class=\"string\">&#x27;MyComponent&#x27;</span>, <span class=\"title class_\">MyComponent</span>);</span><br></pre></td></tr></table></figure>\n\n<p>链式：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.</span><br><span class=\"line\">    <span class=\"title function_\">component</span>(<span class=\"string\">&#x27;ComponentA&#x27;</span>, <span class=\"title class_\">ComponentA</span>).</span><br><span class=\"line\">    <span class=\"title function_\">component</span>(<span class=\"string\">&#x27;ComponentB&#x27;</span>, <span class=\"title class_\">ComponentB</span>).</span><br><span class=\"line\">    <span class=\"title function_\">component</span>(<span class=\"string\">&#x27;ComponentC&#x27;</span>, <span class=\"title class_\">ComponentC</span>);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"局部注册\"><a href=\"#局部注册\" class=\"headerlink\" title=\"局部注册\"></a>局部注册</h2><h3 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h3><ol>\n<li>tree-shaking：全局注册的组件，即使不用，也会出现在打包后的 JS 文件中；而局部注册会移除未使用的组件。</li>\n<li>依赖关系明确：全局注册使大型项目中组件的依赖关系不够明确；而局部组件使组件间的依赖关系更加明确。</li>\n</ol>\n","_processedHighlight":true},{"title":"vue3 props & emits","date":"2023-12-15T12:26:11.000Z","_content":"\n## props\n\n注意：props 为单向数据流，从父组件流子组件，所以不应该在子组件中修改 props。\n\n如有需要：\n\n1. 用另一个属性接收该 prop 的初始值；\n2. 基于该 prop 定义一个计算属性；\n3. 向父组件抛出一个事件。\n\n### 声明\n\n使用字符串数组：\n\n``` html\n<script setup>\nconst props = defineProps(['foo']);\n</script>\n```\n\n使用对象：\n\n``` html\n<script setup>\nconst props = defineProps({\n    title: String,\n    likes: Number\n});\n</script>\n```\n\n### 静态 prop\n\n除了静态字符串，都应该使用变量进行传递。\n\n``` html\n<BlogPost title=\"this is a title\" />\n\n<!-- <BlogPost :likes=\"42\" /> -->\n<BlogPost :likes=\"post.likes\" />\n\n<!-- <BlogPost is-published=\"true\" /> -->\n<BlogPost :is-published=\"post.isPublished\" />\n\n<!-- <BlogPost ids=\"[1, 2, 3]\" /> -->\n<BlogPost :ids=\"post.ids\" />\n\n<!-- <BlogPost author=\"{ name: 'Zoella', age: 22 }\" /> -->\n<BlogPost :author=\"post.author\" />\n```\n\n### 一个对象绑定多个 prop\n\n使用无参数的 v-bind，而不是 :prop-name\n\n``` js\nconst post = {\n    id: 1,\n    title: \"this is title\",\n};\n```\n\n``` html\n<BlogPost v-bind=\"post\" />\n```\n\n### prop 校验\n\n``` js\ndefineProps({\n  // 多种可能的类型检查（给出 `null` 和 `undefined` 值则会跳过任何类型检查）\n  propA: [String, Number],\n  // 必传，且为 String 类型，默认值为 'defualtVal'\n  propB: {\n    type: String,\n    required: true,\n    default: 'defaultVal'\n  },\n  // 对象类型的默认值\n  propC: {\n    type: Object,\n    // 对象或数组的默认值，必须从一个工厂函数返回。\n    // 该函数接收组件所接收的原始 prop 作为参数。\n    default(rawProps) {\n      return { message: 'hello' }\n    }\n  },\n  // 自定义类型校验函数\n  propD: {\n    validator(value) {\n      return ['success', 'warning', 'danger'].includes(value)\n    }\n  },\n  // 函数类型的默认值\n  propE: {\n    type: Function,\n    default() {\n      return 'Default function'\n    }\n  }\n});\n```\n\n### Boolean 类型转换\n\n``` js\ndefineProps({\n  disabled: Boolean\n});\n```\n\n使用时：\n\n``` html\n<!-- 等同于 <MyComponent :disabled=\"true\"></MyComponent> -->\n<MyComponent disabled></MyComponent>\n\n<!-- 等同于 <MyComponent :disabled=\"false\"></MyComponent> -->\n<MyComponent></MyComponent>\n```\n\n## emit\n\n### 事件校验\n\n``` html\n<script setup>\nconst emit = defineEmits({\n  // 无校验\n  click: null,\n\n  // 校验 submit 事件\n  submit: ({ email, password }) => {\n    if (email && password) {\n      return true;\n    } else {\n      console.warn('Invalid submit event payload!')\n      return false;\n    }\n  }\n});\n\nfunction submitForm(email, password) {\n  // 抛出 submit 事件，携带 email, password 参数\n  emit('submit', { email, password });\n}\n</script>\n```\n","source":"_posts/16-vue3 props & emits.md","raw":"---\ntitle: vue3 props & emits\ndate: 2023-12-15 20:26:11\ntags:\n    - vue3\n    - vue\ncategories:\n    - vue3\n      - 文档\n---\n\n## props\n\n注意：props 为单向数据流，从父组件流子组件，所以不应该在子组件中修改 props。\n\n如有需要：\n\n1. 用另一个属性接收该 prop 的初始值；\n2. 基于该 prop 定义一个计算属性；\n3. 向父组件抛出一个事件。\n\n### 声明\n\n使用字符串数组：\n\n``` html\n<script setup>\nconst props = defineProps(['foo']);\n</script>\n```\n\n使用对象：\n\n``` html\n<script setup>\nconst props = defineProps({\n    title: String,\n    likes: Number\n});\n</script>\n```\n\n### 静态 prop\n\n除了静态字符串，都应该使用变量进行传递。\n\n``` html\n<BlogPost title=\"this is a title\" />\n\n<!-- <BlogPost :likes=\"42\" /> -->\n<BlogPost :likes=\"post.likes\" />\n\n<!-- <BlogPost is-published=\"true\" /> -->\n<BlogPost :is-published=\"post.isPublished\" />\n\n<!-- <BlogPost ids=\"[1, 2, 3]\" /> -->\n<BlogPost :ids=\"post.ids\" />\n\n<!-- <BlogPost author=\"{ name: 'Zoella', age: 22 }\" /> -->\n<BlogPost :author=\"post.author\" />\n```\n\n### 一个对象绑定多个 prop\n\n使用无参数的 v-bind，而不是 :prop-name\n\n``` js\nconst post = {\n    id: 1,\n    title: \"this is title\",\n};\n```\n\n``` html\n<BlogPost v-bind=\"post\" />\n```\n\n### prop 校验\n\n``` js\ndefineProps({\n  // 多种可能的类型检查（给出 `null` 和 `undefined` 值则会跳过任何类型检查）\n  propA: [String, Number],\n  // 必传，且为 String 类型，默认值为 'defualtVal'\n  propB: {\n    type: String,\n    required: true,\n    default: 'defaultVal'\n  },\n  // 对象类型的默认值\n  propC: {\n    type: Object,\n    // 对象或数组的默认值，必须从一个工厂函数返回。\n    // 该函数接收组件所接收的原始 prop 作为参数。\n    default(rawProps) {\n      return { message: 'hello' }\n    }\n  },\n  // 自定义类型校验函数\n  propD: {\n    validator(value) {\n      return ['success', 'warning', 'danger'].includes(value)\n    }\n  },\n  // 函数类型的默认值\n  propE: {\n    type: Function,\n    default() {\n      return 'Default function'\n    }\n  }\n});\n```\n\n### Boolean 类型转换\n\n``` js\ndefineProps({\n  disabled: Boolean\n});\n```\n\n使用时：\n\n``` html\n<!-- 等同于 <MyComponent :disabled=\"true\"></MyComponent> -->\n<MyComponent disabled></MyComponent>\n\n<!-- 等同于 <MyComponent :disabled=\"false\"></MyComponent> -->\n<MyComponent></MyComponent>\n```\n\n## emit\n\n### 事件校验\n\n``` html\n<script setup>\nconst emit = defineEmits({\n  // 无校验\n  click: null,\n\n  // 校验 submit 事件\n  submit: ({ email, password }) => {\n    if (email && password) {\n      return true;\n    } else {\n      console.warn('Invalid submit event payload!')\n      return false;\n    }\n  }\n});\n\nfunction submitForm(email, password) {\n  // 抛出 submit 事件，携带 email, password 参数\n  emit('submit', { email, password });\n}\n</script>\n```\n","slug":"16-vue3 props & emits","published":1,"updated":"2025-05-20T02:47:28.682Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu5000i6kprbi1g1ln2","content":"<h2 id=\"props\"><a href=\"#props\" class=\"headerlink\" title=\"props\"></a>props</h2><p>注意：props 为单向数据流，从父组件流子组件，所以不应该在子组件中修改 props。</p>\n<p>如有需要：</p>\n<ol>\n<li>用另一个属性接收该 prop 的初始值；</li>\n<li>基于该 prop 定义一个计算属性；</li>\n<li>向父组件抛出一个事件。</li>\n</ol>\n<h3 id=\"声明\"><a href=\"#声明\" class=\"headerlink\" title=\"声明\"></a>声明</h3><p>使用字符串数组：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> props = <span class=\"title function_\">defineProps</span>([<span class=\"string\">&#x27;foo&#x27;</span>]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>使用对象：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> props = <span class=\"title function_\">defineProps</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">title</span>: <span class=\"title class_\">String</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">likes</span>: <span class=\"title class_\">Number</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"静态-prop\"><a href=\"#静态-prop\" class=\"headerlink\" title=\"静态 prop\"></a>静态 prop</h3><p>除了静态字符串，都应该使用变量进行传递。</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">BlogPost</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;this is a title&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- &lt;BlogPost :likes=&quot;42&quot; /&gt; --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">BlogPost</span> <span class=\"attr\">:likes</span>=<span class=\"string\">&quot;post.likes&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- &lt;BlogPost is-published=&quot;true&quot; /&gt; --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">BlogPost</span> <span class=\"attr\">:is-published</span>=<span class=\"string\">&quot;post.isPublished&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- &lt;BlogPost ids=&quot;[1, 2, 3]&quot; /&gt; --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">BlogPost</span> <span class=\"attr\">:ids</span>=<span class=\"string\">&quot;post.ids&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- &lt;BlogPost author=&quot;&#123; name: &#x27;Zoella&#x27;, age: 22 &#125;&quot; /&gt; --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">BlogPost</span> <span class=\"attr\">:author</span>=<span class=\"string\">&quot;post.author&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"一个对象绑定多个-prop\"><a href=\"#一个对象绑定多个-prop\" class=\"headerlink\" title=\"一个对象绑定多个 prop\"></a>一个对象绑定多个 prop</h3><p>使用无参数的 v-bind，而不是 :prop-name</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> post = &#123;</span><br><span class=\"line\">    <span class=\"attr\">id</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"string\">&quot;this is title&quot;</span>,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">BlogPost</span> <span class=\"attr\">v-bind</span>=<span class=\"string\">&quot;post&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"prop-校验\"><a href=\"#prop-校验\" class=\"headerlink\" title=\"prop 校验\"></a>prop 校验</h3><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">defineProps</span>(&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 多种可能的类型检查（给出 `null` 和 `undefined` 值则会跳过任何类型检查）</span></span><br><span class=\"line\">  <span class=\"attr\">propA</span>: [<span class=\"title class_\">String</span>, <span class=\"title class_\">Number</span>],</span><br><span class=\"line\">  <span class=\"comment\">// 必传，且为 String 类型，默认值为 &#x27;defualtVal&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">propB</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>,</span><br><span class=\"line\">    <span class=\"attr\">required</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">default</span>: <span class=\"string\">&#x27;defaultVal&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// 对象类型的默认值</span></span><br><span class=\"line\">  <span class=\"attr\">propC</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"title class_\">Object</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 对象或数组的默认值，必须从一个工厂函数返回。</span></span><br><span class=\"line\">    <span class=\"comment\">// 该函数接收组件所接收的原始 prop 作为参数。</span></span><br><span class=\"line\">    <span class=\"title function_\">default</span>(<span class=\"params\">rawProps</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;hello&#x27;</span> &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// 自定义类型校验函数</span></span><br><span class=\"line\">  <span class=\"attr\">propD</span>: &#123;</span><br><span class=\"line\">    <span class=\"title function_\">validator</span>(<span class=\"params\">value</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> [<span class=\"string\">&#x27;success&#x27;</span>, <span class=\"string\">&#x27;warning&#x27;</span>, <span class=\"string\">&#x27;danger&#x27;</span>].<span class=\"title function_\">includes</span>(value)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// 函数类型的默认值</span></span><br><span class=\"line\">  <span class=\"attr\">propE</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"title class_\">Function</span>,</span><br><span class=\"line\">    <span class=\"title function_\">default</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Default function&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"Boolean-类型转换\"><a href=\"#Boolean-类型转换\" class=\"headerlink\" title=\"Boolean 类型转换\"></a>Boolean 类型转换</h3><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">defineProps</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">disabled</span>: <span class=\"title class_\">Boolean</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></div>\n\n<p>使用时：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 等同于 &lt;MyComponent :disabled=&quot;true&quot;&gt;&lt;/MyComponent&gt; --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">MyComponent</span> <span class=\"attr\">disabled</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">MyComponent</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 等同于 &lt;MyComponent :disabled=&quot;false&quot;&gt;&lt;/MyComponent&gt; --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">MyComponent</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">MyComponent</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"emit\"><a href=\"#emit\" class=\"headerlink\" title=\"emit\"></a>emit</h2><h3 id=\"事件校验\"><a href=\"#事件校验\" class=\"headerlink\" title=\"事件校验\"></a>事件校验</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> emit = <span class=\"title function_\">defineEmits</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// 无校验</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">click</span>: <span class=\"literal\">null</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// 校验 submit 事件</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">submit</span>: <span class=\"function\">(<span class=\"params\">&#123; email, password &#125;</span>) =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">if</span> (email &amp;&amp; password) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">warn</span>(<span class=\"string\">&#x27;Invalid submit event payload!&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">function</span> <span class=\"title function_\">submitForm</span>(<span class=\"params\">email, password</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// 抛出 submit 事件，携带 email, password 参数</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">emit</span>(<span class=\"string\">&#x27;submit&#x27;</span>, &#123; email, password &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"props\"><a href=\"#props\" class=\"headerlink\" title=\"props\"></a>props</h2><p>注意：props 为单向数据流，从父组件流子组件，所以不应该在子组件中修改 props。</p>\n<p>如有需要：</p>\n<ol>\n<li>用另一个属性接收该 prop 的初始值；</li>\n<li>基于该 prop 定义一个计算属性；</li>\n<li>向父组件抛出一个事件。</li>\n</ol>\n<h3 id=\"声明\"><a href=\"#声明\" class=\"headerlink\" title=\"声明\"></a>声明</h3><p>使用字符串数组：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> props = <span class=\"title function_\">defineProps</span>([<span class=\"string\">&#x27;foo&#x27;</span>]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>使用对象：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> props = <span class=\"title function_\">defineProps</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">title</span>: <span class=\"title class_\">String</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">likes</span>: <span class=\"title class_\">Number</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"静态-prop\"><a href=\"#静态-prop\" class=\"headerlink\" title=\"静态 prop\"></a>静态 prop</h3><p>除了静态字符串，都应该使用变量进行传递。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">BlogPost</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;this is a title&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- &lt;BlogPost :likes=&quot;42&quot; /&gt; --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">BlogPost</span> <span class=\"attr\">:likes</span>=<span class=\"string\">&quot;post.likes&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- &lt;BlogPost is-published=&quot;true&quot; /&gt; --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">BlogPost</span> <span class=\"attr\">:is-published</span>=<span class=\"string\">&quot;post.isPublished&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- &lt;BlogPost ids=&quot;[1, 2, 3]&quot; /&gt; --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">BlogPost</span> <span class=\"attr\">:ids</span>=<span class=\"string\">&quot;post.ids&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- &lt;BlogPost author=&quot;&#123; name: &#x27;Zoella&#x27;, age: 22 &#125;&quot; /&gt; --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">BlogPost</span> <span class=\"attr\">:author</span>=<span class=\"string\">&quot;post.author&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"一个对象绑定多个-prop\"><a href=\"#一个对象绑定多个-prop\" class=\"headerlink\" title=\"一个对象绑定多个 prop\"></a>一个对象绑定多个 prop</h3><p>使用无参数的 v-bind，而不是 :prop-name</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> post = &#123;</span><br><span class=\"line\">    <span class=\"attr\">id</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"string\">&quot;this is title&quot;</span>,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">BlogPost</span> <span class=\"attr\">v-bind</span>=<span class=\"string\">&quot;post&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"prop-校验\"><a href=\"#prop-校验\" class=\"headerlink\" title=\"prop 校验\"></a>prop 校验</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">defineProps</span>(&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 多种可能的类型检查（给出 `null` 和 `undefined` 值则会跳过任何类型检查）</span></span><br><span class=\"line\">  <span class=\"attr\">propA</span>: [<span class=\"title class_\">String</span>, <span class=\"title class_\">Number</span>],</span><br><span class=\"line\">  <span class=\"comment\">// 必传，且为 String 类型，默认值为 &#x27;defualtVal&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">propB</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"title class_\">String</span>,</span><br><span class=\"line\">    <span class=\"attr\">required</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">default</span>: <span class=\"string\">&#x27;defaultVal&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// 对象类型的默认值</span></span><br><span class=\"line\">  <span class=\"attr\">propC</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"title class_\">Object</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 对象或数组的默认值，必须从一个工厂函数返回。</span></span><br><span class=\"line\">    <span class=\"comment\">// 该函数接收组件所接收的原始 prop 作为参数。</span></span><br><span class=\"line\">    <span class=\"title function_\">default</span>(<span class=\"params\">rawProps</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123; <span class=\"attr\">message</span>: <span class=\"string\">&#x27;hello&#x27;</span> &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// 自定义类型校验函数</span></span><br><span class=\"line\">  <span class=\"attr\">propD</span>: &#123;</span><br><span class=\"line\">    <span class=\"title function_\">validator</span>(<span class=\"params\">value</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> [<span class=\"string\">&#x27;success&#x27;</span>, <span class=\"string\">&#x27;warning&#x27;</span>, <span class=\"string\">&#x27;danger&#x27;</span>].<span class=\"title function_\">includes</span>(value)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// 函数类型的默认值</span></span><br><span class=\"line\">  <span class=\"attr\">propE</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"title class_\">Function</span>,</span><br><span class=\"line\">    <span class=\"title function_\">default</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Default function&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Boolean-类型转换\"><a href=\"#Boolean-类型转换\" class=\"headerlink\" title=\"Boolean 类型转换\"></a>Boolean 类型转换</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">defineProps</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">disabled</span>: <span class=\"title class_\">Boolean</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>使用时：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 等同于 &lt;MyComponent :disabled=&quot;true&quot;&gt;&lt;/MyComponent&gt; --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">MyComponent</span> <span class=\"attr\">disabled</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">MyComponent</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 等同于 &lt;MyComponent :disabled=&quot;false&quot;&gt;&lt;/MyComponent&gt; --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">MyComponent</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">MyComponent</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"emit\"><a href=\"#emit\" class=\"headerlink\" title=\"emit\"></a>emit</h2><h3 id=\"事件校验\"><a href=\"#事件校验\" class=\"headerlink\" title=\"事件校验\"></a>事件校验</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> emit = <span class=\"title function_\">defineEmits</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// 无校验</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">click</span>: <span class=\"literal\">null</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// 校验 submit 事件</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">submit</span>: <span class=\"function\">(<span class=\"params\">&#123; email, password &#125;</span>) =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">if</span> (email &amp;&amp; password) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">warn</span>(<span class=\"string\">&#x27;Invalid submit event payload!&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">function</span> <span class=\"title function_\">submitForm</span>(<span class=\"params\">email, password</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// 抛出 submit 事件，携带 email, password 参数</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">emit</span>(<span class=\"string\">&#x27;submit&#x27;</span>, &#123; email, password &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"vue3 组件 v-model","date":"2023-12-15T12:27:47.000Z","_content":"\n## 基础\n\n父组件：\n\n``` html\n<CustomInput v-model=\"searchText\" />\n\n<!-- 被展开为： -->\n<!-- <CustomInput\n    :model-value=\"searchText\"\n    @update:model-value=\"newValue => searchText = newValue\" /> -->\n```\n\n子组件：\n\n在引用的子组件中使用 v-model 指令时，子组件的 modelValue prop 默认用于传递输入值，并且会触发名为 update:modelValue 的事件来更新该属性。\n\n``` html\n\n<script setup>\n// 声明属性 modelValue，这是父组件通过 v-model 传给当前组件的 prop\ndefineProps(['modelValue']);\n// 声明事件 update:modelValue，用于在当前组件中触发父组件的更新操作\ndefineEmits(['update:modelValue']);\n</script>\n\n<template>\n  <!-- 将 modelValue 作为其值，并在输入时触发 update:modelValue 事件 -->\n  <input\n    :value=\"modelValue\"\n    @input=\"$emit('update:modelValue', $event.target.value)\"\n  />\n</template>\n```\n\n## 如何更改默认名 modelValue\n\n父组件：\n\n``` html\n<MyComponent v-model:title=\"bookTitle\" />\n```\n\n子组件：\n\n``` html\n<!-- MyComponent.vue -->\n<script setup>\ndefineProps(['title']);\ndefineEmits(['update:title']);\n</script>\n\n<template>\n  <input\n    type=\"text\"\n    :value=\"title\"\n    @input=\"$emit('update:title', $event.target.value)\"\n  />\n</template>\n```\n\n## 自定义 v-model 修饰符\n\n创建一个自定义修饰符 capitalize，自动将 v-model 绑定输入字符串的第一个字母转为大写：\n\n``` html\n<MyComponent v-model.capitalize=\"myText\" />\n```\n\n``` html\n<script setup>\n// modelModifiers prop 包含了 capitalize 且其值为 true\n// 因为它在模板中的 v-model 绑定 v-model.capitalize=\"myText\" 上被使用了\nconst props = defineProps({\n    modelValue: String,\n    modelModifiers: {\n        default: () => ({}) // 默认值为空对象\n    },\n});\n\ndefineEmits(['update:modelValue']);\n\n// 将首字母大写\nfunction emitValue(e) {\n    let value = e.target.value;\n    if(props.modelModifiers.captialize) {\n        value = value.charAt(0).toUpperCase() + value.slice(1);\n    }\n    emit('update:modelValue', value);\n}\n</script>\n\n<template>\n    <!-- 每次 <input /> 元素触发 input 事件时触发 emitValue -->\n    <input\n        type=\"text\"\n        :value=\"modelValue\"\n        @input=\"emitValue\"\n    />\n</template>\n```\n\n### 带多个不同参数的 v-model 修饰符\n\n``` html\n<UserName\n    v-model:first-name.capitalize=\"first\"\n    v-model:last-name.uppercase=\"last\"\n/>\n```\n\n``` html\n<script setup>\nconst props = defineProps({\n    firstName: String,\n    lastName: String,\n    firstNameModifiers: {  // firstName + Modifiers\n        default: () => ({}) \n    },\n    lastNameModifiers: {  // lastName + Modifiers\n        default: () => ({})\n    },\n});\n\ndefineEmits(['update:firstName', 'update:lastName']);\n\nconsole.log(props.firstNameModifiers); // { calitalize: true }\nconsole.log(props.lastNameModifiers); // { uppercase: true }\n</script>\n```\n","source":"_posts/17-vue3组件v-model.md","raw":"---\ntitle: vue3 组件 v-model\ndate: 2023-12-15 20:27:47\ntags:\n    - vue3\n    - vue\ncategories:\n    - vue3\n      - 文档\n---\n\n## 基础\n\n父组件：\n\n``` html\n<CustomInput v-model=\"searchText\" />\n\n<!-- 被展开为： -->\n<!-- <CustomInput\n    :model-value=\"searchText\"\n    @update:model-value=\"newValue => searchText = newValue\" /> -->\n```\n\n子组件：\n\n在引用的子组件中使用 v-model 指令时，子组件的 modelValue prop 默认用于传递输入值，并且会触发名为 update:modelValue 的事件来更新该属性。\n\n``` html\n\n<script setup>\n// 声明属性 modelValue，这是父组件通过 v-model 传给当前组件的 prop\ndefineProps(['modelValue']);\n// 声明事件 update:modelValue，用于在当前组件中触发父组件的更新操作\ndefineEmits(['update:modelValue']);\n</script>\n\n<template>\n  <!-- 将 modelValue 作为其值，并在输入时触发 update:modelValue 事件 -->\n  <input\n    :value=\"modelValue\"\n    @input=\"$emit('update:modelValue', $event.target.value)\"\n  />\n</template>\n```\n\n## 如何更改默认名 modelValue\n\n父组件：\n\n``` html\n<MyComponent v-model:title=\"bookTitle\" />\n```\n\n子组件：\n\n``` html\n<!-- MyComponent.vue -->\n<script setup>\ndefineProps(['title']);\ndefineEmits(['update:title']);\n</script>\n\n<template>\n  <input\n    type=\"text\"\n    :value=\"title\"\n    @input=\"$emit('update:title', $event.target.value)\"\n  />\n</template>\n```\n\n## 自定义 v-model 修饰符\n\n创建一个自定义修饰符 capitalize，自动将 v-model 绑定输入字符串的第一个字母转为大写：\n\n``` html\n<MyComponent v-model.capitalize=\"myText\" />\n```\n\n``` html\n<script setup>\n// modelModifiers prop 包含了 capitalize 且其值为 true\n// 因为它在模板中的 v-model 绑定 v-model.capitalize=\"myText\" 上被使用了\nconst props = defineProps({\n    modelValue: String,\n    modelModifiers: {\n        default: () => ({}) // 默认值为空对象\n    },\n});\n\ndefineEmits(['update:modelValue']);\n\n// 将首字母大写\nfunction emitValue(e) {\n    let value = e.target.value;\n    if(props.modelModifiers.captialize) {\n        value = value.charAt(0).toUpperCase() + value.slice(1);\n    }\n    emit('update:modelValue', value);\n}\n</script>\n\n<template>\n    <!-- 每次 <input /> 元素触发 input 事件时触发 emitValue -->\n    <input\n        type=\"text\"\n        :value=\"modelValue\"\n        @input=\"emitValue\"\n    />\n</template>\n```\n\n### 带多个不同参数的 v-model 修饰符\n\n``` html\n<UserName\n    v-model:first-name.capitalize=\"first\"\n    v-model:last-name.uppercase=\"last\"\n/>\n```\n\n``` html\n<script setup>\nconst props = defineProps({\n    firstName: String,\n    lastName: String,\n    firstNameModifiers: {  // firstName + Modifiers\n        default: () => ({}) \n    },\n    lastNameModifiers: {  // lastName + Modifiers\n        default: () => ({})\n    },\n});\n\ndefineEmits(['update:firstName', 'update:lastName']);\n\nconsole.log(props.firstNameModifiers); // { calitalize: true }\nconsole.log(props.lastNameModifiers); // { uppercase: true }\n</script>\n```\n","slug":"17-vue3组件v-model","published":1,"updated":"2025-05-20T02:47:28.682Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu6000l6kpr49a611m6","content":"<h2 id=\"基础\"><a href=\"#基础\" class=\"headerlink\" title=\"基础\"></a>基础</h2><p>父组件：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">CustomInput</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;searchText&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 被展开为： --&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- &lt;CustomInput</span></span><br><span class=\"line\"><span class=\"comment\">    :model-value=&quot;searchText&quot;</span></span><br><span class=\"line\"><span class=\"comment\">    @update:model-value=&quot;newValue =&gt; searchText = newValue&quot; /&gt; --&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>子组件：</p>\n<p>在引用的子组件中使用 v-model 指令时，子组件的 modelValue prop 默认用于传递输入值，并且会触发名为 update:modelValue 的事件来更新该属性。</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"comment\">// 声明属性 modelValue，这是父组件通过 v-model 传给当前组件的 prop</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineProps</span>([<span class=\"string\">&#x27;modelValue&#x27;</span>]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"comment\">// 声明事件 update:modelValue，用于在当前组件中触发父组件的更新操作</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineEmits</span>([<span class=\"string\">&#x27;update:modelValue&#x27;</span>]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- 将 modelValue 作为其值，并在输入时触发 update:modelValue 事件 --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:value</span>=<span class=\"string\">&quot;modelValue&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    @<span class=\"attr\">input</span>=<span class=\"string\">&quot;$emit(&#x27;update:modelValue&#x27;, $event.target.value)&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"如何更改默认名-modelValue\"><a href=\"#如何更改默认名-modelValue\" class=\"headerlink\" title=\"如何更改默认名 modelValue\"></a>如何更改默认名 modelValue</h2><p>父组件：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">MyComponent</span> <span class=\"attr\">v-model:title</span>=<span class=\"string\">&quot;bookTitle&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>子组件：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- MyComponent.vue --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineProps</span>([<span class=\"string\">&#x27;title&#x27;</span>]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineEmits</span>([<span class=\"string\">&#x27;update:title&#x27;</span>]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:value</span>=<span class=\"string\">&quot;title&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    @<span class=\"attr\">input</span>=<span class=\"string\">&quot;$emit(&#x27;update:title&#x27;, $event.target.value)&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"自定义-v-model-修饰符\"><a href=\"#自定义-v-model-修饰符\" class=\"headerlink\" title=\"自定义 v-model 修饰符\"></a>自定义 v-model 修饰符</h2><p>创建一个自定义修饰符 capitalize，自动将 v-model 绑定输入字符串的第一个字母转为大写：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">MyComponent</span> <span class=\"attr\">v-model.capitalize</span>=<span class=\"string\">&quot;myText&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"comment\">// modelModifiers prop 包含了 capitalize 且其值为 true</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"comment\">// 因为它在模板中的 v-model 绑定 v-model.capitalize=&quot;myText&quot; 上被使用了</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> props = <span class=\"title function_\">defineProps</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">modelValue</span>: <span class=\"title class_\">String</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">modelModifiers</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span> (&#123;&#125;) <span class=\"comment\">// 默认值为空对象</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineEmits</span>([<span class=\"string\">&#x27;update:modelValue&#x27;</span>]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"comment\">// 将首字母大写</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">function</span> <span class=\"title function_\">emitValue</span>(<span class=\"params\">e</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">let</span> value = e.<span class=\"property\">target</span>.<span class=\"property\">value</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">if</span>(props.<span class=\"property\">modelModifiers</span>.<span class=\"property\">captialize</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        value = value.<span class=\"title function_\">charAt</span>(<span class=\"number\">0</span>).<span class=\"title function_\">toUpperCase</span>() + value.<span class=\"title function_\">slice</span>(<span class=\"number\">1</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">emit</span>(<span class=\"string\">&#x27;update:modelValue&#x27;</span>, value);</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 每次 &lt;input /&gt; 元素触发 input 事件时触发 emitValue --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">:value</span>=<span class=\"string\">&quot;modelValue&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        @<span class=\"attr\">input</span>=<span class=\"string\">&quot;emitValue&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"带多个不同参数的-v-model-修饰符\"><a href=\"#带多个不同参数的-v-model-修饰符\" class=\"headerlink\" title=\"带多个不同参数的 v-model 修饰符\"></a>带多个不同参数的 v-model 修饰符</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">UserName</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">v-model:first-name.capitalize</span>=<span class=\"string\">&quot;first&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">v-model:last-name.uppercase</span>=<span class=\"string\">&quot;last&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">/&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> props = <span class=\"title function_\">defineProps</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">firstName</span>: <span class=\"title class_\">String</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">lastName</span>: <span class=\"title class_\">String</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">firstNameModifiers</span>: &#123;  <span class=\"comment\">// firstName + Modifiers</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span> (&#123;&#125;) </span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">lastNameModifiers</span>: &#123;  <span class=\"comment\">// lastName + Modifiers</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span> (&#123;&#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineEmits</span>([<span class=\"string\">&#x27;update:firstName&#x27;</span>, <span class=\"string\">&#x27;update:lastName&#x27;</span>]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(props.<span class=\"property\">firstNameModifiers</span>); <span class=\"comment\">// &#123; calitalize: true &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(props.<span class=\"property\">lastNameModifiers</span>); <span class=\"comment\">// &#123; uppercase: true &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"基础\"><a href=\"#基础\" class=\"headerlink\" title=\"基础\"></a>基础</h2><p>父组件：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">CustomInput</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;searchText&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 被展开为： --&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- &lt;CustomInput</span></span><br><span class=\"line\"><span class=\"comment\">    :model-value=&quot;searchText&quot;</span></span><br><span class=\"line\"><span class=\"comment\">    @update:model-value=&quot;newValue =&gt; searchText = newValue&quot; /&gt; --&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>子组件：</p>\n<p>在引用的子组件中使用 v-model 指令时，子组件的 modelValue prop 默认用于传递输入值，并且会触发名为 update:modelValue 的事件来更新该属性。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"comment\">// 声明属性 modelValue，这是父组件通过 v-model 传给当前组件的 prop</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineProps</span>([<span class=\"string\">&#x27;modelValue&#x27;</span>]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"comment\">// 声明事件 update:modelValue，用于在当前组件中触发父组件的更新操作</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineEmits</span>([<span class=\"string\">&#x27;update:modelValue&#x27;</span>]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- 将 modelValue 作为其值，并在输入时触发 update:modelValue 事件 --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:value</span>=<span class=\"string\">&quot;modelValue&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    @<span class=\"attr\">input</span>=<span class=\"string\">&quot;$emit(&#x27;update:modelValue&#x27;, $event.target.value)&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"如何更改默认名-modelValue\"><a href=\"#如何更改默认名-modelValue\" class=\"headerlink\" title=\"如何更改默认名 modelValue\"></a>如何更改默认名 modelValue</h2><p>父组件：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">MyComponent</span> <span class=\"attr\">v-model:title</span>=<span class=\"string\">&quot;bookTitle&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>子组件：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- MyComponent.vue --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineProps</span>([<span class=\"string\">&#x27;title&#x27;</span>]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineEmits</span>([<span class=\"string\">&#x27;update:title&#x27;</span>]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:value</span>=<span class=\"string\">&quot;title&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    @<span class=\"attr\">input</span>=<span class=\"string\">&quot;$emit(&#x27;update:title&#x27;, $event.target.value)&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"自定义-v-model-修饰符\"><a href=\"#自定义-v-model-修饰符\" class=\"headerlink\" title=\"自定义 v-model 修饰符\"></a>自定义 v-model 修饰符</h2><p>创建一个自定义修饰符 capitalize，自动将 v-model 绑定输入字符串的第一个字母转为大写：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">MyComponent</span> <span class=\"attr\">v-model.capitalize</span>=<span class=\"string\">&quot;myText&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"comment\">// modelModifiers prop 包含了 capitalize 且其值为 true</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"comment\">// 因为它在模板中的 v-model 绑定 v-model.capitalize=&quot;myText&quot; 上被使用了</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> props = <span class=\"title function_\">defineProps</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">modelValue</span>: <span class=\"title class_\">String</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">modelModifiers</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span> (&#123;&#125;) <span class=\"comment\">// 默认值为空对象</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineEmits</span>([<span class=\"string\">&#x27;update:modelValue&#x27;</span>]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"comment\">// 将首字母大写</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">function</span> <span class=\"title function_\">emitValue</span>(<span class=\"params\">e</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">let</span> value = e.<span class=\"property\">target</span>.<span class=\"property\">value</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">if</span>(props.<span class=\"property\">modelModifiers</span>.<span class=\"property\">captialize</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        value = value.<span class=\"title function_\">charAt</span>(<span class=\"number\">0</span>).<span class=\"title function_\">toUpperCase</span>() + value.<span class=\"title function_\">slice</span>(<span class=\"number\">1</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">emit</span>(<span class=\"string\">&#x27;update:modelValue&#x27;</span>, value);</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 每次 &lt;input /&gt; 元素触发 input 事件时触发 emitValue --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">:value</span>=<span class=\"string\">&quot;modelValue&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        @<span class=\"attr\">input</span>=<span class=\"string\">&quot;emitValue&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"带多个不同参数的-v-model-修饰符\"><a href=\"#带多个不同参数的-v-model-修饰符\" class=\"headerlink\" title=\"带多个不同参数的 v-model 修饰符\"></a>带多个不同参数的 v-model 修饰符</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">UserName</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">v-model:first-name.capitalize</span>=<span class=\"string\">&quot;first&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">v-model:last-name.uppercase</span>=<span class=\"string\">&quot;last&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">/&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> props = <span class=\"title function_\">defineProps</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">firstName</span>: <span class=\"title class_\">String</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">lastName</span>: <span class=\"title class_\">String</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">firstNameModifiers</span>: &#123;  <span class=\"comment\">// firstName + Modifiers</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span> (&#123;&#125;) </span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">lastNameModifiers</span>: &#123;  <span class=\"comment\">// lastName + Modifiers</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span> (&#123;&#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineEmits</span>([<span class=\"string\">&#x27;update:firstName&#x27;</span>, <span class=\"string\">&#x27;update:lastName&#x27;</span>]);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(props.<span class=\"property\">firstNameModifiers</span>); <span class=\"comment\">// &#123; calitalize: true &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(props.<span class=\"property\">lastNameModifiers</span>); <span class=\"comment\">// &#123; uppercase: true &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"vue3 继承 attributes","date":"2023-12-21T12:33:12.000Z","_content":"\n## 禁用 attributes 继承\n\n如果不想一个组件自动继承 attribute，可在组件选项中设置 ```inheritAttrs: false```\n\n``` html\n<script setup>\ndefineOptions({\n    inheritAttrs: false\n});\n</script>\n```\n\n透传进来的 attribute 可在模版的表达式中用 $attrs 访问：\n\n``` html\n<span>attribute: {{ $attrs }}</span>\n```\n\n### 示例\n\n常见的需要禁用 attribute 继承的场景是：attribute 需要应用在根节点以外的其他元素。\n\n比如：希望透传的 attribute 应用在内层的节点而非外层。\n\n``` html\n<div class='btn-wrapper'>\n    <button class='btn' v-bind=\"$attrs\">click me</button>\n</div>\n\n<script setup>\ndefineOptions({\n    inheritAttrs: false\n});\n</script>\n```\n\n## 多根节点的 attributes 继承\n\n需要显示绑定 $attrs，否则会有警告\n\n``` html\n<header>...</header>\n<main v-bind=\"$attrs\">...</main>\n<footer>...</footer>\n```\n\n## 在 JS 中访问透传的 attributes\n\n使用 useAttrs() API 访问组件的所有透传 attribute\n\n``` html\n<script setup>\nimport { useAttrs } from 'vue';\n\nconst attrs = useAttrs();\n</script>\n```\n\n但是这里的 attrs 对象不具有响应式，如有需要：\n\n（1）可使用 prop；\n\n（2）可使用 onUpdated() 在每次更新时获取最新的 attrs。\n","source":"_posts/18-vue3继承attributes.md","raw":"---\ntitle: vue3 继承 attributes\ndate: 2023-12-21 20:33:12\ntags:\n    - vue3\n    - vue\ncategories:\n    - vue3\n      - 文档\n---\n\n## 禁用 attributes 继承\n\n如果不想一个组件自动继承 attribute，可在组件选项中设置 ```inheritAttrs: false```\n\n``` html\n<script setup>\ndefineOptions({\n    inheritAttrs: false\n});\n</script>\n```\n\n透传进来的 attribute 可在模版的表达式中用 $attrs 访问：\n\n``` html\n<span>attribute: {{ $attrs }}</span>\n```\n\n### 示例\n\n常见的需要禁用 attribute 继承的场景是：attribute 需要应用在根节点以外的其他元素。\n\n比如：希望透传的 attribute 应用在内层的节点而非外层。\n\n``` html\n<div class='btn-wrapper'>\n    <button class='btn' v-bind=\"$attrs\">click me</button>\n</div>\n\n<script setup>\ndefineOptions({\n    inheritAttrs: false\n});\n</script>\n```\n\n## 多根节点的 attributes 继承\n\n需要显示绑定 $attrs，否则会有警告\n\n``` html\n<header>...</header>\n<main v-bind=\"$attrs\">...</main>\n<footer>...</footer>\n```\n\n## 在 JS 中访问透传的 attributes\n\n使用 useAttrs() API 访问组件的所有透传 attribute\n\n``` html\n<script setup>\nimport { useAttrs } from 'vue';\n\nconst attrs = useAttrs();\n</script>\n```\n\n但是这里的 attrs 对象不具有响应式，如有需要：\n\n（1）可使用 prop；\n\n（2）可使用 onUpdated() 在每次更新时获取最新的 attrs。\n","slug":"18-vue3继承attributes","published":1,"updated":"2025-05-20T02:47:28.682Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu6000p6kprfj01f2hy","content":"<h2 id=\"禁用-attributes-继承\"><a href=\"#禁用-attributes-继承\" class=\"headerlink\" title=\"禁用 attributes 继承\"></a>禁用 attributes 继承</h2><p>如果不想一个组件自动继承 attribute，可在组件选项中设置 <code>inheritAttrs: false</code></p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineOptions</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">inheritAttrs</span>: <span class=\"literal\">false</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>透传进来的 attribute 可在模版的表达式中用 $attrs 访问：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>attribute: &#123;&#123; $attrs &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h3><p>常见的需要禁用 attribute 继承的场景是：attribute 需要应用在根节点以外的其他元素。</p>\n<p>比如：希望透传的 attribute 应用在内层的节点而非外层。</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&#x27;btn-wrapper&#x27;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">class</span>=<span class=\"string\">&#x27;btn&#x27;</span> <span class=\"attr\">v-bind</span>=<span class=\"string\">&quot;$attrs&quot;</span>&gt;</span>click me<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineOptions</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">inheritAttrs</span>: <span class=\"literal\">false</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"多根节点的-attributes-继承\"><a href=\"#多根节点的-attributes-继承\" class=\"headerlink\" title=\"多根节点的 attributes 继承\"></a>多根节点的 attributes 继承</h2><p>需要显示绑定 $attrs，否则会有警告</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">header</span>&gt;</span>...<span class=\"tag\">&lt;/<span class=\"name\">header</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">main</span> <span class=\"attr\">v-bind</span>=<span class=\"string\">&quot;$attrs&quot;</span>&gt;</span>...<span class=\"tag\">&lt;/<span class=\"name\">main</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">footer</span>&gt;</span>...<span class=\"tag\">&lt;/<span class=\"name\">footer</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"在-JS-中访问透传的-attributes\"><a href=\"#在-JS-中访问透传的-attributes\" class=\"headerlink\" title=\"在 JS 中访问透传的 attributes\"></a>在 JS 中访问透传的 attributes</h2><p>使用 useAttrs() API 访问组件的所有透传 attribute</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; useAttrs &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> attrs = <span class=\"title function_\">useAttrs</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>但是这里的 attrs 对象不具有响应式，如有需要：</p>\n<p>（1）可使用 prop；</p>\n<p>（2）可使用 onUpdated() 在每次更新时获取最新的 attrs。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"禁用-attributes-继承\"><a href=\"#禁用-attributes-继承\" class=\"headerlink\" title=\"禁用 attributes 继承\"></a>禁用 attributes 继承</h2><p>如果不想一个组件自动继承 attribute，可在组件选项中设置 <code>inheritAttrs: false</code></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineOptions</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">inheritAttrs</span>: <span class=\"literal\">false</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>透传进来的 attribute 可在模版的表达式中用 $attrs 访问：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>attribute: &#123;&#123; $attrs &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h3><p>常见的需要禁用 attribute 继承的场景是：attribute 需要应用在根节点以外的其他元素。</p>\n<p>比如：希望透传的 attribute 应用在内层的节点而非外层。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&#x27;btn-wrapper&#x27;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">class</span>=<span class=\"string\">&#x27;btn&#x27;</span> <span class=\"attr\">v-bind</span>=<span class=\"string\">&quot;$attrs&quot;</span>&gt;</span>click me<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">defineOptions</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">inheritAttrs</span>: <span class=\"literal\">false</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"多根节点的-attributes-继承\"><a href=\"#多根节点的-attributes-继承\" class=\"headerlink\" title=\"多根节点的 attributes 继承\"></a>多根节点的 attributes 继承</h2><p>需要显示绑定 $attrs，否则会有警告</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">header</span>&gt;</span>...<span class=\"tag\">&lt;/<span class=\"name\">header</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">main</span> <span class=\"attr\">v-bind</span>=<span class=\"string\">&quot;$attrs&quot;</span>&gt;</span>...<span class=\"tag\">&lt;/<span class=\"name\">main</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">footer</span>&gt;</span>...<span class=\"tag\">&lt;/<span class=\"name\">footer</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"在-JS-中访问透传的-attributes\"><a href=\"#在-JS-中访问透传的-attributes\" class=\"headerlink\" title=\"在 JS 中访问透传的 attributes\"></a>在 JS 中访问透传的 attributes</h2><p>使用 useAttrs() API 访问组件的所有透传 attribute</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; useAttrs &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> attrs = <span class=\"title function_\">useAttrs</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>但是这里的 attrs 对象不具有响应式，如有需要：</p>\n<p>（1）可使用 prop；</p>\n<p>（2）可使用 onUpdated() 在每次更新时获取最新的 attrs。</p>\n","_processedHighlight":true},{"title":"vue 插槽","date":"2023-12-26T03:18:09.000Z","_content":"\n## 基础\n\n插槽内容可以为文本、模版、组件\n\n``` html\n<!-- 父组件 -->\n<FancyButton>\n  Click me! <!-- 插槽内容 -->\n</FancyButton>\n```\n\n``` html\n<!-- 子组件 -->\n<button class=\"fancy-btn\">\n  <slot></slot> <!-- 插槽出口 -->\n</button>\n```\n\n渲染结果：\n\n``` html\n<button class=\"fancy-btn\">Click me!</button>\n```\n\n## 默认内容\n\n子组件的 ```<slot></slot>``` 标签之间是默认值\n\n``` html\n<button type=\"submit\">\n  <slot>Submit</slot> <!-- 默认内容 -->\n</button>\n```\n\n## 具名插槽\n\n当一个组件包含多个插槽出口时，需要使用 name 来给各个插槽分配唯一的 ID，没有提供 name 的插槽会隐式地命名为“default”。\n\n``` html\n<!-- 子组件 -->\n<div class=\"container\">\n  <header>\n    <slot name=\"header\"></slot>\n  </header>\n  <main>\n    <slot></slot> <!-- name 为 default -->\n  </main>\n  <footer>\n    <slot name=\"footer\"></slot>\n  </footer>\n</div>\n```\n\n在父组件中，使用 v-slot 或者 # 加上插槽名，来指定插槽内容。\n\n``` html\n<!-- 父组件 -->\n<BaseLayout>\n  <template v-slot:header>\n    <!-- header 插槽的内容 -->\n  </template>\n  <template #footer>\n    <!-- footer 插槽的内容 -->\n  </template>\n</BaseLayout>\n```\n\n## 动态插槽名\n\n可定义动态插槽名：\n\n``` html\n<base-layout>\n  <template v-slot:[dynamicSlotName]>\n  </template>\n\n  <!-- 缩写 -->\n  <template #[dynamicSlotName]>\n    ...\n  </template>\n</base-layout>\n```\n\n## 作用域插槽\n\n可以向插槽出口传递 attributes\n\n### 默认插槽\n\n``` html\n<!-- 子组件 -->\n<div>\n    <slot :text=\"message\" :count=\"1\"></slot>\n</div>\n```\n\n``` html\n<!-- 父组件 -->\n<MyComponent v-slot=\"slotProps\">\n    {{ slotProps.text }} {{ slotProps.count }}\n</MyComponent>\n\n<!-- 或者 -->\n<MyComponent v-slot=\"{ text, count }\">\n    {{ text }} {{ count }}\n</MyComponent>\n```\n\n### 具名插槽\n\n``` html\n<!-- 父组件 -->\n<MyComponent>\n  <template #header=\"headerProps\">\n    {{ headerProps }}\n  </template>\n\n  <!-- 不缩写 -->\n  <template v-slot:default=\"defaultProps\">\n    {{ defaultProps }}\n  </template>\n\n  <template #footer=\"footerProps\">\n    {{ footerProps }}\n  </template>\n</MyComponent>\n```\n\n``` html\n<!-- 子组件 -->\n<slot name=\"header\" :msg1=\"hello1\"></slot>\n<slot :msg2=\"hello2\"></slot> <!-- name 为 default -->\n<slot name=\"header\" :msg3=\"hello3\"></slot>\n```\n","source":"_posts/19-vue插槽.md","raw":"---\ntitle: vue 插槽\ndate: 2023-12-26 11:18:09\ntags:\n    - vue\ncategories:\n    - vue\n      - 文档\n---\n\n## 基础\n\n插槽内容可以为文本、模版、组件\n\n``` html\n<!-- 父组件 -->\n<FancyButton>\n  Click me! <!-- 插槽内容 -->\n</FancyButton>\n```\n\n``` html\n<!-- 子组件 -->\n<button class=\"fancy-btn\">\n  <slot></slot> <!-- 插槽出口 -->\n</button>\n```\n\n渲染结果：\n\n``` html\n<button class=\"fancy-btn\">Click me!</button>\n```\n\n## 默认内容\n\n子组件的 ```<slot></slot>``` 标签之间是默认值\n\n``` html\n<button type=\"submit\">\n  <slot>Submit</slot> <!-- 默认内容 -->\n</button>\n```\n\n## 具名插槽\n\n当一个组件包含多个插槽出口时，需要使用 name 来给各个插槽分配唯一的 ID，没有提供 name 的插槽会隐式地命名为“default”。\n\n``` html\n<!-- 子组件 -->\n<div class=\"container\">\n  <header>\n    <slot name=\"header\"></slot>\n  </header>\n  <main>\n    <slot></slot> <!-- name 为 default -->\n  </main>\n  <footer>\n    <slot name=\"footer\"></slot>\n  </footer>\n</div>\n```\n\n在父组件中，使用 v-slot 或者 # 加上插槽名，来指定插槽内容。\n\n``` html\n<!-- 父组件 -->\n<BaseLayout>\n  <template v-slot:header>\n    <!-- header 插槽的内容 -->\n  </template>\n  <template #footer>\n    <!-- footer 插槽的内容 -->\n  </template>\n</BaseLayout>\n```\n\n## 动态插槽名\n\n可定义动态插槽名：\n\n``` html\n<base-layout>\n  <template v-slot:[dynamicSlotName]>\n  </template>\n\n  <!-- 缩写 -->\n  <template #[dynamicSlotName]>\n    ...\n  </template>\n</base-layout>\n```\n\n## 作用域插槽\n\n可以向插槽出口传递 attributes\n\n### 默认插槽\n\n``` html\n<!-- 子组件 -->\n<div>\n    <slot :text=\"message\" :count=\"1\"></slot>\n</div>\n```\n\n``` html\n<!-- 父组件 -->\n<MyComponent v-slot=\"slotProps\">\n    {{ slotProps.text }} {{ slotProps.count }}\n</MyComponent>\n\n<!-- 或者 -->\n<MyComponent v-slot=\"{ text, count }\">\n    {{ text }} {{ count }}\n</MyComponent>\n```\n\n### 具名插槽\n\n``` html\n<!-- 父组件 -->\n<MyComponent>\n  <template #header=\"headerProps\">\n    {{ headerProps }}\n  </template>\n\n  <!-- 不缩写 -->\n  <template v-slot:default=\"defaultProps\">\n    {{ defaultProps }}\n  </template>\n\n  <template #footer=\"footerProps\">\n    {{ footerProps }}\n  </template>\n</MyComponent>\n```\n\n``` html\n<!-- 子组件 -->\n<slot name=\"header\" :msg1=\"hello1\"></slot>\n<slot :msg2=\"hello2\"></slot> <!-- name 为 default -->\n<slot name=\"header\" :msg3=\"hello3\"></slot>\n```\n","slug":"19-vue插槽","published":1,"updated":"2025-05-20T02:47:28.682Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu6000s6kprcb33697k","content":"<h2 id=\"基础\"><a href=\"#基础\" class=\"headerlink\" title=\"基础\"></a>基础</h2><p>插槽内容可以为文本、模版、组件</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">FancyButton</span>&gt;</span></span><br><span class=\"line\">  Click me! <span class=\"comment\">&lt;!-- 插槽内容 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">FancyButton</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fancy-btn&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">slot</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span> <span class=\"comment\">&lt;!-- 插槽出口 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>渲染结果：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fancy-btn&quot;</span>&gt;</span>Click me!<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"默认内容\"><a href=\"#默认内容\" class=\"headerlink\" title=\"默认内容\"></a>默认内容</h2><p>子组件的 <code>&lt;slot&gt;&lt;/slot&gt;</code> 标签之间是默认值</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">slot</span>&gt;</span>Submit<span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span> <span class=\"comment\">&lt;!-- 默认内容 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"具名插槽\"><a href=\"#具名插槽\" class=\"headerlink\" title=\"具名插槽\"></a>具名插槽</h2><p>当一个组件包含多个插槽出口时，需要使用 name 来给各个插槽分配唯一的 ID，没有提供 name 的插槽会隐式地命名为“default”。</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">header</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;header&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">header</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">main</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">slot</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span> <span class=\"comment\">&lt;!-- name 为 default --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">main</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">footer</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;footer&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">footer</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>在父组件中，使用 v-slot 或者 # 加上插槽名，来指定插槽内容。</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">BaseLayout</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">v-slot:header</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- header 插槽的内容 --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">template</span> #<span class=\"attr\">footer</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- footer 插槽的内容 --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">BaseLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"动态插槽名\"><a href=\"#动态插槽名\" class=\"headerlink\" title=\"动态插槽名\"></a>动态插槽名</h2><p>可定义动态插槽名：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">base-layout</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">v-slot:</span>[<span class=\"attr\">dynamicSlotName</span>]&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- 缩写 --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">template</span> #[<span class=\"attr\">dynamicSlotName</span>]&gt;</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">base-layout</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"作用域插槽\"><a href=\"#作用域插槽\" class=\"headerlink\" title=\"作用域插槽\"></a>作用域插槽</h2><p>可以向插槽出口传递 attributes</p>\n<h3 id=\"默认插槽\"><a href=\"#默认插槽\" class=\"headerlink\" title=\"默认插槽\"></a>默认插槽</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">:text</span>=<span class=\"string\">&quot;message&quot;</span> <span class=\"attr\">:count</span>=<span class=\"string\">&quot;1&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">MyComponent</span> <span class=\"attr\">v-slot</span>=<span class=\"string\">&quot;slotProps&quot;</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123; slotProps.text &#125;&#125; &#123;&#123; slotProps.count &#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">MyComponent</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 或者 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">MyComponent</span> <span class=\"attr\">v-slot</span>=<span class=\"string\">&quot;&#123; text, count &#125;&quot;</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123; text &#125;&#125; &#123;&#123; count &#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">MyComponent</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"具名插槽-1\"><a href=\"#具名插槽-1\" class=\"headerlink\" title=\"具名插槽\"></a>具名插槽</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">MyComponent</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">template</span> #<span class=\"attr\">header</span>=<span class=\"string\">&quot;headerProps&quot;</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123; headerProps &#125;&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- 不缩写 --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">v-slot:default</span>=<span class=\"string\">&quot;defaultProps&quot;</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123; defaultProps &#125;&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">template</span> #<span class=\"attr\">footer</span>=<span class=\"string\">&quot;footerProps&quot;</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123; footerProps &#125;&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">MyComponent</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;header&quot;</span> <span class=\"attr\">:msg1</span>=<span class=\"string\">&quot;hello1&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">:msg2</span>=<span class=\"string\">&quot;hello2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span> <span class=\"comment\">&lt;!-- name 为 default --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;header&quot;</span> <span class=\"attr\">:msg3</span>=<span class=\"string\">&quot;hello3&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"基础\"><a href=\"#基础\" class=\"headerlink\" title=\"基础\"></a>基础</h2><p>插槽内容可以为文本、模版、组件</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">FancyButton</span>&gt;</span></span><br><span class=\"line\">  Click me! <span class=\"comment\">&lt;!-- 插槽内容 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">FancyButton</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fancy-btn&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">slot</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span> <span class=\"comment\">&lt;!-- 插槽出口 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>渲染结果：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fancy-btn&quot;</span>&gt;</span>Click me!<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"默认内容\"><a href=\"#默认内容\" class=\"headerlink\" title=\"默认内容\"></a>默认内容</h2><p>子组件的 <code>&lt;slot&gt;&lt;/slot&gt;</code> 标签之间是默认值</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">slot</span>&gt;</span>Submit<span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span> <span class=\"comment\">&lt;!-- 默认内容 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"具名插槽\"><a href=\"#具名插槽\" class=\"headerlink\" title=\"具名插槽\"></a>具名插槽</h2><p>当一个组件包含多个插槽出口时，需要使用 name 来给各个插槽分配唯一的 ID，没有提供 name 的插槽会隐式地命名为“default”。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">header</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;header&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">header</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">main</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">slot</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span> <span class=\"comment\">&lt;!-- name 为 default --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">main</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">footer</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;footer&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">footer</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>在父组件中，使用 v-slot 或者 # 加上插槽名，来指定插槽内容。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">BaseLayout</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">v-slot:header</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- header 插槽的内容 --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">template</span> #<span class=\"attr\">footer</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- footer 插槽的内容 --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">BaseLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"动态插槽名\"><a href=\"#动态插槽名\" class=\"headerlink\" title=\"动态插槽名\"></a>动态插槽名</h2><p>可定义动态插槽名：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">base-layout</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">v-slot:</span>[<span class=\"attr\">dynamicSlotName</span>]&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- 缩写 --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">template</span> #[<span class=\"attr\">dynamicSlotName</span>]&gt;</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">base-layout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"作用域插槽\"><a href=\"#作用域插槽\" class=\"headerlink\" title=\"作用域插槽\"></a>作用域插槽</h2><p>可以向插槽出口传递 attributes</p>\n<h3 id=\"默认插槽\"><a href=\"#默认插槽\" class=\"headerlink\" title=\"默认插槽\"></a>默认插槽</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">:text</span>=<span class=\"string\">&quot;message&quot;</span> <span class=\"attr\">:count</span>=<span class=\"string\">&quot;1&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">MyComponent</span> <span class=\"attr\">v-slot</span>=<span class=\"string\">&quot;slotProps&quot;</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123; slotProps.text &#125;&#125; &#123;&#123; slotProps.count &#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">MyComponent</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 或者 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">MyComponent</span> <span class=\"attr\">v-slot</span>=<span class=\"string\">&quot;&#123; text, count &#125;&quot;</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123; text &#125;&#125; &#123;&#123; count &#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">MyComponent</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"具名插槽-1\"><a href=\"#具名插槽-1\" class=\"headerlink\" title=\"具名插槽\"></a>具名插槽</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">MyComponent</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">template</span> #<span class=\"attr\">header</span>=<span class=\"string\">&quot;headerProps&quot;</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123; headerProps &#125;&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- 不缩写 --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">v-slot:default</span>=<span class=\"string\">&quot;defaultProps&quot;</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123; defaultProps &#125;&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">template</span> #<span class=\"attr\">footer</span>=<span class=\"string\">&quot;footerProps&quot;</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123; footerProps &#125;&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">MyComponent</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;header&quot;</span> <span class=\"attr\">:msg1</span>=<span class=\"string\">&quot;hello1&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">:msg2</span>=<span class=\"string\">&quot;hello2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span> <span class=\"comment\">&lt;!-- name 为 default --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;header&quot;</span> <span class=\"attr\">:msg3</span>=<span class=\"string\">&quot;hello3&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"vue 指令语法","date":"2023-11-06T08:04:06.000Z","_content":"\n## 指令\n\n种类：v-html, v-bind, v-on, v-model, v-slot ...\n\n指令语法如下图所示：\n![指令语法](https://img20.360buyimg.com/img/jfs/t1/89597/35/41403/16292/65489fc5Fb2d8b302/d64ca449c9e1d57b.png)\n\n### 动态参数\n\n（1）动态参数的值应为字符串或 null（null 会移除该绑定）\n\n（2）动态参数的名称避免使用大写字母，因为会被强制转为小写（someAttr -> someattr）\n\n``` html\n<a :[attributeName]=\"url\"> ... </a>\n\n<a @[eventName]=\"doSomething\">\n```\n\n### 修饰符\n\n修饰符为以点开头的特殊后缀，比如：.prevent 修饰符会告知 v-on 指令对触发的事件调用 event.preventDefault()\n\n``` html\n<div @submit.prevent=\"onSubmit\"></div>\n```\n\n## v-html\n\nspan 的内容会被替换为 rawHtml 属性的值，其中的数据绑定会被忽略（注意：使用这种方法容易造成 XSS 漏洞）\n\n``` html\n<span v-html=\"rawHtml\"></span>\n```\n\n## v-bind\n\n``` html\n<div v-bind:id=\"dynamicId\"></div>\n<!--简写-->\n<div :id=\"dynamicId\"></div>\n```\n\n### 动态绑定多个值\n\n``` js\nconst objOfAttrs = {\n    id: 'container',\n    class: 'wrapper'\n};\n```\n\n``` html\n<div :objOfAttrs></div>\n```\n\n比如：动态 style class\n\n``` html\n<div :style=\"{class1: isClass1, class2: isClass2}\"></div>\n```\n\n## v-on\n\n``` html\n<div v-on:click=\"onClick\"></div>\n<!--简写-->\n<div @click=\"onClick\"></div>\n```\n\n## v-if\n\nv-if, v-else-if, v-else\n\n注意：v-if 的优先级大于 v-for，二者不建议同时使用（详见 v-for）\n\n### template 上的 v-if\n\n如果想要切换不止一个元素，可以在元素外包一个 ``<template>``，并用 v-if 控制（v-show 不能在 template 上使用）\n\n因为 ``<template>`` 是一个不可见的包装器元素，渲染的结果中不会包含该元素\n\n### v-if & v-show\n\n（1）原理：v-if 切换时，条件区块会被销毁与重建；v-show 切换时，只会切换 display 属性\n\n（2）惰性：v-if 是惰性的，如果初始为 false 则不渲染；v-show 初始始终会渲染\n\n（3）场景：v-if 初始渲染开销较好，不会频繁切换时使用；v-show 切换开销较小，频繁切换时使用\n","source":"_posts/2-vue指令语法.md","raw":"---\ntitle: vue 指令语法\ndate: 2023-11-06 16:04:06\ntags:\n    - vue\ncategories:\n    - vue\n      - 文档\n---\n\n## 指令\n\n种类：v-html, v-bind, v-on, v-model, v-slot ...\n\n指令语法如下图所示：\n![指令语法](https://img20.360buyimg.com/img/jfs/t1/89597/35/41403/16292/65489fc5Fb2d8b302/d64ca449c9e1d57b.png)\n\n### 动态参数\n\n（1）动态参数的值应为字符串或 null（null 会移除该绑定）\n\n（2）动态参数的名称避免使用大写字母，因为会被强制转为小写（someAttr -> someattr）\n\n``` html\n<a :[attributeName]=\"url\"> ... </a>\n\n<a @[eventName]=\"doSomething\">\n```\n\n### 修饰符\n\n修饰符为以点开头的特殊后缀，比如：.prevent 修饰符会告知 v-on 指令对触发的事件调用 event.preventDefault()\n\n``` html\n<div @submit.prevent=\"onSubmit\"></div>\n```\n\n## v-html\n\nspan 的内容会被替换为 rawHtml 属性的值，其中的数据绑定会被忽略（注意：使用这种方法容易造成 XSS 漏洞）\n\n``` html\n<span v-html=\"rawHtml\"></span>\n```\n\n## v-bind\n\n``` html\n<div v-bind:id=\"dynamicId\"></div>\n<!--简写-->\n<div :id=\"dynamicId\"></div>\n```\n\n### 动态绑定多个值\n\n``` js\nconst objOfAttrs = {\n    id: 'container',\n    class: 'wrapper'\n};\n```\n\n``` html\n<div :objOfAttrs></div>\n```\n\n比如：动态 style class\n\n``` html\n<div :style=\"{class1: isClass1, class2: isClass2}\"></div>\n```\n\n## v-on\n\n``` html\n<div v-on:click=\"onClick\"></div>\n<!--简写-->\n<div @click=\"onClick\"></div>\n```\n\n## v-if\n\nv-if, v-else-if, v-else\n\n注意：v-if 的优先级大于 v-for，二者不建议同时使用（详见 v-for）\n\n### template 上的 v-if\n\n如果想要切换不止一个元素，可以在元素外包一个 ``<template>``，并用 v-if 控制（v-show 不能在 template 上使用）\n\n因为 ``<template>`` 是一个不可见的包装器元素，渲染的结果中不会包含该元素\n\n### v-if & v-show\n\n（1）原理：v-if 切换时，条件区块会被销毁与重建；v-show 切换时，只会切换 display 属性\n\n（2）惰性：v-if 是惰性的，如果初始为 false 则不渲染；v-show 初始始终会渲染\n\n（3）场景：v-if 初始渲染开销较好，不会频繁切换时使用；v-show 切换开销较小，频繁切换时使用\n","slug":"2-vue指令语法","published":1,"updated":"2025-05-20T02:47:28.683Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu7000w6kprelt60cte","content":"<h2 id=\"指令\"><a href=\"#指令\" class=\"headerlink\" title=\"指令\"></a>指令</h2><p>种类：v-html, v-bind, v-on, v-model, v-slot …</p>\n<p>指令语法如下图所示：<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://img20.360buyimg.com/img/jfs/t1/89597/35/41403/16292/65489fc5Fb2d8b302/d64ca449c9e1d57b.png\"\n                      alt=\"指令语法\"\n                ></p>\n<h3 id=\"动态参数\"><a href=\"#动态参数\" class=\"headerlink\" title=\"动态参数\"></a>动态参数</h3><p>（1）动态参数的值应为字符串或 null（null 会移除该绑定）</p>\n<p>（2）动态参数的名称避免使用大写字母，因为会被强制转为小写（someAttr -&gt; someattr）</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">:</span>[<span class=\"attr\">attributeName</span>]=<span class=\"string\">&quot;url&quot;</span>&gt;</span> ... <span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> @[<span class=\"attr\">eventName</span>]=<span class=\"string\">&quot;doSomething&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"修饰符\"><a href=\"#修饰符\" class=\"headerlink\" title=\"修饰符\"></a>修饰符</h3><p>修饰符为以点开头的特殊后缀，比如：.prevent 修饰符会告知 v-on 指令对触发的事件调用 event.preventDefault()</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> @<span class=\"attr\">submit.prevent</span>=<span class=\"string\">&quot;onSubmit&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"v-html\"><a href=\"#v-html\" class=\"headerlink\" title=\"v-html\"></a>v-html</h2><p>span 的内容会被替换为 rawHtml 属性的值，其中的数据绑定会被忽略（注意：使用这种方法容易造成 XSS 漏洞）</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">v-html</span>=<span class=\"string\">&quot;rawHtml&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"v-bind\"><a href=\"#v-bind\" class=\"headerlink\" title=\"v-bind\"></a>v-bind</h2><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">v-bind:id</span>=<span class=\"string\">&quot;dynamicId&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--简写--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">:id</span>=<span class=\"string\">&quot;dynamicId&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"动态绑定多个值\"><a href=\"#动态绑定多个值\" class=\"headerlink\" title=\"动态绑定多个值\"></a>动态绑定多个值</h3><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> objOfAttrs = &#123;</span><br><span class=\"line\">    <span class=\"attr\">id</span>: <span class=\"string\">&#x27;container&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">class</span>: <span class=\"string\">&#x27;wrapper&#x27;</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">:objOfAttrs</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>比如：动态 style class</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">:style</span>=<span class=\"string\">&quot;&#123;class1: isClass1, class2: isClass2&#125;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"v-on\"><a href=\"#v-on\" class=\"headerlink\" title=\"v-on\"></a>v-on</h2><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">v-on:click</span>=<span class=\"string\">&quot;onClick&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--简写--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;onClick&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"v-if\"><a href=\"#v-if\" class=\"headerlink\" title=\"v-if\"></a>v-if</h2><p>v-if, v-else-if, v-else</p>\n<p>注意：v-if 的优先级大于 v-for，二者不建议同时使用（详见 v-for）</p>\n<h3 id=\"template-上的-v-if\"><a href=\"#template-上的-v-if\" class=\"headerlink\" title=\"template 上的 v-if\"></a>template 上的 v-if</h3><p>如果想要切换不止一个元素，可以在元素外包一个 <code>&lt;template&gt;</code>，并用 v-if 控制（v-show 不能在 template 上使用）</p>\n<p>因为 <code>&lt;template&gt;</code> 是一个不可见的包装器元素，渲染的结果中不会包含该元素</p>\n<h3 id=\"v-if-v-show\"><a href=\"#v-if-v-show\" class=\"headerlink\" title=\"v-if &amp; v-show\"></a>v-if &amp; v-show</h3><p>（1）原理：v-if 切换时，条件区块会被销毁与重建；v-show 切换时，只会切换 display 属性</p>\n<p>（2）惰性：v-if 是惰性的，如果初始为 false 则不渲染；v-show 初始始终会渲染</p>\n<p>（3）场景：v-if 初始渲染开销较好，不会频繁切换时使用；v-show 切换开销较小，频繁切换时使用</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"指令\"><a href=\"#指令\" class=\"headerlink\" title=\"指令\"></a>指令</h2><p>种类：v-html, v-bind, v-on, v-model, v-slot …</p>\n<p>指令语法如下图所示：<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://img20.360buyimg.com/img/jfs/t1/89597/35/41403/16292/65489fc5Fb2d8b302/d64ca449c9e1d57b.png\"\n                      alt=\"指令语法\"\n                ></p>\n<h3 id=\"动态参数\"><a href=\"#动态参数\" class=\"headerlink\" title=\"动态参数\"></a>动态参数</h3><p>（1）动态参数的值应为字符串或 null（null 会移除该绑定）</p>\n<p>（2）动态参数的名称避免使用大写字母，因为会被强制转为小写（someAttr -&gt; someattr）</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">:</span>[<span class=\"attr\">attributeName</span>]=<span class=\"string\">&quot;url&quot;</span>&gt;</span> ... <span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> @[<span class=\"attr\">eventName</span>]=<span class=\"string\">&quot;doSomething&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修饰符\"><a href=\"#修饰符\" class=\"headerlink\" title=\"修饰符\"></a>修饰符</h3><p>修饰符为以点开头的特殊后缀，比如：.prevent 修饰符会告知 v-on 指令对触发的事件调用 event.preventDefault()</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> @<span class=\"attr\">submit.prevent</span>=<span class=\"string\">&quot;onSubmit&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"v-html\"><a href=\"#v-html\" class=\"headerlink\" title=\"v-html\"></a>v-html</h2><p>span 的内容会被替换为 rawHtml 属性的值，其中的数据绑定会被忽略（注意：使用这种方法容易造成 XSS 漏洞）</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">v-html</span>=<span class=\"string\">&quot;rawHtml&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"v-bind\"><a href=\"#v-bind\" class=\"headerlink\" title=\"v-bind\"></a>v-bind</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">v-bind:id</span>=<span class=\"string\">&quot;dynamicId&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--简写--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">:id</span>=<span class=\"string\">&quot;dynamicId&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"动态绑定多个值\"><a href=\"#动态绑定多个值\" class=\"headerlink\" title=\"动态绑定多个值\"></a>动态绑定多个值</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> objOfAttrs = &#123;</span><br><span class=\"line\">    <span class=\"attr\">id</span>: <span class=\"string\">&#x27;container&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">class</span>: <span class=\"string\">&#x27;wrapper&#x27;</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">:objOfAttrs</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>比如：动态 style class</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">:style</span>=<span class=\"string\">&quot;&#123;class1: isClass1, class2: isClass2&#125;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"v-on\"><a href=\"#v-on\" class=\"headerlink\" title=\"v-on\"></a>v-on</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">v-on:click</span>=<span class=\"string\">&quot;onClick&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--简写--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;onClick&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"v-if\"><a href=\"#v-if\" class=\"headerlink\" title=\"v-if\"></a>v-if</h2><p>v-if, v-else-if, v-else</p>\n<p>注意：v-if 的优先级大于 v-for，二者不建议同时使用（详见 v-for）</p>\n<h3 id=\"template-上的-v-if\"><a href=\"#template-上的-v-if\" class=\"headerlink\" title=\"template 上的 v-if\"></a>template 上的 v-if</h3><p>如果想要切换不止一个元素，可以在元素外包一个 <code>&lt;template&gt;</code>，并用 v-if 控制（v-show 不能在 template 上使用）</p>\n<p>因为 <code>&lt;template&gt;</code> 是一个不可见的包装器元素，渲染的结果中不会包含该元素</p>\n<h3 id=\"v-if-v-show\"><a href=\"#v-if-v-show\" class=\"headerlink\" title=\"v-if &amp; v-show\"></a>v-if &amp; v-show</h3><p>（1）原理：v-if 切换时，条件区块会被销毁与重建；v-show 切换时，只会切换 display 属性</p>\n<p>（2）惰性：v-if 是惰性的，如果初始为 false 则不渲染；v-show 初始始终会渲染</p>\n<p>（3）场景：v-if 初始渲染开销较好，不会频繁切换时使用；v-show 切换开销较小，频繁切换时使用</p>\n","_processedHighlight":true},{"title":"vue3 依赖注入","date":"2023-12-28T03:02:35.000Z","_content":"\n## props 逐级透传\n\n深层子组件需要较远的祖先组件中的部分数据，使用 props 逐级传递很麻烦：\n\n<img src=\"https://cn.vuejs.org/assets/prop-drilling.FyV2vFBP.png\" />\n\n\n## provide（提供）\n\n为组件后代提供数据，使用 provide() 函数：\n\n``` html\n<script setup>\nimport { provide } from 'vue';\n\nprovide(/* 注入名 */'message', /* 注入值 */'value');\n</script>\n```\n\n","source":"_posts/20-vue3依赖注入.md","raw":"---\ntitle: vue3 依赖注入\ndate: 2023-12-28 11:02:35\ntags:\n    - vue3\n    - vue\ncategories:\n    - vue3\n      - 文档\n---\n\n## props 逐级透传\n\n深层子组件需要较远的祖先组件中的部分数据，使用 props 逐级传递很麻烦：\n\n<img src=\"https://cn.vuejs.org/assets/prop-drilling.FyV2vFBP.png\" />\n\n\n## provide（提供）\n\n为组件后代提供数据，使用 provide() 函数：\n\n``` html\n<script setup>\nimport { provide } from 'vue';\n\nprovide(/* 注入名 */'message', /* 注入值 */'value');\n</script>\n```\n\n","slug":"20-vue3依赖注入","published":1,"updated":"2025-05-20T02:47:28.683Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu7000z6kpr41la11m2","content":"<h2 id=\"props-逐级透传\"><a href=\"#props-逐级透传\" class=\"headerlink\" title=\"props 逐级透传\"></a>props 逐级透传</h2><p>深层子组件需要较远的祖先组件中的部分数据，使用 props 逐级传递很麻烦：</p>\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://cn.vuejs.org/assets/prop-drilling.FyV2vFBP.png\"\n                      \n                >\n\n\n<h2 id=\"provide（提供）\"><a href=\"#provide（提供）\" class=\"headerlink\" title=\"provide（提供）\"></a>provide（提供）</h2><p>为组件后代提供数据，使用 provide() 函数：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; provide &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">provide</span>(<span class=\"comment\">/* 注入名 */</span><span class=\"string\">&#x27;message&#x27;</span>, <span class=\"comment\">/* 注入值 */</span><span class=\"string\">&#x27;value&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"props-逐级透传\"><a href=\"#props-逐级透传\" class=\"headerlink\" title=\"props 逐级透传\"></a>props 逐级透传</h2><p>深层子组件需要较远的祖先组件中的部分数据，使用 props 逐级传递很麻烦：</p>\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://cn.vuejs.org/assets/prop-drilling.FyV2vFBP.png\"\n                      \n                >\n\n\n<h2 id=\"provide（提供）\"><a href=\"#provide（提供）\" class=\"headerlink\" title=\"provide（提供）\"></a>provide（提供）</h2><p>为组件后代提供数据，使用 provide() 函数：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; provide &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"title function_\">provide</span>(<span class=\"comment\">/* 注入名 */</span><span class=\"string\">&#x27;message&#x27;</span>, <span class=\"comment\">/* 注入值 */</span><span class=\"string\">&#x27;value&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n","_processedHighlight":true},{"title":"浏览器输入url后发生了什么","date":"2024-10-10T01:22:10.000Z","_content":"\n## 1. URL解析\n\n用户输入的URL（例如 `https://www.example.com/index.html`）首先被浏览器解析，该过程包括：\n\n- 提取协议（如HTTP或HTTPS）\n- 主机名（如www.example.com）\n- 端口\n- 路径（如/index.html）\n- 查询参数\n- 锚点\n\n详见：\n\n- [浏览器解析url过程](./22-浏览器解析url过程.md)\n\n## 2. DNS 查询\n\n浏览器需要将域名转换为IP地址，以便进行网络通信。\n此时，浏览器会查找本地DNS缓存，如果没有找到，就会向系统的DNS服务器发送请求。DNS服务器将返回对应的IP地址。\n\n详见：\n\n- [DNS](./25-DNS.md)\n- [CDN](./26-CDN.md)\n\n## 3. TCP连接\n\n一旦获得了IP地址，浏览器通过TCP（传输控制协议）建立与目标服务器的连接。\n对于HTTPS请求，还需要进行SSL/TLS握手，以确保安全性。这一过程包括：\n\n- 客户端向服务器发送连接请求\n- 服务器确认并建立连接\n- 进行SSL/TLS证书验证以及协商加密算法\n\n## 4. 发送HTTP请求\n\n连接建立后，浏览器构建一个HTTP请求并发送到服务器。这个请求包含：\n\n- 请求行（例如 GET /index.html HTTP/1.1）\n- 请求头（例如用户代理、接受类型等信息）\n- 请求体（对于POST请求，可能包含数据）\n\n## 5. 服务器处理请求\n\n服务器接收到请求后，会根据请求的内容进行处理。它可能会查找文件、访问数据库或者执行其他逻辑，最终生成一个HTTP响应。\n\n## 6. 接收HTTP响应\n\n服务器发送回HTTP响应，包含状态码（如200表示成功，404表示未找到），响应头（如内容类型、内容长度等）和响应体（实际请求资源的内容，如HTML文档）。\n\n## 7. 渲染页面\n\n浏览器接收响应后，进行以下步骤：\n\n- 解析HTML文档，构建DOM树\n- 如果遇到CSS文件，发起请求以获取样式，并构建CSSOM树\n- 合并DOM和CSSOM，生成渲染树\n- 根据渲染树计算布局，决定每个元素的位置和大小\n- 绘制页面，将内容绘制到屏幕上\n\n## 8. 处理JavaScript\n\n如果HTML中包含JavaScript代码，浏览器会逐步执行这些脚本。\nJavaScript可以操作DOM，改变页面内容，进行AJAX请求等。\n\n## 9. 其它资源加载\n\n如果页面中包含其他资源（如图片、音频、视频），浏览器会并行请求这些资源，直至全部加载完成。\n\n## 案例说明\n\n假设用户在浏览器中输入<https://www.example.com/index.html，整个过程如下：>\n\n1. 浏览器解析出协议为HTTPS，域名为www.example.com。\n2. 发送DNS请求，获得IP地址93.184.216.34。\n3. 与该IP地址建立TCP连接，并进行TLS握手。\n4. 发送GET请求，请求/index.html资源。\n5. 服务器处理请求，返回200状态及index.html内容。\n6. 浏览器解析HTML，构建DOM树，并抓取相关的CSS和JavaScript文件。\n7. 最终呈现完整的网页给用户。\n","source":"_posts/21-浏览器输入url后发生了什么.md","raw":"---\ntitle: 浏览器输入url后发生了什么\ndate: 2024-10-10 09:22:10\ntags:\n    - 面经\n    - 计算机网络\n    - url\ncategories:\n    - 计算机网络\n      - 综合\n---\n\n## 1. URL解析\n\n用户输入的URL（例如 `https://www.example.com/index.html`）首先被浏览器解析，该过程包括：\n\n- 提取协议（如HTTP或HTTPS）\n- 主机名（如www.example.com）\n- 端口\n- 路径（如/index.html）\n- 查询参数\n- 锚点\n\n详见：\n\n- [浏览器解析url过程](./22-浏览器解析url过程.md)\n\n## 2. DNS 查询\n\n浏览器需要将域名转换为IP地址，以便进行网络通信。\n此时，浏览器会查找本地DNS缓存，如果没有找到，就会向系统的DNS服务器发送请求。DNS服务器将返回对应的IP地址。\n\n详见：\n\n- [DNS](./25-DNS.md)\n- [CDN](./26-CDN.md)\n\n## 3. TCP连接\n\n一旦获得了IP地址，浏览器通过TCP（传输控制协议）建立与目标服务器的连接。\n对于HTTPS请求，还需要进行SSL/TLS握手，以确保安全性。这一过程包括：\n\n- 客户端向服务器发送连接请求\n- 服务器确认并建立连接\n- 进行SSL/TLS证书验证以及协商加密算法\n\n## 4. 发送HTTP请求\n\n连接建立后，浏览器构建一个HTTP请求并发送到服务器。这个请求包含：\n\n- 请求行（例如 GET /index.html HTTP/1.1）\n- 请求头（例如用户代理、接受类型等信息）\n- 请求体（对于POST请求，可能包含数据）\n\n## 5. 服务器处理请求\n\n服务器接收到请求后，会根据请求的内容进行处理。它可能会查找文件、访问数据库或者执行其他逻辑，最终生成一个HTTP响应。\n\n## 6. 接收HTTP响应\n\n服务器发送回HTTP响应，包含状态码（如200表示成功，404表示未找到），响应头（如内容类型、内容长度等）和响应体（实际请求资源的内容，如HTML文档）。\n\n## 7. 渲染页面\n\n浏览器接收响应后，进行以下步骤：\n\n- 解析HTML文档，构建DOM树\n- 如果遇到CSS文件，发起请求以获取样式，并构建CSSOM树\n- 合并DOM和CSSOM，生成渲染树\n- 根据渲染树计算布局，决定每个元素的位置和大小\n- 绘制页面，将内容绘制到屏幕上\n\n## 8. 处理JavaScript\n\n如果HTML中包含JavaScript代码，浏览器会逐步执行这些脚本。\nJavaScript可以操作DOM，改变页面内容，进行AJAX请求等。\n\n## 9. 其它资源加载\n\n如果页面中包含其他资源（如图片、音频、视频），浏览器会并行请求这些资源，直至全部加载完成。\n\n## 案例说明\n\n假设用户在浏览器中输入<https://www.example.com/index.html，整个过程如下：>\n\n1. 浏览器解析出协议为HTTPS，域名为www.example.com。\n2. 发送DNS请求，获得IP地址93.184.216.34。\n3. 与该IP地址建立TCP连接，并进行TLS握手。\n4. 发送GET请求，请求/index.html资源。\n5. 服务器处理请求，返回200状态及index.html内容。\n6. 浏览器解析HTML，构建DOM树，并抓取相关的CSS和JavaScript文件。\n7. 最终呈现完整的网页给用户。\n","slug":"21-浏览器输入url后发生了什么","published":1,"updated":"2025-05-20T02:47:28.683Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu700136kprcdao3ht6","content":"<h2 id=\"1-URL解析\"><a href=\"#1-URL解析\" class=\"headerlink\" title=\"1. URL解析\"></a>1. URL解析</h2><p>用户输入的URL（例如 <code>https://www.example.com/index.html</code>）首先被浏览器解析，该过程包括：</p>\n<ul>\n<li>提取协议（如HTTP或HTTPS）</li>\n<li>主机名（如<a class=\"link\"   href=\"http://www.example.com)/\" >www.example.com）<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li>端口</li>\n<li>路径（如&#x2F;index.html）</li>\n<li>查询参数</li>\n<li>锚点</li>\n</ul>\n<p>详见：</p>\n<ul>\n<li><a href=\"./22-%E6%B5%8F%E8%A7%88%E5%99%A8%E8%A7%A3%E6%9E%90url%E8%BF%87%E7%A8%8B.md\">浏览器解析url过程</a></li>\n</ul>\n<h2 id=\"2-DNS-查询\"><a href=\"#2-DNS-查询\" class=\"headerlink\" title=\"2. DNS 查询\"></a>2. DNS 查询</h2><p>浏览器需要将域名转换为IP地址，以便进行网络通信。<br>此时，浏览器会查找本地DNS缓存，如果没有找到，就会向系统的DNS服务器发送请求。DNS服务器将返回对应的IP地址。</p>\n<p>详见：</p>\n<ul>\n<li><a href=\"./25-DNS.md\">DNS</a></li>\n<li><a href=\"./26-CDN.md\">CDN</a></li>\n</ul>\n<h2 id=\"3-TCP连接\"><a href=\"#3-TCP连接\" class=\"headerlink\" title=\"3. TCP连接\"></a>3. TCP连接</h2><p>一旦获得了IP地址，浏览器通过TCP（传输控制协议）建立与目标服务器的连接。<br>对于HTTPS请求，还需要进行SSL&#x2F;TLS握手，以确保安全性。这一过程包括：</p>\n<ul>\n<li>客户端向服务器发送连接请求</li>\n<li>服务器确认并建立连接</li>\n<li>进行SSL&#x2F;TLS证书验证以及协商加密算法</li>\n</ul>\n<h2 id=\"4-发送HTTP请求\"><a href=\"#4-发送HTTP请求\" class=\"headerlink\" title=\"4. 发送HTTP请求\"></a>4. 发送HTTP请求</h2><p>连接建立后，浏览器构建一个HTTP请求并发送到服务器。这个请求包含：</p>\n<ul>\n<li>请求行（例如 GET &#x2F;index.html HTTP&#x2F;1.1）</li>\n<li>请求头（例如用户代理、接受类型等信息）</li>\n<li>请求体（对于POST请求，可能包含数据）</li>\n</ul>\n<h2 id=\"5-服务器处理请求\"><a href=\"#5-服务器处理请求\" class=\"headerlink\" title=\"5. 服务器处理请求\"></a>5. 服务器处理请求</h2><p>服务器接收到请求后，会根据请求的内容进行处理。它可能会查找文件、访问数据库或者执行其他逻辑，最终生成一个HTTP响应。</p>\n<h2 id=\"6-接收HTTP响应\"><a href=\"#6-接收HTTP响应\" class=\"headerlink\" title=\"6. 接收HTTP响应\"></a>6. 接收HTTP响应</h2><p>服务器发送回HTTP响应，包含状态码（如200表示成功，404表示未找到），响应头（如内容类型、内容长度等）和响应体（实际请求资源的内容，如HTML文档）。</p>\n<h2 id=\"7-渲染页面\"><a href=\"#7-渲染页面\" class=\"headerlink\" title=\"7. 渲染页面\"></a>7. 渲染页面</h2><p>浏览器接收响应后，进行以下步骤：</p>\n<ul>\n<li>解析HTML文档，构建DOM树</li>\n<li>如果遇到CSS文件，发起请求以获取样式，并构建CSSOM树</li>\n<li>合并DOM和CSSOM，生成渲染树</li>\n<li>根据渲染树计算布局，决定每个元素的位置和大小</li>\n<li>绘制页面，将内容绘制到屏幕上</li>\n</ul>\n<h2 id=\"8-处理JavaScript\"><a href=\"#8-处理JavaScript\" class=\"headerlink\" title=\"8. 处理JavaScript\"></a>8. 处理JavaScript</h2><p>如果HTML中包含JavaScript代码，浏览器会逐步执行这些脚本。<br>JavaScript可以操作DOM，改变页面内容，进行AJAX请求等。</p>\n<h2 id=\"9-其它资源加载\"><a href=\"#9-其它资源加载\" class=\"headerlink\" title=\"9. 其它资源加载\"></a>9. 其它资源加载</h2><p>如果页面中包含其他资源（如图片、音频、视频），浏览器会并行请求这些资源，直至全部加载完成。</p>\n<h2 id=\"案例说明\"><a href=\"#案例说明\" class=\"headerlink\" title=\"案例说明\"></a>案例说明</h2><p>假设用户在浏览器中输入<a class=\"link\"   href=\"https://www.example.com/index.html%EF%BC%8C%E6%95%B4%E4%B8%AA%E8%BF%87%E7%A8%8B%E5%A6%82%E4%B8%8B%EF%BC%9A\" >https://www.example.com/index.html，整个过程如下：<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<ol>\n<li>浏览器解析出协议为HTTPS，域名为<a class=\"link\"   href=\"http://www.example.com./\" >www.example.com。<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li>发送DNS请求，获得IP地址93.184.216.34。</li>\n<li>与该IP地址建立TCP连接，并进行TLS握手。</li>\n<li>发送GET请求，请求&#x2F;index.html资源。</li>\n<li>服务器处理请求，返回200状态及index.html内容。</li>\n<li>浏览器解析HTML，构建DOM树，并抓取相关的CSS和JavaScript文件。</li>\n<li>最终呈现完整的网页给用户。</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-URL解析\"><a href=\"#1-URL解析\" class=\"headerlink\" title=\"1. URL解析\"></a>1. URL解析</h2><p>用户输入的URL（例如 <code>https://www.example.com/index.html</code>）首先被浏览器解析，该过程包括：</p>\n<ul>\n<li>提取协议（如HTTP或HTTPS）</li>\n<li>主机名（如<a class=\"link\"   href=\"http://www.example.com)/\" >www.example.com）<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li>端口</li>\n<li>路径（如&#x2F;index.html）</li>\n<li>查询参数</li>\n<li>锚点</li>\n</ul>\n<p>详见：</p>\n<ul>\n<li><a href=\"./22-%E6%B5%8F%E8%A7%88%E5%99%A8%E8%A7%A3%E6%9E%90url%E8%BF%87%E7%A8%8B.md\">浏览器解析url过程</a></li>\n</ul>\n<h2 id=\"2-DNS-查询\"><a href=\"#2-DNS-查询\" class=\"headerlink\" title=\"2. DNS 查询\"></a>2. DNS 查询</h2><p>浏览器需要将域名转换为IP地址，以便进行网络通信。<br>此时，浏览器会查找本地DNS缓存，如果没有找到，就会向系统的DNS服务器发送请求。DNS服务器将返回对应的IP地址。</p>\n<p>详见：</p>\n<ul>\n<li><a href=\"./25-DNS.md\">DNS</a></li>\n<li><a href=\"./26-CDN.md\">CDN</a></li>\n</ul>\n<h2 id=\"3-TCP连接\"><a href=\"#3-TCP连接\" class=\"headerlink\" title=\"3. TCP连接\"></a>3. TCP连接</h2><p>一旦获得了IP地址，浏览器通过TCP（传输控制协议）建立与目标服务器的连接。<br>对于HTTPS请求，还需要进行SSL&#x2F;TLS握手，以确保安全性。这一过程包括：</p>\n<ul>\n<li>客户端向服务器发送连接请求</li>\n<li>服务器确认并建立连接</li>\n<li>进行SSL&#x2F;TLS证书验证以及协商加密算法</li>\n</ul>\n<h2 id=\"4-发送HTTP请求\"><a href=\"#4-发送HTTP请求\" class=\"headerlink\" title=\"4. 发送HTTP请求\"></a>4. 发送HTTP请求</h2><p>连接建立后，浏览器构建一个HTTP请求并发送到服务器。这个请求包含：</p>\n<ul>\n<li>请求行（例如 GET &#x2F;index.html HTTP&#x2F;1.1）</li>\n<li>请求头（例如用户代理、接受类型等信息）</li>\n<li>请求体（对于POST请求，可能包含数据）</li>\n</ul>\n<h2 id=\"5-服务器处理请求\"><a href=\"#5-服务器处理请求\" class=\"headerlink\" title=\"5. 服务器处理请求\"></a>5. 服务器处理请求</h2><p>服务器接收到请求后，会根据请求的内容进行处理。它可能会查找文件、访问数据库或者执行其他逻辑，最终生成一个HTTP响应。</p>\n<h2 id=\"6-接收HTTP响应\"><a href=\"#6-接收HTTP响应\" class=\"headerlink\" title=\"6. 接收HTTP响应\"></a>6. 接收HTTP响应</h2><p>服务器发送回HTTP响应，包含状态码（如200表示成功，404表示未找到），响应头（如内容类型、内容长度等）和响应体（实际请求资源的内容，如HTML文档）。</p>\n<h2 id=\"7-渲染页面\"><a href=\"#7-渲染页面\" class=\"headerlink\" title=\"7. 渲染页面\"></a>7. 渲染页面</h2><p>浏览器接收响应后，进行以下步骤：</p>\n<ul>\n<li>解析HTML文档，构建DOM树</li>\n<li>如果遇到CSS文件，发起请求以获取样式，并构建CSSOM树</li>\n<li>合并DOM和CSSOM，生成渲染树</li>\n<li>根据渲染树计算布局，决定每个元素的位置和大小</li>\n<li>绘制页面，将内容绘制到屏幕上</li>\n</ul>\n<h2 id=\"8-处理JavaScript\"><a href=\"#8-处理JavaScript\" class=\"headerlink\" title=\"8. 处理JavaScript\"></a>8. 处理JavaScript</h2><p>如果HTML中包含JavaScript代码，浏览器会逐步执行这些脚本。<br>JavaScript可以操作DOM，改变页面内容，进行AJAX请求等。</p>\n<h2 id=\"9-其它资源加载\"><a href=\"#9-其它资源加载\" class=\"headerlink\" title=\"9. 其它资源加载\"></a>9. 其它资源加载</h2><p>如果页面中包含其他资源（如图片、音频、视频），浏览器会并行请求这些资源，直至全部加载完成。</p>\n<h2 id=\"案例说明\"><a href=\"#案例说明\" class=\"headerlink\" title=\"案例说明\"></a>案例说明</h2><p>假设用户在浏览器中输入<a class=\"link\"   href=\"https://www.example.com/index.html%EF%BC%8C%E6%95%B4%E4%B8%AA%E8%BF%87%E7%A8%8B%E5%A6%82%E4%B8%8B%EF%BC%9A\" >https://www.example.com/index.html，整个过程如下：<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<ol>\n<li>浏览器解析出协议为HTTPS，域名为<a class=\"link\"   href=\"http://www.example.com./\" >www.example.com。<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li>发送DNS请求，获得IP地址93.184.216.34。</li>\n<li>与该IP地址建立TCP连接，并进行TLS握手。</li>\n<li>发送GET请求，请求&#x2F;index.html资源。</li>\n<li>服务器处理请求，返回200状态及index.html内容。</li>\n<li>浏览器解析HTML，构建DOM树，并抓取相关的CSS和JavaScript文件。</li>\n<li>最终呈现完整的网页给用户。</li>\n</ol>\n","_processedHighlight":true},{"title":"浏览器解析url过程","date":"2024-10-14T06:15:10.000Z","_content":"\n## 1. URL的格式\n\n协议表示浏览器应当使用的访问方法，包括：\"http：\"\"ftp：\"\"file：\"\"mailto：\"。\n比如访问Web服务器使用HTTP协议，访问本地服务器使用FILE协议，访问FTP服务器使用FTP协议。\n\n图1 列举了常见的几种URL，访问自标不同，URL的写法也不同。\n例如在访问Web服务器和FTP服务器时，URL中包含服务器的域名和要访问的文件的路径名等，而发邮件的URL则包含收件人的邮件地址。此外，URL还可能包含用户名、密码、服务器端口号等信息。\n\n图1.1：URL的各种格式\n![图1.1](https://pica.zhimg.com/80/v2-e72ee2cb036bb9fa21e2817228a43e42_1440w.webp?source=2c26e567)\n\n## 2. URL的组成元素\n\n图1.2：Web浏览器解析url的过程\n![图1.2](https://picx.zhimg.com/80/v2-42f11c5b60c90af055cc232d71d15fd0_1440w.webp?source=2c26e567)\n\n图1.3：路径名为/dir/file1.html的文件\n![图1.3](https://pic1.zhimg.com/80/v2-204e5983725b0bf4ea61bef9c66d8d99_1440w.webp?source=2c26e567)\n\n## 3. 省略文件名的情况\n\n#### (a) 以\"/\"结尾：`lab.glasscom.com/dir/`\n\n以\"/dir/\"结尾代表/dir/后面本应该有的文件名被省略了。\n我们会在服务器上事先设置好文件名省略时要访问的默认文件名，大多情况下是index.html或者default.htm。因此，像前面这样省略文件名时，服务器就会访问其中的默认文件。\n\n#### (b) 域名+\"/\"：`lab.glasscom.com/`\n\n以\"域名+/\"结尾表示访问一个名叫\"/\"的目录（根目录）；\n由于省略了文件名，会访问/index.html之类的文件。\n\n#### (c) 域名：`lab.glasscom.com`\n\n以域名结尾时，就代表访问根目录下事先设置的默认文件，也就是/index.html之类的文件。\n\n#### (d) 路径结尾无\"/\"：`lab.glasscom.com/whatisthis`\n\n**先文件，后目录。**\n如果Web服务器上存在名为whatisthis的文件，则将whatisthis作为文件名来处理；\n如果存在名为whatisthis的目录，则将whatisthis作为目录名来处理。\n\n### 备注\n\n- URL：Uniform Resource Locator，统一资源定位符。\n- FTP：File Transfer Protocol，文件传送协议。是在上传、下载文件时使用的协议（也指使用FTP协议传送文件的程序）。\n- HTTP：Hypertext Transfer Protocol，超文本传送协议。\n- 根目录：\"/\"目录 表示最顶层的目录 \"根目录\"。\n","source":"_posts/22-浏览器解析url过程.md","raw":"---\ntitle: 浏览器解析url过程\ndate: 2024-10-14 14:15:10\ntags:\n    - 面经\n    - 计算机网络\n    - url\ncategories:\n    - 计算机网络\n      - url\n---\n\n## 1. URL的格式\n\n协议表示浏览器应当使用的访问方法，包括：\"http：\"\"ftp：\"\"file：\"\"mailto：\"。\n比如访问Web服务器使用HTTP协议，访问本地服务器使用FILE协议，访问FTP服务器使用FTP协议。\n\n图1 列举了常见的几种URL，访问自标不同，URL的写法也不同。\n例如在访问Web服务器和FTP服务器时，URL中包含服务器的域名和要访问的文件的路径名等，而发邮件的URL则包含收件人的邮件地址。此外，URL还可能包含用户名、密码、服务器端口号等信息。\n\n图1.1：URL的各种格式\n![图1.1](https://pica.zhimg.com/80/v2-e72ee2cb036bb9fa21e2817228a43e42_1440w.webp?source=2c26e567)\n\n## 2. URL的组成元素\n\n图1.2：Web浏览器解析url的过程\n![图1.2](https://picx.zhimg.com/80/v2-42f11c5b60c90af055cc232d71d15fd0_1440w.webp?source=2c26e567)\n\n图1.3：路径名为/dir/file1.html的文件\n![图1.3](https://pic1.zhimg.com/80/v2-204e5983725b0bf4ea61bef9c66d8d99_1440w.webp?source=2c26e567)\n\n## 3. 省略文件名的情况\n\n#### (a) 以\"/\"结尾：`lab.glasscom.com/dir/`\n\n以\"/dir/\"结尾代表/dir/后面本应该有的文件名被省略了。\n我们会在服务器上事先设置好文件名省略时要访问的默认文件名，大多情况下是index.html或者default.htm。因此，像前面这样省略文件名时，服务器就会访问其中的默认文件。\n\n#### (b) 域名+\"/\"：`lab.glasscom.com/`\n\n以\"域名+/\"结尾表示访问一个名叫\"/\"的目录（根目录）；\n由于省略了文件名，会访问/index.html之类的文件。\n\n#### (c) 域名：`lab.glasscom.com`\n\n以域名结尾时，就代表访问根目录下事先设置的默认文件，也就是/index.html之类的文件。\n\n#### (d) 路径结尾无\"/\"：`lab.glasscom.com/whatisthis`\n\n**先文件，后目录。**\n如果Web服务器上存在名为whatisthis的文件，则将whatisthis作为文件名来处理；\n如果存在名为whatisthis的目录，则将whatisthis作为目录名来处理。\n\n### 备注\n\n- URL：Uniform Resource Locator，统一资源定位符。\n- FTP：File Transfer Protocol，文件传送协议。是在上传、下载文件时使用的协议（也指使用FTP协议传送文件的程序）。\n- HTTP：Hypertext Transfer Protocol，超文本传送协议。\n- 根目录：\"/\"目录 表示最顶层的目录 \"根目录\"。\n","slug":"22-浏览器解析url过程","published":1,"updated":"2025-05-20T02:47:28.683Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu700166kprbgo43vym","content":"<h2 id=\"1-URL的格式\"><a href=\"#1-URL的格式\" class=\"headerlink\" title=\"1. URL的格式\"></a>1. URL的格式</h2><p>协议表示浏览器应当使用的访问方法，包括：”http：””ftp：””file：””mailto：”。<br>比如访问Web服务器使用HTTP协议，访问本地服务器使用FILE协议，访问FTP服务器使用FTP协议。</p>\n<p>图1 列举了常见的几种URL，访问自标不同，URL的写法也不同。<br>例如在访问Web服务器和FTP服务器时，URL中包含服务器的域名和要访问的文件的路径名等，而发邮件的URL则包含收件人的邮件地址。此外，URL还可能包含用户名、密码、服务器端口号等信息。</p>\n<p>图1.1：URL的各种格式<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://pica.zhimg.com/80/v2-e72ee2cb036bb9fa21e2817228a43e42_1440w.webp?source=2c26e567\"\n                      alt=\"图1.1\"\n                ></p>\n<h2 id=\"2-URL的组成元素\"><a href=\"#2-URL的组成元素\" class=\"headerlink\" title=\"2. URL的组成元素\"></a>2. URL的组成元素</h2><p>图1.2：Web浏览器解析url的过程<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://picx.zhimg.com/80/v2-42f11c5b60c90af055cc232d71d15fd0_1440w.webp?source=2c26e567\"\n                      alt=\"图1.2\"\n                ></p>\n<p>图1.3：路径名为&#x2F;dir&#x2F;file1.html的文件<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://pic1.zhimg.com/80/v2-204e5983725b0bf4ea61bef9c66d8d99_1440w.webp?source=2c26e567\"\n                      alt=\"图1.3\"\n                ></p>\n<h2 id=\"3-省略文件名的情况\"><a href=\"#3-省略文件名的情况\" class=\"headerlink\" title=\"3. 省略文件名的情况\"></a>3. 省略文件名的情况</h2><h4 id=\"a-以”-“结尾：lab-glasscom-com-dir\"><a href=\"#a-以”-“结尾：lab-glasscom-com-dir\" class=\"headerlink\" title=\"(a) 以”&#x2F;“结尾：lab.glasscom.com/dir/\"></a>(a) 以”&#x2F;“结尾：<code>lab.glasscom.com/dir/</code></h4><p>以”&#x2F;dir&#x2F;“结尾代表&#x2F;dir&#x2F;后面本应该有的文件名被省略了。<br>我们会在服务器上事先设置好文件名省略时要访问的默认文件名，大多情况下是index.html或者default.htm。因此，像前面这样省略文件名时，服务器就会访问其中的默认文件。</p>\n<h4 id=\"b-域名-”-“：lab-glasscom-com\"><a href=\"#b-域名-”-“：lab-glasscom-com\" class=\"headerlink\" title=\"(b) 域名+”&#x2F;“：lab.glasscom.com/\"></a>(b) 域名+”&#x2F;“：<code>lab.glasscom.com/</code></h4><p>以”域名+&#x2F;“结尾表示访问一个名叫”&#x2F;“的目录（根目录）；<br>由于省略了文件名，会访问&#x2F;index.html之类的文件。</p>\n<h4 id=\"c-域名：lab-glasscom-com\"><a href=\"#c-域名：lab-glasscom-com\" class=\"headerlink\" title=\"(c) 域名：lab.glasscom.com\"></a>(c) 域名：<code>lab.glasscom.com</code></h4><p>以域名结尾时，就代表访问根目录下事先设置的默认文件，也就是&#x2F;index.html之类的文件。</p>\n<h4 id=\"d-路径结尾无”-“：lab-glasscom-com-whatisthis\"><a href=\"#d-路径结尾无”-“：lab-glasscom-com-whatisthis\" class=\"headerlink\" title=\"(d) 路径结尾无”&#x2F;“：lab.glasscom.com/whatisthis\"></a>(d) 路径结尾无”&#x2F;“：<code>lab.glasscom.com/whatisthis</code></h4><p><strong>先文件，后目录。</strong><br>如果Web服务器上存在名为whatisthis的文件，则将whatisthis作为文件名来处理；<br>如果存在名为whatisthis的目录，则将whatisthis作为目录名来处理。</p>\n<h3 id=\"备注\"><a href=\"#备注\" class=\"headerlink\" title=\"备注\"></a>备注</h3><ul>\n<li>URL：Uniform Resource Locator，统一资源定位符。</li>\n<li>FTP：File Transfer Protocol，文件传送协议。是在上传、下载文件时使用的协议（也指使用FTP协议传送文件的程序）。</li>\n<li>HTTP：Hypertext Transfer Protocol，超文本传送协议。</li>\n<li>根目录：”&#x2F;“目录 表示最顶层的目录 “根目录”。</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-URL的格式\"><a href=\"#1-URL的格式\" class=\"headerlink\" title=\"1. URL的格式\"></a>1. URL的格式</h2><p>协议表示浏览器应当使用的访问方法，包括：”http：””ftp：””file：””mailto：”。<br>比如访问Web服务器使用HTTP协议，访问本地服务器使用FILE协议，访问FTP服务器使用FTP协议。</p>\n<p>图1 列举了常见的几种URL，访问自标不同，URL的写法也不同。<br>例如在访问Web服务器和FTP服务器时，URL中包含服务器的域名和要访问的文件的路径名等，而发邮件的URL则包含收件人的邮件地址。此外，URL还可能包含用户名、密码、服务器端口号等信息。</p>\n<p>图1.1：URL的各种格式<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://pica.zhimg.com/80/v2-e72ee2cb036bb9fa21e2817228a43e42_1440w.webp?source=2c26e567\"\n                      alt=\"图1.1\"\n                ></p>\n<h2 id=\"2-URL的组成元素\"><a href=\"#2-URL的组成元素\" class=\"headerlink\" title=\"2. URL的组成元素\"></a>2. URL的组成元素</h2><p>图1.2：Web浏览器解析url的过程<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://picx.zhimg.com/80/v2-42f11c5b60c90af055cc232d71d15fd0_1440w.webp?source=2c26e567\"\n                      alt=\"图1.2\"\n                ></p>\n<p>图1.3：路径名为&#x2F;dir&#x2F;file1.html的文件<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://pic1.zhimg.com/80/v2-204e5983725b0bf4ea61bef9c66d8d99_1440w.webp?source=2c26e567\"\n                      alt=\"图1.3\"\n                ></p>\n<h2 id=\"3-省略文件名的情况\"><a href=\"#3-省略文件名的情况\" class=\"headerlink\" title=\"3. 省略文件名的情况\"></a>3. 省略文件名的情况</h2><h4 id=\"a-以”-“结尾：lab-glasscom-com-dir\"><a href=\"#a-以”-“结尾：lab-glasscom-com-dir\" class=\"headerlink\" title=\"(a) 以”&#x2F;“结尾：lab.glasscom.com/dir/\"></a>(a) 以”&#x2F;“结尾：<code>lab.glasscom.com/dir/</code></h4><p>以”&#x2F;dir&#x2F;“结尾代表&#x2F;dir&#x2F;后面本应该有的文件名被省略了。<br>我们会在服务器上事先设置好文件名省略时要访问的默认文件名，大多情况下是index.html或者default.htm。因此，像前面这样省略文件名时，服务器就会访问其中的默认文件。</p>\n<h4 id=\"b-域名-”-“：lab-glasscom-com\"><a href=\"#b-域名-”-“：lab-glasscom-com\" class=\"headerlink\" title=\"(b) 域名+”&#x2F;“：lab.glasscom.com/\"></a>(b) 域名+”&#x2F;“：<code>lab.glasscom.com/</code></h4><p>以”域名+&#x2F;“结尾表示访问一个名叫”&#x2F;“的目录（根目录）；<br>由于省略了文件名，会访问&#x2F;index.html之类的文件。</p>\n<h4 id=\"c-域名：lab-glasscom-com\"><a href=\"#c-域名：lab-glasscom-com\" class=\"headerlink\" title=\"(c) 域名：lab.glasscom.com\"></a>(c) 域名：<code>lab.glasscom.com</code></h4><p>以域名结尾时，就代表访问根目录下事先设置的默认文件，也就是&#x2F;index.html之类的文件。</p>\n<h4 id=\"d-路径结尾无”-“：lab-glasscom-com-whatisthis\"><a href=\"#d-路径结尾无”-“：lab-glasscom-com-whatisthis\" class=\"headerlink\" title=\"(d) 路径结尾无”&#x2F;“：lab.glasscom.com/whatisthis\"></a>(d) 路径结尾无”&#x2F;“：<code>lab.glasscom.com/whatisthis</code></h4><p><strong>先文件，后目录。</strong><br>如果Web服务器上存在名为whatisthis的文件，则将whatisthis作为文件名来处理；<br>如果存在名为whatisthis的目录，则将whatisthis作为目录名来处理。</p>\n<h3 id=\"备注\"><a href=\"#备注\" class=\"headerlink\" title=\"备注\"></a>备注</h3><ul>\n<li>URL：Uniform Resource Locator，统一资源定位符。</li>\n<li>FTP：File Transfer Protocol，文件传送协议。是在上传、下载文件时使用的协议（也指使用FTP协议传送文件的程序）。</li>\n<li>HTTP：Hypertext Transfer Protocol，超文本传送协议。</li>\n<li>根目录：”&#x2F;“目录 表示最顶层的目录 “根目录”。</li>\n</ul>\n","_processedHighlight":true},{"title":"投放链接防重定向","date":"2024-10-14T08:56:06.000Z","_content":"\n为了防止浏览器进行多次重定向，影响页面性能，投放链接应该以 https 开头，以 '/' 结尾\n不用：`http://lc.jr.jd.com/finance/fund/fundinvest/investZone`\n使用：`https://lc.jr.jd.com/finance/fund/fundinvest/investZone/`\n\n## 不正确投放链接\n\n访问`http://lc.jr.jd.com/finance/fund/fundinvest/investZone`的请求过程：\n\n### 一、有缓存\n\n#### 1. 协议变为 https\n\n浏览器把协议从http替换为https（使用307重定向，保证不改变请求方法GET）\n\n![图1](../images/23/1.png)\n\n#### 2. 本地缓存获取IP\n\n浏览器在本地缓存中获取到IP（远端地址）；重定向到补充末尾\"/\"的规范URL\n\n- 返回304响应码，该GET请求的request header中包含（与缓存相关的）条件参数\n- 使用path相对路径进行重定向，因为nginx在server中设置了`absolute_redirect off`\n\n![图2](../images/23/2.png)\n\n请求头中的条件参数（If-xxx）：\n![图3](../images/23/3.png)\n\n#### 3. 请求资源\n\n浏览器使用上述请求从本地缓存中获取的IP，向远端服务器GET资源，并成功\n![图4](../images/23/4.png)\n\n### 二、无缓存\n\n无缓存时，第2步变为使用301重定向\n\n![图5](../images/23/5.png)\n\n## 正确投放链接\n\n访问`https://lc.jr.jd.com/finance/fund/fundinvest/investZone/`的请求过程：\n\n### 一、有缓存\n\n服务器返回304响应码，表示可以使用客户端中之前缓存的副本\n\n- 该请求的request header中包含「与缓存相关」的条件参数\n\n![图6](../images/23/6.png)\n\n### 二、无缓存\n\n普通请求，响应码为200\n","source":"_posts/23-投放链接防重定向.md","raw":"---\ntitle: 投放链接防重定向\ndate: 2024-10-14 16:56:06\ntags:\n    - 面经\n    - 计算机网络\n    - url\n    - 实践问题\ncategories:\n    - 计算机网络\n      - url\n---\n\n为了防止浏览器进行多次重定向，影响页面性能，投放链接应该以 https 开头，以 '/' 结尾\n不用：`http://lc.jr.jd.com/finance/fund/fundinvest/investZone`\n使用：`https://lc.jr.jd.com/finance/fund/fundinvest/investZone/`\n\n## 不正确投放链接\n\n访问`http://lc.jr.jd.com/finance/fund/fundinvest/investZone`的请求过程：\n\n### 一、有缓存\n\n#### 1. 协议变为 https\n\n浏览器把协议从http替换为https（使用307重定向，保证不改变请求方法GET）\n\n![图1](../images/23/1.png)\n\n#### 2. 本地缓存获取IP\n\n浏览器在本地缓存中获取到IP（远端地址）；重定向到补充末尾\"/\"的规范URL\n\n- 返回304响应码，该GET请求的request header中包含（与缓存相关的）条件参数\n- 使用path相对路径进行重定向，因为nginx在server中设置了`absolute_redirect off`\n\n![图2](../images/23/2.png)\n\n请求头中的条件参数（If-xxx）：\n![图3](../images/23/3.png)\n\n#### 3. 请求资源\n\n浏览器使用上述请求从本地缓存中获取的IP，向远端服务器GET资源，并成功\n![图4](../images/23/4.png)\n\n### 二、无缓存\n\n无缓存时，第2步变为使用301重定向\n\n![图5](../images/23/5.png)\n\n## 正确投放链接\n\n访问`https://lc.jr.jd.com/finance/fund/fundinvest/investZone/`的请求过程：\n\n### 一、有缓存\n\n服务器返回304响应码，表示可以使用客户端中之前缓存的副本\n\n- 该请求的request header中包含「与缓存相关」的条件参数\n\n![图6](../images/23/6.png)\n\n### 二、无缓存\n\n普通请求，响应码为200\n","slug":"23-投放链接防重定向","published":1,"updated":"2025-05-20T02:47:28.683Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu8001b6kpr20s16is7","content":"<p>为了防止浏览器进行多次重定向，影响页面性能，投放链接应该以 https 开头，以 ‘&#x2F;‘ 结尾<br>不用：<code>http://lc.jr.jd.com/finance/fund/fundinvest/investZone</code><br>使用：<code>https://lc.jr.jd.com/finance/fund/fundinvest/investZone/</code></p>\n<h2 id=\"不正确投放链接\"><a href=\"#不正确投放链接\" class=\"headerlink\" title=\"不正确投放链接\"></a>不正确投放链接</h2><p>访问<code>http://lc.jr.jd.com/finance/fund/fundinvest/investZone</code>的请求过程：</p>\n<h3 id=\"一、有缓存\"><a href=\"#一、有缓存\" class=\"headerlink\" title=\"一、有缓存\"></a>一、有缓存</h3><h4 id=\"1-协议变为-https\"><a href=\"#1-协议变为-https\" class=\"headerlink\" title=\"1. 协议变为 https\"></a>1. 协议变为 https</h4><p>浏览器把协议从http替换为https（使用307重定向，保证不改变请求方法GET）</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/23/1.png\"\n                      alt=\"图1\"\n                ></p>\n<h4 id=\"2-本地缓存获取IP\"><a href=\"#2-本地缓存获取IP\" class=\"headerlink\" title=\"2. 本地缓存获取IP\"></a>2. 本地缓存获取IP</h4><p>浏览器在本地缓存中获取到IP（远端地址）；重定向到补充末尾”&#x2F;“的规范URL</p>\n<ul>\n<li>返回304响应码，该GET请求的request header中包含（与缓存相关的）条件参数</li>\n<li>使用path相对路径进行重定向，因为nginx在server中设置了<code>absolute_redirect off</code></li>\n</ul>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/23/2.png\"\n                      alt=\"图2\"\n                ></p>\n<p>请求头中的条件参数（If-xxx）：<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/23/3.png\"\n                      alt=\"图3\"\n                ></p>\n<h4 id=\"3-请求资源\"><a href=\"#3-请求资源\" class=\"headerlink\" title=\"3. 请求资源\"></a>3. 请求资源</h4><p>浏览器使用上述请求从本地缓存中获取的IP，向远端服务器GET资源，并成功<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/23/4.png\"\n                      alt=\"图4\"\n                ></p>\n<h3 id=\"二、无缓存\"><a href=\"#二、无缓存\" class=\"headerlink\" title=\"二、无缓存\"></a>二、无缓存</h3><p>无缓存时，第2步变为使用301重定向</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/23/5.png\"\n                      alt=\"图5\"\n                ></p>\n<h2 id=\"正确投放链接\"><a href=\"#正确投放链接\" class=\"headerlink\" title=\"正确投放链接\"></a>正确投放链接</h2><p>访问<code>https://lc.jr.jd.com/finance/fund/fundinvest/investZone/</code>的请求过程：</p>\n<h3 id=\"一、有缓存-1\"><a href=\"#一、有缓存-1\" class=\"headerlink\" title=\"一、有缓存\"></a>一、有缓存</h3><p>服务器返回304响应码，表示可以使用客户端中之前缓存的副本</p>\n<ul>\n<li>该请求的request header中包含「与缓存相关」的条件参数</li>\n</ul>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/23/6.png\"\n                      alt=\"图6\"\n                ></p>\n<h3 id=\"二、无缓存-1\"><a href=\"#二、无缓存-1\" class=\"headerlink\" title=\"二、无缓存\"></a>二、无缓存</h3><p>普通请求，响应码为200</p>\n","site":{"data":{}},"excerpt":"","more":"<p>为了防止浏览器进行多次重定向，影响页面性能，投放链接应该以 https 开头，以 ‘&#x2F;‘ 结尾<br>不用：<code>http://lc.jr.jd.com/finance/fund/fundinvest/investZone</code><br>使用：<code>https://lc.jr.jd.com/finance/fund/fundinvest/investZone/</code></p>\n<h2 id=\"不正确投放链接\"><a href=\"#不正确投放链接\" class=\"headerlink\" title=\"不正确投放链接\"></a>不正确投放链接</h2><p>访问<code>http://lc.jr.jd.com/finance/fund/fundinvest/investZone</code>的请求过程：</p>\n<h3 id=\"一、有缓存\"><a href=\"#一、有缓存\" class=\"headerlink\" title=\"一、有缓存\"></a>一、有缓存</h3><h4 id=\"1-协议变为-https\"><a href=\"#1-协议变为-https\" class=\"headerlink\" title=\"1. 协议变为 https\"></a>1. 协议变为 https</h4><p>浏览器把协议从http替换为https（使用307重定向，保证不改变请求方法GET）</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/23/1.png\"\n                      alt=\"图1\"\n                ></p>\n<h4 id=\"2-本地缓存获取IP\"><a href=\"#2-本地缓存获取IP\" class=\"headerlink\" title=\"2. 本地缓存获取IP\"></a>2. 本地缓存获取IP</h4><p>浏览器在本地缓存中获取到IP（远端地址）；重定向到补充末尾”&#x2F;“的规范URL</p>\n<ul>\n<li>返回304响应码，该GET请求的request header中包含（与缓存相关的）条件参数</li>\n<li>使用path相对路径进行重定向，因为nginx在server中设置了<code>absolute_redirect off</code></li>\n</ul>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/23/2.png\"\n                      alt=\"图2\"\n                ></p>\n<p>请求头中的条件参数（If-xxx）：<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/23/3.png\"\n                      alt=\"图3\"\n                ></p>\n<h4 id=\"3-请求资源\"><a href=\"#3-请求资源\" class=\"headerlink\" title=\"3. 请求资源\"></a>3. 请求资源</h4><p>浏览器使用上述请求从本地缓存中获取的IP，向远端服务器GET资源，并成功<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/23/4.png\"\n                      alt=\"图4\"\n                ></p>\n<h3 id=\"二、无缓存\"><a href=\"#二、无缓存\" class=\"headerlink\" title=\"二、无缓存\"></a>二、无缓存</h3><p>无缓存时，第2步变为使用301重定向</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/23/5.png\"\n                      alt=\"图5\"\n                ></p>\n<h2 id=\"正确投放链接\"><a href=\"#正确投放链接\" class=\"headerlink\" title=\"正确投放链接\"></a>正确投放链接</h2><p>访问<code>https://lc.jr.jd.com/finance/fund/fundinvest/investZone/</code>的请求过程：</p>\n<h3 id=\"一、有缓存-1\"><a href=\"#一、有缓存-1\" class=\"headerlink\" title=\"一、有缓存\"></a>一、有缓存</h3><p>服务器返回304响应码，表示可以使用客户端中之前缓存的副本</p>\n<ul>\n<li>该请求的request header中包含「与缓存相关」的条件参数</li>\n</ul>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/23/6.png\"\n                      alt=\"图6\"\n                ></p>\n<h3 id=\"二、无缓存-1\"><a href=\"#二、无缓存-1\" class=\"headerlink\" title=\"二、无缓存\"></a>二、无缓存</h3><p>普通请求，响应码为200</p>\n","_processedHighlight":true},{"title":"浏览器缓存与304状态码","date":"2024-10-16T09:52:10.000Z","_content":"\n## 总结\n\n出现304状态码的条件\n\n- 不禁止缓存\n- 不检查本地缓存是否过期；或者检查本地缓存、且未过期\n- 响应头有`Etag`（则下次的请求头中有`If-None-Match`）；或者响应头有`Last-Modified`（则下次的请求头中有`If-Modified-since`）\n- 缓存有效\n\n注意：下图中的`Etag`和`Last-Modified`之间不存在先后顺序\n\n![图1](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2017/11/22/15fe1d6fc1269a86~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n## 一、304请求的交互过程\n\n假设用户通过浏览器访问某静态资源（比如图片image.png），且该资源之前已被浏览器缓存，现在分析两次请求的交互过程。\n\n### 第一次请求（初始加载）\n\n#### 1、浏览器发送请求\n\n用户在浏览器中输入 URL，浏览器向服务器发送 GET 请求，获取 image.png。\n请求头可能如下：\n\n``` http\nGET /image.png HTTP/1.1\nHost: example.com\nUser-Agent: Mozilla/5.0 ...\nAccept: image/webp,image/apng,image/*,*/*;q=0.8\n```\n\n#### 2、服务器响应\n\n服务器处理请求，并返回 200 OK 响应，同时附带以下响应头：\n\n```http\nHTTP/1.1 200 OK\nContent-Type: image/png\nContent-Length: 123456\nLast-Modified: Mon, 01 Jan 2023 12:00:00 GMT\nETag: \"abc123\"\nCache-Control: max-age=31536000\n```\n\n- `Last-Modified`：表示资源最后修改的时间\n- `ETag`：资源的唯一标识符\n- `Cache-Control`：指示浏览器可以缓存该资源的时长\n\n#### 3、浏览器缓存资源\n\n浏览器接收响应后，将image.png缓存到本地，并根据响应头信息（如`Last-Modified`和`ETag`）记录该资源的状态\n\n### 第二次请求（缓存验证）\n\n#### 1、浏览器发送条件请求\n\n当用户再次访问同一资源，浏览器会检查缓存，如果该资源仍然有效，就发送一个带条件的 GET 请求到服务器，请求头如下：\n\n``` http\nGET /image.png HTTP/1.1\nHost: example.com\nIf-Modified-Since: Mon, 01 Jan 2023 12:00:00 GMT\nIf-None-Match: \"abc123\"\nUser-Agent: Mozilla/5.0 ...\n```\n\n- `If-Modified-Since`：告诉服务器，如果在指定日期之后资源被修改，则返回新的资源\n- `If-None-Match`：告诉服务器，如果资源的`ETag`与提供的值不匹配，则返回新的资源\n\n#### 2、服务器处理请求\n\n服务器接收到条件请求后，检查该资源的状态：\n如果资源自`Last-Modified`时间以来未被修改，且`ETag`匹配，那么服务器不会返回新的内容，而是返回 304 Not Modified。\n\n服务器返回如下响应：\n\n``` http\nHTTP/1.1 304 Not Modified\nDate: Mon, 02 Jan 2023 12:00:00 GMT\n```\n\n**注意：304 响应没有消息体，通常只包含必要的状态码和一些响应头。**\n\n#### 3、浏览器处理304响应\n\n当浏览器接收到 304 Not Modified 响应时，了解到之前缓存的 image.png 仍然有效，因此直接使用缓存中的版本，而无需重新下载。\n\n## 二、详细讨论\n\n### 1、是否禁止缓存\n\n**禁止缓存**：缓存中不得存储任何关于客户端请求和服务端响应的内容，客户端每次发起的请求都会下载完整的响应内容\n\n在请求头中，`Cache-Control: no-store` 与 `Pragma: no-cache` 都可以禁止缓存\n\n- `Pragma: no-cache` 可用于 `http 1.0` 和 `http 1.1`\n- `Cache-Control: no-store` 只能用于 `http 1.1`\n\n### 2、是否检查本地副本是否过期\n\n由 `Cache-Control` 的 `no-cache` 和 `must-revalidate` 两个可选值控制\n\n- `no-cache`：告诉浏览器、缓存服务器，不管本地副本是否过期，**使用资源副本前，必须到源服务器进行副本有效性校验**\n- `must-revalidate`：告诉浏览器、缓存服务器，**本地副本过期前，可使用本地副本**；本地副本一旦过期，必须去源服务器进行有效性校验（如果没有该属性，若发生网络问题等情况，客户端可能直接使用本地缓存，而不会向服务器发起校验）\n\n### 3、检查本地副本是否过期\n\n与「缓存的过期机制」相关的响应头字段（优先级依次降低）：\n\n#### （1）`max-age=<seconds>`\n\n表示资源能被缓存的最大时间，通常和 `must-revalidate` 一起使用。\n\n本地副本过期前，可使用本地副本，缓存时间为60秒；\n如果本地副本已过期，则重新向服务器请求（要求必须进行有效性校验）：\n\n``` http\nCache-Control: max-age=60, must-revalidate\n```\n\n共享缓存（如代理服务器）将在60秒后失效，而个人用户的缓存则在120秒后失效：\n\n``` http\nCache-Control: max-age=120, smax-age=60\n```\n\n#### （2）`Expires`\n\n表示资源的过期时间。\n如果无`max-age`但有`Expires`，通过比较`Expires`和`Date`的值来判断是否缓存有效：\n\n![图2](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec71a24236~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n#### （3）`Last-Modified`\n\n表示资源的最后修改时间。\n如果无`max-age`和`expires`但有`Last-Modified`，缓存的时长等于\n\n``` json\n(Date - Last-Modified) / 10\n```\n\n![图3](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec6d61c11a~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n**如果都没有，浏览器将不会对该需求进行缓存。**\n\n### 4、本地副本没过期\n\n直接从缓存中读取资源，并返回200状态码。\n\n![图4](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec7215656e~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n### 5、本地副本已过期\n\n进行「源服务器进行有效性校验」的前期准备：\n\n#### （1）If-None-Match\n\n首先，在请求头里寻找`If-None-Match`字段（其值为服务器上次返回的`ETag`响应头的值）\n\n![图5](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec71ddeec1~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n![图6](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec89fb1991~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n#### （2）If-Modified-Since\n\n如果没有`If-None-Match`，则在请求头中寻找`If-Modified-Since`字段（其值为服务器上次返回的`Last-Modified`响应头中的日期值）\n\n![图7](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec8a29d072~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n![图8](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eed35bf1c0e~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n如果`If-None-Match`与`If-Modified-Since`都没有，则直接向服务器请求数据\n\n### 6、去源服务器进行有效性校验\n\n如果请求头中有`If-None-Match`或`If-Modified-Since`，则到源服务器进行有效性校验。\n如果源服务器资源没有变化，则返回304；如果有变化，则返回200。\n\n### 7、上述流程的总结图\n\n![图9](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eed5984fb4b~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n## 三、意义\n\n- **避免了不必要的数据传输，提高了网络效率和用户体验**；\n- **在频繁访问相同资源的情况下，可以显著降低带宽消耗和服务器负载**。\n\n## 四、补充\n\n### 私有缓存和公共缓存\n\n在`Cache-Control`还有两个值：`private`与`public`：\n\n- public 表示该响应可被任何中间人（比如中间代理、CDN等）缓存。\n- private 表示该响应是专用于某单个用户的，不能被中间人缓存，应该用于浏览器的私有缓存中，比如：带有HTTP验证信息（帐号密码）的页面 或 某些特定影响状态码的页面*。\n\n“某些特定影响状态码的页面”指具有特殊语义的状态码，比如：\n\n##### （1）401 Unauthorized\n\n当访问受保护的资源时，如果用户未通过身份验证，服务器可能返回401状态码。\n此时通常只应允许客户端缓存该响应，因为该内容对其他用户是不适用的。\n\n#### （2）403 Forbidden\n\n表示服务器理解请求但拒绝执行它。\n在某些情况下，公共内容也可能出于安全考虑而不被中间缓存，因此可标记为 private。\n\n##### （2）404 Not Found\n\n如果某资源不存在，虽然它是公开的，但可能在某些应用场景下不希望被中间缓存。\n\n##### （3）500 Internal Server Error\n\n表示服务器出现了问题，返回的内容可能不稳定，因此不应被中间缓存。\n\n#### private 使用场景\n\n##### （1）用户特定数据\n\n如个性化推荐、用户历史记录等，仅对特定用户合适，其他用户无法访问，即便返回成功状态，为了保护用户隐私，建议使用 private。\n\n##### （2）临时性数据\n\n如操作结果、表单提交后给予反馈的信息等，这类信息通常只需当前用户知道，对其他用户无意义，适合标记为 private。\n","source":"_posts/24-浏览器缓存与304状态码.md","raw":"---\ntitle: 浏览器缓存与304状态码\ndate: 2024-10-16 17:52:10\ntags:\n    - 面经\n    - 计算机网络\n    - url\n    - 状态码\n    - 浏览器\ncategories:\n    - 计算机网络\n      - 状态码\n    - 计算机网络\n      - 浏览器\n---\n\n## 总结\n\n出现304状态码的条件\n\n- 不禁止缓存\n- 不检查本地缓存是否过期；或者检查本地缓存、且未过期\n- 响应头有`Etag`（则下次的请求头中有`If-None-Match`）；或者响应头有`Last-Modified`（则下次的请求头中有`If-Modified-since`）\n- 缓存有效\n\n注意：下图中的`Etag`和`Last-Modified`之间不存在先后顺序\n\n![图1](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2017/11/22/15fe1d6fc1269a86~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n## 一、304请求的交互过程\n\n假设用户通过浏览器访问某静态资源（比如图片image.png），且该资源之前已被浏览器缓存，现在分析两次请求的交互过程。\n\n### 第一次请求（初始加载）\n\n#### 1、浏览器发送请求\n\n用户在浏览器中输入 URL，浏览器向服务器发送 GET 请求，获取 image.png。\n请求头可能如下：\n\n``` http\nGET /image.png HTTP/1.1\nHost: example.com\nUser-Agent: Mozilla/5.0 ...\nAccept: image/webp,image/apng,image/*,*/*;q=0.8\n```\n\n#### 2、服务器响应\n\n服务器处理请求，并返回 200 OK 响应，同时附带以下响应头：\n\n```http\nHTTP/1.1 200 OK\nContent-Type: image/png\nContent-Length: 123456\nLast-Modified: Mon, 01 Jan 2023 12:00:00 GMT\nETag: \"abc123\"\nCache-Control: max-age=31536000\n```\n\n- `Last-Modified`：表示资源最后修改的时间\n- `ETag`：资源的唯一标识符\n- `Cache-Control`：指示浏览器可以缓存该资源的时长\n\n#### 3、浏览器缓存资源\n\n浏览器接收响应后，将image.png缓存到本地，并根据响应头信息（如`Last-Modified`和`ETag`）记录该资源的状态\n\n### 第二次请求（缓存验证）\n\n#### 1、浏览器发送条件请求\n\n当用户再次访问同一资源，浏览器会检查缓存，如果该资源仍然有效，就发送一个带条件的 GET 请求到服务器，请求头如下：\n\n``` http\nGET /image.png HTTP/1.1\nHost: example.com\nIf-Modified-Since: Mon, 01 Jan 2023 12:00:00 GMT\nIf-None-Match: \"abc123\"\nUser-Agent: Mozilla/5.0 ...\n```\n\n- `If-Modified-Since`：告诉服务器，如果在指定日期之后资源被修改，则返回新的资源\n- `If-None-Match`：告诉服务器，如果资源的`ETag`与提供的值不匹配，则返回新的资源\n\n#### 2、服务器处理请求\n\n服务器接收到条件请求后，检查该资源的状态：\n如果资源自`Last-Modified`时间以来未被修改，且`ETag`匹配，那么服务器不会返回新的内容，而是返回 304 Not Modified。\n\n服务器返回如下响应：\n\n``` http\nHTTP/1.1 304 Not Modified\nDate: Mon, 02 Jan 2023 12:00:00 GMT\n```\n\n**注意：304 响应没有消息体，通常只包含必要的状态码和一些响应头。**\n\n#### 3、浏览器处理304响应\n\n当浏览器接收到 304 Not Modified 响应时，了解到之前缓存的 image.png 仍然有效，因此直接使用缓存中的版本，而无需重新下载。\n\n## 二、详细讨论\n\n### 1、是否禁止缓存\n\n**禁止缓存**：缓存中不得存储任何关于客户端请求和服务端响应的内容，客户端每次发起的请求都会下载完整的响应内容\n\n在请求头中，`Cache-Control: no-store` 与 `Pragma: no-cache` 都可以禁止缓存\n\n- `Pragma: no-cache` 可用于 `http 1.0` 和 `http 1.1`\n- `Cache-Control: no-store` 只能用于 `http 1.1`\n\n### 2、是否检查本地副本是否过期\n\n由 `Cache-Control` 的 `no-cache` 和 `must-revalidate` 两个可选值控制\n\n- `no-cache`：告诉浏览器、缓存服务器，不管本地副本是否过期，**使用资源副本前，必须到源服务器进行副本有效性校验**\n- `must-revalidate`：告诉浏览器、缓存服务器，**本地副本过期前，可使用本地副本**；本地副本一旦过期，必须去源服务器进行有效性校验（如果没有该属性，若发生网络问题等情况，客户端可能直接使用本地缓存，而不会向服务器发起校验）\n\n### 3、检查本地副本是否过期\n\n与「缓存的过期机制」相关的响应头字段（优先级依次降低）：\n\n#### （1）`max-age=<seconds>`\n\n表示资源能被缓存的最大时间，通常和 `must-revalidate` 一起使用。\n\n本地副本过期前，可使用本地副本，缓存时间为60秒；\n如果本地副本已过期，则重新向服务器请求（要求必须进行有效性校验）：\n\n``` http\nCache-Control: max-age=60, must-revalidate\n```\n\n共享缓存（如代理服务器）将在60秒后失效，而个人用户的缓存则在120秒后失效：\n\n``` http\nCache-Control: max-age=120, smax-age=60\n```\n\n#### （2）`Expires`\n\n表示资源的过期时间。\n如果无`max-age`但有`Expires`，通过比较`Expires`和`Date`的值来判断是否缓存有效：\n\n![图2](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec71a24236~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n#### （3）`Last-Modified`\n\n表示资源的最后修改时间。\n如果无`max-age`和`expires`但有`Last-Modified`，缓存的时长等于\n\n``` json\n(Date - Last-Modified) / 10\n```\n\n![图3](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec6d61c11a~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n**如果都没有，浏览器将不会对该需求进行缓存。**\n\n### 4、本地副本没过期\n\n直接从缓存中读取资源，并返回200状态码。\n\n![图4](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec7215656e~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n### 5、本地副本已过期\n\n进行「源服务器进行有效性校验」的前期准备：\n\n#### （1）If-None-Match\n\n首先，在请求头里寻找`If-None-Match`字段（其值为服务器上次返回的`ETag`响应头的值）\n\n![图5](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec71ddeec1~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n![图6](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec89fb1991~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n#### （2）If-Modified-Since\n\n如果没有`If-None-Match`，则在请求头中寻找`If-Modified-Since`字段（其值为服务器上次返回的`Last-Modified`响应头中的日期值）\n\n![图7](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec8a29d072~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n![图8](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eed35bf1c0e~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n如果`If-None-Match`与`If-Modified-Since`都没有，则直接向服务器请求数据\n\n### 6、去源服务器进行有效性校验\n\n如果请求头中有`If-None-Match`或`If-Modified-Since`，则到源服务器进行有效性校验。\n如果源服务器资源没有变化，则返回304；如果有变化，则返回200。\n\n### 7、上述流程的总结图\n\n![图9](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eed5984fb4b~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)\n\n## 三、意义\n\n- **避免了不必要的数据传输，提高了网络效率和用户体验**；\n- **在频繁访问相同资源的情况下，可以显著降低带宽消耗和服务器负载**。\n\n## 四、补充\n\n### 私有缓存和公共缓存\n\n在`Cache-Control`还有两个值：`private`与`public`：\n\n- public 表示该响应可被任何中间人（比如中间代理、CDN等）缓存。\n- private 表示该响应是专用于某单个用户的，不能被中间人缓存，应该用于浏览器的私有缓存中，比如：带有HTTP验证信息（帐号密码）的页面 或 某些特定影响状态码的页面*。\n\n“某些特定影响状态码的页面”指具有特殊语义的状态码，比如：\n\n##### （1）401 Unauthorized\n\n当访问受保护的资源时，如果用户未通过身份验证，服务器可能返回401状态码。\n此时通常只应允许客户端缓存该响应，因为该内容对其他用户是不适用的。\n\n#### （2）403 Forbidden\n\n表示服务器理解请求但拒绝执行它。\n在某些情况下，公共内容也可能出于安全考虑而不被中间缓存，因此可标记为 private。\n\n##### （2）404 Not Found\n\n如果某资源不存在，虽然它是公开的，但可能在某些应用场景下不希望被中间缓存。\n\n##### （3）500 Internal Server Error\n\n表示服务器出现了问题，返回的内容可能不稳定，因此不应被中间缓存。\n\n#### private 使用场景\n\n##### （1）用户特定数据\n\n如个性化推荐、用户历史记录等，仅对特定用户合适，其他用户无法访问，即便返回成功状态，为了保护用户隐私，建议使用 private。\n\n##### （2）临时性数据\n\n如操作结果、表单提交后给予反馈的信息等，这类信息通常只需当前用户知道，对其他用户无意义，适合标记为 private。\n","slug":"24-浏览器缓存与304状态码","published":1,"updated":"2025-05-20T02:47:28.683Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu8001e6kpr20sv87a1","content":"<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>出现304状态码的条件</p>\n<ul>\n<li>不禁止缓存</li>\n<li>不检查本地缓存是否过期；或者检查本地缓存、且未过期</li>\n<li>响应头有<code>Etag</code>（则下次的请求头中有<code>If-None-Match</code>）；或者响应头有<code>Last-Modified</code>（则下次的请求头中有<code>If-Modified-since</code>）</li>\n<li>缓存有效</li>\n</ul>\n<p>注意：下图中的<code>Etag</code>和<code>Last-Modified</code>之间不存在先后顺序</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2017/11/22/15fe1d6fc1269a86~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png\"\n                      alt=\"图1\"\n                ></p>\n<h2 id=\"一、304请求的交互过程\"><a href=\"#一、304请求的交互过程\" class=\"headerlink\" title=\"一、304请求的交互过程\"></a>一、304请求的交互过程</h2><p>假设用户通过浏览器访问某静态资源（比如图片image.png），且该资源之前已被浏览器缓存，现在分析两次请求的交互过程。</p>\n<h3 id=\"第一次请求（初始加载）\"><a href=\"#第一次请求（初始加载）\" class=\"headerlink\" title=\"第一次请求（初始加载）\"></a>第一次请求（初始加载）</h3><h4 id=\"1、浏览器发送请求\"><a href=\"#1、浏览器发送请求\" class=\"headerlink\" title=\"1、浏览器发送请求\"></a>1、浏览器发送请求</h4><p>用户在浏览器中输入 URL，浏览器向服务器发送 GET 请求，获取 image.png。<br>请求头可能如下：</p>\n<div class=\"code-container\" data-rel=\"Http\"><figure class=\"iseeu highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GET</span> <span class=\"string\">/image.png</span> <span class=\"meta\">HTTP/1.1</span></span><br><span class=\"line\"><span class=\"attribute\">Host</span><span class=\"punctuation\">: </span>example.com</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span><span class=\"punctuation\">: </span>Mozilla/5.0 ...</span><br><span class=\"line\"><span class=\"attribute\">Accept</span><span class=\"punctuation\">: </span>image/webp,image/apng,image/*,*/*;q=0.8</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"2、服务器响应\"><a href=\"#2、服务器响应\" class=\"headerlink\" title=\"2、服务器响应\"></a>2、服务器响应</h4><p>服务器处理请求，并返回 200 OK 响应，同时附带以下响应头：</p>\n<div class=\"code-container\" data-rel=\"Http\"><figure class=\"iseeu highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">HTTP/1.1</span> <span class=\"number\">200</span> OK</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span><span class=\"punctuation\">: </span>image/png</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span><span class=\"punctuation\">: </span>123456</span><br><span class=\"line\"><span class=\"attribute\">Last-Modified</span><span class=\"punctuation\">: </span>Mon, 01 Jan 2023 12:00:00 GMT</span><br><span class=\"line\"><span class=\"attribute\">ETag</span><span class=\"punctuation\">: </span>&quot;abc123&quot;</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span><span class=\"punctuation\">: </span>max-age=31536000</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li><code>Last-Modified</code>：表示资源最后修改的时间</li>\n<li><code>ETag</code>：资源的唯一标识符</li>\n<li><code>Cache-Control</code>：指示浏览器可以缓存该资源的时长</li>\n</ul>\n<h4 id=\"3、浏览器缓存资源\"><a href=\"#3、浏览器缓存资源\" class=\"headerlink\" title=\"3、浏览器缓存资源\"></a>3、浏览器缓存资源</h4><p>浏览器接收响应后，将image.png缓存到本地，并根据响应头信息（如<code>Last-Modified</code>和<code>ETag</code>）记录该资源的状态</p>\n<h3 id=\"第二次请求（缓存验证）\"><a href=\"#第二次请求（缓存验证）\" class=\"headerlink\" title=\"第二次请求（缓存验证）\"></a>第二次请求（缓存验证）</h3><h4 id=\"1、浏览器发送条件请求\"><a href=\"#1、浏览器发送条件请求\" class=\"headerlink\" title=\"1、浏览器发送条件请求\"></a>1、浏览器发送条件请求</h4><p>当用户再次访问同一资源，浏览器会检查缓存，如果该资源仍然有效，就发送一个带条件的 GET 请求到服务器，请求头如下：</p>\n<div class=\"code-container\" data-rel=\"Http\"><figure class=\"iseeu highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GET</span> <span class=\"string\">/image.png</span> <span class=\"meta\">HTTP/1.1</span></span><br><span class=\"line\"><span class=\"attribute\">Host</span><span class=\"punctuation\">: </span>example.com</span><br><span class=\"line\"><span class=\"attribute\">If-Modified-Since</span><span class=\"punctuation\">: </span>Mon, 01 Jan 2023 12:00:00 GMT</span><br><span class=\"line\"><span class=\"attribute\">If-None-Match</span><span class=\"punctuation\">: </span>&quot;abc123&quot;</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span><span class=\"punctuation\">: </span>Mozilla/5.0 ...</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li><code>If-Modified-Since</code>：告诉服务器，如果在指定日期之后资源被修改，则返回新的资源</li>\n<li><code>If-None-Match</code>：告诉服务器，如果资源的<code>ETag</code>与提供的值不匹配，则返回新的资源</li>\n</ul>\n<h4 id=\"2、服务器处理请求\"><a href=\"#2、服务器处理请求\" class=\"headerlink\" title=\"2、服务器处理请求\"></a>2、服务器处理请求</h4><p>服务器接收到条件请求后，检查该资源的状态：<br>如果资源自<code>Last-Modified</code>时间以来未被修改，且<code>ETag</code>匹配，那么服务器不会返回新的内容，而是返回 304 Not Modified。</p>\n<p>服务器返回如下响应：</p>\n<div class=\"code-container\" data-rel=\"Http\"><figure class=\"iseeu highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">HTTP/1.1</span> <span class=\"number\">304</span> Not Modified</span><br><span class=\"line\"><span class=\"attribute\">Date</span><span class=\"punctuation\">: </span>Mon, 02 Jan 2023 12:00:00 GMT</span><br></pre></td></tr></table></figure></div>\n\n<p><strong>注意：304 响应没有消息体，通常只包含必要的状态码和一些响应头。</strong></p>\n<h4 id=\"3、浏览器处理304响应\"><a href=\"#3、浏览器处理304响应\" class=\"headerlink\" title=\"3、浏览器处理304响应\"></a>3、浏览器处理304响应</h4><p>当浏览器接收到 304 Not Modified 响应时，了解到之前缓存的 image.png 仍然有效，因此直接使用缓存中的版本，而无需重新下载。</p>\n<h2 id=\"二、详细讨论\"><a href=\"#二、详细讨论\" class=\"headerlink\" title=\"二、详细讨论\"></a>二、详细讨论</h2><h3 id=\"1、是否禁止缓存\"><a href=\"#1、是否禁止缓存\" class=\"headerlink\" title=\"1、是否禁止缓存\"></a>1、是否禁止缓存</h3><p><strong>禁止缓存</strong>：缓存中不得存储任何关于客户端请求和服务端响应的内容，客户端每次发起的请求都会下载完整的响应内容</p>\n<p>在请求头中，<code>Cache-Control: no-store</code> 与 <code>Pragma: no-cache</code> 都可以禁止缓存</p>\n<ul>\n<li><code>Pragma: no-cache</code> 可用于 <code>http 1.0</code> 和 <code>http 1.1</code></li>\n<li><code>Cache-Control: no-store</code> 只能用于 <code>http 1.1</code></li>\n</ul>\n<h3 id=\"2、是否检查本地副本是否过期\"><a href=\"#2、是否检查本地副本是否过期\" class=\"headerlink\" title=\"2、是否检查本地副本是否过期\"></a>2、是否检查本地副本是否过期</h3><p>由 <code>Cache-Control</code> 的 <code>no-cache</code> 和 <code>must-revalidate</code> 两个可选值控制</p>\n<ul>\n<li><code>no-cache</code>：告诉浏览器、缓存服务器，不管本地副本是否过期，<strong>使用资源副本前，必须到源服务器进行副本有效性校验</strong></li>\n<li><code>must-revalidate</code>：告诉浏览器、缓存服务器，<strong>本地副本过期前，可使用本地副本</strong>；本地副本一旦过期，必须去源服务器进行有效性校验（如果没有该属性，若发生网络问题等情况，客户端可能直接使用本地缓存，而不会向服务器发起校验）</li>\n</ul>\n<h3 id=\"3、检查本地副本是否过期\"><a href=\"#3、检查本地副本是否过期\" class=\"headerlink\" title=\"3、检查本地副本是否过期\"></a>3、检查本地副本是否过期</h3><p>与「缓存的过期机制」相关的响应头字段（优先级依次降低）：</p>\n<h4 id=\"（1）max-age\"><a href=\"#（1）max-age\" class=\"headerlink\" title=\"（1）max-age=&lt;seconds&gt;\"></a>（1）<code>max-age=&lt;seconds&gt;</code></h4><p>表示资源能被缓存的最大时间，通常和 <code>must-revalidate</code> 一起使用。</p>\n<p>本地副本过期前，可使用本地副本，缓存时间为60秒；<br>如果本地副本已过期，则重新向服务器请求（要求必须进行有效性校验）：</p>\n<div class=\"code-container\" data-rel=\"Http\"><figure class=\"iseeu highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">Cache-Control</span><span class=\"punctuation\">: </span>max-age=60, must-revalidate</span><br></pre></td></tr></table></figure></div>\n\n<p>共享缓存（如代理服务器）将在60秒后失效，而个人用户的缓存则在120秒后失效：</p>\n<div class=\"code-container\" data-rel=\"Http\"><figure class=\"iseeu highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">Cache-Control</span><span class=\"punctuation\">: </span>max-age=120, smax-age=60</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"（2）Expires\"><a href=\"#（2）Expires\" class=\"headerlink\" title=\"（2）Expires\"></a>（2）<code>Expires</code></h4><p>表示资源的过期时间。<br>如果无<code>max-age</code>但有<code>Expires</code>，通过比较<code>Expires</code>和<code>Date</code>的值来判断是否缓存有效：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec71a24236~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png\"\n                      alt=\"图2\"\n                ></p>\n<h4 id=\"（3）Last-Modified\"><a href=\"#（3）Last-Modified\" class=\"headerlink\" title=\"（3）Last-Modified\"></a>（3）<code>Last-Modified</code></h4><p>表示资源的最后修改时间。<br>如果无<code>max-age</code>和<code>expires</code>但有<code>Last-Modified</code>，缓存的时长等于</p>\n<div class=\"code-container\" data-rel=\"Json\"><figure class=\"iseeu highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Date - Last-Modified) / <span class=\"number\">10</span></span><br></pre></td></tr></table></figure></div>\n\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec6d61c11a~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png\"\n                      alt=\"图3\"\n                ></p>\n<p><strong>如果都没有，浏览器将不会对该需求进行缓存。</strong></p>\n<h3 id=\"4、本地副本没过期\"><a href=\"#4、本地副本没过期\" class=\"headerlink\" title=\"4、本地副本没过期\"></a>4、本地副本没过期</h3><p>直接从缓存中读取资源，并返回200状态码。</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec7215656e~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png\"\n                      alt=\"图4\"\n                ></p>\n<h3 id=\"5、本地副本已过期\"><a href=\"#5、本地副本已过期\" class=\"headerlink\" title=\"5、本地副本已过期\"></a>5、本地副本已过期</h3><p>进行「源服务器进行有效性校验」的前期准备：</p>\n<h4 id=\"（1）If-None-Match\"><a href=\"#（1）If-None-Match\" class=\"headerlink\" title=\"（1）If-None-Match\"></a>（1）If-None-Match</h4><p>首先，在请求头里寻找<code>If-None-Match</code>字段（其值为服务器上次返回的<code>ETag</code>响应头的值）</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec71ddeec1~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png\"\n                      alt=\"图5\"\n                ><br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec89fb1991~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png\"\n                      alt=\"图6\"\n                ></p>\n<h4 id=\"（2）If-Modified-Since\"><a href=\"#（2）If-Modified-Since\" class=\"headerlink\" title=\"（2）If-Modified-Since\"></a>（2）If-Modified-Since</h4><p>如果没有<code>If-None-Match</code>，则在请求头中寻找<code>If-Modified-Since</code>字段（其值为服务器上次返回的<code>Last-Modified</code>响应头中的日期值）</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec8a29d072~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png\"\n                      alt=\"图7\"\n                ><br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eed35bf1c0e~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png\"\n                      alt=\"图8\"\n                ></p>\n<p>如果<code>If-None-Match</code>与<code>If-Modified-Since</code>都没有，则直接向服务器请求数据</p>\n<h3 id=\"6、去源服务器进行有效性校验\"><a href=\"#6、去源服务器进行有效性校验\" class=\"headerlink\" title=\"6、去源服务器进行有效性校验\"></a>6、去源服务器进行有效性校验</h3><p>如果请求头中有<code>If-None-Match</code>或<code>If-Modified-Since</code>，则到源服务器进行有效性校验。<br>如果源服务器资源没有变化，则返回304；如果有变化，则返回200。</p>\n<h3 id=\"7、上述流程的总结图\"><a href=\"#7、上述流程的总结图\" class=\"headerlink\" title=\"7、上述流程的总结图\"></a>7、上述流程的总结图</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eed5984fb4b~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png\"\n                      alt=\"图9\"\n                ></p>\n<h2 id=\"三、意义\"><a href=\"#三、意义\" class=\"headerlink\" title=\"三、意义\"></a>三、意义</h2><ul>\n<li><strong>避免了不必要的数据传输，提高了网络效率和用户体验</strong>；</li>\n<li><strong>在频繁访问相同资源的情况下，可以显著降低带宽消耗和服务器负载</strong>。</li>\n</ul>\n<h2 id=\"四、补充\"><a href=\"#四、补充\" class=\"headerlink\" title=\"四、补充\"></a>四、补充</h2><h3 id=\"私有缓存和公共缓存\"><a href=\"#私有缓存和公共缓存\" class=\"headerlink\" title=\"私有缓存和公共缓存\"></a>私有缓存和公共缓存</h3><p>在<code>Cache-Control</code>还有两个值：<code>private</code>与<code>public</code>：</p>\n<ul>\n<li>public 表示该响应可被任何中间人（比如中间代理、CDN等）缓存。</li>\n<li>private 表示该响应是专用于某单个用户的，不能被中间人缓存，应该用于浏览器的私有缓存中，比如：带有HTTP验证信息（帐号密码）的页面 或 某些特定影响状态码的页面*。</li>\n</ul>\n<p>“某些特定影响状态码的页面”指具有特殊语义的状态码，比如：</p>\n<h5 id=\"（1）401-Unauthorized\"><a href=\"#（1）401-Unauthorized\" class=\"headerlink\" title=\"（1）401 Unauthorized\"></a>（1）401 Unauthorized</h5><p>当访问受保护的资源时，如果用户未通过身份验证，服务器可能返回401状态码。<br>此时通常只应允许客户端缓存该响应，因为该内容对其他用户是不适用的。</p>\n<h4 id=\"（2）403-Forbidden\"><a href=\"#（2）403-Forbidden\" class=\"headerlink\" title=\"（2）403 Forbidden\"></a>（2）403 Forbidden</h4><p>表示服务器理解请求但拒绝执行它。<br>在某些情况下，公共内容也可能出于安全考虑而不被中间缓存，因此可标记为 private。</p>\n<h5 id=\"（2）404-Not-Found\"><a href=\"#（2）404-Not-Found\" class=\"headerlink\" title=\"（2）404 Not Found\"></a>（2）404 Not Found</h5><p>如果某资源不存在，虽然它是公开的，但可能在某些应用场景下不希望被中间缓存。</p>\n<h5 id=\"（3）500-Internal-Server-Error\"><a href=\"#（3）500-Internal-Server-Error\" class=\"headerlink\" title=\"（3）500 Internal Server Error\"></a>（3）500 Internal Server Error</h5><p>表示服务器出现了问题，返回的内容可能不稳定，因此不应被中间缓存。</p>\n<h4 id=\"private-使用场景\"><a href=\"#private-使用场景\" class=\"headerlink\" title=\"private 使用场景\"></a>private 使用场景</h4><h5 id=\"（1）用户特定数据\"><a href=\"#（1）用户特定数据\" class=\"headerlink\" title=\"（1）用户特定数据\"></a>（1）用户特定数据</h5><p>如个性化推荐、用户历史记录等，仅对特定用户合适，其他用户无法访问，即便返回成功状态，为了保护用户隐私，建议使用 private。</p>\n<h5 id=\"（2）临时性数据\"><a href=\"#（2）临时性数据\" class=\"headerlink\" title=\"（2）临时性数据\"></a>（2）临时性数据</h5><p>如操作结果、表单提交后给予反馈的信息等，这类信息通常只需当前用户知道，对其他用户无意义，适合标记为 private。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>出现304状态码的条件</p>\n<ul>\n<li>不禁止缓存</li>\n<li>不检查本地缓存是否过期；或者检查本地缓存、且未过期</li>\n<li>响应头有<code>Etag</code>（则下次的请求头中有<code>If-None-Match</code>）；或者响应头有<code>Last-Modified</code>（则下次的请求头中有<code>If-Modified-since</code>）</li>\n<li>缓存有效</li>\n</ul>\n<p>注意：下图中的<code>Etag</code>和<code>Last-Modified</code>之间不存在先后顺序</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2017/11/22/15fe1d6fc1269a86~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png\"\n                      alt=\"图1\"\n                ></p>\n<h2 id=\"一、304请求的交互过程\"><a href=\"#一、304请求的交互过程\" class=\"headerlink\" title=\"一、304请求的交互过程\"></a>一、304请求的交互过程</h2><p>假设用户通过浏览器访问某静态资源（比如图片image.png），且该资源之前已被浏览器缓存，现在分析两次请求的交互过程。</p>\n<h3 id=\"第一次请求（初始加载）\"><a href=\"#第一次请求（初始加载）\" class=\"headerlink\" title=\"第一次请求（初始加载）\"></a>第一次请求（初始加载）</h3><h4 id=\"1、浏览器发送请求\"><a href=\"#1、浏览器发送请求\" class=\"headerlink\" title=\"1、浏览器发送请求\"></a>1、浏览器发送请求</h4><p>用户在浏览器中输入 URL，浏览器向服务器发送 GET 请求，获取 image.png。<br>请求头可能如下：</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GET</span> <span class=\"string\">/image.png</span> <span class=\"meta\">HTTP/1.1</span></span><br><span class=\"line\"><span class=\"attribute\">Host</span><span class=\"punctuation\">: </span>example.com</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span><span class=\"punctuation\">: </span>Mozilla/5.0 ...</span><br><span class=\"line\"><span class=\"attribute\">Accept</span><span class=\"punctuation\">: </span>image/webp,image/apng,image/*,*/*;q=0.8</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2、服务器响应\"><a href=\"#2、服务器响应\" class=\"headerlink\" title=\"2、服务器响应\"></a>2、服务器响应</h4><p>服务器处理请求，并返回 200 OK 响应，同时附带以下响应头：</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">HTTP/1.1</span> <span class=\"number\">200</span> OK</span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span><span class=\"punctuation\">: </span>image/png</span><br><span class=\"line\"><span class=\"attribute\">Content-Length</span><span class=\"punctuation\">: </span>123456</span><br><span class=\"line\"><span class=\"attribute\">Last-Modified</span><span class=\"punctuation\">: </span>Mon, 01 Jan 2023 12:00:00 GMT</span><br><span class=\"line\"><span class=\"attribute\">ETag</span><span class=\"punctuation\">: </span>&quot;abc123&quot;</span><br><span class=\"line\"><span class=\"attribute\">Cache-Control</span><span class=\"punctuation\">: </span>max-age=31536000</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>Last-Modified</code>：表示资源最后修改的时间</li>\n<li><code>ETag</code>：资源的唯一标识符</li>\n<li><code>Cache-Control</code>：指示浏览器可以缓存该资源的时长</li>\n</ul>\n<h4 id=\"3、浏览器缓存资源\"><a href=\"#3、浏览器缓存资源\" class=\"headerlink\" title=\"3、浏览器缓存资源\"></a>3、浏览器缓存资源</h4><p>浏览器接收响应后，将image.png缓存到本地，并根据响应头信息（如<code>Last-Modified</code>和<code>ETag</code>）记录该资源的状态</p>\n<h3 id=\"第二次请求（缓存验证）\"><a href=\"#第二次请求（缓存验证）\" class=\"headerlink\" title=\"第二次请求（缓存验证）\"></a>第二次请求（缓存验证）</h3><h4 id=\"1、浏览器发送条件请求\"><a href=\"#1、浏览器发送条件请求\" class=\"headerlink\" title=\"1、浏览器发送条件请求\"></a>1、浏览器发送条件请求</h4><p>当用户再次访问同一资源，浏览器会检查缓存，如果该资源仍然有效，就发送一个带条件的 GET 请求到服务器，请求头如下：</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GET</span> <span class=\"string\">/image.png</span> <span class=\"meta\">HTTP/1.1</span></span><br><span class=\"line\"><span class=\"attribute\">Host</span><span class=\"punctuation\">: </span>example.com</span><br><span class=\"line\"><span class=\"attribute\">If-Modified-Since</span><span class=\"punctuation\">: </span>Mon, 01 Jan 2023 12:00:00 GMT</span><br><span class=\"line\"><span class=\"attribute\">If-None-Match</span><span class=\"punctuation\">: </span>&quot;abc123&quot;</span><br><span class=\"line\"><span class=\"attribute\">User-Agent</span><span class=\"punctuation\">: </span>Mozilla/5.0 ...</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>If-Modified-Since</code>：告诉服务器，如果在指定日期之后资源被修改，则返回新的资源</li>\n<li><code>If-None-Match</code>：告诉服务器，如果资源的<code>ETag</code>与提供的值不匹配，则返回新的资源</li>\n</ul>\n<h4 id=\"2、服务器处理请求\"><a href=\"#2、服务器处理请求\" class=\"headerlink\" title=\"2、服务器处理请求\"></a>2、服务器处理请求</h4><p>服务器接收到条件请求后，检查该资源的状态：<br>如果资源自<code>Last-Modified</code>时间以来未被修改，且<code>ETag</code>匹配，那么服务器不会返回新的内容，而是返回 304 Not Modified。</p>\n<p>服务器返回如下响应：</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">HTTP/1.1</span> <span class=\"number\">304</span> Not Modified</span><br><span class=\"line\"><span class=\"attribute\">Date</span><span class=\"punctuation\">: </span>Mon, 02 Jan 2023 12:00:00 GMT</span><br></pre></td></tr></table></figure>\n\n<p><strong>注意：304 响应没有消息体，通常只包含必要的状态码和一些响应头。</strong></p>\n<h4 id=\"3、浏览器处理304响应\"><a href=\"#3、浏览器处理304响应\" class=\"headerlink\" title=\"3、浏览器处理304响应\"></a>3、浏览器处理304响应</h4><p>当浏览器接收到 304 Not Modified 响应时，了解到之前缓存的 image.png 仍然有效，因此直接使用缓存中的版本，而无需重新下载。</p>\n<h2 id=\"二、详细讨论\"><a href=\"#二、详细讨论\" class=\"headerlink\" title=\"二、详细讨论\"></a>二、详细讨论</h2><h3 id=\"1、是否禁止缓存\"><a href=\"#1、是否禁止缓存\" class=\"headerlink\" title=\"1、是否禁止缓存\"></a>1、是否禁止缓存</h3><p><strong>禁止缓存</strong>：缓存中不得存储任何关于客户端请求和服务端响应的内容，客户端每次发起的请求都会下载完整的响应内容</p>\n<p>在请求头中，<code>Cache-Control: no-store</code> 与 <code>Pragma: no-cache</code> 都可以禁止缓存</p>\n<ul>\n<li><code>Pragma: no-cache</code> 可用于 <code>http 1.0</code> 和 <code>http 1.1</code></li>\n<li><code>Cache-Control: no-store</code> 只能用于 <code>http 1.1</code></li>\n</ul>\n<h3 id=\"2、是否检查本地副本是否过期\"><a href=\"#2、是否检查本地副本是否过期\" class=\"headerlink\" title=\"2、是否检查本地副本是否过期\"></a>2、是否检查本地副本是否过期</h3><p>由 <code>Cache-Control</code> 的 <code>no-cache</code> 和 <code>must-revalidate</code> 两个可选值控制</p>\n<ul>\n<li><code>no-cache</code>：告诉浏览器、缓存服务器，不管本地副本是否过期，<strong>使用资源副本前，必须到源服务器进行副本有效性校验</strong></li>\n<li><code>must-revalidate</code>：告诉浏览器、缓存服务器，<strong>本地副本过期前，可使用本地副本</strong>；本地副本一旦过期，必须去源服务器进行有效性校验（如果没有该属性，若发生网络问题等情况，客户端可能直接使用本地缓存，而不会向服务器发起校验）</li>\n</ul>\n<h3 id=\"3、检查本地副本是否过期\"><a href=\"#3、检查本地副本是否过期\" class=\"headerlink\" title=\"3、检查本地副本是否过期\"></a>3、检查本地副本是否过期</h3><p>与「缓存的过期机制」相关的响应头字段（优先级依次降低）：</p>\n<h4 id=\"（1）max-age\"><a href=\"#（1）max-age\" class=\"headerlink\" title=\"（1）max-age=&lt;seconds&gt;\"></a>（1）<code>max-age=&lt;seconds&gt;</code></h4><p>表示资源能被缓存的最大时间，通常和 <code>must-revalidate</code> 一起使用。</p>\n<p>本地副本过期前，可使用本地副本，缓存时间为60秒；<br>如果本地副本已过期，则重新向服务器请求（要求必须进行有效性校验）：</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">Cache-Control</span><span class=\"punctuation\">: </span>max-age=60, must-revalidate</span><br></pre></td></tr></table></figure>\n\n<p>共享缓存（如代理服务器）将在60秒后失效，而个人用户的缓存则在120秒后失效：</p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">Cache-Control</span><span class=\"punctuation\">: </span>max-age=120, smax-age=60</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"（2）Expires\"><a href=\"#（2）Expires\" class=\"headerlink\" title=\"（2）Expires\"></a>（2）<code>Expires</code></h4><p>表示资源的过期时间。<br>如果无<code>max-age</code>但有<code>Expires</code>，通过比较<code>Expires</code>和<code>Date</code>的值来判断是否缓存有效：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec71a24236~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png\"\n                      alt=\"图2\"\n                ></p>\n<h4 id=\"（3）Last-Modified\"><a href=\"#（3）Last-Modified\" class=\"headerlink\" title=\"（3）Last-Modified\"></a>（3）<code>Last-Modified</code></h4><p>表示资源的最后修改时间。<br>如果无<code>max-age</code>和<code>expires</code>但有<code>Last-Modified</code>，缓存的时长等于</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Date - Last-Modified) / <span class=\"number\">10</span></span><br></pre></td></tr></table></figure>\n\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec6d61c11a~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png\"\n                      alt=\"图3\"\n                ></p>\n<p><strong>如果都没有，浏览器将不会对该需求进行缓存。</strong></p>\n<h3 id=\"4、本地副本没过期\"><a href=\"#4、本地副本没过期\" class=\"headerlink\" title=\"4、本地副本没过期\"></a>4、本地副本没过期</h3><p>直接从缓存中读取资源，并返回200状态码。</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec7215656e~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png\"\n                      alt=\"图4\"\n                ></p>\n<h3 id=\"5、本地副本已过期\"><a href=\"#5、本地副本已过期\" class=\"headerlink\" title=\"5、本地副本已过期\"></a>5、本地副本已过期</h3><p>进行「源服务器进行有效性校验」的前期准备：</p>\n<h4 id=\"（1）If-None-Match\"><a href=\"#（1）If-None-Match\" class=\"headerlink\" title=\"（1）If-None-Match\"></a>（1）If-None-Match</h4><p>首先，在请求头里寻找<code>If-None-Match</code>字段（其值为服务器上次返回的<code>ETag</code>响应头的值）</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec71ddeec1~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png\"\n                      alt=\"图5\"\n                ><br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec89fb1991~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png\"\n                      alt=\"图6\"\n                ></p>\n<h4 id=\"（2）If-Modified-Since\"><a href=\"#（2）If-Modified-Since\" class=\"headerlink\" title=\"（2）If-Modified-Since\"></a>（2）If-Modified-Since</h4><p>如果没有<code>If-None-Match</code>，则在请求头中寻找<code>If-Modified-Since</code>字段（其值为服务器上次返回的<code>Last-Modified</code>响应头中的日期值）</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eec8a29d072~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png\"\n                      alt=\"图7\"\n                ><br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eed35bf1c0e~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png\"\n                      alt=\"图8\"\n                ></p>\n<p>如果<code>If-None-Match</code>与<code>If-Modified-Since</code>都没有，则直接向服务器请求数据</p>\n<h3 id=\"6、去源服务器进行有效性校验\"><a href=\"#6、去源服务器进行有效性校验\" class=\"headerlink\" title=\"6、去源服务器进行有效性校验\"></a>6、去源服务器进行有效性校验</h3><p>如果请求头中有<code>If-None-Match</code>或<code>If-Modified-Since</code>，则到源服务器进行有效性校验。<br>如果源服务器资源没有变化，则返回304；如果有变化，则返回200。</p>\n<h3 id=\"7、上述流程的总结图\"><a href=\"#7、上述流程的总结图\" class=\"headerlink\" title=\"7、上述流程的总结图\"></a>7、上述流程的总结图</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/8/24/16569eed5984fb4b~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png\"\n                      alt=\"图9\"\n                ></p>\n<h2 id=\"三、意义\"><a href=\"#三、意义\" class=\"headerlink\" title=\"三、意义\"></a>三、意义</h2><ul>\n<li><strong>避免了不必要的数据传输，提高了网络效率和用户体验</strong>；</li>\n<li><strong>在频繁访问相同资源的情况下，可以显著降低带宽消耗和服务器负载</strong>。</li>\n</ul>\n<h2 id=\"四、补充\"><a href=\"#四、补充\" class=\"headerlink\" title=\"四、补充\"></a>四、补充</h2><h3 id=\"私有缓存和公共缓存\"><a href=\"#私有缓存和公共缓存\" class=\"headerlink\" title=\"私有缓存和公共缓存\"></a>私有缓存和公共缓存</h3><p>在<code>Cache-Control</code>还有两个值：<code>private</code>与<code>public</code>：</p>\n<ul>\n<li>public 表示该响应可被任何中间人（比如中间代理、CDN等）缓存。</li>\n<li>private 表示该响应是专用于某单个用户的，不能被中间人缓存，应该用于浏览器的私有缓存中，比如：带有HTTP验证信息（帐号密码）的页面 或 某些特定影响状态码的页面*。</li>\n</ul>\n<p>“某些特定影响状态码的页面”指具有特殊语义的状态码，比如：</p>\n<h5 id=\"（1）401-Unauthorized\"><a href=\"#（1）401-Unauthorized\" class=\"headerlink\" title=\"（1）401 Unauthorized\"></a>（1）401 Unauthorized</h5><p>当访问受保护的资源时，如果用户未通过身份验证，服务器可能返回401状态码。<br>此时通常只应允许客户端缓存该响应，因为该内容对其他用户是不适用的。</p>\n<h4 id=\"（2）403-Forbidden\"><a href=\"#（2）403-Forbidden\" class=\"headerlink\" title=\"（2）403 Forbidden\"></a>（2）403 Forbidden</h4><p>表示服务器理解请求但拒绝执行它。<br>在某些情况下，公共内容也可能出于安全考虑而不被中间缓存，因此可标记为 private。</p>\n<h5 id=\"（2）404-Not-Found\"><a href=\"#（2）404-Not-Found\" class=\"headerlink\" title=\"（2）404 Not Found\"></a>（2）404 Not Found</h5><p>如果某资源不存在，虽然它是公开的，但可能在某些应用场景下不希望被中间缓存。</p>\n<h5 id=\"（3）500-Internal-Server-Error\"><a href=\"#（3）500-Internal-Server-Error\" class=\"headerlink\" title=\"（3）500 Internal Server Error\"></a>（3）500 Internal Server Error</h5><p>表示服务器出现了问题，返回的内容可能不稳定，因此不应被中间缓存。</p>\n<h4 id=\"private-使用场景\"><a href=\"#private-使用场景\" class=\"headerlink\" title=\"private 使用场景\"></a>private 使用场景</h4><h5 id=\"（1）用户特定数据\"><a href=\"#（1）用户特定数据\" class=\"headerlink\" title=\"（1）用户特定数据\"></a>（1）用户特定数据</h5><p>如个性化推荐、用户历史记录等，仅对特定用户合适，其他用户无法访问，即便返回成功状态，为了保护用户隐私，建议使用 private。</p>\n<h5 id=\"（2）临时性数据\"><a href=\"#（2）临时性数据\" class=\"headerlink\" title=\"（2）临时性数据\"></a>（2）临时性数据</h5><p>如操作结果、表单提交后给予反馈的信息等，这类信息通常只需当前用户知道，对其他用户无意义，适合标记为 private。</p>\n","_processedHighlight":true},{"title":"DNS","date":"2024-10-18T13:30:22.000Z","_content":"\n## 一、定义\n\nDNS 是：\n\n- 一个使得主机能够查询分布式数据库的**应用层协议**\n- 一个由分层的 DNS 服务器实现的**分布式数据库**\n\n（1）DNS 是一个分布式数据库，整个 DNS 系统由分散在世界各地的很多 DNS 服务器组成，每台服务器上都保存了一些数据，可以让我们最终查到主机名对应的 IP。\n\n（2）DNS 是一个应用层协议，发送一个包含所查询主机名的请求，它会返回该主机名对应的 IP。\n\n**分布式：** 世界上没有一台 DNS 服务器拥有因特网上所有主机的映射，每台 DNS 只负责部分映射。\n\n## 二、层次\n\nDNS 服务器有 3 种类型：\n\n- 根 DNS 服务器\n- 顶级域（Top-Level Domain, TLD）\n- DNS 服务器\n- 权威 DNS 服务器\n\n![图1](https://img1.baidu.com/it/u=2736501838,3539264290&fm=253&fmt=auto&app=138&f=PNG?w=722&h=408)\n\n### 1、根 DNS 服务器\n\n比如 `www.baidu.com`，其完整写法是 `www.baidu.com.`，最后的这个 `.` 就是根域名。\n\n通过询问根 DNS 服务器，可以知道它的下一级，也就是顶级域 DNS 服务器的 IP 是多少，从而继续向顶级域 DNS 服务器发起查询请求。\n\n### 2、顶级域 DNS 服务器\n\n除了前面提到的 `com` 是顶级域名，常见的顶级域名还有 `cn`、`org`、`edu` 等。顶级域 DNS 服务器，也就是 TLD，提供了它的下一级，也就是权威 DNS 服务器的 IP 地址。\n\n### 3、权威 DNS 服务器\n\n权威 DNS 服务器可以返回主机和IP之间的最终映射。\n\n## 三、本地 DNS 服务器\n\n每个 ISP（Internet Server Provider, 网络服务提供商）都有一台本地 DNS 服务器，比如一个居民区的 ISP、一个大学的 ISP、一个机构的 ISP，都有一台或多台本地 DNS 服务器。\n\n当主机发出 DNS 请求时，该请求被发往本地 DNS 服务器，**本地 DNS 服务器起着代理的作用，并负责将该请求转发到 DNS 服务器层次结构中。**\n\n严格来说，本地 DNS 服务器不属于 DNS 的层次结构。\n\n## 四、递归查询、迭代查询\n\n如下图，假设主机 m.n.com 想要获取主机 a.b.com 的 IP 地址，会经过以下几个步骤：\n\n![图2](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6bb796a3045e409aabb0f89ad40d3fad~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.webp)\n\n（1）首先，主机 m.n.com 向它的本地 DNS 服务器发送一个 DNS 查询报文，包含期待被转换的主机名 a.b.com；\n\n（2）本地 DNS 服务器将该报文转发到根 DNS 服务器；\n\n（3）该根 DNS 服务器注意到 com 前缀，向本地 DNS 服务器返回 com 对应的顶级域 DNS 服务器（TLD）的 IP 地址列表。\n\n（4）本地 DNS 服务器则向其中一台 TLD 服务器发送查询报文；\n\n（5）该 TLD 服务器注意到 b.com 前缀，向本地 DNS 服务器返回权威 DNS 服务器的 IP 地址。\n\n（6）本地 DNS 服务器又向其中一台权威服务器发送查询报文；\n\n（7）该权威服务器返回了 a.b.com 的 IP 地址；\n\n（8）本地 DNS 服务器将 a.b.com 跟 IP 地址的映射返回给主机 m.n.com，m.n.com 就可以用该 IP 向 a.b.com 发送请求了。\n\n### 1、递归\n\n主机 m.n.com 向本地 DNS 服务器 dns.n.com 发出的查询就是递归查询，这个查询是主机 m.n.com 以自己的名义向本地 DNS 服务器请求想要的 IP 映射，并且本地 DNS 服务器直接返回映射结果给到主机。\n\n### 2、迭代\n\n而后继的三个查询是迭代查询，包括本地 DNS 服务器向根 DNS 服务器发送查询请求、本地 DNS 服务器向 TLD 服务器发送查询请求、本地 DNS 服务器向权威 DNS 服务器发送查询请求，所有的请求都是由本地 DNS 服务器发出，所有的响应都是直接返回给本地 DNS 服务器。\n\n### 3、另一种 DNS 查询\n\n从理论上讲，任何 DNS 查询既可以是递归的，也可以是迭代的。下图的所有查询就都是递归的，不包含迭代。\n\n![图3](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd1422f81c2647a19cde72cb9694bc89~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.webp)\n\n#### TLD 一定知道权威 DNS 服务器的 IP 地址吗？\n\n不一定，有时 TLD 只是知道中间的某个 DNS 服务器，再由这个中间 DNS 服务器去找到权威 DNS 服务器。\n\n这种情况不仅增加了延迟，还使得网络上需要传输更多的数据包，也会产生更多的 DNS 报文。\n\n## 五、DNS 优化\n\n### 1、DNS 缓存\n\nDNS 存在多级缓存，从离浏览器的距离排序，有以下几种：\n浏览器缓存，系统缓存，路由器缓存，IPS 服务器缓存，根域名服务器缓存，顶级域名服务器缓存，主域名服务器缓存。\n\n- 在chrome浏览器中输入 `chrome://net-internals/#dns`，可以看到chrome浏览器的DNS缓存\n- 系统缓存主要存在 `/etc/hosts` （Linux系统）中\n\n缓存并不是永久的，每一条映射记录都有对应的生存时间，一旦过了生存时间，该条记录就会从缓存移出。\n\n### 2、DNS 负载均衡\n\n访问某网站的时候，每次响应的很可能不是同一个服务器（IP 地址不同），因为一般公司都有多台服务器来支撑访问，而 DNS 会返回一个合适的机器的 IP 给用户（**根据每台机器的负载量、该机器和用户地理位置的距离等**），这就是 DNS 负载均衡。\n","source":"_posts/25-DNS.md","raw":"---\ntitle: DNS\ndate: 2024-10-18 21:30:22\ntags:\n    - 面经\n    - 计算机网络\n    - DNS\ncategories:\n    - 计算机网络\n      - DNS\n---\n\n## 一、定义\n\nDNS 是：\n\n- 一个使得主机能够查询分布式数据库的**应用层协议**\n- 一个由分层的 DNS 服务器实现的**分布式数据库**\n\n（1）DNS 是一个分布式数据库，整个 DNS 系统由分散在世界各地的很多 DNS 服务器组成，每台服务器上都保存了一些数据，可以让我们最终查到主机名对应的 IP。\n\n（2）DNS 是一个应用层协议，发送一个包含所查询主机名的请求，它会返回该主机名对应的 IP。\n\n**分布式：** 世界上没有一台 DNS 服务器拥有因特网上所有主机的映射，每台 DNS 只负责部分映射。\n\n## 二、层次\n\nDNS 服务器有 3 种类型：\n\n- 根 DNS 服务器\n- 顶级域（Top-Level Domain, TLD）\n- DNS 服务器\n- 权威 DNS 服务器\n\n![图1](https://img1.baidu.com/it/u=2736501838,3539264290&fm=253&fmt=auto&app=138&f=PNG?w=722&h=408)\n\n### 1、根 DNS 服务器\n\n比如 `www.baidu.com`，其完整写法是 `www.baidu.com.`，最后的这个 `.` 就是根域名。\n\n通过询问根 DNS 服务器，可以知道它的下一级，也就是顶级域 DNS 服务器的 IP 是多少，从而继续向顶级域 DNS 服务器发起查询请求。\n\n### 2、顶级域 DNS 服务器\n\n除了前面提到的 `com` 是顶级域名，常见的顶级域名还有 `cn`、`org`、`edu` 等。顶级域 DNS 服务器，也就是 TLD，提供了它的下一级，也就是权威 DNS 服务器的 IP 地址。\n\n### 3、权威 DNS 服务器\n\n权威 DNS 服务器可以返回主机和IP之间的最终映射。\n\n## 三、本地 DNS 服务器\n\n每个 ISP（Internet Server Provider, 网络服务提供商）都有一台本地 DNS 服务器，比如一个居民区的 ISP、一个大学的 ISP、一个机构的 ISP，都有一台或多台本地 DNS 服务器。\n\n当主机发出 DNS 请求时，该请求被发往本地 DNS 服务器，**本地 DNS 服务器起着代理的作用，并负责将该请求转发到 DNS 服务器层次结构中。**\n\n严格来说，本地 DNS 服务器不属于 DNS 的层次结构。\n\n## 四、递归查询、迭代查询\n\n如下图，假设主机 m.n.com 想要获取主机 a.b.com 的 IP 地址，会经过以下几个步骤：\n\n![图2](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6bb796a3045e409aabb0f89ad40d3fad~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.webp)\n\n（1）首先，主机 m.n.com 向它的本地 DNS 服务器发送一个 DNS 查询报文，包含期待被转换的主机名 a.b.com；\n\n（2）本地 DNS 服务器将该报文转发到根 DNS 服务器；\n\n（3）该根 DNS 服务器注意到 com 前缀，向本地 DNS 服务器返回 com 对应的顶级域 DNS 服务器（TLD）的 IP 地址列表。\n\n（4）本地 DNS 服务器则向其中一台 TLD 服务器发送查询报文；\n\n（5）该 TLD 服务器注意到 b.com 前缀，向本地 DNS 服务器返回权威 DNS 服务器的 IP 地址。\n\n（6）本地 DNS 服务器又向其中一台权威服务器发送查询报文；\n\n（7）该权威服务器返回了 a.b.com 的 IP 地址；\n\n（8）本地 DNS 服务器将 a.b.com 跟 IP 地址的映射返回给主机 m.n.com，m.n.com 就可以用该 IP 向 a.b.com 发送请求了。\n\n### 1、递归\n\n主机 m.n.com 向本地 DNS 服务器 dns.n.com 发出的查询就是递归查询，这个查询是主机 m.n.com 以自己的名义向本地 DNS 服务器请求想要的 IP 映射，并且本地 DNS 服务器直接返回映射结果给到主机。\n\n### 2、迭代\n\n而后继的三个查询是迭代查询，包括本地 DNS 服务器向根 DNS 服务器发送查询请求、本地 DNS 服务器向 TLD 服务器发送查询请求、本地 DNS 服务器向权威 DNS 服务器发送查询请求，所有的请求都是由本地 DNS 服务器发出，所有的响应都是直接返回给本地 DNS 服务器。\n\n### 3、另一种 DNS 查询\n\n从理论上讲，任何 DNS 查询既可以是递归的，也可以是迭代的。下图的所有查询就都是递归的，不包含迭代。\n\n![图3](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd1422f81c2647a19cde72cb9694bc89~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.webp)\n\n#### TLD 一定知道权威 DNS 服务器的 IP 地址吗？\n\n不一定，有时 TLD 只是知道中间的某个 DNS 服务器，再由这个中间 DNS 服务器去找到权威 DNS 服务器。\n\n这种情况不仅增加了延迟，还使得网络上需要传输更多的数据包，也会产生更多的 DNS 报文。\n\n## 五、DNS 优化\n\n### 1、DNS 缓存\n\nDNS 存在多级缓存，从离浏览器的距离排序，有以下几种：\n浏览器缓存，系统缓存，路由器缓存，IPS 服务器缓存，根域名服务器缓存，顶级域名服务器缓存，主域名服务器缓存。\n\n- 在chrome浏览器中输入 `chrome://net-internals/#dns`，可以看到chrome浏览器的DNS缓存\n- 系统缓存主要存在 `/etc/hosts` （Linux系统）中\n\n缓存并不是永久的，每一条映射记录都有对应的生存时间，一旦过了生存时间，该条记录就会从缓存移出。\n\n### 2、DNS 负载均衡\n\n访问某网站的时候，每次响应的很可能不是同一个服务器（IP 地址不同），因为一般公司都有多台服务器来支撑访问，而 DNS 会返回一个合适的机器的 IP 给用户（**根据每台机器的负载量、该机器和用户地理位置的距离等**），这就是 DNS 负载均衡。\n","slug":"25-DNS","published":1,"updated":"2025-05-20T02:47:28.683Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu8001i6kprb6h5a4q5","content":"<h2 id=\"一、定义\"><a href=\"#一、定义\" class=\"headerlink\" title=\"一、定义\"></a>一、定义</h2><p>DNS 是：</p>\n<ul>\n<li>一个使得主机能够查询分布式数据库的<strong>应用层协议</strong></li>\n<li>一个由分层的 DNS 服务器实现的<strong>分布式数据库</strong></li>\n</ul>\n<p>（1）DNS 是一个分布式数据库，整个 DNS 系统由分散在世界各地的很多 DNS 服务器组成，每台服务器上都保存了一些数据，可以让我们最终查到主机名对应的 IP。</p>\n<p>（2）DNS 是一个应用层协议，发送一个包含所查询主机名的请求，它会返回该主机名对应的 IP。</p>\n<p><strong>分布式：</strong> 世界上没有一台 DNS 服务器拥有因特网上所有主机的映射，每台 DNS 只负责部分映射。</p>\n<h2 id=\"二、层次\"><a href=\"#二、层次\" class=\"headerlink\" title=\"二、层次\"></a>二、层次</h2><p>DNS 服务器有 3 种类型：</p>\n<ul>\n<li>根 DNS 服务器</li>\n<li>顶级域（Top-Level Domain, TLD）</li>\n<li>DNS 服务器</li>\n<li>权威 DNS 服务器</li>\n</ul>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://img1.baidu.com/it/u=2736501838,3539264290&fm=253&fmt=auto&app=138&f=PNG?w=722&h=408\"\n                      alt=\"图1\"\n                ></p>\n<h3 id=\"1、根-DNS-服务器\"><a href=\"#1、根-DNS-服务器\" class=\"headerlink\" title=\"1、根 DNS 服务器\"></a>1、根 DNS 服务器</h3><p>比如 <code>www.baidu.com</code>，其完整写法是 <code>www.baidu.com.</code>，最后的这个 <code>.</code> 就是根域名。</p>\n<p>通过询问根 DNS 服务器，可以知道它的下一级，也就是顶级域 DNS 服务器的 IP 是多少，从而继续向顶级域 DNS 服务器发起查询请求。</p>\n<h3 id=\"2、顶级域-DNS-服务器\"><a href=\"#2、顶级域-DNS-服务器\" class=\"headerlink\" title=\"2、顶级域 DNS 服务器\"></a>2、顶级域 DNS 服务器</h3><p>除了前面提到的 <code>com</code> 是顶级域名，常见的顶级域名还有 <code>cn</code>、<code>org</code>、<code>edu</code> 等。顶级域 DNS 服务器，也就是 TLD，提供了它的下一级，也就是权威 DNS 服务器的 IP 地址。</p>\n<h3 id=\"3、权威-DNS-服务器\"><a href=\"#3、权威-DNS-服务器\" class=\"headerlink\" title=\"3、权威 DNS 服务器\"></a>3、权威 DNS 服务器</h3><p>权威 DNS 服务器可以返回主机和IP之间的最终映射。</p>\n<h2 id=\"三、本地-DNS-服务器\"><a href=\"#三、本地-DNS-服务器\" class=\"headerlink\" title=\"三、本地 DNS 服务器\"></a>三、本地 DNS 服务器</h2><p>每个 ISP（Internet Server Provider, 网络服务提供商）都有一台本地 DNS 服务器，比如一个居民区的 ISP、一个大学的 ISP、一个机构的 ISP，都有一台或多台本地 DNS 服务器。</p>\n<p>当主机发出 DNS 请求时，该请求被发往本地 DNS 服务器，<strong>本地 DNS 服务器起着代理的作用，并负责将该请求转发到 DNS 服务器层次结构中。</strong></p>\n<p>严格来说，本地 DNS 服务器不属于 DNS 的层次结构。</p>\n<h2 id=\"四、递归查询、迭代查询\"><a href=\"#四、递归查询、迭代查询\" class=\"headerlink\" title=\"四、递归查询、迭代查询\"></a>四、递归查询、迭代查询</h2><p>如下图，假设主机 m.n.com 想要获取主机 a.b.com 的 IP 地址，会经过以下几个步骤：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6bb796a3045e409aabb0f89ad40d3fad~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.webp\"\n                      alt=\"图2\"\n                ></p>\n<p>（1）首先，主机 m.n.com 向它的本地 DNS 服务器发送一个 DNS 查询报文，包含期待被转换的主机名 a.b.com；</p>\n<p>（2）本地 DNS 服务器将该报文转发到根 DNS 服务器；</p>\n<p>（3）该根 DNS 服务器注意到 com 前缀，向本地 DNS 服务器返回 com 对应的顶级域 DNS 服务器（TLD）的 IP 地址列表。</p>\n<p>（4）本地 DNS 服务器则向其中一台 TLD 服务器发送查询报文；</p>\n<p>（5）该 TLD 服务器注意到 b.com 前缀，向本地 DNS 服务器返回权威 DNS 服务器的 IP 地址。</p>\n<p>（6）本地 DNS 服务器又向其中一台权威服务器发送查询报文；</p>\n<p>（7）该权威服务器返回了 a.b.com 的 IP 地址；</p>\n<p>（8）本地 DNS 服务器将 a.b.com 跟 IP 地址的映射返回给主机 m.n.com，m.n.com 就可以用该 IP 向 a.b.com 发送请求了。</p>\n<h3 id=\"1、递归\"><a href=\"#1、递归\" class=\"headerlink\" title=\"1、递归\"></a>1、递归</h3><p>主机 m.n.com 向本地 DNS 服务器 dns.n.com 发出的查询就是递归查询，这个查询是主机 m.n.com 以自己的名义向本地 DNS 服务器请求想要的 IP 映射，并且本地 DNS 服务器直接返回映射结果给到主机。</p>\n<h3 id=\"2、迭代\"><a href=\"#2、迭代\" class=\"headerlink\" title=\"2、迭代\"></a>2、迭代</h3><p>而后继的三个查询是迭代查询，包括本地 DNS 服务器向根 DNS 服务器发送查询请求、本地 DNS 服务器向 TLD 服务器发送查询请求、本地 DNS 服务器向权威 DNS 服务器发送查询请求，所有的请求都是由本地 DNS 服务器发出，所有的响应都是直接返回给本地 DNS 服务器。</p>\n<h3 id=\"3、另一种-DNS-查询\"><a href=\"#3、另一种-DNS-查询\" class=\"headerlink\" title=\"3、另一种 DNS 查询\"></a>3、另一种 DNS 查询</h3><p>从理论上讲，任何 DNS 查询既可以是递归的，也可以是迭代的。下图的所有查询就都是递归的，不包含迭代。</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd1422f81c2647a19cde72cb9694bc89~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.webp\"\n                      alt=\"图3\"\n                ></p>\n<h4 id=\"TLD-一定知道权威-DNS-服务器的-IP-地址吗？\"><a href=\"#TLD-一定知道权威-DNS-服务器的-IP-地址吗？\" class=\"headerlink\" title=\"TLD 一定知道权威 DNS 服务器的 IP 地址吗？\"></a>TLD 一定知道权威 DNS 服务器的 IP 地址吗？</h4><p>不一定，有时 TLD 只是知道中间的某个 DNS 服务器，再由这个中间 DNS 服务器去找到权威 DNS 服务器。</p>\n<p>这种情况不仅增加了延迟，还使得网络上需要传输更多的数据包，也会产生更多的 DNS 报文。</p>\n<h2 id=\"五、DNS-优化\"><a href=\"#五、DNS-优化\" class=\"headerlink\" title=\"五、DNS 优化\"></a>五、DNS 优化</h2><h3 id=\"1、DNS-缓存\"><a href=\"#1、DNS-缓存\" class=\"headerlink\" title=\"1、DNS 缓存\"></a>1、DNS 缓存</h3><p>DNS 存在多级缓存，从离浏览器的距离排序，有以下几种：<br>浏览器缓存，系统缓存，路由器缓存，IPS 服务器缓存，根域名服务器缓存，顶级域名服务器缓存，主域名服务器缓存。</p>\n<ul>\n<li>在chrome浏览器中输入 <code>chrome://net-internals/#dns</code>，可以看到chrome浏览器的DNS缓存</li>\n<li>系统缓存主要存在 <code>/etc/hosts</code> （Linux系统）中</li>\n</ul>\n<p>缓存并不是永久的，每一条映射记录都有对应的生存时间，一旦过了生存时间，该条记录就会从缓存移出。</p>\n<h3 id=\"2、DNS-负载均衡\"><a href=\"#2、DNS-负载均衡\" class=\"headerlink\" title=\"2、DNS 负载均衡\"></a>2、DNS 负载均衡</h3><p>访问某网站的时候，每次响应的很可能不是同一个服务器（IP 地址不同），因为一般公司都有多台服务器来支撑访问，而 DNS 会返回一个合适的机器的 IP 给用户（<strong>根据每台机器的负载量、该机器和用户地理位置的距离等</strong>），这就是 DNS 负载均衡。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、定义\"><a href=\"#一、定义\" class=\"headerlink\" title=\"一、定义\"></a>一、定义</h2><p>DNS 是：</p>\n<ul>\n<li>一个使得主机能够查询分布式数据库的<strong>应用层协议</strong></li>\n<li>一个由分层的 DNS 服务器实现的<strong>分布式数据库</strong></li>\n</ul>\n<p>（1）DNS 是一个分布式数据库，整个 DNS 系统由分散在世界各地的很多 DNS 服务器组成，每台服务器上都保存了一些数据，可以让我们最终查到主机名对应的 IP。</p>\n<p>（2）DNS 是一个应用层协议，发送一个包含所查询主机名的请求，它会返回该主机名对应的 IP。</p>\n<p><strong>分布式：</strong> 世界上没有一台 DNS 服务器拥有因特网上所有主机的映射，每台 DNS 只负责部分映射。</p>\n<h2 id=\"二、层次\"><a href=\"#二、层次\" class=\"headerlink\" title=\"二、层次\"></a>二、层次</h2><p>DNS 服务器有 3 种类型：</p>\n<ul>\n<li>根 DNS 服务器</li>\n<li>顶级域（Top-Level Domain, TLD）</li>\n<li>DNS 服务器</li>\n<li>权威 DNS 服务器</li>\n</ul>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://img1.baidu.com/it/u=2736501838,3539264290&fm=253&fmt=auto&app=138&f=PNG?w=722&h=408\"\n                      alt=\"图1\"\n                ></p>\n<h3 id=\"1、根-DNS-服务器\"><a href=\"#1、根-DNS-服务器\" class=\"headerlink\" title=\"1、根 DNS 服务器\"></a>1、根 DNS 服务器</h3><p>比如 <code>www.baidu.com</code>，其完整写法是 <code>www.baidu.com.</code>，最后的这个 <code>.</code> 就是根域名。</p>\n<p>通过询问根 DNS 服务器，可以知道它的下一级，也就是顶级域 DNS 服务器的 IP 是多少，从而继续向顶级域 DNS 服务器发起查询请求。</p>\n<h3 id=\"2、顶级域-DNS-服务器\"><a href=\"#2、顶级域-DNS-服务器\" class=\"headerlink\" title=\"2、顶级域 DNS 服务器\"></a>2、顶级域 DNS 服务器</h3><p>除了前面提到的 <code>com</code> 是顶级域名，常见的顶级域名还有 <code>cn</code>、<code>org</code>、<code>edu</code> 等。顶级域 DNS 服务器，也就是 TLD，提供了它的下一级，也就是权威 DNS 服务器的 IP 地址。</p>\n<h3 id=\"3、权威-DNS-服务器\"><a href=\"#3、权威-DNS-服务器\" class=\"headerlink\" title=\"3、权威 DNS 服务器\"></a>3、权威 DNS 服务器</h3><p>权威 DNS 服务器可以返回主机和IP之间的最终映射。</p>\n<h2 id=\"三、本地-DNS-服务器\"><a href=\"#三、本地-DNS-服务器\" class=\"headerlink\" title=\"三、本地 DNS 服务器\"></a>三、本地 DNS 服务器</h2><p>每个 ISP（Internet Server Provider, 网络服务提供商）都有一台本地 DNS 服务器，比如一个居民区的 ISP、一个大学的 ISP、一个机构的 ISP，都有一台或多台本地 DNS 服务器。</p>\n<p>当主机发出 DNS 请求时，该请求被发往本地 DNS 服务器，<strong>本地 DNS 服务器起着代理的作用，并负责将该请求转发到 DNS 服务器层次结构中。</strong></p>\n<p>严格来说，本地 DNS 服务器不属于 DNS 的层次结构。</p>\n<h2 id=\"四、递归查询、迭代查询\"><a href=\"#四、递归查询、迭代查询\" class=\"headerlink\" title=\"四、递归查询、迭代查询\"></a>四、递归查询、迭代查询</h2><p>如下图，假设主机 m.n.com 想要获取主机 a.b.com 的 IP 地址，会经过以下几个步骤：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6bb796a3045e409aabb0f89ad40d3fad~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.webp\"\n                      alt=\"图2\"\n                ></p>\n<p>（1）首先，主机 m.n.com 向它的本地 DNS 服务器发送一个 DNS 查询报文，包含期待被转换的主机名 a.b.com；</p>\n<p>（2）本地 DNS 服务器将该报文转发到根 DNS 服务器；</p>\n<p>（3）该根 DNS 服务器注意到 com 前缀，向本地 DNS 服务器返回 com 对应的顶级域 DNS 服务器（TLD）的 IP 地址列表。</p>\n<p>（4）本地 DNS 服务器则向其中一台 TLD 服务器发送查询报文；</p>\n<p>（5）该 TLD 服务器注意到 b.com 前缀，向本地 DNS 服务器返回权威 DNS 服务器的 IP 地址。</p>\n<p>（6）本地 DNS 服务器又向其中一台权威服务器发送查询报文；</p>\n<p>（7）该权威服务器返回了 a.b.com 的 IP 地址；</p>\n<p>（8）本地 DNS 服务器将 a.b.com 跟 IP 地址的映射返回给主机 m.n.com，m.n.com 就可以用该 IP 向 a.b.com 发送请求了。</p>\n<h3 id=\"1、递归\"><a href=\"#1、递归\" class=\"headerlink\" title=\"1、递归\"></a>1、递归</h3><p>主机 m.n.com 向本地 DNS 服务器 dns.n.com 发出的查询就是递归查询，这个查询是主机 m.n.com 以自己的名义向本地 DNS 服务器请求想要的 IP 映射，并且本地 DNS 服务器直接返回映射结果给到主机。</p>\n<h3 id=\"2、迭代\"><a href=\"#2、迭代\" class=\"headerlink\" title=\"2、迭代\"></a>2、迭代</h3><p>而后继的三个查询是迭代查询，包括本地 DNS 服务器向根 DNS 服务器发送查询请求、本地 DNS 服务器向 TLD 服务器发送查询请求、本地 DNS 服务器向权威 DNS 服务器发送查询请求，所有的请求都是由本地 DNS 服务器发出，所有的响应都是直接返回给本地 DNS 服务器。</p>\n<h3 id=\"3、另一种-DNS-查询\"><a href=\"#3、另一种-DNS-查询\" class=\"headerlink\" title=\"3、另一种 DNS 查询\"></a>3、另一种 DNS 查询</h3><p>从理论上讲，任何 DNS 查询既可以是递归的，也可以是迭代的。下图的所有查询就都是递归的，不包含迭代。</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd1422f81c2647a19cde72cb9694bc89~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.webp\"\n                      alt=\"图3\"\n                ></p>\n<h4 id=\"TLD-一定知道权威-DNS-服务器的-IP-地址吗？\"><a href=\"#TLD-一定知道权威-DNS-服务器的-IP-地址吗？\" class=\"headerlink\" title=\"TLD 一定知道权威 DNS 服务器的 IP 地址吗？\"></a>TLD 一定知道权威 DNS 服务器的 IP 地址吗？</h4><p>不一定，有时 TLD 只是知道中间的某个 DNS 服务器，再由这个中间 DNS 服务器去找到权威 DNS 服务器。</p>\n<p>这种情况不仅增加了延迟，还使得网络上需要传输更多的数据包，也会产生更多的 DNS 报文。</p>\n<h2 id=\"五、DNS-优化\"><a href=\"#五、DNS-优化\" class=\"headerlink\" title=\"五、DNS 优化\"></a>五、DNS 优化</h2><h3 id=\"1、DNS-缓存\"><a href=\"#1、DNS-缓存\" class=\"headerlink\" title=\"1、DNS 缓存\"></a>1、DNS 缓存</h3><p>DNS 存在多级缓存，从离浏览器的距离排序，有以下几种：<br>浏览器缓存，系统缓存，路由器缓存，IPS 服务器缓存，根域名服务器缓存，顶级域名服务器缓存，主域名服务器缓存。</p>\n<ul>\n<li>在chrome浏览器中输入 <code>chrome://net-internals/#dns</code>，可以看到chrome浏览器的DNS缓存</li>\n<li>系统缓存主要存在 <code>/etc/hosts</code> （Linux系统）中</li>\n</ul>\n<p>缓存并不是永久的，每一条映射记录都有对应的生存时间，一旦过了生存时间，该条记录就会从缓存移出。</p>\n<h3 id=\"2、DNS-负载均衡\"><a href=\"#2、DNS-负载均衡\" class=\"headerlink\" title=\"2、DNS 负载均衡\"></a>2、DNS 负载均衡</h3><p>访问某网站的时候，每次响应的很可能不是同一个服务器（IP 地址不同），因为一般公司都有多台服务器来支撑访问，而 DNS 会返回一个合适的机器的 IP 给用户（<strong>根据每台机器的负载量、该机器和用户地理位置的距离等</strong>），这就是 DNS 负载均衡。</p>\n","_processedHighlight":true},{"title":"CDN","date":"2024-10-29T01:15:20.000Z","_content":"\n## 一、概念\n\nCDN 全称为 “Content Delivery Network”，即内容分发网络。\nCDN 是一种特殊的 DNS服务器。\n\n## 二、原理\n\n当使用域名访问某一个网站时（比如访问 `www.baidu.com`），分为两步：\n\n- 首先解析出该域名所对应的 IP地址（DNS 域名解析）\n- 然后将 Http请求包 路由到 IP地址 所对应的服务器\n\n（注：IP地址和网卡相绑定，一个服务器可以有多个网卡，即可能有多个IP地址）\n\n### 1、域名解析\n\n域名解析分为两种：\n\n- 将域名解析为IP地址\n- 将域名解析为另一个域名（CNAME）\n\n购买一个域名之后，需要去映射一个 IP地址，用 Map 表示：{域名：IP}。\n也可以给某域名取一个别名，比如给 `www.baidu.com` 取一个别名 `test.baidu.com`，用 Map 表示：{域名：CNAME}，这里的CNAME就是别名。\n\n**域名解析，实际上就是解析出指定域名所对应的 IP地址，或该域名的一个 CNAME。**\n\n没有CNAME的情况：\n![图1](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/7/16/16bf9e293d4bc895~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.webp#?w=1004&h=474&s=41808&e=png&b=fefbfb)\n\n有CNAME的情况：\n![图1](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/7/16/16bf9e293e8c88d4~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.webp#?w=1012&h=468&s=46488&e=png&b=fefafa)\n\n特别注意：在有 CNAME 的情况下，CNAME 在域名解析的过程中承担了代理的角色，这是 CDN 实现的关键。\n\n### 2、资源分类\n\n服务器上的资源分为两种：\n\n- 静态资源：这种资源通常很少变动，比如图片，视频，css，js 等等\n- 动态资源：这种资源不同用户不同时刻访问通常是不一样的，比如 ftl，jsp 等等。\n\n#### （1）集群（动态资源）\n\n在全国各地部署服务器，每个服务器上都有相同的动态资源，并且还需配置相应的数据库，这就涉及到数据同步等问题。这种做法专业一点就是集群，目前集群架构最多是三地五中心，因为全国多地集群成本太高。\n\n#### （2）CDN服务器（静态资源）\n\n在每个服务器上只部署静态资源是成本较低的方式，因为静态资源通常不涉及数据库，也能提高用户访问速度。\n\n现在有很多 CDN供应商，只要把系统接入并将静态资源传给 CDN服务，这些静态资源将会自动分布到世界各地。\n\n在访问静态资源时，DNS系统 进行域名解析的过程中，如何解析出离用户最近的 IP地址？\n这就需要使用 CDN服务器，该服务器知道用户当前所在位置，和用户访问的域名对应哪些 IP地址，及这些 IP地址 分别在哪。\n\n这样，只要用户在通过某域名访问静态资源时，**配置自己电脑的 DNS地址 为 CDN专用DNS服务器**，就可以解决问题了，但不能要求所有用户都去修改自己电脑的 DNS地址，这时就要利用 DNS 中的 CNAME 了。\n\n### 3、负载均衡和缓存\n\n#### （1）负载均衡系统\n\n如果没有返回 IP地址，本地DNS服务器 会向对应的 CDN服务器 再次发送请求，通过 CDN负载均衡系统 进行智能调度：\n\n- 看用户的 IP 地址，查表得知**地理位置**，找相对最近的边缘节点\n- 看用户所在的**运营商网络**，找相同网络的边缘节点\n- 检查边缘节点的**负载情况**，找负载较轻的节点\n- 其他，比如节点的“健康状况”、服务能力、带宽、响应时间等\n\n结合以上因素，得到最合适的边缘节点，并把该节点返回给用户，用户就能就近访问 CDN 的缓存代理。\n\n整体流程如下：\n\n![图3](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/7/16/16bf9e293edf212d~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.webp#?w=1090&h=720&s=68194&e=png&b=fefcfc)\n\n#### （2）缓存代理\n\n缓存系统是 CDN 的另一个关键组成部分，缓存系统会缓存最常用的资源，有两个衡量 CDN服务质量 的指标：\n\n- **命中率**：用户访问的资源恰好在缓存系统里，可直接返回给用户，命中次数与所有访问次数之比\n- **回源率**：缓存里没有，必须用代理的方式回源站取，回源次数与所有访问次数之比\n\n缓存系统可以划分层次为：一级缓存节点和二级缓存节点，一级缓存直连源站，二级缓存直连用户。\n在回源时，二级缓存首先找一级缓存，一级缓存没有才回源站，可有效减少真正的回源。\n\n![图4](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6db24ee3dcb84eed84b7736b09bdaec9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.webp)\n\n现在的商业 CDN命中率都在 90% 以上，相当于把源站的服务能力放大了 10 倍以上\n\n#### 补充\n\n域名解析有多种记录类型，最常用的有：\n\n- **A记录：一个域名对应一个IP地址**\n- **CNAME：一个域名对应另外一个域名**\n- NS：将子域名指定其他DNS服务器解析\n","source":"_posts/26-CDN.md","raw":"---\ntitle: CDN\ndate: 2024-10-29 09:15:20\ntags:\n    - 面经\n    - 计算机网络\n    - CDN\ncategories:\n    - 计算机网络\n      - CDN\n---\n\n## 一、概念\n\nCDN 全称为 “Content Delivery Network”，即内容分发网络。\nCDN 是一种特殊的 DNS服务器。\n\n## 二、原理\n\n当使用域名访问某一个网站时（比如访问 `www.baidu.com`），分为两步：\n\n- 首先解析出该域名所对应的 IP地址（DNS 域名解析）\n- 然后将 Http请求包 路由到 IP地址 所对应的服务器\n\n（注：IP地址和网卡相绑定，一个服务器可以有多个网卡，即可能有多个IP地址）\n\n### 1、域名解析\n\n域名解析分为两种：\n\n- 将域名解析为IP地址\n- 将域名解析为另一个域名（CNAME）\n\n购买一个域名之后，需要去映射一个 IP地址，用 Map 表示：{域名：IP}。\n也可以给某域名取一个别名，比如给 `www.baidu.com` 取一个别名 `test.baidu.com`，用 Map 表示：{域名：CNAME}，这里的CNAME就是别名。\n\n**域名解析，实际上就是解析出指定域名所对应的 IP地址，或该域名的一个 CNAME。**\n\n没有CNAME的情况：\n![图1](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/7/16/16bf9e293d4bc895~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.webp#?w=1004&h=474&s=41808&e=png&b=fefbfb)\n\n有CNAME的情况：\n![图1](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/7/16/16bf9e293e8c88d4~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.webp#?w=1012&h=468&s=46488&e=png&b=fefafa)\n\n特别注意：在有 CNAME 的情况下，CNAME 在域名解析的过程中承担了代理的角色，这是 CDN 实现的关键。\n\n### 2、资源分类\n\n服务器上的资源分为两种：\n\n- 静态资源：这种资源通常很少变动，比如图片，视频，css，js 等等\n- 动态资源：这种资源不同用户不同时刻访问通常是不一样的，比如 ftl，jsp 等等。\n\n#### （1）集群（动态资源）\n\n在全国各地部署服务器，每个服务器上都有相同的动态资源，并且还需配置相应的数据库，这就涉及到数据同步等问题。这种做法专业一点就是集群，目前集群架构最多是三地五中心，因为全国多地集群成本太高。\n\n#### （2）CDN服务器（静态资源）\n\n在每个服务器上只部署静态资源是成本较低的方式，因为静态资源通常不涉及数据库，也能提高用户访问速度。\n\n现在有很多 CDN供应商，只要把系统接入并将静态资源传给 CDN服务，这些静态资源将会自动分布到世界各地。\n\n在访问静态资源时，DNS系统 进行域名解析的过程中，如何解析出离用户最近的 IP地址？\n这就需要使用 CDN服务器，该服务器知道用户当前所在位置，和用户访问的域名对应哪些 IP地址，及这些 IP地址 分别在哪。\n\n这样，只要用户在通过某域名访问静态资源时，**配置自己电脑的 DNS地址 为 CDN专用DNS服务器**，就可以解决问题了，但不能要求所有用户都去修改自己电脑的 DNS地址，这时就要利用 DNS 中的 CNAME 了。\n\n### 3、负载均衡和缓存\n\n#### （1）负载均衡系统\n\n如果没有返回 IP地址，本地DNS服务器 会向对应的 CDN服务器 再次发送请求，通过 CDN负载均衡系统 进行智能调度：\n\n- 看用户的 IP 地址，查表得知**地理位置**，找相对最近的边缘节点\n- 看用户所在的**运营商网络**，找相同网络的边缘节点\n- 检查边缘节点的**负载情况**，找负载较轻的节点\n- 其他，比如节点的“健康状况”、服务能力、带宽、响应时间等\n\n结合以上因素，得到最合适的边缘节点，并把该节点返回给用户，用户就能就近访问 CDN 的缓存代理。\n\n整体流程如下：\n\n![图3](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/7/16/16bf9e293edf212d~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.webp#?w=1090&h=720&s=68194&e=png&b=fefcfc)\n\n#### （2）缓存代理\n\n缓存系统是 CDN 的另一个关键组成部分，缓存系统会缓存最常用的资源，有两个衡量 CDN服务质量 的指标：\n\n- **命中率**：用户访问的资源恰好在缓存系统里，可直接返回给用户，命中次数与所有访问次数之比\n- **回源率**：缓存里没有，必须用代理的方式回源站取，回源次数与所有访问次数之比\n\n缓存系统可以划分层次为：一级缓存节点和二级缓存节点，一级缓存直连源站，二级缓存直连用户。\n在回源时，二级缓存首先找一级缓存，一级缓存没有才回源站，可有效减少真正的回源。\n\n![图4](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6db24ee3dcb84eed84b7736b09bdaec9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.webp)\n\n现在的商业 CDN命中率都在 90% 以上，相当于把源站的服务能力放大了 10 倍以上\n\n#### 补充\n\n域名解析有多种记录类型，最常用的有：\n\n- **A记录：一个域名对应一个IP地址**\n- **CNAME：一个域名对应另外一个域名**\n- NS：将子域名指定其他DNS服务器解析\n","slug":"26-CDN","published":1,"updated":"2025-05-20T02:47:28.683Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu8001m6kprep0tfity","content":"<h2 id=\"一、概念\"><a href=\"#一、概念\" class=\"headerlink\" title=\"一、概念\"></a>一、概念</h2><p>CDN 全称为 “Content Delivery Network”，即内容分发网络。<br>CDN 是一种特殊的 DNS服务器。</p>\n<h2 id=\"二、原理\"><a href=\"#二、原理\" class=\"headerlink\" title=\"二、原理\"></a>二、原理</h2><p>当使用域名访问某一个网站时（比如访问 <code>www.baidu.com</code>），分为两步：</p>\n<ul>\n<li>首先解析出该域名所对应的 IP地址（DNS 域名解析）</li>\n<li>然后将 Http请求包 路由到 IP地址 所对应的服务器</li>\n</ul>\n<p>（注：IP地址和网卡相绑定，一个服务器可以有多个网卡，即可能有多个IP地址）</p>\n<h3 id=\"1、域名解析\"><a href=\"#1、域名解析\" class=\"headerlink\" title=\"1、域名解析\"></a>1、域名解析</h3><p>域名解析分为两种：</p>\n<ul>\n<li>将域名解析为IP地址</li>\n<li>将域名解析为另一个域名（CNAME）</li>\n</ul>\n<p>购买一个域名之后，需要去映射一个 IP地址，用 Map 表示：{域名：IP}。<br>也可以给某域名取一个别名，比如给 <code>www.baidu.com</code> 取一个别名 <code>test.baidu.com</code>，用 Map 表示：{域名：CNAME}，这里的CNAME就是别名。</p>\n<p><strong>域名解析，实际上就是解析出指定域名所对应的 IP地址，或该域名的一个 CNAME。</strong></p>\n<p>没有CNAME的情况：<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/7/16/16bf9e293d4bc895~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.webp#?w=1004&h=474&s=41808&e=png&b=fefbfb\"\n                      alt=\"图1\"\n                ></p>\n<p>有CNAME的情况：<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/7/16/16bf9e293e8c88d4~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.webp#?w=1012&h=468&s=46488&e=png&b=fefafa\"\n                      alt=\"图1\"\n                ></p>\n<p>特别注意：在有 CNAME 的情况下，CNAME 在域名解析的过程中承担了代理的角色，这是 CDN 实现的关键。</p>\n<h3 id=\"2、资源分类\"><a href=\"#2、资源分类\" class=\"headerlink\" title=\"2、资源分类\"></a>2、资源分类</h3><p>服务器上的资源分为两种：</p>\n<ul>\n<li>静态资源：这种资源通常很少变动，比如图片，视频，css，js 等等</li>\n<li>动态资源：这种资源不同用户不同时刻访问通常是不一样的，比如 ftl，jsp 等等。</li>\n</ul>\n<h4 id=\"（1）集群（动态资源）\"><a href=\"#（1）集群（动态资源）\" class=\"headerlink\" title=\"（1）集群（动态资源）\"></a>（1）集群（动态资源）</h4><p>在全国各地部署服务器，每个服务器上都有相同的动态资源，并且还需配置相应的数据库，这就涉及到数据同步等问题。这种做法专业一点就是集群，目前集群架构最多是三地五中心，因为全国多地集群成本太高。</p>\n<h4 id=\"（2）CDN服务器（静态资源）\"><a href=\"#（2）CDN服务器（静态资源）\" class=\"headerlink\" title=\"（2）CDN服务器（静态资源）\"></a>（2）CDN服务器（静态资源）</h4><p>在每个服务器上只部署静态资源是成本较低的方式，因为静态资源通常不涉及数据库，也能提高用户访问速度。</p>\n<p>现在有很多 CDN供应商，只要把系统接入并将静态资源传给 CDN服务，这些静态资源将会自动分布到世界各地。</p>\n<p>在访问静态资源时，DNS系统 进行域名解析的过程中，如何解析出离用户最近的 IP地址？<br>这就需要使用 CDN服务器，该服务器知道用户当前所在位置，和用户访问的域名对应哪些 IP地址，及这些 IP地址 分别在哪。</p>\n<p>这样，只要用户在通过某域名访问静态资源时，<strong>配置自己电脑的 DNS地址 为 CDN专用DNS服务器</strong>，就可以解决问题了，但不能要求所有用户都去修改自己电脑的 DNS地址，这时就要利用 DNS 中的 CNAME 了。</p>\n<h3 id=\"3、负载均衡和缓存\"><a href=\"#3、负载均衡和缓存\" class=\"headerlink\" title=\"3、负载均衡和缓存\"></a>3、负载均衡和缓存</h3><h4 id=\"（1）负载均衡系统\"><a href=\"#（1）负载均衡系统\" class=\"headerlink\" title=\"（1）负载均衡系统\"></a>（1）负载均衡系统</h4><p>如果没有返回 IP地址，本地DNS服务器 会向对应的 CDN服务器 再次发送请求，通过 CDN负载均衡系统 进行智能调度：</p>\n<ul>\n<li>看用户的 IP 地址，查表得知<strong>地理位置</strong>，找相对最近的边缘节点</li>\n<li>看用户所在的<strong>运营商网络</strong>，找相同网络的边缘节点</li>\n<li>检查边缘节点的<strong>负载情况</strong>，找负载较轻的节点</li>\n<li>其他，比如节点的“健康状况”、服务能力、带宽、响应时间等</li>\n</ul>\n<p>结合以上因素，得到最合适的边缘节点，并把该节点返回给用户，用户就能就近访问 CDN 的缓存代理。</p>\n<p>整体流程如下：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/7/16/16bf9e293edf212d~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.webp#?w=1090&h=720&s=68194&e=png&b=fefcfc\"\n                      alt=\"图3\"\n                ></p>\n<h4 id=\"（2）缓存代理\"><a href=\"#（2）缓存代理\" class=\"headerlink\" title=\"（2）缓存代理\"></a>（2）缓存代理</h4><p>缓存系统是 CDN 的另一个关键组成部分，缓存系统会缓存最常用的资源，有两个衡量 CDN服务质量 的指标：</p>\n<ul>\n<li><strong>命中率</strong>：用户访问的资源恰好在缓存系统里，可直接返回给用户，命中次数与所有访问次数之比</li>\n<li><strong>回源率</strong>：缓存里没有，必须用代理的方式回源站取，回源次数与所有访问次数之比</li>\n</ul>\n<p>缓存系统可以划分层次为：一级缓存节点和二级缓存节点，一级缓存直连源站，二级缓存直连用户。<br>在回源时，二级缓存首先找一级缓存，一级缓存没有才回源站，可有效减少真正的回源。</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6db24ee3dcb84eed84b7736b09bdaec9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.webp\"\n                      alt=\"图4\"\n                ></p>\n<p>现在的商业 CDN命中率都在 90% 以上，相当于把源站的服务能力放大了 10 倍以上</p>\n<h4 id=\"补充\"><a href=\"#补充\" class=\"headerlink\" title=\"补充\"></a>补充</h4><p>域名解析有多种记录类型，最常用的有：</p>\n<ul>\n<li><strong>A记录：一个域名对应一个IP地址</strong></li>\n<li><strong>CNAME：一个域名对应另外一个域名</strong></li>\n<li>NS：将子域名指定其他DNS服务器解析</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、概念\"><a href=\"#一、概念\" class=\"headerlink\" title=\"一、概念\"></a>一、概念</h2><p>CDN 全称为 “Content Delivery Network”，即内容分发网络。<br>CDN 是一种特殊的 DNS服务器。</p>\n<h2 id=\"二、原理\"><a href=\"#二、原理\" class=\"headerlink\" title=\"二、原理\"></a>二、原理</h2><p>当使用域名访问某一个网站时（比如访问 <code>www.baidu.com</code>），分为两步：</p>\n<ul>\n<li>首先解析出该域名所对应的 IP地址（DNS 域名解析）</li>\n<li>然后将 Http请求包 路由到 IP地址 所对应的服务器</li>\n</ul>\n<p>（注：IP地址和网卡相绑定，一个服务器可以有多个网卡，即可能有多个IP地址）</p>\n<h3 id=\"1、域名解析\"><a href=\"#1、域名解析\" class=\"headerlink\" title=\"1、域名解析\"></a>1、域名解析</h3><p>域名解析分为两种：</p>\n<ul>\n<li>将域名解析为IP地址</li>\n<li>将域名解析为另一个域名（CNAME）</li>\n</ul>\n<p>购买一个域名之后，需要去映射一个 IP地址，用 Map 表示：{域名：IP}。<br>也可以给某域名取一个别名，比如给 <code>www.baidu.com</code> 取一个别名 <code>test.baidu.com</code>，用 Map 表示：{域名：CNAME}，这里的CNAME就是别名。</p>\n<p><strong>域名解析，实际上就是解析出指定域名所对应的 IP地址，或该域名的一个 CNAME。</strong></p>\n<p>没有CNAME的情况：<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/7/16/16bf9e293d4bc895~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.webp#?w=1004&h=474&s=41808&e=png&b=fefbfb\"\n                      alt=\"图1\"\n                ></p>\n<p>有CNAME的情况：<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/7/16/16bf9e293e8c88d4~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.webp#?w=1012&h=468&s=46488&e=png&b=fefafa\"\n                      alt=\"图1\"\n                ></p>\n<p>特别注意：在有 CNAME 的情况下，CNAME 在域名解析的过程中承担了代理的角色，这是 CDN 实现的关键。</p>\n<h3 id=\"2、资源分类\"><a href=\"#2、资源分类\" class=\"headerlink\" title=\"2、资源分类\"></a>2、资源分类</h3><p>服务器上的资源分为两种：</p>\n<ul>\n<li>静态资源：这种资源通常很少变动，比如图片，视频，css，js 等等</li>\n<li>动态资源：这种资源不同用户不同时刻访问通常是不一样的，比如 ftl，jsp 等等。</li>\n</ul>\n<h4 id=\"（1）集群（动态资源）\"><a href=\"#（1）集群（动态资源）\" class=\"headerlink\" title=\"（1）集群（动态资源）\"></a>（1）集群（动态资源）</h4><p>在全国各地部署服务器，每个服务器上都有相同的动态资源，并且还需配置相应的数据库，这就涉及到数据同步等问题。这种做法专业一点就是集群，目前集群架构最多是三地五中心，因为全国多地集群成本太高。</p>\n<h4 id=\"（2）CDN服务器（静态资源）\"><a href=\"#（2）CDN服务器（静态资源）\" class=\"headerlink\" title=\"（2）CDN服务器（静态资源）\"></a>（2）CDN服务器（静态资源）</h4><p>在每个服务器上只部署静态资源是成本较低的方式，因为静态资源通常不涉及数据库，也能提高用户访问速度。</p>\n<p>现在有很多 CDN供应商，只要把系统接入并将静态资源传给 CDN服务，这些静态资源将会自动分布到世界各地。</p>\n<p>在访问静态资源时，DNS系统 进行域名解析的过程中，如何解析出离用户最近的 IP地址？<br>这就需要使用 CDN服务器，该服务器知道用户当前所在位置，和用户访问的域名对应哪些 IP地址，及这些 IP地址 分别在哪。</p>\n<p>这样，只要用户在通过某域名访问静态资源时，<strong>配置自己电脑的 DNS地址 为 CDN专用DNS服务器</strong>，就可以解决问题了，但不能要求所有用户都去修改自己电脑的 DNS地址，这时就要利用 DNS 中的 CNAME 了。</p>\n<h3 id=\"3、负载均衡和缓存\"><a href=\"#3、负载均衡和缓存\" class=\"headerlink\" title=\"3、负载均衡和缓存\"></a>3、负载均衡和缓存</h3><h4 id=\"（1）负载均衡系统\"><a href=\"#（1）负载均衡系统\" class=\"headerlink\" title=\"（1）负载均衡系统\"></a>（1）负载均衡系统</h4><p>如果没有返回 IP地址，本地DNS服务器 会向对应的 CDN服务器 再次发送请求，通过 CDN负载均衡系统 进行智能调度：</p>\n<ul>\n<li>看用户的 IP 地址，查表得知<strong>地理位置</strong>，找相对最近的边缘节点</li>\n<li>看用户所在的<strong>运营商网络</strong>，找相同网络的边缘节点</li>\n<li>检查边缘节点的<strong>负载情况</strong>，找负载较轻的节点</li>\n<li>其他，比如节点的“健康状况”、服务能力、带宽、响应时间等</li>\n</ul>\n<p>结合以上因素，得到最合适的边缘节点，并把该节点返回给用户，用户就能就近访问 CDN 的缓存代理。</p>\n<p>整体流程如下：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/7/16/16bf9e293edf212d~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.webp#?w=1090&h=720&s=68194&e=png&b=fefcfc\"\n                      alt=\"图3\"\n                ></p>\n<h4 id=\"（2）缓存代理\"><a href=\"#（2）缓存代理\" class=\"headerlink\" title=\"（2）缓存代理\"></a>（2）缓存代理</h4><p>缓存系统是 CDN 的另一个关键组成部分，缓存系统会缓存最常用的资源，有两个衡量 CDN服务质量 的指标：</p>\n<ul>\n<li><strong>命中率</strong>：用户访问的资源恰好在缓存系统里，可直接返回给用户，命中次数与所有访问次数之比</li>\n<li><strong>回源率</strong>：缓存里没有，必须用代理的方式回源站取，回源次数与所有访问次数之比</li>\n</ul>\n<p>缓存系统可以划分层次为：一级缓存节点和二级缓存节点，一级缓存直连源站，二级缓存直连用户。<br>在回源时，二级缓存首先找一级缓存，一级缓存没有才回源站，可有效减少真正的回源。</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6db24ee3dcb84eed84b7736b09bdaec9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.webp\"\n                      alt=\"图4\"\n                ></p>\n<p>现在的商业 CDN命中率都在 90% 以上，相当于把源站的服务能力放大了 10 倍以上</p>\n<h4 id=\"补充\"><a href=\"#补充\" class=\"headerlink\" title=\"补充\"></a>补充</h4><p>域名解析有多种记录类型，最常用的有：</p>\n<ul>\n<li><strong>A记录：一个域名对应一个IP地址</strong></li>\n<li><strong>CNAME：一个域名对应另外一个域名</strong></li>\n<li>NS：将子域名指定其他DNS服务器解析</li>\n</ul>\n","_processedHighlight":true},{"title":"三次握手&四次挥手","date":"2024-11-04T06:26:53.000Z","_content":"\n## 三次握手\n\n### 一、概念\n\n#### 1、TCP 协议\n\nTCP（Transmission Control Protocol），即传输控制协议。\nTCP 协议是一个 **面向连接的、可靠的、基于字节流** 的 **传输层协议**。\n\nTCP 连接可以用于 **保证可靠性** 和 **流量控制机制**，包括 Socket、序列号及窗口大小。\n\n其中 Socket 是由 IP 加端口组成的，序列号是用来解决乱序问题的，而窗口大小则是用来做流量控制的。\n\n#### 2、TCP 的特点\n\n- 面向连接：TCP 是通过服务端和客户端进行连接的协议。\n- 面向字节流：TCP 服务端和客户端之间的数据通讯是通过 **字节流数据** 传输的。\n- 可靠的：TCP 传输的可靠性得益于 TCP 会记录 **信息的发送状态** 和 **数据的接收与否**，对于丢包等发送不成功的情况，TCP 会重新发包，进而保证 TCP 的可靠性。\n\n### 3、TCP 三次握手\n\n![图1](https://ask.qcloudimg.com/http-save/yehe-1208223/0b58ac09994e834e14ca43dcf357294b.png?imageView2/2/w/1620)\n\n- SYN：Synchronize Sequence Numbers，同步序列号，表示发起一个新连接。\n- ACK：确认收到一个新连接。\n- SEQ：序列号。\n\nTCP 三次握手执行过程：\n\n#### （1）第一次握手（在吗？）\n\nClient 将 `SYN` 发给 Server。\nClient 进入 `SYN_SENT` 状态，等待 Server 确认。\n\n#### （2）第二次握手（在的，有事？）\n\nServer 收到 `SYN`，将 `SYN`+`ACK` 发给 Client。\nServer 进入 `SYN_RCVD` 状态，等待 Client 确认。\n\n#### （3）第三次握手（需要数据传输）\n\nClient 收到 `SYN`+`ACK`，将 `SYN` 发给 Server。\n连接成功，Client 与 Server 进入 `ESTABLISHED` 状态，可以传输数据。\n\n#### TCP 为什么需要三次握手？\n\n**为了防止已失效的请求报文段传送到服务端而产生连接的误判。**\n\n假设是两次握手：\n\n当 A 发送一个连接请求给 B，但是该请求由于网络原因被阻塞了，一段时间后，A 未收到回复，会认为该消息丢失了，就会重新发送消息。\n\n当 A 和 B 通信完成后，这个被 A 认为已经丢失的请求到达了 B，B 会认为这是一个新的请求连接消息，就向 A 发送确认。\n\n但是 A 认为自己没有给 B 再次发送消息，所以不会理睬 B 的确认，但是 B 会一直等待 A 的消息，导致 B 的资源被浪费。\n\n这就是为什么不能两次握手。\n\n**设计成三次握手的情况，客户端在接收到服务端 SEQ+1 的返回消息后，就会知道该连接是历史连接，接着发送报文告诉服务端。**\n\n为了节省资源，也没必要设计成更多次的握手。\n\n## 四次挥手\n\n![图2](https://img-blog.csdnimg.cn/20190627203747107.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1NodWZmbGVfVHM=,size_16,color_FFFFFF,t_70)\n\n### 四次挥手的 6 种状态\n\n#### （1）FIN_WAIT_1\n\n主动方在 `ESTABLISHED` 状态的时候，想要主动关闭连接，向对方发送 `FIN` 报文，并进入 `FIN_WAIT_1` 状态。\n\n#### （2）FIN_WAIT_2\n\n当主动方收到被动方回复的 `ACK` 报文后，就进入了 `FIN_WAIT_2` 状态。\n\n当主动方进入 `FIN_WAIT_2` 时，表示半连接状态，即被动方还有数据要发过来。\n\n#### （3）CLOSE_WAIT\n\n当被动方接收到 `FIN` 时，会回复一个 `ACK`，并进入 `CLOSE_WAIT` 状态。\n\n在该状态中，被动方如果还有数据要发送，就继续发送，如果没有，就关闭连接，并发送一个 `FIN` 给对方。\n\n#### （4）TIME_WAIT\n\n当主动方接收到了 `FIN` 报文，就回复一个 `ACK` 报文，并进入 `TIME_WAIT` 状态。\n\n如果主动方在 `FIN_WAIT_1` 状态下，收到了对方的 `FIN`+`ACK` 报文，可以跳过 `FIN_WAIT_2` 直接进入 `TIME_WAIT` 状态。\n\n#### （5）LAST_ACK\n\n被动方发送了 `FIN` 报文后，最后等待对方的 `ACK` 报文时进入的状态。收到ACK报文后就可以进入CLOSED状态了。\n\n#### （6）CLOSED\n\n主动方进入 `TIME_WAIT` 状态后，再等待 `2MSL` 就会进入 `CLOSED` 状态。\n被动方在收到 `ACK` 报文后，立即进入 `CLOSED` 状态。\n\n### `TIME_WAIT` 的意义\n\n如果没有 `TIME-WAIT`，主动方会直接进入 `CLOSED` 状态。\n此时如果因为网络原因最后一次 `ACK` 丢失了，服务端会重复发送 `FIN` 请求给客户端，所以就需要主动方发送最后一次 `ACK` 之后进入 `TIME_WAIT` 状态，等待 `2MSL`（两个报文最大生命周期），等待这段时间就是为了如果接收到了重发的 `FIN` 请求能够进行最后一次 `ACK` 回复。\n","source":"_posts/27-三次握手&四次挥手.md","raw":"---\ntitle: 三次握手&四次挥手\ndate: 2024-11-04 14:26:53\ntags:\n    - 面经\n    - 计算机网络\n    - TCP\ncategories:\n    - 计算机网络\n      - TCP\n---\n\n## 三次握手\n\n### 一、概念\n\n#### 1、TCP 协议\n\nTCP（Transmission Control Protocol），即传输控制协议。\nTCP 协议是一个 **面向连接的、可靠的、基于字节流** 的 **传输层协议**。\n\nTCP 连接可以用于 **保证可靠性** 和 **流量控制机制**，包括 Socket、序列号及窗口大小。\n\n其中 Socket 是由 IP 加端口组成的，序列号是用来解决乱序问题的，而窗口大小则是用来做流量控制的。\n\n#### 2、TCP 的特点\n\n- 面向连接：TCP 是通过服务端和客户端进行连接的协议。\n- 面向字节流：TCP 服务端和客户端之间的数据通讯是通过 **字节流数据** 传输的。\n- 可靠的：TCP 传输的可靠性得益于 TCP 会记录 **信息的发送状态** 和 **数据的接收与否**，对于丢包等发送不成功的情况，TCP 会重新发包，进而保证 TCP 的可靠性。\n\n### 3、TCP 三次握手\n\n![图1](https://ask.qcloudimg.com/http-save/yehe-1208223/0b58ac09994e834e14ca43dcf357294b.png?imageView2/2/w/1620)\n\n- SYN：Synchronize Sequence Numbers，同步序列号，表示发起一个新连接。\n- ACK：确认收到一个新连接。\n- SEQ：序列号。\n\nTCP 三次握手执行过程：\n\n#### （1）第一次握手（在吗？）\n\nClient 将 `SYN` 发给 Server。\nClient 进入 `SYN_SENT` 状态，等待 Server 确认。\n\n#### （2）第二次握手（在的，有事？）\n\nServer 收到 `SYN`，将 `SYN`+`ACK` 发给 Client。\nServer 进入 `SYN_RCVD` 状态，等待 Client 确认。\n\n#### （3）第三次握手（需要数据传输）\n\nClient 收到 `SYN`+`ACK`，将 `SYN` 发给 Server。\n连接成功，Client 与 Server 进入 `ESTABLISHED` 状态，可以传输数据。\n\n#### TCP 为什么需要三次握手？\n\n**为了防止已失效的请求报文段传送到服务端而产生连接的误判。**\n\n假设是两次握手：\n\n当 A 发送一个连接请求给 B，但是该请求由于网络原因被阻塞了，一段时间后，A 未收到回复，会认为该消息丢失了，就会重新发送消息。\n\n当 A 和 B 通信完成后，这个被 A 认为已经丢失的请求到达了 B，B 会认为这是一个新的请求连接消息，就向 A 发送确认。\n\n但是 A 认为自己没有给 B 再次发送消息，所以不会理睬 B 的确认，但是 B 会一直等待 A 的消息，导致 B 的资源被浪费。\n\n这就是为什么不能两次握手。\n\n**设计成三次握手的情况，客户端在接收到服务端 SEQ+1 的返回消息后，就会知道该连接是历史连接，接着发送报文告诉服务端。**\n\n为了节省资源，也没必要设计成更多次的握手。\n\n## 四次挥手\n\n![图2](https://img-blog.csdnimg.cn/20190627203747107.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1NodWZmbGVfVHM=,size_16,color_FFFFFF,t_70)\n\n### 四次挥手的 6 种状态\n\n#### （1）FIN_WAIT_1\n\n主动方在 `ESTABLISHED` 状态的时候，想要主动关闭连接，向对方发送 `FIN` 报文，并进入 `FIN_WAIT_1` 状态。\n\n#### （2）FIN_WAIT_2\n\n当主动方收到被动方回复的 `ACK` 报文后，就进入了 `FIN_WAIT_2` 状态。\n\n当主动方进入 `FIN_WAIT_2` 时，表示半连接状态，即被动方还有数据要发过来。\n\n#### （3）CLOSE_WAIT\n\n当被动方接收到 `FIN` 时，会回复一个 `ACK`，并进入 `CLOSE_WAIT` 状态。\n\n在该状态中，被动方如果还有数据要发送，就继续发送，如果没有，就关闭连接，并发送一个 `FIN` 给对方。\n\n#### （4）TIME_WAIT\n\n当主动方接收到了 `FIN` 报文，就回复一个 `ACK` 报文，并进入 `TIME_WAIT` 状态。\n\n如果主动方在 `FIN_WAIT_1` 状态下，收到了对方的 `FIN`+`ACK` 报文，可以跳过 `FIN_WAIT_2` 直接进入 `TIME_WAIT` 状态。\n\n#### （5）LAST_ACK\n\n被动方发送了 `FIN` 报文后，最后等待对方的 `ACK` 报文时进入的状态。收到ACK报文后就可以进入CLOSED状态了。\n\n#### （6）CLOSED\n\n主动方进入 `TIME_WAIT` 状态后，再等待 `2MSL` 就会进入 `CLOSED` 状态。\n被动方在收到 `ACK` 报文后，立即进入 `CLOSED` 状态。\n\n### `TIME_WAIT` 的意义\n\n如果没有 `TIME-WAIT`，主动方会直接进入 `CLOSED` 状态。\n此时如果因为网络原因最后一次 `ACK` 丢失了，服务端会重复发送 `FIN` 请求给客户端，所以就需要主动方发送最后一次 `ACK` 之后进入 `TIME_WAIT` 状态，等待 `2MSL`（两个报文最大生命周期），等待这段时间就是为了如果接收到了重发的 `FIN` 请求能够进行最后一次 `ACK` 回复。\n","slug":"27-三次握手&四次挥手","published":1,"updated":"2025-05-20T02:47:28.683Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu8001q6kprf4hy8gjd","content":"<h2 id=\"三次握手\"><a href=\"#三次握手\" class=\"headerlink\" title=\"三次握手\"></a>三次握手</h2><h3 id=\"一、概念\"><a href=\"#一、概念\" class=\"headerlink\" title=\"一、概念\"></a>一、概念</h3><h4 id=\"1、TCP-协议\"><a href=\"#1、TCP-协议\" class=\"headerlink\" title=\"1、TCP 协议\"></a>1、TCP 协议</h4><p>TCP（Transmission Control Protocol），即传输控制协议。<br>TCP 协议是一个 <strong>面向连接的、可靠的、基于字节流</strong> 的 <strong>传输层协议</strong>。</p>\n<p>TCP 连接可以用于 <strong>保证可靠性</strong> 和 <strong>流量控制机制</strong>，包括 Socket、序列号及窗口大小。</p>\n<p>其中 Socket 是由 IP 加端口组成的，序列号是用来解决乱序问题的，而窗口大小则是用来做流量控制的。</p>\n<h4 id=\"2、TCP-的特点\"><a href=\"#2、TCP-的特点\" class=\"headerlink\" title=\"2、TCP 的特点\"></a>2、TCP 的特点</h4><ul>\n<li>面向连接：TCP 是通过服务端和客户端进行连接的协议。</li>\n<li>面向字节流：TCP 服务端和客户端之间的数据通讯是通过 <strong>字节流数据</strong> 传输的。</li>\n<li>可靠的：TCP 传输的可靠性得益于 TCP 会记录 <strong>信息的发送状态</strong> 和 <strong>数据的接收与否</strong>，对于丢包等发送不成功的情况，TCP 会重新发包，进而保证 TCP 的可靠性。</li>\n</ul>\n<h3 id=\"3、TCP-三次握手\"><a href=\"#3、TCP-三次握手\" class=\"headerlink\" title=\"3、TCP 三次握手\"></a>3、TCP 三次握手</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://ask.qcloudimg.com/http-save/yehe-1208223/0b58ac09994e834e14ca43dcf357294b.png?imageView2/2/w/1620\"\n                      alt=\"图1\"\n                ></p>\n<ul>\n<li>SYN：Synchronize Sequence Numbers，同步序列号，表示发起一个新连接。</li>\n<li>ACK：确认收到一个新连接。</li>\n<li>SEQ：序列号。</li>\n</ul>\n<p>TCP 三次握手执行过程：</p>\n<h4 id=\"（1）第一次握手（在吗？）\"><a href=\"#（1）第一次握手（在吗？）\" class=\"headerlink\" title=\"（1）第一次握手（在吗？）\"></a>（1）第一次握手（在吗？）</h4><p>Client 将 <code>SYN</code> 发给 Server。<br>Client 进入 <code>SYN_SENT</code> 状态，等待 Server 确认。</p>\n<h4 id=\"（2）第二次握手（在的，有事？）\"><a href=\"#（2）第二次握手（在的，有事？）\" class=\"headerlink\" title=\"（2）第二次握手（在的，有事？）\"></a>（2）第二次握手（在的，有事？）</h4><p>Server 收到 <code>SYN</code>，将 <code>SYN</code>+<code>ACK</code> 发给 Client。<br>Server 进入 <code>SYN_RCVD</code> 状态，等待 Client 确认。</p>\n<h4 id=\"（3）第三次握手（需要数据传输）\"><a href=\"#（3）第三次握手（需要数据传输）\" class=\"headerlink\" title=\"（3）第三次握手（需要数据传输）\"></a>（3）第三次握手（需要数据传输）</h4><p>Client 收到 <code>SYN</code>+<code>ACK</code>，将 <code>SYN</code> 发给 Server。<br>连接成功，Client 与 Server 进入 <code>ESTABLISHED</code> 状态，可以传输数据。</p>\n<h4 id=\"TCP-为什么需要三次握手？\"><a href=\"#TCP-为什么需要三次握手？\" class=\"headerlink\" title=\"TCP 为什么需要三次握手？\"></a>TCP 为什么需要三次握手？</h4><p><strong>为了防止已失效的请求报文段传送到服务端而产生连接的误判。</strong></p>\n<p>假设是两次握手：</p>\n<p>当 A 发送一个连接请求给 B，但是该请求由于网络原因被阻塞了，一段时间后，A 未收到回复，会认为该消息丢失了，就会重新发送消息。</p>\n<p>当 A 和 B 通信完成后，这个被 A 认为已经丢失的请求到达了 B，B 会认为这是一个新的请求连接消息，就向 A 发送确认。</p>\n<p>但是 A 认为自己没有给 B 再次发送消息，所以不会理睬 B 的确认，但是 B 会一直等待 A 的消息，导致 B 的资源被浪费。</p>\n<p>这就是为什么不能两次握手。</p>\n<p><strong>设计成三次握手的情况，客户端在接收到服务端 SEQ+1 的返回消息后，就会知道该连接是历史连接，接着发送报文告诉服务端。</strong></p>\n<p>为了节省资源，也没必要设计成更多次的握手。</p>\n<h2 id=\"四次挥手\"><a href=\"#四次挥手\" class=\"headerlink\" title=\"四次挥手\"></a>四次挥手</h2><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://img-blog.csdnimg.cn/20190627203747107.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1NodWZmbGVfVHM=,size_16,color_FFFFFF,t_70\"\n                      alt=\"图2\"\n                ></p>\n<h3 id=\"四次挥手的-6-种状态\"><a href=\"#四次挥手的-6-种状态\" class=\"headerlink\" title=\"四次挥手的 6 种状态\"></a>四次挥手的 6 种状态</h3><h4 id=\"（1）FIN-WAIT-1\"><a href=\"#（1）FIN-WAIT-1\" class=\"headerlink\" title=\"（1）FIN_WAIT_1\"></a>（1）FIN_WAIT_1</h4><p>主动方在 <code>ESTABLISHED</code> 状态的时候，想要主动关闭连接，向对方发送 <code>FIN</code> 报文，并进入 <code>FIN_WAIT_1</code> 状态。</p>\n<h4 id=\"（2）FIN-WAIT-2\"><a href=\"#（2）FIN-WAIT-2\" class=\"headerlink\" title=\"（2）FIN_WAIT_2\"></a>（2）FIN_WAIT_2</h4><p>当主动方收到被动方回复的 <code>ACK</code> 报文后，就进入了 <code>FIN_WAIT_2</code> 状态。</p>\n<p>当主动方进入 <code>FIN_WAIT_2</code> 时，表示半连接状态，即被动方还有数据要发过来。</p>\n<h4 id=\"（3）CLOSE-WAIT\"><a href=\"#（3）CLOSE-WAIT\" class=\"headerlink\" title=\"（3）CLOSE_WAIT\"></a>（3）CLOSE_WAIT</h4><p>当被动方接收到 <code>FIN</code> 时，会回复一个 <code>ACK</code>，并进入 <code>CLOSE_WAIT</code> 状态。</p>\n<p>在该状态中，被动方如果还有数据要发送，就继续发送，如果没有，就关闭连接，并发送一个 <code>FIN</code> 给对方。</p>\n<h4 id=\"（4）TIME-WAIT\"><a href=\"#（4）TIME-WAIT\" class=\"headerlink\" title=\"（4）TIME_WAIT\"></a>（4）TIME_WAIT</h4><p>当主动方接收到了 <code>FIN</code> 报文，就回复一个 <code>ACK</code> 报文，并进入 <code>TIME_WAIT</code> 状态。</p>\n<p>如果主动方在 <code>FIN_WAIT_1</code> 状态下，收到了对方的 <code>FIN</code>+<code>ACK</code> 报文，可以跳过 <code>FIN_WAIT_2</code> 直接进入 <code>TIME_WAIT</code> 状态。</p>\n<h4 id=\"（5）LAST-ACK\"><a href=\"#（5）LAST-ACK\" class=\"headerlink\" title=\"（5）LAST_ACK\"></a>（5）LAST_ACK</h4><p>被动方发送了 <code>FIN</code> 报文后，最后等待对方的 <code>ACK</code> 报文时进入的状态。收到ACK报文后就可以进入CLOSED状态了。</p>\n<h4 id=\"（6）CLOSED\"><a href=\"#（6）CLOSED\" class=\"headerlink\" title=\"（6）CLOSED\"></a>（6）CLOSED</h4><p>主动方进入 <code>TIME_WAIT</code> 状态后，再等待 <code>2MSL</code> 就会进入 <code>CLOSED</code> 状态。<br>被动方在收到 <code>ACK</code> 报文后，立即进入 <code>CLOSED</code> 状态。</p>\n<h3 id=\"TIME-WAIT-的意义\"><a href=\"#TIME-WAIT-的意义\" class=\"headerlink\" title=\"TIME_WAIT 的意义\"></a><code>TIME_WAIT</code> 的意义</h3><p>如果没有 <code>TIME-WAIT</code>，主动方会直接进入 <code>CLOSED</code> 状态。<br>此时如果因为网络原因最后一次 <code>ACK</code> 丢失了，服务端会重复发送 <code>FIN</code> 请求给客户端，所以就需要主动方发送最后一次 <code>ACK</code> 之后进入 <code>TIME_WAIT</code> 状态，等待 <code>2MSL</code>（两个报文最大生命周期），等待这段时间就是为了如果接收到了重发的 <code>FIN</code> 请求能够进行最后一次 <code>ACK</code> 回复。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"三次握手\"><a href=\"#三次握手\" class=\"headerlink\" title=\"三次握手\"></a>三次握手</h2><h3 id=\"一、概念\"><a href=\"#一、概念\" class=\"headerlink\" title=\"一、概念\"></a>一、概念</h3><h4 id=\"1、TCP-协议\"><a href=\"#1、TCP-协议\" class=\"headerlink\" title=\"1、TCP 协议\"></a>1、TCP 协议</h4><p>TCP（Transmission Control Protocol），即传输控制协议。<br>TCP 协议是一个 <strong>面向连接的、可靠的、基于字节流</strong> 的 <strong>传输层协议</strong>。</p>\n<p>TCP 连接可以用于 <strong>保证可靠性</strong> 和 <strong>流量控制机制</strong>，包括 Socket、序列号及窗口大小。</p>\n<p>其中 Socket 是由 IP 加端口组成的，序列号是用来解决乱序问题的，而窗口大小则是用来做流量控制的。</p>\n<h4 id=\"2、TCP-的特点\"><a href=\"#2、TCP-的特点\" class=\"headerlink\" title=\"2、TCP 的特点\"></a>2、TCP 的特点</h4><ul>\n<li>面向连接：TCP 是通过服务端和客户端进行连接的协议。</li>\n<li>面向字节流：TCP 服务端和客户端之间的数据通讯是通过 <strong>字节流数据</strong> 传输的。</li>\n<li>可靠的：TCP 传输的可靠性得益于 TCP 会记录 <strong>信息的发送状态</strong> 和 <strong>数据的接收与否</strong>，对于丢包等发送不成功的情况，TCP 会重新发包，进而保证 TCP 的可靠性。</li>\n</ul>\n<h3 id=\"3、TCP-三次握手\"><a href=\"#3、TCP-三次握手\" class=\"headerlink\" title=\"3、TCP 三次握手\"></a>3、TCP 三次握手</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://ask.qcloudimg.com/http-save/yehe-1208223/0b58ac09994e834e14ca43dcf357294b.png?imageView2/2/w/1620\"\n                      alt=\"图1\"\n                ></p>\n<ul>\n<li>SYN：Synchronize Sequence Numbers，同步序列号，表示发起一个新连接。</li>\n<li>ACK：确认收到一个新连接。</li>\n<li>SEQ：序列号。</li>\n</ul>\n<p>TCP 三次握手执行过程：</p>\n<h4 id=\"（1）第一次握手（在吗？）\"><a href=\"#（1）第一次握手（在吗？）\" class=\"headerlink\" title=\"（1）第一次握手（在吗？）\"></a>（1）第一次握手（在吗？）</h4><p>Client 将 <code>SYN</code> 发给 Server。<br>Client 进入 <code>SYN_SENT</code> 状态，等待 Server 确认。</p>\n<h4 id=\"（2）第二次握手（在的，有事？）\"><a href=\"#（2）第二次握手（在的，有事？）\" class=\"headerlink\" title=\"（2）第二次握手（在的，有事？）\"></a>（2）第二次握手（在的，有事？）</h4><p>Server 收到 <code>SYN</code>，将 <code>SYN</code>+<code>ACK</code> 发给 Client。<br>Server 进入 <code>SYN_RCVD</code> 状态，等待 Client 确认。</p>\n<h4 id=\"（3）第三次握手（需要数据传输）\"><a href=\"#（3）第三次握手（需要数据传输）\" class=\"headerlink\" title=\"（3）第三次握手（需要数据传输）\"></a>（3）第三次握手（需要数据传输）</h4><p>Client 收到 <code>SYN</code>+<code>ACK</code>，将 <code>SYN</code> 发给 Server。<br>连接成功，Client 与 Server 进入 <code>ESTABLISHED</code> 状态，可以传输数据。</p>\n<h4 id=\"TCP-为什么需要三次握手？\"><a href=\"#TCP-为什么需要三次握手？\" class=\"headerlink\" title=\"TCP 为什么需要三次握手？\"></a>TCP 为什么需要三次握手？</h4><p><strong>为了防止已失效的请求报文段传送到服务端而产生连接的误判。</strong></p>\n<p>假设是两次握手：</p>\n<p>当 A 发送一个连接请求给 B，但是该请求由于网络原因被阻塞了，一段时间后，A 未收到回复，会认为该消息丢失了，就会重新发送消息。</p>\n<p>当 A 和 B 通信完成后，这个被 A 认为已经丢失的请求到达了 B，B 会认为这是一个新的请求连接消息，就向 A 发送确认。</p>\n<p>但是 A 认为自己没有给 B 再次发送消息，所以不会理睬 B 的确认，但是 B 会一直等待 A 的消息，导致 B 的资源被浪费。</p>\n<p>这就是为什么不能两次握手。</p>\n<p><strong>设计成三次握手的情况，客户端在接收到服务端 SEQ+1 的返回消息后，就会知道该连接是历史连接，接着发送报文告诉服务端。</strong></p>\n<p>为了节省资源，也没必要设计成更多次的握手。</p>\n<h2 id=\"四次挥手\"><a href=\"#四次挥手\" class=\"headerlink\" title=\"四次挥手\"></a>四次挥手</h2><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://img-blog.csdnimg.cn/20190627203747107.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1NodWZmbGVfVHM=,size_16,color_FFFFFF,t_70\"\n                      alt=\"图2\"\n                ></p>\n<h3 id=\"四次挥手的-6-种状态\"><a href=\"#四次挥手的-6-种状态\" class=\"headerlink\" title=\"四次挥手的 6 种状态\"></a>四次挥手的 6 种状态</h3><h4 id=\"（1）FIN-WAIT-1\"><a href=\"#（1）FIN-WAIT-1\" class=\"headerlink\" title=\"（1）FIN_WAIT_1\"></a>（1）FIN_WAIT_1</h4><p>主动方在 <code>ESTABLISHED</code> 状态的时候，想要主动关闭连接，向对方发送 <code>FIN</code> 报文，并进入 <code>FIN_WAIT_1</code> 状态。</p>\n<h4 id=\"（2）FIN-WAIT-2\"><a href=\"#（2）FIN-WAIT-2\" class=\"headerlink\" title=\"（2）FIN_WAIT_2\"></a>（2）FIN_WAIT_2</h4><p>当主动方收到被动方回复的 <code>ACK</code> 报文后，就进入了 <code>FIN_WAIT_2</code> 状态。</p>\n<p>当主动方进入 <code>FIN_WAIT_2</code> 时，表示半连接状态，即被动方还有数据要发过来。</p>\n<h4 id=\"（3）CLOSE-WAIT\"><a href=\"#（3）CLOSE-WAIT\" class=\"headerlink\" title=\"（3）CLOSE_WAIT\"></a>（3）CLOSE_WAIT</h4><p>当被动方接收到 <code>FIN</code> 时，会回复一个 <code>ACK</code>，并进入 <code>CLOSE_WAIT</code> 状态。</p>\n<p>在该状态中，被动方如果还有数据要发送，就继续发送，如果没有，就关闭连接，并发送一个 <code>FIN</code> 给对方。</p>\n<h4 id=\"（4）TIME-WAIT\"><a href=\"#（4）TIME-WAIT\" class=\"headerlink\" title=\"（4）TIME_WAIT\"></a>（4）TIME_WAIT</h4><p>当主动方接收到了 <code>FIN</code> 报文，就回复一个 <code>ACK</code> 报文，并进入 <code>TIME_WAIT</code> 状态。</p>\n<p>如果主动方在 <code>FIN_WAIT_1</code> 状态下，收到了对方的 <code>FIN</code>+<code>ACK</code> 报文，可以跳过 <code>FIN_WAIT_2</code> 直接进入 <code>TIME_WAIT</code> 状态。</p>\n<h4 id=\"（5）LAST-ACK\"><a href=\"#（5）LAST-ACK\" class=\"headerlink\" title=\"（5）LAST_ACK\"></a>（5）LAST_ACK</h4><p>被动方发送了 <code>FIN</code> 报文后，最后等待对方的 <code>ACK</code> 报文时进入的状态。收到ACK报文后就可以进入CLOSED状态了。</p>\n<h4 id=\"（6）CLOSED\"><a href=\"#（6）CLOSED\" class=\"headerlink\" title=\"（6）CLOSED\"></a>（6）CLOSED</h4><p>主动方进入 <code>TIME_WAIT</code> 状态后，再等待 <code>2MSL</code> 就会进入 <code>CLOSED</code> 状态。<br>被动方在收到 <code>ACK</code> 报文后，立即进入 <code>CLOSED</code> 状态。</p>\n<h3 id=\"TIME-WAIT-的意义\"><a href=\"#TIME-WAIT-的意义\" class=\"headerlink\" title=\"TIME_WAIT 的意义\"></a><code>TIME_WAIT</code> 的意义</h3><p>如果没有 <code>TIME-WAIT</code>，主动方会直接进入 <code>CLOSED</code> 状态。<br>此时如果因为网络原因最后一次 <code>ACK</code> 丢失了，服务端会重复发送 <code>FIN</code> 请求给客户端，所以就需要主动方发送最后一次 <code>ACK</code> 之后进入 <code>TIME_WAIT</code> 状态，等待 <code>2MSL</code>（两个报文最大生命周期），等待这段时间就是为了如果接收到了重发的 <code>FIN</code> 请求能够进行最后一次 <code>ACK</code> 回复。</p>\n","_processedHighlight":true},{"title":"interface & type","date":"2024-11-05T01:27:00.000Z","_content":"\n## 一、相同点\n\n### 1、都可以描述对象和函数的类型\n\n但语法不一样，type 使用 = 赋值\n\n``` ts\ninterface User {\n    name: string\n    age: number\n}\n\ninterface SetUser {\n    (name: string, age: number): void\n}\n```\n\n``` ts\ntype User = {\n    name: string\n    age: number\n}\n\ntype SetUser = (name: string, age: number) => void\n```\n\n### 2、都允许扩展（extends）\n\n并且 interface 和 type 可以互相扩展\n\n#### （1）interface 扩展 interface\n\n``` ts\ninterface Name {\n    name: string\n}\n\ninterface User extends Name {\n    age: number\n}\n```\n\n#### （2）type 扩展 type\n\n``` ts\ntype Name = {\n    name: string\n}\n\ntype User = Name & {\n    age: number\n}\n```\n\n#### （3）interface 扩展 type\n\n``` ts\ntype Name = {\n    name: string\n}\n\ninterface User extends Name {\n    age: number\n}\n```\n\n#### （4）type 扩展 interface\n\n``` ts\ninterface Name {\n    name: string\n}\n\ntype User = Name & {\n    age: number\n}\n```\n\n## 二、不同点\n\n### 1、type 可以，但 interface 不行\n\n#### （1）基本类型别名\n\n``` ts\ntype Name = string\n```\n\n#### （2）联合类型\n\n``` ts\ninterface Dog {\n    dogName: string\n}\ninterface Cat {\n    catName: string\n}\ntype Pet = Dog | Cat\n\ntype StringOrNumber = string | number\n\ntype Text = string | { text: string }\n```\n\n#### （3）元组\n\n具体定义数组每个位置的类型\n\n``` ts\ntype PetList = [Dog, List]\n```\n\n#### （4）使用 typeof 获取实例的类型 对 type 进行赋值\n\n``` ts\nlet divEle = document.createElement('div')\ntype Div = typeof divEle\n```\n\n### 2、interface 可以，但 type 不行\n\n#### interface 能够声明合并\n\n``` ts\ninterface User {\n    name: string\n}\n\ninterface User {\n    age: number\n}\n\n/**\n * User 接口为 {\n *     name: string\n *     age: number\n * }\n */\n```\n\n## 三、总结\n\n优先用 interface，无法实现再用 type，因为 interface 具有更直观和易于理解的特点，并且能够进行声明合并。\n","source":"_posts/28-interface&type.md","raw":"---\ntitle: interface & type\ndate: 2024-11-05 09:27:00\ntags:\n---\n\n## 一、相同点\n\n### 1、都可以描述对象和函数的类型\n\n但语法不一样，type 使用 = 赋值\n\n``` ts\ninterface User {\n    name: string\n    age: number\n}\n\ninterface SetUser {\n    (name: string, age: number): void\n}\n```\n\n``` ts\ntype User = {\n    name: string\n    age: number\n}\n\ntype SetUser = (name: string, age: number) => void\n```\n\n### 2、都允许扩展（extends）\n\n并且 interface 和 type 可以互相扩展\n\n#### （1）interface 扩展 interface\n\n``` ts\ninterface Name {\n    name: string\n}\n\ninterface User extends Name {\n    age: number\n}\n```\n\n#### （2）type 扩展 type\n\n``` ts\ntype Name = {\n    name: string\n}\n\ntype User = Name & {\n    age: number\n}\n```\n\n#### （3）interface 扩展 type\n\n``` ts\ntype Name = {\n    name: string\n}\n\ninterface User extends Name {\n    age: number\n}\n```\n\n#### （4）type 扩展 interface\n\n``` ts\ninterface Name {\n    name: string\n}\n\ntype User = Name & {\n    age: number\n}\n```\n\n## 二、不同点\n\n### 1、type 可以，但 interface 不行\n\n#### （1）基本类型别名\n\n``` ts\ntype Name = string\n```\n\n#### （2）联合类型\n\n``` ts\ninterface Dog {\n    dogName: string\n}\ninterface Cat {\n    catName: string\n}\ntype Pet = Dog | Cat\n\ntype StringOrNumber = string | number\n\ntype Text = string | { text: string }\n```\n\n#### （3）元组\n\n具体定义数组每个位置的类型\n\n``` ts\ntype PetList = [Dog, List]\n```\n\n#### （4）使用 typeof 获取实例的类型 对 type 进行赋值\n\n``` ts\nlet divEle = document.createElement('div')\ntype Div = typeof divEle\n```\n\n### 2、interface 可以，但 type 不行\n\n#### interface 能够声明合并\n\n``` ts\ninterface User {\n    name: string\n}\n\ninterface User {\n    age: number\n}\n\n/**\n * User 接口为 {\n *     name: string\n *     age: number\n * }\n */\n```\n\n## 三、总结\n\n优先用 interface，无法实现再用 type，因为 interface 具有更直观和易于理解的特点，并且能够进行声明合并。\n","slug":"28-interface&type","published":1,"updated":"2025-05-20T02:47:28.683Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu9001u6kprfbpv7rk3","content":"<h2 id=\"一、相同点\"><a href=\"#一、相同点\" class=\"headerlink\" title=\"一、相同点\"></a>一、相同点</h2><h3 id=\"1、都可以描述对象和函数的类型\"><a href=\"#1、都可以描述对象和函数的类型\" class=\"headerlink\" title=\"1、都可以描述对象和函数的类型\"></a>1、都可以描述对象和函数的类型</h3><p>但语法不一样，type 使用 &#x3D; 赋值</p>\n<div class=\"code-container\" data-rel=\"Ts\"><figure class=\"iseeu highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">User</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">SetUser</span> &#123;</span><br><span class=\"line\">    (<span class=\"attr\">name</span>: <span class=\"built_in\">string</span>, <span class=\"attr\">age</span>: <span class=\"built_in\">number</span>): <span class=\"built_in\">void</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Ts\"><figure class=\"iseeu highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">User</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">SetUser</span> = <span class=\"function\">(<span class=\"params\"><span class=\"attr\">name</span>: <span class=\"built_in\">string</span>, <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span>) =&gt;</span> <span class=\"built_in\">void</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"2、都允许扩展（extends）\"><a href=\"#2、都允许扩展（extends）\" class=\"headerlink\" title=\"2、都允许扩展（extends）\"></a>2、都允许扩展（extends）</h3><p>并且 interface 和 type 可以互相扩展</p>\n<h4 id=\"（1）interface-扩展-interface\"><a href=\"#（1）interface-扩展-interface\" class=\"headerlink\" title=\"（1）interface 扩展 interface\"></a>（1）interface 扩展 interface</h4><div class=\"code-container\" data-rel=\"Ts\"><figure class=\"iseeu highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Name</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">User</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Name</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"（2）type-扩展-type\"><a href=\"#（2）type-扩展-type\" class=\"headerlink\" title=\"（2）type 扩展 type\"></a>（2）type 扩展 type</h4><div class=\"code-container\" data-rel=\"Ts\"><figure class=\"iseeu highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Name</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">User</span> = <span class=\"title class_\">Name</span> &amp; &#123;</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"（3）interface-扩展-type\"><a href=\"#（3）interface-扩展-type\" class=\"headerlink\" title=\"（3）interface 扩展 type\"></a>（3）interface 扩展 type</h4><div class=\"code-container\" data-rel=\"Ts\"><figure class=\"iseeu highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Name</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">User</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Name</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"（4）type-扩展-interface\"><a href=\"#（4）type-扩展-interface\" class=\"headerlink\" title=\"（4）type 扩展 interface\"></a>（4）type 扩展 interface</h4><div class=\"code-container\" data-rel=\"Ts\"><figure class=\"iseeu highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Name</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">User</span> = <span class=\"title class_\">Name</span> &amp; &#123;</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"二、不同点\"><a href=\"#二、不同点\" class=\"headerlink\" title=\"二、不同点\"></a>二、不同点</h2><h3 id=\"1、type-可以，但-interface-不行\"><a href=\"#1、type-可以，但-interface-不行\" class=\"headerlink\" title=\"1、type 可以，但 interface 不行\"></a>1、type 可以，但 interface 不行</h3><h4 id=\"（1）基本类型别名\"><a href=\"#（1）基本类型别名\" class=\"headerlink\" title=\"（1）基本类型别名\"></a>（1）基本类型别名</h4><div class=\"code-container\" data-rel=\"Ts\"><figure class=\"iseeu highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Name</span> = <span class=\"built_in\">string</span></span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"（2）联合类型\"><a href=\"#（2）联合类型\" class=\"headerlink\" title=\"（2）联合类型\"></a>（2）联合类型</h4><div class=\"code-container\" data-rel=\"Ts\"><figure class=\"iseeu highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Dog</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">dogName</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Cat</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">catName</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Pet</span> = <span class=\"title class_\">Dog</span> | <span class=\"title class_\">Cat</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">StringOrNumber</span> = <span class=\"built_in\">string</span> | <span class=\"built_in\">number</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Text</span> = <span class=\"built_in\">string</span> | &#123; <span class=\"attr\">text</span>: <span class=\"built_in\">string</span> &#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"（3）元组\"><a href=\"#（3）元组\" class=\"headerlink\" title=\"（3）元组\"></a>（3）元组</h4><p>具体定义数组每个位置的类型</p>\n<div class=\"code-container\" data-rel=\"Ts\"><figure class=\"iseeu highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">PetList</span> = [<span class=\"title class_\">Dog</span>, <span class=\"title class_\">List</span>]</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"（4）使用-typeof-获取实例的类型-对-type-进行赋值\"><a href=\"#（4）使用-typeof-获取实例的类型-对-type-进行赋值\" class=\"headerlink\" title=\"（4）使用 typeof 获取实例的类型 对 type 进行赋值\"></a>（4）使用 typeof 获取实例的类型 对 type 进行赋值</h4><div class=\"code-container\" data-rel=\"Ts\"><figure class=\"iseeu highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> divEle = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;div&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Div</span> = <span class=\"keyword\">typeof</span> divEle</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"2、interface-可以，但-type-不行\"><a href=\"#2、interface-可以，但-type-不行\" class=\"headerlink\" title=\"2、interface 可以，但 type 不行\"></a>2、interface 可以，但 type 不行</h3><h4 id=\"interface-能够声明合并\"><a href=\"#interface-能够声明合并\" class=\"headerlink\" title=\"interface 能够声明合并\"></a>interface 能够声明合并</h4><div class=\"code-container\" data-rel=\"Ts\"><figure class=\"iseeu highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">User</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">User</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * User 接口为 &#123;</span></span><br><span class=\"line\"><span class=\"comment\"> *     name: string</span></span><br><span class=\"line\"><span class=\"comment\"> *     age: number</span></span><br><span class=\"line\"><span class=\"comment\"> * &#125;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"三、总结\"><a href=\"#三、总结\" class=\"headerlink\" title=\"三、总结\"></a>三、总结</h2><p>优先用 interface，无法实现再用 type，因为 interface 具有更直观和易于理解的特点，并且能够进行声明合并。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、相同点\"><a href=\"#一、相同点\" class=\"headerlink\" title=\"一、相同点\"></a>一、相同点</h2><h3 id=\"1、都可以描述对象和函数的类型\"><a href=\"#1、都可以描述对象和函数的类型\" class=\"headerlink\" title=\"1、都可以描述对象和函数的类型\"></a>1、都可以描述对象和函数的类型</h3><p>但语法不一样，type 使用 &#x3D; 赋值</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">User</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">SetUser</span> &#123;</span><br><span class=\"line\">    (<span class=\"attr\">name</span>: <span class=\"built_in\">string</span>, <span class=\"attr\">age</span>: <span class=\"built_in\">number</span>): <span class=\"built_in\">void</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">User</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">SetUser</span> = <span class=\"function\">(<span class=\"params\"><span class=\"attr\">name</span>: <span class=\"built_in\">string</span>, <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span>) =&gt;</span> <span class=\"built_in\">void</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、都允许扩展（extends）\"><a href=\"#2、都允许扩展（extends）\" class=\"headerlink\" title=\"2、都允许扩展（extends）\"></a>2、都允许扩展（extends）</h3><p>并且 interface 和 type 可以互相扩展</p>\n<h4 id=\"（1）interface-扩展-interface\"><a href=\"#（1）interface-扩展-interface\" class=\"headerlink\" title=\"（1）interface 扩展 interface\"></a>（1）interface 扩展 interface</h4><figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Name</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">User</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Name</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"（2）type-扩展-type\"><a href=\"#（2）type-扩展-type\" class=\"headerlink\" title=\"（2）type 扩展 type\"></a>（2）type 扩展 type</h4><figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Name</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">User</span> = <span class=\"title class_\">Name</span> &amp; &#123;</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"（3）interface-扩展-type\"><a href=\"#（3）interface-扩展-type\" class=\"headerlink\" title=\"（3）interface 扩展 type\"></a>（3）interface 扩展 type</h4><figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Name</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">User</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Name</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"（4）type-扩展-interface\"><a href=\"#（4）type-扩展-interface\" class=\"headerlink\" title=\"（4）type 扩展 interface\"></a>（4）type 扩展 interface</h4><figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Name</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">User</span> = <span class=\"title class_\">Name</span> &amp; &#123;</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"二、不同点\"><a href=\"#二、不同点\" class=\"headerlink\" title=\"二、不同点\"></a>二、不同点</h2><h3 id=\"1、type-可以，但-interface-不行\"><a href=\"#1、type-可以，但-interface-不行\" class=\"headerlink\" title=\"1、type 可以，但 interface 不行\"></a>1、type 可以，但 interface 不行</h3><h4 id=\"（1）基本类型别名\"><a href=\"#（1）基本类型别名\" class=\"headerlink\" title=\"（1）基本类型别名\"></a>（1）基本类型别名</h4><figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Name</span> = <span class=\"built_in\">string</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"（2）联合类型\"><a href=\"#（2）联合类型\" class=\"headerlink\" title=\"（2）联合类型\"></a>（2）联合类型</h4><figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Dog</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">dogName</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Cat</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">catName</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Pet</span> = <span class=\"title class_\">Dog</span> | <span class=\"title class_\">Cat</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">StringOrNumber</span> = <span class=\"built_in\">string</span> | <span class=\"built_in\">number</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Text</span> = <span class=\"built_in\">string</span> | &#123; <span class=\"attr\">text</span>: <span class=\"built_in\">string</span> &#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"（3）元组\"><a href=\"#（3）元组\" class=\"headerlink\" title=\"（3）元组\"></a>（3）元组</h4><p>具体定义数组每个位置的类型</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">PetList</span> = [<span class=\"title class_\">Dog</span>, <span class=\"title class_\">List</span>]</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"（4）使用-typeof-获取实例的类型-对-type-进行赋值\"><a href=\"#（4）使用-typeof-获取实例的类型-对-type-进行赋值\" class=\"headerlink\" title=\"（4）使用 typeof 获取实例的类型 对 type 进行赋值\"></a>（4）使用 typeof 获取实例的类型 对 type 进行赋值</h4><figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> divEle = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;div&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">Div</span> = <span class=\"keyword\">typeof</span> divEle</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、interface-可以，但-type-不行\"><a href=\"#2、interface-可以，但-type-不行\" class=\"headerlink\" title=\"2、interface 可以，但 type 不行\"></a>2、interface 可以，但 type 不行</h3><h4 id=\"interface-能够声明合并\"><a href=\"#interface-能够声明合并\" class=\"headerlink\" title=\"interface 能够声明合并\"></a>interface 能够声明合并</h4><figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">User</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">User</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">age</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * User 接口为 &#123;</span></span><br><span class=\"line\"><span class=\"comment\"> *     name: string</span></span><br><span class=\"line\"><span class=\"comment\"> *     age: number</span></span><br><span class=\"line\"><span class=\"comment\"> * &#125;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"三、总结\"><a href=\"#三、总结\" class=\"headerlink\" title=\"三、总结\"></a>三、总结</h2><p>优先用 interface，无法实现再用 type，因为 interface 具有更直观和易于理解的特点，并且能够进行声明合并。</p>\n","_processedHighlight":true},{"title":"TCP","date":"2024-11-05T09:31:10.000Z","_content":"\n![图1](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/23/1707236e03d22cbc~tplv-t2oaga2asx-zoom-in-crop-mark:1512:0:0:0.webp)\n\n## 一、TCP 和 UDP 的区别\n\nTCP 和 UDP 都是传输层协议，不同点在于：\n\n- TCP 是 **面向连接的、可靠的、面向字节流** 的\n- UDP 是 **面向无连接** 的\n\nTCP 的三大核心特性\n\n### 1、面向连接\n\n在客户端和服务器互相通信之前，TCP 需要三次握手建立连接，而 UDP 不需要\n\n### 2、可靠性\n\nTCP 的可靠性体现在**有状态、可控制**。\n\n#### （1）有状态\n\nTCP 会记录发送的数据，以及其中被接收和未被接收的数据，并保证数据包按序到达\n\n#### （2）可控制\n\n当意识到丢包或网络不佳，TCP 会根据情况调整自身行为，控制发送速度或者重发\n\n### 3、面向字节流\n\nUDP 的数据传输是基于数据报的，这仅仅继承了 IP 层的特性；而 TCP 为了维护状态，将 IP 包变成了字节流\n\n## 二、TCP 三次握手过程 & 为什么是三次\n\n### 1、流程\n\n发送与接收方需要确认双方的两种能力：发送和接收，于是会有三次握手的过程:\n\n![图2](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/23/170723de9b8aa08b~tplv-t2oaga2asx-zoom-in-crop-mark:1512:0:0:0.webp)\n\n#### （1）服务器变为 LISTEN\n\n##### 起初双方都处于 CLOSED 状态。服务端开始监听某个端口，进入 LISTEN 状态\n\n#### （2）客户端变为 SYN-SENT\n\n##### 客户端主动发起连接，发送 SYN，并进入 SYN-SENT 状态\n\n其中 seq=x，表示客户端告诉服务端，我发送的首个数据包 序列号从 x 开始\n\n#### （3）服务端变为 SYN-REVD\n\n##### 服务端接收到，返回 SYN 和 ACK（对应客户端发来的 SYN），并进入 SYN-REVD 状态\n\n其中 seq=y，ack=x+1，seq=y 表示服务端的初始序列号是 y ，ack=x+1 表示服务端告诉客户端：已收到从序列号 x 开始的数据包，期望下次发送从序列号 x+1 开始的数据包\n\n#### （4）客户端变为 ESTABLISHED\n\n##### 客户端再发送 ACK 给服务端，并进入 ESTABLISHED 状态\n\n其中 seq=x+1 ，ack=y+1 。seq=x+1 表示客户端按照服务端的期望，从序列号 x+1 开始发送数据包，ack=y+1 表示客户端告诉服务端：已收到从序列号 y 开始的数据包，期望下次发送从序列号 y+1 开始的数据包\n\n##### 服务端收到 ACK 之后，也进入 ESTABLISHED 状态\n\n注意：凡是需要对端确认的，一定会消耗 TCP 报文的序列号。\nSYN 需要对端的确认，而 ACK 不需要，因此 SYN 消耗一个序列号，下次发送对应的 ACK 序列号要加 1，而 ACK 不需要。\n\n### 2、为什么不是两次握手\n\n根本原因：**没有第三次握手，服务端无法确认客户端的接收能力**\n\n如果是两次，客户端发送 SYN 报文试图和服务端建立连接，但是这个包发生了滞留；一段时间后，客户端未收到服务端响应，以为丢了包，于是重传，两次握手建立好了连接。\n\n但是在连接关闭后，如果滞留的包到达了服务端，这时由于是两次握手，服务端只要接收到、并给客户端发送了相应的数据包，就默认建立连接，但是此时客户端已经断开，这就带来了资源的浪费。\n\n### 3、三次握手过程中可以携带数据么\n\n第三次握手可以携带数据，前两次握手不能携带\n\n如果前两次握手能够携带数据，一旦有人想攻击服务器，只需要在第一次握手中的 SYN 报文中放大量数据，服务器势必会消耗更多的时间和内存空间去进行处理，增大了服务器被攻击的风险\n\n第三次握手时，客户端已处于 ESTABLISHED 状态，并且能够确认服务器的接收、发送能力正常，这时相对安全，可以携带数据\n\n## 三、TCP 四次挥手的过程\n","source":"_posts/29-TCP.md","raw":"---\ntitle: TCP\ndate: 2024-11-05 17:31:10\ntags:\n    - 面经\n    - 计算机网络\n    - TCP\ncategories:\n    - 计算机网络\n      - TCP\n---\n\n![图1](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/23/1707236e03d22cbc~tplv-t2oaga2asx-zoom-in-crop-mark:1512:0:0:0.webp)\n\n## 一、TCP 和 UDP 的区别\n\nTCP 和 UDP 都是传输层协议，不同点在于：\n\n- TCP 是 **面向连接的、可靠的、面向字节流** 的\n- UDP 是 **面向无连接** 的\n\nTCP 的三大核心特性\n\n### 1、面向连接\n\n在客户端和服务器互相通信之前，TCP 需要三次握手建立连接，而 UDP 不需要\n\n### 2、可靠性\n\nTCP 的可靠性体现在**有状态、可控制**。\n\n#### （1）有状态\n\nTCP 会记录发送的数据，以及其中被接收和未被接收的数据，并保证数据包按序到达\n\n#### （2）可控制\n\n当意识到丢包或网络不佳，TCP 会根据情况调整自身行为，控制发送速度或者重发\n\n### 3、面向字节流\n\nUDP 的数据传输是基于数据报的，这仅仅继承了 IP 层的特性；而 TCP 为了维护状态，将 IP 包变成了字节流\n\n## 二、TCP 三次握手过程 & 为什么是三次\n\n### 1、流程\n\n发送与接收方需要确认双方的两种能力：发送和接收，于是会有三次握手的过程:\n\n![图2](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/23/170723de9b8aa08b~tplv-t2oaga2asx-zoom-in-crop-mark:1512:0:0:0.webp)\n\n#### （1）服务器变为 LISTEN\n\n##### 起初双方都处于 CLOSED 状态。服务端开始监听某个端口，进入 LISTEN 状态\n\n#### （2）客户端变为 SYN-SENT\n\n##### 客户端主动发起连接，发送 SYN，并进入 SYN-SENT 状态\n\n其中 seq=x，表示客户端告诉服务端，我发送的首个数据包 序列号从 x 开始\n\n#### （3）服务端变为 SYN-REVD\n\n##### 服务端接收到，返回 SYN 和 ACK（对应客户端发来的 SYN），并进入 SYN-REVD 状态\n\n其中 seq=y，ack=x+1，seq=y 表示服务端的初始序列号是 y ，ack=x+1 表示服务端告诉客户端：已收到从序列号 x 开始的数据包，期望下次发送从序列号 x+1 开始的数据包\n\n#### （4）客户端变为 ESTABLISHED\n\n##### 客户端再发送 ACK 给服务端，并进入 ESTABLISHED 状态\n\n其中 seq=x+1 ，ack=y+1 。seq=x+1 表示客户端按照服务端的期望，从序列号 x+1 开始发送数据包，ack=y+1 表示客户端告诉服务端：已收到从序列号 y 开始的数据包，期望下次发送从序列号 y+1 开始的数据包\n\n##### 服务端收到 ACK 之后，也进入 ESTABLISHED 状态\n\n注意：凡是需要对端确认的，一定会消耗 TCP 报文的序列号。\nSYN 需要对端的确认，而 ACK 不需要，因此 SYN 消耗一个序列号，下次发送对应的 ACK 序列号要加 1，而 ACK 不需要。\n\n### 2、为什么不是两次握手\n\n根本原因：**没有第三次握手，服务端无法确认客户端的接收能力**\n\n如果是两次，客户端发送 SYN 报文试图和服务端建立连接，但是这个包发生了滞留；一段时间后，客户端未收到服务端响应，以为丢了包，于是重传，两次握手建立好了连接。\n\n但是在连接关闭后，如果滞留的包到达了服务端，这时由于是两次握手，服务端只要接收到、并给客户端发送了相应的数据包，就默认建立连接，但是此时客户端已经断开，这就带来了资源的浪费。\n\n### 3、三次握手过程中可以携带数据么\n\n第三次握手可以携带数据，前两次握手不能携带\n\n如果前两次握手能够携带数据，一旦有人想攻击服务器，只需要在第一次握手中的 SYN 报文中放大量数据，服务器势必会消耗更多的时间和内存空间去进行处理，增大了服务器被攻击的风险\n\n第三次握手时，客户端已处于 ESTABLISHED 状态，并且能够确认服务器的接收、发送能力正常，这时相对安全，可以携带数据\n\n## 三、TCP 四次挥手的过程\n","slug":"29-TCP","published":1,"updated":"2025-05-20T02:47:28.683Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu9001x6kpr2lqz1azi","content":"<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/23/1707236e03d22cbc~tplv-t2oaga2asx-zoom-in-crop-mark:1512:0:0:0.webp\"\n                      alt=\"图1\"\n                ></p>\n<h2 id=\"一、TCP-和-UDP-的区别\"><a href=\"#一、TCP-和-UDP-的区别\" class=\"headerlink\" title=\"一、TCP 和 UDP 的区别\"></a>一、TCP 和 UDP 的区别</h2><p>TCP 和 UDP 都是传输层协议，不同点在于：</p>\n<ul>\n<li>TCP 是 <strong>面向连接的、可靠的、面向字节流</strong> 的</li>\n<li>UDP 是 <strong>面向无连接</strong> 的</li>\n</ul>\n<p>TCP 的三大核心特性</p>\n<h3 id=\"1、面向连接\"><a href=\"#1、面向连接\" class=\"headerlink\" title=\"1、面向连接\"></a>1、面向连接</h3><p>在客户端和服务器互相通信之前，TCP 需要三次握手建立连接，而 UDP 不需要</p>\n<h3 id=\"2、可靠性\"><a href=\"#2、可靠性\" class=\"headerlink\" title=\"2、可靠性\"></a>2、可靠性</h3><p>TCP 的可靠性体现在<strong>有状态、可控制</strong>。</p>\n<h4 id=\"（1）有状态\"><a href=\"#（1）有状态\" class=\"headerlink\" title=\"（1）有状态\"></a>（1）有状态</h4><p>TCP 会记录发送的数据，以及其中被接收和未被接收的数据，并保证数据包按序到达</p>\n<h4 id=\"（2）可控制\"><a href=\"#（2）可控制\" class=\"headerlink\" title=\"（2）可控制\"></a>（2）可控制</h4><p>当意识到丢包或网络不佳，TCP 会根据情况调整自身行为，控制发送速度或者重发</p>\n<h3 id=\"3、面向字节流\"><a href=\"#3、面向字节流\" class=\"headerlink\" title=\"3、面向字节流\"></a>3、面向字节流</h3><p>UDP 的数据传输是基于数据报的，这仅仅继承了 IP 层的特性；而 TCP 为了维护状态，将 IP 包变成了字节流</p>\n<h2 id=\"二、TCP-三次握手过程-为什么是三次\"><a href=\"#二、TCP-三次握手过程-为什么是三次\" class=\"headerlink\" title=\"二、TCP 三次握手过程 &amp; 为什么是三次\"></a>二、TCP 三次握手过程 &amp; 为什么是三次</h2><h3 id=\"1、流程\"><a href=\"#1、流程\" class=\"headerlink\" title=\"1、流程\"></a>1、流程</h3><p>发送与接收方需要确认双方的两种能力：发送和接收，于是会有三次握手的过程:</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/23/170723de9b8aa08b~tplv-t2oaga2asx-zoom-in-crop-mark:1512:0:0:0.webp\"\n                      alt=\"图2\"\n                ></p>\n<h4 id=\"（1）服务器变为-LISTEN\"><a href=\"#（1）服务器变为-LISTEN\" class=\"headerlink\" title=\"（1）服务器变为 LISTEN\"></a>（1）服务器变为 LISTEN</h4><h5 id=\"起初双方都处于-CLOSED-状态。服务端开始监听某个端口，进入-LISTEN-状态\"><a href=\"#起初双方都处于-CLOSED-状态。服务端开始监听某个端口，进入-LISTEN-状态\" class=\"headerlink\" title=\"起初双方都处于 CLOSED 状态。服务端开始监听某个端口，进入 LISTEN 状态\"></a>起初双方都处于 CLOSED 状态。服务端开始监听某个端口，进入 LISTEN 状态</h5><h4 id=\"（2）客户端变为-SYN-SENT\"><a href=\"#（2）客户端变为-SYN-SENT\" class=\"headerlink\" title=\"（2）客户端变为 SYN-SENT\"></a>（2）客户端变为 SYN-SENT</h4><h5 id=\"客户端主动发起连接，发送-SYN，并进入-SYN-SENT-状态\"><a href=\"#客户端主动发起连接，发送-SYN，并进入-SYN-SENT-状态\" class=\"headerlink\" title=\"客户端主动发起连接，发送 SYN，并进入 SYN-SENT 状态\"></a>客户端主动发起连接，发送 SYN，并进入 SYN-SENT 状态</h5><p>其中 seq&#x3D;x，表示客户端告诉服务端，我发送的首个数据包 序列号从 x 开始</p>\n<h4 id=\"（3）服务端变为-SYN-REVD\"><a href=\"#（3）服务端变为-SYN-REVD\" class=\"headerlink\" title=\"（3）服务端变为 SYN-REVD\"></a>（3）服务端变为 SYN-REVD</h4><h5 id=\"服务端接收到，返回-SYN-和-ACK（对应客户端发来的-SYN），并进入-SYN-REVD-状态\"><a href=\"#服务端接收到，返回-SYN-和-ACK（对应客户端发来的-SYN），并进入-SYN-REVD-状态\" class=\"headerlink\" title=\"服务端接收到，返回 SYN 和 ACK（对应客户端发来的 SYN），并进入 SYN-REVD 状态\"></a>服务端接收到，返回 SYN 和 ACK（对应客户端发来的 SYN），并进入 SYN-REVD 状态</h5><p>其中 seq&#x3D;y，ack&#x3D;x+1，seq&#x3D;y 表示服务端的初始序列号是 y ，ack&#x3D;x+1 表示服务端告诉客户端：已收到从序列号 x 开始的数据包，期望下次发送从序列号 x+1 开始的数据包</p>\n<h4 id=\"（4）客户端变为-ESTABLISHED\"><a href=\"#（4）客户端变为-ESTABLISHED\" class=\"headerlink\" title=\"（4）客户端变为 ESTABLISHED\"></a>（4）客户端变为 ESTABLISHED</h4><h5 id=\"客户端再发送-ACK-给服务端，并进入-ESTABLISHED-状态\"><a href=\"#客户端再发送-ACK-给服务端，并进入-ESTABLISHED-状态\" class=\"headerlink\" title=\"客户端再发送 ACK 给服务端，并进入 ESTABLISHED 状态\"></a>客户端再发送 ACK 给服务端，并进入 ESTABLISHED 状态</h5><p>其中 seq&#x3D;x+1 ，ack&#x3D;y+1 。seq&#x3D;x+1 表示客户端按照服务端的期望，从序列号 x+1 开始发送数据包，ack&#x3D;y+1 表示客户端告诉服务端：已收到从序列号 y 开始的数据包，期望下次发送从序列号 y+1 开始的数据包</p>\n<h5 id=\"服务端收到-ACK-之后，也进入-ESTABLISHED-状态\"><a href=\"#服务端收到-ACK-之后，也进入-ESTABLISHED-状态\" class=\"headerlink\" title=\"服务端收到 ACK 之后，也进入 ESTABLISHED 状态\"></a>服务端收到 ACK 之后，也进入 ESTABLISHED 状态</h5><p>注意：凡是需要对端确认的，一定会消耗 TCP 报文的序列号。<br>SYN 需要对端的确认，而 ACK 不需要，因此 SYN 消耗一个序列号，下次发送对应的 ACK 序列号要加 1，而 ACK 不需要。</p>\n<h3 id=\"2、为什么不是两次握手\"><a href=\"#2、为什么不是两次握手\" class=\"headerlink\" title=\"2、为什么不是两次握手\"></a>2、为什么不是两次握手</h3><p>根本原因：<strong>没有第三次握手，服务端无法确认客户端的接收能力</strong></p>\n<p>如果是两次，客户端发送 SYN 报文试图和服务端建立连接，但是这个包发生了滞留；一段时间后，客户端未收到服务端响应，以为丢了包，于是重传，两次握手建立好了连接。</p>\n<p>但是在连接关闭后，如果滞留的包到达了服务端，这时由于是两次握手，服务端只要接收到、并给客户端发送了相应的数据包，就默认建立连接，但是此时客户端已经断开，这就带来了资源的浪费。</p>\n<h3 id=\"3、三次握手过程中可以携带数据么\"><a href=\"#3、三次握手过程中可以携带数据么\" class=\"headerlink\" title=\"3、三次握手过程中可以携带数据么\"></a>3、三次握手过程中可以携带数据么</h3><p>第三次握手可以携带数据，前两次握手不能携带</p>\n<p>如果前两次握手能够携带数据，一旦有人想攻击服务器，只需要在第一次握手中的 SYN 报文中放大量数据，服务器势必会消耗更多的时间和内存空间去进行处理，增大了服务器被攻击的风险</p>\n<p>第三次握手时，客户端已处于 ESTABLISHED 状态，并且能够确认服务器的接收、发送能力正常，这时相对安全，可以携带数据</p>\n<h2 id=\"三、TCP-四次挥手的过程\"><a href=\"#三、TCP-四次挥手的过程\" class=\"headerlink\" title=\"三、TCP 四次挥手的过程\"></a>三、TCP 四次挥手的过程</h2>","site":{"data":{}},"excerpt":"","more":"<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/23/1707236e03d22cbc~tplv-t2oaga2asx-zoom-in-crop-mark:1512:0:0:0.webp\"\n                      alt=\"图1\"\n                ></p>\n<h2 id=\"一、TCP-和-UDP-的区别\"><a href=\"#一、TCP-和-UDP-的区别\" class=\"headerlink\" title=\"一、TCP 和 UDP 的区别\"></a>一、TCP 和 UDP 的区别</h2><p>TCP 和 UDP 都是传输层协议，不同点在于：</p>\n<ul>\n<li>TCP 是 <strong>面向连接的、可靠的、面向字节流</strong> 的</li>\n<li>UDP 是 <strong>面向无连接</strong> 的</li>\n</ul>\n<p>TCP 的三大核心特性</p>\n<h3 id=\"1、面向连接\"><a href=\"#1、面向连接\" class=\"headerlink\" title=\"1、面向连接\"></a>1、面向连接</h3><p>在客户端和服务器互相通信之前，TCP 需要三次握手建立连接，而 UDP 不需要</p>\n<h3 id=\"2、可靠性\"><a href=\"#2、可靠性\" class=\"headerlink\" title=\"2、可靠性\"></a>2、可靠性</h3><p>TCP 的可靠性体现在<strong>有状态、可控制</strong>。</p>\n<h4 id=\"（1）有状态\"><a href=\"#（1）有状态\" class=\"headerlink\" title=\"（1）有状态\"></a>（1）有状态</h4><p>TCP 会记录发送的数据，以及其中被接收和未被接收的数据，并保证数据包按序到达</p>\n<h4 id=\"（2）可控制\"><a href=\"#（2）可控制\" class=\"headerlink\" title=\"（2）可控制\"></a>（2）可控制</h4><p>当意识到丢包或网络不佳，TCP 会根据情况调整自身行为，控制发送速度或者重发</p>\n<h3 id=\"3、面向字节流\"><a href=\"#3、面向字节流\" class=\"headerlink\" title=\"3、面向字节流\"></a>3、面向字节流</h3><p>UDP 的数据传输是基于数据报的，这仅仅继承了 IP 层的特性；而 TCP 为了维护状态，将 IP 包变成了字节流</p>\n<h2 id=\"二、TCP-三次握手过程-为什么是三次\"><a href=\"#二、TCP-三次握手过程-为什么是三次\" class=\"headerlink\" title=\"二、TCP 三次握手过程 &amp; 为什么是三次\"></a>二、TCP 三次握手过程 &amp; 为什么是三次</h2><h3 id=\"1、流程\"><a href=\"#1、流程\" class=\"headerlink\" title=\"1、流程\"></a>1、流程</h3><p>发送与接收方需要确认双方的两种能力：发送和接收，于是会有三次握手的过程:</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/23/170723de9b8aa08b~tplv-t2oaga2asx-zoom-in-crop-mark:1512:0:0:0.webp\"\n                      alt=\"图2\"\n                ></p>\n<h4 id=\"（1）服务器变为-LISTEN\"><a href=\"#（1）服务器变为-LISTEN\" class=\"headerlink\" title=\"（1）服务器变为 LISTEN\"></a>（1）服务器变为 LISTEN</h4><h5 id=\"起初双方都处于-CLOSED-状态。服务端开始监听某个端口，进入-LISTEN-状态\"><a href=\"#起初双方都处于-CLOSED-状态。服务端开始监听某个端口，进入-LISTEN-状态\" class=\"headerlink\" title=\"起初双方都处于 CLOSED 状态。服务端开始监听某个端口，进入 LISTEN 状态\"></a>起初双方都处于 CLOSED 状态。服务端开始监听某个端口，进入 LISTEN 状态</h5><h4 id=\"（2）客户端变为-SYN-SENT\"><a href=\"#（2）客户端变为-SYN-SENT\" class=\"headerlink\" title=\"（2）客户端变为 SYN-SENT\"></a>（2）客户端变为 SYN-SENT</h4><h5 id=\"客户端主动发起连接，发送-SYN，并进入-SYN-SENT-状态\"><a href=\"#客户端主动发起连接，发送-SYN，并进入-SYN-SENT-状态\" class=\"headerlink\" title=\"客户端主动发起连接，发送 SYN，并进入 SYN-SENT 状态\"></a>客户端主动发起连接，发送 SYN，并进入 SYN-SENT 状态</h5><p>其中 seq&#x3D;x，表示客户端告诉服务端，我发送的首个数据包 序列号从 x 开始</p>\n<h4 id=\"（3）服务端变为-SYN-REVD\"><a href=\"#（3）服务端变为-SYN-REVD\" class=\"headerlink\" title=\"（3）服务端变为 SYN-REVD\"></a>（3）服务端变为 SYN-REVD</h4><h5 id=\"服务端接收到，返回-SYN-和-ACK（对应客户端发来的-SYN），并进入-SYN-REVD-状态\"><a href=\"#服务端接收到，返回-SYN-和-ACK（对应客户端发来的-SYN），并进入-SYN-REVD-状态\" class=\"headerlink\" title=\"服务端接收到，返回 SYN 和 ACK（对应客户端发来的 SYN），并进入 SYN-REVD 状态\"></a>服务端接收到，返回 SYN 和 ACK（对应客户端发来的 SYN），并进入 SYN-REVD 状态</h5><p>其中 seq&#x3D;y，ack&#x3D;x+1，seq&#x3D;y 表示服务端的初始序列号是 y ，ack&#x3D;x+1 表示服务端告诉客户端：已收到从序列号 x 开始的数据包，期望下次发送从序列号 x+1 开始的数据包</p>\n<h4 id=\"（4）客户端变为-ESTABLISHED\"><a href=\"#（4）客户端变为-ESTABLISHED\" class=\"headerlink\" title=\"（4）客户端变为 ESTABLISHED\"></a>（4）客户端变为 ESTABLISHED</h4><h5 id=\"客户端再发送-ACK-给服务端，并进入-ESTABLISHED-状态\"><a href=\"#客户端再发送-ACK-给服务端，并进入-ESTABLISHED-状态\" class=\"headerlink\" title=\"客户端再发送 ACK 给服务端，并进入 ESTABLISHED 状态\"></a>客户端再发送 ACK 给服务端，并进入 ESTABLISHED 状态</h5><p>其中 seq&#x3D;x+1 ，ack&#x3D;y+1 。seq&#x3D;x+1 表示客户端按照服务端的期望，从序列号 x+1 开始发送数据包，ack&#x3D;y+1 表示客户端告诉服务端：已收到从序列号 y 开始的数据包，期望下次发送从序列号 y+1 开始的数据包</p>\n<h5 id=\"服务端收到-ACK-之后，也进入-ESTABLISHED-状态\"><a href=\"#服务端收到-ACK-之后，也进入-ESTABLISHED-状态\" class=\"headerlink\" title=\"服务端收到 ACK 之后，也进入 ESTABLISHED 状态\"></a>服务端收到 ACK 之后，也进入 ESTABLISHED 状态</h5><p>注意：凡是需要对端确认的，一定会消耗 TCP 报文的序列号。<br>SYN 需要对端的确认，而 ACK 不需要，因此 SYN 消耗一个序列号，下次发送对应的 ACK 序列号要加 1，而 ACK 不需要。</p>\n<h3 id=\"2、为什么不是两次握手\"><a href=\"#2、为什么不是两次握手\" class=\"headerlink\" title=\"2、为什么不是两次握手\"></a>2、为什么不是两次握手</h3><p>根本原因：<strong>没有第三次握手，服务端无法确认客户端的接收能力</strong></p>\n<p>如果是两次，客户端发送 SYN 报文试图和服务端建立连接，但是这个包发生了滞留；一段时间后，客户端未收到服务端响应，以为丢了包，于是重传，两次握手建立好了连接。</p>\n<p>但是在连接关闭后，如果滞留的包到达了服务端，这时由于是两次握手，服务端只要接收到、并给客户端发送了相应的数据包，就默认建立连接，但是此时客户端已经断开，这就带来了资源的浪费。</p>\n<h3 id=\"3、三次握手过程中可以携带数据么\"><a href=\"#3、三次握手过程中可以携带数据么\" class=\"headerlink\" title=\"3、三次握手过程中可以携带数据么\"></a>3、三次握手过程中可以携带数据么</h3><p>第三次握手可以携带数据，前两次握手不能携带</p>\n<p>如果前两次握手能够携带数据，一旦有人想攻击服务器，只需要在第一次握手中的 SYN 报文中放大量数据，服务器势必会消耗更多的时间和内存空间去进行处理，增大了服务器被攻击的风险</p>\n<p>第三次握手时，客户端已处于 ESTABLISHED 状态，并且能够确认服务器的接收、发送能力正常，这时相对安全，可以携带数据</p>\n<h2 id=\"三、TCP-四次挥手的过程\"><a href=\"#三、TCP-四次挥手的过程\" class=\"headerlink\" title=\"三、TCP 四次挥手的过程\"></a>三、TCP 四次挥手的过程</h2>","_processedHighlight":true},{"title":"vue3 响应式","date":"2023-11-06T08:41:05.000Z","_content":"\n## ref()\n\nref() 返回一个包含属性 value 的对象\n\n``` js\nimport { ref } from 'vue';\n\nexport default {\n    setup() {\n        const count = ref(0);\n        function increment() {\n            count.value++;\n        }\n        return {\n            count,\n            increment\n        }\n    }\n}\n```\n\n``` html\n<button @click=\"increment\">{{ count }}</button>\n```\n\n### 原理\n\nref 的 .value 属性使得 Vue 可以检测其何时被访问或修改\n\n当一个组件首次渲染时，Vue 会**追踪**在渲染过程中使用的每一个 ref；当一个 ref 被修改时，它会**触发** 追踪它的组件 的重新渲染\n\n``` js\n// 伪代码\nconst myRef = {\n    _value: 0,\n    get value() {\n        track(); // 追踪渲染过程中使用的每一个 ref\n        return this._value;\n    },\n    set value(newValue) {\n        this._value = newValue;\n        trigger(); // 触发追踪它的组件的重新渲染\n    }\n}\n```\n\n### ``<script setup>``\n\n使用 ``<script setup>`` 简化代码\n\n``` html\n<script setup>\nimport { ref } from 'vue';\n\nconst count = ref(0);\n\nfunction increment() {\n    count.value++;\n}\n</script>\n\n<template>\n    <button @click=\"increment\">{{ count }}</button>\n</template>\n```\n\n## DOM 更新时机\n\nDOM 更新后，立即执行回调函数\n\n``` js\nimport { nextTick } from 'vue';\n\nasync function increment() {\n    count.value++;\n    await nextTick();\n    callback();\n}\n```\n\n或者\n\n``` js\nimport { nextTick } from 'vue';\n\nfunction increment() {\n    count.value++;\n    nextTick(() => callback());\n}\n```\n\n## reactive()\n\nreactive() 使对象本身具有响应性，当 ref 的值是一个对象时，会在内层调用 reactive\n\n### 原理\n\nreactive() 返回原始对象的 proxy，允许 Vue 拦截和定义基本操作的行为（如属性查找、赋值、删除等）\n\nreactive() 的返回值和原始对象不相等\n\n``` js\nconst raw = {};\nconst proxy = reactive(raw);\nconsole.log(raw === proxy); // false\n```\n\n### reactive() 的局限性\n\n（1）有限的值类型：只能用于对象类型（对象、数组、Map、Set），不能用于原始类型；\n\n（2）不能替换整个对象：替换整个对象会导致响应式连接丢失；\n\n（3）对解构操作不友好：解构后的变量会丢失响应式连接。\n\n## ref 解包\n\n### ref 作为 reactive 对象属性\n\nref 作为响应式对象的属性时，就像一个普通的属性\n\n``` js\nconst count = ref(0);\nconst state = reactive({ count });\nconsole.log(state.count); // 0\n\nstate.count = 1;\nconsole.log(state.count); // 1\n```\n\n### 在模板中解包\n\n在模板渲染上下文中，只有顶级的 ref 才会被解包\n\n第二个不符合预期是因为，obj.id 未被解包，仍是一个 ref 对象\n\n``` js\nconst count = ref(0);\nconst obj = {\n    id: ref(1)\n};\n```\n\n``` html\n<!-- 符合预期 —— 2 -->\n{{ count + 1 }}\n<!-- 不符合预期 —— [object Object]1 -->\n{{ obj.id + 1 }}\n```\n\n为了解决该问题，需要将 id 结构为顶级属性\n\n``` js\nconst { id } = obj;\n```\n\n``` html\n<!-- 符合预期 —— 2 -->\n{{ id + 1 }}\n```\n","source":"_posts/3-vue3响应式.md","raw":"---\ntitle: vue3 响应式\ndate: 2023-11-06 16:41:05\ntags:\n    - vue3\n    - vue\ncategories:\n    - vue3\n      - 文档\n---\n\n## ref()\n\nref() 返回一个包含属性 value 的对象\n\n``` js\nimport { ref } from 'vue';\n\nexport default {\n    setup() {\n        const count = ref(0);\n        function increment() {\n            count.value++;\n        }\n        return {\n            count,\n            increment\n        }\n    }\n}\n```\n\n``` html\n<button @click=\"increment\">{{ count }}</button>\n```\n\n### 原理\n\nref 的 .value 属性使得 Vue 可以检测其何时被访问或修改\n\n当一个组件首次渲染时，Vue 会**追踪**在渲染过程中使用的每一个 ref；当一个 ref 被修改时，它会**触发** 追踪它的组件 的重新渲染\n\n``` js\n// 伪代码\nconst myRef = {\n    _value: 0,\n    get value() {\n        track(); // 追踪渲染过程中使用的每一个 ref\n        return this._value;\n    },\n    set value(newValue) {\n        this._value = newValue;\n        trigger(); // 触发追踪它的组件的重新渲染\n    }\n}\n```\n\n### ``<script setup>``\n\n使用 ``<script setup>`` 简化代码\n\n``` html\n<script setup>\nimport { ref } from 'vue';\n\nconst count = ref(0);\n\nfunction increment() {\n    count.value++;\n}\n</script>\n\n<template>\n    <button @click=\"increment\">{{ count }}</button>\n</template>\n```\n\n## DOM 更新时机\n\nDOM 更新后，立即执行回调函数\n\n``` js\nimport { nextTick } from 'vue';\n\nasync function increment() {\n    count.value++;\n    await nextTick();\n    callback();\n}\n```\n\n或者\n\n``` js\nimport { nextTick } from 'vue';\n\nfunction increment() {\n    count.value++;\n    nextTick(() => callback());\n}\n```\n\n## reactive()\n\nreactive() 使对象本身具有响应性，当 ref 的值是一个对象时，会在内层调用 reactive\n\n### 原理\n\nreactive() 返回原始对象的 proxy，允许 Vue 拦截和定义基本操作的行为（如属性查找、赋值、删除等）\n\nreactive() 的返回值和原始对象不相等\n\n``` js\nconst raw = {};\nconst proxy = reactive(raw);\nconsole.log(raw === proxy); // false\n```\n\n### reactive() 的局限性\n\n（1）有限的值类型：只能用于对象类型（对象、数组、Map、Set），不能用于原始类型；\n\n（2）不能替换整个对象：替换整个对象会导致响应式连接丢失；\n\n（3）对解构操作不友好：解构后的变量会丢失响应式连接。\n\n## ref 解包\n\n### ref 作为 reactive 对象属性\n\nref 作为响应式对象的属性时，就像一个普通的属性\n\n``` js\nconst count = ref(0);\nconst state = reactive({ count });\nconsole.log(state.count); // 0\n\nstate.count = 1;\nconsole.log(state.count); // 1\n```\n\n### 在模板中解包\n\n在模板渲染上下文中，只有顶级的 ref 才会被解包\n\n第二个不符合预期是因为，obj.id 未被解包，仍是一个 ref 对象\n\n``` js\nconst count = ref(0);\nconst obj = {\n    id: ref(1)\n};\n```\n\n``` html\n<!-- 符合预期 —— 2 -->\n{{ count + 1 }}\n<!-- 不符合预期 —— [object Object]1 -->\n{{ obj.id + 1 }}\n```\n\n为了解决该问题，需要将 id 结构为顶级属性\n\n``` js\nconst { id } = obj;\n```\n\n``` html\n<!-- 符合预期 —— 2 -->\n{{ id + 1 }}\n```\n","slug":"3-vue3响应式","published":1,"updated":"2025-05-20T02:47:28.683Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu900216kpr3ub66hab","content":"<h2 id=\"ref\"><a href=\"#ref\" class=\"headerlink\" title=\"ref()\"></a>ref()</h2><p>ref() 返回一个包含属性 value 的对象</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> count = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">function</span> <span class=\"title function_\">increment</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            count.<span class=\"property\">value</span>++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">            count,</span><br><span class=\"line\">            increment</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;increment&quot;</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h3><p>ref 的 .value 属性使得 Vue 可以检测其何时被访问或修改</p>\n<p>当一个组件首次渲染时，Vue 会<strong>追踪</strong>在渲染过程中使用的每一个 ref；当一个 ref 被修改时，它会<strong>触发</strong> 追踪它的组件 的重新渲染</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 伪代码</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> myRef = &#123;</span><br><span class=\"line\">    <span class=\"attr\">_value</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    <span class=\"keyword\">get</span> <span class=\"title function_\">value</span>() &#123;</span><br><span class=\"line\">        <span class=\"title function_\">track</span>(); <span class=\"comment\">// 追踪渲染过程中使用的每一个 ref</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">_value</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"keyword\">set</span> <span class=\"title function_\">value</span>(<span class=\"params\">newValue</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">_value</span> = newValue;</span><br><span class=\"line\">        <span class=\"title function_\">trigger</span>(); <span class=\"comment\">// 触发追踪它的组件的重新渲染</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"&lt;script setup&gt;\"></a><code>&lt;script setup&gt;</code></h3><p>使用 <code>&lt;script setup&gt;</code> 简化代码</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> count = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">function</span> <span class=\"title function_\">increment</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    count.<span class=\"property\">value</span>++;</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;increment&quot;</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"DOM-更新时机\"><a href=\"#DOM-更新时机\" class=\"headerlink\" title=\"DOM 更新时机\"></a>DOM 更新时机</h2><p>DOM 更新后，立即执行回调函数</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; nextTick &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">increment</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    count.<span class=\"property\">value</span>++;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">nextTick</span>();</span><br><span class=\"line\">    <span class=\"title function_\">callback</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>或者</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; nextTick &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">increment</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    count.<span class=\"property\">value</span>++;</span><br><span class=\"line\">    <span class=\"title function_\">nextTick</span>(<span class=\"function\">() =&gt;</span> <span class=\"title function_\">callback</span>());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"reactive\"><a href=\"#reactive\" class=\"headerlink\" title=\"reactive()\"></a>reactive()</h2><p>reactive() 使对象本身具有响应性，当 ref 的值是一个对象时，会在内层调用 reactive</p>\n<h3 id=\"原理-1\"><a href=\"#原理-1\" class=\"headerlink\" title=\"原理\"></a>原理</h3><p>reactive() 返回原始对象的 proxy，允许 Vue 拦截和定义基本操作的行为（如属性查找、赋值、删除等）</p>\n<p>reactive() 的返回值和原始对象不相等</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> raw = &#123;&#125;;</span><br><span class=\"line\"><span class=\"keyword\">const</span> proxy = <span class=\"title function_\">reactive</span>(raw);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(raw === proxy); <span class=\"comment\">// false</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"reactive-的局限性\"><a href=\"#reactive-的局限性\" class=\"headerlink\" title=\"reactive() 的局限性\"></a>reactive() 的局限性</h3><p>（1）有限的值类型：只能用于对象类型（对象、数组、Map、Set），不能用于原始类型；</p>\n<p>（2）不能替换整个对象：替换整个对象会导致响应式连接丢失；</p>\n<p>（3）对解构操作不友好：解构后的变量会丢失响应式连接。</p>\n<h2 id=\"ref-解包\"><a href=\"#ref-解包\" class=\"headerlink\" title=\"ref 解包\"></a>ref 解包</h2><h3 id=\"ref-作为-reactive-对象属性\"><a href=\"#ref-作为-reactive-对象属性\" class=\"headerlink\" title=\"ref 作为 reactive 对象属性\"></a>ref 作为 reactive 对象属性</h3><p>ref 作为响应式对象的属性时，就像一个普通的属性</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> count = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> state = <span class=\"title function_\">reactive</span>(&#123; count &#125;);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(state.<span class=\"property\">count</span>); <span class=\"comment\">// 0</span></span><br><span class=\"line\"></span><br><span class=\"line\">state.<span class=\"property\">count</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(state.<span class=\"property\">count</span>); <span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"在模板中解包\"><a href=\"#在模板中解包\" class=\"headerlink\" title=\"在模板中解包\"></a>在模板中解包</h3><p>在模板渲染上下文中，只有顶级的 ref 才会被解包</p>\n<p>第二个不符合预期是因为，obj.id 未被解包，仍是一个 ref 对象</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> count = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> obj = &#123;</span><br><span class=\"line\">    <span class=\"attr\">id</span>: <span class=\"title function_\">ref</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 符合预期 —— 2 --&gt;</span></span><br><span class=\"line\">&#123;&#123; count + 1 &#125;&#125;</span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 不符合预期 —— [object Object]1 --&gt;</span></span><br><span class=\"line\">&#123;&#123; obj.id + 1 &#125;&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>为了解决该问题，需要将 id 结构为顶级属性</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; id &#125; = obj;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 符合预期 —— 2 --&gt;</span></span><br><span class=\"line\">&#123;&#123; id + 1 &#125;&#125;</span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"ref\"><a href=\"#ref\" class=\"headerlink\" title=\"ref()\"></a>ref()</h2><p>ref() 返回一个包含属性 value 的对象</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">setup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> count = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">function</span> <span class=\"title function_\">increment</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            count.<span class=\"property\">value</span>++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">            count,</span><br><span class=\"line\">            increment</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;increment&quot;</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h3><p>ref 的 .value 属性使得 Vue 可以检测其何时被访问或修改</p>\n<p>当一个组件首次渲染时，Vue 会<strong>追踪</strong>在渲染过程中使用的每一个 ref；当一个 ref 被修改时，它会<strong>触发</strong> 追踪它的组件 的重新渲染</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 伪代码</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> myRef = &#123;</span><br><span class=\"line\">    <span class=\"attr\">_value</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    <span class=\"keyword\">get</span> <span class=\"title function_\">value</span>() &#123;</span><br><span class=\"line\">        <span class=\"title function_\">track</span>(); <span class=\"comment\">// 追踪渲染过程中使用的每一个 ref</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">_value</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"keyword\">set</span> <span class=\"title function_\">value</span>(<span class=\"params\">newValue</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">_value</span> = newValue;</span><br><span class=\"line\">        <span class=\"title function_\">trigger</span>(); <span class=\"comment\">// 触发追踪它的组件的重新渲染</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"&lt;script setup&gt;\"></a><code>&lt;script setup&gt;</code></h3><p>使用 <code>&lt;script setup&gt;</code> 简化代码</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> count = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">function</span> <span class=\"title function_\">increment</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    count.<span class=\"property\">value</span>++;</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;increment&quot;</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"DOM-更新时机\"><a href=\"#DOM-更新时机\" class=\"headerlink\" title=\"DOM 更新时机\"></a>DOM 更新时机</h2><p>DOM 更新后，立即执行回调函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; nextTick &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">increment</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    count.<span class=\"property\">value</span>++;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">nextTick</span>();</span><br><span class=\"line\">    <span class=\"title function_\">callback</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>或者</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; nextTick &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">increment</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    count.<span class=\"property\">value</span>++;</span><br><span class=\"line\">    <span class=\"title function_\">nextTick</span>(<span class=\"function\">() =&gt;</span> <span class=\"title function_\">callback</span>());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"reactive\"><a href=\"#reactive\" class=\"headerlink\" title=\"reactive()\"></a>reactive()</h2><p>reactive() 使对象本身具有响应性，当 ref 的值是一个对象时，会在内层调用 reactive</p>\n<h3 id=\"原理-1\"><a href=\"#原理-1\" class=\"headerlink\" title=\"原理\"></a>原理</h3><p>reactive() 返回原始对象的 proxy，允许 Vue 拦截和定义基本操作的行为（如属性查找、赋值、删除等）</p>\n<p>reactive() 的返回值和原始对象不相等</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> raw = &#123;&#125;;</span><br><span class=\"line\"><span class=\"keyword\">const</span> proxy = <span class=\"title function_\">reactive</span>(raw);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(raw === proxy); <span class=\"comment\">// false</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"reactive-的局限性\"><a href=\"#reactive-的局限性\" class=\"headerlink\" title=\"reactive() 的局限性\"></a>reactive() 的局限性</h3><p>（1）有限的值类型：只能用于对象类型（对象、数组、Map、Set），不能用于原始类型；</p>\n<p>（2）不能替换整个对象：替换整个对象会导致响应式连接丢失；</p>\n<p>（3）对解构操作不友好：解构后的变量会丢失响应式连接。</p>\n<h2 id=\"ref-解包\"><a href=\"#ref-解包\" class=\"headerlink\" title=\"ref 解包\"></a>ref 解包</h2><h3 id=\"ref-作为-reactive-对象属性\"><a href=\"#ref-作为-reactive-对象属性\" class=\"headerlink\" title=\"ref 作为 reactive 对象属性\"></a>ref 作为 reactive 对象属性</h3><p>ref 作为响应式对象的属性时，就像一个普通的属性</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> count = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> state = <span class=\"title function_\">reactive</span>(&#123; count &#125;);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(state.<span class=\"property\">count</span>); <span class=\"comment\">// 0</span></span><br><span class=\"line\"></span><br><span class=\"line\">state.<span class=\"property\">count</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(state.<span class=\"property\">count</span>); <span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在模板中解包\"><a href=\"#在模板中解包\" class=\"headerlink\" title=\"在模板中解包\"></a>在模板中解包</h3><p>在模板渲染上下文中，只有顶级的 ref 才会被解包</p>\n<p>第二个不符合预期是因为，obj.id 未被解包，仍是一个 ref 对象</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> count = <span class=\"title function_\">ref</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> obj = &#123;</span><br><span class=\"line\">    <span class=\"attr\">id</span>: <span class=\"title function_\">ref</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 符合预期 —— 2 --&gt;</span></span><br><span class=\"line\">&#123;&#123; count + 1 &#125;&#125;</span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 不符合预期 —— [object Object]1 --&gt;</span></span><br><span class=\"line\">&#123;&#123; obj.id + 1 &#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>为了解决该问题，需要将 id 结构为顶级属性</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; id &#125; = obj;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 符合预期 —— 2 --&gt;</span></span><br><span class=\"line\">&#123;&#123; id + 1 &#125;&#125;</span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用1-简介","date":"2025-01-02T05:16:35.000Z","_content":"\n本课程主要讲：比特币和以太坊 两种加密货币\n\n视频链接：\n\nhttps://www.bilibili.com/video/BV1Vt411X7JF/?spm_id_from=333.337.search-card.all.click&vd_source=69ac93649ea21c4726fe85f272b6d968\n","source":"_posts/30-北大区块链-简介.md","raw":"---\ntitle: 北大-区块链技术与应用1-简介\ndate: 2025-01-02 13:16:35\ntags:\n    - web3\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n本课程主要讲：比特币和以太坊 两种加密货币\n\n视频链接：\n\nhttps://www.bilibili.com/video/BV1Vt411X7JF/?spm_id_from=333.337.search-card.all.click&vd_source=69ac93649ea21c4726fe85f272b6d968\n","slug":"30-北大区块链-简介","published":1,"updated":"2025-05-20T02:47:28.684Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvu900236kpr72y884l4","content":"<p>本课程主要讲：比特币和以太坊 两种加密货币</p>\n<p>视频链接：</p>\n<p><a class=\"link\"   href=\"https://www.bilibili.com/video/BV1Vt411X7JF/?spm_id_from=333.337.search-card.all.click&vd_source=69ac93649ea21c4726fe85f272b6d968\" >https://www.bilibili.com/video/BV1Vt411X7JF/?spm_id_from=333.337.search-card.all.click&amp;vd_source=69ac93649ea21c4726fe85f272b6d968<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>本课程主要讲：比特币和以太坊 两种加密货币</p>\n<p>视频链接：</p>\n<p><a class=\"link\"   href=\"https://www.bilibili.com/video/BV1Vt411X7JF/?spm_id_from=333.337.search-card.all.click&vd_source=69ac93649ea21c4726fe85f272b6d968\" >https://www.bilibili.com/video/BV1Vt411X7JF/?spm_id_from=333.337.search-card.all.click&amp;vd_source=69ac93649ea21c4726fe85f272b6d968<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用2-密码学基础","date":"2025-01-02T05:24:53.000Z","_content":"\nCrypto-currency（加密货币）\n\n区块链和比特币主要用到：哈希函数 和 数字签名\n\n## 一、Cryptographic Hash Function（哈希函数）\n\n区块链用到了哈希函数的 抗碰撞性 和 隐私性；比特币除了这两个性质，还要求 谜题友好性\n\n### （1）Collision resistance（抗碰撞）\n\n x≠y, H(x)≠H(y)\n 给定一个x，没有高效的方法找到一个y，满足H(x)=H(y)，可以用 brute-force（蛮力破解）\n\n Message digest（信息摘要）：给定一个消息m，用H(m)检测对消息的篡改\n 对m'≠m，H(m')≠H(m)\n\n MD5已经可以被人为地制造碰撞\n\n### （2）Hiding（隐私性）/ Not invertable（单向不可逆）\n\n x --> H(x)，没有高效的方法从H(x)得到x，除了 brute-force\n\n### （3）Puzzle friendly（谜题友好）\n\n 不知道如何选定x，使H(x)落在某个区间内，Exp. 00…0XXX…X（以k个0开始）\n\n 挖矿过程：找一个nonce，和区块块头中的其他信息和在一起作为输入，哈希过后的值要小于等于目标域值，即H(block header) ≤target\n 其谜题友好意味着，挖矿的过程不存在捷径，只能靠 brute-force，所以该过程才能作为 power of work（pow，工作量证明）\n 设置 mining puzzle 的原则：Difficult to solve, but easy to verify\n\n#### Example 1\n\n比特币中用到的哈希函数是 SHA-256（Secure Hash Algorithm），满足以上三个性质\n\n#### Example 2\n\nDigital commitment（数字承诺），又名 Digital Equivalent of a Sealed Envelope（密封信封的数字等价物），允许一方将某个值（秘密或消息）“承诺”给另一方（验证者）\n\n结合了哈希函数的抗碰撞和隐私性\nHiding：公开m=H(x)，给定x'，如果H(x')=m，即可保证x'=x\n\n扩大输入空间的方法：选取nonce（number once）随机数，H(x||nonce)\n\n## 二、Digital Signature（数字签名）\n\n不同于银行的开户流程，比特币是去中心化的，只要在本地创建一个公私钥对（public key，private key），就代表一个比特币账户，来源于非对称加密体系（asymmetric encryption algorithm）\n\n在比特币系统中，公私钥用于签名：发布者用自己的私钥对交易进行签名，接受者通过发布者的公钥验签\n\n生成公私钥、以及签名 都需要 a good source of randomess\n\n## 总结\n\n在比特币系统中，通常对一个message取哈希，然后再对该哈希值进行签名\n","source":"_posts/31-北大区块链-密码学基础.md","raw":"---\ntitle: 北大-区块链技术与应用2-密码学基础\ndate: 2025-01-02 13:24:53\ntags:\n    - web3\n    - 密码学\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\nCrypto-currency（加密货币）\n\n区块链和比特币主要用到：哈希函数 和 数字签名\n\n## 一、Cryptographic Hash Function（哈希函数）\n\n区块链用到了哈希函数的 抗碰撞性 和 隐私性；比特币除了这两个性质，还要求 谜题友好性\n\n### （1）Collision resistance（抗碰撞）\n\n x≠y, H(x)≠H(y)\n 给定一个x，没有高效的方法找到一个y，满足H(x)=H(y)，可以用 brute-force（蛮力破解）\n\n Message digest（信息摘要）：给定一个消息m，用H(m)检测对消息的篡改\n 对m'≠m，H(m')≠H(m)\n\n MD5已经可以被人为地制造碰撞\n\n### （2）Hiding（隐私性）/ Not invertable（单向不可逆）\n\n x --> H(x)，没有高效的方法从H(x)得到x，除了 brute-force\n\n### （3）Puzzle friendly（谜题友好）\n\n 不知道如何选定x，使H(x)落在某个区间内，Exp. 00…0XXX…X（以k个0开始）\n\n 挖矿过程：找一个nonce，和区块块头中的其他信息和在一起作为输入，哈希过后的值要小于等于目标域值，即H(block header) ≤target\n 其谜题友好意味着，挖矿的过程不存在捷径，只能靠 brute-force，所以该过程才能作为 power of work（pow，工作量证明）\n 设置 mining puzzle 的原则：Difficult to solve, but easy to verify\n\n#### Example 1\n\n比特币中用到的哈希函数是 SHA-256（Secure Hash Algorithm），满足以上三个性质\n\n#### Example 2\n\nDigital commitment（数字承诺），又名 Digital Equivalent of a Sealed Envelope（密封信封的数字等价物），允许一方将某个值（秘密或消息）“承诺”给另一方（验证者）\n\n结合了哈希函数的抗碰撞和隐私性\nHiding：公开m=H(x)，给定x'，如果H(x')=m，即可保证x'=x\n\n扩大输入空间的方法：选取nonce（number once）随机数，H(x||nonce)\n\n## 二、Digital Signature（数字签名）\n\n不同于银行的开户流程，比特币是去中心化的，只要在本地创建一个公私钥对（public key，private key），就代表一个比特币账户，来源于非对称加密体系（asymmetric encryption algorithm）\n\n在比特币系统中，公私钥用于签名：发布者用自己的私钥对交易进行签名，接受者通过发布者的公钥验签\n\n生成公私钥、以及签名 都需要 a good source of randomess\n\n## 总结\n\n在比特币系统中，通常对一个message取哈希，然后再对该哈希值进行签名\n","slug":"31-北大区块链-密码学基础","published":1,"updated":"2025-05-20T02:47:28.684Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvua00286kpr8mm3194h","content":"<p>Crypto-currency（加密货币）</p>\n<p>区块链和比特币主要用到：哈希函数 和 数字签名</p>\n<h2 id=\"一、Cryptographic-Hash-Function（哈希函数）\"><a href=\"#一、Cryptographic-Hash-Function（哈希函数）\" class=\"headerlink\" title=\"一、Cryptographic Hash Function（哈希函数）\"></a>一、Cryptographic Hash Function（哈希函数）</h2><p>区块链用到了哈希函数的 抗碰撞性 和 隐私性；比特币除了这两个性质，还要求 谜题友好性</p>\n<h3 id=\"（1）Collision-resistance（抗碰撞）\"><a href=\"#（1）Collision-resistance（抗碰撞）\" class=\"headerlink\" title=\"（1）Collision resistance（抗碰撞）\"></a>（1）Collision resistance（抗碰撞）</h3><p> x≠y, H(x)≠H(y)<br> 给定一个x，没有高效的方法找到一个y，满足H(x)&#x3D;H(y)，可以用 brute-force（蛮力破解）</p>\n<p> Message digest（信息摘要）：给定一个消息m，用H(m)检测对消息的篡改<br> 对m’≠m，H(m’)≠H(m)</p>\n<p> MD5已经可以被人为地制造碰撞</p>\n<h3 id=\"（2）Hiding（隐私性）-Not-invertable（单向不可逆）\"><a href=\"#（2）Hiding（隐私性）-Not-invertable（单向不可逆）\" class=\"headerlink\" title=\"（2）Hiding（隐私性）&#x2F; Not invertable（单向不可逆）\"></a>（2）Hiding（隐私性）&#x2F; Not invertable（单向不可逆）</h3><p> x –&gt; H(x)，没有高效的方法从H(x)得到x，除了 brute-force</p>\n<h3 id=\"（3）Puzzle-friendly（谜题友好）\"><a href=\"#（3）Puzzle-friendly（谜题友好）\" class=\"headerlink\" title=\"（3）Puzzle friendly（谜题友好）\"></a>（3）Puzzle friendly（谜题友好）</h3><p> 不知道如何选定x，使H(x)落在某个区间内，Exp. 00…0XXX…X（以k个0开始）</p>\n<p> 挖矿过程：找一个nonce，和区块块头中的其他信息和在一起作为输入，哈希过后的值要小于等于目标域值，即H(block header) ≤target<br> 其谜题友好意味着，挖矿的过程不存在捷径，只能靠 brute-force，所以该过程才能作为 power of work（pow，工作量证明）<br> 设置 mining puzzle 的原则：Difficult to solve, but easy to verify</p>\n<h4 id=\"Example-1\"><a href=\"#Example-1\" class=\"headerlink\" title=\"Example 1\"></a>Example 1</h4><p>比特币中用到的哈希函数是 SHA-256（Secure Hash Algorithm），满足以上三个性质</p>\n<h4 id=\"Example-2\"><a href=\"#Example-2\" class=\"headerlink\" title=\"Example 2\"></a>Example 2</h4><p>Digital commitment（数字承诺），又名 Digital Equivalent of a Sealed Envelope（密封信封的数字等价物），允许一方将某个值（秘密或消息）“承诺”给另一方（验证者）</p>\n<p>结合了哈希函数的抗碰撞和隐私性<br>Hiding：公开m&#x3D;H(x)，给定x’，如果H(x’)&#x3D;m，即可保证x’&#x3D;x</p>\n<p>扩大输入空间的方法：选取nonce（number once）随机数，H(x||nonce)</p>\n<h2 id=\"二、Digital-Signature（数字签名）\"><a href=\"#二、Digital-Signature（数字签名）\" class=\"headerlink\" title=\"二、Digital Signature（数字签名）\"></a>二、Digital Signature（数字签名）</h2><p>不同于银行的开户流程，比特币是去中心化的，只要在本地创建一个公私钥对（public key，private key），就代表一个比特币账户，来源于非对称加密体系（asymmetric encryption algorithm）</p>\n<p>在比特币系统中，公私钥用于签名：发布者用自己的私钥对交易进行签名，接受者通过发布者的公钥验签</p>\n<p>生成公私钥、以及签名 都需要 a good source of randomess</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>在比特币系统中，通常对一个message取哈希，然后再对该哈希值进行签名</p>\n","site":{"data":{}},"excerpt":"","more":"<p>Crypto-currency（加密货币）</p>\n<p>区块链和比特币主要用到：哈希函数 和 数字签名</p>\n<h2 id=\"一、Cryptographic-Hash-Function（哈希函数）\"><a href=\"#一、Cryptographic-Hash-Function（哈希函数）\" class=\"headerlink\" title=\"一、Cryptographic Hash Function（哈希函数）\"></a>一、Cryptographic Hash Function（哈希函数）</h2><p>区块链用到了哈希函数的 抗碰撞性 和 隐私性；比特币除了这两个性质，还要求 谜题友好性</p>\n<h3 id=\"（1）Collision-resistance（抗碰撞）\"><a href=\"#（1）Collision-resistance（抗碰撞）\" class=\"headerlink\" title=\"（1）Collision resistance（抗碰撞）\"></a>（1）Collision resistance（抗碰撞）</h3><p> x≠y, H(x)≠H(y)<br> 给定一个x，没有高效的方法找到一个y，满足H(x)&#x3D;H(y)，可以用 brute-force（蛮力破解）</p>\n<p> Message digest（信息摘要）：给定一个消息m，用H(m)检测对消息的篡改<br> 对m’≠m，H(m’)≠H(m)</p>\n<p> MD5已经可以被人为地制造碰撞</p>\n<h3 id=\"（2）Hiding（隐私性）-Not-invertable（单向不可逆）\"><a href=\"#（2）Hiding（隐私性）-Not-invertable（单向不可逆）\" class=\"headerlink\" title=\"（2）Hiding（隐私性）&#x2F; Not invertable（单向不可逆）\"></a>（2）Hiding（隐私性）&#x2F; Not invertable（单向不可逆）</h3><p> x –&gt; H(x)，没有高效的方法从H(x)得到x，除了 brute-force</p>\n<h3 id=\"（3）Puzzle-friendly（谜题友好）\"><a href=\"#（3）Puzzle-friendly（谜题友好）\" class=\"headerlink\" title=\"（3）Puzzle friendly（谜题友好）\"></a>（3）Puzzle friendly（谜题友好）</h3><p> 不知道如何选定x，使H(x)落在某个区间内，Exp. 00…0XXX…X（以k个0开始）</p>\n<p> 挖矿过程：找一个nonce，和区块块头中的其他信息和在一起作为输入，哈希过后的值要小于等于目标域值，即H(block header) ≤target<br> 其谜题友好意味着，挖矿的过程不存在捷径，只能靠 brute-force，所以该过程才能作为 power of work（pow，工作量证明）<br> 设置 mining puzzle 的原则：Difficult to solve, but easy to verify</p>\n<h4 id=\"Example-1\"><a href=\"#Example-1\" class=\"headerlink\" title=\"Example 1\"></a>Example 1</h4><p>比特币中用到的哈希函数是 SHA-256（Secure Hash Algorithm），满足以上三个性质</p>\n<h4 id=\"Example-2\"><a href=\"#Example-2\" class=\"headerlink\" title=\"Example 2\"></a>Example 2</h4><p>Digital commitment（数字承诺），又名 Digital Equivalent of a Sealed Envelope（密封信封的数字等价物），允许一方将某个值（秘密或消息）“承诺”给另一方（验证者）</p>\n<p>结合了哈希函数的抗碰撞和隐私性<br>Hiding：公开m&#x3D;H(x)，给定x’，如果H(x’)&#x3D;m，即可保证x’&#x3D;x</p>\n<p>扩大输入空间的方法：选取nonce（number once）随机数，H(x||nonce)</p>\n<h2 id=\"二、Digital-Signature（数字签名）\"><a href=\"#二、Digital-Signature（数字签名）\" class=\"headerlink\" title=\"二、Digital Signature（数字签名）\"></a>二、Digital Signature（数字签名）</h2><p>不同于银行的开户流程，比特币是去中心化的，只要在本地创建一个公私钥对（public key，private key），就代表一个比特币账户，来源于非对称加密体系（asymmetric encryption algorithm）</p>\n<p>在比特币系统中，公私钥用于签名：发布者用自己的私钥对交易进行签名，接受者通过发布者的公钥验签</p>\n<p>生成公私钥、以及签名 都需要 a good source of randomess</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>在比特币系统中，通常对一个message取哈希，然后再对该哈希值进行签名</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用3-数据结构","date":"2025-01-02T05:57:32.000Z","_content":"\n## 一、Hash Pointers（哈希指针）\n\n哈希指针除了地址之外，还要保存地址的哈希值，用于检测结构体的内容是否被篡改\n\nBlock chain is a linked list using hash pointers.\n\n![图1](../images/32/1.png)\n\n区块链中的第一个区块叫 genesis block（创世区块），其 height（高度）为 0；最后一个区块叫 most recent block\n\n后一个区块中的哈希指针是对前一区块的整体取哈希（包含前一区块中储存的哈希指针），可以实现 tamper-evident log（篡改证明记录）\n\n修改一个区块，会导致其后所有区块的哈希发生改变。所以只需保存和比对最后一个哈希值，就能检测出对区块链中任何部位的修改\n\n## 二、Merkle Tree（默克尔树）\n\nMerkle tree 和 Binary tree 对比，就是把普通指针换成哈希指针\n\n![图2](../images/32/2.png)\n\n只要记录并比对 root hash（根哈希值），就能检测出整个树中任何部位的修改\n\n### 区块结构\n\n每个区块包含 block header（块头） 和 block body（块身）\n\n1、块头：包含 该区块的所有交易组成的 Merkle tree 的根哈希值，但没有具体的交易内容\n2、块体：包含具体的交易列表\n\n### 比特币节点\n\n比特币中的节点分为：\n\n- full node, or fully validationg node（全节点）\n- light node, or light-weight node（轻节点）\n\n1、全节点：保存整个区块的内容，包括块头和块体（包含 tansaction list，即交易的具体信息）；会验证每一笔交易\n\n2、轻节点：比如手机上的比特币钱包的APP，只保存块头；无法独立验证交易的合法性\n\n![图3](../images/32/3.png)\n\nMerkle proof 指从交易发生到根哈希值的路径，可以向轻节点证明某笔交易写入了区块链，流程如下：\n\n（1）轻节点向全节点请求图3中红色的哈希值\n\n（2）然后根据交易和红色的哈希值，自底向上算出绿色的哈希值，直至算出根哈希值\n\n（3）最后将算出的根哈希值，与轻节点块头中的哈希指针比较，一致则证明该交易发生在此区块\n\n上述方法也叫做 proof of membership 或 proof of inclusion\n假设最底层的交易数为n，验证交易存在的时间复杂度为：θ(log(n))\n\n对于无序的 Merkle tree，proof of non-membership（验证交易不存在）的时间复杂度为线性 θ(n)，即一个一个试\n对于 Sorted Merkle tree（对交易取哈希，并且按哈希值大小排序），上述验证的时间复杂度为 θ(log(n))，与二分法一致：只需要对其大小相邻的两个交易进行哈希值的校验，如果和根哈希一致，则证明该交易不存在\n\n由于区块链中不需要做不存在证明，所以比特币中的 Merkle tree 不要求排序\n\n除了区块链 和 Merkle tree，哈希指针还可以用在其他无环的链表中\n","source":"_posts/32-北大区块链-数据结构.md","raw":"---\ntitle: 北大-区块链技术与应用3-数据结构\ndate: 2025-01-02 13:57:32\ntags:\n    - web3\n    - 数据结构\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n## 一、Hash Pointers（哈希指针）\n\n哈希指针除了地址之外，还要保存地址的哈希值，用于检测结构体的内容是否被篡改\n\nBlock chain is a linked list using hash pointers.\n\n![图1](../images/32/1.png)\n\n区块链中的第一个区块叫 genesis block（创世区块），其 height（高度）为 0；最后一个区块叫 most recent block\n\n后一个区块中的哈希指针是对前一区块的整体取哈希（包含前一区块中储存的哈希指针），可以实现 tamper-evident log（篡改证明记录）\n\n修改一个区块，会导致其后所有区块的哈希发生改变。所以只需保存和比对最后一个哈希值，就能检测出对区块链中任何部位的修改\n\n## 二、Merkle Tree（默克尔树）\n\nMerkle tree 和 Binary tree 对比，就是把普通指针换成哈希指针\n\n![图2](../images/32/2.png)\n\n只要记录并比对 root hash（根哈希值），就能检测出整个树中任何部位的修改\n\n### 区块结构\n\n每个区块包含 block header（块头） 和 block body（块身）\n\n1、块头：包含 该区块的所有交易组成的 Merkle tree 的根哈希值，但没有具体的交易内容\n2、块体：包含具体的交易列表\n\n### 比特币节点\n\n比特币中的节点分为：\n\n- full node, or fully validationg node（全节点）\n- light node, or light-weight node（轻节点）\n\n1、全节点：保存整个区块的内容，包括块头和块体（包含 tansaction list，即交易的具体信息）；会验证每一笔交易\n\n2、轻节点：比如手机上的比特币钱包的APP，只保存块头；无法独立验证交易的合法性\n\n![图3](../images/32/3.png)\n\nMerkle proof 指从交易发生到根哈希值的路径，可以向轻节点证明某笔交易写入了区块链，流程如下：\n\n（1）轻节点向全节点请求图3中红色的哈希值\n\n（2）然后根据交易和红色的哈希值，自底向上算出绿色的哈希值，直至算出根哈希值\n\n（3）最后将算出的根哈希值，与轻节点块头中的哈希指针比较，一致则证明该交易发生在此区块\n\n上述方法也叫做 proof of membership 或 proof of inclusion\n假设最底层的交易数为n，验证交易存在的时间复杂度为：θ(log(n))\n\n对于无序的 Merkle tree，proof of non-membership（验证交易不存在）的时间复杂度为线性 θ(n)，即一个一个试\n对于 Sorted Merkle tree（对交易取哈希，并且按哈希值大小排序），上述验证的时间复杂度为 θ(log(n))，与二分法一致：只需要对其大小相邻的两个交易进行哈希值的校验，如果和根哈希一致，则证明该交易不存在\n\n由于区块链中不需要做不存在证明，所以比特币中的 Merkle tree 不要求排序\n\n除了区块链 和 Merkle tree，哈希指针还可以用在其他无环的链表中\n","slug":"32-北大区块链-数据结构","published":1,"updated":"2025-05-20T02:47:28.684Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvua002a6kpr44li94c2","content":"<h2 id=\"一、Hash-Pointers（哈希指针）\"><a href=\"#一、Hash-Pointers（哈希指针）\" class=\"headerlink\" title=\"一、Hash Pointers（哈希指针）\"></a>一、Hash Pointers（哈希指针）</h2><p>哈希指针除了地址之外，还要保存地址的哈希值，用于检测结构体的内容是否被篡改</p>\n<p>Block chain is a linked list using hash pointers.</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/32/1.png\"\n                      alt=\"图1\"\n                ></p>\n<p>区块链中的第一个区块叫 genesis block（创世区块），其 height（高度）为 0；最后一个区块叫 most recent block</p>\n<p>后一个区块中的哈希指针是对前一区块的整体取哈希（包含前一区块中储存的哈希指针），可以实现 tamper-evident log（篡改证明记录）</p>\n<p>修改一个区块，会导致其后所有区块的哈希发生改变。所以只需保存和比对最后一个哈希值，就能检测出对区块链中任何部位的修改</p>\n<h2 id=\"二、Merkle-Tree（默克尔树）\"><a href=\"#二、Merkle-Tree（默克尔树）\" class=\"headerlink\" title=\"二、Merkle Tree（默克尔树）\"></a>二、Merkle Tree（默克尔树）</h2><p>Merkle tree 和 Binary tree 对比，就是把普通指针换成哈希指针</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/32/2.png\"\n                      alt=\"图2\"\n                ></p>\n<p>只要记录并比对 root hash（根哈希值），就能检测出整个树中任何部位的修改</p>\n<h3 id=\"区块结构\"><a href=\"#区块结构\" class=\"headerlink\" title=\"区块结构\"></a>区块结构</h3><p>每个区块包含 block header（块头） 和 block body（块身）</p>\n<p>1、块头：包含 该区块的所有交易组成的 Merkle tree 的根哈希值，但没有具体的交易内容<br>2、块体：包含具体的交易列表</p>\n<h3 id=\"比特币节点\"><a href=\"#比特币节点\" class=\"headerlink\" title=\"比特币节点\"></a>比特币节点</h3><p>比特币中的节点分为：</p>\n<ul>\n<li>full node, or fully validationg node（全节点）</li>\n<li>light node, or light-weight node（轻节点）</li>\n</ul>\n<p>1、全节点：保存整个区块的内容，包括块头和块体（包含 tansaction list，即交易的具体信息）；会验证每一笔交易</p>\n<p>2、轻节点：比如手机上的比特币钱包的APP，只保存块头；无法独立验证交易的合法性</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/32/3.png\"\n                      alt=\"图3\"\n                ></p>\n<p>Merkle proof 指从交易发生到根哈希值的路径，可以向轻节点证明某笔交易写入了区块链，流程如下：</p>\n<p>（1）轻节点向全节点请求图3中红色的哈希值</p>\n<p>（2）然后根据交易和红色的哈希值，自底向上算出绿色的哈希值，直至算出根哈希值</p>\n<p>（3）最后将算出的根哈希值，与轻节点块头中的哈希指针比较，一致则证明该交易发生在此区块</p>\n<p>上述方法也叫做 proof of membership 或 proof of inclusion<br>假设最底层的交易数为n，验证交易存在的时间复杂度为：θ(log(n))</p>\n<p>对于无序的 Merkle tree，proof of non-membership（验证交易不存在）的时间复杂度为线性 θ(n)，即一个一个试<br>对于 Sorted Merkle tree（对交易取哈希，并且按哈希值大小排序），上述验证的时间复杂度为 θ(log(n))，与二分法一致：只需要对其大小相邻的两个交易进行哈希值的校验，如果和根哈希一致，则证明该交易不存在</p>\n<p>由于区块链中不需要做不存在证明，所以比特币中的 Merkle tree 不要求排序</p>\n<p>除了区块链 和 Merkle tree，哈希指针还可以用在其他无环的链表中</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、Hash-Pointers（哈希指针）\"><a href=\"#一、Hash-Pointers（哈希指针）\" class=\"headerlink\" title=\"一、Hash Pointers（哈希指针）\"></a>一、Hash Pointers（哈希指针）</h2><p>哈希指针除了地址之外，还要保存地址的哈希值，用于检测结构体的内容是否被篡改</p>\n<p>Block chain is a linked list using hash pointers.</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/32/1.png\"\n                      alt=\"图1\"\n                ></p>\n<p>区块链中的第一个区块叫 genesis block（创世区块），其 height（高度）为 0；最后一个区块叫 most recent block</p>\n<p>后一个区块中的哈希指针是对前一区块的整体取哈希（包含前一区块中储存的哈希指针），可以实现 tamper-evident log（篡改证明记录）</p>\n<p>修改一个区块，会导致其后所有区块的哈希发生改变。所以只需保存和比对最后一个哈希值，就能检测出对区块链中任何部位的修改</p>\n<h2 id=\"二、Merkle-Tree（默克尔树）\"><a href=\"#二、Merkle-Tree（默克尔树）\" class=\"headerlink\" title=\"二、Merkle Tree（默克尔树）\"></a>二、Merkle Tree（默克尔树）</h2><p>Merkle tree 和 Binary tree 对比，就是把普通指针换成哈希指针</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/32/2.png\"\n                      alt=\"图2\"\n                ></p>\n<p>只要记录并比对 root hash（根哈希值），就能检测出整个树中任何部位的修改</p>\n<h3 id=\"区块结构\"><a href=\"#区块结构\" class=\"headerlink\" title=\"区块结构\"></a>区块结构</h3><p>每个区块包含 block header（块头） 和 block body（块身）</p>\n<p>1、块头：包含 该区块的所有交易组成的 Merkle tree 的根哈希值，但没有具体的交易内容<br>2、块体：包含具体的交易列表</p>\n<h3 id=\"比特币节点\"><a href=\"#比特币节点\" class=\"headerlink\" title=\"比特币节点\"></a>比特币节点</h3><p>比特币中的节点分为：</p>\n<ul>\n<li>full node, or fully validationg node（全节点）</li>\n<li>light node, or light-weight node（轻节点）</li>\n</ul>\n<p>1、全节点：保存整个区块的内容，包括块头和块体（包含 tansaction list，即交易的具体信息）；会验证每一笔交易</p>\n<p>2、轻节点：比如手机上的比特币钱包的APP，只保存块头；无法独立验证交易的合法性</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/32/3.png\"\n                      alt=\"图3\"\n                ></p>\n<p>Merkle proof 指从交易发生到根哈希值的路径，可以向轻节点证明某笔交易写入了区块链，流程如下：</p>\n<p>（1）轻节点向全节点请求图3中红色的哈希值</p>\n<p>（2）然后根据交易和红色的哈希值，自底向上算出绿色的哈希值，直至算出根哈希值</p>\n<p>（3）最后将算出的根哈希值，与轻节点块头中的哈希指针比较，一致则证明该交易发生在此区块</p>\n<p>上述方法也叫做 proof of membership 或 proof of inclusion<br>假设最底层的交易数为n，验证交易存在的时间复杂度为：θ(log(n))</p>\n<p>对于无序的 Merkle tree，proof of non-membership（验证交易不存在）的时间复杂度为线性 θ(n)，即一个一个试<br>对于 Sorted Merkle tree（对交易取哈希，并且按哈希值大小排序），上述验证的时间复杂度为 θ(log(n))，与二分法一致：只需要对其大小相邻的两个交易进行哈希值的校验，如果和根哈希一致，则证明该交易不存在</p>\n<p>由于区块链中不需要做不存在证明，所以比特币中的 Merkle tree 不要求排序</p>\n<p>除了区块链 和 Merkle tree，哈希指针还可以用在其他无环的链表中</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用4-共识协议","date":"2025-01-02T13:59:43.000Z","_content":"\n## 一、Double spending attack（双花攻击）\n\n双花攻击指同一笔资金被重复支付的情况，也是数字货币面临的主要挑战\n\n中心化解决方案：数字货币上添加唯一编号，并由央行维护一个数据结构，展示每个编号的货币由谁持有；如果付费方的货币在表中对应的持有人与此人不符，则证明该货币已支付给其他人\n\n去中心化的解决方案：比特币\n\n关注：货币的发行（挖矿）、交易的有效性验证（防范双花攻击）\n\n## 二、交易的有效性验证\n\n通过一个由所有用户共同维护的数据结构——区块链 来实现\n\n## 三、区块链简易结构\n\nNote：以下为简易版的区块链，每个区块都只有一个交易，实际上每个区块的交易记录都构成一个 Merkle tree\n\n![图1](../images/33/1.png)\n\n存在两种哈希指针：将区块串联成链表的指针，和指向前面某个交易的指针（为了说明币的来源，避免凭空捏造和重复交易）\n\n1、用户A 具有发行货币的权利（铸币权，mint 铸币），并发行了10个比特币（coin base transaction，铸币交易）\n\n2、用户A 分别给 用户B、用户C 5个比特币\n\n3、用户B 分别给 用户C 2个比特币、用户D 3个比特币\n\n4、用户C 转给 用户E 7个比特币\n\n5、假设用户B 继续给 用户F 5个比特币，通过区块的回溯，校验出其已经在先前的交易中支付过了，所以交易不合法（避免双花攻击）\n\n在 用户A 向 用户B 的交易中，需要记录 「输入」A的公钥、A的签名 和 「输出」B的地址（通过B的公钥取哈希等操作得到，可类比为银行卡账号）\nA 需要 B的公钥 知道向哪里转账，所有节点都 需要 A的公钥 来验签\n\n#### BitCoin Scripts\n\n交易中的A的公钥（该交易的输入脚本），需要与 币的来源的A的公钥的哈希（前一交易的输出脚本） 相符（两脚本拼在一起能顺利执行）；否则说明币的来源有问题，A被冒名顶替了\n\n## 四、区块结构\n\n### 1、Block header\n\n包含区块的宏信息，比如：version（协议版本）、hash of privious block header（前一区块头的哈希）、merkle root hash（Merkle树 根哈希），还有和挖矿相关的 target（挖矿的难度目标域值）、nonce（随机数）\n\nNote：\n\n（1）hash of privious block header 取的只是前一区块头的哈希，不包含块体\n\n（2）Merkle树 根哈希 保证了块体中的交易列表不会被篡改\n\n（3）target 满足 H(block header)≤target，块头中存的是该目标域值的编码 nBits（nBits 是用于表示难度的参数，用于判断区块头是否有效）\n\n#### nBits\n\nnBits 是一个包含了目标值信息的编码，通常以十六进制形式存储并表示为一个 4 字节（32 位）的数\n该编码包含两个部分：\n- 难度指数（Exponent）：前 1 个字节（8 位）\n- 目标哈希的有效值（Coefficient）：后 3 个字节（24 位）\n目标值越小，挖掘新区块的难度就越大。这允许系统灵活地调整挖矿的难度，并以压缩的方式存储信息\n\n### 2、Block body\n\n包含 transaction list（交易列表）\n\n## 五、Distributed consensus（分布式共识）\n\n账本的内容要取得分布式的共识\n\n### 1、共识的例子：Distributed hash table（分布式哈希表）\n达成共识的是 key-value pairs（键值对）\n\n### 2、Impossibility result（不可能结论）\n\nExample：FLP impossibility result\n在 asynchronous system（异步系统）中，即使只有一个成员是 faulty（有故障的），那么也无法取得共识\n\nCAP Theorem\n\n（1）Consistency（一致性）\n\n（2）Availability（可用性）：即使某些节点不可用，系统仍然能够提供服务\n\n（3）Partition tolerance（分区容忍性）：分区是指在网络中，若干节点之间的通信链路发生故障时形成的网络割裂，这意味着某些节点无法与其他节点进行交互\n\n不可能三角：任何一个分布式系统，只能满足以上两个性质，不可能三个性质都满足\n\n### 3、分布式共识的著名协议：Paxos\n\n该协议能保证一致性，但是有可能一直达不成共识（可能性比较小）\n\n## 六、Consensus in BitCoin（比特币中的共识）\n\n### 1、基于投票的共识方案\n\n基于投票的方案需要确认投票权的 membership，比如联盟链的协议 hyperledger fabric（超分类账结构）。常规的投票方案会带来 sybil attack（女巫攻击），即通过超级计算机生成超半数的比特币账户以获取控制权\n\n### 2、验证过程\n\nH(block header) ≤ target，block header 中包含 4 bytes 的随机数 nonce，组装好区块后就开始尝试不同的 nonce，直到哈希值落在 target 内。如果某节点找到了符合要求的 nonce，即具备了记账权（在去中心化账本中写入/发布下一个区块的权利），发布后即由其他区块进行验证：\n\n1、验证 block header 中的几项\n\n2、看 block body 中的交易列表，验证每个交易都是合法的：（1）要有合法的签名；（2）以前没有被交易过\n\n### 3、Forking attack（分叉攻击）\n\n但是不同的链上可能发生重复交易（forking attack），解决方案是以 longest valid chain（最长合法链）为准，因此只有扩展最长合法链的区块才是合法的\n\n![图2](../images/33/2.png)\n\n当两个矿工同时创造新区块时，其他节点按照接收时间来选择接受哪个区块，等长的临时性的分叉会维持一段时间，直到其中一条链胜出（先找到下一个区块）；而另一条链就变成了 orphan block（孤儿区块） / stale block，被丢弃掉，也就没有出块奖励\n\n### 4、Block reward（区/出块奖励）\n\n获得记账权的节点，在发布的区块里可以进行 coinbase transaction（铸币交易），发布一定数量的比特币\n\n一开始，每个发布的区块可以产生 50 BTC；21万个区块以后，出块奖励会减半为 25 BTC；再过21万个区块，会变成 12.5 BTC（现在）\n\n平均出块时间为10分钟，出块奖励减半的时间：21w * 10min / (60min * 24h * 365d) ≈ 4年\n\n### 5、基于 hash rate 的共识方案\n\nHash rate（计算 nonce 哈希的速度）决定了投票的权重，hash rate 越高，获得记账权并得到出块奖励的概率越大\n\n避免 sybil attack（女巫攻击）：创建多个账户不会增加 hash rate，也不会增加投票权重\n\n## 七、类比\n\n挖矿：mining\n\n比特币：digital gold\n\n矿工（争夺记账权的节点）：minner\n","source":"_posts/33-北大区块链-共识协议.md","raw":"---\ntitle: 北大-区块链技术与应用4-共识协议\ndate: 2025-01-02 21:59:43\ntags:\n    - web3\n    - 共识协议\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n## 一、Double spending attack（双花攻击）\n\n双花攻击指同一笔资金被重复支付的情况，也是数字货币面临的主要挑战\n\n中心化解决方案：数字货币上添加唯一编号，并由央行维护一个数据结构，展示每个编号的货币由谁持有；如果付费方的货币在表中对应的持有人与此人不符，则证明该货币已支付给其他人\n\n去中心化的解决方案：比特币\n\n关注：货币的发行（挖矿）、交易的有效性验证（防范双花攻击）\n\n## 二、交易的有效性验证\n\n通过一个由所有用户共同维护的数据结构——区块链 来实现\n\n## 三、区块链简易结构\n\nNote：以下为简易版的区块链，每个区块都只有一个交易，实际上每个区块的交易记录都构成一个 Merkle tree\n\n![图1](../images/33/1.png)\n\n存在两种哈希指针：将区块串联成链表的指针，和指向前面某个交易的指针（为了说明币的来源，避免凭空捏造和重复交易）\n\n1、用户A 具有发行货币的权利（铸币权，mint 铸币），并发行了10个比特币（coin base transaction，铸币交易）\n\n2、用户A 分别给 用户B、用户C 5个比特币\n\n3、用户B 分别给 用户C 2个比特币、用户D 3个比特币\n\n4、用户C 转给 用户E 7个比特币\n\n5、假设用户B 继续给 用户F 5个比特币，通过区块的回溯，校验出其已经在先前的交易中支付过了，所以交易不合法（避免双花攻击）\n\n在 用户A 向 用户B 的交易中，需要记录 「输入」A的公钥、A的签名 和 「输出」B的地址（通过B的公钥取哈希等操作得到，可类比为银行卡账号）\nA 需要 B的公钥 知道向哪里转账，所有节点都 需要 A的公钥 来验签\n\n#### BitCoin Scripts\n\n交易中的A的公钥（该交易的输入脚本），需要与 币的来源的A的公钥的哈希（前一交易的输出脚本） 相符（两脚本拼在一起能顺利执行）；否则说明币的来源有问题，A被冒名顶替了\n\n## 四、区块结构\n\n### 1、Block header\n\n包含区块的宏信息，比如：version（协议版本）、hash of privious block header（前一区块头的哈希）、merkle root hash（Merkle树 根哈希），还有和挖矿相关的 target（挖矿的难度目标域值）、nonce（随机数）\n\nNote：\n\n（1）hash of privious block header 取的只是前一区块头的哈希，不包含块体\n\n（2）Merkle树 根哈希 保证了块体中的交易列表不会被篡改\n\n（3）target 满足 H(block header)≤target，块头中存的是该目标域值的编码 nBits（nBits 是用于表示难度的参数，用于判断区块头是否有效）\n\n#### nBits\n\nnBits 是一个包含了目标值信息的编码，通常以十六进制形式存储并表示为一个 4 字节（32 位）的数\n该编码包含两个部分：\n- 难度指数（Exponent）：前 1 个字节（8 位）\n- 目标哈希的有效值（Coefficient）：后 3 个字节（24 位）\n目标值越小，挖掘新区块的难度就越大。这允许系统灵活地调整挖矿的难度，并以压缩的方式存储信息\n\n### 2、Block body\n\n包含 transaction list（交易列表）\n\n## 五、Distributed consensus（分布式共识）\n\n账本的内容要取得分布式的共识\n\n### 1、共识的例子：Distributed hash table（分布式哈希表）\n达成共识的是 key-value pairs（键值对）\n\n### 2、Impossibility result（不可能结论）\n\nExample：FLP impossibility result\n在 asynchronous system（异步系统）中，即使只有一个成员是 faulty（有故障的），那么也无法取得共识\n\nCAP Theorem\n\n（1）Consistency（一致性）\n\n（2）Availability（可用性）：即使某些节点不可用，系统仍然能够提供服务\n\n（3）Partition tolerance（分区容忍性）：分区是指在网络中，若干节点之间的通信链路发生故障时形成的网络割裂，这意味着某些节点无法与其他节点进行交互\n\n不可能三角：任何一个分布式系统，只能满足以上两个性质，不可能三个性质都满足\n\n### 3、分布式共识的著名协议：Paxos\n\n该协议能保证一致性，但是有可能一直达不成共识（可能性比较小）\n\n## 六、Consensus in BitCoin（比特币中的共识）\n\n### 1、基于投票的共识方案\n\n基于投票的方案需要确认投票权的 membership，比如联盟链的协议 hyperledger fabric（超分类账结构）。常规的投票方案会带来 sybil attack（女巫攻击），即通过超级计算机生成超半数的比特币账户以获取控制权\n\n### 2、验证过程\n\nH(block header) ≤ target，block header 中包含 4 bytes 的随机数 nonce，组装好区块后就开始尝试不同的 nonce，直到哈希值落在 target 内。如果某节点找到了符合要求的 nonce，即具备了记账权（在去中心化账本中写入/发布下一个区块的权利），发布后即由其他区块进行验证：\n\n1、验证 block header 中的几项\n\n2、看 block body 中的交易列表，验证每个交易都是合法的：（1）要有合法的签名；（2）以前没有被交易过\n\n### 3、Forking attack（分叉攻击）\n\n但是不同的链上可能发生重复交易（forking attack），解决方案是以 longest valid chain（最长合法链）为准，因此只有扩展最长合法链的区块才是合法的\n\n![图2](../images/33/2.png)\n\n当两个矿工同时创造新区块时，其他节点按照接收时间来选择接受哪个区块，等长的临时性的分叉会维持一段时间，直到其中一条链胜出（先找到下一个区块）；而另一条链就变成了 orphan block（孤儿区块） / stale block，被丢弃掉，也就没有出块奖励\n\n### 4、Block reward（区/出块奖励）\n\n获得记账权的节点，在发布的区块里可以进行 coinbase transaction（铸币交易），发布一定数量的比特币\n\n一开始，每个发布的区块可以产生 50 BTC；21万个区块以后，出块奖励会减半为 25 BTC；再过21万个区块，会变成 12.5 BTC（现在）\n\n平均出块时间为10分钟，出块奖励减半的时间：21w * 10min / (60min * 24h * 365d) ≈ 4年\n\n### 5、基于 hash rate 的共识方案\n\nHash rate（计算 nonce 哈希的速度）决定了投票的权重，hash rate 越高，获得记账权并得到出块奖励的概率越大\n\n避免 sybil attack（女巫攻击）：创建多个账户不会增加 hash rate，也不会增加投票权重\n\n## 七、类比\n\n挖矿：mining\n\n比特币：digital gold\n\n矿工（争夺记账权的节点）：minner\n","slug":"33-北大区块链-共识协议","published":1,"updated":"2025-05-20T02:47:28.684Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvua002f6kpr54t79ab8","content":"<h2 id=\"一、Double-spending-attack（双花攻击）\"><a href=\"#一、Double-spending-attack（双花攻击）\" class=\"headerlink\" title=\"一、Double spending attack（双花攻击）\"></a>一、Double spending attack（双花攻击）</h2><p>双花攻击指同一笔资金被重复支付的情况，也是数字货币面临的主要挑战</p>\n<p>中心化解决方案：数字货币上添加唯一编号，并由央行维护一个数据结构，展示每个编号的货币由谁持有；如果付费方的货币在表中对应的持有人与此人不符，则证明该货币已支付给其他人</p>\n<p>去中心化的解决方案：比特币</p>\n<p>关注：货币的发行（挖矿）、交易的有效性验证（防范双花攻击）</p>\n<h2 id=\"二、交易的有效性验证\"><a href=\"#二、交易的有效性验证\" class=\"headerlink\" title=\"二、交易的有效性验证\"></a>二、交易的有效性验证</h2><p>通过一个由所有用户共同维护的数据结构——区块链 来实现</p>\n<h2 id=\"三、区块链简易结构\"><a href=\"#三、区块链简易结构\" class=\"headerlink\" title=\"三、区块链简易结构\"></a>三、区块链简易结构</h2><p>Note：以下为简易版的区块链，每个区块都只有一个交易，实际上每个区块的交易记录都构成一个 Merkle tree</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/33/1.png\"\n                      alt=\"图1\"\n                ></p>\n<p>存在两种哈希指针：将区块串联成链表的指针，和指向前面某个交易的指针（为了说明币的来源，避免凭空捏造和重复交易）</p>\n<p>1、用户A 具有发行货币的权利（铸币权，mint 铸币），并发行了10个比特币（coin base transaction，铸币交易）</p>\n<p>2、用户A 分别给 用户B、用户C 5个比特币</p>\n<p>3、用户B 分别给 用户C 2个比特币、用户D 3个比特币</p>\n<p>4、用户C 转给 用户E 7个比特币</p>\n<p>5、假设用户B 继续给 用户F 5个比特币，通过区块的回溯，校验出其已经在先前的交易中支付过了，所以交易不合法（避免双花攻击）</p>\n<p>在 用户A 向 用户B 的交易中，需要记录 「输入」A的公钥、A的签名 和 「输出」B的地址（通过B的公钥取哈希等操作得到，可类比为银行卡账号）<br>A 需要 B的公钥 知道向哪里转账，所有节点都 需要 A的公钥 来验签</p>\n<h4 id=\"BitCoin-Scripts\"><a href=\"#BitCoin-Scripts\" class=\"headerlink\" title=\"BitCoin Scripts\"></a>BitCoin Scripts</h4><p>交易中的A的公钥（该交易的输入脚本），需要与 币的来源的A的公钥的哈希（前一交易的输出脚本） 相符（两脚本拼在一起能顺利执行）；否则说明币的来源有问题，A被冒名顶替了</p>\n<h2 id=\"四、区块结构\"><a href=\"#四、区块结构\" class=\"headerlink\" title=\"四、区块结构\"></a>四、区块结构</h2><h3 id=\"1、Block-header\"><a href=\"#1、Block-header\" class=\"headerlink\" title=\"1、Block header\"></a>1、Block header</h3><p>包含区块的宏信息，比如：version（协议版本）、hash of privious block header（前一区块头的哈希）、merkle root hash（Merkle树 根哈希），还有和挖矿相关的 target（挖矿的难度目标域值）、nonce（随机数）</p>\n<p>Note：</p>\n<p>（1）hash of privious block header 取的只是前一区块头的哈希，不包含块体</p>\n<p>（2）Merkle树 根哈希 保证了块体中的交易列表不会被篡改</p>\n<p>（3）target 满足 H(block header)≤target，块头中存的是该目标域值的编码 nBits（nBits 是用于表示难度的参数，用于判断区块头是否有效）</p>\n<h4 id=\"nBits\"><a href=\"#nBits\" class=\"headerlink\" title=\"nBits\"></a>nBits</h4><p>nBits 是一个包含了目标值信息的编码，通常以十六进制形式存储并表示为一个 4 字节（32 位）的数<br>该编码包含两个部分：</p>\n<ul>\n<li>难度指数（Exponent）：前 1 个字节（8 位）</li>\n<li>目标哈希的有效值（Coefficient）：后 3 个字节（24 位）<br>目标值越小，挖掘新区块的难度就越大。这允许系统灵活地调整挖矿的难度，并以压缩的方式存储信息</li>\n</ul>\n<h3 id=\"2、Block-body\"><a href=\"#2、Block-body\" class=\"headerlink\" title=\"2、Block body\"></a>2、Block body</h3><p>包含 transaction list（交易列表）</p>\n<h2 id=\"五、Distributed-consensus（分布式共识）\"><a href=\"#五、Distributed-consensus（分布式共识）\" class=\"headerlink\" title=\"五、Distributed consensus（分布式共识）\"></a>五、Distributed consensus（分布式共识）</h2><p>账本的内容要取得分布式的共识</p>\n<h3 id=\"1、共识的例子：Distributed-hash-table（分布式哈希表）\"><a href=\"#1、共识的例子：Distributed-hash-table（分布式哈希表）\" class=\"headerlink\" title=\"1、共识的例子：Distributed hash table（分布式哈希表）\"></a>1、共识的例子：Distributed hash table（分布式哈希表）</h3><p>达成共识的是 key-value pairs（键值对）</p>\n<h3 id=\"2、Impossibility-result（不可能结论）\"><a href=\"#2、Impossibility-result（不可能结论）\" class=\"headerlink\" title=\"2、Impossibility result（不可能结论）\"></a>2、Impossibility result（不可能结论）</h3><p>Example：FLP impossibility result<br>在 asynchronous system（异步系统）中，即使只有一个成员是 faulty（有故障的），那么也无法取得共识</p>\n<p>CAP Theorem</p>\n<p>（1）Consistency（一致性）</p>\n<p>（2）Availability（可用性）：即使某些节点不可用，系统仍然能够提供服务</p>\n<p>（3）Partition tolerance（分区容忍性）：分区是指在网络中，若干节点之间的通信链路发生故障时形成的网络割裂，这意味着某些节点无法与其他节点进行交互</p>\n<p>不可能三角：任何一个分布式系统，只能满足以上两个性质，不可能三个性质都满足</p>\n<h3 id=\"3、分布式共识的著名协议：Paxos\"><a href=\"#3、分布式共识的著名协议：Paxos\" class=\"headerlink\" title=\"3、分布式共识的著名协议：Paxos\"></a>3、分布式共识的著名协议：Paxos</h3><p>该协议能保证一致性，但是有可能一直达不成共识（可能性比较小）</p>\n<h2 id=\"六、Consensus-in-BitCoin（比特币中的共识）\"><a href=\"#六、Consensus-in-BitCoin（比特币中的共识）\" class=\"headerlink\" title=\"六、Consensus in BitCoin（比特币中的共识）\"></a>六、Consensus in BitCoin（比特币中的共识）</h2><h3 id=\"1、基于投票的共识方案\"><a href=\"#1、基于投票的共识方案\" class=\"headerlink\" title=\"1、基于投票的共识方案\"></a>1、基于投票的共识方案</h3><p>基于投票的方案需要确认投票权的 membership，比如联盟链的协议 hyperledger fabric（超分类账结构）。常规的投票方案会带来 sybil attack（女巫攻击），即通过超级计算机生成超半数的比特币账户以获取控制权</p>\n<h3 id=\"2、验证过程\"><a href=\"#2、验证过程\" class=\"headerlink\" title=\"2、验证过程\"></a>2、验证过程</h3><p>H(block header) ≤ target，block header 中包含 4 bytes 的随机数 nonce，组装好区块后就开始尝试不同的 nonce，直到哈希值落在 target 内。如果某节点找到了符合要求的 nonce，即具备了记账权（在去中心化账本中写入&#x2F;发布下一个区块的权利），发布后即由其他区块进行验证：</p>\n<p>1、验证 block header 中的几项</p>\n<p>2、看 block body 中的交易列表，验证每个交易都是合法的：（1）要有合法的签名；（2）以前没有被交易过</p>\n<h3 id=\"3、Forking-attack（分叉攻击）\"><a href=\"#3、Forking-attack（分叉攻击）\" class=\"headerlink\" title=\"3、Forking attack（分叉攻击）\"></a>3、Forking attack（分叉攻击）</h3><p>但是不同的链上可能发生重复交易（forking attack），解决方案是以 longest valid chain（最长合法链）为准，因此只有扩展最长合法链的区块才是合法的</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/33/2.png\"\n                      alt=\"图2\"\n                ></p>\n<p>当两个矿工同时创造新区块时，其他节点按照接收时间来选择接受哪个区块，等长的临时性的分叉会维持一段时间，直到其中一条链胜出（先找到下一个区块）；而另一条链就变成了 orphan block（孤儿区块） &#x2F; stale block，被丢弃掉，也就没有出块奖励</p>\n<h3 id=\"4、Block-reward（区-出块奖励）\"><a href=\"#4、Block-reward（区-出块奖励）\" class=\"headerlink\" title=\"4、Block reward（区&#x2F;出块奖励）\"></a>4、Block reward（区&#x2F;出块奖励）</h3><p>获得记账权的节点，在发布的区块里可以进行 coinbase transaction（铸币交易），发布一定数量的比特币</p>\n<p>一开始，每个发布的区块可以产生 50 BTC；21万个区块以后，出块奖励会减半为 25 BTC；再过21万个区块，会变成 12.5 BTC（现在）</p>\n<p>平均出块时间为10分钟，出块奖励减半的时间：21w * 10min &#x2F; (60min * 24h * 365d) ≈ 4年</p>\n<h3 id=\"5、基于-hash-rate-的共识方案\"><a href=\"#5、基于-hash-rate-的共识方案\" class=\"headerlink\" title=\"5、基于 hash rate 的共识方案\"></a>5、基于 hash rate 的共识方案</h3><p>Hash rate（计算 nonce 哈希的速度）决定了投票的权重，hash rate 越高，获得记账权并得到出块奖励的概率越大</p>\n<p>避免 sybil attack（女巫攻击）：创建多个账户不会增加 hash rate，也不会增加投票权重</p>\n<h2 id=\"七、类比\"><a href=\"#七、类比\" class=\"headerlink\" title=\"七、类比\"></a>七、类比</h2><p>挖矿：mining</p>\n<p>比特币：digital gold</p>\n<p>矿工（争夺记账权的节点）：minner</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、Double-spending-attack（双花攻击）\"><a href=\"#一、Double-spending-attack（双花攻击）\" class=\"headerlink\" title=\"一、Double spending attack（双花攻击）\"></a>一、Double spending attack（双花攻击）</h2><p>双花攻击指同一笔资金被重复支付的情况，也是数字货币面临的主要挑战</p>\n<p>中心化解决方案：数字货币上添加唯一编号，并由央行维护一个数据结构，展示每个编号的货币由谁持有；如果付费方的货币在表中对应的持有人与此人不符，则证明该货币已支付给其他人</p>\n<p>去中心化的解决方案：比特币</p>\n<p>关注：货币的发行（挖矿）、交易的有效性验证（防范双花攻击）</p>\n<h2 id=\"二、交易的有效性验证\"><a href=\"#二、交易的有效性验证\" class=\"headerlink\" title=\"二、交易的有效性验证\"></a>二、交易的有效性验证</h2><p>通过一个由所有用户共同维护的数据结构——区块链 来实现</p>\n<h2 id=\"三、区块链简易结构\"><a href=\"#三、区块链简易结构\" class=\"headerlink\" title=\"三、区块链简易结构\"></a>三、区块链简易结构</h2><p>Note：以下为简易版的区块链，每个区块都只有一个交易，实际上每个区块的交易记录都构成一个 Merkle tree</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/33/1.png\"\n                      alt=\"图1\"\n                ></p>\n<p>存在两种哈希指针：将区块串联成链表的指针，和指向前面某个交易的指针（为了说明币的来源，避免凭空捏造和重复交易）</p>\n<p>1、用户A 具有发行货币的权利（铸币权，mint 铸币），并发行了10个比特币（coin base transaction，铸币交易）</p>\n<p>2、用户A 分别给 用户B、用户C 5个比特币</p>\n<p>3、用户B 分别给 用户C 2个比特币、用户D 3个比特币</p>\n<p>4、用户C 转给 用户E 7个比特币</p>\n<p>5、假设用户B 继续给 用户F 5个比特币，通过区块的回溯，校验出其已经在先前的交易中支付过了，所以交易不合法（避免双花攻击）</p>\n<p>在 用户A 向 用户B 的交易中，需要记录 「输入」A的公钥、A的签名 和 「输出」B的地址（通过B的公钥取哈希等操作得到，可类比为银行卡账号）<br>A 需要 B的公钥 知道向哪里转账，所有节点都 需要 A的公钥 来验签</p>\n<h4 id=\"BitCoin-Scripts\"><a href=\"#BitCoin-Scripts\" class=\"headerlink\" title=\"BitCoin Scripts\"></a>BitCoin Scripts</h4><p>交易中的A的公钥（该交易的输入脚本），需要与 币的来源的A的公钥的哈希（前一交易的输出脚本） 相符（两脚本拼在一起能顺利执行）；否则说明币的来源有问题，A被冒名顶替了</p>\n<h2 id=\"四、区块结构\"><a href=\"#四、区块结构\" class=\"headerlink\" title=\"四、区块结构\"></a>四、区块结构</h2><h3 id=\"1、Block-header\"><a href=\"#1、Block-header\" class=\"headerlink\" title=\"1、Block header\"></a>1、Block header</h3><p>包含区块的宏信息，比如：version（协议版本）、hash of privious block header（前一区块头的哈希）、merkle root hash（Merkle树 根哈希），还有和挖矿相关的 target（挖矿的难度目标域值）、nonce（随机数）</p>\n<p>Note：</p>\n<p>（1）hash of privious block header 取的只是前一区块头的哈希，不包含块体</p>\n<p>（2）Merkle树 根哈希 保证了块体中的交易列表不会被篡改</p>\n<p>（3）target 满足 H(block header)≤target，块头中存的是该目标域值的编码 nBits（nBits 是用于表示难度的参数，用于判断区块头是否有效）</p>\n<h4 id=\"nBits\"><a href=\"#nBits\" class=\"headerlink\" title=\"nBits\"></a>nBits</h4><p>nBits 是一个包含了目标值信息的编码，通常以十六进制形式存储并表示为一个 4 字节（32 位）的数<br>该编码包含两个部分：</p>\n<ul>\n<li>难度指数（Exponent）：前 1 个字节（8 位）</li>\n<li>目标哈希的有效值（Coefficient）：后 3 个字节（24 位）<br>目标值越小，挖掘新区块的难度就越大。这允许系统灵活地调整挖矿的难度，并以压缩的方式存储信息</li>\n</ul>\n<h3 id=\"2、Block-body\"><a href=\"#2、Block-body\" class=\"headerlink\" title=\"2、Block body\"></a>2、Block body</h3><p>包含 transaction list（交易列表）</p>\n<h2 id=\"五、Distributed-consensus（分布式共识）\"><a href=\"#五、Distributed-consensus（分布式共识）\" class=\"headerlink\" title=\"五、Distributed consensus（分布式共识）\"></a>五、Distributed consensus（分布式共识）</h2><p>账本的内容要取得分布式的共识</p>\n<h3 id=\"1、共识的例子：Distributed-hash-table（分布式哈希表）\"><a href=\"#1、共识的例子：Distributed-hash-table（分布式哈希表）\" class=\"headerlink\" title=\"1、共识的例子：Distributed hash table（分布式哈希表）\"></a>1、共识的例子：Distributed hash table（分布式哈希表）</h3><p>达成共识的是 key-value pairs（键值对）</p>\n<h3 id=\"2、Impossibility-result（不可能结论）\"><a href=\"#2、Impossibility-result（不可能结论）\" class=\"headerlink\" title=\"2、Impossibility result（不可能结论）\"></a>2、Impossibility result（不可能结论）</h3><p>Example：FLP impossibility result<br>在 asynchronous system（异步系统）中，即使只有一个成员是 faulty（有故障的），那么也无法取得共识</p>\n<p>CAP Theorem</p>\n<p>（1）Consistency（一致性）</p>\n<p>（2）Availability（可用性）：即使某些节点不可用，系统仍然能够提供服务</p>\n<p>（3）Partition tolerance（分区容忍性）：分区是指在网络中，若干节点之间的通信链路发生故障时形成的网络割裂，这意味着某些节点无法与其他节点进行交互</p>\n<p>不可能三角：任何一个分布式系统，只能满足以上两个性质，不可能三个性质都满足</p>\n<h3 id=\"3、分布式共识的著名协议：Paxos\"><a href=\"#3、分布式共识的著名协议：Paxos\" class=\"headerlink\" title=\"3、分布式共识的著名协议：Paxos\"></a>3、分布式共识的著名协议：Paxos</h3><p>该协议能保证一致性，但是有可能一直达不成共识（可能性比较小）</p>\n<h2 id=\"六、Consensus-in-BitCoin（比特币中的共识）\"><a href=\"#六、Consensus-in-BitCoin（比特币中的共识）\" class=\"headerlink\" title=\"六、Consensus in BitCoin（比特币中的共识）\"></a>六、Consensus in BitCoin（比特币中的共识）</h2><h3 id=\"1、基于投票的共识方案\"><a href=\"#1、基于投票的共识方案\" class=\"headerlink\" title=\"1、基于投票的共识方案\"></a>1、基于投票的共识方案</h3><p>基于投票的方案需要确认投票权的 membership，比如联盟链的协议 hyperledger fabric（超分类账结构）。常规的投票方案会带来 sybil attack（女巫攻击），即通过超级计算机生成超半数的比特币账户以获取控制权</p>\n<h3 id=\"2、验证过程\"><a href=\"#2、验证过程\" class=\"headerlink\" title=\"2、验证过程\"></a>2、验证过程</h3><p>H(block header) ≤ target，block header 中包含 4 bytes 的随机数 nonce，组装好区块后就开始尝试不同的 nonce，直到哈希值落在 target 内。如果某节点找到了符合要求的 nonce，即具备了记账权（在去中心化账本中写入&#x2F;发布下一个区块的权利），发布后即由其他区块进行验证：</p>\n<p>1、验证 block header 中的几项</p>\n<p>2、看 block body 中的交易列表，验证每个交易都是合法的：（1）要有合法的签名；（2）以前没有被交易过</p>\n<h3 id=\"3、Forking-attack（分叉攻击）\"><a href=\"#3、Forking-attack（分叉攻击）\" class=\"headerlink\" title=\"3、Forking attack（分叉攻击）\"></a>3、Forking attack（分叉攻击）</h3><p>但是不同的链上可能发生重复交易（forking attack），解决方案是以 longest valid chain（最长合法链）为准，因此只有扩展最长合法链的区块才是合法的</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/33/2.png\"\n                      alt=\"图2\"\n                ></p>\n<p>当两个矿工同时创造新区块时，其他节点按照接收时间来选择接受哪个区块，等长的临时性的分叉会维持一段时间，直到其中一条链胜出（先找到下一个区块）；而另一条链就变成了 orphan block（孤儿区块） &#x2F; stale block，被丢弃掉，也就没有出块奖励</p>\n<h3 id=\"4、Block-reward（区-出块奖励）\"><a href=\"#4、Block-reward（区-出块奖励）\" class=\"headerlink\" title=\"4、Block reward（区&#x2F;出块奖励）\"></a>4、Block reward（区&#x2F;出块奖励）</h3><p>获得记账权的节点，在发布的区块里可以进行 coinbase transaction（铸币交易），发布一定数量的比特币</p>\n<p>一开始，每个发布的区块可以产生 50 BTC；21万个区块以后，出块奖励会减半为 25 BTC；再过21万个区块，会变成 12.5 BTC（现在）</p>\n<p>平均出块时间为10分钟，出块奖励减半的时间：21w * 10min &#x2F; (60min * 24h * 365d) ≈ 4年</p>\n<h3 id=\"5、基于-hash-rate-的共识方案\"><a href=\"#5、基于-hash-rate-的共识方案\" class=\"headerlink\" title=\"5、基于 hash rate 的共识方案\"></a>5、基于 hash rate 的共识方案</h3><p>Hash rate（计算 nonce 哈希的速度）决定了投票的权重，hash rate 越高，获得记账权并得到出块奖励的概率越大</p>\n<p>避免 sybil attack（女巫攻击）：创建多个账户不会增加 hash rate，也不会增加投票权重</p>\n<h2 id=\"七、类比\"><a href=\"#七、类比\" class=\"headerlink\" title=\"七、类比\"></a>七、类比</h2><p>挖矿：mining</p>\n<p>比特币：digital gold</p>\n<p>矿工（争夺记账权的节点）：minner</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用5-BTC系统的实现","date":"2025-01-12T15:07:42.000Z","_content":"\n比特币采用 transaction-based ledger（基于交易的账本）模式，每个区块中记录交易信息（转账交易、铸币交易），系统上不记录交易信息\n\n## 一、UTXO\n\n比特币的全节点要维护一个数据结构 UTXO（Unspent Transaction Output，所有未被花出去的交易的输出 组成的集合）\n\n一个交易可能有多个输出，即用户可以在一次交易中同时向多人转账（可以节省手续费）\n\n比如：A 给 B 交易 5 BTC，B 将其交易出去；A 给 C 交易 3 BTC，但未交易出去。这是两个输出，但是只有 A 给 C 的交易在 UTXO 中\n\n![图1](../images/34/1.png)\n\nUTXO 中的每个元素要给出产生这个输出的交易的哈希值（可理解为交易的ID），以及它在这个交易里是第几个输出，这两个信息可以定位一个 UTXO 中的输出\n\n### UTXO 的用途：\n\n在交易发生前，检查即将花出去的币是否在 UTXO 中，在才是合法的，快速校验双花攻击和凭空捏造\n\n每笔交易会消耗掉 UTXO 中的一些输出，同时在 UTXO 中产生新的输出，total inputs = total outputs（所有输入的金额 等于 所有输出的金额）\n\n```\ntotal inputs ≈ total outputs\n    1 BTC         0.99 BTC\n```\n\n### Transaction fee（交易费）：\n\n发布区块的节点（矿工）之所以会把他人的交易打包到新区块里，是因为 BTC 系统的第二个激励机制——交易费。通过把他人的交易打包到区块里，矿工会收取一些交易费（费用高的交易优先级就更高）\n\n目前矿工挖矿、争夺记账权，主要目的还是为了获取出块奖励，但是随着出块奖励的减少；多年后，交易费可能会变成矿工的主要收益\n\n## 二、Account-based ledger（基于账户的账本）\n\n和比特币 transaction-based ledger（基于交易的账本）模式不同，以太坊采用 account-based ledger（基于账户的账本）模式，在这种模式中，系统需要显式地记录每个账户有多少币，查询更方便（不需要说明币的来源），但是隐私保护性不如比特币\n\n## 三、Block Example\n\nBlock header 的详细字段：https://developer.bitcoin.org/reference/block_chain.html\n\n其中，nonce 和 merkle root hash 是可以改变的，通过改变 coinbase message 来改变 merkle root hash（coinbase message 可以看做 extra nonce）\n\n![图3](../images/34/2.png)\n\n在比特币的 POW（Power of work，工作量证明机制）中，矿工需要不断尝试不同的 nonce 和 coinbase message 组合，以找到一个满足目标哈希值的区块头，共有两层循环：\n\n外层循环调整 coinbase 域 的 extra nonce，算出 block header 里的根哈希值之后，内层循环再调整 header 里的 nonce\n\n![图3](../images/34/3.png)\n\n在比特币系统中，验证交易的合法性，就是通过将交易的 input scripts 和 output scripts 配对后执行来完成的。注意：不是把同一个交易的输入脚本和输入脚本配对，而是把这个交易里的输入脚本 和 前一个提供币来源的交易里的输出脚本配对。如果拼接在一起可以顺利执行，那么该交易就是合法的\n\n## 四、挖矿概率分析\n\nBernoulli trial（伯努利试验）：A random experiment with binary outcome，比如：掷硬币\n\nBernoulli process（伯努利过程）：A sequence of independent Bernoulli trials\n\nPorsson process（泊松过程）：试验次数很多，成功概率很小\n\n伯努利过程的性质之一是 memoryless（无记忆性）/ progress free（与过程无关）：前面的实验结果对后面的实验结果无影响。由于挖矿的成功概率很小，所以可以用泊松过程近似\n\n出块时间服从 Exponential distribution（指数分布），纵轴是 probability density（概率密度），横轴是 time to next block（出块时间）。注意这是整个系统的出块时间，不是每个具体矿工的出块时间，具体到每一个矿工，出块时间取决于矿工的算力占系统总算力的百分比\n\n![图3](../images/34/4.png)\n\n如果不满足 progress free 这个性质，那么算力强的矿工会获得不成比例的优势，比如：A算力是B算力的10倍，但是A获得记账权的概率超过B的10倍。该性质正是挖矿公平性的保证\n\n## 五、比特币的总量\n\n产生的比特币数量构成一个 geometric series（几何序列）：21w * 50 + 21w * 25 + 21w* 12.5 + ... = 21w * 50 * (1 + 1/2 + 1/4 + ...) = 2100w\n\n挖矿的过程对于维护比特币系统的安全性是至关重要的：Bitcoin is secured by mining，对于一个去中心化的系统，挖矿提供了一个凭借算力投票的有效手段，只要大部分算力掌握在诚实的节点手里，系统的安全性就能得到保证\n\n## 六、比特币的安全性\n\n### 1、偷币\n\n偷币是不可能的，因为系统以最长链合法链为准，恶意节点产生的区块会变成孤儿区块被丢弃，并且恶意节点还会损失本应得的出块奖励\n\n### 2、双花攻击\n\n可以通过 forking attack（分叉攻击）实现。区块插入的位置在刚开始挖矿的时候就决定，因为设置的 block header 里需要填写前一个区块的哈希值。\n\n分叉攻击：首先制造等长的合法链，比如，M 向 A 转账交易，产生了不可逆的外部效果（如购买实体商品）；然后再将该交易回滚，留下 M 向自己转账的区块，则 M 可从中不当获利\n\n![图3](../images/34/5.png)\n\n#### 如何防范分叉攻击？\n\n多等几个区块 / confirmation（确认），M 向 A 转账的交易刚写入区块的时候，叫 one confirmation，后面的区块类推。比特币协议中缺省的设置是：等待 6 个 confirmation 之后，才认为前面的交易是不可篡改的（大约1小时）\n\n![图3](../images/34/6.png)\n\n区块链是 Irrevocable ledger（不可篡改的账本），这种不可篡改性只是一种概率上的保证，刚刚写入区块链的内容还是比较容易被改变的，随着后续 confirmation 的增加，被篡改的概率会指数级大幅度下降\n\nZero confirmation：转账交易发布出去了，但是还未被写入区块链中。这种方式在实际应用中比较普遍，因为（1）比特币协议缺省的设置是 节点接收最先听到的那个交易，所以上述例子中 M 转给自己的交易大概率不会被诚实的节点接受；（2）很多购物网站从支付成功到发货天然是有时间间隔的\n\n### 3、恶意节点故意不把合法交易写入\n\n因为总有诚实的节点愿意发布这些交易，所以合法交易总是可以被写到下一个区块里\n\n在正常工作的情况下，也可能出现合法交易未被包含进去的情况，比如近期交易的数目太多。比特币协议中规定，每个区块的大小是有限制的，最多不能超过一兆字节，如果交易的数目太多，可能就只能等到下一个区块再发布\n\n### Selfish mining（自私挖矿）\n\n正常情况下，挖到一个区块就立即发布，防止别人发布后自己的区块作废、丧失出块奖励\n\nSelfish mining：挖到多个区块，但是都藏着不发布，攒够6个之后同时发布。这种攻击的前提是，有恶意的节点需要占据很大一部分算力（比如至少51%）\n\nSelfish mining 的好处：如果个人算力较强，可以减少挖后续区块的竞争\n","source":"_posts/34-北大区块链-BTC系统实现.md","raw":"---\ntitle: 北大-区块链技术与应用5-BTC系统的实现\ndate: 2025-01-12 23:07:42\ntags:\n    - web3\n    - BTC\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n比特币采用 transaction-based ledger（基于交易的账本）模式，每个区块中记录交易信息（转账交易、铸币交易），系统上不记录交易信息\n\n## 一、UTXO\n\n比特币的全节点要维护一个数据结构 UTXO（Unspent Transaction Output，所有未被花出去的交易的输出 组成的集合）\n\n一个交易可能有多个输出，即用户可以在一次交易中同时向多人转账（可以节省手续费）\n\n比如：A 给 B 交易 5 BTC，B 将其交易出去；A 给 C 交易 3 BTC，但未交易出去。这是两个输出，但是只有 A 给 C 的交易在 UTXO 中\n\n![图1](../images/34/1.png)\n\nUTXO 中的每个元素要给出产生这个输出的交易的哈希值（可理解为交易的ID），以及它在这个交易里是第几个输出，这两个信息可以定位一个 UTXO 中的输出\n\n### UTXO 的用途：\n\n在交易发生前，检查即将花出去的币是否在 UTXO 中，在才是合法的，快速校验双花攻击和凭空捏造\n\n每笔交易会消耗掉 UTXO 中的一些输出，同时在 UTXO 中产生新的输出，total inputs = total outputs（所有输入的金额 等于 所有输出的金额）\n\n```\ntotal inputs ≈ total outputs\n    1 BTC         0.99 BTC\n```\n\n### Transaction fee（交易费）：\n\n发布区块的节点（矿工）之所以会把他人的交易打包到新区块里，是因为 BTC 系统的第二个激励机制——交易费。通过把他人的交易打包到区块里，矿工会收取一些交易费（费用高的交易优先级就更高）\n\n目前矿工挖矿、争夺记账权，主要目的还是为了获取出块奖励，但是随着出块奖励的减少；多年后，交易费可能会变成矿工的主要收益\n\n## 二、Account-based ledger（基于账户的账本）\n\n和比特币 transaction-based ledger（基于交易的账本）模式不同，以太坊采用 account-based ledger（基于账户的账本）模式，在这种模式中，系统需要显式地记录每个账户有多少币，查询更方便（不需要说明币的来源），但是隐私保护性不如比特币\n\n## 三、Block Example\n\nBlock header 的详细字段：https://developer.bitcoin.org/reference/block_chain.html\n\n其中，nonce 和 merkle root hash 是可以改变的，通过改变 coinbase message 来改变 merkle root hash（coinbase message 可以看做 extra nonce）\n\n![图3](../images/34/2.png)\n\n在比特币的 POW（Power of work，工作量证明机制）中，矿工需要不断尝试不同的 nonce 和 coinbase message 组合，以找到一个满足目标哈希值的区块头，共有两层循环：\n\n外层循环调整 coinbase 域 的 extra nonce，算出 block header 里的根哈希值之后，内层循环再调整 header 里的 nonce\n\n![图3](../images/34/3.png)\n\n在比特币系统中，验证交易的合法性，就是通过将交易的 input scripts 和 output scripts 配对后执行来完成的。注意：不是把同一个交易的输入脚本和输入脚本配对，而是把这个交易里的输入脚本 和 前一个提供币来源的交易里的输出脚本配对。如果拼接在一起可以顺利执行，那么该交易就是合法的\n\n## 四、挖矿概率分析\n\nBernoulli trial（伯努利试验）：A random experiment with binary outcome，比如：掷硬币\n\nBernoulli process（伯努利过程）：A sequence of independent Bernoulli trials\n\nPorsson process（泊松过程）：试验次数很多，成功概率很小\n\n伯努利过程的性质之一是 memoryless（无记忆性）/ progress free（与过程无关）：前面的实验结果对后面的实验结果无影响。由于挖矿的成功概率很小，所以可以用泊松过程近似\n\n出块时间服从 Exponential distribution（指数分布），纵轴是 probability density（概率密度），横轴是 time to next block（出块时间）。注意这是整个系统的出块时间，不是每个具体矿工的出块时间，具体到每一个矿工，出块时间取决于矿工的算力占系统总算力的百分比\n\n![图3](../images/34/4.png)\n\n如果不满足 progress free 这个性质，那么算力强的矿工会获得不成比例的优势，比如：A算力是B算力的10倍，但是A获得记账权的概率超过B的10倍。该性质正是挖矿公平性的保证\n\n## 五、比特币的总量\n\n产生的比特币数量构成一个 geometric series（几何序列）：21w * 50 + 21w * 25 + 21w* 12.5 + ... = 21w * 50 * (1 + 1/2 + 1/4 + ...) = 2100w\n\n挖矿的过程对于维护比特币系统的安全性是至关重要的：Bitcoin is secured by mining，对于一个去中心化的系统，挖矿提供了一个凭借算力投票的有效手段，只要大部分算力掌握在诚实的节点手里，系统的安全性就能得到保证\n\n## 六、比特币的安全性\n\n### 1、偷币\n\n偷币是不可能的，因为系统以最长链合法链为准，恶意节点产生的区块会变成孤儿区块被丢弃，并且恶意节点还会损失本应得的出块奖励\n\n### 2、双花攻击\n\n可以通过 forking attack（分叉攻击）实现。区块插入的位置在刚开始挖矿的时候就决定，因为设置的 block header 里需要填写前一个区块的哈希值。\n\n分叉攻击：首先制造等长的合法链，比如，M 向 A 转账交易，产生了不可逆的外部效果（如购买实体商品）；然后再将该交易回滚，留下 M 向自己转账的区块，则 M 可从中不当获利\n\n![图3](../images/34/5.png)\n\n#### 如何防范分叉攻击？\n\n多等几个区块 / confirmation（确认），M 向 A 转账的交易刚写入区块的时候，叫 one confirmation，后面的区块类推。比特币协议中缺省的设置是：等待 6 个 confirmation 之后，才认为前面的交易是不可篡改的（大约1小时）\n\n![图3](../images/34/6.png)\n\n区块链是 Irrevocable ledger（不可篡改的账本），这种不可篡改性只是一种概率上的保证，刚刚写入区块链的内容还是比较容易被改变的，随着后续 confirmation 的增加，被篡改的概率会指数级大幅度下降\n\nZero confirmation：转账交易发布出去了，但是还未被写入区块链中。这种方式在实际应用中比较普遍，因为（1）比特币协议缺省的设置是 节点接收最先听到的那个交易，所以上述例子中 M 转给自己的交易大概率不会被诚实的节点接受；（2）很多购物网站从支付成功到发货天然是有时间间隔的\n\n### 3、恶意节点故意不把合法交易写入\n\n因为总有诚实的节点愿意发布这些交易，所以合法交易总是可以被写到下一个区块里\n\n在正常工作的情况下，也可能出现合法交易未被包含进去的情况，比如近期交易的数目太多。比特币协议中规定，每个区块的大小是有限制的，最多不能超过一兆字节，如果交易的数目太多，可能就只能等到下一个区块再发布\n\n### Selfish mining（自私挖矿）\n\n正常情况下，挖到一个区块就立即发布，防止别人发布后自己的区块作废、丧失出块奖励\n\nSelfish mining：挖到多个区块，但是都藏着不发布，攒够6个之后同时发布。这种攻击的前提是，有恶意的节点需要占据很大一部分算力（比如至少51%）\n\nSelfish mining 的好处：如果个人算力较强，可以减少挖后续区块的竞争\n","slug":"34-北大区块链-BTC系统实现","published":1,"updated":"2025-05-20T02:47:28.684Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvua002h6kprf1uo3y7n","content":"<p>比特币采用 transaction-based ledger（基于交易的账本）模式，每个区块中记录交易信息（转账交易、铸币交易），系统上不记录交易信息</p>\n<h2 id=\"一、UTXO\"><a href=\"#一、UTXO\" class=\"headerlink\" title=\"一、UTXO\"></a>一、UTXO</h2><p>比特币的全节点要维护一个数据结构 UTXO（Unspent Transaction Output，所有未被花出去的交易的输出 组成的集合）</p>\n<p>一个交易可能有多个输出，即用户可以在一次交易中同时向多人转账（可以节省手续费）</p>\n<p>比如：A 给 B 交易 5 BTC，B 将其交易出去；A 给 C 交易 3 BTC，但未交易出去。这是两个输出，但是只有 A 给 C 的交易在 UTXO 中</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/34/1.png\"\n                      alt=\"图1\"\n                ></p>\n<p>UTXO 中的每个元素要给出产生这个输出的交易的哈希值（可理解为交易的ID），以及它在这个交易里是第几个输出，这两个信息可以定位一个 UTXO 中的输出</p>\n<h3 id=\"UTXO-的用途：\"><a href=\"#UTXO-的用途：\" class=\"headerlink\" title=\"UTXO 的用途：\"></a>UTXO 的用途：</h3><p>在交易发生前，检查即将花出去的币是否在 UTXO 中，在才是合法的，快速校验双花攻击和凭空捏造</p>\n<p>每笔交易会消耗掉 UTXO 中的一些输出，同时在 UTXO 中产生新的输出，total inputs &#x3D; total outputs（所有输入的金额 等于 所有输出的金额）</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">total inputs ≈ total outputs</span><br><span class=\"line\">    1 BTC         0.99 BTC</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"Transaction-fee（交易费）：\"><a href=\"#Transaction-fee（交易费）：\" class=\"headerlink\" title=\"Transaction fee（交易费）：\"></a>Transaction fee（交易费）：</h3><p>发布区块的节点（矿工）之所以会把他人的交易打包到新区块里，是因为 BTC 系统的第二个激励机制——交易费。通过把他人的交易打包到区块里，矿工会收取一些交易费（费用高的交易优先级就更高）</p>\n<p>目前矿工挖矿、争夺记账权，主要目的还是为了获取出块奖励，但是随着出块奖励的减少；多年后，交易费可能会变成矿工的主要收益</p>\n<h2 id=\"二、Account-based-ledger（基于账户的账本）\"><a href=\"#二、Account-based-ledger（基于账户的账本）\" class=\"headerlink\" title=\"二、Account-based ledger（基于账户的账本）\"></a>二、Account-based ledger（基于账户的账本）</h2><p>和比特币 transaction-based ledger（基于交易的账本）模式不同，以太坊采用 account-based ledger（基于账户的账本）模式，在这种模式中，系统需要显式地记录每个账户有多少币，查询更方便（不需要说明币的来源），但是隐私保护性不如比特币</p>\n<h2 id=\"三、Block-Example\"><a href=\"#三、Block-Example\" class=\"headerlink\" title=\"三、Block Example\"></a>三、Block Example</h2><p>Block header 的详细字段：<a class=\"link\"   href=\"https://developer.bitcoin.org/reference/block_chain.html\" >https://developer.bitcoin.org/reference/block_chain.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p>其中，nonce 和 merkle root hash 是可以改变的，通过改变 coinbase message 来改变 merkle root hash（coinbase message 可以看做 extra nonce）</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/34/2.png\"\n                      alt=\"图3\"\n                ></p>\n<p>在比特币的 POW（Power of work，工作量证明机制）中，矿工需要不断尝试不同的 nonce 和 coinbase message 组合，以找到一个满足目标哈希值的区块头，共有两层循环：</p>\n<p>外层循环调整 coinbase 域 的 extra nonce，算出 block header 里的根哈希值之后，内层循环再调整 header 里的 nonce</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/34/3.png\"\n                      alt=\"图3\"\n                ></p>\n<p>在比特币系统中，验证交易的合法性，就是通过将交易的 input scripts 和 output scripts 配对后执行来完成的。注意：不是把同一个交易的输入脚本和输入脚本配对，而是把这个交易里的输入脚本 和 前一个提供币来源的交易里的输出脚本配对。如果拼接在一起可以顺利执行，那么该交易就是合法的</p>\n<h2 id=\"四、挖矿概率分析\"><a href=\"#四、挖矿概率分析\" class=\"headerlink\" title=\"四、挖矿概率分析\"></a>四、挖矿概率分析</h2><p>Bernoulli trial（伯努利试验）：A random experiment with binary outcome，比如：掷硬币</p>\n<p>Bernoulli process（伯努利过程）：A sequence of independent Bernoulli trials</p>\n<p>Porsson process（泊松过程）：试验次数很多，成功概率很小</p>\n<p>伯努利过程的性质之一是 memoryless（无记忆性）&#x2F; progress free（与过程无关）：前面的实验结果对后面的实验结果无影响。由于挖矿的成功概率很小，所以可以用泊松过程近似</p>\n<p>出块时间服从 Exponential distribution（指数分布），纵轴是 probability density（概率密度），横轴是 time to next block（出块时间）。注意这是整个系统的出块时间，不是每个具体矿工的出块时间，具体到每一个矿工，出块时间取决于矿工的算力占系统总算力的百分比</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/34/4.png\"\n                      alt=\"图3\"\n                ></p>\n<p>如果不满足 progress free 这个性质，那么算力强的矿工会获得不成比例的优势，比如：A算力是B算力的10倍，但是A获得记账权的概率超过B的10倍。该性质正是挖矿公平性的保证</p>\n<h2 id=\"五、比特币的总量\"><a href=\"#五、比特币的总量\" class=\"headerlink\" title=\"五、比特币的总量\"></a>五、比特币的总量</h2><p>产生的比特币数量构成一个 geometric series（几何序列）：21w * 50 + 21w * 25 + 21w* 12.5 + … &#x3D; 21w * 50 * (1 + 1&#x2F;2 + 1&#x2F;4 + …) &#x3D; 2100w</p>\n<p>挖矿的过程对于维护比特币系统的安全性是至关重要的：Bitcoin is secured by mining，对于一个去中心化的系统，挖矿提供了一个凭借算力投票的有效手段，只要大部分算力掌握在诚实的节点手里，系统的安全性就能得到保证</p>\n<h2 id=\"六、比特币的安全性\"><a href=\"#六、比特币的安全性\" class=\"headerlink\" title=\"六、比特币的安全性\"></a>六、比特币的安全性</h2><h3 id=\"1、偷币\"><a href=\"#1、偷币\" class=\"headerlink\" title=\"1、偷币\"></a>1、偷币</h3><p>偷币是不可能的，因为系统以最长链合法链为准，恶意节点产生的区块会变成孤儿区块被丢弃，并且恶意节点还会损失本应得的出块奖励</p>\n<h3 id=\"2、双花攻击\"><a href=\"#2、双花攻击\" class=\"headerlink\" title=\"2、双花攻击\"></a>2、双花攻击</h3><p>可以通过 forking attack（分叉攻击）实现。区块插入的位置在刚开始挖矿的时候就决定，因为设置的 block header 里需要填写前一个区块的哈希值。</p>\n<p>分叉攻击：首先制造等长的合法链，比如，M 向 A 转账交易，产生了不可逆的外部效果（如购买实体商品）；然后再将该交易回滚，留下 M 向自己转账的区块，则 M 可从中不当获利</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/34/5.png\"\n                      alt=\"图3\"\n                ></p>\n<h4 id=\"如何防范分叉攻击？\"><a href=\"#如何防范分叉攻击？\" class=\"headerlink\" title=\"如何防范分叉攻击？\"></a>如何防范分叉攻击？</h4><p>多等几个区块 &#x2F; confirmation（确认），M 向 A 转账的交易刚写入区块的时候，叫 one confirmation，后面的区块类推。比特币协议中缺省的设置是：等待 6 个 confirmation 之后，才认为前面的交易是不可篡改的（大约1小时）</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/34/6.png\"\n                      alt=\"图3\"\n                ></p>\n<p>区块链是 Irrevocable ledger（不可篡改的账本），这种不可篡改性只是一种概率上的保证，刚刚写入区块链的内容还是比较容易被改变的，随着后续 confirmation 的增加，被篡改的概率会指数级大幅度下降</p>\n<p>Zero confirmation：转账交易发布出去了，但是还未被写入区块链中。这种方式在实际应用中比较普遍，因为（1）比特币协议缺省的设置是 节点接收最先听到的那个交易，所以上述例子中 M 转给自己的交易大概率不会被诚实的节点接受；（2）很多购物网站从支付成功到发货天然是有时间间隔的</p>\n<h3 id=\"3、恶意节点故意不把合法交易写入\"><a href=\"#3、恶意节点故意不把合法交易写入\" class=\"headerlink\" title=\"3、恶意节点故意不把合法交易写入\"></a>3、恶意节点故意不把合法交易写入</h3><p>因为总有诚实的节点愿意发布这些交易，所以合法交易总是可以被写到下一个区块里</p>\n<p>在正常工作的情况下，也可能出现合法交易未被包含进去的情况，比如近期交易的数目太多。比特币协议中规定，每个区块的大小是有限制的，最多不能超过一兆字节，如果交易的数目太多，可能就只能等到下一个区块再发布</p>\n<h3 id=\"Selfish-mining（自私挖矿）\"><a href=\"#Selfish-mining（自私挖矿）\" class=\"headerlink\" title=\"Selfish mining（自私挖矿）\"></a>Selfish mining（自私挖矿）</h3><p>正常情况下，挖到一个区块就立即发布，防止别人发布后自己的区块作废、丧失出块奖励</p>\n<p>Selfish mining：挖到多个区块，但是都藏着不发布，攒够6个之后同时发布。这种攻击的前提是，有恶意的节点需要占据很大一部分算力（比如至少51%）</p>\n<p>Selfish mining 的好处：如果个人算力较强，可以减少挖后续区块的竞争</p>\n","site":{"data":{}},"excerpt":"","more":"<p>比特币采用 transaction-based ledger（基于交易的账本）模式，每个区块中记录交易信息（转账交易、铸币交易），系统上不记录交易信息</p>\n<h2 id=\"一、UTXO\"><a href=\"#一、UTXO\" class=\"headerlink\" title=\"一、UTXO\"></a>一、UTXO</h2><p>比特币的全节点要维护一个数据结构 UTXO（Unspent Transaction Output，所有未被花出去的交易的输出 组成的集合）</p>\n<p>一个交易可能有多个输出，即用户可以在一次交易中同时向多人转账（可以节省手续费）</p>\n<p>比如：A 给 B 交易 5 BTC，B 将其交易出去；A 给 C 交易 3 BTC，但未交易出去。这是两个输出，但是只有 A 给 C 的交易在 UTXO 中</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/34/1.png\"\n                      alt=\"图1\"\n                ></p>\n<p>UTXO 中的每个元素要给出产生这个输出的交易的哈希值（可理解为交易的ID），以及它在这个交易里是第几个输出，这两个信息可以定位一个 UTXO 中的输出</p>\n<h3 id=\"UTXO-的用途：\"><a href=\"#UTXO-的用途：\" class=\"headerlink\" title=\"UTXO 的用途：\"></a>UTXO 的用途：</h3><p>在交易发生前，检查即将花出去的币是否在 UTXO 中，在才是合法的，快速校验双花攻击和凭空捏造</p>\n<p>每笔交易会消耗掉 UTXO 中的一些输出，同时在 UTXO 中产生新的输出，total inputs &#x3D; total outputs（所有输入的金额 等于 所有输出的金额）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">total inputs ≈ total outputs</span><br><span class=\"line\">    1 BTC         0.99 BTC</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Transaction-fee（交易费）：\"><a href=\"#Transaction-fee（交易费）：\" class=\"headerlink\" title=\"Transaction fee（交易费）：\"></a>Transaction fee（交易费）：</h3><p>发布区块的节点（矿工）之所以会把他人的交易打包到新区块里，是因为 BTC 系统的第二个激励机制——交易费。通过把他人的交易打包到区块里，矿工会收取一些交易费（费用高的交易优先级就更高）</p>\n<p>目前矿工挖矿、争夺记账权，主要目的还是为了获取出块奖励，但是随着出块奖励的减少；多年后，交易费可能会变成矿工的主要收益</p>\n<h2 id=\"二、Account-based-ledger（基于账户的账本）\"><a href=\"#二、Account-based-ledger（基于账户的账本）\" class=\"headerlink\" title=\"二、Account-based ledger（基于账户的账本）\"></a>二、Account-based ledger（基于账户的账本）</h2><p>和比特币 transaction-based ledger（基于交易的账本）模式不同，以太坊采用 account-based ledger（基于账户的账本）模式，在这种模式中，系统需要显式地记录每个账户有多少币，查询更方便（不需要说明币的来源），但是隐私保护性不如比特币</p>\n<h2 id=\"三、Block-Example\"><a href=\"#三、Block-Example\" class=\"headerlink\" title=\"三、Block Example\"></a>三、Block Example</h2><p>Block header 的详细字段：<a class=\"link\"   href=\"https://developer.bitcoin.org/reference/block_chain.html\" >https://developer.bitcoin.org/reference/block_chain.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p>其中，nonce 和 merkle root hash 是可以改变的，通过改变 coinbase message 来改变 merkle root hash（coinbase message 可以看做 extra nonce）</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/34/2.png\"\n                      alt=\"图3\"\n                ></p>\n<p>在比特币的 POW（Power of work，工作量证明机制）中，矿工需要不断尝试不同的 nonce 和 coinbase message 组合，以找到一个满足目标哈希值的区块头，共有两层循环：</p>\n<p>外层循环调整 coinbase 域 的 extra nonce，算出 block header 里的根哈希值之后，内层循环再调整 header 里的 nonce</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/34/3.png\"\n                      alt=\"图3\"\n                ></p>\n<p>在比特币系统中，验证交易的合法性，就是通过将交易的 input scripts 和 output scripts 配对后执行来完成的。注意：不是把同一个交易的输入脚本和输入脚本配对，而是把这个交易里的输入脚本 和 前一个提供币来源的交易里的输出脚本配对。如果拼接在一起可以顺利执行，那么该交易就是合法的</p>\n<h2 id=\"四、挖矿概率分析\"><a href=\"#四、挖矿概率分析\" class=\"headerlink\" title=\"四、挖矿概率分析\"></a>四、挖矿概率分析</h2><p>Bernoulli trial（伯努利试验）：A random experiment with binary outcome，比如：掷硬币</p>\n<p>Bernoulli process（伯努利过程）：A sequence of independent Bernoulli trials</p>\n<p>Porsson process（泊松过程）：试验次数很多，成功概率很小</p>\n<p>伯努利过程的性质之一是 memoryless（无记忆性）&#x2F; progress free（与过程无关）：前面的实验结果对后面的实验结果无影响。由于挖矿的成功概率很小，所以可以用泊松过程近似</p>\n<p>出块时间服从 Exponential distribution（指数分布），纵轴是 probability density（概率密度），横轴是 time to next block（出块时间）。注意这是整个系统的出块时间，不是每个具体矿工的出块时间，具体到每一个矿工，出块时间取决于矿工的算力占系统总算力的百分比</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/34/4.png\"\n                      alt=\"图3\"\n                ></p>\n<p>如果不满足 progress free 这个性质，那么算力强的矿工会获得不成比例的优势，比如：A算力是B算力的10倍，但是A获得记账权的概率超过B的10倍。该性质正是挖矿公平性的保证</p>\n<h2 id=\"五、比特币的总量\"><a href=\"#五、比特币的总量\" class=\"headerlink\" title=\"五、比特币的总量\"></a>五、比特币的总量</h2><p>产生的比特币数量构成一个 geometric series（几何序列）：21w * 50 + 21w * 25 + 21w* 12.5 + … &#x3D; 21w * 50 * (1 + 1&#x2F;2 + 1&#x2F;4 + …) &#x3D; 2100w</p>\n<p>挖矿的过程对于维护比特币系统的安全性是至关重要的：Bitcoin is secured by mining，对于一个去中心化的系统，挖矿提供了一个凭借算力投票的有效手段，只要大部分算力掌握在诚实的节点手里，系统的安全性就能得到保证</p>\n<h2 id=\"六、比特币的安全性\"><a href=\"#六、比特币的安全性\" class=\"headerlink\" title=\"六、比特币的安全性\"></a>六、比特币的安全性</h2><h3 id=\"1、偷币\"><a href=\"#1、偷币\" class=\"headerlink\" title=\"1、偷币\"></a>1、偷币</h3><p>偷币是不可能的，因为系统以最长链合法链为准，恶意节点产生的区块会变成孤儿区块被丢弃，并且恶意节点还会损失本应得的出块奖励</p>\n<h3 id=\"2、双花攻击\"><a href=\"#2、双花攻击\" class=\"headerlink\" title=\"2、双花攻击\"></a>2、双花攻击</h3><p>可以通过 forking attack（分叉攻击）实现。区块插入的位置在刚开始挖矿的时候就决定，因为设置的 block header 里需要填写前一个区块的哈希值。</p>\n<p>分叉攻击：首先制造等长的合法链，比如，M 向 A 转账交易，产生了不可逆的外部效果（如购买实体商品）；然后再将该交易回滚，留下 M 向自己转账的区块，则 M 可从中不当获利</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/34/5.png\"\n                      alt=\"图3\"\n                ></p>\n<h4 id=\"如何防范分叉攻击？\"><a href=\"#如何防范分叉攻击？\" class=\"headerlink\" title=\"如何防范分叉攻击？\"></a>如何防范分叉攻击？</h4><p>多等几个区块 &#x2F; confirmation（确认），M 向 A 转账的交易刚写入区块的时候，叫 one confirmation，后面的区块类推。比特币协议中缺省的设置是：等待 6 个 confirmation 之后，才认为前面的交易是不可篡改的（大约1小时）</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/34/6.png\"\n                      alt=\"图3\"\n                ></p>\n<p>区块链是 Irrevocable ledger（不可篡改的账本），这种不可篡改性只是一种概率上的保证，刚刚写入区块链的内容还是比较容易被改变的，随着后续 confirmation 的增加，被篡改的概率会指数级大幅度下降</p>\n<p>Zero confirmation：转账交易发布出去了，但是还未被写入区块链中。这种方式在实际应用中比较普遍，因为（1）比特币协议缺省的设置是 节点接收最先听到的那个交易，所以上述例子中 M 转给自己的交易大概率不会被诚实的节点接受；（2）很多购物网站从支付成功到发货天然是有时间间隔的</p>\n<h3 id=\"3、恶意节点故意不把合法交易写入\"><a href=\"#3、恶意节点故意不把合法交易写入\" class=\"headerlink\" title=\"3、恶意节点故意不把合法交易写入\"></a>3、恶意节点故意不把合法交易写入</h3><p>因为总有诚实的节点愿意发布这些交易，所以合法交易总是可以被写到下一个区块里</p>\n<p>在正常工作的情况下，也可能出现合法交易未被包含进去的情况，比如近期交易的数目太多。比特币协议中规定，每个区块的大小是有限制的，最多不能超过一兆字节，如果交易的数目太多，可能就只能等到下一个区块再发布</p>\n<h3 id=\"Selfish-mining（自私挖矿）\"><a href=\"#Selfish-mining（自私挖矿）\" class=\"headerlink\" title=\"Selfish mining（自私挖矿）\"></a>Selfish mining（自私挖矿）</h3><p>正常情况下，挖到一个区块就立即发布，防止别人发布后自己的区块作废、丧失出块奖励</p>\n<p>Selfish mining：挖到多个区块，但是都藏着不发布，攒够6个之后同时发布。这种攻击的前提是，有恶意的节点需要占据很大一部分算力（比如至少51%）</p>\n<p>Selfish mining 的好处：如果个人算力较强，可以减少挖后续区块的竞争</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用6-BTC网络","date":"2025-01-13T10:08:45.000Z","_content":"\n## 一、网络层级\n\n顶层是 application layer，运行着 BitCoin 和 Block chain 协议；底层是 network layer，运行着 P2P Overlay Network\n\n比特币的 P2P 网络很简单，所有节点都是平等的，不像有的网络有 super node / master node\n\n## 二、加入/离开网络\n\n加入网络前，需要和 seed node（种子节点）联系，它会告知网络中的其他节点，节点之间通过 PCP 通信，有利于穿透防火墙；离开时不需要做任何操作，只需退出应用程序，其他节点会将一段时间未接收到消息的节点删除\n\n比特币网络设计的原则是：simple, robust, but not efficient（简单、鲁棒，而不是高效）\n\n## 三、等待上链的集合\n\n每个节点维护一个邻居节点的集合，消息传播在网络中采取 flooding（泛洪）的方式。节点第一次听到某个消息的时候，把它传播给其他所有的邻居节点，并记录已收到该消息，下次再收到时就不会再次转发。邻居节点的选取是随机的，不考虑底层的拓扑结构，这样设计可以增强鲁棒性，但牺牲了效率\n\n比特币系统中，每个节点需要维护一个等待上链（写入区块链）的集合。第一次听到某个交易的时候，把交易加入该集合，并把该交易转发给邻居节点，下次就不再转发。转发的前提是交易是合法的：签名合法，之前未被花过\n\n如果同时有两个冲突的交易被广播到网络上，比如：A 转钱给 B，A 又转钱给 C（双花），以首先被写入到区块链上的交易为准，交易被写入到区块链中即被等待上链的集合删除\n\n## 四、Best effort\n\n比特币网络的传播属于 best effort（尽最大努力），一个交易发送到比特币网络上，不一定所有节点能收到，且顺序也不一定，节点也不一定按照规则传播\n","source":"_posts/35-北大区块链-BTC网络.md","raw":"---\ntitle: 北大-区块链技术与应用6-BTC网络\ndate: 2025-01-13 18:08:45\ntags:\n    - web3\n    - BTC\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n## 一、网络层级\n\n顶层是 application layer，运行着 BitCoin 和 Block chain 协议；底层是 network layer，运行着 P2P Overlay Network\n\n比特币的 P2P 网络很简单，所有节点都是平等的，不像有的网络有 super node / master node\n\n## 二、加入/离开网络\n\n加入网络前，需要和 seed node（种子节点）联系，它会告知网络中的其他节点，节点之间通过 PCP 通信，有利于穿透防火墙；离开时不需要做任何操作，只需退出应用程序，其他节点会将一段时间未接收到消息的节点删除\n\n比特币网络设计的原则是：simple, robust, but not efficient（简单、鲁棒，而不是高效）\n\n## 三、等待上链的集合\n\n每个节点维护一个邻居节点的集合，消息传播在网络中采取 flooding（泛洪）的方式。节点第一次听到某个消息的时候，把它传播给其他所有的邻居节点，并记录已收到该消息，下次再收到时就不会再次转发。邻居节点的选取是随机的，不考虑底层的拓扑结构，这样设计可以增强鲁棒性，但牺牲了效率\n\n比特币系统中，每个节点需要维护一个等待上链（写入区块链）的集合。第一次听到某个交易的时候，把交易加入该集合，并把该交易转发给邻居节点，下次就不再转发。转发的前提是交易是合法的：签名合法，之前未被花过\n\n如果同时有两个冲突的交易被广播到网络上，比如：A 转钱给 B，A 又转钱给 C（双花），以首先被写入到区块链上的交易为准，交易被写入到区块链中即被等待上链的集合删除\n\n## 四、Best effort\n\n比特币网络的传播属于 best effort（尽最大努力），一个交易发送到比特币网络上，不一定所有节点能收到，且顺序也不一定，节点也不一定按照规则传播\n","slug":"35-北大区块链-BTC网络","published":1,"updated":"2025-05-20T02:47:28.684Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvua002l6kprd7zrdxel","content":"<h2 id=\"一、网络层级\"><a href=\"#一、网络层级\" class=\"headerlink\" title=\"一、网络层级\"></a>一、网络层级</h2><p>顶层是 application layer，运行着 BitCoin 和 Block chain 协议；底层是 network layer，运行着 P2P Overlay Network</p>\n<p>比特币的 P2P 网络很简单，所有节点都是平等的，不像有的网络有 super node &#x2F; master node</p>\n<h2 id=\"二、加入-离开网络\"><a href=\"#二、加入-离开网络\" class=\"headerlink\" title=\"二、加入&#x2F;离开网络\"></a>二、加入&#x2F;离开网络</h2><p>加入网络前，需要和 seed node（种子节点）联系，它会告知网络中的其他节点，节点之间通过 PCP 通信，有利于穿透防火墙；离开时不需要做任何操作，只需退出应用程序，其他节点会将一段时间未接收到消息的节点删除</p>\n<p>比特币网络设计的原则是：simple, robust, but not efficient（简单、鲁棒，而不是高效）</p>\n<h2 id=\"三、等待上链的集合\"><a href=\"#三、等待上链的集合\" class=\"headerlink\" title=\"三、等待上链的集合\"></a>三、等待上链的集合</h2><p>每个节点维护一个邻居节点的集合，消息传播在网络中采取 flooding（泛洪）的方式。节点第一次听到某个消息的时候，把它传播给其他所有的邻居节点，并记录已收到该消息，下次再收到时就不会再次转发。邻居节点的选取是随机的，不考虑底层的拓扑结构，这样设计可以增强鲁棒性，但牺牲了效率</p>\n<p>比特币系统中，每个节点需要维护一个等待上链（写入区块链）的集合。第一次听到某个交易的时候，把交易加入该集合，并把该交易转发给邻居节点，下次就不再转发。转发的前提是交易是合法的：签名合法，之前未被花过</p>\n<p>如果同时有两个冲突的交易被广播到网络上，比如：A 转钱给 B，A 又转钱给 C（双花），以首先被写入到区块链上的交易为准，交易被写入到区块链中即被等待上链的集合删除</p>\n<h2 id=\"四、Best-effort\"><a href=\"#四、Best-effort\" class=\"headerlink\" title=\"四、Best effort\"></a>四、Best effort</h2><p>比特币网络的传播属于 best effort（尽最大努力），一个交易发送到比特币网络上，不一定所有节点能收到，且顺序也不一定，节点也不一定按照规则传播</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、网络层级\"><a href=\"#一、网络层级\" class=\"headerlink\" title=\"一、网络层级\"></a>一、网络层级</h2><p>顶层是 application layer，运行着 BitCoin 和 Block chain 协议；底层是 network layer，运行着 P2P Overlay Network</p>\n<p>比特币的 P2P 网络很简单，所有节点都是平等的，不像有的网络有 super node &#x2F; master node</p>\n<h2 id=\"二、加入-离开网络\"><a href=\"#二、加入-离开网络\" class=\"headerlink\" title=\"二、加入&#x2F;离开网络\"></a>二、加入&#x2F;离开网络</h2><p>加入网络前，需要和 seed node（种子节点）联系，它会告知网络中的其他节点，节点之间通过 PCP 通信，有利于穿透防火墙；离开时不需要做任何操作，只需退出应用程序，其他节点会将一段时间未接收到消息的节点删除</p>\n<p>比特币网络设计的原则是：simple, robust, but not efficient（简单、鲁棒，而不是高效）</p>\n<h2 id=\"三、等待上链的集合\"><a href=\"#三、等待上链的集合\" class=\"headerlink\" title=\"三、等待上链的集合\"></a>三、等待上链的集合</h2><p>每个节点维护一个邻居节点的集合，消息传播在网络中采取 flooding（泛洪）的方式。节点第一次听到某个消息的时候，把它传播给其他所有的邻居节点，并记录已收到该消息，下次再收到时就不会再次转发。邻居节点的选取是随机的，不考虑底层的拓扑结构，这样设计可以增强鲁棒性，但牺牲了效率</p>\n<p>比特币系统中，每个节点需要维护一个等待上链（写入区块链）的集合。第一次听到某个交易的时候，把交易加入该集合，并把该交易转发给邻居节点，下次就不再转发。转发的前提是交易是合法的：签名合法，之前未被花过</p>\n<p>如果同时有两个冲突的交易被广播到网络上，比如：A 转钱给 B，A 又转钱给 C（双花），以首先被写入到区块链上的交易为准，交易被写入到区块链中即被等待上链的集合删除</p>\n<h2 id=\"四、Best-effort\"><a href=\"#四、Best-effort\" class=\"headerlink\" title=\"四、Best effort\"></a>四、Best effort</h2><p>比特币网络的传播属于 best effort（尽最大努力），一个交易发送到比特币网络上，不一定所有节点能收到，且顺序也不一定，节点也不一定按照规则传播</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用7-挖矿难度","date":"2025-01-13T12:58:43.000Z","_content":"\n## 一、挖矿难度和目标域值\n\nH(block header) ≤ target\n\n调整挖矿难度，就是调整目标空间 在整个输出空间中所占的比例，通俗地说，就是哈希值的前面有多少 0\n\n比特币使用的哈希算法是 SHA-256，整个输出空间是 2^256 个可能的取值\n\n挖矿难度和目标域值成反比：\n\n![图1](../images/36/1.png)\n\ndifficulty_1_target：挖矿难度等于1时，对应的目标域值（挖矿难度最小就是1），此时的目标域值很大\n\n## 二、出块时间太短的后果\n\n系统的总算力越强，安全性就越高，因为发动 51% attack（考虑2个分叉）的成本就更高\n\n出块时间太短，但是传播速度较慢，很容易导致过多的 forking（分叉），系统的总算力就被分散了，更容易造成 forking attack，因为可以通过较小的算力（100%/分叉数+1%）实现攻击\n\n以太坊的出块时间是15s，出块速度是比特币的40倍，因此以太坊设计了新的共识协议 ghost，其中产生的 orphan block 就不能简单的丢弃，而是要给一些奖励（uncle reward）\n\n## 三、调整挖矿难度\n\n比特币协议规定每个2016个区块，需要调整目标域值，`2016*10/(60*24)≈14天`\n\n调整目标域值的公式：\n\n![图2](../images/36/2.png)\n\n其中，expected time（预期时间）是 2016*10，actual time（实际时间）是系统近期产生2016个区块所花费的时间。在实际代码中，上调和下调分别有4倍和1/4的限度\n\n### 如何让所有的矿工同时调整域值？\n\nblock header 中存储的 nBits 是目标域值编码的版本（将 target 的256字节 压缩到4字节）。如果有矿工不调整，那么校验就不会被通过\n","source":"_posts/36-北大区块链-挖矿难度.md","raw":"---\ntitle: 北大-区块链技术与应用7-挖矿难度\ndate: 2025-01-13 20:58:43\ntags:\n    - web3\n    - BTC\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n## 一、挖矿难度和目标域值\n\nH(block header) ≤ target\n\n调整挖矿难度，就是调整目标空间 在整个输出空间中所占的比例，通俗地说，就是哈希值的前面有多少 0\n\n比特币使用的哈希算法是 SHA-256，整个输出空间是 2^256 个可能的取值\n\n挖矿难度和目标域值成反比：\n\n![图1](../images/36/1.png)\n\ndifficulty_1_target：挖矿难度等于1时，对应的目标域值（挖矿难度最小就是1），此时的目标域值很大\n\n## 二、出块时间太短的后果\n\n系统的总算力越强，安全性就越高，因为发动 51% attack（考虑2个分叉）的成本就更高\n\n出块时间太短，但是传播速度较慢，很容易导致过多的 forking（分叉），系统的总算力就被分散了，更容易造成 forking attack，因为可以通过较小的算力（100%/分叉数+1%）实现攻击\n\n以太坊的出块时间是15s，出块速度是比特币的40倍，因此以太坊设计了新的共识协议 ghost，其中产生的 orphan block 就不能简单的丢弃，而是要给一些奖励（uncle reward）\n\n## 三、调整挖矿难度\n\n比特币协议规定每个2016个区块，需要调整目标域值，`2016*10/(60*24)≈14天`\n\n调整目标域值的公式：\n\n![图2](../images/36/2.png)\n\n其中，expected time（预期时间）是 2016*10，actual time（实际时间）是系统近期产生2016个区块所花费的时间。在实际代码中，上调和下调分别有4倍和1/4的限度\n\n### 如何让所有的矿工同时调整域值？\n\nblock header 中存储的 nBits 是目标域值编码的版本（将 target 的256字节 压缩到4字节）。如果有矿工不调整，那么校验就不会被通过\n","slug":"36-北大区块链-挖矿难度","published":1,"updated":"2025-05-20T02:47:28.684Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvub002o6kpr3c02cmwh","content":"<h2 id=\"一、挖矿难度和目标域值\"><a href=\"#一、挖矿难度和目标域值\" class=\"headerlink\" title=\"一、挖矿难度和目标域值\"></a>一、挖矿难度和目标域值</h2><p>H(block header) ≤ target</p>\n<p>调整挖矿难度，就是调整目标空间 在整个输出空间中所占的比例，通俗地说，就是哈希值的前面有多少 0</p>\n<p>比特币使用的哈希算法是 SHA-256，整个输出空间是 2^256 个可能的取值</p>\n<p>挖矿难度和目标域值成反比：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/36/1.png\"\n                      alt=\"图1\"\n                ></p>\n<p>difficulty_1_target：挖矿难度等于1时，对应的目标域值（挖矿难度最小就是1），此时的目标域值很大</p>\n<h2 id=\"二、出块时间太短的后果\"><a href=\"#二、出块时间太短的后果\" class=\"headerlink\" title=\"二、出块时间太短的后果\"></a>二、出块时间太短的后果</h2><p>系统的总算力越强，安全性就越高，因为发动 51% attack（考虑2个分叉）的成本就更高</p>\n<p>出块时间太短，但是传播速度较慢，很容易导致过多的 forking（分叉），系统的总算力就被分散了，更容易造成 forking attack，因为可以通过较小的算力（100%&#x2F;分叉数+1%）实现攻击</p>\n<p>以太坊的出块时间是15s，出块速度是比特币的40倍，因此以太坊设计了新的共识协议 ghost，其中产生的 orphan block 就不能简单的丢弃，而是要给一些奖励（uncle reward）</p>\n<h2 id=\"三、调整挖矿难度\"><a href=\"#三、调整挖矿难度\" class=\"headerlink\" title=\"三、调整挖矿难度\"></a>三、调整挖矿难度</h2><p>比特币协议规定每个2016个区块，需要调整目标域值，<code>2016*10/(60*24)≈14天</code></p>\n<p>调整目标域值的公式：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/36/2.png\"\n                      alt=\"图2\"\n                ></p>\n<p>其中，expected time（预期时间）是 2016*10，actual time（实际时间）是系统近期产生2016个区块所花费的时间。在实际代码中，上调和下调分别有4倍和1&#x2F;4的限度</p>\n<h3 id=\"如何让所有的矿工同时调整域值？\"><a href=\"#如何让所有的矿工同时调整域值？\" class=\"headerlink\" title=\"如何让所有的矿工同时调整域值？\"></a>如何让所有的矿工同时调整域值？</h3><p>block header 中存储的 nBits 是目标域值编码的版本（将 target 的256字节 压缩到4字节）。如果有矿工不调整，那么校验就不会被通过</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、挖矿难度和目标域值\"><a href=\"#一、挖矿难度和目标域值\" class=\"headerlink\" title=\"一、挖矿难度和目标域值\"></a>一、挖矿难度和目标域值</h2><p>H(block header) ≤ target</p>\n<p>调整挖矿难度，就是调整目标空间 在整个输出空间中所占的比例，通俗地说，就是哈希值的前面有多少 0</p>\n<p>比特币使用的哈希算法是 SHA-256，整个输出空间是 2^256 个可能的取值</p>\n<p>挖矿难度和目标域值成反比：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/36/1.png\"\n                      alt=\"图1\"\n                ></p>\n<p>difficulty_1_target：挖矿难度等于1时，对应的目标域值（挖矿难度最小就是1），此时的目标域值很大</p>\n<h2 id=\"二、出块时间太短的后果\"><a href=\"#二、出块时间太短的后果\" class=\"headerlink\" title=\"二、出块时间太短的后果\"></a>二、出块时间太短的后果</h2><p>系统的总算力越强，安全性就越高，因为发动 51% attack（考虑2个分叉）的成本就更高</p>\n<p>出块时间太短，但是传播速度较慢，很容易导致过多的 forking（分叉），系统的总算力就被分散了，更容易造成 forking attack，因为可以通过较小的算力（100%&#x2F;分叉数+1%）实现攻击</p>\n<p>以太坊的出块时间是15s，出块速度是比特币的40倍，因此以太坊设计了新的共识协议 ghost，其中产生的 orphan block 就不能简单的丢弃，而是要给一些奖励（uncle reward）</p>\n<h2 id=\"三、调整挖矿难度\"><a href=\"#三、调整挖矿难度\" class=\"headerlink\" title=\"三、调整挖矿难度\"></a>三、调整挖矿难度</h2><p>比特币协议规定每个2016个区块，需要调整目标域值，<code>2016*10/(60*24)≈14天</code></p>\n<p>调整目标域值的公式：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/36/2.png\"\n                      alt=\"图2\"\n                ></p>\n<p>其中，expected time（预期时间）是 2016*10，actual time（实际时间）是系统近期产生2016个区块所花费的时间。在实际代码中，上调和下调分别有4倍和1&#x2F;4的限度</p>\n<h3 id=\"如何让所有的矿工同时调整域值？\"><a href=\"#如何让所有的矿工同时调整域值？\" class=\"headerlink\" title=\"如何让所有的矿工同时调整域值？\"></a>如何让所有的矿工同时调整域值？</h3><p>block header 中存储的 nBits 是目标域值编码的版本（将 target 的256字节 压缩到4字节）。如果有矿工不调整，那么校验就不会被通过</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用8-BTC挖矿","date":"2025-01-13T15:47:49.000Z","_content":"\n## 一、全节点\n\n### 1、一直在线\n\n### 2、在本地硬盘上维护完整的区块链信息\n\n### 3、在内存里维护 UTXO 集合，以便快速检验交易的正确性\n\nUTXO（unspent transaction output）\n\n### 4、监听比特币网络上的交易信息，验证每个交易的合法性\n\n（1）是否有合法的签名\n\n（2）是不是 double spending\n\n### 5、决定哪些交易会被打包到区块里\n\n缺省状态下，只要是合法交易、并且交易费符合要求，就会被打包\n\n### 6、 监听别的矿工挖出来的区块，验证其合法性\n\n（1）区块中的每个交易都要合法，包括铸币交易，比如是否篡改了出块奖励、发布的难度是否符合要求（block header 取哈希后，前面是否有足够多的 0；block header 里的难度目标域值是否设置正确）\n\n（2）全节点是否每两周调整挖矿难度\n\n（3）检查该区块是否在延伸最长合法链\n\n### 7、挖矿\n\n#### （1）决定沿着哪条链挖下去？\n\n缺省情况下沿着最长合法链挖下去\n\n#### （2）当出现等长的分叉的时候，选择哪一个分叉？\n\n缺省情况下选择最先听到的分叉\n\n## 二、轻节点\n\n轻节点也叫做 spv client（simplified payment verification）\n\n### 1、不是一直在线\n\n### 2、不用保存整个区块链，只要保存每个区块的块头\n\n大约是全节点的 1/1000\n\n### 3、不用保存全部交易，只保存与自己相关的交易\n\n### 4、无法检验大多数交易的合法性，只能检验与自己相关 的那些交易的合法性\n\n### 5、无法检测网上发布的区块的正确性\n\n### 6、可以验证挖矿的难度\n\n因为挖矿的时候，计算哈希值只用到了块头的信息\n\n### 7、只能检测哪个是最长链，不知道哪个是最长合法链\n\n因为无法检测这条链上所包含的交易都是合法的（不过可以检测每个区块是否符合难度要求）\n\n## 三、挖矿的注意事项\n\n比特币网络中大部分节点都是轻节点，如果只想进行转账，而不进行挖矿，就不需要运行全节点、只需使用轻节点\n\n在挖矿过程中，如果监听到别人发布了一个区块，需要重新组装区块（block header 和 交易内容都有变化）、重新开始挖\n\n## 四、比特币的安全性保证\n\n### 1、密码学\n\n恶意节点拿不到私钥，就无法伪造签名，也就无法偷币\n\n### 2、好节点占大部分算力\n\n前提是系统中大部分算力的矿工是遵守协议的\n\n## 五、挖矿趋势一：设备从通用到专用\n\n### 1、CPU\n\n最早是用普通的 CPU / 通用计算机 挖矿，但是这种方式无法充分利用内存\n\n### 2、GPU\n\nGPU 用于大规模的并行计算，比如深度学习大量的矩阵乘法，但也部分部件也无法充分利用（比如浮点数运算）\n\n### 3、ASIC 芯片\n\nASIC（Application Specific Integrated Circuit，专用集成电路），ASIC 芯片是专门为比特币挖矿计算哈希值而设计，性价比最高\n\n但是同一个芯片只能用于一种币的挖矿，除非两种币使用同一个 mining puzzle。有些新开发的币会使用已有币的 mining puzzle，进而吸引更多矿工，这叫做 merge mining\n\n购买 ASIC 矿机的时机很重要，因为过时得很快，现在一般需要提前预定。不良厂商可能会在矿机生产后的黄金两个月先自己挖矿，然后才卖给用户\n\n有些新型货币，设计的是 alternative mining puzzle，出发点是 ASIC resistance，目的是让通用计算机也能参与挖矿过程\n\n## 六、挖矿趋势二：大型矿池的出现\n\n矿池的出现是为了解决单个矿工收入不稳定的问题。矿池把矿工组织起来作为一个整体，其架构是：一个全节点驱动多个矿机\n\n一个矿池一般有一个 pool manager（矿主），下面连着很多 minner（矿工），矿工只负责通过 ASIC 芯片计算哈希值，全节点的其他职责都由矿主承担（比如监听网络上的交易，并将其打包成一个候选区块，同时监听是否有其他节点抢先发布区块）\n\n### 矿池的收益分配\n\n矿池一般有两种组织形式：\n\n（1）类似大型数据中心，所有矿机属于同一个机构\n\n（2）分布式的，矿工和矿主不在同一个地方，矿工加入矿池，是通过矿池规定的通讯协议和矿主进行联系。矿主把要计算的哈希值的任务分配给矿工，矿工计算完成后把结果返回给矿主，有出块奖励时一起参与分红\n\n通过工作量证明，按照矿工的贡献大小分配收益：降低挖矿难度（减少目标域值前0的数量），符合条件的叫一个 share（almost valid block），挖到合法区块、得到出块奖励之后，矿主按照矿工 share 的数量来分配收益\n\n### 1、矿工是否能偷出块奖励？\n\n矿工不可能挖到一个合法区块自己偷偷发布，因为矿工的任务由矿主分配，矿主负责组装区块，并把不同的 coinbase parameter 所对应的 nonce，交给不同的矿工尝试，而 coinbase transaction 里的收款人地址填的是矿主的地址\n\n### 2、矿工是否能捣乱？\n\n是可以的，比如 矿工正常提交 share，但是挖到合法区块之后就丢弃掉\n\n### 3、矿池的弊端\n\n恶意方可能吸引到足够多的矿工（不明真相的群众）加入，然后发动 51% attack：\n\n（1）Forking attack：制造分叉，因为算力高，迟早能赶超6个区块；\n\n（2）Boycott：制裁对象一挖出区块，就分叉，因为算力高，更容易使制裁对象的区块作废\n\n类似于云计算中的 on demand computing，平时不用自己去维护很大的计算集群，需要用的时候可以随时召唤，对于矿池来说就是 on demand mining\n","source":"_posts/37-北大区块链-BTC挖矿.md","raw":"---\ntitle: 北大-区块链技术与应用8-BTC挖矿\ndate: 2025-01-13 23:47:49\ntags:\n    - web3\n    - BTC\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n## 一、全节点\n\n### 1、一直在线\n\n### 2、在本地硬盘上维护完整的区块链信息\n\n### 3、在内存里维护 UTXO 集合，以便快速检验交易的正确性\n\nUTXO（unspent transaction output）\n\n### 4、监听比特币网络上的交易信息，验证每个交易的合法性\n\n（1）是否有合法的签名\n\n（2）是不是 double spending\n\n### 5、决定哪些交易会被打包到区块里\n\n缺省状态下，只要是合法交易、并且交易费符合要求，就会被打包\n\n### 6、 监听别的矿工挖出来的区块，验证其合法性\n\n（1）区块中的每个交易都要合法，包括铸币交易，比如是否篡改了出块奖励、发布的难度是否符合要求（block header 取哈希后，前面是否有足够多的 0；block header 里的难度目标域值是否设置正确）\n\n（2）全节点是否每两周调整挖矿难度\n\n（3）检查该区块是否在延伸最长合法链\n\n### 7、挖矿\n\n#### （1）决定沿着哪条链挖下去？\n\n缺省情况下沿着最长合法链挖下去\n\n#### （2）当出现等长的分叉的时候，选择哪一个分叉？\n\n缺省情况下选择最先听到的分叉\n\n## 二、轻节点\n\n轻节点也叫做 spv client（simplified payment verification）\n\n### 1、不是一直在线\n\n### 2、不用保存整个区块链，只要保存每个区块的块头\n\n大约是全节点的 1/1000\n\n### 3、不用保存全部交易，只保存与自己相关的交易\n\n### 4、无法检验大多数交易的合法性，只能检验与自己相关 的那些交易的合法性\n\n### 5、无法检测网上发布的区块的正确性\n\n### 6、可以验证挖矿的难度\n\n因为挖矿的时候，计算哈希值只用到了块头的信息\n\n### 7、只能检测哪个是最长链，不知道哪个是最长合法链\n\n因为无法检测这条链上所包含的交易都是合法的（不过可以检测每个区块是否符合难度要求）\n\n## 三、挖矿的注意事项\n\n比特币网络中大部分节点都是轻节点，如果只想进行转账，而不进行挖矿，就不需要运行全节点、只需使用轻节点\n\n在挖矿过程中，如果监听到别人发布了一个区块，需要重新组装区块（block header 和 交易内容都有变化）、重新开始挖\n\n## 四、比特币的安全性保证\n\n### 1、密码学\n\n恶意节点拿不到私钥，就无法伪造签名，也就无法偷币\n\n### 2、好节点占大部分算力\n\n前提是系统中大部分算力的矿工是遵守协议的\n\n## 五、挖矿趋势一：设备从通用到专用\n\n### 1、CPU\n\n最早是用普通的 CPU / 通用计算机 挖矿，但是这种方式无法充分利用内存\n\n### 2、GPU\n\nGPU 用于大规模的并行计算，比如深度学习大量的矩阵乘法，但也部分部件也无法充分利用（比如浮点数运算）\n\n### 3、ASIC 芯片\n\nASIC（Application Specific Integrated Circuit，专用集成电路），ASIC 芯片是专门为比特币挖矿计算哈希值而设计，性价比最高\n\n但是同一个芯片只能用于一种币的挖矿，除非两种币使用同一个 mining puzzle。有些新开发的币会使用已有币的 mining puzzle，进而吸引更多矿工，这叫做 merge mining\n\n购买 ASIC 矿机的时机很重要，因为过时得很快，现在一般需要提前预定。不良厂商可能会在矿机生产后的黄金两个月先自己挖矿，然后才卖给用户\n\n有些新型货币，设计的是 alternative mining puzzle，出发点是 ASIC resistance，目的是让通用计算机也能参与挖矿过程\n\n## 六、挖矿趋势二：大型矿池的出现\n\n矿池的出现是为了解决单个矿工收入不稳定的问题。矿池把矿工组织起来作为一个整体，其架构是：一个全节点驱动多个矿机\n\n一个矿池一般有一个 pool manager（矿主），下面连着很多 minner（矿工），矿工只负责通过 ASIC 芯片计算哈希值，全节点的其他职责都由矿主承担（比如监听网络上的交易，并将其打包成一个候选区块，同时监听是否有其他节点抢先发布区块）\n\n### 矿池的收益分配\n\n矿池一般有两种组织形式：\n\n（1）类似大型数据中心，所有矿机属于同一个机构\n\n（2）分布式的，矿工和矿主不在同一个地方，矿工加入矿池，是通过矿池规定的通讯协议和矿主进行联系。矿主把要计算的哈希值的任务分配给矿工，矿工计算完成后把结果返回给矿主，有出块奖励时一起参与分红\n\n通过工作量证明，按照矿工的贡献大小分配收益：降低挖矿难度（减少目标域值前0的数量），符合条件的叫一个 share（almost valid block），挖到合法区块、得到出块奖励之后，矿主按照矿工 share 的数量来分配收益\n\n### 1、矿工是否能偷出块奖励？\n\n矿工不可能挖到一个合法区块自己偷偷发布，因为矿工的任务由矿主分配，矿主负责组装区块，并把不同的 coinbase parameter 所对应的 nonce，交给不同的矿工尝试，而 coinbase transaction 里的收款人地址填的是矿主的地址\n\n### 2、矿工是否能捣乱？\n\n是可以的，比如 矿工正常提交 share，但是挖到合法区块之后就丢弃掉\n\n### 3、矿池的弊端\n\n恶意方可能吸引到足够多的矿工（不明真相的群众）加入，然后发动 51% attack：\n\n（1）Forking attack：制造分叉，因为算力高，迟早能赶超6个区块；\n\n（2）Boycott：制裁对象一挖出区块，就分叉，因为算力高，更容易使制裁对象的区块作废\n\n类似于云计算中的 on demand computing，平时不用自己去维护很大的计算集群，需要用的时候可以随时召唤，对于矿池来说就是 on demand mining\n","slug":"37-北大区块链-BTC挖矿","published":1,"updated":"2025-05-20T02:47:28.684Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvub002r6kpr7gpjbu3f","content":"<h2 id=\"一、全节点\"><a href=\"#一、全节点\" class=\"headerlink\" title=\"一、全节点\"></a>一、全节点</h2><h3 id=\"1、一直在线\"><a href=\"#1、一直在线\" class=\"headerlink\" title=\"1、一直在线\"></a>1、一直在线</h3><h3 id=\"2、在本地硬盘上维护完整的区块链信息\"><a href=\"#2、在本地硬盘上维护完整的区块链信息\" class=\"headerlink\" title=\"2、在本地硬盘上维护完整的区块链信息\"></a>2、在本地硬盘上维护完整的区块链信息</h3><h3 id=\"3、在内存里维护-UTXO-集合，以便快速检验交易的正确性\"><a href=\"#3、在内存里维护-UTXO-集合，以便快速检验交易的正确性\" class=\"headerlink\" title=\"3、在内存里维护 UTXO 集合，以便快速检验交易的正确性\"></a>3、在内存里维护 UTXO 集合，以便快速检验交易的正确性</h3><p>UTXO（unspent transaction output）</p>\n<h3 id=\"4、监听比特币网络上的交易信息，验证每个交易的合法性\"><a href=\"#4、监听比特币网络上的交易信息，验证每个交易的合法性\" class=\"headerlink\" title=\"4、监听比特币网络上的交易信息，验证每个交易的合法性\"></a>4、监听比特币网络上的交易信息，验证每个交易的合法性</h3><p>（1）是否有合法的签名</p>\n<p>（2）是不是 double spending</p>\n<h3 id=\"5、决定哪些交易会被打包到区块里\"><a href=\"#5、决定哪些交易会被打包到区块里\" class=\"headerlink\" title=\"5、决定哪些交易会被打包到区块里\"></a>5、决定哪些交易会被打包到区块里</h3><p>缺省状态下，只要是合法交易、并且交易费符合要求，就会被打包</p>\n<h3 id=\"6、-监听别的矿工挖出来的区块，验证其合法性\"><a href=\"#6、-监听别的矿工挖出来的区块，验证其合法性\" class=\"headerlink\" title=\"6、 监听别的矿工挖出来的区块，验证其合法性\"></a>6、 监听别的矿工挖出来的区块，验证其合法性</h3><p>（1）区块中的每个交易都要合法，包括铸币交易，比如是否篡改了出块奖励、发布的难度是否符合要求（block header 取哈希后，前面是否有足够多的 0；block header 里的难度目标域值是否设置正确）</p>\n<p>（2）全节点是否每两周调整挖矿难度</p>\n<p>（3）检查该区块是否在延伸最长合法链</p>\n<h3 id=\"7、挖矿\"><a href=\"#7、挖矿\" class=\"headerlink\" title=\"7、挖矿\"></a>7、挖矿</h3><h4 id=\"（1）决定沿着哪条链挖下去？\"><a href=\"#（1）决定沿着哪条链挖下去？\" class=\"headerlink\" title=\"（1）决定沿着哪条链挖下去？\"></a>（1）决定沿着哪条链挖下去？</h4><p>缺省情况下沿着最长合法链挖下去</p>\n<h4 id=\"（2）当出现等长的分叉的时候，选择哪一个分叉？\"><a href=\"#（2）当出现等长的分叉的时候，选择哪一个分叉？\" class=\"headerlink\" title=\"（2）当出现等长的分叉的时候，选择哪一个分叉？\"></a>（2）当出现等长的分叉的时候，选择哪一个分叉？</h4><p>缺省情况下选择最先听到的分叉</p>\n<h2 id=\"二、轻节点\"><a href=\"#二、轻节点\" class=\"headerlink\" title=\"二、轻节点\"></a>二、轻节点</h2><p>轻节点也叫做 spv client（simplified payment verification）</p>\n<h3 id=\"1、不是一直在线\"><a href=\"#1、不是一直在线\" class=\"headerlink\" title=\"1、不是一直在线\"></a>1、不是一直在线</h3><h3 id=\"2、不用保存整个区块链，只要保存每个区块的块头\"><a href=\"#2、不用保存整个区块链，只要保存每个区块的块头\" class=\"headerlink\" title=\"2、不用保存整个区块链，只要保存每个区块的块头\"></a>2、不用保存整个区块链，只要保存每个区块的块头</h3><p>大约是全节点的 1&#x2F;1000</p>\n<h3 id=\"3、不用保存全部交易，只保存与自己相关的交易\"><a href=\"#3、不用保存全部交易，只保存与自己相关的交易\" class=\"headerlink\" title=\"3、不用保存全部交易，只保存与自己相关的交易\"></a>3、不用保存全部交易，只保存与自己相关的交易</h3><h3 id=\"4、无法检验大多数交易的合法性，只能检验与自己相关-的那些交易的合法性\"><a href=\"#4、无法检验大多数交易的合法性，只能检验与自己相关-的那些交易的合法性\" class=\"headerlink\" title=\"4、无法检验大多数交易的合法性，只能检验与自己相关 的那些交易的合法性\"></a>4、无法检验大多数交易的合法性，只能检验与自己相关 的那些交易的合法性</h3><h3 id=\"5、无法检测网上发布的区块的正确性\"><a href=\"#5、无法检测网上发布的区块的正确性\" class=\"headerlink\" title=\"5、无法检测网上发布的区块的正确性\"></a>5、无法检测网上发布的区块的正确性</h3><h3 id=\"6、可以验证挖矿的难度\"><a href=\"#6、可以验证挖矿的难度\" class=\"headerlink\" title=\"6、可以验证挖矿的难度\"></a>6、可以验证挖矿的难度</h3><p>因为挖矿的时候，计算哈希值只用到了块头的信息</p>\n<h3 id=\"7、只能检测哪个是最长链，不知道哪个是最长合法链\"><a href=\"#7、只能检测哪个是最长链，不知道哪个是最长合法链\" class=\"headerlink\" title=\"7、只能检测哪个是最长链，不知道哪个是最长合法链\"></a>7、只能检测哪个是最长链，不知道哪个是最长合法链</h3><p>因为无法检测这条链上所包含的交易都是合法的（不过可以检测每个区块是否符合难度要求）</p>\n<h2 id=\"三、挖矿的注意事项\"><a href=\"#三、挖矿的注意事项\" class=\"headerlink\" title=\"三、挖矿的注意事项\"></a>三、挖矿的注意事项</h2><p>比特币网络中大部分节点都是轻节点，如果只想进行转账，而不进行挖矿，就不需要运行全节点、只需使用轻节点</p>\n<p>在挖矿过程中，如果监听到别人发布了一个区块，需要重新组装区块（block header 和 交易内容都有变化）、重新开始挖</p>\n<h2 id=\"四、比特币的安全性保证\"><a href=\"#四、比特币的安全性保证\" class=\"headerlink\" title=\"四、比特币的安全性保证\"></a>四、比特币的安全性保证</h2><h3 id=\"1、密码学\"><a href=\"#1、密码学\" class=\"headerlink\" title=\"1、密码学\"></a>1、密码学</h3><p>恶意节点拿不到私钥，就无法伪造签名，也就无法偷币</p>\n<h3 id=\"2、好节点占大部分算力\"><a href=\"#2、好节点占大部分算力\" class=\"headerlink\" title=\"2、好节点占大部分算力\"></a>2、好节点占大部分算力</h3><p>前提是系统中大部分算力的矿工是遵守协议的</p>\n<h2 id=\"五、挖矿趋势一：设备从通用到专用\"><a href=\"#五、挖矿趋势一：设备从通用到专用\" class=\"headerlink\" title=\"五、挖矿趋势一：设备从通用到专用\"></a>五、挖矿趋势一：设备从通用到专用</h2><h3 id=\"1、CPU\"><a href=\"#1、CPU\" class=\"headerlink\" title=\"1、CPU\"></a>1、CPU</h3><p>最早是用普通的 CPU &#x2F; 通用计算机 挖矿，但是这种方式无法充分利用内存</p>\n<h3 id=\"2、GPU\"><a href=\"#2、GPU\" class=\"headerlink\" title=\"2、GPU\"></a>2、GPU</h3><p>GPU 用于大规模的并行计算，比如深度学习大量的矩阵乘法，但也部分部件也无法充分利用（比如浮点数运算）</p>\n<h3 id=\"3、ASIC-芯片\"><a href=\"#3、ASIC-芯片\" class=\"headerlink\" title=\"3、ASIC 芯片\"></a>3、ASIC 芯片</h3><p>ASIC（Application Specific Integrated Circuit，专用集成电路），ASIC 芯片是专门为比特币挖矿计算哈希值而设计，性价比最高</p>\n<p>但是同一个芯片只能用于一种币的挖矿，除非两种币使用同一个 mining puzzle。有些新开发的币会使用已有币的 mining puzzle，进而吸引更多矿工，这叫做 merge mining</p>\n<p>购买 ASIC 矿机的时机很重要，因为过时得很快，现在一般需要提前预定。不良厂商可能会在矿机生产后的黄金两个月先自己挖矿，然后才卖给用户</p>\n<p>有些新型货币，设计的是 alternative mining puzzle，出发点是 ASIC resistance，目的是让通用计算机也能参与挖矿过程</p>\n<h2 id=\"六、挖矿趋势二：大型矿池的出现\"><a href=\"#六、挖矿趋势二：大型矿池的出现\" class=\"headerlink\" title=\"六、挖矿趋势二：大型矿池的出现\"></a>六、挖矿趋势二：大型矿池的出现</h2><p>矿池的出现是为了解决单个矿工收入不稳定的问题。矿池把矿工组织起来作为一个整体，其架构是：一个全节点驱动多个矿机</p>\n<p>一个矿池一般有一个 pool manager（矿主），下面连着很多 minner（矿工），矿工只负责通过 ASIC 芯片计算哈希值，全节点的其他职责都由矿主承担（比如监听网络上的交易，并将其打包成一个候选区块，同时监听是否有其他节点抢先发布区块）</p>\n<h3 id=\"矿池的收益分配\"><a href=\"#矿池的收益分配\" class=\"headerlink\" title=\"矿池的收益分配\"></a>矿池的收益分配</h3><p>矿池一般有两种组织形式：</p>\n<p>（1）类似大型数据中心，所有矿机属于同一个机构</p>\n<p>（2）分布式的，矿工和矿主不在同一个地方，矿工加入矿池，是通过矿池规定的通讯协议和矿主进行联系。矿主把要计算的哈希值的任务分配给矿工，矿工计算完成后把结果返回给矿主，有出块奖励时一起参与分红</p>\n<p>通过工作量证明，按照矿工的贡献大小分配收益：降低挖矿难度（减少目标域值前0的数量），符合条件的叫一个 share（almost valid block），挖到合法区块、得到出块奖励之后，矿主按照矿工 share 的数量来分配收益</p>\n<h3 id=\"1、矿工是否能偷出块奖励？\"><a href=\"#1、矿工是否能偷出块奖励？\" class=\"headerlink\" title=\"1、矿工是否能偷出块奖励？\"></a>1、矿工是否能偷出块奖励？</h3><p>矿工不可能挖到一个合法区块自己偷偷发布，因为矿工的任务由矿主分配，矿主负责组装区块，并把不同的 coinbase parameter 所对应的 nonce，交给不同的矿工尝试，而 coinbase transaction 里的收款人地址填的是矿主的地址</p>\n<h3 id=\"2、矿工是否能捣乱？\"><a href=\"#2、矿工是否能捣乱？\" class=\"headerlink\" title=\"2、矿工是否能捣乱？\"></a>2、矿工是否能捣乱？</h3><p>是可以的，比如 矿工正常提交 share，但是挖到合法区块之后就丢弃掉</p>\n<h3 id=\"3、矿池的弊端\"><a href=\"#3、矿池的弊端\" class=\"headerlink\" title=\"3、矿池的弊端\"></a>3、矿池的弊端</h3><p>恶意方可能吸引到足够多的矿工（不明真相的群众）加入，然后发动 51% attack：</p>\n<p>（1）Forking attack：制造分叉，因为算力高，迟早能赶超6个区块；</p>\n<p>（2）Boycott：制裁对象一挖出区块，就分叉，因为算力高，更容易使制裁对象的区块作废</p>\n<p>类似于云计算中的 on demand computing，平时不用自己去维护很大的计算集群，需要用的时候可以随时召唤，对于矿池来说就是 on demand mining</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、全节点\"><a href=\"#一、全节点\" class=\"headerlink\" title=\"一、全节点\"></a>一、全节点</h2><h3 id=\"1、一直在线\"><a href=\"#1、一直在线\" class=\"headerlink\" title=\"1、一直在线\"></a>1、一直在线</h3><h3 id=\"2、在本地硬盘上维护完整的区块链信息\"><a href=\"#2、在本地硬盘上维护完整的区块链信息\" class=\"headerlink\" title=\"2、在本地硬盘上维护完整的区块链信息\"></a>2、在本地硬盘上维护完整的区块链信息</h3><h3 id=\"3、在内存里维护-UTXO-集合，以便快速检验交易的正确性\"><a href=\"#3、在内存里维护-UTXO-集合，以便快速检验交易的正确性\" class=\"headerlink\" title=\"3、在内存里维护 UTXO 集合，以便快速检验交易的正确性\"></a>3、在内存里维护 UTXO 集合，以便快速检验交易的正确性</h3><p>UTXO（unspent transaction output）</p>\n<h3 id=\"4、监听比特币网络上的交易信息，验证每个交易的合法性\"><a href=\"#4、监听比特币网络上的交易信息，验证每个交易的合法性\" class=\"headerlink\" title=\"4、监听比特币网络上的交易信息，验证每个交易的合法性\"></a>4、监听比特币网络上的交易信息，验证每个交易的合法性</h3><p>（1）是否有合法的签名</p>\n<p>（2）是不是 double spending</p>\n<h3 id=\"5、决定哪些交易会被打包到区块里\"><a href=\"#5、决定哪些交易会被打包到区块里\" class=\"headerlink\" title=\"5、决定哪些交易会被打包到区块里\"></a>5、决定哪些交易会被打包到区块里</h3><p>缺省状态下，只要是合法交易、并且交易费符合要求，就会被打包</p>\n<h3 id=\"6、-监听别的矿工挖出来的区块，验证其合法性\"><a href=\"#6、-监听别的矿工挖出来的区块，验证其合法性\" class=\"headerlink\" title=\"6、 监听别的矿工挖出来的区块，验证其合法性\"></a>6、 监听别的矿工挖出来的区块，验证其合法性</h3><p>（1）区块中的每个交易都要合法，包括铸币交易，比如是否篡改了出块奖励、发布的难度是否符合要求（block header 取哈希后，前面是否有足够多的 0；block header 里的难度目标域值是否设置正确）</p>\n<p>（2）全节点是否每两周调整挖矿难度</p>\n<p>（3）检查该区块是否在延伸最长合法链</p>\n<h3 id=\"7、挖矿\"><a href=\"#7、挖矿\" class=\"headerlink\" title=\"7、挖矿\"></a>7、挖矿</h3><h4 id=\"（1）决定沿着哪条链挖下去？\"><a href=\"#（1）决定沿着哪条链挖下去？\" class=\"headerlink\" title=\"（1）决定沿着哪条链挖下去？\"></a>（1）决定沿着哪条链挖下去？</h4><p>缺省情况下沿着最长合法链挖下去</p>\n<h4 id=\"（2）当出现等长的分叉的时候，选择哪一个分叉？\"><a href=\"#（2）当出现等长的分叉的时候，选择哪一个分叉？\" class=\"headerlink\" title=\"（2）当出现等长的分叉的时候，选择哪一个分叉？\"></a>（2）当出现等长的分叉的时候，选择哪一个分叉？</h4><p>缺省情况下选择最先听到的分叉</p>\n<h2 id=\"二、轻节点\"><a href=\"#二、轻节点\" class=\"headerlink\" title=\"二、轻节点\"></a>二、轻节点</h2><p>轻节点也叫做 spv client（simplified payment verification）</p>\n<h3 id=\"1、不是一直在线\"><a href=\"#1、不是一直在线\" class=\"headerlink\" title=\"1、不是一直在线\"></a>1、不是一直在线</h3><h3 id=\"2、不用保存整个区块链，只要保存每个区块的块头\"><a href=\"#2、不用保存整个区块链，只要保存每个区块的块头\" class=\"headerlink\" title=\"2、不用保存整个区块链，只要保存每个区块的块头\"></a>2、不用保存整个区块链，只要保存每个区块的块头</h3><p>大约是全节点的 1&#x2F;1000</p>\n<h3 id=\"3、不用保存全部交易，只保存与自己相关的交易\"><a href=\"#3、不用保存全部交易，只保存与自己相关的交易\" class=\"headerlink\" title=\"3、不用保存全部交易，只保存与自己相关的交易\"></a>3、不用保存全部交易，只保存与自己相关的交易</h3><h3 id=\"4、无法检验大多数交易的合法性，只能检验与自己相关-的那些交易的合法性\"><a href=\"#4、无法检验大多数交易的合法性，只能检验与自己相关-的那些交易的合法性\" class=\"headerlink\" title=\"4、无法检验大多数交易的合法性，只能检验与自己相关 的那些交易的合法性\"></a>4、无法检验大多数交易的合法性，只能检验与自己相关 的那些交易的合法性</h3><h3 id=\"5、无法检测网上发布的区块的正确性\"><a href=\"#5、无法检测网上发布的区块的正确性\" class=\"headerlink\" title=\"5、无法检测网上发布的区块的正确性\"></a>5、无法检测网上发布的区块的正确性</h3><h3 id=\"6、可以验证挖矿的难度\"><a href=\"#6、可以验证挖矿的难度\" class=\"headerlink\" title=\"6、可以验证挖矿的难度\"></a>6、可以验证挖矿的难度</h3><p>因为挖矿的时候，计算哈希值只用到了块头的信息</p>\n<h3 id=\"7、只能检测哪个是最长链，不知道哪个是最长合法链\"><a href=\"#7、只能检测哪个是最长链，不知道哪个是最长合法链\" class=\"headerlink\" title=\"7、只能检测哪个是最长链，不知道哪个是最长合法链\"></a>7、只能检测哪个是最长链，不知道哪个是最长合法链</h3><p>因为无法检测这条链上所包含的交易都是合法的（不过可以检测每个区块是否符合难度要求）</p>\n<h2 id=\"三、挖矿的注意事项\"><a href=\"#三、挖矿的注意事项\" class=\"headerlink\" title=\"三、挖矿的注意事项\"></a>三、挖矿的注意事项</h2><p>比特币网络中大部分节点都是轻节点，如果只想进行转账，而不进行挖矿，就不需要运行全节点、只需使用轻节点</p>\n<p>在挖矿过程中，如果监听到别人发布了一个区块，需要重新组装区块（block header 和 交易内容都有变化）、重新开始挖</p>\n<h2 id=\"四、比特币的安全性保证\"><a href=\"#四、比特币的安全性保证\" class=\"headerlink\" title=\"四、比特币的安全性保证\"></a>四、比特币的安全性保证</h2><h3 id=\"1、密码学\"><a href=\"#1、密码学\" class=\"headerlink\" title=\"1、密码学\"></a>1、密码学</h3><p>恶意节点拿不到私钥，就无法伪造签名，也就无法偷币</p>\n<h3 id=\"2、好节点占大部分算力\"><a href=\"#2、好节点占大部分算力\" class=\"headerlink\" title=\"2、好节点占大部分算力\"></a>2、好节点占大部分算力</h3><p>前提是系统中大部分算力的矿工是遵守协议的</p>\n<h2 id=\"五、挖矿趋势一：设备从通用到专用\"><a href=\"#五、挖矿趋势一：设备从通用到专用\" class=\"headerlink\" title=\"五、挖矿趋势一：设备从通用到专用\"></a>五、挖矿趋势一：设备从通用到专用</h2><h3 id=\"1、CPU\"><a href=\"#1、CPU\" class=\"headerlink\" title=\"1、CPU\"></a>1、CPU</h3><p>最早是用普通的 CPU &#x2F; 通用计算机 挖矿，但是这种方式无法充分利用内存</p>\n<h3 id=\"2、GPU\"><a href=\"#2、GPU\" class=\"headerlink\" title=\"2、GPU\"></a>2、GPU</h3><p>GPU 用于大规模的并行计算，比如深度学习大量的矩阵乘法，但也部分部件也无法充分利用（比如浮点数运算）</p>\n<h3 id=\"3、ASIC-芯片\"><a href=\"#3、ASIC-芯片\" class=\"headerlink\" title=\"3、ASIC 芯片\"></a>3、ASIC 芯片</h3><p>ASIC（Application Specific Integrated Circuit，专用集成电路），ASIC 芯片是专门为比特币挖矿计算哈希值而设计，性价比最高</p>\n<p>但是同一个芯片只能用于一种币的挖矿，除非两种币使用同一个 mining puzzle。有些新开发的币会使用已有币的 mining puzzle，进而吸引更多矿工，这叫做 merge mining</p>\n<p>购买 ASIC 矿机的时机很重要，因为过时得很快，现在一般需要提前预定。不良厂商可能会在矿机生产后的黄金两个月先自己挖矿，然后才卖给用户</p>\n<p>有些新型货币，设计的是 alternative mining puzzle，出发点是 ASIC resistance，目的是让通用计算机也能参与挖矿过程</p>\n<h2 id=\"六、挖矿趋势二：大型矿池的出现\"><a href=\"#六、挖矿趋势二：大型矿池的出现\" class=\"headerlink\" title=\"六、挖矿趋势二：大型矿池的出现\"></a>六、挖矿趋势二：大型矿池的出现</h2><p>矿池的出现是为了解决单个矿工收入不稳定的问题。矿池把矿工组织起来作为一个整体，其架构是：一个全节点驱动多个矿机</p>\n<p>一个矿池一般有一个 pool manager（矿主），下面连着很多 minner（矿工），矿工只负责通过 ASIC 芯片计算哈希值，全节点的其他职责都由矿主承担（比如监听网络上的交易，并将其打包成一个候选区块，同时监听是否有其他节点抢先发布区块）</p>\n<h3 id=\"矿池的收益分配\"><a href=\"#矿池的收益分配\" class=\"headerlink\" title=\"矿池的收益分配\"></a>矿池的收益分配</h3><p>矿池一般有两种组织形式：</p>\n<p>（1）类似大型数据中心，所有矿机属于同一个机构</p>\n<p>（2）分布式的，矿工和矿主不在同一个地方，矿工加入矿池，是通过矿池规定的通讯协议和矿主进行联系。矿主把要计算的哈希值的任务分配给矿工，矿工计算完成后把结果返回给矿主，有出块奖励时一起参与分红</p>\n<p>通过工作量证明，按照矿工的贡献大小分配收益：降低挖矿难度（减少目标域值前0的数量），符合条件的叫一个 share（almost valid block），挖到合法区块、得到出块奖励之后，矿主按照矿工 share 的数量来分配收益</p>\n<h3 id=\"1、矿工是否能偷出块奖励？\"><a href=\"#1、矿工是否能偷出块奖励？\" class=\"headerlink\" title=\"1、矿工是否能偷出块奖励？\"></a>1、矿工是否能偷出块奖励？</h3><p>矿工不可能挖到一个合法区块自己偷偷发布，因为矿工的任务由矿主分配，矿主负责组装区块，并把不同的 coinbase parameter 所对应的 nonce，交给不同的矿工尝试，而 coinbase transaction 里的收款人地址填的是矿主的地址</p>\n<h3 id=\"2、矿工是否能捣乱？\"><a href=\"#2、矿工是否能捣乱？\" class=\"headerlink\" title=\"2、矿工是否能捣乱？\"></a>2、矿工是否能捣乱？</h3><p>是可以的，比如 矿工正常提交 share，但是挖到合法区块之后就丢弃掉</p>\n<h3 id=\"3、矿池的弊端\"><a href=\"#3、矿池的弊端\" class=\"headerlink\" title=\"3、矿池的弊端\"></a>3、矿池的弊端</h3><p>恶意方可能吸引到足够多的矿工（不明真相的群众）加入，然后发动 51% attack：</p>\n<p>（1）Forking attack：制造分叉，因为算力高，迟早能赶超6个区块；</p>\n<p>（2）Boycott：制裁对象一挖出区块，就分叉，因为算力高，更容易使制裁对象的区块作废</p>\n<p>类似于云计算中的 on demand computing，平时不用自己去维护很大的计算集群，需要用的时候可以随时召唤，对于矿池来说就是 on demand mining</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用9-BTC脚本","date":"2025-01-14T12:59:31.000Z","_content":"\n本节课较多用到 PPT 上的动画，视频链接如下：\n\nhttps://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=9\n\n比特币使用的编程语言很简单，内存空间只有一个通用的堆栈\n\n![图1](../images/38/1.png)\n\n上述的输入脚本包含2个操作：分别把2个很长的数压入栈里\n\n输出脚本有2行，分别对应上面的2个输出，每个输出有自己单独的脚本\n\n# BTC 脚本校验方式\n\n假设 A->B，B->C，下面对 B 交易时币的来源做校验，有两种校验方式\n\n![图2](../images/38/2.png)\n\n## 1、P2PK（Pay to Public Key）\n\n```\ninput script:\n    PUSHDATA(Sig)\n\noutput script:\n    PUSHDATA(PubKey)\n    CHECKSIG\n```\n\n1、PUSHDATA(Sig)：把 B 的签名入栈——来自输入脚本\n\n2、PUSHDATA(PubKey)：把 B 的公钥入栈——来自输出脚本\n\n3、CHECKSIG：弹出栈顶的两个元素（公钥和签名），用公钥验签，通过则返回 TRUE\n\n## 2、P2PKH（Pay to Public Key Hash）——最常用\n\nP2PKH 与 P2PK 的区别是：输出脚本给出的不是公钥，而是公钥的哈希值；输入脚本除了签名外，还需要给出公钥\n\n```\ninput script:\n    PUSHDATA(Sig)\n    PUSHDATA(PubKey)\n\noutput script:\n    DUP\n    HASH160\n    PUSHDATA(PubKeyHash)\n    EQUALVERIFY\n    CHECKSIG\n```\n\n1、PUSHDATA(Sig)：把 B 的签名入栈——来自输入脚本\n\n2、PUSHDATA(PubKey)：把 B 的公钥入栈——来自输入脚本\n\n3、DUP：把栈顶的元素复制一遍（即 B 的公钥）\n\n4、HASH160：把栈顶元素弹出，并取哈希（即对 B 的公钥取哈希），然后把得到的哈希再压入栈\n\n5、PUSHDATA(PubKeyHash)：把 B 的公钥哈希入栈——来自输出脚本\n\n6、EQUALVERIFY 是弹出栈顶的两个元素（哈希值），并比较它们是否相等\n\n7、CHECKSIG：弹出栈顶的两个元素（公钥和签名），用公钥验签，通过则返回 TRUE\n\n## 3、P2SH（Pay to Script Hash）——最复杂\n\nP2SH 的特点是 input script 要提供一个 redeem script（赎回脚本）\n\nP2SH 常见的应用场景是对 multiple signature（多重签名，即一个输出要求多个签名才能把钱取出，目前已不推荐）的支持\n\n验证分为两个阶段：第一阶段按照输入脚本和输出脚本的顺序执行；第二阶段执行赎回脚本\n\n具体略，有点复杂，可简单理解为把 P2PKH 中的 PUSHDATA(PubKey) 和 CHECKSIG 提取成一个赎回脚本\n\n## 4、Proof of Burn\n\n```\noutput script:\n    RETURN\n        [Zero or more ops or text]\n```\n\n这种类型的输出被称为：Provably Unspendable（可证明不可花费） / Prunable Outputs（可删减输出）\n\n这个脚本是证明销毁掉比特币的一种方法，有两种应用场景：（1）有些小的币种要求销毁一定数量的比特币才能够得到该币，这种币叫做 AltCoin（Alternative Coin）；（2）往区块链中写入一些内容，比如 digital commitment，把知识产权取哈希放在 return 后面，可以证明在某个时间点知道某个知识，任何用户都可以通过销毁少量比特币（将币转到不存在的地址）、换取向区块链写入的机会（不提倡，因为该交易会永久保留在 UTXO 中，浪费资源）\n\n注意：以上的 CHECKSIG 全称是 OP_CHECKSIG，DUP 全程是 OP_DUP\n","source":"_posts/38-北大区块链-BTC脚本.md","raw":"---\ntitle: 北大-区块链技术与应用9-BTC脚本\ndate: 2025-01-14 20:59:31\ntags:\n    - web3\n    - BTC\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n本节课较多用到 PPT 上的动画，视频链接如下：\n\nhttps://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=9\n\n比特币使用的编程语言很简单，内存空间只有一个通用的堆栈\n\n![图1](../images/38/1.png)\n\n上述的输入脚本包含2个操作：分别把2个很长的数压入栈里\n\n输出脚本有2行，分别对应上面的2个输出，每个输出有自己单独的脚本\n\n# BTC 脚本校验方式\n\n假设 A->B，B->C，下面对 B 交易时币的来源做校验，有两种校验方式\n\n![图2](../images/38/2.png)\n\n## 1、P2PK（Pay to Public Key）\n\n```\ninput script:\n    PUSHDATA(Sig)\n\noutput script:\n    PUSHDATA(PubKey)\n    CHECKSIG\n```\n\n1、PUSHDATA(Sig)：把 B 的签名入栈——来自输入脚本\n\n2、PUSHDATA(PubKey)：把 B 的公钥入栈——来自输出脚本\n\n3、CHECKSIG：弹出栈顶的两个元素（公钥和签名），用公钥验签，通过则返回 TRUE\n\n## 2、P2PKH（Pay to Public Key Hash）——最常用\n\nP2PKH 与 P2PK 的区别是：输出脚本给出的不是公钥，而是公钥的哈希值；输入脚本除了签名外，还需要给出公钥\n\n```\ninput script:\n    PUSHDATA(Sig)\n    PUSHDATA(PubKey)\n\noutput script:\n    DUP\n    HASH160\n    PUSHDATA(PubKeyHash)\n    EQUALVERIFY\n    CHECKSIG\n```\n\n1、PUSHDATA(Sig)：把 B 的签名入栈——来自输入脚本\n\n2、PUSHDATA(PubKey)：把 B 的公钥入栈——来自输入脚本\n\n3、DUP：把栈顶的元素复制一遍（即 B 的公钥）\n\n4、HASH160：把栈顶元素弹出，并取哈希（即对 B 的公钥取哈希），然后把得到的哈希再压入栈\n\n5、PUSHDATA(PubKeyHash)：把 B 的公钥哈希入栈——来自输出脚本\n\n6、EQUALVERIFY 是弹出栈顶的两个元素（哈希值），并比较它们是否相等\n\n7、CHECKSIG：弹出栈顶的两个元素（公钥和签名），用公钥验签，通过则返回 TRUE\n\n## 3、P2SH（Pay to Script Hash）——最复杂\n\nP2SH 的特点是 input script 要提供一个 redeem script（赎回脚本）\n\nP2SH 常见的应用场景是对 multiple signature（多重签名，即一个输出要求多个签名才能把钱取出，目前已不推荐）的支持\n\n验证分为两个阶段：第一阶段按照输入脚本和输出脚本的顺序执行；第二阶段执行赎回脚本\n\n具体略，有点复杂，可简单理解为把 P2PKH 中的 PUSHDATA(PubKey) 和 CHECKSIG 提取成一个赎回脚本\n\n## 4、Proof of Burn\n\n```\noutput script:\n    RETURN\n        [Zero or more ops or text]\n```\n\n这种类型的输出被称为：Provably Unspendable（可证明不可花费） / Prunable Outputs（可删减输出）\n\n这个脚本是证明销毁掉比特币的一种方法，有两种应用场景：（1）有些小的币种要求销毁一定数量的比特币才能够得到该币，这种币叫做 AltCoin（Alternative Coin）；（2）往区块链中写入一些内容，比如 digital commitment，把知识产权取哈希放在 return 后面，可以证明在某个时间点知道某个知识，任何用户都可以通过销毁少量比特币（将币转到不存在的地址）、换取向区块链写入的机会（不提倡，因为该交易会永久保留在 UTXO 中，浪费资源）\n\n注意：以上的 CHECKSIG 全称是 OP_CHECKSIG，DUP 全程是 OP_DUP\n","slug":"38-北大区块链-BTC脚本","published":1,"updated":"2025-05-20T02:47:28.684Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvub002v6kprdpal7ngb","content":"<p>本节课较多用到 PPT 上的动画，视频链接如下：</p>\n<p><a class=\"link\"   href=\"https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=9\" >https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&amp;vd_source=69ac93649ea21c4726fe85f272b6d968&amp;p=9<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p>比特币使用的编程语言很简单，内存空间只有一个通用的堆栈</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/38/1.png\"\n                      alt=\"图1\"\n                ></p>\n<p>上述的输入脚本包含2个操作：分别把2个很长的数压入栈里</p>\n<p>输出脚本有2行，分别对应上面的2个输出，每个输出有自己单独的脚本</p>\n<h1 id=\"BTC-脚本校验方式\"><a href=\"#BTC-脚本校验方式\" class=\"headerlink\" title=\"BTC 脚本校验方式\"></a>BTC 脚本校验方式</h1><p>假设 A-&gt;B，B-&gt;C，下面对 B 交易时币的来源做校验，有两种校验方式</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/38/2.png\"\n                      alt=\"图2\"\n                ></p>\n<h2 id=\"1、P2PK（Pay-to-Public-Key）\"><a href=\"#1、P2PK（Pay-to-Public-Key）\" class=\"headerlink\" title=\"1、P2PK（Pay to Public Key）\"></a>1、P2PK（Pay to Public Key）</h2><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input script:</span><br><span class=\"line\">    PUSHDATA(Sig)</span><br><span class=\"line\"></span><br><span class=\"line\">output script:</span><br><span class=\"line\">    PUSHDATA(PubKey)</span><br><span class=\"line\">    CHECKSIG</span><br></pre></td></tr></table></figure></div>\n\n<p>1、PUSHDATA(Sig)：把 B 的签名入栈——来自输入脚本</p>\n<p>2、PUSHDATA(PubKey)：把 B 的公钥入栈——来自输出脚本</p>\n<p>3、CHECKSIG：弹出栈顶的两个元素（公钥和签名），用公钥验签，通过则返回 TRUE</p>\n<h2 id=\"2、P2PKH（Pay-to-Public-Key-Hash）——最常用\"><a href=\"#2、P2PKH（Pay-to-Public-Key-Hash）——最常用\" class=\"headerlink\" title=\"2、P2PKH（Pay to Public Key Hash）——最常用\"></a>2、P2PKH（Pay to Public Key Hash）——最常用</h2><p>P2PKH 与 P2PK 的区别是：输出脚本给出的不是公钥，而是公钥的哈希值；输入脚本除了签名外，还需要给出公钥</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input script:</span><br><span class=\"line\">    PUSHDATA(Sig)</span><br><span class=\"line\">    PUSHDATA(PubKey)</span><br><span class=\"line\"></span><br><span class=\"line\">output script:</span><br><span class=\"line\">    DUP</span><br><span class=\"line\">    HASH160</span><br><span class=\"line\">    PUSHDATA(PubKeyHash)</span><br><span class=\"line\">    EQUALVERIFY</span><br><span class=\"line\">    CHECKSIG</span><br></pre></td></tr></table></figure></div>\n\n<p>1、PUSHDATA(Sig)：把 B 的签名入栈——来自输入脚本</p>\n<p>2、PUSHDATA(PubKey)：把 B 的公钥入栈——来自输入脚本</p>\n<p>3、DUP：把栈顶的元素复制一遍（即 B 的公钥）</p>\n<p>4、HASH160：把栈顶元素弹出，并取哈希（即对 B 的公钥取哈希），然后把得到的哈希再压入栈</p>\n<p>5、PUSHDATA(PubKeyHash)：把 B 的公钥哈希入栈——来自输出脚本</p>\n<p>6、EQUALVERIFY 是弹出栈顶的两个元素（哈希值），并比较它们是否相等</p>\n<p>7、CHECKSIG：弹出栈顶的两个元素（公钥和签名），用公钥验签，通过则返回 TRUE</p>\n<h2 id=\"3、P2SH（Pay-to-Script-Hash）——最复杂\"><a href=\"#3、P2SH（Pay-to-Script-Hash）——最复杂\" class=\"headerlink\" title=\"3、P2SH（Pay to Script Hash）——最复杂\"></a>3、P2SH（Pay to Script Hash）——最复杂</h2><p>P2SH 的特点是 input script 要提供一个 redeem script（赎回脚本）</p>\n<p>P2SH 常见的应用场景是对 multiple signature（多重签名，即一个输出要求多个签名才能把钱取出，目前已不推荐）的支持</p>\n<p>验证分为两个阶段：第一阶段按照输入脚本和输出脚本的顺序执行；第二阶段执行赎回脚本</p>\n<p>具体略，有点复杂，可简单理解为把 P2PKH 中的 PUSHDATA(PubKey) 和 CHECKSIG 提取成一个赎回脚本</p>\n<h2 id=\"4、Proof-of-Burn\"><a href=\"#4、Proof-of-Burn\" class=\"headerlink\" title=\"4、Proof of Burn\"></a>4、Proof of Burn</h2><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output script:</span><br><span class=\"line\">    RETURN</span><br><span class=\"line\">        [Zero or more ops or text]</span><br></pre></td></tr></table></figure></div>\n\n<p>这种类型的输出被称为：Provably Unspendable（可证明不可花费） &#x2F; Prunable Outputs（可删减输出）</p>\n<p>这个脚本是证明销毁掉比特币的一种方法，有两种应用场景：（1）有些小的币种要求销毁一定数量的比特币才能够得到该币，这种币叫做 AltCoin（Alternative Coin）；（2）往区块链中写入一些内容，比如 digital commitment，把知识产权取哈希放在 return 后面，可以证明在某个时间点知道某个知识，任何用户都可以通过销毁少量比特币（将币转到不存在的地址）、换取向区块链写入的机会（不提倡，因为该交易会永久保留在 UTXO 中，浪费资源）</p>\n<p>注意：以上的 CHECKSIG 全称是 OP_CHECKSIG，DUP 全程是 OP_DUP</p>\n","site":{"data":{}},"excerpt":"","more":"<p>本节课较多用到 PPT 上的动画，视频链接如下：</p>\n<p><a class=\"link\"   href=\"https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=9\" >https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&amp;vd_source=69ac93649ea21c4726fe85f272b6d968&amp;p=9<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p>比特币使用的编程语言很简单，内存空间只有一个通用的堆栈</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/38/1.png\"\n                      alt=\"图1\"\n                ></p>\n<p>上述的输入脚本包含2个操作：分别把2个很长的数压入栈里</p>\n<p>输出脚本有2行，分别对应上面的2个输出，每个输出有自己单独的脚本</p>\n<h1 id=\"BTC-脚本校验方式\"><a href=\"#BTC-脚本校验方式\" class=\"headerlink\" title=\"BTC 脚本校验方式\"></a>BTC 脚本校验方式</h1><p>假设 A-&gt;B，B-&gt;C，下面对 B 交易时币的来源做校验，有两种校验方式</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/38/2.png\"\n                      alt=\"图2\"\n                ></p>\n<h2 id=\"1、P2PK（Pay-to-Public-Key）\"><a href=\"#1、P2PK（Pay-to-Public-Key）\" class=\"headerlink\" title=\"1、P2PK（Pay to Public Key）\"></a>1、P2PK（Pay to Public Key）</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input script:</span><br><span class=\"line\">    PUSHDATA(Sig)</span><br><span class=\"line\"></span><br><span class=\"line\">output script:</span><br><span class=\"line\">    PUSHDATA(PubKey)</span><br><span class=\"line\">    CHECKSIG</span><br></pre></td></tr></table></figure>\n\n<p>1、PUSHDATA(Sig)：把 B 的签名入栈——来自输入脚本</p>\n<p>2、PUSHDATA(PubKey)：把 B 的公钥入栈——来自输出脚本</p>\n<p>3、CHECKSIG：弹出栈顶的两个元素（公钥和签名），用公钥验签，通过则返回 TRUE</p>\n<h2 id=\"2、P2PKH（Pay-to-Public-Key-Hash）——最常用\"><a href=\"#2、P2PKH（Pay-to-Public-Key-Hash）——最常用\" class=\"headerlink\" title=\"2、P2PKH（Pay to Public Key Hash）——最常用\"></a>2、P2PKH（Pay to Public Key Hash）——最常用</h2><p>P2PKH 与 P2PK 的区别是：输出脚本给出的不是公钥，而是公钥的哈希值；输入脚本除了签名外，还需要给出公钥</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input script:</span><br><span class=\"line\">    PUSHDATA(Sig)</span><br><span class=\"line\">    PUSHDATA(PubKey)</span><br><span class=\"line\"></span><br><span class=\"line\">output script:</span><br><span class=\"line\">    DUP</span><br><span class=\"line\">    HASH160</span><br><span class=\"line\">    PUSHDATA(PubKeyHash)</span><br><span class=\"line\">    EQUALVERIFY</span><br><span class=\"line\">    CHECKSIG</span><br></pre></td></tr></table></figure>\n\n<p>1、PUSHDATA(Sig)：把 B 的签名入栈——来自输入脚本</p>\n<p>2、PUSHDATA(PubKey)：把 B 的公钥入栈——来自输入脚本</p>\n<p>3、DUP：把栈顶的元素复制一遍（即 B 的公钥）</p>\n<p>4、HASH160：把栈顶元素弹出，并取哈希（即对 B 的公钥取哈希），然后把得到的哈希再压入栈</p>\n<p>5、PUSHDATA(PubKeyHash)：把 B 的公钥哈希入栈——来自输出脚本</p>\n<p>6、EQUALVERIFY 是弹出栈顶的两个元素（哈希值），并比较它们是否相等</p>\n<p>7、CHECKSIG：弹出栈顶的两个元素（公钥和签名），用公钥验签，通过则返回 TRUE</p>\n<h2 id=\"3、P2SH（Pay-to-Script-Hash）——最复杂\"><a href=\"#3、P2SH（Pay-to-Script-Hash）——最复杂\" class=\"headerlink\" title=\"3、P2SH（Pay to Script Hash）——最复杂\"></a>3、P2SH（Pay to Script Hash）——最复杂</h2><p>P2SH 的特点是 input script 要提供一个 redeem script（赎回脚本）</p>\n<p>P2SH 常见的应用场景是对 multiple signature（多重签名，即一个输出要求多个签名才能把钱取出，目前已不推荐）的支持</p>\n<p>验证分为两个阶段：第一阶段按照输入脚本和输出脚本的顺序执行；第二阶段执行赎回脚本</p>\n<p>具体略，有点复杂，可简单理解为把 P2PKH 中的 PUSHDATA(PubKey) 和 CHECKSIG 提取成一个赎回脚本</p>\n<h2 id=\"4、Proof-of-Burn\"><a href=\"#4、Proof-of-Burn\" class=\"headerlink\" title=\"4、Proof of Burn\"></a>4、Proof of Burn</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output script:</span><br><span class=\"line\">    RETURN</span><br><span class=\"line\">        [Zero or more ops or text]</span><br></pre></td></tr></table></figure>\n\n<p>这种类型的输出被称为：Provably Unspendable（可证明不可花费） &#x2F; Prunable Outputs（可删减输出）</p>\n<p>这个脚本是证明销毁掉比特币的一种方法，有两种应用场景：（1）有些小的币种要求销毁一定数量的比特币才能够得到该币，这种币叫做 AltCoin（Alternative Coin）；（2）往区块链中写入一些内容，比如 digital commitment，把知识产权取哈希放在 return 后面，可以证明在某个时间点知道某个知识，任何用户都可以通过销毁少量比特币（将币转到不存在的地址）、换取向区块链写入的机会（不提倡，因为该交易会永久保留在 UTXO 中，浪费资源）</p>\n<p>注意：以上的 CHECKSIG 全称是 OP_CHECKSIG，DUP 全程是 OP_DUP</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用10-BTC分叉","date":"2025-01-14T15:33:21.000Z","_content":"\n## 一、State fork（状态分叉）\n\nState fork：对比特币当前的状态有分歧造成的分叉，比如两个区块几乎同时生成，造成的分叉\n\nForking attack 也属于 state fork，但是是人为故意的，所以也叫做 deliberate fork（故意分叉）\n\n## 二、Protocol fork（协议分叉）\n\nProtocol fork：比特币的协议发生改变（通过软件升级），有些节点由于各种原因可能暂时没有升级，从而造成的分叉\n\n根据对协议修改的内容的不同，可以分为 hard fork（硬分叉）和 soft fork（软分叉）\n\n### 1、Hard fork\n\n**新节点发布的区块，旧节点可能不认**\n\n1个交易约为250字节，一个区块约有 1000,000字节/250字节=4000个交易，每秒约有 4000/(60*10)≈7个交易，数量过少\n\n假设 Block size limit 从 1M 更新到 4M，大多数算力的节点更新了软件，但少部分未更新。只要仍有部分节点未更新软件，该分叉就不会消失\n\n#### Example：ETH & ETC\n\n2016年，以太坊的 DAO（去中心化自治组织）遭到黑客攻击，导致大量ETH被盗。部分成员支持通过硬分叉回滚交易、恢复被盗资金，而另一些成员认为这会破坏区块链的不可篡改性\n\n最终社区实施硬分叉，恢复到攻击前的状态，这条新链称为 Ethereum（ETH）；而反对硬分叉的用户继续使用原链，称为 Ethereum Classic（ETC），从此两种货币独立发展（通过chain ID 区分两条链）\n\n### 2、Soft fork\n\n**新节点发布的区块，旧节点仍会认可**\n\n假设 Block size limit 从 1M 更新到 0.5M，大多数算力的节点更新了软件，但少部分未更新。如果有节点不更新软件，可能会经常产生孤儿区块，所以最终所有节点都会更新，分叉不会继续延展\n\n#### Example：P2SH（Pay to Script Hash）\n\nP2SH 的验证分为两步：（1）验证输入脚本给出的赎回脚本，和前一个交易的输出脚本给出的 赎回脚本的哈希值 对得上；（2）执行赎回脚本，验证输入脚本给出的签名是合法的\n\n对于旧节点来说，只会进行第一阶段的认证；所以新节点认为合法的区块，旧节点仍然会认可\n\n### 3、总结\n\n（1）Soft fork：只要系统有半数以上的节点更新，就不会有永久的分叉\n\n（2）Hard fork：如果不是所有的节点都更新了，就会有永久的分叉。根本原因是旧节点不认可新链（不是合法最长链），所以会按照旧链执行\n","source":"_posts/39-北大区块链-BTC分叉.md","raw":"---\ntitle: 北大-区块链技术与应用10-BTC分叉\ndate: 2025-01-14 23:33:21\ntags:\n    - web3\n    - BTC\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n## 一、State fork（状态分叉）\n\nState fork：对比特币当前的状态有分歧造成的分叉，比如两个区块几乎同时生成，造成的分叉\n\nForking attack 也属于 state fork，但是是人为故意的，所以也叫做 deliberate fork（故意分叉）\n\n## 二、Protocol fork（协议分叉）\n\nProtocol fork：比特币的协议发生改变（通过软件升级），有些节点由于各种原因可能暂时没有升级，从而造成的分叉\n\n根据对协议修改的内容的不同，可以分为 hard fork（硬分叉）和 soft fork（软分叉）\n\n### 1、Hard fork\n\n**新节点发布的区块，旧节点可能不认**\n\n1个交易约为250字节，一个区块约有 1000,000字节/250字节=4000个交易，每秒约有 4000/(60*10)≈7个交易，数量过少\n\n假设 Block size limit 从 1M 更新到 4M，大多数算力的节点更新了软件，但少部分未更新。只要仍有部分节点未更新软件，该分叉就不会消失\n\n#### Example：ETH & ETC\n\n2016年，以太坊的 DAO（去中心化自治组织）遭到黑客攻击，导致大量ETH被盗。部分成员支持通过硬分叉回滚交易、恢复被盗资金，而另一些成员认为这会破坏区块链的不可篡改性\n\n最终社区实施硬分叉，恢复到攻击前的状态，这条新链称为 Ethereum（ETH）；而反对硬分叉的用户继续使用原链，称为 Ethereum Classic（ETC），从此两种货币独立发展（通过chain ID 区分两条链）\n\n### 2、Soft fork\n\n**新节点发布的区块，旧节点仍会认可**\n\n假设 Block size limit 从 1M 更新到 0.5M，大多数算力的节点更新了软件，但少部分未更新。如果有节点不更新软件，可能会经常产生孤儿区块，所以最终所有节点都会更新，分叉不会继续延展\n\n#### Example：P2SH（Pay to Script Hash）\n\nP2SH 的验证分为两步：（1）验证输入脚本给出的赎回脚本，和前一个交易的输出脚本给出的 赎回脚本的哈希值 对得上；（2）执行赎回脚本，验证输入脚本给出的签名是合法的\n\n对于旧节点来说，只会进行第一阶段的认证；所以新节点认为合法的区块，旧节点仍然会认可\n\n### 3、总结\n\n（1）Soft fork：只要系统有半数以上的节点更新，就不会有永久的分叉\n\n（2）Hard fork：如果不是所有的节点都更新了，就会有永久的分叉。根本原因是旧节点不认可新链（不是合法最长链），所以会按照旧链执行\n","slug":"39-北大区块链-BTC分叉","published":1,"updated":"2025-05-20T02:47:28.684Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvub002y6kpre4gn0f40","content":"<h2 id=\"一、State-fork（状态分叉）\"><a href=\"#一、State-fork（状态分叉）\" class=\"headerlink\" title=\"一、State fork（状态分叉）\"></a>一、State fork（状态分叉）</h2><p>State fork：对比特币当前的状态有分歧造成的分叉，比如两个区块几乎同时生成，造成的分叉</p>\n<p>Forking attack 也属于 state fork，但是是人为故意的，所以也叫做 deliberate fork（故意分叉）</p>\n<h2 id=\"二、Protocol-fork（协议分叉）\"><a href=\"#二、Protocol-fork（协议分叉）\" class=\"headerlink\" title=\"二、Protocol fork（协议分叉）\"></a>二、Protocol fork（协议分叉）</h2><p>Protocol fork：比特币的协议发生改变（通过软件升级），有些节点由于各种原因可能暂时没有升级，从而造成的分叉</p>\n<p>根据对协议修改的内容的不同，可以分为 hard fork（硬分叉）和 soft fork（软分叉）</p>\n<h3 id=\"1、Hard-fork\"><a href=\"#1、Hard-fork\" class=\"headerlink\" title=\"1、Hard fork\"></a>1、Hard fork</h3><p><strong>新节点发布的区块，旧节点可能不认</strong></p>\n<p>1个交易约为250字节，一个区块约有 1000,000字节&#x2F;250字节&#x3D;4000个交易，每秒约有 4000&#x2F;(60*10)≈7个交易，数量过少</p>\n<p>假设 Block size limit 从 1M 更新到 4M，大多数算力的节点更新了软件，但少部分未更新。只要仍有部分节点未更新软件，该分叉就不会消失</p>\n<h4 id=\"Example：ETH-ETC\"><a href=\"#Example：ETH-ETC\" class=\"headerlink\" title=\"Example：ETH &amp; ETC\"></a>Example：ETH &amp; ETC</h4><p>2016年，以太坊的 DAO（去中心化自治组织）遭到黑客攻击，导致大量ETH被盗。部分成员支持通过硬分叉回滚交易、恢复被盗资金，而另一些成员认为这会破坏区块链的不可篡改性</p>\n<p>最终社区实施硬分叉，恢复到攻击前的状态，这条新链称为 Ethereum（ETH）；而反对硬分叉的用户继续使用原链，称为 Ethereum Classic（ETC），从此两种货币独立发展（通过chain ID 区分两条链）</p>\n<h3 id=\"2、Soft-fork\"><a href=\"#2、Soft-fork\" class=\"headerlink\" title=\"2、Soft fork\"></a>2、Soft fork</h3><p><strong>新节点发布的区块，旧节点仍会认可</strong></p>\n<p>假设 Block size limit 从 1M 更新到 0.5M，大多数算力的节点更新了软件，但少部分未更新。如果有节点不更新软件，可能会经常产生孤儿区块，所以最终所有节点都会更新，分叉不会继续延展</p>\n<h4 id=\"Example：P2SH（Pay-to-Script-Hash）\"><a href=\"#Example：P2SH（Pay-to-Script-Hash）\" class=\"headerlink\" title=\"Example：P2SH（Pay to Script Hash）\"></a>Example：P2SH（Pay to Script Hash）</h4><p>P2SH 的验证分为两步：（1）验证输入脚本给出的赎回脚本，和前一个交易的输出脚本给出的 赎回脚本的哈希值 对得上；（2）执行赎回脚本，验证输入脚本给出的签名是合法的</p>\n<p>对于旧节点来说，只会进行第一阶段的认证；所以新节点认为合法的区块，旧节点仍然会认可</p>\n<h3 id=\"3、总结\"><a href=\"#3、总结\" class=\"headerlink\" title=\"3、总结\"></a>3、总结</h3><p>（1）Soft fork：只要系统有半数以上的节点更新，就不会有永久的分叉</p>\n<p>（2）Hard fork：如果不是所有的节点都更新了，就会有永久的分叉。根本原因是旧节点不认可新链（不是合法最长链），所以会按照旧链执行</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、State-fork（状态分叉）\"><a href=\"#一、State-fork（状态分叉）\" class=\"headerlink\" title=\"一、State fork（状态分叉）\"></a>一、State fork（状态分叉）</h2><p>State fork：对比特币当前的状态有分歧造成的分叉，比如两个区块几乎同时生成，造成的分叉</p>\n<p>Forking attack 也属于 state fork，但是是人为故意的，所以也叫做 deliberate fork（故意分叉）</p>\n<h2 id=\"二、Protocol-fork（协议分叉）\"><a href=\"#二、Protocol-fork（协议分叉）\" class=\"headerlink\" title=\"二、Protocol fork（协议分叉）\"></a>二、Protocol fork（协议分叉）</h2><p>Protocol fork：比特币的协议发生改变（通过软件升级），有些节点由于各种原因可能暂时没有升级，从而造成的分叉</p>\n<p>根据对协议修改的内容的不同，可以分为 hard fork（硬分叉）和 soft fork（软分叉）</p>\n<h3 id=\"1、Hard-fork\"><a href=\"#1、Hard-fork\" class=\"headerlink\" title=\"1、Hard fork\"></a>1、Hard fork</h3><p><strong>新节点发布的区块，旧节点可能不认</strong></p>\n<p>1个交易约为250字节，一个区块约有 1000,000字节&#x2F;250字节&#x3D;4000个交易，每秒约有 4000&#x2F;(60*10)≈7个交易，数量过少</p>\n<p>假设 Block size limit 从 1M 更新到 4M，大多数算力的节点更新了软件，但少部分未更新。只要仍有部分节点未更新软件，该分叉就不会消失</p>\n<h4 id=\"Example：ETH-ETC\"><a href=\"#Example：ETH-ETC\" class=\"headerlink\" title=\"Example：ETH &amp; ETC\"></a>Example：ETH &amp; ETC</h4><p>2016年，以太坊的 DAO（去中心化自治组织）遭到黑客攻击，导致大量ETH被盗。部分成员支持通过硬分叉回滚交易、恢复被盗资金，而另一些成员认为这会破坏区块链的不可篡改性</p>\n<p>最终社区实施硬分叉，恢复到攻击前的状态，这条新链称为 Ethereum（ETH）；而反对硬分叉的用户继续使用原链，称为 Ethereum Classic（ETC），从此两种货币独立发展（通过chain ID 区分两条链）</p>\n<h3 id=\"2、Soft-fork\"><a href=\"#2、Soft-fork\" class=\"headerlink\" title=\"2、Soft fork\"></a>2、Soft fork</h3><p><strong>新节点发布的区块，旧节点仍会认可</strong></p>\n<p>假设 Block size limit 从 1M 更新到 0.5M，大多数算力的节点更新了软件，但少部分未更新。如果有节点不更新软件，可能会经常产生孤儿区块，所以最终所有节点都会更新，分叉不会继续延展</p>\n<h4 id=\"Example：P2SH（Pay-to-Script-Hash）\"><a href=\"#Example：P2SH（Pay-to-Script-Hash）\" class=\"headerlink\" title=\"Example：P2SH（Pay to Script Hash）\"></a>Example：P2SH（Pay to Script Hash）</h4><p>P2SH 的验证分为两步：（1）验证输入脚本给出的赎回脚本，和前一个交易的输出脚本给出的 赎回脚本的哈希值 对得上；（2）执行赎回脚本，验证输入脚本给出的签名是合法的</p>\n<p>对于旧节点来说，只会进行第一阶段的认证；所以新节点认为合法的区块，旧节点仍然会认可</p>\n<h3 id=\"3、总结\"><a href=\"#3、总结\" class=\"headerlink\" title=\"3、总结\"></a>3、总结</h3><p>（1）Soft fork：只要系统有半数以上的节点更新，就不会有永久的分叉</p>\n<p>（2）Hard fork：如果不是所有的节点都更新了，就会有永久的分叉。根本原因是旧节点不认可新链（不是合法最长链），所以会按照旧链执行</p>\n","_processedHighlight":true},{"title":"vue3 计算属性","date":"2023-11-07T10:46:36.000Z","_content":"\n## 基础\n\ncomputed() 方法接受一个 getter 函数，返回一个计算属性 ref\n\n因为 ref 会在模板中自动解包，所以在表达式中引用无需 .value\n\n``` html\n<script setup>\nimport { reactive, computed } from 'vue';\n\nconst author = reactive({\n    name: \"Zoella\",\n    books: ['vue2', 'vue3', 'vue4']\n});\n\nconst hasBookPublished = computed(() => {\n    return author.books.length > 0 ? 'yes' : 'no';\n});\n</script>\n\n<template>\n  <div>\n    <span>{{ author.name }}</span> has published books: \n    <span>{{ hasBookPublished }}</span>\n  </div>\n</template>\n```\n\n## 计算属性缓存 VS 方法\n\n``` html\n<p>{{ calculateBooksMessage() }}</p>\n```\n\n``` js\nfunction calculateBooksMessage() {\n  return author.books.length > 0 ? 'yes' : 'no';\n}\n```\n\n计算属性比方法节省性能。\n\n将与上述相同的函数定义为方法，结果和计算属性相同，然而 **计算属性值会基于其响应式依赖被缓存**，只要```author.books```不变，就不会重复执行 getter 函数。但是方法总会在重渲染发生时再次执行函数。\n\n## 可写计算属性\n\n计算属性默认为只读。特殊场景下会用到“可写”的计算属性。\n\n``` html\n<script>\nimport { ref, computed } from 'vue';\n\nconst firstName = ref('John');\nconst lastName = ref('Doe');\n\nconst fullName = computed({\n  // getter\n  get() {\n    return firstName.value + ' ' + lastName.value;\n  },\n  // setter\n  set(newValue) {\n    [firstName.value, lastName.value] = newValue.split('');\n  }\n})\n</script>\n```\n\n当运行 ```fullName.value = 'Zoella Wang'``` 时，setter会被调用，firstName 和 lastName 会随之更新。\n","source":"_posts/4-vue3计算属性.md","raw":"---\ntitle: vue3 计算属性\ndate: 2023-11-07 18:46:36\ntags:\n    - vue3\n    - vue\ncategories:\n    - vue3\n      - 文档\n---\n\n## 基础\n\ncomputed() 方法接受一个 getter 函数，返回一个计算属性 ref\n\n因为 ref 会在模板中自动解包，所以在表达式中引用无需 .value\n\n``` html\n<script setup>\nimport { reactive, computed } from 'vue';\n\nconst author = reactive({\n    name: \"Zoella\",\n    books: ['vue2', 'vue3', 'vue4']\n});\n\nconst hasBookPublished = computed(() => {\n    return author.books.length > 0 ? 'yes' : 'no';\n});\n</script>\n\n<template>\n  <div>\n    <span>{{ author.name }}</span> has published books: \n    <span>{{ hasBookPublished }}</span>\n  </div>\n</template>\n```\n\n## 计算属性缓存 VS 方法\n\n``` html\n<p>{{ calculateBooksMessage() }}</p>\n```\n\n``` js\nfunction calculateBooksMessage() {\n  return author.books.length > 0 ? 'yes' : 'no';\n}\n```\n\n计算属性比方法节省性能。\n\n将与上述相同的函数定义为方法，结果和计算属性相同，然而 **计算属性值会基于其响应式依赖被缓存**，只要```author.books```不变，就不会重复执行 getter 函数。但是方法总会在重渲染发生时再次执行函数。\n\n## 可写计算属性\n\n计算属性默认为只读。特殊场景下会用到“可写”的计算属性。\n\n``` html\n<script>\nimport { ref, computed } from 'vue';\n\nconst firstName = ref('John');\nconst lastName = ref('Doe');\n\nconst fullName = computed({\n  // getter\n  get() {\n    return firstName.value + ' ' + lastName.value;\n  },\n  // setter\n  set(newValue) {\n    [firstName.value, lastName.value] = newValue.split('');\n  }\n})\n</script>\n```\n\n当运行 ```fullName.value = 'Zoella Wang'``` 时，setter会被调用，firstName 和 lastName 会随之更新。\n","slug":"4-vue3计算属性","published":1,"updated":"2025-05-20T02:47:28.685Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvub00326kpr5akp9njo","content":"<h2 id=\"基础\"><a href=\"#基础\" class=\"headerlink\" title=\"基础\"></a>基础</h2><p>computed() 方法接受一个 getter 函数，返回一个计算属性 ref</p>\n<p>因为 ref 会在模板中自动解包，所以在表达式中引用无需 .value</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; reactive, computed &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> author = <span class=\"title function_\">reactive</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">name</span>: <span class=\"string\">&quot;Zoella&quot;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">books</span>: [<span class=\"string\">&#x27;vue2&#x27;</span>, <span class=\"string\">&#x27;vue3&#x27;</span>, <span class=\"string\">&#x27;vue4&#x27;</span>]</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> hasBookPublished = <span class=\"title function_\">computed</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">return</span> author.<span class=\"property\">books</span>.<span class=\"property\">length</span> &gt; <span class=\"number\">0</span> ? <span class=\"string\">&#x27;yes&#x27;</span> : <span class=\"string\">&#x27;no&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;&#123; author.name &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span> has published books: </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;&#123; hasBookPublished &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"计算属性缓存-VS-方法\"><a href=\"#计算属性缓存-VS-方法\" class=\"headerlink\" title=\"计算属性缓存 VS 方法\"></a>计算属性缓存 VS 方法</h2><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123; calculateBooksMessage() &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">calculateBooksMessage</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> author.<span class=\"property\">books</span>.<span class=\"property\">length</span> &gt; <span class=\"number\">0</span> ? <span class=\"string\">&#x27;yes&#x27;</span> : <span class=\"string\">&#x27;no&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>计算属性比方法节省性能。</p>\n<p>将与上述相同的函数定义为方法，结果和计算属性相同，然而 <strong>计算属性值会基于其响应式依赖被缓存</strong>，只要<code>author.books</code>不变，就不会重复执行 getter 函数。但是方法总会在重渲染发生时再次执行函数。</p>\n<h2 id=\"可写计算属性\"><a href=\"#可写计算属性\" class=\"headerlink\" title=\"可写计算属性\"></a>可写计算属性</h2><p>计算属性默认为只读。特殊场景下会用到“可写”的计算属性。</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref, computed &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> firstName = <span class=\"title function_\">ref</span>(<span class=\"string\">&#x27;John&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> lastName = <span class=\"title function_\">ref</span>(<span class=\"string\">&#x27;Doe&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> fullName = <span class=\"title function_\">computed</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// getter</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">get</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">return</span> firstName.<span class=\"property\">value</span> + <span class=\"string\">&#x27; &#x27;</span> + lastName.<span class=\"property\">value</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// setter</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">set</span>(<span class=\"params\">newValue</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    [firstName.<span class=\"property\">value</span>, lastName.<span class=\"property\">value</span>] = newValue.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>当运行 <code>fullName.value = &#39;Zoella Wang&#39;</code> 时，setter会被调用，firstName 和 lastName 会随之更新。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"基础\"><a href=\"#基础\" class=\"headerlink\" title=\"基础\"></a>基础</h2><p>computed() 方法接受一个 getter 函数，返回一个计算属性 ref</p>\n<p>因为 ref 会在模板中自动解包，所以在表达式中引用无需 .value</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; reactive, computed &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> author = <span class=\"title function_\">reactive</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">name</span>: <span class=\"string\">&quot;Zoella&quot;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"attr\">books</span>: [<span class=\"string\">&#x27;vue2&#x27;</span>, <span class=\"string\">&#x27;vue3&#x27;</span>, <span class=\"string\">&#x27;vue4&#x27;</span>]</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> hasBookPublished = <span class=\"title function_\">computed</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">return</span> author.<span class=\"property\">books</span>.<span class=\"property\">length</span> &gt; <span class=\"number\">0</span> ? <span class=\"string\">&#x27;yes&#x27;</span> : <span class=\"string\">&#x27;no&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;&#123; author.name &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span> has published books: </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;&#123; hasBookPublished &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"计算属性缓存-VS-方法\"><a href=\"#计算属性缓存-VS-方法\" class=\"headerlink\" title=\"计算属性缓存 VS 方法\"></a>计算属性缓存 VS 方法</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123; calculateBooksMessage() &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">calculateBooksMessage</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> author.<span class=\"property\">books</span>.<span class=\"property\">length</span> &gt; <span class=\"number\">0</span> ? <span class=\"string\">&#x27;yes&#x27;</span> : <span class=\"string\">&#x27;no&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>计算属性比方法节省性能。</p>\n<p>将与上述相同的函数定义为方法，结果和计算属性相同，然而 <strong>计算属性值会基于其响应式依赖被缓存</strong>，只要<code>author.books</code>不变，就不会重复执行 getter 函数。但是方法总会在重渲染发生时再次执行函数。</p>\n<h2 id=\"可写计算属性\"><a href=\"#可写计算属性\" class=\"headerlink\" title=\"可写计算属性\"></a>可写计算属性</h2><p>计算属性默认为只读。特殊场景下会用到“可写”的计算属性。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; ref, computed &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> firstName = <span class=\"title function_\">ref</span>(<span class=\"string\">&#x27;John&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> lastName = <span class=\"title function_\">ref</span>(<span class=\"string\">&#x27;Doe&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">const</span> fullName = <span class=\"title function_\">computed</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// getter</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">get</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">return</span> firstName.<span class=\"property\">value</span> + <span class=\"string\">&#x27; &#x27;</span> + lastName.<span class=\"property\">value</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"comment\">// setter</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">set</span>(<span class=\"params\">newValue</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    [firstName.<span class=\"property\">value</span>, lastName.<span class=\"property\">value</span>] = newValue.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>当运行 <code>fullName.value = &#39;Zoella Wang&#39;</code> 时，setter会被调用，firstName 和 lastName 会随之更新。</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用11-课堂回答","date":"2025-01-15T03:11:13.000Z","_content":"\n略（基本没有新东西），详情可参考课程视频：\n\nhttps://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.videopod.episodes&vd_source=69ac93649ea21c4726fe85f272b6d968&p=11\n","source":"_posts/40-北大区块链-课堂回答.md","raw":"---\ntitle: 北大-区块链技术与应用11-课堂回答\ndate: 2025-01-15 11:11:13\ntags:\n    - web3\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n略（基本没有新东西），详情可参考课程视频：\n\nhttps://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.videopod.episodes&vd_source=69ac93649ea21c4726fe85f272b6d968&p=11\n","slug":"40-北大区块链-课堂回答","published":1,"updated":"2025-05-20T02:47:28.685Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvuc00356kprhqqm2mxc","content":"<p>略（基本没有新东西），详情可参考课程视频：</p>\n<p><a class=\"link\"   href=\"https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.videopod.episodes&vd_source=69ac93649ea21c4726fe85f272b6d968&p=11\" >https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.videopod.episodes&amp;vd_source=69ac93649ea21c4726fe85f272b6d968&amp;p=11<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>略（基本没有新东西），详情可参考课程视频：</p>\n<p><a class=\"link\"   href=\"https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.videopod.episodes&vd_source=69ac93649ea21c4726fe85f272b6d968&p=11\" >https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.videopod.episodes&amp;vd_source=69ac93649ea21c4726fe85f272b6d968&amp;p=11<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用12-BTC的匿名性","date":"2025-01-15T07:26:10.000Z","_content":"\n## 一、比特币的匿名性\n\nanonimity（匿名性）、privacy（隐私性）\n\n比特币使用的是 pseudonymity（假名）\n\nExample：一个人通过自己的两个账户 addr1 和 addr2，向商家账户转账 addr3，然后把零钱转入自己的另一个账户 addr4\n\nInputs: addr1, addr2\n\nOutputs: addr3, addr4\n\n### 1、破坏比特币匿名性的方法：\n\n（1）比特币不同账户之间可以进行关联\n\n（2）比特币可以和实体世界相关联\n\n### 2、Silk road（丝路）\n\nSilk road 是一个非法交易平台，被称为 eBay for illegal drugs，支付手段采用比特币，底层路由采用 TOR（洋葱路由），提供匿名邮寄服务，后被封禁\n\n这说明比特币的匿名性并没有那么好\n\n### 3、如何提高自己比特币的匿名性？\n\n#### （1）Network layer\n\n采用多路由转发，比如 TOR（洋葱路由）\n\n#### （2）Application layer\n\nCoin mixing（混币交易），即把不同人的币混起来。交易所天然具有 coin mixing 的性质，前提是交易所不会泄露任何交易记录\n\n## 二、Zero-knowledge proof（零知识证明）\n\n零知识证明：指证明方向验证者证明一个陈述是正确的，而无需泄露额外的任何信息\n\n### 同态隐藏\n\n#### （1）不会碰撞：如果 x, y 不同，那么它们的加密函数值 E(x) 和 E(y) 也不相同，其逆否命题也成立\n\n#### （2）隐私性：给定 E(x) 的值，很难反推出 x 的值\n\n#### （3）给定 E(x) 和 E(y) 的值，我们可以很容易地计算出某些关于 x, y 的加密函数值\n\n- 同态加法：通过 E(x) 和 E(y) 计算出 E(x+y) 的值\n- 同态乘法：通过 E(x) 和 E(y) 计算出 E(xy) 的值\n- 扩展到多项式\n\n## 三、零币和零钞\n\n零币（zerocoin）和零钞（zerocash）融合了匿名化处理，但仍未解决与实体世界相关联导致的隐私泄露问题\n","source":"_posts/41-北大区块链-BTC匿名性.md","raw":"---\ntitle: 北大-区块链技术与应用12-BTC的匿名性\ndate: 2025-01-15 15:26:10\ntags:\n    - web3\n    - BTC\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n## 一、比特币的匿名性\n\nanonimity（匿名性）、privacy（隐私性）\n\n比特币使用的是 pseudonymity（假名）\n\nExample：一个人通过自己的两个账户 addr1 和 addr2，向商家账户转账 addr3，然后把零钱转入自己的另一个账户 addr4\n\nInputs: addr1, addr2\n\nOutputs: addr3, addr4\n\n### 1、破坏比特币匿名性的方法：\n\n（1）比特币不同账户之间可以进行关联\n\n（2）比特币可以和实体世界相关联\n\n### 2、Silk road（丝路）\n\nSilk road 是一个非法交易平台，被称为 eBay for illegal drugs，支付手段采用比特币，底层路由采用 TOR（洋葱路由），提供匿名邮寄服务，后被封禁\n\n这说明比特币的匿名性并没有那么好\n\n### 3、如何提高自己比特币的匿名性？\n\n#### （1）Network layer\n\n采用多路由转发，比如 TOR（洋葱路由）\n\n#### （2）Application layer\n\nCoin mixing（混币交易），即把不同人的币混起来。交易所天然具有 coin mixing 的性质，前提是交易所不会泄露任何交易记录\n\n## 二、Zero-knowledge proof（零知识证明）\n\n零知识证明：指证明方向验证者证明一个陈述是正确的，而无需泄露额外的任何信息\n\n### 同态隐藏\n\n#### （1）不会碰撞：如果 x, y 不同，那么它们的加密函数值 E(x) 和 E(y) 也不相同，其逆否命题也成立\n\n#### （2）隐私性：给定 E(x) 的值，很难反推出 x 的值\n\n#### （3）给定 E(x) 和 E(y) 的值，我们可以很容易地计算出某些关于 x, y 的加密函数值\n\n- 同态加法：通过 E(x) 和 E(y) 计算出 E(x+y) 的值\n- 同态乘法：通过 E(x) 和 E(y) 计算出 E(xy) 的值\n- 扩展到多项式\n\n## 三、零币和零钞\n\n零币（zerocoin）和零钞（zerocash）融合了匿名化处理，但仍未解决与实体世界相关联导致的隐私泄露问题\n","slug":"41-北大区块链-BTC匿名性","published":1,"updated":"2025-05-20T02:47:28.685Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvuc00396kprgco4029s","content":"<h2 id=\"一、比特币的匿名性\"><a href=\"#一、比特币的匿名性\" class=\"headerlink\" title=\"一、比特币的匿名性\"></a>一、比特币的匿名性</h2><p>anonimity（匿名性）、privacy（隐私性）</p>\n<p>比特币使用的是 pseudonymity（假名）</p>\n<p>Example：一个人通过自己的两个账户 addr1 和 addr2，向商家账户转账 addr3，然后把零钱转入自己的另一个账户 addr4</p>\n<p>Inputs: addr1, addr2</p>\n<p>Outputs: addr3, addr4</p>\n<h3 id=\"1、破坏比特币匿名性的方法：\"><a href=\"#1、破坏比特币匿名性的方法：\" class=\"headerlink\" title=\"1、破坏比特币匿名性的方法：\"></a>1、破坏比特币匿名性的方法：</h3><p>（1）比特币不同账户之间可以进行关联</p>\n<p>（2）比特币可以和实体世界相关联</p>\n<h3 id=\"2、Silk-road（丝路）\"><a href=\"#2、Silk-road（丝路）\" class=\"headerlink\" title=\"2、Silk road（丝路）\"></a>2、Silk road（丝路）</h3><p>Silk road 是一个非法交易平台，被称为 eBay for illegal drugs，支付手段采用比特币，底层路由采用 TOR（洋葱路由），提供匿名邮寄服务，后被封禁</p>\n<p>这说明比特币的匿名性并没有那么好</p>\n<h3 id=\"3、如何提高自己比特币的匿名性？\"><a href=\"#3、如何提高自己比特币的匿名性？\" class=\"headerlink\" title=\"3、如何提高自己比特币的匿名性？\"></a>3、如何提高自己比特币的匿名性？</h3><h4 id=\"（1）Network-layer\"><a href=\"#（1）Network-layer\" class=\"headerlink\" title=\"（1）Network layer\"></a>（1）Network layer</h4><p>采用多路由转发，比如 TOR（洋葱路由）</p>\n<h4 id=\"（2）Application-layer\"><a href=\"#（2）Application-layer\" class=\"headerlink\" title=\"（2）Application layer\"></a>（2）Application layer</h4><p>Coin mixing（混币交易），即把不同人的币混起来。交易所天然具有 coin mixing 的性质，前提是交易所不会泄露任何交易记录</p>\n<h2 id=\"二、Zero-knowledge-proof（零知识证明）\"><a href=\"#二、Zero-knowledge-proof（零知识证明）\" class=\"headerlink\" title=\"二、Zero-knowledge proof（零知识证明）\"></a>二、Zero-knowledge proof（零知识证明）</h2><p>零知识证明：指证明方向验证者证明一个陈述是正确的，而无需泄露额外的任何信息</p>\n<h3 id=\"同态隐藏\"><a href=\"#同态隐藏\" class=\"headerlink\" title=\"同态隐藏\"></a>同态隐藏</h3><h4 id=\"（1）不会碰撞：如果-x-y-不同，那么它们的加密函数值-E-x-和-E-y-也不相同，其逆否命题也成立\"><a href=\"#（1）不会碰撞：如果-x-y-不同，那么它们的加密函数值-E-x-和-E-y-也不相同，其逆否命题也成立\" class=\"headerlink\" title=\"（1）不会碰撞：如果 x, y 不同，那么它们的加密函数值 E(x) 和 E(y) 也不相同，其逆否命题也成立\"></a>（1）不会碰撞：如果 x, y 不同，那么它们的加密函数值 E(x) 和 E(y) 也不相同，其逆否命题也成立</h4><h4 id=\"（2）隐私性：给定-E-x-的值，很难反推出-x-的值\"><a href=\"#（2）隐私性：给定-E-x-的值，很难反推出-x-的值\" class=\"headerlink\" title=\"（2）隐私性：给定 E(x) 的值，很难反推出 x 的值\"></a>（2）隐私性：给定 E(x) 的值，很难反推出 x 的值</h4><h4 id=\"（3）给定-E-x-和-E-y-的值，我们可以很容易地计算出某些关于-x-y-的加密函数值\"><a href=\"#（3）给定-E-x-和-E-y-的值，我们可以很容易地计算出某些关于-x-y-的加密函数值\" class=\"headerlink\" title=\"（3）给定 E(x) 和 E(y) 的值，我们可以很容易地计算出某些关于 x, y 的加密函数值\"></a>（3）给定 E(x) 和 E(y) 的值，我们可以很容易地计算出某些关于 x, y 的加密函数值</h4><ul>\n<li>同态加法：通过 E(x) 和 E(y) 计算出 E(x+y) 的值</li>\n<li>同态乘法：通过 E(x) 和 E(y) 计算出 E(xy) 的值</li>\n<li>扩展到多项式</li>\n</ul>\n<h2 id=\"三、零币和零钞\"><a href=\"#三、零币和零钞\" class=\"headerlink\" title=\"三、零币和零钞\"></a>三、零币和零钞</h2><p>零币（zerocoin）和零钞（zerocash）融合了匿名化处理，但仍未解决与实体世界相关联导致的隐私泄露问题</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、比特币的匿名性\"><a href=\"#一、比特币的匿名性\" class=\"headerlink\" title=\"一、比特币的匿名性\"></a>一、比特币的匿名性</h2><p>anonimity（匿名性）、privacy（隐私性）</p>\n<p>比特币使用的是 pseudonymity（假名）</p>\n<p>Example：一个人通过自己的两个账户 addr1 和 addr2，向商家账户转账 addr3，然后把零钱转入自己的另一个账户 addr4</p>\n<p>Inputs: addr1, addr2</p>\n<p>Outputs: addr3, addr4</p>\n<h3 id=\"1、破坏比特币匿名性的方法：\"><a href=\"#1、破坏比特币匿名性的方法：\" class=\"headerlink\" title=\"1、破坏比特币匿名性的方法：\"></a>1、破坏比特币匿名性的方法：</h3><p>（1）比特币不同账户之间可以进行关联</p>\n<p>（2）比特币可以和实体世界相关联</p>\n<h3 id=\"2、Silk-road（丝路）\"><a href=\"#2、Silk-road（丝路）\" class=\"headerlink\" title=\"2、Silk road（丝路）\"></a>2、Silk road（丝路）</h3><p>Silk road 是一个非法交易平台，被称为 eBay for illegal drugs，支付手段采用比特币，底层路由采用 TOR（洋葱路由），提供匿名邮寄服务，后被封禁</p>\n<p>这说明比特币的匿名性并没有那么好</p>\n<h3 id=\"3、如何提高自己比特币的匿名性？\"><a href=\"#3、如何提高自己比特币的匿名性？\" class=\"headerlink\" title=\"3、如何提高自己比特币的匿名性？\"></a>3、如何提高自己比特币的匿名性？</h3><h4 id=\"（1）Network-layer\"><a href=\"#（1）Network-layer\" class=\"headerlink\" title=\"（1）Network layer\"></a>（1）Network layer</h4><p>采用多路由转发，比如 TOR（洋葱路由）</p>\n<h4 id=\"（2）Application-layer\"><a href=\"#（2）Application-layer\" class=\"headerlink\" title=\"（2）Application layer\"></a>（2）Application layer</h4><p>Coin mixing（混币交易），即把不同人的币混起来。交易所天然具有 coin mixing 的性质，前提是交易所不会泄露任何交易记录</p>\n<h2 id=\"二、Zero-knowledge-proof（零知识证明）\"><a href=\"#二、Zero-knowledge-proof（零知识证明）\" class=\"headerlink\" title=\"二、Zero-knowledge proof（零知识证明）\"></a>二、Zero-knowledge proof（零知识证明）</h2><p>零知识证明：指证明方向验证者证明一个陈述是正确的，而无需泄露额外的任何信息</p>\n<h3 id=\"同态隐藏\"><a href=\"#同态隐藏\" class=\"headerlink\" title=\"同态隐藏\"></a>同态隐藏</h3><h4 id=\"（1）不会碰撞：如果-x-y-不同，那么它们的加密函数值-E-x-和-E-y-也不相同，其逆否命题也成立\"><a href=\"#（1）不会碰撞：如果-x-y-不同，那么它们的加密函数值-E-x-和-E-y-也不相同，其逆否命题也成立\" class=\"headerlink\" title=\"（1）不会碰撞：如果 x, y 不同，那么它们的加密函数值 E(x) 和 E(y) 也不相同，其逆否命题也成立\"></a>（1）不会碰撞：如果 x, y 不同，那么它们的加密函数值 E(x) 和 E(y) 也不相同，其逆否命题也成立</h4><h4 id=\"（2）隐私性：给定-E-x-的值，很难反推出-x-的值\"><a href=\"#（2）隐私性：给定-E-x-的值，很难反推出-x-的值\" class=\"headerlink\" title=\"（2）隐私性：给定 E(x) 的值，很难反推出 x 的值\"></a>（2）隐私性：给定 E(x) 的值，很难反推出 x 的值</h4><h4 id=\"（3）给定-E-x-和-E-y-的值，我们可以很容易地计算出某些关于-x-y-的加密函数值\"><a href=\"#（3）给定-E-x-和-E-y-的值，我们可以很容易地计算出某些关于-x-y-的加密函数值\" class=\"headerlink\" title=\"（3）给定 E(x) 和 E(y) 的值，我们可以很容易地计算出某些关于 x, y 的加密函数值\"></a>（3）给定 E(x) 和 E(y) 的值，我们可以很容易地计算出某些关于 x, y 的加密函数值</h4><ul>\n<li>同态加法：通过 E(x) 和 E(y) 计算出 E(x+y) 的值</li>\n<li>同态乘法：通过 E(x) 和 E(y) 计算出 E(xy) 的值</li>\n<li>扩展到多项式</li>\n</ul>\n<h2 id=\"三、零币和零钞\"><a href=\"#三、零币和零钞\" class=\"headerlink\" title=\"三、零币和零钞\"></a>三、零币和零钞</h2><p>零币（zerocoin）和零钞（zerocash）融合了匿名化处理，但仍未解决与实体世界相关联导致的隐私泄露问题</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用13-BTC引发的思考","date":"2025-01-15T08:49:43.000Z","tags:tags":["web3","BTC"],"_content":"\n## 一、哈希指针\n\n指针保存的是本地的内存地址，区块链中的哈希指针是如何传递的？其实区块中保存的只有哈希，没有指针（只是形象化的说法）。全节点会把区块以 (key, value) 存储在数据库（level DB）中，且只保存最近的几千个区块\n\n## 二、区块恋\n\n双方把私钥截成两段，每方保存一段不可取，有两点问题：\n- 蛮力攻击更加容易\n- 永久占据 UTXO，浪费资源\n\n建议采取 MULTISIG（多重签名）\n\n## 三、比特币中的稀缺性\n\n比特币的总量是确定的，这种“稀缺”的东西不适合作为货币，一个好的货币需要有通货膨胀的功能；否则随着社会财富的增加，总量一定的货币会越来越值钱，先来者躺平，后来者买不起（类比国内房地产）\n\n## 四、量子计算\n\n量子计算技术离使用还差的很远，就算有一天量子计算能够破解现有的加密体系，首先冲击的是传统金融业；并且后面还会有量子加密算法\n\n比特币并没有直接暴露账户的公钥，而是把公钥取哈希得到一个地址。假设量子计算使得从公钥推出私钥变为可能，比特币还有另一层防护：使用的是公钥哈希，首先需要通过地址推出公钥，而取哈希是不可逆的，因为取哈希的过程中存在信息丢失（比如任意长度的公钥都能通过 SHA-256 压缩成 256位）\n\n从 安全性 和 隐私保护 的角度看，比特币的一个地址一旦用过后，就不要再用了，每次从一个地址取钱时，最好把所有钱都取走，除了支付的钱，剩下的转给自己的另外一个账户\n\n如果担心量子计算的威胁，即使是公钥也不要随意泄露\n","source":"_posts/42-北大区块链-BTC引发的思考.md","raw":"---\ntitle: 北大-区块链技术与应用13-BTC引发的思考\ndate: 2025-01-15 16:49:43\ntags:tags:\n    - web3\n    - BTC\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n## 一、哈希指针\n\n指针保存的是本地的内存地址，区块链中的哈希指针是如何传递的？其实区块中保存的只有哈希，没有指针（只是形象化的说法）。全节点会把区块以 (key, value) 存储在数据库（level DB）中，且只保存最近的几千个区块\n\n## 二、区块恋\n\n双方把私钥截成两段，每方保存一段不可取，有两点问题：\n- 蛮力攻击更加容易\n- 永久占据 UTXO，浪费资源\n\n建议采取 MULTISIG（多重签名）\n\n## 三、比特币中的稀缺性\n\n比特币的总量是确定的，这种“稀缺”的东西不适合作为货币，一个好的货币需要有通货膨胀的功能；否则随着社会财富的增加，总量一定的货币会越来越值钱，先来者躺平，后来者买不起（类比国内房地产）\n\n## 四、量子计算\n\n量子计算技术离使用还差的很远，就算有一天量子计算能够破解现有的加密体系，首先冲击的是传统金融业；并且后面还会有量子加密算法\n\n比特币并没有直接暴露账户的公钥，而是把公钥取哈希得到一个地址。假设量子计算使得从公钥推出私钥变为可能，比特币还有另一层防护：使用的是公钥哈希，首先需要通过地址推出公钥，而取哈希是不可逆的，因为取哈希的过程中存在信息丢失（比如任意长度的公钥都能通过 SHA-256 压缩成 256位）\n\n从 安全性 和 隐私保护 的角度看，比特币的一个地址一旦用过后，就不要再用了，每次从一个地址取钱时，最好把所有钱都取走，除了支付的钱，剩下的转给自己的另外一个账户\n\n如果担心量子计算的威胁，即使是公钥也不要随意泄露\n","slug":"42-北大区块链-BTC引发的思考","published":1,"updated":"2025-05-20T02:47:28.685Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvuc003c6kpr66dq8hg6","content":"<h2 id=\"一、哈希指针\"><a href=\"#一、哈希指针\" class=\"headerlink\" title=\"一、哈希指针\"></a>一、哈希指针</h2><p>指针保存的是本地的内存地址，区块链中的哈希指针是如何传递的？其实区块中保存的只有哈希，没有指针（只是形象化的说法）。全节点会把区块以 (key, value) 存储在数据库（level DB）中，且只保存最近的几千个区块</p>\n<h2 id=\"二、区块恋\"><a href=\"#二、区块恋\" class=\"headerlink\" title=\"二、区块恋\"></a>二、区块恋</h2><p>双方把私钥截成两段，每方保存一段不可取，有两点问题：</p>\n<ul>\n<li>蛮力攻击更加容易</li>\n<li>永久占据 UTXO，浪费资源</li>\n</ul>\n<p>建议采取 MULTISIG（多重签名）</p>\n<h2 id=\"三、比特币中的稀缺性\"><a href=\"#三、比特币中的稀缺性\" class=\"headerlink\" title=\"三、比特币中的稀缺性\"></a>三、比特币中的稀缺性</h2><p>比特币的总量是确定的，这种“稀缺”的东西不适合作为货币，一个好的货币需要有通货膨胀的功能；否则随着社会财富的增加，总量一定的货币会越来越值钱，先来者躺平，后来者买不起（类比国内房地产）</p>\n<h2 id=\"四、量子计算\"><a href=\"#四、量子计算\" class=\"headerlink\" title=\"四、量子计算\"></a>四、量子计算</h2><p>量子计算技术离使用还差的很远，就算有一天量子计算能够破解现有的加密体系，首先冲击的是传统金融业；并且后面还会有量子加密算法</p>\n<p>比特币并没有直接暴露账户的公钥，而是把公钥取哈希得到一个地址。假设量子计算使得从公钥推出私钥变为可能，比特币还有另一层防护：使用的是公钥哈希，首先需要通过地址推出公钥，而取哈希是不可逆的，因为取哈希的过程中存在信息丢失（比如任意长度的公钥都能通过 SHA-256 压缩成 256位）</p>\n<p>从 安全性 和 隐私保护 的角度看，比特币的一个地址一旦用过后，就不要再用了，每次从一个地址取钱时，最好把所有钱都取走，除了支付的钱，剩下的转给自己的另外一个账户</p>\n<p>如果担心量子计算的威胁，即使是公钥也不要随意泄露</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、哈希指针\"><a href=\"#一、哈希指针\" class=\"headerlink\" title=\"一、哈希指针\"></a>一、哈希指针</h2><p>指针保存的是本地的内存地址，区块链中的哈希指针是如何传递的？其实区块中保存的只有哈希，没有指针（只是形象化的说法）。全节点会把区块以 (key, value) 存储在数据库（level DB）中，且只保存最近的几千个区块</p>\n<h2 id=\"二、区块恋\"><a href=\"#二、区块恋\" class=\"headerlink\" title=\"二、区块恋\"></a>二、区块恋</h2><p>双方把私钥截成两段，每方保存一段不可取，有两点问题：</p>\n<ul>\n<li>蛮力攻击更加容易</li>\n<li>永久占据 UTXO，浪费资源</li>\n</ul>\n<p>建议采取 MULTISIG（多重签名）</p>\n<h2 id=\"三、比特币中的稀缺性\"><a href=\"#三、比特币中的稀缺性\" class=\"headerlink\" title=\"三、比特币中的稀缺性\"></a>三、比特币中的稀缺性</h2><p>比特币的总量是确定的，这种“稀缺”的东西不适合作为货币，一个好的货币需要有通货膨胀的功能；否则随着社会财富的增加，总量一定的货币会越来越值钱，先来者躺平，后来者买不起（类比国内房地产）</p>\n<h2 id=\"四、量子计算\"><a href=\"#四、量子计算\" class=\"headerlink\" title=\"四、量子计算\"></a>四、量子计算</h2><p>量子计算技术离使用还差的很远，就算有一天量子计算能够破解现有的加密体系，首先冲击的是传统金融业；并且后面还会有量子加密算法</p>\n<p>比特币并没有直接暴露账户的公钥，而是把公钥取哈希得到一个地址。假设量子计算使得从公钥推出私钥变为可能，比特币还有另一层防护：使用的是公钥哈希，首先需要通过地址推出公钥，而取哈希是不可逆的，因为取哈希的过程中存在信息丢失（比如任意长度的公钥都能通过 SHA-256 压缩成 256位）</p>\n<p>从 安全性 和 隐私保护 的角度看，比特币的一个地址一旦用过后，就不要再用了，每次从一个地址取钱时，最好把所有钱都取走，除了支付的钱，剩下的转给自己的另外一个账户</p>\n<p>如果担心量子计算的威胁，即使是公钥也不要随意泄露</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用14-ETH概述","date":"2025-01-15T12:10:24.000Z","_content":"\n比特币被称为 区块链1.0，以太坊被称为 区块链2.0\n\n## 一、以太坊和区块链的对比\n\n### 1、出块时间\n\n以太坊的出块时间从比特币的 10分钟 降低到了十几秒\n\n### 2、共识机制\n\n以太坊设计了新的 ghost 共识机制\n\n### 3、mining puzzle\n\n以太坊设计了新的 mining puzzle：比特币的 mining puzzle 是计算型的，比拼的是算力；而以太坊的 mining puzzle 是 memory hard，对内存的要求很高，从而限制了 ASIC 芯片的使用（ASIC resistance）\n\n### 4、证明机制\n\n以太坊用 POS（proof of stake，权益证明） 来替代 POW（proof of work，工作量证明）\n\n### 5、智能合约\n\n以太坊增加了对 smart contract（智能合约）的支持\n\n#### （1）BitCoin：decentralized currency（去中心化货币）\n\n在跨国转账方面，fiat currency（法定货币）不如比特币\n\n#### （2）Etherem：decentralized contract（去中心化协议）\n\n类似的，在跨国协议方面，去中心化协议也有优势\n\n### 6、最小单位\n\n比特币的最小单位是 Satoshi（聪）；而以太坊的货币叫做 Ether（以太），最小单位是 Wei\n","source":"_posts/43-北大区块链-ETH概述.md","raw":"---\ntitle: 北大-区块链技术与应用14-ETH概述\ndate: 2025-01-15 20:10:24\ntags:\n    - web3\n    - ETH\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n比特币被称为 区块链1.0，以太坊被称为 区块链2.0\n\n## 一、以太坊和区块链的对比\n\n### 1、出块时间\n\n以太坊的出块时间从比特币的 10分钟 降低到了十几秒\n\n### 2、共识机制\n\n以太坊设计了新的 ghost 共识机制\n\n### 3、mining puzzle\n\n以太坊设计了新的 mining puzzle：比特币的 mining puzzle 是计算型的，比拼的是算力；而以太坊的 mining puzzle 是 memory hard，对内存的要求很高，从而限制了 ASIC 芯片的使用（ASIC resistance）\n\n### 4、证明机制\n\n以太坊用 POS（proof of stake，权益证明） 来替代 POW（proof of work，工作量证明）\n\n### 5、智能合约\n\n以太坊增加了对 smart contract（智能合约）的支持\n\n#### （1）BitCoin：decentralized currency（去中心化货币）\n\n在跨国转账方面，fiat currency（法定货币）不如比特币\n\n#### （2）Etherem：decentralized contract（去中心化协议）\n\n类似的，在跨国协议方面，去中心化协议也有优势\n\n### 6、最小单位\n\n比特币的最小单位是 Satoshi（聪）；而以太坊的货币叫做 Ether（以太），最小单位是 Wei\n","slug":"43-北大区块链-ETH概述","published":1,"updated":"2025-05-20T02:47:28.685Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvuc003g6kprhc7c8mtt","content":"<p>比特币被称为 区块链1.0，以太坊被称为 区块链2.0</p>\n<h2 id=\"一、以太坊和区块链的对比\"><a href=\"#一、以太坊和区块链的对比\" class=\"headerlink\" title=\"一、以太坊和区块链的对比\"></a>一、以太坊和区块链的对比</h2><h3 id=\"1、出块时间\"><a href=\"#1、出块时间\" class=\"headerlink\" title=\"1、出块时间\"></a>1、出块时间</h3><p>以太坊的出块时间从比特币的 10分钟 降低到了十几秒</p>\n<h3 id=\"2、共识机制\"><a href=\"#2、共识机制\" class=\"headerlink\" title=\"2、共识机制\"></a>2、共识机制</h3><p>以太坊设计了新的 ghost 共识机制</p>\n<h3 id=\"3、mining-puzzle\"><a href=\"#3、mining-puzzle\" class=\"headerlink\" title=\"3、mining puzzle\"></a>3、mining puzzle</h3><p>以太坊设计了新的 mining puzzle：比特币的 mining puzzle 是计算型的，比拼的是算力；而以太坊的 mining puzzle 是 memory hard，对内存的要求很高，从而限制了 ASIC 芯片的使用（ASIC resistance）</p>\n<h3 id=\"4、证明机制\"><a href=\"#4、证明机制\" class=\"headerlink\" title=\"4、证明机制\"></a>4、证明机制</h3><p>以太坊用 POS（proof of stake，权益证明） 来替代 POW（proof of work，工作量证明）</p>\n<h3 id=\"5、智能合约\"><a href=\"#5、智能合约\" class=\"headerlink\" title=\"5、智能合约\"></a>5、智能合约</h3><p>以太坊增加了对 smart contract（智能合约）的支持</p>\n<h4 id=\"（1）BitCoin：decentralized-currency（去中心化货币）\"><a href=\"#（1）BitCoin：decentralized-currency（去中心化货币）\" class=\"headerlink\" title=\"（1）BitCoin：decentralized currency（去中心化货币）\"></a>（1）BitCoin：decentralized currency（去中心化货币）</h4><p>在跨国转账方面，fiat currency（法定货币）不如比特币</p>\n<h4 id=\"（2）Etherem：decentralized-contract（去中心化协议）\"><a href=\"#（2）Etherem：decentralized-contract（去中心化协议）\" class=\"headerlink\" title=\"（2）Etherem：decentralized contract（去中心化协议）\"></a>（2）Etherem：decentralized contract（去中心化协议）</h4><p>类似的，在跨国协议方面，去中心化协议也有优势</p>\n<h3 id=\"6、最小单位\"><a href=\"#6、最小单位\" class=\"headerlink\" title=\"6、最小单位\"></a>6、最小单位</h3><p>比特币的最小单位是 Satoshi（聪）；而以太坊的货币叫做 Ether（以太），最小单位是 Wei</p>\n","site":{"data":{}},"excerpt":"","more":"<p>比特币被称为 区块链1.0，以太坊被称为 区块链2.0</p>\n<h2 id=\"一、以太坊和区块链的对比\"><a href=\"#一、以太坊和区块链的对比\" class=\"headerlink\" title=\"一、以太坊和区块链的对比\"></a>一、以太坊和区块链的对比</h2><h3 id=\"1、出块时间\"><a href=\"#1、出块时间\" class=\"headerlink\" title=\"1、出块时间\"></a>1、出块时间</h3><p>以太坊的出块时间从比特币的 10分钟 降低到了十几秒</p>\n<h3 id=\"2、共识机制\"><a href=\"#2、共识机制\" class=\"headerlink\" title=\"2、共识机制\"></a>2、共识机制</h3><p>以太坊设计了新的 ghost 共识机制</p>\n<h3 id=\"3、mining-puzzle\"><a href=\"#3、mining-puzzle\" class=\"headerlink\" title=\"3、mining puzzle\"></a>3、mining puzzle</h3><p>以太坊设计了新的 mining puzzle：比特币的 mining puzzle 是计算型的，比拼的是算力；而以太坊的 mining puzzle 是 memory hard，对内存的要求很高，从而限制了 ASIC 芯片的使用（ASIC resistance）</p>\n<h3 id=\"4、证明机制\"><a href=\"#4、证明机制\" class=\"headerlink\" title=\"4、证明机制\"></a>4、证明机制</h3><p>以太坊用 POS（proof of stake，权益证明） 来替代 POW（proof of work，工作量证明）</p>\n<h3 id=\"5、智能合约\"><a href=\"#5、智能合约\" class=\"headerlink\" title=\"5、智能合约\"></a>5、智能合约</h3><p>以太坊增加了对 smart contract（智能合约）的支持</p>\n<h4 id=\"（1）BitCoin：decentralized-currency（去中心化货币）\"><a href=\"#（1）BitCoin：decentralized-currency（去中心化货币）\" class=\"headerlink\" title=\"（1）BitCoin：decentralized currency（去中心化货币）\"></a>（1）BitCoin：decentralized currency（去中心化货币）</h4><p>在跨国转账方面，fiat currency（法定货币）不如比特币</p>\n<h4 id=\"（2）Etherem：decentralized-contract（去中心化协议）\"><a href=\"#（2）Etherem：decentralized-contract（去中心化协议）\" class=\"headerlink\" title=\"（2）Etherem：decentralized contract（去中心化协议）\"></a>（2）Etherem：decentralized contract（去中心化协议）</h4><p>类似的，在跨国协议方面，去中心化协议也有优势</p>\n<h3 id=\"6、最小单位\"><a href=\"#6、最小单位\" class=\"headerlink\" title=\"6、最小单位\"></a>6、最小单位</h3><p>比特币的最小单位是 Satoshi（聪）；而以太坊的货币叫做 Ether（以太），最小单位是 Wei</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用15-ETH的账户","date":"2025-01-15T13:12:23.000Z","_content":"\n## 一、比特币——基于交易的账本\n\n比特币用的是 transaction-based ledger（基于交易的账本），系统没有显示地记录账户的金额，需要通过 UTXO 计算，这种方式隐私性好，但不便于使用\n\n## 二、以太坊——基于账户的账本\n\n以太坊用的是 account-based ledger（基于账户的账本），转账时不需要说明币的来源\n\n### 1、好处\n\n不会出现 double spending attack（双花攻击——花钱的人不诚实）\n\n### 2、缺点\n\n需要预防 replay attack（重放攻击——收钱的人不诚实），一次交易被恶意节点广播多次\n\n通过增加一个计数器 nonce，用来记录某账户交易的次数，转账时交易次数要成为交易内容的一部分，都受到发布交易者签名的保护；如果发起重放攻击，交易中 nonce 的值和计数器的值相等，会被校验为不合法（合法的应该比计数器大 1）\n\n![图一](../images/44/1.png)\n\n## 三、以太坊的账户类型\n\n### 1、Extranally owned account（外部账户）\n\n外部账户类似于比特币的账户，通过公私钥控制，也叫做普通账户。一个外部账户的状态有 balance（账户余额）和 nonce（计数器）\n\n### 2、Smart contract account（合约账户）\n\n合约账户不是通过公私钥对控制，不能主动发起交易（只有外部账户可以）。合约账户除了 balance（账户余额），nonce（计数器），还有 code（代码） 和 storage（状态/存储）\n\n合约账户如何调用？创建合约时，会返回一个地址，知道合约的地址，就能调用合约，调用过程中状态会发生变化，但是代码是不变的\n\n以太坊的创始人是 Vitalik。现在有人提出用智能合约生成一些 financial derivative（金融衍生品），比如：期权、期货\n","source":"_posts/44-北大区块链-ETH账户.md","raw":"---\ntitle: 北大-区块链技术与应用15-ETH的账户\ndate: 2025-01-15 21:12:23\ntags:\n    - web3\n    - ETH\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n## 一、比特币——基于交易的账本\n\n比特币用的是 transaction-based ledger（基于交易的账本），系统没有显示地记录账户的金额，需要通过 UTXO 计算，这种方式隐私性好，但不便于使用\n\n## 二、以太坊——基于账户的账本\n\n以太坊用的是 account-based ledger（基于账户的账本），转账时不需要说明币的来源\n\n### 1、好处\n\n不会出现 double spending attack（双花攻击——花钱的人不诚实）\n\n### 2、缺点\n\n需要预防 replay attack（重放攻击——收钱的人不诚实），一次交易被恶意节点广播多次\n\n通过增加一个计数器 nonce，用来记录某账户交易的次数，转账时交易次数要成为交易内容的一部分，都受到发布交易者签名的保护；如果发起重放攻击，交易中 nonce 的值和计数器的值相等，会被校验为不合法（合法的应该比计数器大 1）\n\n![图一](../images/44/1.png)\n\n## 三、以太坊的账户类型\n\n### 1、Extranally owned account（外部账户）\n\n外部账户类似于比特币的账户，通过公私钥控制，也叫做普通账户。一个外部账户的状态有 balance（账户余额）和 nonce（计数器）\n\n### 2、Smart contract account（合约账户）\n\n合约账户不是通过公私钥对控制，不能主动发起交易（只有外部账户可以）。合约账户除了 balance（账户余额），nonce（计数器），还有 code（代码） 和 storage（状态/存储）\n\n合约账户如何调用？创建合约时，会返回一个地址，知道合约的地址，就能调用合约，调用过程中状态会发生变化，但是代码是不变的\n\n以太坊的创始人是 Vitalik。现在有人提出用智能合约生成一些 financial derivative（金融衍生品），比如：期权、期货\n","slug":"44-北大区块链-ETH账户","published":1,"updated":"2025-05-20T02:47:28.685Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvuc003k6kprbpe04ljc","content":"<h2 id=\"一、比特币——基于交易的账本\"><a href=\"#一、比特币——基于交易的账本\" class=\"headerlink\" title=\"一、比特币——基于交易的账本\"></a>一、比特币——基于交易的账本</h2><p>比特币用的是 transaction-based ledger（基于交易的账本），系统没有显示地记录账户的金额，需要通过 UTXO 计算，这种方式隐私性好，但不便于使用</p>\n<h2 id=\"二、以太坊——基于账户的账本\"><a href=\"#二、以太坊——基于账户的账本\" class=\"headerlink\" title=\"二、以太坊——基于账户的账本\"></a>二、以太坊——基于账户的账本</h2><p>以太坊用的是 account-based ledger（基于账户的账本），转账时不需要说明币的来源</p>\n<h3 id=\"1、好处\"><a href=\"#1、好处\" class=\"headerlink\" title=\"1、好处\"></a>1、好处</h3><p>不会出现 double spending attack（双花攻击——花钱的人不诚实）</p>\n<h3 id=\"2、缺点\"><a href=\"#2、缺点\" class=\"headerlink\" title=\"2、缺点\"></a>2、缺点</h3><p>需要预防 replay attack（重放攻击——收钱的人不诚实），一次交易被恶意节点广播多次</p>\n<p>通过增加一个计数器 nonce，用来记录某账户交易的次数，转账时交易次数要成为交易内容的一部分，都受到发布交易者签名的保护；如果发起重放攻击，交易中 nonce 的值和计数器的值相等，会被校验为不合法（合法的应该比计数器大 1）</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/44/1.png\"\n                      alt=\"图一\"\n                ></p>\n<h2 id=\"三、以太坊的账户类型\"><a href=\"#三、以太坊的账户类型\" class=\"headerlink\" title=\"三、以太坊的账户类型\"></a>三、以太坊的账户类型</h2><h3 id=\"1、Extranally-owned-account（外部账户）\"><a href=\"#1、Extranally-owned-account（外部账户）\" class=\"headerlink\" title=\"1、Extranally owned account（外部账户）\"></a>1、Extranally owned account（外部账户）</h3><p>外部账户类似于比特币的账户，通过公私钥控制，也叫做普通账户。一个外部账户的状态有 balance（账户余额）和 nonce（计数器）</p>\n<h3 id=\"2、Smart-contract-account（合约账户）\"><a href=\"#2、Smart-contract-account（合约账户）\" class=\"headerlink\" title=\"2、Smart contract account（合约账户）\"></a>2、Smart contract account（合约账户）</h3><p>合约账户不是通过公私钥对控制，不能主动发起交易（只有外部账户可以）。合约账户除了 balance（账户余额），nonce（计数器），还有 code（代码） 和 storage（状态&#x2F;存储）</p>\n<p>合约账户如何调用？创建合约时，会返回一个地址，知道合约的地址，就能调用合约，调用过程中状态会发生变化，但是代码是不变的</p>\n<p>以太坊的创始人是 Vitalik。现在有人提出用智能合约生成一些 financial derivative（金融衍生品），比如：期权、期货</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、比特币——基于交易的账本\"><a href=\"#一、比特币——基于交易的账本\" class=\"headerlink\" title=\"一、比特币——基于交易的账本\"></a>一、比特币——基于交易的账本</h2><p>比特币用的是 transaction-based ledger（基于交易的账本），系统没有显示地记录账户的金额，需要通过 UTXO 计算，这种方式隐私性好，但不便于使用</p>\n<h2 id=\"二、以太坊——基于账户的账本\"><a href=\"#二、以太坊——基于账户的账本\" class=\"headerlink\" title=\"二、以太坊——基于账户的账本\"></a>二、以太坊——基于账户的账本</h2><p>以太坊用的是 account-based ledger（基于账户的账本），转账时不需要说明币的来源</p>\n<h3 id=\"1、好处\"><a href=\"#1、好处\" class=\"headerlink\" title=\"1、好处\"></a>1、好处</h3><p>不会出现 double spending attack（双花攻击——花钱的人不诚实）</p>\n<h3 id=\"2、缺点\"><a href=\"#2、缺点\" class=\"headerlink\" title=\"2、缺点\"></a>2、缺点</h3><p>需要预防 replay attack（重放攻击——收钱的人不诚实），一次交易被恶意节点广播多次</p>\n<p>通过增加一个计数器 nonce，用来记录某账户交易的次数，转账时交易次数要成为交易内容的一部分，都受到发布交易者签名的保护；如果发起重放攻击，交易中 nonce 的值和计数器的值相等，会被校验为不合法（合法的应该比计数器大 1）</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/44/1.png\"\n                      alt=\"图一\"\n                ></p>\n<h2 id=\"三、以太坊的账户类型\"><a href=\"#三、以太坊的账户类型\" class=\"headerlink\" title=\"三、以太坊的账户类型\"></a>三、以太坊的账户类型</h2><h3 id=\"1、Extranally-owned-account（外部账户）\"><a href=\"#1、Extranally-owned-account（外部账户）\" class=\"headerlink\" title=\"1、Extranally owned account（外部账户）\"></a>1、Extranally owned account（外部账户）</h3><p>外部账户类似于比特币的账户，通过公私钥控制，也叫做普通账户。一个外部账户的状态有 balance（账户余额）和 nonce（计数器）</p>\n<h3 id=\"2、Smart-contract-account（合约账户）\"><a href=\"#2、Smart-contract-account（合约账户）\" class=\"headerlink\" title=\"2、Smart contract account（合约账户）\"></a>2、Smart contract account（合约账户）</h3><p>合约账户不是通过公私钥对控制，不能主动发起交易（只有外部账户可以）。合约账户除了 balance（账户余额），nonce（计数器），还有 code（代码） 和 storage（状态&#x2F;存储）</p>\n<p>合约账户如何调用？创建合约时，会返回一个地址，知道合约的地址，就能调用合约，调用过程中状态会发生变化，但是代码是不变的</p>\n<p>以太坊的创始人是 Vitalik。现在有人提出用智能合约生成一些 financial derivative（金融衍生品），比如：期权、期货</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用16-ETH中的状态树","date":"2025-01-15T13:43:47.000Z","_content":"\n从账户地址到账户状态的映射：addr -> state\n\n以太坊中的账户地址是 160 bits，也就是 20字节，一般表示为 40个 16进制的数；比特币和以太坊的地址格式、长度都不同，但是以太坊中的地址也是由公钥转换来的（公钥取哈希、进行截取，并只保留后面）\n\n在比特币中，merkle tree 除了证明账户上有多少钱之外，还可以维护各个全节点之间状态的一致性\n\n## 以太坊的状态树结构\n\n以太坊采用的数据结构是 MPT（‌Merkle Patricia Tree，默克尔前缀树/压缩前缀树），基于 trie（单词查找树）\n\n### 一、Trie \n\n![图一](../images/45/1.png)\n\n#### 1、优点\n\n（1）Trie 每个节点的分支数目，取决于 key 每个元素的取值范围，以太坊的 branching factor 是 17（0~f，加结束位）\n\n（2）Trie 的查找效率取决于 key 的长度，越长查找次数越多，以太坊 key 值的长度都是 40\n\n（3）比起 key-value 对，trie 不会出现哈希碰撞\n\n（4）Trie 生成的树和插入顺序无关\n\n（5）Trie 中的更新操作具有局部性\n\n#### 2、缺点\n\n一脉单传，存储浪费空间，于是就引入了 MPT\n\n### 二、MPT\n\n![图二](../images/45/2.png)\n\nMPT 对树的高度进行压缩，访问内存的次数减少，提高效率。路径压缩在键值分布比较稀疏的情况下，效果比较好\n\n以太坊中的地址是 160 bits，地址空间为 2^160，因此以太坊账户地址的键值分布非常稀疏。地址这么长的原因是防止哈希碰撞（不同公钥哈希后的值相同）\n\nMerkle tree 比起 binary tree，把普通指针换成哈希指针；同样的，MPT 比起 PT，也是把普通指针换成哈希指针，最后计算出根哈希值\n\n#### 1、根哈希值的作用\n\n（1）防止篡改\n\n（2）merkle proof，证明账户余额\n\n（3）和 sorted merkle tree 一样，可以证明账户是否存在\n\n#### 2、Modified MPT\n\n以太坊用的是 modified MPT\n\n![图三](../images/45/3.png)\n\n以太坊之所以会保留历史状态，是为了便于回滚\n\n![图四](../images/45/4.png)\n\n### 三、状态树的数据结构\n\n![图五](../images/45/5.png)\n\n![图六](../images/45/6.png)\n\n![图七](../images/45/7.png)\n\n\n### 四、状态树中的状态\n\n状态树中保存的是 (key, value)，value（账户的状态）是通过 RLP（Recursive Length Prefix，递归长度前缀，特点是极简）序列化之后存储在账户中的\n\nProtobuf（protocol buffer）是一个做数据序列化的常用库，只支持一种类型：nested array of bytes（嵌套字节数组）\n\n以太坊中的所有其它类型（整数、哈希），最终都要变成嵌套字节数组，实现 RLP 比嵌套字节数组容易很多\n","source":"_posts/45-北大区块链-ETH状态树.md","raw":"---\ntitle: 北大-区块链技术与应用16-ETH中的状态树\ndate: 2025-01-15 21:43:47\ntags:\n    - web3\n    - ETH\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n从账户地址到账户状态的映射：addr -> state\n\n以太坊中的账户地址是 160 bits，也就是 20字节，一般表示为 40个 16进制的数；比特币和以太坊的地址格式、长度都不同，但是以太坊中的地址也是由公钥转换来的（公钥取哈希、进行截取，并只保留后面）\n\n在比特币中，merkle tree 除了证明账户上有多少钱之外，还可以维护各个全节点之间状态的一致性\n\n## 以太坊的状态树结构\n\n以太坊采用的数据结构是 MPT（‌Merkle Patricia Tree，默克尔前缀树/压缩前缀树），基于 trie（单词查找树）\n\n### 一、Trie \n\n![图一](../images/45/1.png)\n\n#### 1、优点\n\n（1）Trie 每个节点的分支数目，取决于 key 每个元素的取值范围，以太坊的 branching factor 是 17（0~f，加结束位）\n\n（2）Trie 的查找效率取决于 key 的长度，越长查找次数越多，以太坊 key 值的长度都是 40\n\n（3）比起 key-value 对，trie 不会出现哈希碰撞\n\n（4）Trie 生成的树和插入顺序无关\n\n（5）Trie 中的更新操作具有局部性\n\n#### 2、缺点\n\n一脉单传，存储浪费空间，于是就引入了 MPT\n\n### 二、MPT\n\n![图二](../images/45/2.png)\n\nMPT 对树的高度进行压缩，访问内存的次数减少，提高效率。路径压缩在键值分布比较稀疏的情况下，效果比较好\n\n以太坊中的地址是 160 bits，地址空间为 2^160，因此以太坊账户地址的键值分布非常稀疏。地址这么长的原因是防止哈希碰撞（不同公钥哈希后的值相同）\n\nMerkle tree 比起 binary tree，把普通指针换成哈希指针；同样的，MPT 比起 PT，也是把普通指针换成哈希指针，最后计算出根哈希值\n\n#### 1、根哈希值的作用\n\n（1）防止篡改\n\n（2）merkle proof，证明账户余额\n\n（3）和 sorted merkle tree 一样，可以证明账户是否存在\n\n#### 2、Modified MPT\n\n以太坊用的是 modified MPT\n\n![图三](../images/45/3.png)\n\n以太坊之所以会保留历史状态，是为了便于回滚\n\n![图四](../images/45/4.png)\n\n### 三、状态树的数据结构\n\n![图五](../images/45/5.png)\n\n![图六](../images/45/6.png)\n\n![图七](../images/45/7.png)\n\n\n### 四、状态树中的状态\n\n状态树中保存的是 (key, value)，value（账户的状态）是通过 RLP（Recursive Length Prefix，递归长度前缀，特点是极简）序列化之后存储在账户中的\n\nProtobuf（protocol buffer）是一个做数据序列化的常用库，只支持一种类型：nested array of bytes（嵌套字节数组）\n\n以太坊中的所有其它类型（整数、哈希），最终都要变成嵌套字节数组，实现 RLP 比嵌套字节数组容易很多\n","slug":"45-北大区块链-ETH状态树","published":1,"updated":"2025-05-20T02:47:28.685Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvuc003o6kpr5wqg1zm3","content":"<p>从账户地址到账户状态的映射：addr -&gt; state</p>\n<p>以太坊中的账户地址是 160 bits，也就是 20字节，一般表示为 40个 16进制的数；比特币和以太坊的地址格式、长度都不同，但是以太坊中的地址也是由公钥转换来的（公钥取哈希、进行截取，并只保留后面）</p>\n<p>在比特币中，merkle tree 除了证明账户上有多少钱之外，还可以维护各个全节点之间状态的一致性</p>\n<h2 id=\"以太坊的状态树结构\"><a href=\"#以太坊的状态树结构\" class=\"headerlink\" title=\"以太坊的状态树结构\"></a>以太坊的状态树结构</h2><p>以太坊采用的数据结构是 MPT（‌Merkle Patricia Tree，默克尔前缀树&#x2F;压缩前缀树），基于 trie（单词查找树）</p>\n<h3 id=\"一、Trie\"><a href=\"#一、Trie\" class=\"headerlink\" title=\"一、Trie\"></a>一、Trie</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/45/1.png\"\n                      alt=\"图一\"\n                ></p>\n<h4 id=\"1、优点\"><a href=\"#1、优点\" class=\"headerlink\" title=\"1、优点\"></a>1、优点</h4><p>（1）Trie 每个节点的分支数目，取决于 key 每个元素的取值范围，以太坊的 branching factor 是 17（0~f，加结束位）</p>\n<p>（2）Trie 的查找效率取决于 key 的长度，越长查找次数越多，以太坊 key 值的长度都是 40</p>\n<p>（3）比起 key-value 对，trie 不会出现哈希碰撞</p>\n<p>（4）Trie 生成的树和插入顺序无关</p>\n<p>（5）Trie 中的更新操作具有局部性</p>\n<h4 id=\"2、缺点\"><a href=\"#2、缺点\" class=\"headerlink\" title=\"2、缺点\"></a>2、缺点</h4><p>一脉单传，存储浪费空间，于是就引入了 MPT</p>\n<h3 id=\"二、MPT\"><a href=\"#二、MPT\" class=\"headerlink\" title=\"二、MPT\"></a>二、MPT</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/45/2.png\"\n                      alt=\"图二\"\n                ></p>\n<p>MPT 对树的高度进行压缩，访问内存的次数减少，提高效率。路径压缩在键值分布比较稀疏的情况下，效果比较好</p>\n<p>以太坊中的地址是 160 bits，地址空间为 2^160，因此以太坊账户地址的键值分布非常稀疏。地址这么长的原因是防止哈希碰撞（不同公钥哈希后的值相同）</p>\n<p>Merkle tree 比起 binary tree，把普通指针换成哈希指针；同样的，MPT 比起 PT，也是把普通指针换成哈希指针，最后计算出根哈希值</p>\n<h4 id=\"1、根哈希值的作用\"><a href=\"#1、根哈希值的作用\" class=\"headerlink\" title=\"1、根哈希值的作用\"></a>1、根哈希值的作用</h4><p>（1）防止篡改</p>\n<p>（2）merkle proof，证明账户余额</p>\n<p>（3）和 sorted merkle tree 一样，可以证明账户是否存在</p>\n<h4 id=\"2、Modified-MPT\"><a href=\"#2、Modified-MPT\" class=\"headerlink\" title=\"2、Modified MPT\"></a>2、Modified MPT</h4><p>以太坊用的是 modified MPT</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/45/3.png\"\n                      alt=\"图三\"\n                ></p>\n<p>以太坊之所以会保留历史状态，是为了便于回滚</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/45/4.png\"\n                      alt=\"图四\"\n                ></p>\n<h3 id=\"三、状态树的数据结构\"><a href=\"#三、状态树的数据结构\" class=\"headerlink\" title=\"三、状态树的数据结构\"></a>三、状态树的数据结构</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/45/5.png\"\n                      alt=\"图五\"\n                ></p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/45/6.png\"\n                      alt=\"图六\"\n                ></p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/45/7.png\"\n                      alt=\"图七\"\n                ></p>\n<h3 id=\"四、状态树中的状态\"><a href=\"#四、状态树中的状态\" class=\"headerlink\" title=\"四、状态树中的状态\"></a>四、状态树中的状态</h3><p>状态树中保存的是 (key, value)，value（账户的状态）是通过 RLP（Recursive Length Prefix，递归长度前缀，特点是极简）序列化之后存储在账户中的</p>\n<p>Protobuf（protocol buffer）是一个做数据序列化的常用库，只支持一种类型：nested array of bytes（嵌套字节数组）</p>\n<p>以太坊中的所有其它类型（整数、哈希），最终都要变成嵌套字节数组，实现 RLP 比嵌套字节数组容易很多</p>\n","site":{"data":{}},"excerpt":"","more":"<p>从账户地址到账户状态的映射：addr -&gt; state</p>\n<p>以太坊中的账户地址是 160 bits，也就是 20字节，一般表示为 40个 16进制的数；比特币和以太坊的地址格式、长度都不同，但是以太坊中的地址也是由公钥转换来的（公钥取哈希、进行截取，并只保留后面）</p>\n<p>在比特币中，merkle tree 除了证明账户上有多少钱之外，还可以维护各个全节点之间状态的一致性</p>\n<h2 id=\"以太坊的状态树结构\"><a href=\"#以太坊的状态树结构\" class=\"headerlink\" title=\"以太坊的状态树结构\"></a>以太坊的状态树结构</h2><p>以太坊采用的数据结构是 MPT（‌Merkle Patricia Tree，默克尔前缀树&#x2F;压缩前缀树），基于 trie（单词查找树）</p>\n<h3 id=\"一、Trie\"><a href=\"#一、Trie\" class=\"headerlink\" title=\"一、Trie\"></a>一、Trie</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/45/1.png\"\n                      alt=\"图一\"\n                ></p>\n<h4 id=\"1、优点\"><a href=\"#1、优点\" class=\"headerlink\" title=\"1、优点\"></a>1、优点</h4><p>（1）Trie 每个节点的分支数目，取决于 key 每个元素的取值范围，以太坊的 branching factor 是 17（0~f，加结束位）</p>\n<p>（2）Trie 的查找效率取决于 key 的长度，越长查找次数越多，以太坊 key 值的长度都是 40</p>\n<p>（3）比起 key-value 对，trie 不会出现哈希碰撞</p>\n<p>（4）Trie 生成的树和插入顺序无关</p>\n<p>（5）Trie 中的更新操作具有局部性</p>\n<h4 id=\"2、缺点\"><a href=\"#2、缺点\" class=\"headerlink\" title=\"2、缺点\"></a>2、缺点</h4><p>一脉单传，存储浪费空间，于是就引入了 MPT</p>\n<h3 id=\"二、MPT\"><a href=\"#二、MPT\" class=\"headerlink\" title=\"二、MPT\"></a>二、MPT</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/45/2.png\"\n                      alt=\"图二\"\n                ></p>\n<p>MPT 对树的高度进行压缩，访问内存的次数减少，提高效率。路径压缩在键值分布比较稀疏的情况下，效果比较好</p>\n<p>以太坊中的地址是 160 bits，地址空间为 2^160，因此以太坊账户地址的键值分布非常稀疏。地址这么长的原因是防止哈希碰撞（不同公钥哈希后的值相同）</p>\n<p>Merkle tree 比起 binary tree，把普通指针换成哈希指针；同样的，MPT 比起 PT，也是把普通指针换成哈希指针，最后计算出根哈希值</p>\n<h4 id=\"1、根哈希值的作用\"><a href=\"#1、根哈希值的作用\" class=\"headerlink\" title=\"1、根哈希值的作用\"></a>1、根哈希值的作用</h4><p>（1）防止篡改</p>\n<p>（2）merkle proof，证明账户余额</p>\n<p>（3）和 sorted merkle tree 一样，可以证明账户是否存在</p>\n<h4 id=\"2、Modified-MPT\"><a href=\"#2、Modified-MPT\" class=\"headerlink\" title=\"2、Modified MPT\"></a>2、Modified MPT</h4><p>以太坊用的是 modified MPT</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/45/3.png\"\n                      alt=\"图三\"\n                ></p>\n<p>以太坊之所以会保留历史状态，是为了便于回滚</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/45/4.png\"\n                      alt=\"图四\"\n                ></p>\n<h3 id=\"三、状态树的数据结构\"><a href=\"#三、状态树的数据结构\" class=\"headerlink\" title=\"三、状态树的数据结构\"></a>三、状态树的数据结构</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/45/5.png\"\n                      alt=\"图五\"\n                ></p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/45/6.png\"\n                      alt=\"图六\"\n                ></p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/45/7.png\"\n                      alt=\"图七\"\n                ></p>\n<h3 id=\"四、状态树中的状态\"><a href=\"#四、状态树中的状态\" class=\"headerlink\" title=\"四、状态树中的状态\"></a>四、状态树中的状态</h3><p>状态树中保存的是 (key, value)，value（账户的状态）是通过 RLP（Recursive Length Prefix，递归长度前缀，特点是极简）序列化之后存储在账户中的</p>\n<p>Protobuf（protocol buffer）是一个做数据序列化的常用库，只支持一种类型：nested array of bytes（嵌套字节数组）</p>\n<p>以太坊中的所有其它类型（整数、哈希），最终都要变成嵌套字节数组，实现 RLP 比嵌套字节数组容易很多</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用17-ETH中的交易树和收据树","date":"2025-01-16T13:33:51.000Z","_content":"\n以太坊中的交易树和收据树也是 MPT，其好处是支持查找操作，查找的键值是交易在发布的区块中的序号（即排第几），其顺序由发布交易的区块确定\n\n交易树和收据树都是只把当前区块发布的交易组织起来，而状态树是把系统中所有账户的状态都包含进去（原因是：便于查找账户余额，尤其是很久没发生过交易的区块，更重要的是无法找到新账户）\n\n上节课讲到，多个区块的状态树是共享节点的；而每个区块的交易树和收据树是独立的\n\n交易树和收据树的用途是：提供 Merkle proof，交易树可以证明某个交易被打包到区块里，收据树的可以证明某个交易的执行结果\n\n## 1、Bloom filter（布隆过滤器）\n\n以太坊的收据树包含一个 Bloom filter\n\nBloom filter 可以支持高效的查找某元素是否在某个大的集合。通过将大的集合中的元素做哈希，映射到一个小的数组，该数组元素初始全为0，最终如果有元素映射到该位置，则置为1\n\n用 Bloom filter 检测元素是否在某个集合中，可能会出现 false positive（假阳性），即 实际不在、但是检测结果在，但**检测结果在、实际一定在**。且 Bloom filter 不支持删除元素\n\nBloom filter 在以太坊中的用途是支持复杂查询操作，比如：找到过去10天所有 和某个智能合约有关 / 众筹 / 发布新币的交易\n\n每个交易执行后会形成一个收据，收据里包含一个 Bloom filter，记录该交易的类型、地址和其他信息。发布的区块在块头里也有一个总的 Bloom filter，是区块里所有交易 Bloom filter 的并集\n\n轻节点只有块头信息，可以通过 Bloom filter 过滤掉很多区块，只保留符合条件的（即可能含有该交易的）区块，然后向全节点获取进一步的信息\n\n以太坊的运行过程，可以看做一个 transaction-driven state machine（交易驱动的状态机），状态是所有账户的状态，交易是每次发布的区块中的交易，执行交易会驱动系统转移到下一个状态\n\n比特币也可以看做一个交易驱动的状态机，其状态是 UTXO\n\n## 2、交易树、收据树、叔父数组 源码\n\n有点复杂，暂时没搞明白，详见以下课程链接（从29分开始）：\n\nhttps://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=17\n","source":"_posts/46-北大区块链-ETH交易树&收据树.md","raw":"---\ntitle: 北大-区块链技术与应用17-ETH中的交易树和收据树\ndate: 2025-01-16 21:33:51\ntags:\n    - web3\n    - ETH\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n以太坊中的交易树和收据树也是 MPT，其好处是支持查找操作，查找的键值是交易在发布的区块中的序号（即排第几），其顺序由发布交易的区块确定\n\n交易树和收据树都是只把当前区块发布的交易组织起来，而状态树是把系统中所有账户的状态都包含进去（原因是：便于查找账户余额，尤其是很久没发生过交易的区块，更重要的是无法找到新账户）\n\n上节课讲到，多个区块的状态树是共享节点的；而每个区块的交易树和收据树是独立的\n\n交易树和收据树的用途是：提供 Merkle proof，交易树可以证明某个交易被打包到区块里，收据树的可以证明某个交易的执行结果\n\n## 1、Bloom filter（布隆过滤器）\n\n以太坊的收据树包含一个 Bloom filter\n\nBloom filter 可以支持高效的查找某元素是否在某个大的集合。通过将大的集合中的元素做哈希，映射到一个小的数组，该数组元素初始全为0，最终如果有元素映射到该位置，则置为1\n\n用 Bloom filter 检测元素是否在某个集合中，可能会出现 false positive（假阳性），即 实际不在、但是检测结果在，但**检测结果在、实际一定在**。且 Bloom filter 不支持删除元素\n\nBloom filter 在以太坊中的用途是支持复杂查询操作，比如：找到过去10天所有 和某个智能合约有关 / 众筹 / 发布新币的交易\n\n每个交易执行后会形成一个收据，收据里包含一个 Bloom filter，记录该交易的类型、地址和其他信息。发布的区块在块头里也有一个总的 Bloom filter，是区块里所有交易 Bloom filter 的并集\n\n轻节点只有块头信息，可以通过 Bloom filter 过滤掉很多区块，只保留符合条件的（即可能含有该交易的）区块，然后向全节点获取进一步的信息\n\n以太坊的运行过程，可以看做一个 transaction-driven state machine（交易驱动的状态机），状态是所有账户的状态，交易是每次发布的区块中的交易，执行交易会驱动系统转移到下一个状态\n\n比特币也可以看做一个交易驱动的状态机，其状态是 UTXO\n\n## 2、交易树、收据树、叔父数组 源码\n\n有点复杂，暂时没搞明白，详见以下课程链接（从29分开始）：\n\nhttps://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=17\n","slug":"46-北大区块链-ETH交易树&收据树","published":1,"updated":"2025-05-20T02:47:28.685Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvud003s6kprgtd30rb0","content":"<p>以太坊中的交易树和收据树也是 MPT，其好处是支持查找操作，查找的键值是交易在发布的区块中的序号（即排第几），其顺序由发布交易的区块确定</p>\n<p>交易树和收据树都是只把当前区块发布的交易组织起来，而状态树是把系统中所有账户的状态都包含进去（原因是：便于查找账户余额，尤其是很久没发生过交易的区块，更重要的是无法找到新账户）</p>\n<p>上节课讲到，多个区块的状态树是共享节点的；而每个区块的交易树和收据树是独立的</p>\n<p>交易树和收据树的用途是：提供 Merkle proof，交易树可以证明某个交易被打包到区块里，收据树的可以证明某个交易的执行结果</p>\n<h2 id=\"1、Bloom-filter（布隆过滤器）\"><a href=\"#1、Bloom-filter（布隆过滤器）\" class=\"headerlink\" title=\"1、Bloom filter（布隆过滤器）\"></a>1、Bloom filter（布隆过滤器）</h2><p>以太坊的收据树包含一个 Bloom filter</p>\n<p>Bloom filter 可以支持高效的查找某元素是否在某个大的集合。通过将大的集合中的元素做哈希，映射到一个小的数组，该数组元素初始全为0，最终如果有元素映射到该位置，则置为1</p>\n<p>用 Bloom filter 检测元素是否在某个集合中，可能会出现 false positive（假阳性），即 实际不在、但是检测结果在，但<strong>检测结果在、实际一定在</strong>。且 Bloom filter 不支持删除元素</p>\n<p>Bloom filter 在以太坊中的用途是支持复杂查询操作，比如：找到过去10天所有 和某个智能合约有关 &#x2F; 众筹 &#x2F; 发布新币的交易</p>\n<p>每个交易执行后会形成一个收据，收据里包含一个 Bloom filter，记录该交易的类型、地址和其他信息。发布的区块在块头里也有一个总的 Bloom filter，是区块里所有交易 Bloom filter 的并集</p>\n<p>轻节点只有块头信息，可以通过 Bloom filter 过滤掉很多区块，只保留符合条件的（即可能含有该交易的）区块，然后向全节点获取进一步的信息</p>\n<p>以太坊的运行过程，可以看做一个 transaction-driven state machine（交易驱动的状态机），状态是所有账户的状态，交易是每次发布的区块中的交易，执行交易会驱动系统转移到下一个状态</p>\n<p>比特币也可以看做一个交易驱动的状态机，其状态是 UTXO</p>\n<h2 id=\"2、交易树、收据树、叔父数组-源码\"><a href=\"#2、交易树、收据树、叔父数组-源码\" class=\"headerlink\" title=\"2、交易树、收据树、叔父数组 源码\"></a>2、交易树、收据树、叔父数组 源码</h2><p>有点复杂，暂时没搞明白，详见以下课程链接（从29分开始）：</p>\n<p><a class=\"link\"   href=\"https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=17\" >https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&amp;vd_source=69ac93649ea21c4726fe85f272b6d968&amp;p=17<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>以太坊中的交易树和收据树也是 MPT，其好处是支持查找操作，查找的键值是交易在发布的区块中的序号（即排第几），其顺序由发布交易的区块确定</p>\n<p>交易树和收据树都是只把当前区块发布的交易组织起来，而状态树是把系统中所有账户的状态都包含进去（原因是：便于查找账户余额，尤其是很久没发生过交易的区块，更重要的是无法找到新账户）</p>\n<p>上节课讲到，多个区块的状态树是共享节点的；而每个区块的交易树和收据树是独立的</p>\n<p>交易树和收据树的用途是：提供 Merkle proof，交易树可以证明某个交易被打包到区块里，收据树的可以证明某个交易的执行结果</p>\n<h2 id=\"1、Bloom-filter（布隆过滤器）\"><a href=\"#1、Bloom-filter（布隆过滤器）\" class=\"headerlink\" title=\"1、Bloom filter（布隆过滤器）\"></a>1、Bloom filter（布隆过滤器）</h2><p>以太坊的收据树包含一个 Bloom filter</p>\n<p>Bloom filter 可以支持高效的查找某元素是否在某个大的集合。通过将大的集合中的元素做哈希，映射到一个小的数组，该数组元素初始全为0，最终如果有元素映射到该位置，则置为1</p>\n<p>用 Bloom filter 检测元素是否在某个集合中，可能会出现 false positive（假阳性），即 实际不在、但是检测结果在，但<strong>检测结果在、实际一定在</strong>。且 Bloom filter 不支持删除元素</p>\n<p>Bloom filter 在以太坊中的用途是支持复杂查询操作，比如：找到过去10天所有 和某个智能合约有关 &#x2F; 众筹 &#x2F; 发布新币的交易</p>\n<p>每个交易执行后会形成一个收据，收据里包含一个 Bloom filter，记录该交易的类型、地址和其他信息。发布的区块在块头里也有一个总的 Bloom filter，是区块里所有交易 Bloom filter 的并集</p>\n<p>轻节点只有块头信息，可以通过 Bloom filter 过滤掉很多区块，只保留符合条件的（即可能含有该交易的）区块，然后向全节点获取进一步的信息</p>\n<p>以太坊的运行过程，可以看做一个 transaction-driven state machine（交易驱动的状态机），状态是所有账户的状态，交易是每次发布的区块中的交易，执行交易会驱动系统转移到下一个状态</p>\n<p>比特币也可以看做一个交易驱动的状态机，其状态是 UTXO</p>\n<h2 id=\"2、交易树、收据树、叔父数组-源码\"><a href=\"#2、交易树、收据树、叔父数组-源码\" class=\"headerlink\" title=\"2、交易树、收据树、叔父数组 源码\"></a>2、交易树、收据树、叔父数组 源码</h2><p>有点复杂，暂时没搞明白，详见以下课程链接（从29分开始）：</p>\n<p><a class=\"link\"   href=\"https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=17\" >https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&amp;vd_source=69ac93649ea21c4726fe85f272b6d968&amp;p=17<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用18-GHOST协议","date":"2025-01-16T15:25:54.000Z","_content":"\n以太坊出块时间的显著降低，使得更容易出现分叉（甚至多个分叉），大型矿池有优势，尤其对个体矿工不公平\n\n因为当出现分叉时，所有个体矿工的算力是分散的，而矿池中的所有算力会集中在其挖出的区块，导致矿池挖出的区块更容易成为最长合法链，造成 mining centralization，这种情况也叫做 centralization bias（中心化带来的不成比例的优势）；再加上矿池会在网络的多个地方有接口，所以其发布的区块可能更早被其他节点收到\n\n## 一、叔父区块\n\nGHOST 协议不是以太坊发明的，是以太坊对其做了改进。核心思想是给予孤儿区块（在以太坊中叫做 uncle block，叔父区块）一定的奖励（7/8 的出块奖励），而打包叔父区块的区块可以获得额外的 1/32 的出块奖励（一个区块最多包含 2 个叔父区块）\n\n以太坊一开始的出块奖励是 5个以太币，后来改为 3个以太币，现在变为 2个以太币（和挖矿难度相关）\n\n![图一](../images/47/1.png)\n\nGHOST 的这种设计有利于鼓励系统中出现分叉后及时进行合并（解决系统中的临时性分叉）\n\n但是可能存在矿池恶意竞争，故意不包含叔父区块\n\n## 二、Uncle reward（叔父区块的奖励）\n\n最长合法链上的后续区块，仍然能包含前面区块未打包的叔父区块，但是叔父区块距离越远，奖励越小（7/8, 6/8, 5/8, 4/8, 3/8, 2/8），最长不能超过六代\n\n![图二](../images/47/2.png)\n\n叔父区块的定义：必须和当前区块在七代以内有共同的祖先（at most seven generations）\n\n设计七代以内辈分的原因是：如果不限制备份，全节点需要维护的状态就太多了；七代以内辈分 uncle reward 逐级递减的原因是：有利于鼓励出现分叉后尽早进行合并\n\n在比特币和以太坊中，把 block reward 叫做 static reward（静态奖励）\n\n在比特币中，tx fee 叫做 dynamic reward（动态奖励）；而在以太坊中，在执行区块中包含的智能合约时，可以得到 gas fee（汽油费），叔父区块是得不到汽油费的\n\n比特币被比喻为数字黄金，是用来储值的；以太币被比喻为石油，是用来消耗的（不太恰当，因为以太币本身不会消失）\n\n打包叔父区块时不应该执行叔父区块中的交易，因为叔父区块中可能存在有冲突的交易（执行完父区块的交易，再执行叔父区块的交易就会非法）；而是会通过 block header 检查叔父区块是不是一个合法发布的区块（是否符合挖矿难度要求）\n\n叔父区块后面的节点不能给予奖励，否则分叉攻击就变得太简单了：如果成功，可以回滚交易；不成功，也可以合并获得 uncle reward\n\n![图三](../images/47/3.png)\n\n","source":"_posts/47-北大区块链-GHOST协议.md","raw":"---\ntitle: 北大-区块链技术与应用18-GHOST协议\ndate: 2025-01-16 23:25:54\ntags:\n    - web3\n    - ETH\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n以太坊出块时间的显著降低，使得更容易出现分叉（甚至多个分叉），大型矿池有优势，尤其对个体矿工不公平\n\n因为当出现分叉时，所有个体矿工的算力是分散的，而矿池中的所有算力会集中在其挖出的区块，导致矿池挖出的区块更容易成为最长合法链，造成 mining centralization，这种情况也叫做 centralization bias（中心化带来的不成比例的优势）；再加上矿池会在网络的多个地方有接口，所以其发布的区块可能更早被其他节点收到\n\n## 一、叔父区块\n\nGHOST 协议不是以太坊发明的，是以太坊对其做了改进。核心思想是给予孤儿区块（在以太坊中叫做 uncle block，叔父区块）一定的奖励（7/8 的出块奖励），而打包叔父区块的区块可以获得额外的 1/32 的出块奖励（一个区块最多包含 2 个叔父区块）\n\n以太坊一开始的出块奖励是 5个以太币，后来改为 3个以太币，现在变为 2个以太币（和挖矿难度相关）\n\n![图一](../images/47/1.png)\n\nGHOST 的这种设计有利于鼓励系统中出现分叉后及时进行合并（解决系统中的临时性分叉）\n\n但是可能存在矿池恶意竞争，故意不包含叔父区块\n\n## 二、Uncle reward（叔父区块的奖励）\n\n最长合法链上的后续区块，仍然能包含前面区块未打包的叔父区块，但是叔父区块距离越远，奖励越小（7/8, 6/8, 5/8, 4/8, 3/8, 2/8），最长不能超过六代\n\n![图二](../images/47/2.png)\n\n叔父区块的定义：必须和当前区块在七代以内有共同的祖先（at most seven generations）\n\n设计七代以内辈分的原因是：如果不限制备份，全节点需要维护的状态就太多了；七代以内辈分 uncle reward 逐级递减的原因是：有利于鼓励出现分叉后尽早进行合并\n\n在比特币和以太坊中，把 block reward 叫做 static reward（静态奖励）\n\n在比特币中，tx fee 叫做 dynamic reward（动态奖励）；而在以太坊中，在执行区块中包含的智能合约时，可以得到 gas fee（汽油费），叔父区块是得不到汽油费的\n\n比特币被比喻为数字黄金，是用来储值的；以太币被比喻为石油，是用来消耗的（不太恰当，因为以太币本身不会消失）\n\n打包叔父区块时不应该执行叔父区块中的交易，因为叔父区块中可能存在有冲突的交易（执行完父区块的交易，再执行叔父区块的交易就会非法）；而是会通过 block header 检查叔父区块是不是一个合法发布的区块（是否符合挖矿难度要求）\n\n叔父区块后面的节点不能给予奖励，否则分叉攻击就变得太简单了：如果成功，可以回滚交易；不成功，也可以合并获得 uncle reward\n\n![图三](../images/47/3.png)\n\n","slug":"47-北大区块链-GHOST协议","published":1,"updated":"2025-05-20T02:47:28.685Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvud003w6kpr8wj7c4tt","content":"<p>以太坊出块时间的显著降低，使得更容易出现分叉（甚至多个分叉），大型矿池有优势，尤其对个体矿工不公平</p>\n<p>因为当出现分叉时，所有个体矿工的算力是分散的，而矿池中的所有算力会集中在其挖出的区块，导致矿池挖出的区块更容易成为最长合法链，造成 mining centralization，这种情况也叫做 centralization bias（中心化带来的不成比例的优势）；再加上矿池会在网络的多个地方有接口，所以其发布的区块可能更早被其他节点收到</p>\n<h2 id=\"一、叔父区块\"><a href=\"#一、叔父区块\" class=\"headerlink\" title=\"一、叔父区块\"></a>一、叔父区块</h2><p>GHOST 协议不是以太坊发明的，是以太坊对其做了改进。核心思想是给予孤儿区块（在以太坊中叫做 uncle block，叔父区块）一定的奖励（7&#x2F;8 的出块奖励），而打包叔父区块的区块可以获得额外的 1&#x2F;32 的出块奖励（一个区块最多包含 2 个叔父区块）</p>\n<p>以太坊一开始的出块奖励是 5个以太币，后来改为 3个以太币，现在变为 2个以太币（和挖矿难度相关）</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/47/1.png\"\n                      alt=\"图一\"\n                ></p>\n<p>GHOST 的这种设计有利于鼓励系统中出现分叉后及时进行合并（解决系统中的临时性分叉）</p>\n<p>但是可能存在矿池恶意竞争，故意不包含叔父区块</p>\n<h2 id=\"二、Uncle-reward（叔父区块的奖励）\"><a href=\"#二、Uncle-reward（叔父区块的奖励）\" class=\"headerlink\" title=\"二、Uncle reward（叔父区块的奖励）\"></a>二、Uncle reward（叔父区块的奖励）</h2><p>最长合法链上的后续区块，仍然能包含前面区块未打包的叔父区块，但是叔父区块距离越远，奖励越小（7&#x2F;8, 6&#x2F;8, 5&#x2F;8, 4&#x2F;8, 3&#x2F;8, 2&#x2F;8），最长不能超过六代</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/47/2.png\"\n                      alt=\"图二\"\n                ></p>\n<p>叔父区块的定义：必须和当前区块在七代以内有共同的祖先（at most seven generations）</p>\n<p>设计七代以内辈分的原因是：如果不限制备份，全节点需要维护的状态就太多了；七代以内辈分 uncle reward 逐级递减的原因是：有利于鼓励出现分叉后尽早进行合并</p>\n<p>在比特币和以太坊中，把 block reward 叫做 static reward（静态奖励）</p>\n<p>在比特币中，tx fee 叫做 dynamic reward（动态奖励）；而在以太坊中，在执行区块中包含的智能合约时，可以得到 gas fee（汽油费），叔父区块是得不到汽油费的</p>\n<p>比特币被比喻为数字黄金，是用来储值的；以太币被比喻为石油，是用来消耗的（不太恰当，因为以太币本身不会消失）</p>\n<p>打包叔父区块时不应该执行叔父区块中的交易，因为叔父区块中可能存在有冲突的交易（执行完父区块的交易，再执行叔父区块的交易就会非法）；而是会通过 block header 检查叔父区块是不是一个合法发布的区块（是否符合挖矿难度要求）</p>\n<p>叔父区块后面的节点不能给予奖励，否则分叉攻击就变得太简单了：如果成功，可以回滚交易；不成功，也可以合并获得 uncle reward</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/47/3.png\"\n                      alt=\"图三\"\n                ></p>\n","site":{"data":{}},"excerpt":"","more":"<p>以太坊出块时间的显著降低，使得更容易出现分叉（甚至多个分叉），大型矿池有优势，尤其对个体矿工不公平</p>\n<p>因为当出现分叉时，所有个体矿工的算力是分散的，而矿池中的所有算力会集中在其挖出的区块，导致矿池挖出的区块更容易成为最长合法链，造成 mining centralization，这种情况也叫做 centralization bias（中心化带来的不成比例的优势）；再加上矿池会在网络的多个地方有接口，所以其发布的区块可能更早被其他节点收到</p>\n<h2 id=\"一、叔父区块\"><a href=\"#一、叔父区块\" class=\"headerlink\" title=\"一、叔父区块\"></a>一、叔父区块</h2><p>GHOST 协议不是以太坊发明的，是以太坊对其做了改进。核心思想是给予孤儿区块（在以太坊中叫做 uncle block，叔父区块）一定的奖励（7&#x2F;8 的出块奖励），而打包叔父区块的区块可以获得额外的 1&#x2F;32 的出块奖励（一个区块最多包含 2 个叔父区块）</p>\n<p>以太坊一开始的出块奖励是 5个以太币，后来改为 3个以太币，现在变为 2个以太币（和挖矿难度相关）</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/47/1.png\"\n                      alt=\"图一\"\n                ></p>\n<p>GHOST 的这种设计有利于鼓励系统中出现分叉后及时进行合并（解决系统中的临时性分叉）</p>\n<p>但是可能存在矿池恶意竞争，故意不包含叔父区块</p>\n<h2 id=\"二、Uncle-reward（叔父区块的奖励）\"><a href=\"#二、Uncle-reward（叔父区块的奖励）\" class=\"headerlink\" title=\"二、Uncle reward（叔父区块的奖励）\"></a>二、Uncle reward（叔父区块的奖励）</h2><p>最长合法链上的后续区块，仍然能包含前面区块未打包的叔父区块，但是叔父区块距离越远，奖励越小（7&#x2F;8, 6&#x2F;8, 5&#x2F;8, 4&#x2F;8, 3&#x2F;8, 2&#x2F;8），最长不能超过六代</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/47/2.png\"\n                      alt=\"图二\"\n                ></p>\n<p>叔父区块的定义：必须和当前区块在七代以内有共同的祖先（at most seven generations）</p>\n<p>设计七代以内辈分的原因是：如果不限制备份，全节点需要维护的状态就太多了；七代以内辈分 uncle reward 逐级递减的原因是：有利于鼓励出现分叉后尽早进行合并</p>\n<p>在比特币和以太坊中，把 block reward 叫做 static reward（静态奖励）</p>\n<p>在比特币中，tx fee 叫做 dynamic reward（动态奖励）；而在以太坊中，在执行区块中包含的智能合约时，可以得到 gas fee（汽油费），叔父区块是得不到汽油费的</p>\n<p>比特币被比喻为数字黄金，是用来储值的；以太币被比喻为石油，是用来消耗的（不太恰当，因为以太币本身不会消失）</p>\n<p>打包叔父区块时不应该执行叔父区块中的交易，因为叔父区块中可能存在有冲突的交易（执行完父区块的交易，再执行叔父区块的交易就会非法）；而是会通过 block header 检查叔父区块是不是一个合法发布的区块（是否符合挖矿难度要求）</p>\n<p>叔父区块后面的节点不能给予奖励，否则分叉攻击就变得太简单了：如果成功，可以回滚交易；不成功，也可以合并获得 uncle reward</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/47/3.png\"\n                      alt=\"图三\"\n                ></p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用19-ETH挖矿算法","date":"2025-01-17T16:02:26.000Z","_content":"\nBlock chain is secured by mining（挖矿保障了区块链的安全性），比特币的挖矿算法是一个天然的 bug bounty（悬赏找bug），如果能找到漏洞或挖矿的捷径（shortcut）就能获取很大的利益\n\n很多人认为，挖矿设备的专业化 和比特币的去中心化理念是相违背的（one cpu, one vote），普通人能够参与挖矿有利于分散算力，预防 51% attack。所以后续的加密货币设计 mining puzzle 的一个理念是 ASIC resistance\n\n设计 ASIC resistance 的 mining puzzle 的常用做法是：增加 puzzle 对内存访问的需求，即 memory hard mining puzzle，因为 ASIC 芯片计算能力强，但是在内存访问的性能上没有很大的优势\n\n## 一、LiteCoin & Scrypt\n\n一个早期的例子是 LiteCoin（莱特币），曾经是市值仅次于比特币的加密货币，其 mining puzzle 基于 scrypt\n\nScrypt 是一个对内存要求很高的哈希函数，设计思想是：开设一个很大的数组，按照顺序填充一些伪随机数；具体过程是：按照一个 seed 的值，运算出一个数填在第一个位置，后面每个位置都是前一个位置取哈希得到的；其特点是里面的取值是有前后依赖关系的；求解 puzzle 时，按照伪随机的顺序从数组中读取一些数（通过对当前数运算得到下一个读取顺序，模拟随机）；好处是：如果数组开得足够大，对于矿工来说就是 memory hard 的，有的矿工可能保存一部分内存区域的内容，比如只保留奇数位置的数，需要读取到偶数再算，这也叫做 time-memory trade off（时间换空间）\n\n其坏处是：对于轻节点验证来说也是 memory hard，不符合 difficult to solve, but easy to verify。所以其实际使用过程中，数组只有 128k，不足以对 ASIC 芯片造成遏制，但该理念对其冷启动有很大帮助（需要冷启动是因为，参与挖矿的人太少很容易遭受恶意攻击），所以莱特币现在仍然是主流货币\n\n莱特币的出块时间是两分半，速度是比特币的四倍，其他部分和比特币基本相同\n\n## 二、以太坊 memory hard\n\n以太坊的挖矿算法叫做 ethash，矿工挖矿需要 1G 的内存，和莱特币的 128k 比，大了 8000 多倍，光是 cashe 就大了 100 多倍；更别说现在内存要求还在增长\n\n以太坊使用一大一小两个数据集：16M 的 cache 和 1G 的dataset，轻节点只要保存 cache，矿工才需要保存 1G 的大数据集\n\n### 1、具体算法\n\n算法太复杂了，没完全搞明白，具体算法的伪代码可参考课程视频（28分）：\n\nhttps://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=19\n\ncache 的生成方式和 scrypt 类似，但是不同于莱特币从数组中按照伪随机的顺序读取并进行运算，以太坊是需要先生成一个更大的数组（dataset 要大得多），而且 cache 和 dataset 是定期增长的，因为计算机的内存容量也在增长\n\ndataset 中的每个元素都是从 cache 中按照伪随机的顺序读取一些元素（和莱特币类似），一共读 256 次，用这 256 个数算出一个数，作为 dataset 的第一个元素，后续元素也一样\n\n求解 puzzle 时只使用 dataset 中的数，按照伪随机的顺序，从大数据集中读取 128 个数：一开始根据区块的块头、包括其中的 nonce 值，算出一个初始的哈希，然后根据该哈希映射到这个大数据集中的某个位置，将其中的数读取出来（同时将其相邻的元素读取出来），然后进行一些运算算出下一个位置，总共进行 64 次循环，共读取 128 个数。最后算出一个哈希值，和挖矿难度的目标域值比较，看是否符合要求，如果不符合，更换 nonce 之后再重新计算\n\n### 2、矿工保存 dataset 的原因\n\n由于矿工需要验证非常多的 nonce，如果每次都从 16M 的 cache 中重新生成，挖矿的效率就太低了，并且其中有大量的重复计算（因为随机选取的 dataset 的元素中有很多是重复的，可能是之前尝试别的 nonce 时用过的）。所以矿工采取空间换时间的策略，保存整个 dataset\n\n### 3、轻节点只保存 cache 的原因\n\n轻节点由于只验证一个 nonce，验证时直接生成要用到的 dataset 中的元素即可\n\n和比特币相比，以太坊中验证一个 nonce 的计算量要大很多，但也在可接受范围内\n\n目前以太坊挖矿还是以 GPU 为主，所以起到了 ASIC resistance\n\n## 三、以太坊 POS\n\n以太坊没有出现 ASIC 矿机的另一个原因是，以太坊2.0（或以太坊合并）已经于 2022年 从 POW 转向 POS（Power of Stake，权益证明），即按照所占的权益进行投票从而形成共识，而不是挖矿，类似于股份制公司按照股份多少来投票\n\n这对于 ASIC 厂商是很大的威胁，因为其研发周期很长（1年都算快的），并且研发成本也很高，如果后续不挖矿了，那么所有投入都白费了\n\n## 四、预挖矿\n\n以太坊采用了 pre-mining（预挖矿），在当初发行货币的时候，预留一部分货币给以太坊的开发者，类似创业公司留一部分股票给创始人和早期员工；而比特币没有采用 pre-mining 的模式，都是挖矿挖出来的\n\nPre-sale（预售） 就是把 pre-mining 中预留的币，通过出售的方法来换取一些资产，用于加密货币的开发工作\n\n但有一些人认为，让通用计算设备参与挖矿反而是不安全的，用 ASIC 芯片挖矿才是最安全的，因为购买矿机需要大量的资金，并且只能用于一种加密货币，成本较高\n","source":"_posts/48-北大区块链-ETH挖矿算法.md","raw":"---\ntitle: 北大-区块链技术与应用19-ETH挖矿算法\ndate: 2025-01-18 00:02:26\ntags:\n    - web3\n    - ETH\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\nBlock chain is secured by mining（挖矿保障了区块链的安全性），比特币的挖矿算法是一个天然的 bug bounty（悬赏找bug），如果能找到漏洞或挖矿的捷径（shortcut）就能获取很大的利益\n\n很多人认为，挖矿设备的专业化 和比特币的去中心化理念是相违背的（one cpu, one vote），普通人能够参与挖矿有利于分散算力，预防 51% attack。所以后续的加密货币设计 mining puzzle 的一个理念是 ASIC resistance\n\n设计 ASIC resistance 的 mining puzzle 的常用做法是：增加 puzzle 对内存访问的需求，即 memory hard mining puzzle，因为 ASIC 芯片计算能力强，但是在内存访问的性能上没有很大的优势\n\n## 一、LiteCoin & Scrypt\n\n一个早期的例子是 LiteCoin（莱特币），曾经是市值仅次于比特币的加密货币，其 mining puzzle 基于 scrypt\n\nScrypt 是一个对内存要求很高的哈希函数，设计思想是：开设一个很大的数组，按照顺序填充一些伪随机数；具体过程是：按照一个 seed 的值，运算出一个数填在第一个位置，后面每个位置都是前一个位置取哈希得到的；其特点是里面的取值是有前后依赖关系的；求解 puzzle 时，按照伪随机的顺序从数组中读取一些数（通过对当前数运算得到下一个读取顺序，模拟随机）；好处是：如果数组开得足够大，对于矿工来说就是 memory hard 的，有的矿工可能保存一部分内存区域的内容，比如只保留奇数位置的数，需要读取到偶数再算，这也叫做 time-memory trade off（时间换空间）\n\n其坏处是：对于轻节点验证来说也是 memory hard，不符合 difficult to solve, but easy to verify。所以其实际使用过程中，数组只有 128k，不足以对 ASIC 芯片造成遏制，但该理念对其冷启动有很大帮助（需要冷启动是因为，参与挖矿的人太少很容易遭受恶意攻击），所以莱特币现在仍然是主流货币\n\n莱特币的出块时间是两分半，速度是比特币的四倍，其他部分和比特币基本相同\n\n## 二、以太坊 memory hard\n\n以太坊的挖矿算法叫做 ethash，矿工挖矿需要 1G 的内存，和莱特币的 128k 比，大了 8000 多倍，光是 cashe 就大了 100 多倍；更别说现在内存要求还在增长\n\n以太坊使用一大一小两个数据集：16M 的 cache 和 1G 的dataset，轻节点只要保存 cache，矿工才需要保存 1G 的大数据集\n\n### 1、具体算法\n\n算法太复杂了，没完全搞明白，具体算法的伪代码可参考课程视频（28分）：\n\nhttps://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=19\n\ncache 的生成方式和 scrypt 类似，但是不同于莱特币从数组中按照伪随机的顺序读取并进行运算，以太坊是需要先生成一个更大的数组（dataset 要大得多），而且 cache 和 dataset 是定期增长的，因为计算机的内存容量也在增长\n\ndataset 中的每个元素都是从 cache 中按照伪随机的顺序读取一些元素（和莱特币类似），一共读 256 次，用这 256 个数算出一个数，作为 dataset 的第一个元素，后续元素也一样\n\n求解 puzzle 时只使用 dataset 中的数，按照伪随机的顺序，从大数据集中读取 128 个数：一开始根据区块的块头、包括其中的 nonce 值，算出一个初始的哈希，然后根据该哈希映射到这个大数据集中的某个位置，将其中的数读取出来（同时将其相邻的元素读取出来），然后进行一些运算算出下一个位置，总共进行 64 次循环，共读取 128 个数。最后算出一个哈希值，和挖矿难度的目标域值比较，看是否符合要求，如果不符合，更换 nonce 之后再重新计算\n\n### 2、矿工保存 dataset 的原因\n\n由于矿工需要验证非常多的 nonce，如果每次都从 16M 的 cache 中重新生成，挖矿的效率就太低了，并且其中有大量的重复计算（因为随机选取的 dataset 的元素中有很多是重复的，可能是之前尝试别的 nonce 时用过的）。所以矿工采取空间换时间的策略，保存整个 dataset\n\n### 3、轻节点只保存 cache 的原因\n\n轻节点由于只验证一个 nonce，验证时直接生成要用到的 dataset 中的元素即可\n\n和比特币相比，以太坊中验证一个 nonce 的计算量要大很多，但也在可接受范围内\n\n目前以太坊挖矿还是以 GPU 为主，所以起到了 ASIC resistance\n\n## 三、以太坊 POS\n\n以太坊没有出现 ASIC 矿机的另一个原因是，以太坊2.0（或以太坊合并）已经于 2022年 从 POW 转向 POS（Power of Stake，权益证明），即按照所占的权益进行投票从而形成共识，而不是挖矿，类似于股份制公司按照股份多少来投票\n\n这对于 ASIC 厂商是很大的威胁，因为其研发周期很长（1年都算快的），并且研发成本也很高，如果后续不挖矿了，那么所有投入都白费了\n\n## 四、预挖矿\n\n以太坊采用了 pre-mining（预挖矿），在当初发行货币的时候，预留一部分货币给以太坊的开发者，类似创业公司留一部分股票给创始人和早期员工；而比特币没有采用 pre-mining 的模式，都是挖矿挖出来的\n\nPre-sale（预售） 就是把 pre-mining 中预留的币，通过出售的方法来换取一些资产，用于加密货币的开发工作\n\n但有一些人认为，让通用计算设备参与挖矿反而是不安全的，用 ASIC 芯片挖矿才是最安全的，因为购买矿机需要大量的资金，并且只能用于一种加密货币，成本较高\n","slug":"48-北大区块链-ETH挖矿算法","published":1,"updated":"2025-05-20T02:47:28.685Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvud00406kpree2ldmbp","content":"<p>Block chain is secured by mining（挖矿保障了区块链的安全性），比特币的挖矿算法是一个天然的 bug bounty（悬赏找bug），如果能找到漏洞或挖矿的捷径（shortcut）就能获取很大的利益</p>\n<p>很多人认为，挖矿设备的专业化 和比特币的去中心化理念是相违背的（one cpu, one vote），普通人能够参与挖矿有利于分散算力，预防 51% attack。所以后续的加密货币设计 mining puzzle 的一个理念是 ASIC resistance</p>\n<p>设计 ASIC resistance 的 mining puzzle 的常用做法是：增加 puzzle 对内存访问的需求，即 memory hard mining puzzle，因为 ASIC 芯片计算能力强，但是在内存访问的性能上没有很大的优势</p>\n<h2 id=\"一、LiteCoin-Scrypt\"><a href=\"#一、LiteCoin-Scrypt\" class=\"headerlink\" title=\"一、LiteCoin &amp; Scrypt\"></a>一、LiteCoin &amp; Scrypt</h2><p>一个早期的例子是 LiteCoin（莱特币），曾经是市值仅次于比特币的加密货币，其 mining puzzle 基于 scrypt</p>\n<p>Scrypt 是一个对内存要求很高的哈希函数，设计思想是：开设一个很大的数组，按照顺序填充一些伪随机数；具体过程是：按照一个 seed 的值，运算出一个数填在第一个位置，后面每个位置都是前一个位置取哈希得到的；其特点是里面的取值是有前后依赖关系的；求解 puzzle 时，按照伪随机的顺序从数组中读取一些数（通过对当前数运算得到下一个读取顺序，模拟随机）；好处是：如果数组开得足够大，对于矿工来说就是 memory hard 的，有的矿工可能保存一部分内存区域的内容，比如只保留奇数位置的数，需要读取到偶数再算，这也叫做 time-memory trade off（时间换空间）</p>\n<p>其坏处是：对于轻节点验证来说也是 memory hard，不符合 difficult to solve, but easy to verify。所以其实际使用过程中，数组只有 128k，不足以对 ASIC 芯片造成遏制，但该理念对其冷启动有很大帮助（需要冷启动是因为，参与挖矿的人太少很容易遭受恶意攻击），所以莱特币现在仍然是主流货币</p>\n<p>莱特币的出块时间是两分半，速度是比特币的四倍，其他部分和比特币基本相同</p>\n<h2 id=\"二、以太坊-memory-hard\"><a href=\"#二、以太坊-memory-hard\" class=\"headerlink\" title=\"二、以太坊 memory hard\"></a>二、以太坊 memory hard</h2><p>以太坊的挖矿算法叫做 ethash，矿工挖矿需要 1G 的内存，和莱特币的 128k 比，大了 8000 多倍，光是 cashe 就大了 100 多倍；更别说现在内存要求还在增长</p>\n<p>以太坊使用一大一小两个数据集：16M 的 cache 和 1G 的dataset，轻节点只要保存 cache，矿工才需要保存 1G 的大数据集</p>\n<h3 id=\"1、具体算法\"><a href=\"#1、具体算法\" class=\"headerlink\" title=\"1、具体算法\"></a>1、具体算法</h3><p>算法太复杂了，没完全搞明白，具体算法的伪代码可参考课程视频（28分）：</p>\n<p><a class=\"link\"   href=\"https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=19\" >https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&amp;vd_source=69ac93649ea21c4726fe85f272b6d968&amp;p=19<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p>cache 的生成方式和 scrypt 类似，但是不同于莱特币从数组中按照伪随机的顺序读取并进行运算，以太坊是需要先生成一个更大的数组（dataset 要大得多），而且 cache 和 dataset 是定期增长的，因为计算机的内存容量也在增长</p>\n<p>dataset 中的每个元素都是从 cache 中按照伪随机的顺序读取一些元素（和莱特币类似），一共读 256 次，用这 256 个数算出一个数，作为 dataset 的第一个元素，后续元素也一样</p>\n<p>求解 puzzle 时只使用 dataset 中的数，按照伪随机的顺序，从大数据集中读取 128 个数：一开始根据区块的块头、包括其中的 nonce 值，算出一个初始的哈希，然后根据该哈希映射到这个大数据集中的某个位置，将其中的数读取出来（同时将其相邻的元素读取出来），然后进行一些运算算出下一个位置，总共进行 64 次循环，共读取 128 个数。最后算出一个哈希值，和挖矿难度的目标域值比较，看是否符合要求，如果不符合，更换 nonce 之后再重新计算</p>\n<h3 id=\"2、矿工保存-dataset-的原因\"><a href=\"#2、矿工保存-dataset-的原因\" class=\"headerlink\" title=\"2、矿工保存 dataset 的原因\"></a>2、矿工保存 dataset 的原因</h3><p>由于矿工需要验证非常多的 nonce，如果每次都从 16M 的 cache 中重新生成，挖矿的效率就太低了，并且其中有大量的重复计算（因为随机选取的 dataset 的元素中有很多是重复的，可能是之前尝试别的 nonce 时用过的）。所以矿工采取空间换时间的策略，保存整个 dataset</p>\n<h3 id=\"3、轻节点只保存-cache-的原因\"><a href=\"#3、轻节点只保存-cache-的原因\" class=\"headerlink\" title=\"3、轻节点只保存 cache 的原因\"></a>3、轻节点只保存 cache 的原因</h3><p>轻节点由于只验证一个 nonce，验证时直接生成要用到的 dataset 中的元素即可</p>\n<p>和比特币相比，以太坊中验证一个 nonce 的计算量要大很多，但也在可接受范围内</p>\n<p>目前以太坊挖矿还是以 GPU 为主，所以起到了 ASIC resistance</p>\n<h2 id=\"三、以太坊-POS\"><a href=\"#三、以太坊-POS\" class=\"headerlink\" title=\"三、以太坊 POS\"></a>三、以太坊 POS</h2><p>以太坊没有出现 ASIC 矿机的另一个原因是，以太坊2.0（或以太坊合并）已经于 2022年 从 POW 转向 POS（Power of Stake，权益证明），即按照所占的权益进行投票从而形成共识，而不是挖矿，类似于股份制公司按照股份多少来投票</p>\n<p>这对于 ASIC 厂商是很大的威胁，因为其研发周期很长（1年都算快的），并且研发成本也很高，如果后续不挖矿了，那么所有投入都白费了</p>\n<h2 id=\"四、预挖矿\"><a href=\"#四、预挖矿\" class=\"headerlink\" title=\"四、预挖矿\"></a>四、预挖矿</h2><p>以太坊采用了 pre-mining（预挖矿），在当初发行货币的时候，预留一部分货币给以太坊的开发者，类似创业公司留一部分股票给创始人和早期员工；而比特币没有采用 pre-mining 的模式，都是挖矿挖出来的</p>\n<p>Pre-sale（预售） 就是把 pre-mining 中预留的币，通过出售的方法来换取一些资产，用于加密货币的开发工作</p>\n<p>但有一些人认为，让通用计算设备参与挖矿反而是不安全的，用 ASIC 芯片挖矿才是最安全的，因为购买矿机需要大量的资金，并且只能用于一种加密货币，成本较高</p>\n","site":{"data":{}},"excerpt":"","more":"<p>Block chain is secured by mining（挖矿保障了区块链的安全性），比特币的挖矿算法是一个天然的 bug bounty（悬赏找bug），如果能找到漏洞或挖矿的捷径（shortcut）就能获取很大的利益</p>\n<p>很多人认为，挖矿设备的专业化 和比特币的去中心化理念是相违背的（one cpu, one vote），普通人能够参与挖矿有利于分散算力，预防 51% attack。所以后续的加密货币设计 mining puzzle 的一个理念是 ASIC resistance</p>\n<p>设计 ASIC resistance 的 mining puzzle 的常用做法是：增加 puzzle 对内存访问的需求，即 memory hard mining puzzle，因为 ASIC 芯片计算能力强，但是在内存访问的性能上没有很大的优势</p>\n<h2 id=\"一、LiteCoin-Scrypt\"><a href=\"#一、LiteCoin-Scrypt\" class=\"headerlink\" title=\"一、LiteCoin &amp; Scrypt\"></a>一、LiteCoin &amp; Scrypt</h2><p>一个早期的例子是 LiteCoin（莱特币），曾经是市值仅次于比特币的加密货币，其 mining puzzle 基于 scrypt</p>\n<p>Scrypt 是一个对内存要求很高的哈希函数，设计思想是：开设一个很大的数组，按照顺序填充一些伪随机数；具体过程是：按照一个 seed 的值，运算出一个数填在第一个位置，后面每个位置都是前一个位置取哈希得到的；其特点是里面的取值是有前后依赖关系的；求解 puzzle 时，按照伪随机的顺序从数组中读取一些数（通过对当前数运算得到下一个读取顺序，模拟随机）；好处是：如果数组开得足够大，对于矿工来说就是 memory hard 的，有的矿工可能保存一部分内存区域的内容，比如只保留奇数位置的数，需要读取到偶数再算，这也叫做 time-memory trade off（时间换空间）</p>\n<p>其坏处是：对于轻节点验证来说也是 memory hard，不符合 difficult to solve, but easy to verify。所以其实际使用过程中，数组只有 128k，不足以对 ASIC 芯片造成遏制，但该理念对其冷启动有很大帮助（需要冷启动是因为，参与挖矿的人太少很容易遭受恶意攻击），所以莱特币现在仍然是主流货币</p>\n<p>莱特币的出块时间是两分半，速度是比特币的四倍，其他部分和比特币基本相同</p>\n<h2 id=\"二、以太坊-memory-hard\"><a href=\"#二、以太坊-memory-hard\" class=\"headerlink\" title=\"二、以太坊 memory hard\"></a>二、以太坊 memory hard</h2><p>以太坊的挖矿算法叫做 ethash，矿工挖矿需要 1G 的内存，和莱特币的 128k 比，大了 8000 多倍，光是 cashe 就大了 100 多倍；更别说现在内存要求还在增长</p>\n<p>以太坊使用一大一小两个数据集：16M 的 cache 和 1G 的dataset，轻节点只要保存 cache，矿工才需要保存 1G 的大数据集</p>\n<h3 id=\"1、具体算法\"><a href=\"#1、具体算法\" class=\"headerlink\" title=\"1、具体算法\"></a>1、具体算法</h3><p>算法太复杂了，没完全搞明白，具体算法的伪代码可参考课程视频（28分）：</p>\n<p><a class=\"link\"   href=\"https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=19\" >https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&amp;vd_source=69ac93649ea21c4726fe85f272b6d968&amp;p=19<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p>cache 的生成方式和 scrypt 类似，但是不同于莱特币从数组中按照伪随机的顺序读取并进行运算，以太坊是需要先生成一个更大的数组（dataset 要大得多），而且 cache 和 dataset 是定期增长的，因为计算机的内存容量也在增长</p>\n<p>dataset 中的每个元素都是从 cache 中按照伪随机的顺序读取一些元素（和莱特币类似），一共读 256 次，用这 256 个数算出一个数，作为 dataset 的第一个元素，后续元素也一样</p>\n<p>求解 puzzle 时只使用 dataset 中的数，按照伪随机的顺序，从大数据集中读取 128 个数：一开始根据区块的块头、包括其中的 nonce 值，算出一个初始的哈希，然后根据该哈希映射到这个大数据集中的某个位置，将其中的数读取出来（同时将其相邻的元素读取出来），然后进行一些运算算出下一个位置，总共进行 64 次循环，共读取 128 个数。最后算出一个哈希值，和挖矿难度的目标域值比较，看是否符合要求，如果不符合，更换 nonce 之后再重新计算</p>\n<h3 id=\"2、矿工保存-dataset-的原因\"><a href=\"#2、矿工保存-dataset-的原因\" class=\"headerlink\" title=\"2、矿工保存 dataset 的原因\"></a>2、矿工保存 dataset 的原因</h3><p>由于矿工需要验证非常多的 nonce，如果每次都从 16M 的 cache 中重新生成，挖矿的效率就太低了，并且其中有大量的重复计算（因为随机选取的 dataset 的元素中有很多是重复的，可能是之前尝试别的 nonce 时用过的）。所以矿工采取空间换时间的策略，保存整个 dataset</p>\n<h3 id=\"3、轻节点只保存-cache-的原因\"><a href=\"#3、轻节点只保存-cache-的原因\" class=\"headerlink\" title=\"3、轻节点只保存 cache 的原因\"></a>3、轻节点只保存 cache 的原因</h3><p>轻节点由于只验证一个 nonce，验证时直接生成要用到的 dataset 中的元素即可</p>\n<p>和比特币相比，以太坊中验证一个 nonce 的计算量要大很多，但也在可接受范围内</p>\n<p>目前以太坊挖矿还是以 GPU 为主，所以起到了 ASIC resistance</p>\n<h2 id=\"三、以太坊-POS\"><a href=\"#三、以太坊-POS\" class=\"headerlink\" title=\"三、以太坊 POS\"></a>三、以太坊 POS</h2><p>以太坊没有出现 ASIC 矿机的另一个原因是，以太坊2.0（或以太坊合并）已经于 2022年 从 POW 转向 POS（Power of Stake，权益证明），即按照所占的权益进行投票从而形成共识，而不是挖矿，类似于股份制公司按照股份多少来投票</p>\n<p>这对于 ASIC 厂商是很大的威胁，因为其研发周期很长（1年都算快的），并且研发成本也很高，如果后续不挖矿了，那么所有投入都白费了</p>\n<h2 id=\"四、预挖矿\"><a href=\"#四、预挖矿\" class=\"headerlink\" title=\"四、预挖矿\"></a>四、预挖矿</h2><p>以太坊采用了 pre-mining（预挖矿），在当初发行货币的时候，预留一部分货币给以太坊的开发者，类似创业公司留一部分股票给创始人和早期员工；而比特币没有采用 pre-mining 的模式，都是挖矿挖出来的</p>\n<p>Pre-sale（预售） 就是把 pre-mining 中预留的币，通过出售的方法来换取一些资产，用于加密货币的开发工作</p>\n<p>但有一些人认为，让通用计算设备参与挖矿反而是不安全的，用 ASIC 芯片挖矿才是最安全的，因为购买矿机需要大量的资金，并且只能用于一种加密货币，成本较高</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用20-ETH挖矿难度调整","date":"2025-01-18T04:44:43.000Z","_content":"\n比特币是每隔 2016 个区块会调整挖矿难度，目标是维持出块时间在十分钟左右；以太坊是每个区块都可以修改挖矿难度\n\n## 一、难度调整公式\n\n![图一](../images/49/1.png)\n\n基础部分的作用是维持出块时间在 15秒 左右\n\nε 是难度炸弹，为了以太坊从 POW 逐步过渡到 POS\n\n### 1、基础部分\n\n![图二](../images/49/2.png)\n\nx 是难度调整的力度，为父区块的难度除以 2048，再向下取整\n\n一次性下调难度最多是父区块难度的 99/2048\n\n![图三](../images/49/3.png)\n\n### 2、难度炸弹\n\n![图四](../images/49/4.png)\n\n## 二、以太坊发展的四个阶段\n\nFrontier（前沿）、Homestead（家园）、Metropolis（大都会）和 Serenity（宁静）\n\n其中 Metropolis 分为 两个子阶段：Byzantium（拜占庭） 和 Constantinople（君士坦丁堡），难度炸弹的回调发生在 Byzantium 阶段\n\nSerenity（宁静）即以太坊2.0，从 POW 转向 POS\n\n![图五](../images/49/5.png)\n\nEIP（Ethereum Improvement Proposal）：以太坊改进提案\n\nBitCoin Improvement Proposal）：比特币改进提案\n\n## 三、具体代码实现\n\n略，没特别明白，可以参考课程视频（20分）：\n\nhttps://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=20\n\n比特币中讲过最长合法链，而对于以太坊来说是最难合法链\n","source":"_posts/49-北大区块链-ETH挖矿难度调整.md","raw":"---\ntitle: 北大-区块链技术与应用20-ETH挖矿难度调整\ndate: 2025-01-18 12:44:43\ntags:\n    - web3\n    - ETH\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n比特币是每隔 2016 个区块会调整挖矿难度，目标是维持出块时间在十分钟左右；以太坊是每个区块都可以修改挖矿难度\n\n## 一、难度调整公式\n\n![图一](../images/49/1.png)\n\n基础部分的作用是维持出块时间在 15秒 左右\n\nε 是难度炸弹，为了以太坊从 POW 逐步过渡到 POS\n\n### 1、基础部分\n\n![图二](../images/49/2.png)\n\nx 是难度调整的力度，为父区块的难度除以 2048，再向下取整\n\n一次性下调难度最多是父区块难度的 99/2048\n\n![图三](../images/49/3.png)\n\n### 2、难度炸弹\n\n![图四](../images/49/4.png)\n\n## 二、以太坊发展的四个阶段\n\nFrontier（前沿）、Homestead（家园）、Metropolis（大都会）和 Serenity（宁静）\n\n其中 Metropolis 分为 两个子阶段：Byzantium（拜占庭） 和 Constantinople（君士坦丁堡），难度炸弹的回调发生在 Byzantium 阶段\n\nSerenity（宁静）即以太坊2.0，从 POW 转向 POS\n\n![图五](../images/49/5.png)\n\nEIP（Ethereum Improvement Proposal）：以太坊改进提案\n\nBitCoin Improvement Proposal）：比特币改进提案\n\n## 三、具体代码实现\n\n略，没特别明白，可以参考课程视频（20分）：\n\nhttps://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=20\n\n比特币中讲过最长合法链，而对于以太坊来说是最难合法链\n","slug":"49-北大区块链-ETH挖矿难度调整","published":1,"updated":"2025-05-20T02:47:28.685Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvud00446kpr63rl9tew","content":"<p>比特币是每隔 2016 个区块会调整挖矿难度，目标是维持出块时间在十分钟左右；以太坊是每个区块都可以修改挖矿难度</p>\n<h2 id=\"一、难度调整公式\"><a href=\"#一、难度调整公式\" class=\"headerlink\" title=\"一、难度调整公式\"></a>一、难度调整公式</h2><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/49/1.png\"\n                      alt=\"图一\"\n                ></p>\n<p>基础部分的作用是维持出块时间在 15秒 左右</p>\n<p>ε 是难度炸弹，为了以太坊从 POW 逐步过渡到 POS</p>\n<h3 id=\"1、基础部分\"><a href=\"#1、基础部分\" class=\"headerlink\" title=\"1、基础部分\"></a>1、基础部分</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/49/2.png\"\n                      alt=\"图二\"\n                ></p>\n<p>x 是难度调整的力度，为父区块的难度除以 2048，再向下取整</p>\n<p>一次性下调难度最多是父区块难度的 99&#x2F;2048</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/49/3.png\"\n                      alt=\"图三\"\n                ></p>\n<h3 id=\"2、难度炸弹\"><a href=\"#2、难度炸弹\" class=\"headerlink\" title=\"2、难度炸弹\"></a>2、难度炸弹</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/49/4.png\"\n                      alt=\"图四\"\n                ></p>\n<h2 id=\"二、以太坊发展的四个阶段\"><a href=\"#二、以太坊发展的四个阶段\" class=\"headerlink\" title=\"二、以太坊发展的四个阶段\"></a>二、以太坊发展的四个阶段</h2><p>Frontier（前沿）、Homestead（家园）、Metropolis（大都会）和 Serenity（宁静）</p>\n<p>其中 Metropolis 分为 两个子阶段：Byzantium（拜占庭） 和 Constantinople（君士坦丁堡），难度炸弹的回调发生在 Byzantium 阶段</p>\n<p>Serenity（宁静）即以太坊2.0，从 POW 转向 POS</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/49/5.png\"\n                      alt=\"图五\"\n                ></p>\n<p>EIP（Ethereum Improvement Proposal）：以太坊改进提案</p>\n<p>BitCoin Improvement Proposal）：比特币改进提案</p>\n<h2 id=\"三、具体代码实现\"><a href=\"#三、具体代码实现\" class=\"headerlink\" title=\"三、具体代码实现\"></a>三、具体代码实现</h2><p>略，没特别明白，可以参考课程视频（20分）：</p>\n<p><a class=\"link\"   href=\"https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=20\" >https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&amp;vd_source=69ac93649ea21c4726fe85f272b6d968&amp;p=20<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p>比特币中讲过最长合法链，而对于以太坊来说是最难合法链</p>\n","site":{"data":{}},"excerpt":"","more":"<p>比特币是每隔 2016 个区块会调整挖矿难度，目标是维持出块时间在十分钟左右；以太坊是每个区块都可以修改挖矿难度</p>\n<h2 id=\"一、难度调整公式\"><a href=\"#一、难度调整公式\" class=\"headerlink\" title=\"一、难度调整公式\"></a>一、难度调整公式</h2><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/49/1.png\"\n                      alt=\"图一\"\n                ></p>\n<p>基础部分的作用是维持出块时间在 15秒 左右</p>\n<p>ε 是难度炸弹，为了以太坊从 POW 逐步过渡到 POS</p>\n<h3 id=\"1、基础部分\"><a href=\"#1、基础部分\" class=\"headerlink\" title=\"1、基础部分\"></a>1、基础部分</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/49/2.png\"\n                      alt=\"图二\"\n                ></p>\n<p>x 是难度调整的力度，为父区块的难度除以 2048，再向下取整</p>\n<p>一次性下调难度最多是父区块难度的 99&#x2F;2048</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/49/3.png\"\n                      alt=\"图三\"\n                ></p>\n<h3 id=\"2、难度炸弹\"><a href=\"#2、难度炸弹\" class=\"headerlink\" title=\"2、难度炸弹\"></a>2、难度炸弹</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/49/4.png\"\n                      alt=\"图四\"\n                ></p>\n<h2 id=\"二、以太坊发展的四个阶段\"><a href=\"#二、以太坊发展的四个阶段\" class=\"headerlink\" title=\"二、以太坊发展的四个阶段\"></a>二、以太坊发展的四个阶段</h2><p>Frontier（前沿）、Homestead（家园）、Metropolis（大都会）和 Serenity（宁静）</p>\n<p>其中 Metropolis 分为 两个子阶段：Byzantium（拜占庭） 和 Constantinople（君士坦丁堡），难度炸弹的回调发生在 Byzantium 阶段</p>\n<p>Serenity（宁静）即以太坊2.0，从 POW 转向 POS</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/49/5.png\"\n                      alt=\"图五\"\n                ></p>\n<p>EIP（Ethereum Improvement Proposal）：以太坊改进提案</p>\n<p>BitCoin Improvement Proposal）：比特币改进提案</p>\n<h2 id=\"三、具体代码实现\"><a href=\"#三、具体代码实现\" class=\"headerlink\" title=\"三、具体代码实现\"></a>三、具体代码实现</h2><p>略，没特别明白，可以参考课程视频（20分）：</p>\n<p><a class=\"link\"   href=\"https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=20\" >https://www.bilibili.com/video/BV1Vt411X7JF?spm_id_from=333.788.player.switch&amp;vd_source=69ac93649ea21c4726fe85f272b6d968&amp;p=20<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p>比特币中讲过最长合法链，而对于以太坊来说是最难合法链</p>\n","_processedHighlight":true},{"title":"为什么 vue 组件添加 scoped 后，某些组件样式不生效","date":"2023-11-14T09:46:52.000Z","_content":"\n## 简述\n\n在父组件中修改子组件的某些样式，发现不生效，删去``<style scoped></style>``中的 scoped 后生效。\n\n## 原因\n\nscoped 实现样式隔离的原理为：\n\n编译时，父组件的所有标签、子组件的根标签、以及所有的样式 都会加上特殊的标识；\n\n因为子组件内部的标签都没有此种标识，所以样式就不会生效。\n\n## 实例\n\n### 不添加 scoped\n\n``` html\n<!-- 父组件 -->\n<template>\n  <div class=\"parent\">\n    <p>Here is parent component</p>\n    <TestScoped />  \n  </div>\n</template>\n<style>\n.parent {\n  color: deepskyblue;\n}\n</style>\n```\n\n``` html\n<!-- 子组件 -->\n<template>\n  <div class=\"son\">\n    <p>Here is son component</p>\n  </div>\n</template>\n```\n\n编译后：\n\n``` html\n<div class=\"parent\">\n    <p>Here is parent component</p>\n    <div class=\"son\">\n        <p>Here is son component</p>\n    </div>\n</div>\n```\n\n``` css\np {\n  color: deepskyblue;\n}\n```\n\n### 添加 scoped\n\n编译后：\n\n``` html\n<div data-v-7ba5bd90 class=\"parent\">\n    <p data-v-7ba5bd90>Here is parent component</p>\n    <div data-v-7ba5bd90 class=\"son\">\n        <!-- 没有标识，所以不生效 -->\n        <p>Here is son component</p>\n    </div>\n</div>\n```\n\n``` css\np[data-v-7ba5bd90] {\n    color: deepskyblue;\n}\n```\n\n## 解决方法\n\n### 深度作用选择器\n\n使用 /deep/ 或者 ::v-deep\n\n``` css\n/deep/ p {\n  color: deepskyblue;\n}\n/* 或者 */\n::v-deep p {\n  color: deepskyblue;\n}\n```\n\n编译后：\n\nhtml 结果不变，样式代码变化\n\n``` css\n[data-v-7ba5bd90] p {\n  color: deepskyblue;\n}\n```\n\n### 使用无 scoped 的 style\n\n``` html\n<style scoped>\np {\n  color: deepskyblue;\n}\n</style>\n\n<style>\n/* 生效样式代码 */\n</style>\n```\n","source":"_posts/5-为什么vue组件添加scoped后某些组件样式不生效.md","raw":"---\ntitle: 为什么 vue 组件添加 scoped 后，某些组件样式不生效\ndate: 2023-11-14 17:46:52\ntags:\n    - vue\n    - 实践问题\ncategories:\n    - vue\n      - 样式\n---\n\n## 简述\n\n在父组件中修改子组件的某些样式，发现不生效，删去``<style scoped></style>``中的 scoped 后生效。\n\n## 原因\n\nscoped 实现样式隔离的原理为：\n\n编译时，父组件的所有标签、子组件的根标签、以及所有的样式 都会加上特殊的标识；\n\n因为子组件内部的标签都没有此种标识，所以样式就不会生效。\n\n## 实例\n\n### 不添加 scoped\n\n``` html\n<!-- 父组件 -->\n<template>\n  <div class=\"parent\">\n    <p>Here is parent component</p>\n    <TestScoped />  \n  </div>\n</template>\n<style>\n.parent {\n  color: deepskyblue;\n}\n</style>\n```\n\n``` html\n<!-- 子组件 -->\n<template>\n  <div class=\"son\">\n    <p>Here is son component</p>\n  </div>\n</template>\n```\n\n编译后：\n\n``` html\n<div class=\"parent\">\n    <p>Here is parent component</p>\n    <div class=\"son\">\n        <p>Here is son component</p>\n    </div>\n</div>\n```\n\n``` css\np {\n  color: deepskyblue;\n}\n```\n\n### 添加 scoped\n\n编译后：\n\n``` html\n<div data-v-7ba5bd90 class=\"parent\">\n    <p data-v-7ba5bd90>Here is parent component</p>\n    <div data-v-7ba5bd90 class=\"son\">\n        <!-- 没有标识，所以不生效 -->\n        <p>Here is son component</p>\n    </div>\n</div>\n```\n\n``` css\np[data-v-7ba5bd90] {\n    color: deepskyblue;\n}\n```\n\n## 解决方法\n\n### 深度作用选择器\n\n使用 /deep/ 或者 ::v-deep\n\n``` css\n/deep/ p {\n  color: deepskyblue;\n}\n/* 或者 */\n::v-deep p {\n  color: deepskyblue;\n}\n```\n\n编译后：\n\nhtml 结果不变，样式代码变化\n\n``` css\n[data-v-7ba5bd90] p {\n  color: deepskyblue;\n}\n```\n\n### 使用无 scoped 的 style\n\n``` html\n<style scoped>\np {\n  color: deepskyblue;\n}\n</style>\n\n<style>\n/* 生效样式代码 */\n</style>\n```\n","slug":"5-为什么vue组件添加scoped后某些组件样式不生效","published":1,"updated":"2025-05-20T02:47:28.685Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvud00476kpr0nk2gg4d","content":"<h2 id=\"简述\"><a href=\"#简述\" class=\"headerlink\" title=\"简述\"></a>简述</h2><p>在父组件中修改子组件的某些样式，发现不生效，删去<code>&lt;style scoped&gt;&lt;/style&gt;</code>中的 scoped 后生效。</p>\n<h2 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a>原因</h2><p>scoped 实现样式隔离的原理为：</p>\n<p>编译时，父组件的所有标签、子组件的根标签、以及所有的样式 都会加上特殊的标识；</p>\n<p>因为子组件内部的标签都没有此种标识，所以样式就不会生效。</p>\n<h2 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h2><h3 id=\"不添加-scoped\"><a href=\"#不添加-scoped\" class=\"headerlink\" title=\"不添加 scoped\"></a>不添加 scoped</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;parent&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Here is parent component<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">TestScoped</span> /&gt;</span>  </span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"selector-class\">.parent</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">  <span class=\"attribute\">color</span>: deepskyblue;</span></span><br><span class=\"line\"><span class=\"language-css\">&#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;son&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Here is son component<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>编译后：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;parent&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Here is parent component<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;son&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Here is son component<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Css\"><figure class=\"iseeu highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">p</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: deepskyblue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"添加-scoped\"><a href=\"#添加-scoped\" class=\"headerlink\" title=\"添加 scoped\"></a>添加 scoped</h3><p>编译后：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-v-7ba5bd90</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;parent&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">data-v-7ba5bd90</span>&gt;</span>Here is parent component<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-v-7ba5bd90</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;son&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- 没有标识，所以不生效 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Here is son component<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Css\"><figure class=\"iseeu highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">p</span><span class=\"selector-attr\">[data-v-7ba5bd90]</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: deepskyblue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h2><h3 id=\"深度作用选择器\"><a href=\"#深度作用选择器\" class=\"headerlink\" title=\"深度作用选择器\"></a>深度作用选择器</h3><p>使用 &#x2F;deep&#x2F; 或者 ::v-deep</p>\n<div class=\"code-container\" data-rel=\"Css\"><figure class=\"iseeu highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/deep/ <span class=\"selector-tag\">p</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: deepskyblue;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/* 或者 */</span></span><br><span class=\"line\">::v-deep p &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: deepskyblue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>编译后：</p>\n<p>html 结果不变，样式代码变化</p>\n<div class=\"code-container\" data-rel=\"Css\"><figure class=\"iseeu highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-attr\">[data-v-7ba5bd90]</span> <span class=\"selector-tag\">p</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: deepskyblue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"使用无-scoped-的-style\"><a href=\"#使用无-scoped-的-style\" class=\"headerlink\" title=\"使用无 scoped 的 style\"></a>使用无 scoped 的 style</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"selector-tag\">p</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">  <span class=\"attribute\">color</span>: deepskyblue;</span></span><br><span class=\"line\"><span class=\"language-css\">&#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"comment\">/* 生效样式代码 */</span></span></span><br><span class=\"line\"><span class=\"language-css\"></span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"简述\"><a href=\"#简述\" class=\"headerlink\" title=\"简述\"></a>简述</h2><p>在父组件中修改子组件的某些样式，发现不生效，删去<code>&lt;style scoped&gt;&lt;/style&gt;</code>中的 scoped 后生效。</p>\n<h2 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a>原因</h2><p>scoped 实现样式隔离的原理为：</p>\n<p>编译时，父组件的所有标签、子组件的根标签、以及所有的样式 都会加上特殊的标识；</p>\n<p>因为子组件内部的标签都没有此种标识，所以样式就不会生效。</p>\n<h2 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h2><h3 id=\"不添加-scoped\"><a href=\"#不添加-scoped\" class=\"headerlink\" title=\"不添加 scoped\"></a>不添加 scoped</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;parent&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Here is parent component<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">TestScoped</span> /&gt;</span>  </span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"selector-class\">.parent</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">  <span class=\"attribute\">color</span>: deepskyblue;</span></span><br><span class=\"line\"><span class=\"language-css\">&#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;son&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Here is son component<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>编译后：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;parent&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Here is parent component<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;son&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Here is son component<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">p</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: deepskyblue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"添加-scoped\"><a href=\"#添加-scoped\" class=\"headerlink\" title=\"添加 scoped\"></a>添加 scoped</h3><p>编译后：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-v-7ba5bd90</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;parent&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">data-v-7ba5bd90</span>&gt;</span>Here is parent component<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-v-7ba5bd90</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;son&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- 没有标识，所以不生效 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Here is son component<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">p</span><span class=\"selector-attr\">[data-v-7ba5bd90]</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: deepskyblue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h2><h3 id=\"深度作用选择器\"><a href=\"#深度作用选择器\" class=\"headerlink\" title=\"深度作用选择器\"></a>深度作用选择器</h3><p>使用 &#x2F;deep&#x2F; 或者 ::v-deep</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/deep/ <span class=\"selector-tag\">p</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: deepskyblue;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/* 或者 */</span></span><br><span class=\"line\">::v-deep p &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: deepskyblue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>编译后：</p>\n<p>html 结果不变，样式代码变化</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-attr\">[data-v-7ba5bd90]</span> <span class=\"selector-tag\">p</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: deepskyblue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用无-scoped-的-style\"><a href=\"#使用无-scoped-的-style\" class=\"headerlink\" title=\"使用无 scoped 的 style\"></a>使用无 scoped 的 style</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">scoped</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"selector-tag\">p</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">  <span class=\"attribute\">color</span>: deepskyblue;</span></span><br><span class=\"line\"><span class=\"language-css\">&#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"comment\">/* 生效样式代码 */</span></span></span><br><span class=\"line\"><span class=\"language-css\"></span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用21-权益证明","date":"2025-01-18T16:57:02.000Z","_content":"\nPOW（Proof of work，工作量证明）受到的普遍批评是浪费电\n\n以太坊交易的能耗比比特币低，是因为出块时间更短\n\n## 一、POS 基本思想\n\nPOS（Proof of Stake，权益证明）的基本思想是：按照每个人投入资金的多少来决定收益的分配，这也叫做 virtual mining（虚拟挖矿）\n\n采用权益证明的货币，在发行前一般会预留一部分货币给开发者，也会出售一部分货币来换取开发所需的资金。将来按照的权益证明的共识机制，按照每个人持有货币的数量进行投票\n\n## 二、POS 的好处\n\n（1）省去了挖矿的过程，也避免了由此带来的能耗和对环境的影响\n\n（2）如果有人想发动恶意攻击，需要设法获得该币种一半以上的份额，即发动攻击的资源只能从加密系统内部获得，形成一个闭环。如果有人在初期大量买入，币价大涨，早期投资者可能会跑卖出路（类似于股份制公司遭受恶意收购）\n\n基于 POW 的共识系统，从某种意义上来说，维护区块链安全的资源不是一个闭环，因为 Block chain is secured by mining. 而 mining 所需的 equipment 是由法币买来的（即加密货币的生态系统之外得到的），这就带来一个问题：虽然加密货币的总市值有了很大的增长，但是和世界经济总量相比仍然是微乎其微的，也就是说发动 51% attack 攻击的资源可以从外界得到、并且是有可能达到的，尤其对于刚发行的小的币种 AltCoin（Alternative coin），这叫做 AltCoin Infanticide（杀婴）\n\n有些加密货币采用的是一种混合模型，即仍然需要挖矿，但是挖矿难度和占有权益（持有币的数量）相关。这样会导致，系统中持有币数量最多的人，每次挖矿都最容易，所以有些加密货币要求，投入的币会被锁定一段时间，不能重复使用（比如：挖矿时投入一些币降低挖矿难度，等区块发布出来后，投入的币就会被锁定一段时间，下次再挖就不能用了，过一定区块才能继续用），这叫做 Proof of Deposit（存款证明）\n\n## 三、早期 POS 遭遇的问题\n\nNothing at stake（两边下注）：参与者通过持有并锁定一定数量的加密货币、而不需要消耗资源（如算力）来生成区块，因此可以同时支持多个分叉上的区块而没有损失\n\n## 四、Casper 协议\n\nCasper 是以太坊采用的 POS 协议\n\nCasper the Friendly Finality Gadget（CFG，Casper 友好的最终性工具）：在过渡阶段，需要和工作量证明混合使用，为工作量证明提供 finality，它是一种最终的状态，包含在其中的交易不会被取消\n\n单纯基于挖矿的交易时可能被回滚的，比如某个交易被写入区块链里，但是有人从前面的区块开始分叉，挖出一条更长的分叉链\n\nCasper 引入了 validator（验证者）的概念，validator 必须投入一定数量的以太币作为保证金，保证金会被锁定。Validator 的作用是推动系统达成共识，投票决定哪条链是最长合法链，投票权重取决于保证金的数目大小\n\n具体做法类似于数据库中的 two-phase commit（两阶段提交），第一阶段是 prepare message，第二阶段是 commit message\n\n每挖出 100个 区块，就作为一个 epoch（纪元），要决定其能否成为 finality 需要进行投票，Casper 规定每一轮投票都要得到 2/3 以上验证者（按照保证金金额大小）同意才能通过\n\n![图一](../images/50/1.png)\n\n实际系统中不区分 prepare message 和 commit message，而且把 epoch 从原来的 100个 区块，减少到了 50个 区块就作为一个 epoch，每个 epoch 只需要一轮投票，投票结果对于上一个区块是 commit message，对于下一个区块是 prepare message，需要连续两轮投票（2个 epoch）都得到 2/3 以上的通过，才算有效\n\n![图二](../images/50/2.png)\n\n验证者参与该过程的好处是，如果其履行职责，可以得到相应的奖励；相反，如果验证者有不良行为被发现，会受到相应的处罚，比如：该投票时不投票，导致系统迟迟无法达成共识，这种情况会扣除其一部分保证金；比如乱投票，给两个有冲突的分叉都投票（两边下注），这种情况会没收其所有保证金（所有扣除或没收都是销毁的模式）\n\n每个验证者有一定的任期，任期满后会有一个等待期，该等待期是为了让其他节点检举或揭发其是否有不良行为。如果等待期过了，验证者就可以取回当初的保证金和应得的奖励\n\n## 五、关于 Casper 的思考\n\nCasper 在挖矿的过程中，对其状态做一个 check point（检查点），这是否安全；或者说通过验证者投票达成的 finality 是否可能被推翻？\n\n假设某个有恶意的组织想发动攻击，如果组织仅仅是矿工，那么就无法推翻已经达成的 finality，因为它是验证者投票的结果；如果组织是验证者，由于需要连续两轮投票都得到 2/3 以上的通过才算有效，那么至少有 1/3 的验证者两边下注了：正常链得到至少 2/3 的票数，非法链也得到至少 2/3 的票数，那么至少一共是 2/3+2/3=4/3 的票数，即至少 4/3-1=1/3 的验证者都参与了两条链的投票。这 1/3 的验证者被发现后，会被没收所有的保证金\n\nEOS 加密货币（俗称柚子），采用的是 DPOS（Delegated Proof of Stake）协议，先用投票的方式选出 21个 超级节点，再由这些超级节点产生区块，现在已经凉了\n\n## 六、POW 的争论\n\n很多人认为 POW 挖矿的好处是，提供了把多余电能转化为钱的一种手段，可以有效地化解过剩产能，带动当地经济的发展。因为电能是很难存储、很难传输的，很多大型数据中心要建在电比较便宜的地方，就是因为传输数据比传输电容易，很多比特币的矿场都是建在电力资源丰富的地方\n","source":"_posts/50-北大区块链-POS.md","raw":"---\ntitle: 北大-区块链技术与应用21-权益证明\ndate: 2025-01-19 00:57:02\ntags:\n    - web3\n    - ETH\n    - POS\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\nPOW（Proof of work，工作量证明）受到的普遍批评是浪费电\n\n以太坊交易的能耗比比特币低，是因为出块时间更短\n\n## 一、POS 基本思想\n\nPOS（Proof of Stake，权益证明）的基本思想是：按照每个人投入资金的多少来决定收益的分配，这也叫做 virtual mining（虚拟挖矿）\n\n采用权益证明的货币，在发行前一般会预留一部分货币给开发者，也会出售一部分货币来换取开发所需的资金。将来按照的权益证明的共识机制，按照每个人持有货币的数量进行投票\n\n## 二、POS 的好处\n\n（1）省去了挖矿的过程，也避免了由此带来的能耗和对环境的影响\n\n（2）如果有人想发动恶意攻击，需要设法获得该币种一半以上的份额，即发动攻击的资源只能从加密系统内部获得，形成一个闭环。如果有人在初期大量买入，币价大涨，早期投资者可能会跑卖出路（类似于股份制公司遭受恶意收购）\n\n基于 POW 的共识系统，从某种意义上来说，维护区块链安全的资源不是一个闭环，因为 Block chain is secured by mining. 而 mining 所需的 equipment 是由法币买来的（即加密货币的生态系统之外得到的），这就带来一个问题：虽然加密货币的总市值有了很大的增长，但是和世界经济总量相比仍然是微乎其微的，也就是说发动 51% attack 攻击的资源可以从外界得到、并且是有可能达到的，尤其对于刚发行的小的币种 AltCoin（Alternative coin），这叫做 AltCoin Infanticide（杀婴）\n\n有些加密货币采用的是一种混合模型，即仍然需要挖矿，但是挖矿难度和占有权益（持有币的数量）相关。这样会导致，系统中持有币数量最多的人，每次挖矿都最容易，所以有些加密货币要求，投入的币会被锁定一段时间，不能重复使用（比如：挖矿时投入一些币降低挖矿难度，等区块发布出来后，投入的币就会被锁定一段时间，下次再挖就不能用了，过一定区块才能继续用），这叫做 Proof of Deposit（存款证明）\n\n## 三、早期 POS 遭遇的问题\n\nNothing at stake（两边下注）：参与者通过持有并锁定一定数量的加密货币、而不需要消耗资源（如算力）来生成区块，因此可以同时支持多个分叉上的区块而没有损失\n\n## 四、Casper 协议\n\nCasper 是以太坊采用的 POS 协议\n\nCasper the Friendly Finality Gadget（CFG，Casper 友好的最终性工具）：在过渡阶段，需要和工作量证明混合使用，为工作量证明提供 finality，它是一种最终的状态，包含在其中的交易不会被取消\n\n单纯基于挖矿的交易时可能被回滚的，比如某个交易被写入区块链里，但是有人从前面的区块开始分叉，挖出一条更长的分叉链\n\nCasper 引入了 validator（验证者）的概念，validator 必须投入一定数量的以太币作为保证金，保证金会被锁定。Validator 的作用是推动系统达成共识，投票决定哪条链是最长合法链，投票权重取决于保证金的数目大小\n\n具体做法类似于数据库中的 two-phase commit（两阶段提交），第一阶段是 prepare message，第二阶段是 commit message\n\n每挖出 100个 区块，就作为一个 epoch（纪元），要决定其能否成为 finality 需要进行投票，Casper 规定每一轮投票都要得到 2/3 以上验证者（按照保证金金额大小）同意才能通过\n\n![图一](../images/50/1.png)\n\n实际系统中不区分 prepare message 和 commit message，而且把 epoch 从原来的 100个 区块，减少到了 50个 区块就作为一个 epoch，每个 epoch 只需要一轮投票，投票结果对于上一个区块是 commit message，对于下一个区块是 prepare message，需要连续两轮投票（2个 epoch）都得到 2/3 以上的通过，才算有效\n\n![图二](../images/50/2.png)\n\n验证者参与该过程的好处是，如果其履行职责，可以得到相应的奖励；相反，如果验证者有不良行为被发现，会受到相应的处罚，比如：该投票时不投票，导致系统迟迟无法达成共识，这种情况会扣除其一部分保证金；比如乱投票，给两个有冲突的分叉都投票（两边下注），这种情况会没收其所有保证金（所有扣除或没收都是销毁的模式）\n\n每个验证者有一定的任期，任期满后会有一个等待期，该等待期是为了让其他节点检举或揭发其是否有不良行为。如果等待期过了，验证者就可以取回当初的保证金和应得的奖励\n\n## 五、关于 Casper 的思考\n\nCasper 在挖矿的过程中，对其状态做一个 check point（检查点），这是否安全；或者说通过验证者投票达成的 finality 是否可能被推翻？\n\n假设某个有恶意的组织想发动攻击，如果组织仅仅是矿工，那么就无法推翻已经达成的 finality，因为它是验证者投票的结果；如果组织是验证者，由于需要连续两轮投票都得到 2/3 以上的通过才算有效，那么至少有 1/3 的验证者两边下注了：正常链得到至少 2/3 的票数，非法链也得到至少 2/3 的票数，那么至少一共是 2/3+2/3=4/3 的票数，即至少 4/3-1=1/3 的验证者都参与了两条链的投票。这 1/3 的验证者被发现后，会被没收所有的保证金\n\nEOS 加密货币（俗称柚子），采用的是 DPOS（Delegated Proof of Stake）协议，先用投票的方式选出 21个 超级节点，再由这些超级节点产生区块，现在已经凉了\n\n## 六、POW 的争论\n\n很多人认为 POW 挖矿的好处是，提供了把多余电能转化为钱的一种手段，可以有效地化解过剩产能，带动当地经济的发展。因为电能是很难存储、很难传输的，很多大型数据中心要建在电比较便宜的地方，就是因为传输数据比传输电容易，很多比特币的矿场都是建在电力资源丰富的地方\n","slug":"50-北大区块链-POS","published":1,"updated":"2025-05-20T02:47:28.685Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvue004a6kpr1lsacpz9","content":"<p>POW（Proof of work，工作量证明）受到的普遍批评是浪费电</p>\n<p>以太坊交易的能耗比比特币低，是因为出块时间更短</p>\n<h2 id=\"一、POS-基本思想\"><a href=\"#一、POS-基本思想\" class=\"headerlink\" title=\"一、POS 基本思想\"></a>一、POS 基本思想</h2><p>POS（Proof of Stake，权益证明）的基本思想是：按照每个人投入资金的多少来决定收益的分配，这也叫做 virtual mining（虚拟挖矿）</p>\n<p>采用权益证明的货币，在发行前一般会预留一部分货币给开发者，也会出售一部分货币来换取开发所需的资金。将来按照的权益证明的共识机制，按照每个人持有货币的数量进行投票</p>\n<h2 id=\"二、POS-的好处\"><a href=\"#二、POS-的好处\" class=\"headerlink\" title=\"二、POS 的好处\"></a>二、POS 的好处</h2><p>（1）省去了挖矿的过程，也避免了由此带来的能耗和对环境的影响</p>\n<p>（2）如果有人想发动恶意攻击，需要设法获得该币种一半以上的份额，即发动攻击的资源只能从加密系统内部获得，形成一个闭环。如果有人在初期大量买入，币价大涨，早期投资者可能会跑卖出路（类似于股份制公司遭受恶意收购）</p>\n<p>基于 POW 的共识系统，从某种意义上来说，维护区块链安全的资源不是一个闭环，因为 Block chain is secured by mining. 而 mining 所需的 equipment 是由法币买来的（即加密货币的生态系统之外得到的），这就带来一个问题：虽然加密货币的总市值有了很大的增长，但是和世界经济总量相比仍然是微乎其微的，也就是说发动 51% attack 攻击的资源可以从外界得到、并且是有可能达到的，尤其对于刚发行的小的币种 AltCoin（Alternative coin），这叫做 AltCoin Infanticide（杀婴）</p>\n<p>有些加密货币采用的是一种混合模型，即仍然需要挖矿，但是挖矿难度和占有权益（持有币的数量）相关。这样会导致，系统中持有币数量最多的人，每次挖矿都最容易，所以有些加密货币要求，投入的币会被锁定一段时间，不能重复使用（比如：挖矿时投入一些币降低挖矿难度，等区块发布出来后，投入的币就会被锁定一段时间，下次再挖就不能用了，过一定区块才能继续用），这叫做 Proof of Deposit（存款证明）</p>\n<h2 id=\"三、早期-POS-遭遇的问题\"><a href=\"#三、早期-POS-遭遇的问题\" class=\"headerlink\" title=\"三、早期 POS 遭遇的问题\"></a>三、早期 POS 遭遇的问题</h2><p>Nothing at stake（两边下注）：参与者通过持有并锁定一定数量的加密货币、而不需要消耗资源（如算力）来生成区块，因此可以同时支持多个分叉上的区块而没有损失</p>\n<h2 id=\"四、Casper-协议\"><a href=\"#四、Casper-协议\" class=\"headerlink\" title=\"四、Casper 协议\"></a>四、Casper 协议</h2><p>Casper 是以太坊采用的 POS 协议</p>\n<p>Casper the Friendly Finality Gadget（CFG，Casper 友好的最终性工具）：在过渡阶段，需要和工作量证明混合使用，为工作量证明提供 finality，它是一种最终的状态，包含在其中的交易不会被取消</p>\n<p>单纯基于挖矿的交易时可能被回滚的，比如某个交易被写入区块链里，但是有人从前面的区块开始分叉，挖出一条更长的分叉链</p>\n<p>Casper 引入了 validator（验证者）的概念，validator 必须投入一定数量的以太币作为保证金，保证金会被锁定。Validator 的作用是推动系统达成共识，投票决定哪条链是最长合法链，投票权重取决于保证金的数目大小</p>\n<p>具体做法类似于数据库中的 two-phase commit（两阶段提交），第一阶段是 prepare message，第二阶段是 commit message</p>\n<p>每挖出 100个 区块，就作为一个 epoch（纪元），要决定其能否成为 finality 需要进行投票，Casper 规定每一轮投票都要得到 2&#x2F;3 以上验证者（按照保证金金额大小）同意才能通过</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/50/1.png\"\n                      alt=\"图一\"\n                ></p>\n<p>实际系统中不区分 prepare message 和 commit message，而且把 epoch 从原来的 100个 区块，减少到了 50个 区块就作为一个 epoch，每个 epoch 只需要一轮投票，投票结果对于上一个区块是 commit message，对于下一个区块是 prepare message，需要连续两轮投票（2个 epoch）都得到 2&#x2F;3 以上的通过，才算有效</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/50/2.png\"\n                      alt=\"图二\"\n                ></p>\n<p>验证者参与该过程的好处是，如果其履行职责，可以得到相应的奖励；相反，如果验证者有不良行为被发现，会受到相应的处罚，比如：该投票时不投票，导致系统迟迟无法达成共识，这种情况会扣除其一部分保证金；比如乱投票，给两个有冲突的分叉都投票（两边下注），这种情况会没收其所有保证金（所有扣除或没收都是销毁的模式）</p>\n<p>每个验证者有一定的任期，任期满后会有一个等待期，该等待期是为了让其他节点检举或揭发其是否有不良行为。如果等待期过了，验证者就可以取回当初的保证金和应得的奖励</p>\n<h2 id=\"五、关于-Casper-的思考\"><a href=\"#五、关于-Casper-的思考\" class=\"headerlink\" title=\"五、关于 Casper 的思考\"></a>五、关于 Casper 的思考</h2><p>Casper 在挖矿的过程中，对其状态做一个 check point（检查点），这是否安全；或者说通过验证者投票达成的 finality 是否可能被推翻？</p>\n<p>假设某个有恶意的组织想发动攻击，如果组织仅仅是矿工，那么就无法推翻已经达成的 finality，因为它是验证者投票的结果；如果组织是验证者，由于需要连续两轮投票都得到 2&#x2F;3 以上的通过才算有效，那么至少有 1&#x2F;3 的验证者两边下注了：正常链得到至少 2&#x2F;3 的票数，非法链也得到至少 2&#x2F;3 的票数，那么至少一共是 2&#x2F;3+2&#x2F;3&#x3D;4&#x2F;3 的票数，即至少 4&#x2F;3-1&#x3D;1&#x2F;3 的验证者都参与了两条链的投票。这 1&#x2F;3 的验证者被发现后，会被没收所有的保证金</p>\n<p>EOS 加密货币（俗称柚子），采用的是 DPOS（Delegated Proof of Stake）协议，先用投票的方式选出 21个 超级节点，再由这些超级节点产生区块，现在已经凉了</p>\n<h2 id=\"六、POW-的争论\"><a href=\"#六、POW-的争论\" class=\"headerlink\" title=\"六、POW 的争论\"></a>六、POW 的争论</h2><p>很多人认为 POW 挖矿的好处是，提供了把多余电能转化为钱的一种手段，可以有效地化解过剩产能，带动当地经济的发展。因为电能是很难存储、很难传输的，很多大型数据中心要建在电比较便宜的地方，就是因为传输数据比传输电容易，很多比特币的矿场都是建在电力资源丰富的地方</p>\n","site":{"data":{}},"excerpt":"","more":"<p>POW（Proof of work，工作量证明）受到的普遍批评是浪费电</p>\n<p>以太坊交易的能耗比比特币低，是因为出块时间更短</p>\n<h2 id=\"一、POS-基本思想\"><a href=\"#一、POS-基本思想\" class=\"headerlink\" title=\"一、POS 基本思想\"></a>一、POS 基本思想</h2><p>POS（Proof of Stake，权益证明）的基本思想是：按照每个人投入资金的多少来决定收益的分配，这也叫做 virtual mining（虚拟挖矿）</p>\n<p>采用权益证明的货币，在发行前一般会预留一部分货币给开发者，也会出售一部分货币来换取开发所需的资金。将来按照的权益证明的共识机制，按照每个人持有货币的数量进行投票</p>\n<h2 id=\"二、POS-的好处\"><a href=\"#二、POS-的好处\" class=\"headerlink\" title=\"二、POS 的好处\"></a>二、POS 的好处</h2><p>（1）省去了挖矿的过程，也避免了由此带来的能耗和对环境的影响</p>\n<p>（2）如果有人想发动恶意攻击，需要设法获得该币种一半以上的份额，即发动攻击的资源只能从加密系统内部获得，形成一个闭环。如果有人在初期大量买入，币价大涨，早期投资者可能会跑卖出路（类似于股份制公司遭受恶意收购）</p>\n<p>基于 POW 的共识系统，从某种意义上来说，维护区块链安全的资源不是一个闭环，因为 Block chain is secured by mining. 而 mining 所需的 equipment 是由法币买来的（即加密货币的生态系统之外得到的），这就带来一个问题：虽然加密货币的总市值有了很大的增长，但是和世界经济总量相比仍然是微乎其微的，也就是说发动 51% attack 攻击的资源可以从外界得到、并且是有可能达到的，尤其对于刚发行的小的币种 AltCoin（Alternative coin），这叫做 AltCoin Infanticide（杀婴）</p>\n<p>有些加密货币采用的是一种混合模型，即仍然需要挖矿，但是挖矿难度和占有权益（持有币的数量）相关。这样会导致，系统中持有币数量最多的人，每次挖矿都最容易，所以有些加密货币要求，投入的币会被锁定一段时间，不能重复使用（比如：挖矿时投入一些币降低挖矿难度，等区块发布出来后，投入的币就会被锁定一段时间，下次再挖就不能用了，过一定区块才能继续用），这叫做 Proof of Deposit（存款证明）</p>\n<h2 id=\"三、早期-POS-遭遇的问题\"><a href=\"#三、早期-POS-遭遇的问题\" class=\"headerlink\" title=\"三、早期 POS 遭遇的问题\"></a>三、早期 POS 遭遇的问题</h2><p>Nothing at stake（两边下注）：参与者通过持有并锁定一定数量的加密货币、而不需要消耗资源（如算力）来生成区块，因此可以同时支持多个分叉上的区块而没有损失</p>\n<h2 id=\"四、Casper-协议\"><a href=\"#四、Casper-协议\" class=\"headerlink\" title=\"四、Casper 协议\"></a>四、Casper 协议</h2><p>Casper 是以太坊采用的 POS 协议</p>\n<p>Casper the Friendly Finality Gadget（CFG，Casper 友好的最终性工具）：在过渡阶段，需要和工作量证明混合使用，为工作量证明提供 finality，它是一种最终的状态，包含在其中的交易不会被取消</p>\n<p>单纯基于挖矿的交易时可能被回滚的，比如某个交易被写入区块链里，但是有人从前面的区块开始分叉，挖出一条更长的分叉链</p>\n<p>Casper 引入了 validator（验证者）的概念，validator 必须投入一定数量的以太币作为保证金，保证金会被锁定。Validator 的作用是推动系统达成共识，投票决定哪条链是最长合法链，投票权重取决于保证金的数目大小</p>\n<p>具体做法类似于数据库中的 two-phase commit（两阶段提交），第一阶段是 prepare message，第二阶段是 commit message</p>\n<p>每挖出 100个 区块，就作为一个 epoch（纪元），要决定其能否成为 finality 需要进行投票，Casper 规定每一轮投票都要得到 2&#x2F;3 以上验证者（按照保证金金额大小）同意才能通过</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/50/1.png\"\n                      alt=\"图一\"\n                ></p>\n<p>实际系统中不区分 prepare message 和 commit message，而且把 epoch 从原来的 100个 区块，减少到了 50个 区块就作为一个 epoch，每个 epoch 只需要一轮投票，投票结果对于上一个区块是 commit message，对于下一个区块是 prepare message，需要连续两轮投票（2个 epoch）都得到 2&#x2F;3 以上的通过，才算有效</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/50/2.png\"\n                      alt=\"图二\"\n                ></p>\n<p>验证者参与该过程的好处是，如果其履行职责，可以得到相应的奖励；相反，如果验证者有不良行为被发现，会受到相应的处罚，比如：该投票时不投票，导致系统迟迟无法达成共识，这种情况会扣除其一部分保证金；比如乱投票，给两个有冲突的分叉都投票（两边下注），这种情况会没收其所有保证金（所有扣除或没收都是销毁的模式）</p>\n<p>每个验证者有一定的任期，任期满后会有一个等待期，该等待期是为了让其他节点检举或揭发其是否有不良行为。如果等待期过了，验证者就可以取回当初的保证金和应得的奖励</p>\n<h2 id=\"五、关于-Casper-的思考\"><a href=\"#五、关于-Casper-的思考\" class=\"headerlink\" title=\"五、关于 Casper 的思考\"></a>五、关于 Casper 的思考</h2><p>Casper 在挖矿的过程中，对其状态做一个 check point（检查点），这是否安全；或者说通过验证者投票达成的 finality 是否可能被推翻？</p>\n<p>假设某个有恶意的组织想发动攻击，如果组织仅仅是矿工，那么就无法推翻已经达成的 finality，因为它是验证者投票的结果；如果组织是验证者，由于需要连续两轮投票都得到 2&#x2F;3 以上的通过才算有效，那么至少有 1&#x2F;3 的验证者两边下注了：正常链得到至少 2&#x2F;3 的票数，非法链也得到至少 2&#x2F;3 的票数，那么至少一共是 2&#x2F;3+2&#x2F;3&#x3D;4&#x2F;3 的票数，即至少 4&#x2F;3-1&#x3D;1&#x2F;3 的验证者都参与了两条链的投票。这 1&#x2F;3 的验证者被发现后，会被没收所有的保证金</p>\n<p>EOS 加密货币（俗称柚子），采用的是 DPOS（Delegated Proof of Stake）协议，先用投票的方式选出 21个 超级节点，再由这些超级节点产生区块，现在已经凉了</p>\n<h2 id=\"六、POW-的争论\"><a href=\"#六、POW-的争论\" class=\"headerlink\" title=\"六、POW 的争论\"></a>六、POW 的争论</h2><p>很多人认为 POW 挖矿的好处是，提供了把多余电能转化为钱的一种手段，可以有效地化解过剩产能，带动当地经济的发展。因为电能是很难存储、很难传输的，很多大型数据中心要建在电比较便宜的地方，就是因为传输数据比传输电容易，很多比特币的矿场都是建在电力资源丰富的地方</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用22-智能合约","date":"2025-01-19T08:11:11.000Z","_content":"\n## 一、智能合约概念\n\nSmart contract（智能合约）是运行在区块链上的一段代码，代码的逻辑定义了合约的内容\n\n智能合约的账户保存了合约当前的运行状态\n- balance 当前余额\n- nonce 交易次数\n- code 合约代码\n- storage 存储，数据结构是一颗 MPT\n\nSodility 是智能合约最常用的语言，语法上与 JavaScript 很接近\n\n## 二、Sodility 数据结构\n\n![图一](../images/51/1.png)\n\n其中，bid() 后面的 payable 说明该合约账户能接受外部转账。该函数是用来进行竞拍出价的，在出价时需要把以太币发送并存储到合约里，锁定到拍卖结束，因此该函数需要有能接受外部转账的能力\n\nwithdraw() 函数是在拍卖结束后，未中标的账户可调用该函数，把出价时锁定在智能合约中的以太币取回来\n\n## 三、智能合约调用\n\n### 1、一个账户调用一个智能合约\n\n外部账户调用智能合约，和转账类似：假设 A 发起一个交易转账给 B，如果 B 是普通用户，则为普通交易；如果 B 是合约账户，那么该调用实际是对 B 合约的调用，具体调用函数是在 data 域中进行说明\n\n### 2、一个合约调用另一个合约\n\n以太坊中规定，一个交易只有外部账户才能发起，一个合约账户不能主动发起交易。所以在实际中，有两种调用方式\n\n#### （1）直接调用\n\n通过一个普通账户调用合约 B 中的函数，然后这个函数再调用合约 A 中的函数\n\n![图二](../images/51/2.png)\n\n#### （2）使用 address 类型的 call() 函数\n\n这种调用和上述不同的是：对于错误处理的不同。在直接调用中，如果被调用的合约执行发生错误，会导致发起调用的合约也跟着一起回滚；而 addr.call() 的方法，如果被调用的合约发生异常，addr.call() 会返回 flase，但发起调用的合约不会抛出异常，而是会继续执行\n\n![图三](../images/51/3.png)\n\n#### （3）代理使用 delegatecall()\n\n和 call() 很像，区别是 delegatecall() 不需要切换到被调用的合约的环境中去执行，而是在当前合约的环境中执行\n\n![图四](../images/51/4.png)\n\n### 3、fallback() 函数\n\n![图五](../images/51/5.png)\n\nA 调用 B 的合约，要在转账交易里的 data 域说明调用的是 B 中的哪个函数。如果 A 给合约 B 转了一笔钱，没有说明掉的是哪个函数（或者调的函数在 data 域中不存在），此时缺省就调用 fallback() 函数\n\n在交易中，转账金额可以为 0，但是汽油费不能为 0，因为没有汽油费，发布该区块的矿工就不会将该笔交易打包进去\n\n## 四、智能合约的创建和运行\n\n智能合约是由某个外部账户发起一个转账交易，转给 0X0 地址，转账金额为 0，然后把要发布的合约的代码放到 data 域里\n\n![图六](../images/51/6.png)\n\nJVM 的目的是增强可移植性，EVM 也是类似的思想，通过加一层虚拟机，对智能合约的运行提供一个一致性的平台，所以 EVM 有时叫做 world wide computer，EVM 的寻址空间非常大，为 256 位\n\n## 五、汽油费\n\n比特币的设计理念很简单，功能有限（比如不支持循环）；而以太坊需要提供一个 Turing-complete Programming Model（图灵完备的编程模型），包含条件控制、循环和递归、数据存储、基本的算术运算功能，但也可能带来问题，比如出现死循环\n\n一个全节点收到一个对智能合约的调用，不知道该调用执行起来是否会导致死循环，这叫做 Halting Problem（停机问题），这个问题是不可解的，不是 NPC 问题（Non-deterministic Polynomial 的问题，即多项式复杂程度的非确定性问题，NPC 是可解的，只是没有多项式时间的解法）\n\n以太坊引入了汽油费机制，发起一个对智能合约的调用，就要支付相应的汽油费\n\n![图七](../images/51/7.png)\n\n当一个全节点收到一个对智能合约的调用时，先按照调用中给出的 gasLimit，算出可能花掉的最大汽油费，然后一次性把汽油费从发起调用的账户上扣除，然后再根据实际执行的情况，算出实际花了多少汽油费（多退）\n\n不同的指令消耗的汽油费不同，简单的指令（比如加减法），消耗的汽油费是很少的，复杂的指令消耗的汽油费就比较多（比如取哈希）；除了计算量，需要存储状态的指令消耗的汽油费也比较大；只需读取公共指令的命令是免费的\n\n## 六、错误处理\n\n以太坊中的交易执行起来具有原子性，一个交易要么全部执行、要么完全不执行，不会只执行一部分，既包含普通的转账交易，也包含对智能合约的调用。所以如果在执行智能合约的过程中，出现任何错误，会导致整个交易的执行回滚，退回到开始执行前的状态\n\n### 1、出现错误的情况\n\n（1）交易执行结束后，没有达到当初的 gas limit，多余的汽油费会被退回到这个账户里；相反的，如果执行一半，gas limit 已经都用完了，这时合约的执行会退回到开始执行之前的状态，且已经消耗掉的汽油费是不退的\n\n（2）抛出错误的语句 assert（通常判断内部条件），require（通常判断外部条件，比如函数输入是否符合要求），revert（无条件抛出异常，原来是 throw）。sodility 当中没有 try catch 这种结构\n\n### 2、嵌套调用\n\n如果嵌套调用，一个智能合约调用另外一个智能合约，被调用的智能合约出现错误，不一定会导致发起调用的智能合约也跟着一起回滚，即连锁式回滚\n\n这取决于调用智能合约的方式，如果这个智能合约是直接调用，就会触发连锁式回滚；如果用 call() 的方式，就不会连锁回滚，而是返回一个 false\n\n如果只是向一个账户里转账，但该账户为合约账户，该操作就有可能触发对函数的调用，因为如果没有指明哪个函数，仍会调用 fallback() 函数\n\n## 七、Block header\n\ngasUsed 是该区块里所有交易所消耗的汽油费的总和\n\n发布区块需要消耗一定的资源，需要对消耗的资源有一个限制（类似比特币区块大小不能超过一兆），gasLimit 是该区块里所有交易实际能够消耗汽油的上限\n\n比特币区块一兆大小的限制是固定的，但是以太坊的 gasLimit 也有一个上限，但是每个矿工发布区块时，可以对 gasLimit 进行微调，即在上一个区块 gasLimit 的基础上 上调或下调 1/1024\n\n## 八、思考\n\n### 1、先挖矿还是先执行\n\n前置知识：任何对状态的修改，都是在改本地的数据结构，只有当合约执行完了，发布到区块链之后，这些本地的修改才会变成外部可见的、变成区块链上的共识\n\n假设某个全节点要打包一些交易到一个区块里，这些交易里有一些是对智能合约的调用，那么全节点是先把这些智能合约都执行完再去挖矿，还是应该先挖矿、获得记账权之后，再执行合约？\n\n答案是先执行智能合约，因为不先执行，更新三颗树（状态、交易、收据），就无法得到三颗树的根哈希，也就无法通过 block header 去挖矿\n\n### 2、是否会存在故意不验证的全节点\n\n汽油费的设置是对于矿工执行智能合约所消耗资源的一种补偿，但是这种补偿只有最终挖到矿的矿工才能得到\n\n如果某个区块不验证新发布的交易，不去执行新发布的区块，也就没办法更新本地的三棵树，以后就没办法再发布区块\n\n### 3、合约执行错误能否上链\n\n如果智能合约执行的过程中出现了错误，也要发布到区块链上，否则汽油费扣不掉。也就是说发布到区块链上的交易不一定都是成功执行的\n\n### 4、智能合约是否支持多线程\n\n多核处理器很普遍，但是智能合约不支持多核并行处理，sodility 没有支持多线程的语句，原因是：以太坊是一个交易驱动的状态机，状态机必须是完全确认性的，给定同一组输入，产生的输出/转移到的下一个状态必须是完全确定的。因为所有的全节点都得执行同一组操作，达到同一个状态，如果不确定的话，三个树的根哈希值根本对不上。多线程的问题是多个核对内存访问顺序不同的话，执行结果有可能不确定\n\n除了多线程之外，其他可能造成执行结果不确定的操作也都不支持，比如：产生随机数，所以以太坊中的智能合约没办法产生真正意义下的随机数，只能用伪随机数\n\n## 九、收据树\n\n下面是 Receipt 的数据结构：\n\n![图八](../images/51/8.png)\n\n每个交易执行完之后会形成一个收据，status 表示交易的执行情况\n\n## 十、智能合约可以获得的信息\n\n### 1、智能合约可以获得的区块信息\n\n![图九](../images/51/9.png)\n\n### 2、智能合约可以获得的调用信息\n\n![图十](../images/51/10.png)\n\nmsg.data 说明了调用哪个函数，和该函数的参数取值\n\nmsg.gas 是剩余的汽油费，决定了还能做那些操作，想要再调用其他合约，前提是有足够的汽油费剩余\n\nmsg.sig 是 msg.data 的前四个字节，即函数标识符，表示调用的是哪个函数\n\nnow 是当前区块的时间戳，等同于图区块信息中的 block.timestamp\n\n消息发送者 msg.sender 和 交易发起者 tx.origin 是不一样的\n\n![图十一](../images/51/11.png)\n\n比如上述交易，对于 f2，msg.sender 是 C1，但是 tx.origin 是 A\n\n### 3、地址类型\n\n![图十二](../images/51/12.png)\n\naddr.balance 是成员变量，剩余的都是成员函数\n\naddr.transfer(amount) 是当前合约往地址 addr 转入 amount 以太币，转入的地址是 addr，转出的地址是该合约地址\n\naddr.call() 合约账户发起对 addr 这个合约的调用\n\n### 4、三种发送 ETH 的方式\n\n```\naddr.transfer(amount)\naddr.send(amount) return (bool)\naddr.call.value(amount)()\n```\n\n（1）transfer 会导致连锁性的回滚；失败时抛出异常；为要调用的合约提供 2300 汽油费（少量）\n\n（2）send 在失败时会返回一个 false；不会导致连锁式回滚；为要调用的合约提供 2300 汽油费（少量）\n\n（3）call 在失败时会返回一个 false；不会导致连锁式回滚；会将当前调用剩下的所有汽油都发送给要调用的合约，合约后续会执行什么操作当前账户无法控制\n\n## 十一、智能合约拍卖实例\n\n这部分结合智能合约拍卖实例，讲述可能存在的安全漏洞（比如重组攻击），代码截图较多，视频链接如下（1小时31分25秒）：\n\nhttps://www.bilibili.com/video/BV1Vt411X7JF/?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=22\n","source":"_posts/51-北大区块链-智能合约.md","raw":"---\ntitle: 北大-区块链技术与应用22-智能合约\ndate: 2025-01-19 16:11:11\ntags:\n    - web3\n    - ETH\n    - 智能合约\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n## 一、智能合约概念\n\nSmart contract（智能合约）是运行在区块链上的一段代码，代码的逻辑定义了合约的内容\n\n智能合约的账户保存了合约当前的运行状态\n- balance 当前余额\n- nonce 交易次数\n- code 合约代码\n- storage 存储，数据结构是一颗 MPT\n\nSodility 是智能合约最常用的语言，语法上与 JavaScript 很接近\n\n## 二、Sodility 数据结构\n\n![图一](../images/51/1.png)\n\n其中，bid() 后面的 payable 说明该合约账户能接受外部转账。该函数是用来进行竞拍出价的，在出价时需要把以太币发送并存储到合约里，锁定到拍卖结束，因此该函数需要有能接受外部转账的能力\n\nwithdraw() 函数是在拍卖结束后，未中标的账户可调用该函数，把出价时锁定在智能合约中的以太币取回来\n\n## 三、智能合约调用\n\n### 1、一个账户调用一个智能合约\n\n外部账户调用智能合约，和转账类似：假设 A 发起一个交易转账给 B，如果 B 是普通用户，则为普通交易；如果 B 是合约账户，那么该调用实际是对 B 合约的调用，具体调用函数是在 data 域中进行说明\n\n### 2、一个合约调用另一个合约\n\n以太坊中规定，一个交易只有外部账户才能发起，一个合约账户不能主动发起交易。所以在实际中，有两种调用方式\n\n#### （1）直接调用\n\n通过一个普通账户调用合约 B 中的函数，然后这个函数再调用合约 A 中的函数\n\n![图二](../images/51/2.png)\n\n#### （2）使用 address 类型的 call() 函数\n\n这种调用和上述不同的是：对于错误处理的不同。在直接调用中，如果被调用的合约执行发生错误，会导致发起调用的合约也跟着一起回滚；而 addr.call() 的方法，如果被调用的合约发生异常，addr.call() 会返回 flase，但发起调用的合约不会抛出异常，而是会继续执行\n\n![图三](../images/51/3.png)\n\n#### （3）代理使用 delegatecall()\n\n和 call() 很像，区别是 delegatecall() 不需要切换到被调用的合约的环境中去执行，而是在当前合约的环境中执行\n\n![图四](../images/51/4.png)\n\n### 3、fallback() 函数\n\n![图五](../images/51/5.png)\n\nA 调用 B 的合约，要在转账交易里的 data 域说明调用的是 B 中的哪个函数。如果 A 给合约 B 转了一笔钱，没有说明掉的是哪个函数（或者调的函数在 data 域中不存在），此时缺省就调用 fallback() 函数\n\n在交易中，转账金额可以为 0，但是汽油费不能为 0，因为没有汽油费，发布该区块的矿工就不会将该笔交易打包进去\n\n## 四、智能合约的创建和运行\n\n智能合约是由某个外部账户发起一个转账交易，转给 0X0 地址，转账金额为 0，然后把要发布的合约的代码放到 data 域里\n\n![图六](../images/51/6.png)\n\nJVM 的目的是增强可移植性，EVM 也是类似的思想，通过加一层虚拟机，对智能合约的运行提供一个一致性的平台，所以 EVM 有时叫做 world wide computer，EVM 的寻址空间非常大，为 256 位\n\n## 五、汽油费\n\n比特币的设计理念很简单，功能有限（比如不支持循环）；而以太坊需要提供一个 Turing-complete Programming Model（图灵完备的编程模型），包含条件控制、循环和递归、数据存储、基本的算术运算功能，但也可能带来问题，比如出现死循环\n\n一个全节点收到一个对智能合约的调用，不知道该调用执行起来是否会导致死循环，这叫做 Halting Problem（停机问题），这个问题是不可解的，不是 NPC 问题（Non-deterministic Polynomial 的问题，即多项式复杂程度的非确定性问题，NPC 是可解的，只是没有多项式时间的解法）\n\n以太坊引入了汽油费机制，发起一个对智能合约的调用，就要支付相应的汽油费\n\n![图七](../images/51/7.png)\n\n当一个全节点收到一个对智能合约的调用时，先按照调用中给出的 gasLimit，算出可能花掉的最大汽油费，然后一次性把汽油费从发起调用的账户上扣除，然后再根据实际执行的情况，算出实际花了多少汽油费（多退）\n\n不同的指令消耗的汽油费不同，简单的指令（比如加减法），消耗的汽油费是很少的，复杂的指令消耗的汽油费就比较多（比如取哈希）；除了计算量，需要存储状态的指令消耗的汽油费也比较大；只需读取公共指令的命令是免费的\n\n## 六、错误处理\n\n以太坊中的交易执行起来具有原子性，一个交易要么全部执行、要么完全不执行，不会只执行一部分，既包含普通的转账交易，也包含对智能合约的调用。所以如果在执行智能合约的过程中，出现任何错误，会导致整个交易的执行回滚，退回到开始执行前的状态\n\n### 1、出现错误的情况\n\n（1）交易执行结束后，没有达到当初的 gas limit，多余的汽油费会被退回到这个账户里；相反的，如果执行一半，gas limit 已经都用完了，这时合约的执行会退回到开始执行之前的状态，且已经消耗掉的汽油费是不退的\n\n（2）抛出错误的语句 assert（通常判断内部条件），require（通常判断外部条件，比如函数输入是否符合要求），revert（无条件抛出异常，原来是 throw）。sodility 当中没有 try catch 这种结构\n\n### 2、嵌套调用\n\n如果嵌套调用，一个智能合约调用另外一个智能合约，被调用的智能合约出现错误，不一定会导致发起调用的智能合约也跟着一起回滚，即连锁式回滚\n\n这取决于调用智能合约的方式，如果这个智能合约是直接调用，就会触发连锁式回滚；如果用 call() 的方式，就不会连锁回滚，而是返回一个 false\n\n如果只是向一个账户里转账，但该账户为合约账户，该操作就有可能触发对函数的调用，因为如果没有指明哪个函数，仍会调用 fallback() 函数\n\n## 七、Block header\n\ngasUsed 是该区块里所有交易所消耗的汽油费的总和\n\n发布区块需要消耗一定的资源，需要对消耗的资源有一个限制（类似比特币区块大小不能超过一兆），gasLimit 是该区块里所有交易实际能够消耗汽油的上限\n\n比特币区块一兆大小的限制是固定的，但是以太坊的 gasLimit 也有一个上限，但是每个矿工发布区块时，可以对 gasLimit 进行微调，即在上一个区块 gasLimit 的基础上 上调或下调 1/1024\n\n## 八、思考\n\n### 1、先挖矿还是先执行\n\n前置知识：任何对状态的修改，都是在改本地的数据结构，只有当合约执行完了，发布到区块链之后，这些本地的修改才会变成外部可见的、变成区块链上的共识\n\n假设某个全节点要打包一些交易到一个区块里，这些交易里有一些是对智能合约的调用，那么全节点是先把这些智能合约都执行完再去挖矿，还是应该先挖矿、获得记账权之后，再执行合约？\n\n答案是先执行智能合约，因为不先执行，更新三颗树（状态、交易、收据），就无法得到三颗树的根哈希，也就无法通过 block header 去挖矿\n\n### 2、是否会存在故意不验证的全节点\n\n汽油费的设置是对于矿工执行智能合约所消耗资源的一种补偿，但是这种补偿只有最终挖到矿的矿工才能得到\n\n如果某个区块不验证新发布的交易，不去执行新发布的区块，也就没办法更新本地的三棵树，以后就没办法再发布区块\n\n### 3、合约执行错误能否上链\n\n如果智能合约执行的过程中出现了错误，也要发布到区块链上，否则汽油费扣不掉。也就是说发布到区块链上的交易不一定都是成功执行的\n\n### 4、智能合约是否支持多线程\n\n多核处理器很普遍，但是智能合约不支持多核并行处理，sodility 没有支持多线程的语句，原因是：以太坊是一个交易驱动的状态机，状态机必须是完全确认性的，给定同一组输入，产生的输出/转移到的下一个状态必须是完全确定的。因为所有的全节点都得执行同一组操作，达到同一个状态，如果不确定的话，三个树的根哈希值根本对不上。多线程的问题是多个核对内存访问顺序不同的话，执行结果有可能不确定\n\n除了多线程之外，其他可能造成执行结果不确定的操作也都不支持，比如：产生随机数，所以以太坊中的智能合约没办法产生真正意义下的随机数，只能用伪随机数\n\n## 九、收据树\n\n下面是 Receipt 的数据结构：\n\n![图八](../images/51/8.png)\n\n每个交易执行完之后会形成一个收据，status 表示交易的执行情况\n\n## 十、智能合约可以获得的信息\n\n### 1、智能合约可以获得的区块信息\n\n![图九](../images/51/9.png)\n\n### 2、智能合约可以获得的调用信息\n\n![图十](../images/51/10.png)\n\nmsg.data 说明了调用哪个函数，和该函数的参数取值\n\nmsg.gas 是剩余的汽油费，决定了还能做那些操作，想要再调用其他合约，前提是有足够的汽油费剩余\n\nmsg.sig 是 msg.data 的前四个字节，即函数标识符，表示调用的是哪个函数\n\nnow 是当前区块的时间戳，等同于图区块信息中的 block.timestamp\n\n消息发送者 msg.sender 和 交易发起者 tx.origin 是不一样的\n\n![图十一](../images/51/11.png)\n\n比如上述交易，对于 f2，msg.sender 是 C1，但是 tx.origin 是 A\n\n### 3、地址类型\n\n![图十二](../images/51/12.png)\n\naddr.balance 是成员变量，剩余的都是成员函数\n\naddr.transfer(amount) 是当前合约往地址 addr 转入 amount 以太币，转入的地址是 addr，转出的地址是该合约地址\n\naddr.call() 合约账户发起对 addr 这个合约的调用\n\n### 4、三种发送 ETH 的方式\n\n```\naddr.transfer(amount)\naddr.send(amount) return (bool)\naddr.call.value(amount)()\n```\n\n（1）transfer 会导致连锁性的回滚；失败时抛出异常；为要调用的合约提供 2300 汽油费（少量）\n\n（2）send 在失败时会返回一个 false；不会导致连锁式回滚；为要调用的合约提供 2300 汽油费（少量）\n\n（3）call 在失败时会返回一个 false；不会导致连锁式回滚；会将当前调用剩下的所有汽油都发送给要调用的合约，合约后续会执行什么操作当前账户无法控制\n\n## 十一、智能合约拍卖实例\n\n这部分结合智能合约拍卖实例，讲述可能存在的安全漏洞（比如重组攻击），代码截图较多，视频链接如下（1小时31分25秒）：\n\nhttps://www.bilibili.com/video/BV1Vt411X7JF/?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=22\n","slug":"51-北大区块链-智能合约","published":1,"updated":"2025-05-20T02:47:28.686Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvue004e6kprd5qfdmx0","content":"<h2 id=\"一、智能合约概念\"><a href=\"#一、智能合约概念\" class=\"headerlink\" title=\"一、智能合约概念\"></a>一、智能合约概念</h2><p>Smart contract（智能合约）是运行在区块链上的一段代码，代码的逻辑定义了合约的内容</p>\n<p>智能合约的账户保存了合约当前的运行状态</p>\n<ul>\n<li>balance 当前余额</li>\n<li>nonce 交易次数</li>\n<li>code 合约代码</li>\n<li>storage 存储，数据结构是一颗 MPT</li>\n</ul>\n<p>Sodility 是智能合约最常用的语言，语法上与 JavaScript 很接近</p>\n<h2 id=\"二、Sodility-数据结构\"><a href=\"#二、Sodility-数据结构\" class=\"headerlink\" title=\"二、Sodility 数据结构\"></a>二、Sodility 数据结构</h2><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/1.png\"\n                      alt=\"图一\"\n                ></p>\n<p>其中，bid() 后面的 payable 说明该合约账户能接受外部转账。该函数是用来进行竞拍出价的，在出价时需要把以太币发送并存储到合约里，锁定到拍卖结束，因此该函数需要有能接受外部转账的能力</p>\n<p>withdraw() 函数是在拍卖结束后，未中标的账户可调用该函数，把出价时锁定在智能合约中的以太币取回来</p>\n<h2 id=\"三、智能合约调用\"><a href=\"#三、智能合约调用\" class=\"headerlink\" title=\"三、智能合约调用\"></a>三、智能合约调用</h2><h3 id=\"1、一个账户调用一个智能合约\"><a href=\"#1、一个账户调用一个智能合约\" class=\"headerlink\" title=\"1、一个账户调用一个智能合约\"></a>1、一个账户调用一个智能合约</h3><p>外部账户调用智能合约，和转账类似：假设 A 发起一个交易转账给 B，如果 B 是普通用户，则为普通交易；如果 B 是合约账户，那么该调用实际是对 B 合约的调用，具体调用函数是在 data 域中进行说明</p>\n<h3 id=\"2、一个合约调用另一个合约\"><a href=\"#2、一个合约调用另一个合约\" class=\"headerlink\" title=\"2、一个合约调用另一个合约\"></a>2、一个合约调用另一个合约</h3><p>以太坊中规定，一个交易只有外部账户才能发起，一个合约账户不能主动发起交易。所以在实际中，有两种调用方式</p>\n<h4 id=\"（1）直接调用\"><a href=\"#（1）直接调用\" class=\"headerlink\" title=\"（1）直接调用\"></a>（1）直接调用</h4><p>通过一个普通账户调用合约 B 中的函数，然后这个函数再调用合约 A 中的函数</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/2.png\"\n                      alt=\"图二\"\n                ></p>\n<h4 id=\"（2）使用-address-类型的-call-函数\"><a href=\"#（2）使用-address-类型的-call-函数\" class=\"headerlink\" title=\"（2）使用 address 类型的 call() 函数\"></a>（2）使用 address 类型的 call() 函数</h4><p>这种调用和上述不同的是：对于错误处理的不同。在直接调用中，如果被调用的合约执行发生错误，会导致发起调用的合约也跟着一起回滚；而 addr.call() 的方法，如果被调用的合约发生异常，addr.call() 会返回 flase，但发起调用的合约不会抛出异常，而是会继续执行</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/3.png\"\n                      alt=\"图三\"\n                ></p>\n<h4 id=\"（3）代理使用-delegatecall\"><a href=\"#（3）代理使用-delegatecall\" class=\"headerlink\" title=\"（3）代理使用 delegatecall()\"></a>（3）代理使用 delegatecall()</h4><p>和 call() 很像，区别是 delegatecall() 不需要切换到被调用的合约的环境中去执行，而是在当前合约的环境中执行</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/4.png\"\n                      alt=\"图四\"\n                ></p>\n<h3 id=\"3、fallback-函数\"><a href=\"#3、fallback-函数\" class=\"headerlink\" title=\"3、fallback() 函数\"></a>3、fallback() 函数</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/5.png\"\n                      alt=\"图五\"\n                ></p>\n<p>A 调用 B 的合约，要在转账交易里的 data 域说明调用的是 B 中的哪个函数。如果 A 给合约 B 转了一笔钱，没有说明掉的是哪个函数（或者调的函数在 data 域中不存在），此时缺省就调用 fallback() 函数</p>\n<p>在交易中，转账金额可以为 0，但是汽油费不能为 0，因为没有汽油费，发布该区块的矿工就不会将该笔交易打包进去</p>\n<h2 id=\"四、智能合约的创建和运行\"><a href=\"#四、智能合约的创建和运行\" class=\"headerlink\" title=\"四、智能合约的创建和运行\"></a>四、智能合约的创建和运行</h2><p>智能合约是由某个外部账户发起一个转账交易，转给 0X0 地址，转账金额为 0，然后把要发布的合约的代码放到 data 域里</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/6.png\"\n                      alt=\"图六\"\n                ></p>\n<p>JVM 的目的是增强可移植性，EVM 也是类似的思想，通过加一层虚拟机，对智能合约的运行提供一个一致性的平台，所以 EVM 有时叫做 world wide computer，EVM 的寻址空间非常大，为 256 位</p>\n<h2 id=\"五、汽油费\"><a href=\"#五、汽油费\" class=\"headerlink\" title=\"五、汽油费\"></a>五、汽油费</h2><p>比特币的设计理念很简单，功能有限（比如不支持循环）；而以太坊需要提供一个 Turing-complete Programming Model（图灵完备的编程模型），包含条件控制、循环和递归、数据存储、基本的算术运算功能，但也可能带来问题，比如出现死循环</p>\n<p>一个全节点收到一个对智能合约的调用，不知道该调用执行起来是否会导致死循环，这叫做 Halting Problem（停机问题），这个问题是不可解的，不是 NPC 问题（Non-deterministic Polynomial 的问题，即多项式复杂程度的非确定性问题，NPC 是可解的，只是没有多项式时间的解法）</p>\n<p>以太坊引入了汽油费机制，发起一个对智能合约的调用，就要支付相应的汽油费</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/7.png\"\n                      alt=\"图七\"\n                ></p>\n<p>当一个全节点收到一个对智能合约的调用时，先按照调用中给出的 gasLimit，算出可能花掉的最大汽油费，然后一次性把汽油费从发起调用的账户上扣除，然后再根据实际执行的情况，算出实际花了多少汽油费（多退）</p>\n<p>不同的指令消耗的汽油费不同，简单的指令（比如加减法），消耗的汽油费是很少的，复杂的指令消耗的汽油费就比较多（比如取哈希）；除了计算量，需要存储状态的指令消耗的汽油费也比较大；只需读取公共指令的命令是免费的</p>\n<h2 id=\"六、错误处理\"><a href=\"#六、错误处理\" class=\"headerlink\" title=\"六、错误处理\"></a>六、错误处理</h2><p>以太坊中的交易执行起来具有原子性，一个交易要么全部执行、要么完全不执行，不会只执行一部分，既包含普通的转账交易，也包含对智能合约的调用。所以如果在执行智能合约的过程中，出现任何错误，会导致整个交易的执行回滚，退回到开始执行前的状态</p>\n<h3 id=\"1、出现错误的情况\"><a href=\"#1、出现错误的情况\" class=\"headerlink\" title=\"1、出现错误的情况\"></a>1、出现错误的情况</h3><p>（1）交易执行结束后，没有达到当初的 gas limit，多余的汽油费会被退回到这个账户里；相反的，如果执行一半，gas limit 已经都用完了，这时合约的执行会退回到开始执行之前的状态，且已经消耗掉的汽油费是不退的</p>\n<p>（2）抛出错误的语句 assert（通常判断内部条件），require（通常判断外部条件，比如函数输入是否符合要求），revert（无条件抛出异常，原来是 throw）。sodility 当中没有 try catch 这种结构</p>\n<h3 id=\"2、嵌套调用\"><a href=\"#2、嵌套调用\" class=\"headerlink\" title=\"2、嵌套调用\"></a>2、嵌套调用</h3><p>如果嵌套调用，一个智能合约调用另外一个智能合约，被调用的智能合约出现错误，不一定会导致发起调用的智能合约也跟着一起回滚，即连锁式回滚</p>\n<p>这取决于调用智能合约的方式，如果这个智能合约是直接调用，就会触发连锁式回滚；如果用 call() 的方式，就不会连锁回滚，而是返回一个 false</p>\n<p>如果只是向一个账户里转账，但该账户为合约账户，该操作就有可能触发对函数的调用，因为如果没有指明哪个函数，仍会调用 fallback() 函数</p>\n<h2 id=\"七、Block-header\"><a href=\"#七、Block-header\" class=\"headerlink\" title=\"七、Block header\"></a>七、Block header</h2><p>gasUsed 是该区块里所有交易所消耗的汽油费的总和</p>\n<p>发布区块需要消耗一定的资源，需要对消耗的资源有一个限制（类似比特币区块大小不能超过一兆），gasLimit 是该区块里所有交易实际能够消耗汽油的上限</p>\n<p>比特币区块一兆大小的限制是固定的，但是以太坊的 gasLimit 也有一个上限，但是每个矿工发布区块时，可以对 gasLimit 进行微调，即在上一个区块 gasLimit 的基础上 上调或下调 1&#x2F;1024</p>\n<h2 id=\"八、思考\"><a href=\"#八、思考\" class=\"headerlink\" title=\"八、思考\"></a>八、思考</h2><h3 id=\"1、先挖矿还是先执行\"><a href=\"#1、先挖矿还是先执行\" class=\"headerlink\" title=\"1、先挖矿还是先执行\"></a>1、先挖矿还是先执行</h3><p>前置知识：任何对状态的修改，都是在改本地的数据结构，只有当合约执行完了，发布到区块链之后，这些本地的修改才会变成外部可见的、变成区块链上的共识</p>\n<p>假设某个全节点要打包一些交易到一个区块里，这些交易里有一些是对智能合约的调用，那么全节点是先把这些智能合约都执行完再去挖矿，还是应该先挖矿、获得记账权之后，再执行合约？</p>\n<p>答案是先执行智能合约，因为不先执行，更新三颗树（状态、交易、收据），就无法得到三颗树的根哈希，也就无法通过 block header 去挖矿</p>\n<h3 id=\"2、是否会存在故意不验证的全节点\"><a href=\"#2、是否会存在故意不验证的全节点\" class=\"headerlink\" title=\"2、是否会存在故意不验证的全节点\"></a>2、是否会存在故意不验证的全节点</h3><p>汽油费的设置是对于矿工执行智能合约所消耗资源的一种补偿，但是这种补偿只有最终挖到矿的矿工才能得到</p>\n<p>如果某个区块不验证新发布的交易，不去执行新发布的区块，也就没办法更新本地的三棵树，以后就没办法再发布区块</p>\n<h3 id=\"3、合约执行错误能否上链\"><a href=\"#3、合约执行错误能否上链\" class=\"headerlink\" title=\"3、合约执行错误能否上链\"></a>3、合约执行错误能否上链</h3><p>如果智能合约执行的过程中出现了错误，也要发布到区块链上，否则汽油费扣不掉。也就是说发布到区块链上的交易不一定都是成功执行的</p>\n<h3 id=\"4、智能合约是否支持多线程\"><a href=\"#4、智能合约是否支持多线程\" class=\"headerlink\" title=\"4、智能合约是否支持多线程\"></a>4、智能合约是否支持多线程</h3><p>多核处理器很普遍，但是智能合约不支持多核并行处理，sodility 没有支持多线程的语句，原因是：以太坊是一个交易驱动的状态机，状态机必须是完全确认性的，给定同一组输入，产生的输出&#x2F;转移到的下一个状态必须是完全确定的。因为所有的全节点都得执行同一组操作，达到同一个状态，如果不确定的话，三个树的根哈希值根本对不上。多线程的问题是多个核对内存访问顺序不同的话，执行结果有可能不确定</p>\n<p>除了多线程之外，其他可能造成执行结果不确定的操作也都不支持，比如：产生随机数，所以以太坊中的智能合约没办法产生真正意义下的随机数，只能用伪随机数</p>\n<h2 id=\"九、收据树\"><a href=\"#九、收据树\" class=\"headerlink\" title=\"九、收据树\"></a>九、收据树</h2><p>下面是 Receipt 的数据结构：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/8.png\"\n                      alt=\"图八\"\n                ></p>\n<p>每个交易执行完之后会形成一个收据，status 表示交易的执行情况</p>\n<h2 id=\"十、智能合约可以获得的信息\"><a href=\"#十、智能合约可以获得的信息\" class=\"headerlink\" title=\"十、智能合约可以获得的信息\"></a>十、智能合约可以获得的信息</h2><h3 id=\"1、智能合约可以获得的区块信息\"><a href=\"#1、智能合约可以获得的区块信息\" class=\"headerlink\" title=\"1、智能合约可以获得的区块信息\"></a>1、智能合约可以获得的区块信息</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/9.png\"\n                      alt=\"图九\"\n                ></p>\n<h3 id=\"2、智能合约可以获得的调用信息\"><a href=\"#2、智能合约可以获得的调用信息\" class=\"headerlink\" title=\"2、智能合约可以获得的调用信息\"></a>2、智能合约可以获得的调用信息</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/10.png\"\n                      alt=\"图十\"\n                ></p>\n<p>msg.data 说明了调用哪个函数，和该函数的参数取值</p>\n<p>msg.gas 是剩余的汽油费，决定了还能做那些操作，想要再调用其他合约，前提是有足够的汽油费剩余</p>\n<p>msg.sig 是 msg.data 的前四个字节，即函数标识符，表示调用的是哪个函数</p>\n<p>now 是当前区块的时间戳，等同于图区块信息中的 block.timestamp</p>\n<p>消息发送者 msg.sender 和 交易发起者 tx.origin 是不一样的</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/11.png\"\n                      alt=\"图十一\"\n                ></p>\n<p>比如上述交易，对于 f2，msg.sender 是 C1，但是 tx.origin 是 A</p>\n<h3 id=\"3、地址类型\"><a href=\"#3、地址类型\" class=\"headerlink\" title=\"3、地址类型\"></a>3、地址类型</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/12.png\"\n                      alt=\"图十二\"\n                ></p>\n<p>addr.balance 是成员变量，剩余的都是成员函数</p>\n<p>addr.transfer(amount) 是当前合约往地址 addr 转入 amount 以太币，转入的地址是 addr，转出的地址是该合约地址</p>\n<p>addr.call() 合约账户发起对 addr 这个合约的调用</p>\n<h3 id=\"4、三种发送-ETH-的方式\"><a href=\"#4、三种发送-ETH-的方式\" class=\"headerlink\" title=\"4、三种发送 ETH 的方式\"></a>4、三种发送 ETH 的方式</h3><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">addr.transfer(amount)</span><br><span class=\"line\">addr.send(amount) return (bool)</span><br><span class=\"line\">addr.call.value(amount)()</span><br></pre></td></tr></table></figure></div>\n\n<p>（1）transfer 会导致连锁性的回滚；失败时抛出异常；为要调用的合约提供 2300 汽油费（少量）</p>\n<p>（2）send 在失败时会返回一个 false；不会导致连锁式回滚；为要调用的合约提供 2300 汽油费（少量）</p>\n<p>（3）call 在失败时会返回一个 false；不会导致连锁式回滚；会将当前调用剩下的所有汽油都发送给要调用的合约，合约后续会执行什么操作当前账户无法控制</p>\n<h2 id=\"十一、智能合约拍卖实例\"><a href=\"#十一、智能合约拍卖实例\" class=\"headerlink\" title=\"十一、智能合约拍卖实例\"></a>十一、智能合约拍卖实例</h2><p>这部分结合智能合约拍卖实例，讲述可能存在的安全漏洞（比如重组攻击），代码截图较多，视频链接如下（1小时31分25秒）：</p>\n<p><a class=\"link\"   href=\"https://www.bilibili.com/video/BV1Vt411X7JF/?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=22\" >https://www.bilibili.com/video/BV1Vt411X7JF/?spm_id_from=333.788.player.switch&amp;vd_source=69ac93649ea21c4726fe85f272b6d968&amp;p=22<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、智能合约概念\"><a href=\"#一、智能合约概念\" class=\"headerlink\" title=\"一、智能合约概念\"></a>一、智能合约概念</h2><p>Smart contract（智能合约）是运行在区块链上的一段代码，代码的逻辑定义了合约的内容</p>\n<p>智能合约的账户保存了合约当前的运行状态</p>\n<ul>\n<li>balance 当前余额</li>\n<li>nonce 交易次数</li>\n<li>code 合约代码</li>\n<li>storage 存储，数据结构是一颗 MPT</li>\n</ul>\n<p>Sodility 是智能合约最常用的语言，语法上与 JavaScript 很接近</p>\n<h2 id=\"二、Sodility-数据结构\"><a href=\"#二、Sodility-数据结构\" class=\"headerlink\" title=\"二、Sodility 数据结构\"></a>二、Sodility 数据结构</h2><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/1.png\"\n                      alt=\"图一\"\n                ></p>\n<p>其中，bid() 后面的 payable 说明该合约账户能接受外部转账。该函数是用来进行竞拍出价的，在出价时需要把以太币发送并存储到合约里，锁定到拍卖结束，因此该函数需要有能接受外部转账的能力</p>\n<p>withdraw() 函数是在拍卖结束后，未中标的账户可调用该函数，把出价时锁定在智能合约中的以太币取回来</p>\n<h2 id=\"三、智能合约调用\"><a href=\"#三、智能合约调用\" class=\"headerlink\" title=\"三、智能合约调用\"></a>三、智能合约调用</h2><h3 id=\"1、一个账户调用一个智能合约\"><a href=\"#1、一个账户调用一个智能合约\" class=\"headerlink\" title=\"1、一个账户调用一个智能合约\"></a>1、一个账户调用一个智能合约</h3><p>外部账户调用智能合约，和转账类似：假设 A 发起一个交易转账给 B，如果 B 是普通用户，则为普通交易；如果 B 是合约账户，那么该调用实际是对 B 合约的调用，具体调用函数是在 data 域中进行说明</p>\n<h3 id=\"2、一个合约调用另一个合约\"><a href=\"#2、一个合约调用另一个合约\" class=\"headerlink\" title=\"2、一个合约调用另一个合约\"></a>2、一个合约调用另一个合约</h3><p>以太坊中规定，一个交易只有外部账户才能发起，一个合约账户不能主动发起交易。所以在实际中，有两种调用方式</p>\n<h4 id=\"（1）直接调用\"><a href=\"#（1）直接调用\" class=\"headerlink\" title=\"（1）直接调用\"></a>（1）直接调用</h4><p>通过一个普通账户调用合约 B 中的函数，然后这个函数再调用合约 A 中的函数</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/2.png\"\n                      alt=\"图二\"\n                ></p>\n<h4 id=\"（2）使用-address-类型的-call-函数\"><a href=\"#（2）使用-address-类型的-call-函数\" class=\"headerlink\" title=\"（2）使用 address 类型的 call() 函数\"></a>（2）使用 address 类型的 call() 函数</h4><p>这种调用和上述不同的是：对于错误处理的不同。在直接调用中，如果被调用的合约执行发生错误，会导致发起调用的合约也跟着一起回滚；而 addr.call() 的方法，如果被调用的合约发生异常，addr.call() 会返回 flase，但发起调用的合约不会抛出异常，而是会继续执行</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/3.png\"\n                      alt=\"图三\"\n                ></p>\n<h4 id=\"（3）代理使用-delegatecall\"><a href=\"#（3）代理使用-delegatecall\" class=\"headerlink\" title=\"（3）代理使用 delegatecall()\"></a>（3）代理使用 delegatecall()</h4><p>和 call() 很像，区别是 delegatecall() 不需要切换到被调用的合约的环境中去执行，而是在当前合约的环境中执行</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/4.png\"\n                      alt=\"图四\"\n                ></p>\n<h3 id=\"3、fallback-函数\"><a href=\"#3、fallback-函数\" class=\"headerlink\" title=\"3、fallback() 函数\"></a>3、fallback() 函数</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/5.png\"\n                      alt=\"图五\"\n                ></p>\n<p>A 调用 B 的合约，要在转账交易里的 data 域说明调用的是 B 中的哪个函数。如果 A 给合约 B 转了一笔钱，没有说明掉的是哪个函数（或者调的函数在 data 域中不存在），此时缺省就调用 fallback() 函数</p>\n<p>在交易中，转账金额可以为 0，但是汽油费不能为 0，因为没有汽油费，发布该区块的矿工就不会将该笔交易打包进去</p>\n<h2 id=\"四、智能合约的创建和运行\"><a href=\"#四、智能合约的创建和运行\" class=\"headerlink\" title=\"四、智能合约的创建和运行\"></a>四、智能合约的创建和运行</h2><p>智能合约是由某个外部账户发起一个转账交易，转给 0X0 地址，转账金额为 0，然后把要发布的合约的代码放到 data 域里</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/6.png\"\n                      alt=\"图六\"\n                ></p>\n<p>JVM 的目的是增强可移植性，EVM 也是类似的思想，通过加一层虚拟机，对智能合约的运行提供一个一致性的平台，所以 EVM 有时叫做 world wide computer，EVM 的寻址空间非常大，为 256 位</p>\n<h2 id=\"五、汽油费\"><a href=\"#五、汽油费\" class=\"headerlink\" title=\"五、汽油费\"></a>五、汽油费</h2><p>比特币的设计理念很简单，功能有限（比如不支持循环）；而以太坊需要提供一个 Turing-complete Programming Model（图灵完备的编程模型），包含条件控制、循环和递归、数据存储、基本的算术运算功能，但也可能带来问题，比如出现死循环</p>\n<p>一个全节点收到一个对智能合约的调用，不知道该调用执行起来是否会导致死循环，这叫做 Halting Problem（停机问题），这个问题是不可解的，不是 NPC 问题（Non-deterministic Polynomial 的问题，即多项式复杂程度的非确定性问题，NPC 是可解的，只是没有多项式时间的解法）</p>\n<p>以太坊引入了汽油费机制，发起一个对智能合约的调用，就要支付相应的汽油费</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/7.png\"\n                      alt=\"图七\"\n                ></p>\n<p>当一个全节点收到一个对智能合约的调用时，先按照调用中给出的 gasLimit，算出可能花掉的最大汽油费，然后一次性把汽油费从发起调用的账户上扣除，然后再根据实际执行的情况，算出实际花了多少汽油费（多退）</p>\n<p>不同的指令消耗的汽油费不同，简单的指令（比如加减法），消耗的汽油费是很少的，复杂的指令消耗的汽油费就比较多（比如取哈希）；除了计算量，需要存储状态的指令消耗的汽油费也比较大；只需读取公共指令的命令是免费的</p>\n<h2 id=\"六、错误处理\"><a href=\"#六、错误处理\" class=\"headerlink\" title=\"六、错误处理\"></a>六、错误处理</h2><p>以太坊中的交易执行起来具有原子性，一个交易要么全部执行、要么完全不执行，不会只执行一部分，既包含普通的转账交易，也包含对智能合约的调用。所以如果在执行智能合约的过程中，出现任何错误，会导致整个交易的执行回滚，退回到开始执行前的状态</p>\n<h3 id=\"1、出现错误的情况\"><a href=\"#1、出现错误的情况\" class=\"headerlink\" title=\"1、出现错误的情况\"></a>1、出现错误的情况</h3><p>（1）交易执行结束后，没有达到当初的 gas limit，多余的汽油费会被退回到这个账户里；相反的，如果执行一半，gas limit 已经都用完了，这时合约的执行会退回到开始执行之前的状态，且已经消耗掉的汽油费是不退的</p>\n<p>（2）抛出错误的语句 assert（通常判断内部条件），require（通常判断外部条件，比如函数输入是否符合要求），revert（无条件抛出异常，原来是 throw）。sodility 当中没有 try catch 这种结构</p>\n<h3 id=\"2、嵌套调用\"><a href=\"#2、嵌套调用\" class=\"headerlink\" title=\"2、嵌套调用\"></a>2、嵌套调用</h3><p>如果嵌套调用，一个智能合约调用另外一个智能合约，被调用的智能合约出现错误，不一定会导致发起调用的智能合约也跟着一起回滚，即连锁式回滚</p>\n<p>这取决于调用智能合约的方式，如果这个智能合约是直接调用，就会触发连锁式回滚；如果用 call() 的方式，就不会连锁回滚，而是返回一个 false</p>\n<p>如果只是向一个账户里转账，但该账户为合约账户，该操作就有可能触发对函数的调用，因为如果没有指明哪个函数，仍会调用 fallback() 函数</p>\n<h2 id=\"七、Block-header\"><a href=\"#七、Block-header\" class=\"headerlink\" title=\"七、Block header\"></a>七、Block header</h2><p>gasUsed 是该区块里所有交易所消耗的汽油费的总和</p>\n<p>发布区块需要消耗一定的资源，需要对消耗的资源有一个限制（类似比特币区块大小不能超过一兆），gasLimit 是该区块里所有交易实际能够消耗汽油的上限</p>\n<p>比特币区块一兆大小的限制是固定的，但是以太坊的 gasLimit 也有一个上限，但是每个矿工发布区块时，可以对 gasLimit 进行微调，即在上一个区块 gasLimit 的基础上 上调或下调 1&#x2F;1024</p>\n<h2 id=\"八、思考\"><a href=\"#八、思考\" class=\"headerlink\" title=\"八、思考\"></a>八、思考</h2><h3 id=\"1、先挖矿还是先执行\"><a href=\"#1、先挖矿还是先执行\" class=\"headerlink\" title=\"1、先挖矿还是先执行\"></a>1、先挖矿还是先执行</h3><p>前置知识：任何对状态的修改，都是在改本地的数据结构，只有当合约执行完了，发布到区块链之后，这些本地的修改才会变成外部可见的、变成区块链上的共识</p>\n<p>假设某个全节点要打包一些交易到一个区块里，这些交易里有一些是对智能合约的调用，那么全节点是先把这些智能合约都执行完再去挖矿，还是应该先挖矿、获得记账权之后，再执行合约？</p>\n<p>答案是先执行智能合约，因为不先执行，更新三颗树（状态、交易、收据），就无法得到三颗树的根哈希，也就无法通过 block header 去挖矿</p>\n<h3 id=\"2、是否会存在故意不验证的全节点\"><a href=\"#2、是否会存在故意不验证的全节点\" class=\"headerlink\" title=\"2、是否会存在故意不验证的全节点\"></a>2、是否会存在故意不验证的全节点</h3><p>汽油费的设置是对于矿工执行智能合约所消耗资源的一种补偿，但是这种补偿只有最终挖到矿的矿工才能得到</p>\n<p>如果某个区块不验证新发布的交易，不去执行新发布的区块，也就没办法更新本地的三棵树，以后就没办法再发布区块</p>\n<h3 id=\"3、合约执行错误能否上链\"><a href=\"#3、合约执行错误能否上链\" class=\"headerlink\" title=\"3、合约执行错误能否上链\"></a>3、合约执行错误能否上链</h3><p>如果智能合约执行的过程中出现了错误，也要发布到区块链上，否则汽油费扣不掉。也就是说发布到区块链上的交易不一定都是成功执行的</p>\n<h3 id=\"4、智能合约是否支持多线程\"><a href=\"#4、智能合约是否支持多线程\" class=\"headerlink\" title=\"4、智能合约是否支持多线程\"></a>4、智能合约是否支持多线程</h3><p>多核处理器很普遍，但是智能合约不支持多核并行处理，sodility 没有支持多线程的语句，原因是：以太坊是一个交易驱动的状态机，状态机必须是完全确认性的，给定同一组输入，产生的输出&#x2F;转移到的下一个状态必须是完全确定的。因为所有的全节点都得执行同一组操作，达到同一个状态，如果不确定的话，三个树的根哈希值根本对不上。多线程的问题是多个核对内存访问顺序不同的话，执行结果有可能不确定</p>\n<p>除了多线程之外，其他可能造成执行结果不确定的操作也都不支持，比如：产生随机数，所以以太坊中的智能合约没办法产生真正意义下的随机数，只能用伪随机数</p>\n<h2 id=\"九、收据树\"><a href=\"#九、收据树\" class=\"headerlink\" title=\"九、收据树\"></a>九、收据树</h2><p>下面是 Receipt 的数据结构：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/8.png\"\n                      alt=\"图八\"\n                ></p>\n<p>每个交易执行完之后会形成一个收据，status 表示交易的执行情况</p>\n<h2 id=\"十、智能合约可以获得的信息\"><a href=\"#十、智能合约可以获得的信息\" class=\"headerlink\" title=\"十、智能合约可以获得的信息\"></a>十、智能合约可以获得的信息</h2><h3 id=\"1、智能合约可以获得的区块信息\"><a href=\"#1、智能合约可以获得的区块信息\" class=\"headerlink\" title=\"1、智能合约可以获得的区块信息\"></a>1、智能合约可以获得的区块信息</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/9.png\"\n                      alt=\"图九\"\n                ></p>\n<h3 id=\"2、智能合约可以获得的调用信息\"><a href=\"#2、智能合约可以获得的调用信息\" class=\"headerlink\" title=\"2、智能合约可以获得的调用信息\"></a>2、智能合约可以获得的调用信息</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/10.png\"\n                      alt=\"图十\"\n                ></p>\n<p>msg.data 说明了调用哪个函数，和该函数的参数取值</p>\n<p>msg.gas 是剩余的汽油费，决定了还能做那些操作，想要再调用其他合约，前提是有足够的汽油费剩余</p>\n<p>msg.sig 是 msg.data 的前四个字节，即函数标识符，表示调用的是哪个函数</p>\n<p>now 是当前区块的时间戳，等同于图区块信息中的 block.timestamp</p>\n<p>消息发送者 msg.sender 和 交易发起者 tx.origin 是不一样的</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/11.png\"\n                      alt=\"图十一\"\n                ></p>\n<p>比如上述交易，对于 f2，msg.sender 是 C1，但是 tx.origin 是 A</p>\n<h3 id=\"3、地址类型\"><a href=\"#3、地址类型\" class=\"headerlink\" title=\"3、地址类型\"></a>3、地址类型</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/51/12.png\"\n                      alt=\"图十二\"\n                ></p>\n<p>addr.balance 是成员变量，剩余的都是成员函数</p>\n<p>addr.transfer(amount) 是当前合约往地址 addr 转入 amount 以太币，转入的地址是 addr，转出的地址是该合约地址</p>\n<p>addr.call() 合约账户发起对 addr 这个合约的调用</p>\n<h3 id=\"4、三种发送-ETH-的方式\"><a href=\"#4、三种发送-ETH-的方式\" class=\"headerlink\" title=\"4、三种发送 ETH 的方式\"></a>4、三种发送 ETH 的方式</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">addr.transfer(amount)</span><br><span class=\"line\">addr.send(amount) return (bool)</span><br><span class=\"line\">addr.call.value(amount)()</span><br></pre></td></tr></table></figure>\n\n<p>（1）transfer 会导致连锁性的回滚；失败时抛出异常；为要调用的合约提供 2300 汽油费（少量）</p>\n<p>（2）send 在失败时会返回一个 false；不会导致连锁式回滚；为要调用的合约提供 2300 汽油费（少量）</p>\n<p>（3）call 在失败时会返回一个 false；不会导致连锁式回滚；会将当前调用剩下的所有汽油都发送给要调用的合约，合约后续会执行什么操作当前账户无法控制</p>\n<h2 id=\"十一、智能合约拍卖实例\"><a href=\"#十一、智能合约拍卖实例\" class=\"headerlink\" title=\"十一、智能合约拍卖实例\"></a>十一、智能合约拍卖实例</h2><p>这部分结合智能合约拍卖实例，讲述可能存在的安全漏洞（比如重组攻击），代码截图较多，视频链接如下（1小时31分25秒）：</p>\n<p><a class=\"link\"   href=\"https://www.bilibili.com/video/BV1Vt411X7JF/?spm_id_from=333.788.player.switch&vd_source=69ac93649ea21c4726fe85f272b6d968&p=22\" >https://www.bilibili.com/video/BV1Vt411X7JF/?spm_id_from=333.788.player.switch&amp;vd_source=69ac93649ea21c4726fe85f272b6d968&amp;p=22<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用23-The DAO","date":"2025-01-21T02:06:11.000Z","_content":"\n- DAO（Decentralized Autonomous Organization）\n- DAC（Decentralized Autonomous Corporation）\n\nThe DAO 事件是以太坊历史上一个重要的里程碑，涉及到智能合约的漏洞、重组攻击、以及随后的硬分叉。这一事件导致以太坊网络分裂成了两个不同的区块链：以太坊（ETH）和以太坊经典（ETC）\n\n### 1、背景\n\nThe DAO 是一个基于以太坊的去中心化投资基金，旨在为各种项目提供资金，在 2016年4月 成功筹集了超过 1.5亿美元 的以太币，成为当时最大的众筹项目。然而，其智能合约存在一个安全漏洞，并终导致了黑客的攻击\n\n拆分（splitDAO），用于建立子基金（childDAO），一般用于小众项目，会将这些账户中的代币全部换回以太币、并打入子基金中。极端情况下，单个投资者可以成立一个子基金，用于取回个人的收益（注意：成立的子基金具有 28天 的锁定期）\n\n### 2、漏洞与重组攻击\n\n有问题的代码段如下所示：\n\n![图一](../images/52/1.png)\n\n正确的操作顺序是先把账户清零 `balance[msg.sender]=0`，然后再把钱还给调用该函数的人 `withdrawRewardFor(msg.sender)`，并对 The DAO 中的总金额减少相应的数量 `totalSupply -= balances[msg.sender]`\n\n攻击者利用该漏洞进行了重组攻击，通过递归调用（Reentrancy）的机制，在第一次调用合约未完成之前 再次调用原合约，从而重复提取资金，导致约 5000万美元 被转移到攻击者的合约账户中\n\n### 3、尝试修复：软分叉\n\n在 28天 的锁定期内尝试修复，第一步锁定黑客的账户，第二步清退 The DAO 基金上的钱\n\n以太坊发布了软件升级，新增了一条规则：凡是和 The DAO 基金上的账户相关的，不许做任何交易。大多数矿工都升级了该软件\n\n这属于软分叉，因为新节点不认（包含和 The DAO 基金账户相关的交易）旧节点，而旧节点认可新节点\n\n但是升级后的软件存在另一个 bug：判断和 The DAO 基金上的账户相关的交易都是非法交易，不予执行，此时没有收取汽油费。这导致了 Denial-of-service Attack（DOS 攻击）：造成大量恶意攻击者不断发放非法交易，浪费矿工的资源\n\n### 4、硬分叉的实施\n\n以太坊发布了软件升级，把 The DAO 上的所有基金强行转到另一个新的智能合约上，该智能合约的唯一功能就是退钱（将代币退回为以太币）\n\n这属于硬分叉，因为本来转账需要有合法的签名，但是用该合约规定，挖到第 192万 个区块时，自动执行该转账交易，不需要任何签名。因此旧矿工不会认可该区块，因为没有合法签名属于非法交易\n\n### 5、分裂成 ETH 和 ETC\n\n硬分叉之后的新链仍然称作 ETH，旧链上挖出的币叫做 ETC（Etherum Classic）\n\n后来由于新旧链并行会引发重放攻击，在两条链上分别加上了不同的 Chain ID 用于区分\n","source":"_posts/52-北大区块链-The DAO.md","raw":"---\ntitle: 北大-区块链技术与应用23-The DAO\ndate: 2025-01-21 10:06:11\ntags:\n    - web3\n    - ETH\n    - 智能合约\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n- DAO（Decentralized Autonomous Organization）\n- DAC（Decentralized Autonomous Corporation）\n\nThe DAO 事件是以太坊历史上一个重要的里程碑，涉及到智能合约的漏洞、重组攻击、以及随后的硬分叉。这一事件导致以太坊网络分裂成了两个不同的区块链：以太坊（ETH）和以太坊经典（ETC）\n\n### 1、背景\n\nThe DAO 是一个基于以太坊的去中心化投资基金，旨在为各种项目提供资金，在 2016年4月 成功筹集了超过 1.5亿美元 的以太币，成为当时最大的众筹项目。然而，其智能合约存在一个安全漏洞，并终导致了黑客的攻击\n\n拆分（splitDAO），用于建立子基金（childDAO），一般用于小众项目，会将这些账户中的代币全部换回以太币、并打入子基金中。极端情况下，单个投资者可以成立一个子基金，用于取回个人的收益（注意：成立的子基金具有 28天 的锁定期）\n\n### 2、漏洞与重组攻击\n\n有问题的代码段如下所示：\n\n![图一](../images/52/1.png)\n\n正确的操作顺序是先把账户清零 `balance[msg.sender]=0`，然后再把钱还给调用该函数的人 `withdrawRewardFor(msg.sender)`，并对 The DAO 中的总金额减少相应的数量 `totalSupply -= balances[msg.sender]`\n\n攻击者利用该漏洞进行了重组攻击，通过递归调用（Reentrancy）的机制，在第一次调用合约未完成之前 再次调用原合约，从而重复提取资金，导致约 5000万美元 被转移到攻击者的合约账户中\n\n### 3、尝试修复：软分叉\n\n在 28天 的锁定期内尝试修复，第一步锁定黑客的账户，第二步清退 The DAO 基金上的钱\n\n以太坊发布了软件升级，新增了一条规则：凡是和 The DAO 基金上的账户相关的，不许做任何交易。大多数矿工都升级了该软件\n\n这属于软分叉，因为新节点不认（包含和 The DAO 基金账户相关的交易）旧节点，而旧节点认可新节点\n\n但是升级后的软件存在另一个 bug：判断和 The DAO 基金上的账户相关的交易都是非法交易，不予执行，此时没有收取汽油费。这导致了 Denial-of-service Attack（DOS 攻击）：造成大量恶意攻击者不断发放非法交易，浪费矿工的资源\n\n### 4、硬分叉的实施\n\n以太坊发布了软件升级，把 The DAO 上的所有基金强行转到另一个新的智能合约上，该智能合约的唯一功能就是退钱（将代币退回为以太币）\n\n这属于硬分叉，因为本来转账需要有合法的签名，但是用该合约规定，挖到第 192万 个区块时，自动执行该转账交易，不需要任何签名。因此旧矿工不会认可该区块，因为没有合法签名属于非法交易\n\n### 5、分裂成 ETH 和 ETC\n\n硬分叉之后的新链仍然称作 ETH，旧链上挖出的币叫做 ETC（Etherum Classic）\n\n后来由于新旧链并行会引发重放攻击，在两条链上分别加上了不同的 Chain ID 用于区分\n","slug":"52-北大区块链-The DAO","published":1,"updated":"2025-05-20T02:47:28.686Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvue004i6kprbo76eof2","content":"<ul>\n<li>DAO（Decentralized Autonomous Organization）</li>\n<li>DAC（Decentralized Autonomous Corporation）</li>\n</ul>\n<p>The DAO 事件是以太坊历史上一个重要的里程碑，涉及到智能合约的漏洞、重组攻击、以及随后的硬分叉。这一事件导致以太坊网络分裂成了两个不同的区块链：以太坊（ETH）和以太坊经典（ETC）</p>\n<h3 id=\"1、背景\"><a href=\"#1、背景\" class=\"headerlink\" title=\"1、背景\"></a>1、背景</h3><p>The DAO 是一个基于以太坊的去中心化投资基金，旨在为各种项目提供资金，在 2016年4月 成功筹集了超过 1.5亿美元 的以太币，成为当时最大的众筹项目。然而，其智能合约存在一个安全漏洞，并终导致了黑客的攻击</p>\n<p>拆分（splitDAO），用于建立子基金（childDAO），一般用于小众项目，会将这些账户中的代币全部换回以太币、并打入子基金中。极端情况下，单个投资者可以成立一个子基金，用于取回个人的收益（注意：成立的子基金具有 28天 的锁定期）</p>\n<h3 id=\"2、漏洞与重组攻击\"><a href=\"#2、漏洞与重组攻击\" class=\"headerlink\" title=\"2、漏洞与重组攻击\"></a>2、漏洞与重组攻击</h3><p>有问题的代码段如下所示：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/52/1.png\"\n                      alt=\"图一\"\n                ></p>\n<p>正确的操作顺序是先把账户清零 <code>balance[msg.sender]=0</code>，然后再把钱还给调用该函数的人 <code>withdrawRewardFor(msg.sender)</code>，并对 The DAO 中的总金额减少相应的数量 <code>totalSupply -= balances[msg.sender]</code></p>\n<p>攻击者利用该漏洞进行了重组攻击，通过递归调用（Reentrancy）的机制，在第一次调用合约未完成之前 再次调用原合约，从而重复提取资金，导致约 5000万美元 被转移到攻击者的合约账户中</p>\n<h3 id=\"3、尝试修复：软分叉\"><a href=\"#3、尝试修复：软分叉\" class=\"headerlink\" title=\"3、尝试修复：软分叉\"></a>3、尝试修复：软分叉</h3><p>在 28天 的锁定期内尝试修复，第一步锁定黑客的账户，第二步清退 The DAO 基金上的钱</p>\n<p>以太坊发布了软件升级，新增了一条规则：凡是和 The DAO 基金上的账户相关的，不许做任何交易。大多数矿工都升级了该软件</p>\n<p>这属于软分叉，因为新节点不认（包含和 The DAO 基金账户相关的交易）旧节点，而旧节点认可新节点</p>\n<p>但是升级后的软件存在另一个 bug：判断和 The DAO 基金上的账户相关的交易都是非法交易，不予执行，此时没有收取汽油费。这导致了 Denial-of-service Attack（DOS 攻击）：造成大量恶意攻击者不断发放非法交易，浪费矿工的资源</p>\n<h3 id=\"4、硬分叉的实施\"><a href=\"#4、硬分叉的实施\" class=\"headerlink\" title=\"4、硬分叉的实施\"></a>4、硬分叉的实施</h3><p>以太坊发布了软件升级，把 The DAO 上的所有基金强行转到另一个新的智能合约上，该智能合约的唯一功能就是退钱（将代币退回为以太币）</p>\n<p>这属于硬分叉，因为本来转账需要有合法的签名，但是用该合约规定，挖到第 192万 个区块时，自动执行该转账交易，不需要任何签名。因此旧矿工不会认可该区块，因为没有合法签名属于非法交易</p>\n<h3 id=\"5、分裂成-ETH-和-ETC\"><a href=\"#5、分裂成-ETH-和-ETC\" class=\"headerlink\" title=\"5、分裂成 ETH 和 ETC\"></a>5、分裂成 ETH 和 ETC</h3><p>硬分叉之后的新链仍然称作 ETH，旧链上挖出的币叫做 ETC（Etherum Classic）</p>\n<p>后来由于新旧链并行会引发重放攻击，在两条链上分别加上了不同的 Chain ID 用于区分</p>\n","site":{"data":{}},"excerpt":"","more":"<ul>\n<li>DAO（Decentralized Autonomous Organization）</li>\n<li>DAC（Decentralized Autonomous Corporation）</li>\n</ul>\n<p>The DAO 事件是以太坊历史上一个重要的里程碑，涉及到智能合约的漏洞、重组攻击、以及随后的硬分叉。这一事件导致以太坊网络分裂成了两个不同的区块链：以太坊（ETH）和以太坊经典（ETC）</p>\n<h3 id=\"1、背景\"><a href=\"#1、背景\" class=\"headerlink\" title=\"1、背景\"></a>1、背景</h3><p>The DAO 是一个基于以太坊的去中心化投资基金，旨在为各种项目提供资金，在 2016年4月 成功筹集了超过 1.5亿美元 的以太币，成为当时最大的众筹项目。然而，其智能合约存在一个安全漏洞，并终导致了黑客的攻击</p>\n<p>拆分（splitDAO），用于建立子基金（childDAO），一般用于小众项目，会将这些账户中的代币全部换回以太币、并打入子基金中。极端情况下，单个投资者可以成立一个子基金，用于取回个人的收益（注意：成立的子基金具有 28天 的锁定期）</p>\n<h3 id=\"2、漏洞与重组攻击\"><a href=\"#2、漏洞与重组攻击\" class=\"headerlink\" title=\"2、漏洞与重组攻击\"></a>2、漏洞与重组攻击</h3><p>有问题的代码段如下所示：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/52/1.png\"\n                      alt=\"图一\"\n                ></p>\n<p>正确的操作顺序是先把账户清零 <code>balance[msg.sender]=0</code>，然后再把钱还给调用该函数的人 <code>withdrawRewardFor(msg.sender)</code>，并对 The DAO 中的总金额减少相应的数量 <code>totalSupply -= balances[msg.sender]</code></p>\n<p>攻击者利用该漏洞进行了重组攻击，通过递归调用（Reentrancy）的机制，在第一次调用合约未完成之前 再次调用原合约，从而重复提取资金，导致约 5000万美元 被转移到攻击者的合约账户中</p>\n<h3 id=\"3、尝试修复：软分叉\"><a href=\"#3、尝试修复：软分叉\" class=\"headerlink\" title=\"3、尝试修复：软分叉\"></a>3、尝试修复：软分叉</h3><p>在 28天 的锁定期内尝试修复，第一步锁定黑客的账户，第二步清退 The DAO 基金上的钱</p>\n<p>以太坊发布了软件升级，新增了一条规则：凡是和 The DAO 基金上的账户相关的，不许做任何交易。大多数矿工都升级了该软件</p>\n<p>这属于软分叉，因为新节点不认（包含和 The DAO 基金账户相关的交易）旧节点，而旧节点认可新节点</p>\n<p>但是升级后的软件存在另一个 bug：判断和 The DAO 基金上的账户相关的交易都是非法交易，不予执行，此时没有收取汽油费。这导致了 Denial-of-service Attack（DOS 攻击）：造成大量恶意攻击者不断发放非法交易，浪费矿工的资源</p>\n<h3 id=\"4、硬分叉的实施\"><a href=\"#4、硬分叉的实施\" class=\"headerlink\" title=\"4、硬分叉的实施\"></a>4、硬分叉的实施</h3><p>以太坊发布了软件升级，把 The DAO 上的所有基金强行转到另一个新的智能合约上，该智能合约的唯一功能就是退钱（将代币退回为以太币）</p>\n<p>这属于硬分叉，因为本来转账需要有合法的签名，但是用该合约规定，挖到第 192万 个区块时，自动执行该转账交易，不需要任何签名。因此旧矿工不会认可该区块，因为没有合法签名属于非法交易</p>\n<h3 id=\"5、分裂成-ETH-和-ETC\"><a href=\"#5、分裂成-ETH-和-ETC\" class=\"headerlink\" title=\"5、分裂成 ETH 和 ETC\"></a>5、分裂成 ETH 和 ETC</h3><p>硬分叉之后的新链仍然称作 ETH，旧链上挖出的币叫做 ETC（Etherum Classic）</p>\n<p>后来由于新旧链并行会引发重放攻击，在两条链上分别加上了不同的 Chain ID 用于区分</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用24-反思","date":"2025-01-21T06:46:31.000Z","_content":"\n## 一、智能合约\n\nIs smart contract really smart?\n\nSmart contract is anything but smart.\n\n有人认为应该把智能合约叫做自动合约，ATM 就是一种自动合约，实际上来说，智能合约是一种代码合同\n\n## 二、不可篡改性\n\nIrrevocability is a double edged sword（区块链的不可篡改性是一把双刃剑）\n\n## 三、真的不可篡改不存在\n\nNothing is irrevocable.\n\n## 四、Sodility 语言\n\nIs sodility the right programming language?\n\n有人建议使用函数式编程语言，杜绝 fallback() 函数的问题\n\n## 五、开源\n\nMany eyeball fallacy（错误认识），表示开源代码仍然存在安全漏洞\n\n## 六、去中心化\n\nWhat does decentralization mean?\n\n以太坊的硬分叉能够实现，不是因为团队强迫，而是因为绝大多数矿工升级了软件；并且还有少部分矿工留在旧链，这也是他们的自由\n\n所以去中心化不是全自动化，也不是说制定的规则不能修改，而是说对规则的修改要用去中心化的方法来完成，在区块链的世界里是用挖矿进行投票\n\n## 七、分叉\n\n分叉不一定是坏事，分叉是去中心化和民主的一种体现\n\n## 八、\n\ndecentralized ≠ distributed\n\n一个去中心化的系统一定是分布式的，但是分布式的系统不一定是去中心化的，比如：Google 的 search engine 背后有几十万台服务器。在一个分布式的平台上，可以运行中心化的应用，也可以运行去中心化的应用\n\n比特币和以太坊都是交易驱动的状态机（state machine），其特点是，让系统中几千台机器重复做同一套动作、付出很大的代价，来维持状态的一致性\n\n这并不是分布式系统常用的工作模式，大多数分布式系统是让每台机器做不同的事情，再把各台机器的工作结果汇总、得到最后的结果，目的是使处理速度更快\n\n而 state machine 的目的不是为了处理速度快，而是为了容错。状态机最早的应用场景是 mission critical application（关键任务应用，比如：airtraffic control, stock exchange, space shuttle），代价是效率很低\n\n不要把以太坊上的智能合约、EVM 平台 当作是大规模计算或存储的服务，这么做不仅速度很慢，而且汽油费很贵。智能合约是编写控制逻辑的，只有那些需要在互不信任的实体中间建立共识的操作，才需要写在智能合约里\n","source":"_posts/53-北大区块链-反思.md","raw":"---\ntitle: 北大-区块链技术与应用24-反思\ndate: 2025-01-21 14:46:31\ntags:\n    - web3\n    - ETH\n    - 智能合约\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\n## 一、智能合约\n\nIs smart contract really smart?\n\nSmart contract is anything but smart.\n\n有人认为应该把智能合约叫做自动合约，ATM 就是一种自动合约，实际上来说，智能合约是一种代码合同\n\n## 二、不可篡改性\n\nIrrevocability is a double edged sword（区块链的不可篡改性是一把双刃剑）\n\n## 三、真的不可篡改不存在\n\nNothing is irrevocable.\n\n## 四、Sodility 语言\n\nIs sodility the right programming language?\n\n有人建议使用函数式编程语言，杜绝 fallback() 函数的问题\n\n## 五、开源\n\nMany eyeball fallacy（错误认识），表示开源代码仍然存在安全漏洞\n\n## 六、去中心化\n\nWhat does decentralization mean?\n\n以太坊的硬分叉能够实现，不是因为团队强迫，而是因为绝大多数矿工升级了软件；并且还有少部分矿工留在旧链，这也是他们的自由\n\n所以去中心化不是全自动化，也不是说制定的规则不能修改，而是说对规则的修改要用去中心化的方法来完成，在区块链的世界里是用挖矿进行投票\n\n## 七、分叉\n\n分叉不一定是坏事，分叉是去中心化和民主的一种体现\n\n## 八、\n\ndecentralized ≠ distributed\n\n一个去中心化的系统一定是分布式的，但是分布式的系统不一定是去中心化的，比如：Google 的 search engine 背后有几十万台服务器。在一个分布式的平台上，可以运行中心化的应用，也可以运行去中心化的应用\n\n比特币和以太坊都是交易驱动的状态机（state machine），其特点是，让系统中几千台机器重复做同一套动作、付出很大的代价，来维持状态的一致性\n\n这并不是分布式系统常用的工作模式，大多数分布式系统是让每台机器做不同的事情，再把各台机器的工作结果汇总、得到最后的结果，目的是使处理速度更快\n\n而 state machine 的目的不是为了处理速度快，而是为了容错。状态机最早的应用场景是 mission critical application（关键任务应用，比如：airtraffic control, stock exchange, space shuttle），代价是效率很低\n\n不要把以太坊上的智能合约、EVM 平台 当作是大规模计算或存储的服务，这么做不仅速度很慢，而且汽油费很贵。智能合约是编写控制逻辑的，只有那些需要在互不信任的实体中间建立共识的操作，才需要写在智能合约里\n","slug":"53-北大区块链-反思","published":1,"updated":"2025-05-20T02:47:28.686Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvue004l6kprgafb5f12","content":"<h2 id=\"一、智能合约\"><a href=\"#一、智能合约\" class=\"headerlink\" title=\"一、智能合约\"></a>一、智能合约</h2><p>Is smart contract really smart?</p>\n<p>Smart contract is anything but smart.</p>\n<p>有人认为应该把智能合约叫做自动合约，ATM 就是一种自动合约，实际上来说，智能合约是一种代码合同</p>\n<h2 id=\"二、不可篡改性\"><a href=\"#二、不可篡改性\" class=\"headerlink\" title=\"二、不可篡改性\"></a>二、不可篡改性</h2><p>Irrevocability is a double edged sword（区块链的不可篡改性是一把双刃剑）</p>\n<h2 id=\"三、真的不可篡改不存在\"><a href=\"#三、真的不可篡改不存在\" class=\"headerlink\" title=\"三、真的不可篡改不存在\"></a>三、真的不可篡改不存在</h2><p>Nothing is irrevocable.</p>\n<h2 id=\"四、Sodility-语言\"><a href=\"#四、Sodility-语言\" class=\"headerlink\" title=\"四、Sodility 语言\"></a>四、Sodility 语言</h2><p>Is sodility the right programming language?</p>\n<p>有人建议使用函数式编程语言，杜绝 fallback() 函数的问题</p>\n<h2 id=\"五、开源\"><a href=\"#五、开源\" class=\"headerlink\" title=\"五、开源\"></a>五、开源</h2><p>Many eyeball fallacy（错误认识），表示开源代码仍然存在安全漏洞</p>\n<h2 id=\"六、去中心化\"><a href=\"#六、去中心化\" class=\"headerlink\" title=\"六、去中心化\"></a>六、去中心化</h2><p>What does decentralization mean?</p>\n<p>以太坊的硬分叉能够实现，不是因为团队强迫，而是因为绝大多数矿工升级了软件；并且还有少部分矿工留在旧链，这也是他们的自由</p>\n<p>所以去中心化不是全自动化，也不是说制定的规则不能修改，而是说对规则的修改要用去中心化的方法来完成，在区块链的世界里是用挖矿进行投票</p>\n<h2 id=\"七、分叉\"><a href=\"#七、分叉\" class=\"headerlink\" title=\"七、分叉\"></a>七、分叉</h2><p>分叉不一定是坏事，分叉是去中心化和民主的一种体现</p>\n<h2 id=\"八、\"><a href=\"#八、\" class=\"headerlink\" title=\"八、\"></a>八、</h2><p>decentralized ≠ distributed</p>\n<p>一个去中心化的系统一定是分布式的，但是分布式的系统不一定是去中心化的，比如：Google 的 search engine 背后有几十万台服务器。在一个分布式的平台上，可以运行中心化的应用，也可以运行去中心化的应用</p>\n<p>比特币和以太坊都是交易驱动的状态机（state machine），其特点是，让系统中几千台机器重复做同一套动作、付出很大的代价，来维持状态的一致性</p>\n<p>这并不是分布式系统常用的工作模式，大多数分布式系统是让每台机器做不同的事情，再把各台机器的工作结果汇总、得到最后的结果，目的是使处理速度更快</p>\n<p>而 state machine 的目的不是为了处理速度快，而是为了容错。状态机最早的应用场景是 mission critical application（关键任务应用，比如：airtraffic control, stock exchange, space shuttle），代价是效率很低</p>\n<p>不要把以太坊上的智能合约、EVM 平台 当作是大规模计算或存储的服务，这么做不仅速度很慢，而且汽油费很贵。智能合约是编写控制逻辑的，只有那些需要在互不信任的实体中间建立共识的操作，才需要写在智能合约里</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、智能合约\"><a href=\"#一、智能合约\" class=\"headerlink\" title=\"一、智能合约\"></a>一、智能合约</h2><p>Is smart contract really smart?</p>\n<p>Smart contract is anything but smart.</p>\n<p>有人认为应该把智能合约叫做自动合约，ATM 就是一种自动合约，实际上来说，智能合约是一种代码合同</p>\n<h2 id=\"二、不可篡改性\"><a href=\"#二、不可篡改性\" class=\"headerlink\" title=\"二、不可篡改性\"></a>二、不可篡改性</h2><p>Irrevocability is a double edged sword（区块链的不可篡改性是一把双刃剑）</p>\n<h2 id=\"三、真的不可篡改不存在\"><a href=\"#三、真的不可篡改不存在\" class=\"headerlink\" title=\"三、真的不可篡改不存在\"></a>三、真的不可篡改不存在</h2><p>Nothing is irrevocable.</p>\n<h2 id=\"四、Sodility-语言\"><a href=\"#四、Sodility-语言\" class=\"headerlink\" title=\"四、Sodility 语言\"></a>四、Sodility 语言</h2><p>Is sodility the right programming language?</p>\n<p>有人建议使用函数式编程语言，杜绝 fallback() 函数的问题</p>\n<h2 id=\"五、开源\"><a href=\"#五、开源\" class=\"headerlink\" title=\"五、开源\"></a>五、开源</h2><p>Many eyeball fallacy（错误认识），表示开源代码仍然存在安全漏洞</p>\n<h2 id=\"六、去中心化\"><a href=\"#六、去中心化\" class=\"headerlink\" title=\"六、去中心化\"></a>六、去中心化</h2><p>What does decentralization mean?</p>\n<p>以太坊的硬分叉能够实现，不是因为团队强迫，而是因为绝大多数矿工升级了软件；并且还有少部分矿工留在旧链，这也是他们的自由</p>\n<p>所以去中心化不是全自动化，也不是说制定的规则不能修改，而是说对规则的修改要用去中心化的方法来完成，在区块链的世界里是用挖矿进行投票</p>\n<h2 id=\"七、分叉\"><a href=\"#七、分叉\" class=\"headerlink\" title=\"七、分叉\"></a>七、分叉</h2><p>分叉不一定是坏事，分叉是去中心化和民主的一种体现</p>\n<h2 id=\"八、\"><a href=\"#八、\" class=\"headerlink\" title=\"八、\"></a>八、</h2><p>decentralized ≠ distributed</p>\n<p>一个去中心化的系统一定是分布式的，但是分布式的系统不一定是去中心化的，比如：Google 的 search engine 背后有几十万台服务器。在一个分布式的平台上，可以运行中心化的应用，也可以运行去中心化的应用</p>\n<p>比特币和以太坊都是交易驱动的状态机（state machine），其特点是，让系统中几千台机器重复做同一套动作、付出很大的代价，来维持状态的一致性</p>\n<p>这并不是分布式系统常用的工作模式，大多数分布式系统是让每台机器做不同的事情，再把各台机器的工作结果汇总、得到最后的结果，目的是使处理速度更快</p>\n<p>而 state machine 的目的不是为了处理速度快，而是为了容错。状态机最早的应用场景是 mission critical application（关键任务应用，比如：airtraffic control, stock exchange, space shuttle），代价是效率很低</p>\n<p>不要把以太坊上的智能合约、EVM 平台 当作是大规模计算或存储的服务，这么做不仅速度很慢，而且汽油费很贵。智能合约是编写控制逻辑的，只有那些需要在互不信任的实体中间建立共识的操作，才需要写在智能合约里</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用25-美链","date":"2025-01-21T08:50:10.000Z","_content":"\nBeautyChain（美链）\n\nIPO（Initial Public Offering）\n\nICO（Initial Coin Offering，首次发行的货币），它们没有自己的区块链，而是以智能合约的形式运行在以太坊的 EVM 平台上。以太坊平台的出现，为各种代币的发行提供了很大的方便\n\n发行代币的智能合约对应的是以太坊状态树中的一个节点，该节点有其账户余额，相当于该智能合约一共有多少个以太币；该账户中有多少代币，保存为智能合约账户的存储树上的变量，账户中代币的发行、转让、销毁都是通过调用智能合约中的函数实现的。它不像以太坊那样需要通过挖矿来维护一个底层的基础链，每种代币可以制定自己的发行规则\n\nERC 20（Ethereum Request for Comments，以太坊征求意见）是以太坊上发行代币的一个标准，规范了所有发行代币的合约应该实现的功能和遵循的接口\n\n美链被攻击的示例，告诉我们：在计算时，一定要考虑溢出的问题，sodility 有一个专门的 safeMath 库，计算时会检测是否溢出\n","source":"_posts/54-北大区块链-美链.md","raw":"---\ntitle: 北大-区块链技术与应用25-美链\ndate: 2025-01-21 16:50:10\ntags:\n    - web3\n    - ETH\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\nBeautyChain（美链）\n\nIPO（Initial Public Offering）\n\nICO（Initial Coin Offering，首次发行的货币），它们没有自己的区块链，而是以智能合约的形式运行在以太坊的 EVM 平台上。以太坊平台的出现，为各种代币的发行提供了很大的方便\n\n发行代币的智能合约对应的是以太坊状态树中的一个节点，该节点有其账户余额，相当于该智能合约一共有多少个以太币；该账户中有多少代币，保存为智能合约账户的存储树上的变量，账户中代币的发行、转让、销毁都是通过调用智能合约中的函数实现的。它不像以太坊那样需要通过挖矿来维护一个底层的基础链，每种代币可以制定自己的发行规则\n\nERC 20（Ethereum Request for Comments，以太坊征求意见）是以太坊上发行代币的一个标准，规范了所有发行代币的合约应该实现的功能和遵循的接口\n\n美链被攻击的示例，告诉我们：在计算时，一定要考虑溢出的问题，sodility 有一个专门的 safeMath 库，计算时会检测是否溢出\n","slug":"54-北大区块链-美链","published":1,"updated":"2025-05-20T02:47:28.686Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvue004p6kpr8r2631xj","content":"<p>BeautyChain（美链）</p>\n<p>IPO（Initial Public Offering）</p>\n<p>ICO（Initial Coin Offering，首次发行的货币），它们没有自己的区块链，而是以智能合约的形式运行在以太坊的 EVM 平台上。以太坊平台的出现，为各种代币的发行提供了很大的方便</p>\n<p>发行代币的智能合约对应的是以太坊状态树中的一个节点，该节点有其账户余额，相当于该智能合约一共有多少个以太币；该账户中有多少代币，保存为智能合约账户的存储树上的变量，账户中代币的发行、转让、销毁都是通过调用智能合约中的函数实现的。它不像以太坊那样需要通过挖矿来维护一个底层的基础链，每种代币可以制定自己的发行规则</p>\n<p>ERC 20（Ethereum Request for Comments，以太坊征求意见）是以太坊上发行代币的一个标准，规范了所有发行代币的合约应该实现的功能和遵循的接口</p>\n<p>美链被攻击的示例，告诉我们：在计算时，一定要考虑溢出的问题，sodility 有一个专门的 safeMath 库，计算时会检测是否溢出</p>\n","site":{"data":{}},"excerpt":"","more":"<p>BeautyChain（美链）</p>\n<p>IPO（Initial Public Offering）</p>\n<p>ICO（Initial Coin Offering，首次发行的货币），它们没有自己的区块链，而是以智能合约的形式运行在以太坊的 EVM 平台上。以太坊平台的出现，为各种代币的发行提供了很大的方便</p>\n<p>发行代币的智能合约对应的是以太坊状态树中的一个节点，该节点有其账户余额，相当于该智能合约一共有多少个以太币；该账户中有多少代币，保存为智能合约账户的存储树上的变量，账户中代币的发行、转让、销毁都是通过调用智能合约中的函数实现的。它不像以太坊那样需要通过挖矿来维护一个底层的基础链，每种代币可以制定自己的发行规则</p>\n<p>ERC 20（Ethereum Request for Comments，以太坊征求意见）是以太坊上发行代币的一个标准，规范了所有发行代币的合约应该实现的功能和遵循的接口</p>\n<p>美链被攻击的示例，告诉我们：在计算时，一定要考虑溢出的问题，sodility 有一个专门的 safeMath 库，计算时会检测是否溢出</p>\n","_processedHighlight":true},{"title":"北大-区块链技术与应用26-课程总结","date":"2025-01-21T16:46:05.000Z","_content":"\nInformation can flow freely on the Internet, but payment cannot.\n\nSoftware is eating the world.\n\nDemocracy is the worst form of Government except for all those other forms that have been tried from time to time.\n\nDecentralization isn't always a good thing.\n\nIf the business model is bad, it's still bad on the Internet.\n","source":"_posts/55-北大区块链-课程总结.md","raw":"---\ntitle: 北大-区块链技术与应用26-课程总结\ndate: 2025-01-22 00:46:05\ntags:\n    - web3\n    - ETH\ncategories:\n    - Web3\n      - 北大肖臻-区块链技术与应用\n---\n\nInformation can flow freely on the Internet, but payment cannot.\n\nSoftware is eating the world.\n\nDemocracy is the worst form of Government except for all those other forms that have been tried from time to time.\n\nDecentralization isn't always a good thing.\n\nIf the business model is bad, it's still bad on the Internet.\n","slug":"55-北大区块链-课程总结","published":1,"updated":"2025-05-20T02:47:28.686Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvue004t6kpr5rjzh6ay","content":"<p>Information can flow freely on the Internet, but payment cannot.</p>\n<p>Software is eating the world.</p>\n<p>Democracy is the worst form of Government except for all those other forms that have been tried from time to time.</p>\n<p>Decentralization isn’t always a good thing.</p>\n<p>If the business model is bad, it’s still bad on the Internet.</p>\n","site":{"data":{}},"excerpt":"","more":"<p>Information can flow freely on the Internet, but payment cannot.</p>\n<p>Software is eating the world.</p>\n<p>Democracy is the worst form of Government except for all those other forms that have been tried from time to time.</p>\n<p>Decentralization isn’t always a good thing.</p>\n<p>If the business model is bad, it’s still bad on the Internet.</p>\n","_processedHighlight":true},{"title":"React1","date":"2025-01-22T04:24:59.000Z","_content":"\n## 一、项目的创建\n\n### 1、创建方式\n\n#### （1）使用官方的脚手架\n\n```\nnpx create-react-app <projectname>\n```\n\n只做 React 基本的搭建和构建，没有路由和状态管理，项目使用 Webpack 构建\n\n#### （2）使用一些市场上的集成脚手架\n\n官方脚手架提供的项目模板非常简单，因此也有很多集成的脚手架，比如：umi\n\n这类脚手架创建的项目会集成很多功能，比如：路由、mock\n\n### 2、两个核心库\n\n#### （1）React\n\n创建一个 React 对象，提供 React 的各个功能\n\n#### （2）React-dom\n\n提供一些 DOM 操作方法，用于把 React 创建出来的 React 对象 挂载到真正的 html DOM 中，或者从 HTML DOM 中卸载，作用类似于 Vue 的 mount\n\n## 二、React 组件 和 JSX\n\n### 1、组件分类\n\n#### （1）函数组件\n\n``` js\nfunction Hello() {\n    return <div>hello</div>\n}\n```\n\n#### class 组件（老版本）\n\n``` js\nclass Hello extends React.Component {\n    render () {\n        return <div>hello</div>\n    }\n}\n```\n\n### 2、JSX 特点\n\n#### （1）直接在 JS 中混用\n\nReact 项目利用 Babel 做了对 JS 的编译，所以能直接在 JS 里写 JSX\n\n#### （2）写法接近 JS\n\nJSX 几乎和 JS 一样，不同点在于，可以在 JS 里写 HTML，且写在 JS 里的 HTML 最后会被编译成一个 JS 对象，也可以用 React 自带 createElement 创建这个对象\n\n``` js\n  function FnHello() {\n    // return <div>hello</div>\n    return React.createElement(\"div\", [], \"Hello\")\n  }\n```\n\n### 3、JSX 里面渲染不同内容的区别\n\n（1）字符串、数字：直接渲染\n\n（2）对象：只能渲染 element 对象，否则会报错\n\n（3）数组：把数组中的每一项单独渲染\n\n（4）表达式：运行表达式\n\n（5）方法：无法渲染\n\n（6）布尔值，undifined, null：不渲染\n\n``` js\nimport React from 'react';\n\nfunction App() {\n  // 新版本 - vue3 组合式 API\n  // 首字母一定要大写，区分组件和方法\n  function FnHello() {\n    // return <div>hello</div>\n    return React.createElement(\"div\", [], \"Hello\")\n  }\n\n  // 老版本 - vue2 选项式 API\n  class ClassHello extends React.Component {\n    constructor(props) {\n      super(props)\n    }\n    render() {\n      return <div>hello class</div>\n    }\n  }\n\n  console.log(\"FnHello\", FnHello) // 方法\n  console.log(\"<FnHello/>\", <FnHello/>) // React element（虚拟 DOM）\n  \n  let eleObj = FnHello()\n  let com1 = <ClassHello></ClassHello>\n  \n  let obj = { a: 123 }\n  let arr = [com1, 5, 'abc']\n  return (\n    <div className=\"App\">\n      <FnHello></FnHello>\n      <ClassHello></ClassHello>\n      -------\n      {eleObj}\n      {com1}\n      -------\n      {\"Hello Str\"}\n      {123}\n      {/* {obj} 报错 */}\n      {/* {FnHello} 报错 */}\n      {arr}\n      {1+2+3+4}\n      {true?<FnHello></FnHello>:'123'}\n      {/* {false} 不展示 */}\n      {/* {undefined} 不展示 */}\n      {/* {null} 不展示 */}\n    </div>\n  );\n}\n\nexport default App;\n```\n\n## 三、React 的时事件绑定\n\n### 1、规则模式\n\n（1）类似于原生，on+方法名（首字母大写，为了和原生区分）\n\n（2）一定要赋值给事件一个方法\n\n### 2、特别注意的问题\n\n（1）不作处理的情况下，this 会指向 undefined\n\n（2）事件绑定的必须是一个方法，不要直接调用方法，否则只会在页面初次渲染时执行\n\n### 3、事件绑定其他操作\n\n（1）传递参数\n\n（2）获取事件对象\n\n（3）阻止默认行为，冒泡等\n\n``` js\nimport React from 'react';\n\nclass App extends React.Component {\n  /**\n   * 1、方法调用使用 bind 规定 this（可以）\n   * 2、写成一个匿名箭头函数\n   * 3、方法本身写成箭头函数（可以）\n   */\n  f1() {\n    console.log(\"this\", this) // 不用 bind 的话，默认指向 undefined\n  }\n\n  f2 = () => {\n    console.log(\"this\", this) // 使用箭头函数\n  }\n\n  f3(a, b) {\n    console.log(\"a + b =\", a + b)\n  }\n\n  f4 = (a, b) => {\n    console.log(\"a + b =\", a + b)\n  }\n\n  f5(a) {\n    console.log(\"a\", a)\n  }\n\n  f6(a, b, e) {\n    // 不是原生的事件对象（在 nativeEvent 中），而是合成的事件对象\n    console.log(\"e\", e)\n    /**\n     *     event.stopPropagation(); // 原生阻止冒泡\n     *     event.preventDefault(); // 原生阻止默认\n     */\n    e.stopPropagation(); // 阻止冒泡\n    e.preventDefault(); // 阻止默认\n  }\n\n  render() {\n    return <div className=\"App\">\n      <div onClick={() => {\n        console.log(1)\n      }}>123</div>\n\n      <div onClick={this.f1.bind(this)}>456</div>\n      <div onClick={this.f2}>789</div>\n      {/* 不能传方法的调用 */}\n      <div onClick={this.f2()}>error</div>\n\n      {/* 箭头函数改变 this 指向 */}\n      <div onClick={() => {\n        console.log(\"this\", this)\n      }}>匿名1</div>\n      \n      {/* 普通函数不行 */}\n      <div onClick={function () {\n        console.log(\"this\", this)\n      }}>匿名2</div>\n\n      {/* 事件传参 */}\n      {/* 1、普通函数.bind() + 普通函数 */}\n      <div onClick={this.f3.bind(this, 1, 2)}>传参1</div>\n      {/* 2、箭头函数 + 箭头函数 */}\n      <div onClick={() => this.f4(1, 2)}>传参2</div>\n\n      {/* 获取事件对象 */}\n      {/* 1、不传参 */}\n      <div onClick={this.f5.bind(this)}>事件1</div>\n      {/* 2、传参 */}\n      <div onClick={this.f6.bind(this, 1, 2)}>事件2</div>\n    </div>\n  }\n}\n\nexport default App;\n\n```\n\n## 四、React 中的响应式数据\n\n### 1、类组件响应式数据\n\n响应式数据定义在类的 state 属性中\n\n``` js\nclass ClassState extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            // 这里写响应式数据，类似 vue 的 data 方法返回的对象\n            a: 123\n        }\n    }\n}\n```\n\n### 2、React 响应式原理\n\n（1）React 不能像 Vue 一样直接修改触发更新\n\n（2）React 修改能改值，但无法触发更新，因为 React 不像 Vue 监听了 get 和 set，而是在调用 setState 时调用 React 的更新操作\n\n### 3、setState 关键点\n\n（1）通过浅合并来修改数据\n\n（2）调用 setState 方法会触发更新，修改 state 不会触发更新\n\n（3）setState 方法是异步的，如果要获取修改后的值，需要在 setState 的第二个参数里获取\n\n（4）setState 方法多次修改，会合并为一次，统一更新\n\n（5）setState 返回会触发更新，不管是否有修改，这导致：重复修改为相同的值也会让组件更新\n\n（6）一定不要在 render 里直接 setState\n\n### 4、PureComponent 下对于对象和数组的修改\n\nPureComponent 会根据 state 是否改变来决定是否更新，而对于对象、数组这种引用类型判断是否改变的原理是看内存地址，而不是内容\n\n因此在 PureComponent 下修改对象和数组，需要声明一个新对象赋值。所以一般不直接操作原对象，而是先拷贝一份，再进行操作\n\n``` js\nimport React from 'react';\n\n// 解决了普通 component 的一些问题，比如：更新为同一个值仍然重新渲染\nclass App extends React.PureComponent {\n  // 老写法\n  // constructor(props) {\n  //   super(props)\n  //   this.state = {\n  //     ...\n  //   }\n  // }\n\n  // 新写法\n  state = {\n    a: 0,\n    b: 1,\n    c: {\n      c1: 123,\n      c2: 999\n    },\n    arr: [1, 2, 3]\n  }\n\n  addA = () => {\n    // 常用\n    this.setState({\n      a: this.state.a + 1\n    })\n\n    // 也可以更新\n    // this.state.a += 1\n    // this.setState({})\n\n    // 函数形式，不常用\n    // this.setState((state) => {\n    //   return {\n    //     a: state.a + 1\n    //   }\n    // })\n\n    this.setState({\n      a: this.state.a + 1\n    })\n\n    console.log(\"this.state.a\", this.state.a)\n  }\n\n  merge = () => {\n    // 浅合并，只合并外层\n    // 为异步操作\n    this.setState({\n      a: 1,\n      b: 2,\n      c: {\n        ...this.state.c,\n        c1: 9\n      }\n    }, () => {\n      // 回调中才能获取更新后的值\n      console.log(\"this.state0\", this.state)\n    })\n    console.log(\"this.state1\", this.state)\n  }\n\n  refresh = () => {\n    this.setState({\n      a: 1\n    })\n    this.setState({\n      b: 2\n    })\n    // 以上等同于\n    // Object.assign(this.state, {a: 1}, {b: 2})\n  }\n\n  // 数组和对象，是通过内存地址判断是否改变的\n  addArr = () => {\n    let arr_ = [...this.state.arr]\n    arr_.push(4)\n    this.setState({\n      // arr: this.state.arr\n      arr: arr_\n    }, () => {\n      console.log(\"this.state.arr\", this.state.arr)\n    })\n\n    this.setState({\n      c: {\n        ...this.state.c,\n        c1: 8888\n      }\n    }, () => {\n      console.log(\"this.state.c\", this.state.c)\n    })\n  }\n\n  render() {\n    console.log(123)\n    // 不能在 render 中使用 this.setState，会死循环\n    return <div className=\"App\">\n      {this.state.a}\n      <button onClick={() => this.addA()}>加1</button>\n      <button onClick={() => this.merge()}>合并</button>\n      <button onClick={() => this.refresh()}>更新</button>\n      {this.state.arr}\n      <button onClick={() => this.addArr()}>数组增加</button>\n    </div>\n  }\n}\n\nexport default App;\n```\n\n## 五、条件渲染和列表循环\n\nReact 没有 Vue 一样的指令，一切操作本质上是通过运算生成不同的内容，再渲染得到不同的页面\n\n``` js\nimport React from 'react';\n\nclass App extends React.PureComponent {\n  state = {\n    show: true,\n    originArr: [1, 2, 3] // [1, 2, 3] => [<div>1</div>, <div>2</div>, <div>3</div>]\n  }\n\n  f1() {\n    if(this.state.show) {\n      return <div>div1</div>\n    }\n    return \"\"\n  }\n\n  getArr() {\n    let newArr = []\n    this.state.originArr.forEach((item) => {\n      newArr.push(<div>{item}</div>)\n    })\n    console.log('newArr', newArr)\n    return newArr\n  }\n\n  addData = () => {\n    let _arr = [...this.state.originArr]\n    _arr.push(Math.random() * 10)\n    this.setState({\n      originArr: _arr\n    })\n  }\n\n  render() {\n    return <div className=\"App\">\n      <div>条件渲染</div>\n      {/* {this.state.show ? <div>div1</div>: \"\"} */}\n      {this.f1()}\n      <button onClick={() => {\n        this.setState({\n          show: !this.state.show\n        })\n      }}>{this.state.show ? \"隐藏\" : \"显示\"}</button>\n\n      <div>列表渲染</div>\n      {/* { this.getArr() } */}\n      {\n        this.state.originArr.map((item) => {\n          return <div key={item}>{item}</div>\n        })\n      }\n      <button onClick={() => this.addData()}>添加</button>\n    </div>\n  }\n}\n\nexport default App;\n```\n\n## 六、表单绑定\n\nReact 中很多思路都是按原生的操作去做的，表单绑定也是如此\n\n原生表单获取表单输入值，可以通过监听 input、change 等事件，然后获取 e.target.value\n\n如果要设置表单的值，通常设置 value 属性，如果是选择框则是 checked 属性\n\n``` js\nimport React from 'react';\n\nclass App extends React.PureComponent {\n  state = {\n    inputValue: \"\",\n    checkedArr: [\"c2\"]\n  }\n\n  handleChecked = (e) => {\n    let arr = [...this.state.checkedArr]\n    if(e.target.checked) {\n      arr.push(e.target.value)\n    }\n    else {\n      arr.splice(arr.indexOf(e.target.value), 1)\n    }\n    this.setState({\n      checkedArr: arr\n    })\n  }\n  \n  render() {\n    return <div className=\"App\">\n      {/* <input onBlur={} /> */}\n      {/* <input onChange={} /> */}\n      <input value={this.state.inputValue} onInput={(e) => {\n        this.setState({\n          inputValue: e.target.value\n        })\n      }} />\n      { this.state.inputValue }\n\n      {/* checkbox */}\n      <input checked={this.state.checkedArr.indexOf(\"c1\")!==-1} type=\"checkbox\" value=\"c1\" name=\"choose\" onChange={this.handleChecked} />\n      <input checked={this.state.checkedArr.indexOf(\"c2\")!==-1} type=\"checkbox\" value=\"c2\" name=\"choose\" onChange={this.handleChecked} />\n      <input checked={this.state.checkedArr.indexOf(\"c3\")!==-1} type=\"checkbox\" value=\"c3\" name=\"choose\" onChange={this.handleChecked} />\n      { this.state.checkedArr }\n    </div>\n  }\n}\n\nexport default App;\n```\n\n## 七、props 和组件间传值、插槽\n\nprops 是 React 中的核心，一切写在组件上的属性和子节点都被划为 props\n\nReact 父子传值，插槽全都基于 props，不像 Vue 有事件监听、emit、专门的插槽 这类东西\n\n``` js\n/* App.js */\nimport React from 'react';\nimport Son from './Son';\n\nclass App extends React.PureComponent {\n  state = {\n    // msg: 123 // 抛出类型错误\n    msg: \"app message\"\n  }\n\n  changeMsg = (sonMsg) => {\n    console.log(\"sonMsg\", sonMsg)\n    this.setState({\n      msg: sonMsg\n    })\n  }\n  \n  render() {\n    return <div className=\"App\">\n      I'm App.\n      <br></br>\n      {/* 具名插槽 */}\n      {/* 在插槽中显示子组件内容 */}\n      {/* <Son msg={this.state.msg} a={<div>I'm slot2</div>} scopeslot={(scope) => {\n        return <div>scope: {scope}</div>\n      }}>\n        <div>I'm slot</div>\n      </Son> */}\n\n      <Son msg={this.state.msg} changeMsg={this.changeMsg}>\n\n      </Son>\n    </div>\n  }\n}\n\nexport default App;\n```\n\n``` js\n/* Son.js */\nimport React from \"react\"\nimport proptypes from \"proptypes\"\n\nclass Son extends React.PureComponent {\n    // constructor(props) {\n    //     super(props)\n    //     this.state = {\n    //         sonMsg: \"hello\"\n    //     }\n    // }\n\n    state = {\n        sonMsg: \"son message\"\n    }\n\n    render() {\n        // console.log(\"this.props\", this.props)\n        // return <div>\n        //     {/* 具名插槽 */}\n        //     {this.props.a}\n\n        //     {\"this.props.msg: \" + this.props.msg}\n        //     <br></br>\n        //     {\"this.state.sonMsg: \" + this.state.sonMsg}\n        //     <br></br>\n        //     I'm Son.\n        //     {this.props.children}\n        //     {/* 在插槽中显示子组件内容 */}\n        //     {this.props.scopeslot(this.state.sonMsg)}\n        // </div>\n\n        return <div>\n            {this.props.msg}\n            <button onClick={() => this.props.changeMsg(\"hello, father\")}>修改</button>\n        </div>\n    }\n}\n\n// Son.propTypes = {\n//     msg: function(props) {\n//         if (typeof props.msg !== \"string\") {\n//             throw new Error(\"msg must be a string\")\n//         }\n//     }\n// }\n// proptypes 库\nSon.propTypes = {\n    msg: proptypes.string\n}\n\nSon.defaultProps = {\n    msg: \"default\"\n}\n\nexport default Son;\n```\n\n## 八、React 样式设置\n\n### 1、class 类名设置\n\n（1）必须写为 className\n\n（2）类名和样式写在 css 文件里\n\n（3）必须接受一个字符串\n \n### 2、style 内联\n\n不能像原生一样写成字符串，必须写成对象\n\n``` js\n/* App.js */\nimport './App.css';\nimport React from 'react';\nimport Son from './Son';\n\nclass App extends React.PureComponent {\n  state = {\n    msg: \"app message\"\n  }\n  \n  render() {\n    return <div>\n      <div className=\"father\" style={\n        {\n          background: \"yellow\",\n          fontSize: \"25px\"\n        }\n      }>father</div>\n      <Son></Son>\n    </div>\n  }\n}\n\nexport default App;\n```\n\n``` js\n/* Son.js */\nimport React from \"react\"\nimport proptypes from \"proptypes\"\n// import \"./Son.css\"\nimport sonStyle from \"./Son.module.css\"\n// console.log(\"sonStyle\", sonStyle)\n// 组件名 - .module.css\n// vue style scoped\n// import classnames from \"classnames\" // 非模块化\nimport classnames from \"classnames/bind\" // 模块化\nlet bindClassnames = classnames.bind(sonStyle) // 模块化方法\nlet str = classnames({\n    son: true,\n    son1: true\n})\nconsole.log(\"str\", str)\n// 更方便操作类名的库 - classnames\n// 本质是生成一个字符串\n\nclass Son extends React.PureComponent {\n    state = {\n        sonMsg: \"son message\",\n        hasSon1: false\n    }\n\n    render() {\n        return <div>\n            {/* 取出新的 class 名 */}\n            <div className={sonStyle.son + \" \" + sonStyle.son1}>son1</div>\n            \n            {/* classnames 库 */}\n            {/* 非模块化 */}\n            <div className={classnames({\n                son: true,\n                son1: this.state.hasSon1\n            })}>son2</div>\n            {/* 模块化 */}\n            <div className={bindClassnames({\n                son: true,\n                son1: this.state.hasSon1\n            })}>son3</div>\n        </div>\n    }\n}\n\n// proptypes 库\nSon.propTypes = {\n    msg: proptypes.string\n}\n\nSon.defaultProps = {\n    msg: \"default\"\n}\n\nexport default Son;\n```\n\n``` css\n/* App.css */\n.father {\n  color: red\n}\n```\n\n``` css\n/* Son.module.css */\n.son {\n    color: blue\n}\n.son1 {\n    background-color: bisque;\n}\n```\n\n## 九、React 生命周期\n\n### 1、生命周期图示\n\n![图一](../images/56/1.png)\n\n### 2、严格模式\n\n严格模式只在开发模式下生效，生产上线时会去除，作用如下：\n\n（1）检测危险操作（比如：使用已经废弃 api 和不推荐的 api）\n\n（2）把生命周期执行两次，来检测额外副作用（比如：render）\n\n``` js\n/* index.js */\nconst root = ReactDOM.createRoot(document.getElementById('root'));\nroot.render(\n  // 严格模式\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);\n```\n\n### 3、React 和 Vue 更新\n\n#### （1）Vue\n\nVue 是在 get 和 set 里触发更新，在 get 部分会进行依赖收集的操作\n\n在更改数据后，只会更新用到该数据的地方，做到最小的更新范围\n\n#### （2）React\n\nReact 的更新是调用方法时触发的，没有依赖收集的过程\n\n所以会更新整个组件树、同时更新子组件，即使更新的数据和子组件没有关系\n\n``` js\n/* App.js */\nimport './App.css';\nimport React from 'react';\nimport Son from './Son';\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      msg: \"app message\"\n    }\n    console.log(\"constructor\")\n  }\n\n  // derived 派生的\n  static getDerivedStateFromProps(props, state) {\n    console.log(\"derived\")\n    console.log(\"derived-props\", props)\n    console.log(\"derived-state\", state)\n    return null\n  }\n\n  // 优化生命周期（只能在 React.Component 中使用，因为 PureComponent 已经实现了）\n  shouldComponentUpdate(props, state) {\n    console.log(\"shouldUpdate\")\n    // console.log(\"shouldUpdate-props\", props)\n    console.log(\"shouldUpdate-this.state 修改前\", this.state)\n    console.log(\"shouldUpdate-state 修改后\", state)\n    // 实现 PureComponent 优化\n    for(let item in this.state) {\n      if(this.state[item] != state[item]) {\n        return true\n      }\n    }\n    return false\n  }\n  \n  // 一定不要修改数据\n  render() {\n    console.log(\"render\")\n    return <div>\n      <div className=\"father\">\n        <div>{this.state.msg}</div>\n        <button onClick={() => {\n          this.setState({\n            msg: \"hello\"\n          })\n        }}>修改msg</button>\n        <Son></Son>\n      </div>\n    </div>\n  }\n\n  // 类似 Vue mounted\n  componentDidMount() {\n    console.log(\"didMount\")\n  }\n\n  // 类似 Vue updated\n  componentDidUpdate() {\n    console.log(\"didUpdate\")\n  }\n\n  // 类似 Vue unmounted\n  componentWillUnmount() {\n    console.log(\"willUnmount\")\n  }\n}\n\nexport default App;\n```\n\n``` js\n/* Son.js */\nimport React from \"react\"\nimport proptypes from \"proptypes\"\n\n// 如果使用 Component，父组件更新会导致子组件更新，即使子组件数组没变化\nclass Son extends React.Component {\n    state = {\n        sonMsg: \"son message\",\n        hasSon1: false\n    }\n\n    render() {\n        console.log(\"son render\")\n        return <div>\n        </div>\n    }\n}\n\n// proptypes 库\nSon.propTypes = {\n    msg: proptypes.string\n}\n\nSon.defaultProps = {\n    msg: \"default\"\n}\n\nexport default Son;\n```\n","source":"_posts/56-React1.md","raw":"---\ntitle: React1\ndate: 2025-01-22 12:24:59\ntags:\n    - React\ncategories:\n    - React\n      - 基础课程\n---\n\n## 一、项目的创建\n\n### 1、创建方式\n\n#### （1）使用官方的脚手架\n\n```\nnpx create-react-app <projectname>\n```\n\n只做 React 基本的搭建和构建，没有路由和状态管理，项目使用 Webpack 构建\n\n#### （2）使用一些市场上的集成脚手架\n\n官方脚手架提供的项目模板非常简单，因此也有很多集成的脚手架，比如：umi\n\n这类脚手架创建的项目会集成很多功能，比如：路由、mock\n\n### 2、两个核心库\n\n#### （1）React\n\n创建一个 React 对象，提供 React 的各个功能\n\n#### （2）React-dom\n\n提供一些 DOM 操作方法，用于把 React 创建出来的 React 对象 挂载到真正的 html DOM 中，或者从 HTML DOM 中卸载，作用类似于 Vue 的 mount\n\n## 二、React 组件 和 JSX\n\n### 1、组件分类\n\n#### （1）函数组件\n\n``` js\nfunction Hello() {\n    return <div>hello</div>\n}\n```\n\n#### class 组件（老版本）\n\n``` js\nclass Hello extends React.Component {\n    render () {\n        return <div>hello</div>\n    }\n}\n```\n\n### 2、JSX 特点\n\n#### （1）直接在 JS 中混用\n\nReact 项目利用 Babel 做了对 JS 的编译，所以能直接在 JS 里写 JSX\n\n#### （2）写法接近 JS\n\nJSX 几乎和 JS 一样，不同点在于，可以在 JS 里写 HTML，且写在 JS 里的 HTML 最后会被编译成一个 JS 对象，也可以用 React 自带 createElement 创建这个对象\n\n``` js\n  function FnHello() {\n    // return <div>hello</div>\n    return React.createElement(\"div\", [], \"Hello\")\n  }\n```\n\n### 3、JSX 里面渲染不同内容的区别\n\n（1）字符串、数字：直接渲染\n\n（2）对象：只能渲染 element 对象，否则会报错\n\n（3）数组：把数组中的每一项单独渲染\n\n（4）表达式：运行表达式\n\n（5）方法：无法渲染\n\n（6）布尔值，undifined, null：不渲染\n\n``` js\nimport React from 'react';\n\nfunction App() {\n  // 新版本 - vue3 组合式 API\n  // 首字母一定要大写，区分组件和方法\n  function FnHello() {\n    // return <div>hello</div>\n    return React.createElement(\"div\", [], \"Hello\")\n  }\n\n  // 老版本 - vue2 选项式 API\n  class ClassHello extends React.Component {\n    constructor(props) {\n      super(props)\n    }\n    render() {\n      return <div>hello class</div>\n    }\n  }\n\n  console.log(\"FnHello\", FnHello) // 方法\n  console.log(\"<FnHello/>\", <FnHello/>) // React element（虚拟 DOM）\n  \n  let eleObj = FnHello()\n  let com1 = <ClassHello></ClassHello>\n  \n  let obj = { a: 123 }\n  let arr = [com1, 5, 'abc']\n  return (\n    <div className=\"App\">\n      <FnHello></FnHello>\n      <ClassHello></ClassHello>\n      -------\n      {eleObj}\n      {com1}\n      -------\n      {\"Hello Str\"}\n      {123}\n      {/* {obj} 报错 */}\n      {/* {FnHello} 报错 */}\n      {arr}\n      {1+2+3+4}\n      {true?<FnHello></FnHello>:'123'}\n      {/* {false} 不展示 */}\n      {/* {undefined} 不展示 */}\n      {/* {null} 不展示 */}\n    </div>\n  );\n}\n\nexport default App;\n```\n\n## 三、React 的时事件绑定\n\n### 1、规则模式\n\n（1）类似于原生，on+方法名（首字母大写，为了和原生区分）\n\n（2）一定要赋值给事件一个方法\n\n### 2、特别注意的问题\n\n（1）不作处理的情况下，this 会指向 undefined\n\n（2）事件绑定的必须是一个方法，不要直接调用方法，否则只会在页面初次渲染时执行\n\n### 3、事件绑定其他操作\n\n（1）传递参数\n\n（2）获取事件对象\n\n（3）阻止默认行为，冒泡等\n\n``` js\nimport React from 'react';\n\nclass App extends React.Component {\n  /**\n   * 1、方法调用使用 bind 规定 this（可以）\n   * 2、写成一个匿名箭头函数\n   * 3、方法本身写成箭头函数（可以）\n   */\n  f1() {\n    console.log(\"this\", this) // 不用 bind 的话，默认指向 undefined\n  }\n\n  f2 = () => {\n    console.log(\"this\", this) // 使用箭头函数\n  }\n\n  f3(a, b) {\n    console.log(\"a + b =\", a + b)\n  }\n\n  f4 = (a, b) => {\n    console.log(\"a + b =\", a + b)\n  }\n\n  f5(a) {\n    console.log(\"a\", a)\n  }\n\n  f6(a, b, e) {\n    // 不是原生的事件对象（在 nativeEvent 中），而是合成的事件对象\n    console.log(\"e\", e)\n    /**\n     *     event.stopPropagation(); // 原生阻止冒泡\n     *     event.preventDefault(); // 原生阻止默认\n     */\n    e.stopPropagation(); // 阻止冒泡\n    e.preventDefault(); // 阻止默认\n  }\n\n  render() {\n    return <div className=\"App\">\n      <div onClick={() => {\n        console.log(1)\n      }}>123</div>\n\n      <div onClick={this.f1.bind(this)}>456</div>\n      <div onClick={this.f2}>789</div>\n      {/* 不能传方法的调用 */}\n      <div onClick={this.f2()}>error</div>\n\n      {/* 箭头函数改变 this 指向 */}\n      <div onClick={() => {\n        console.log(\"this\", this)\n      }}>匿名1</div>\n      \n      {/* 普通函数不行 */}\n      <div onClick={function () {\n        console.log(\"this\", this)\n      }}>匿名2</div>\n\n      {/* 事件传参 */}\n      {/* 1、普通函数.bind() + 普通函数 */}\n      <div onClick={this.f3.bind(this, 1, 2)}>传参1</div>\n      {/* 2、箭头函数 + 箭头函数 */}\n      <div onClick={() => this.f4(1, 2)}>传参2</div>\n\n      {/* 获取事件对象 */}\n      {/* 1、不传参 */}\n      <div onClick={this.f5.bind(this)}>事件1</div>\n      {/* 2、传参 */}\n      <div onClick={this.f6.bind(this, 1, 2)}>事件2</div>\n    </div>\n  }\n}\n\nexport default App;\n\n```\n\n## 四、React 中的响应式数据\n\n### 1、类组件响应式数据\n\n响应式数据定义在类的 state 属性中\n\n``` js\nclass ClassState extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            // 这里写响应式数据，类似 vue 的 data 方法返回的对象\n            a: 123\n        }\n    }\n}\n```\n\n### 2、React 响应式原理\n\n（1）React 不能像 Vue 一样直接修改触发更新\n\n（2）React 修改能改值，但无法触发更新，因为 React 不像 Vue 监听了 get 和 set，而是在调用 setState 时调用 React 的更新操作\n\n### 3、setState 关键点\n\n（1）通过浅合并来修改数据\n\n（2）调用 setState 方法会触发更新，修改 state 不会触发更新\n\n（3）setState 方法是异步的，如果要获取修改后的值，需要在 setState 的第二个参数里获取\n\n（4）setState 方法多次修改，会合并为一次，统一更新\n\n（5）setState 返回会触发更新，不管是否有修改，这导致：重复修改为相同的值也会让组件更新\n\n（6）一定不要在 render 里直接 setState\n\n### 4、PureComponent 下对于对象和数组的修改\n\nPureComponent 会根据 state 是否改变来决定是否更新，而对于对象、数组这种引用类型判断是否改变的原理是看内存地址，而不是内容\n\n因此在 PureComponent 下修改对象和数组，需要声明一个新对象赋值。所以一般不直接操作原对象，而是先拷贝一份，再进行操作\n\n``` js\nimport React from 'react';\n\n// 解决了普通 component 的一些问题，比如：更新为同一个值仍然重新渲染\nclass App extends React.PureComponent {\n  // 老写法\n  // constructor(props) {\n  //   super(props)\n  //   this.state = {\n  //     ...\n  //   }\n  // }\n\n  // 新写法\n  state = {\n    a: 0,\n    b: 1,\n    c: {\n      c1: 123,\n      c2: 999\n    },\n    arr: [1, 2, 3]\n  }\n\n  addA = () => {\n    // 常用\n    this.setState({\n      a: this.state.a + 1\n    })\n\n    // 也可以更新\n    // this.state.a += 1\n    // this.setState({})\n\n    // 函数形式，不常用\n    // this.setState((state) => {\n    //   return {\n    //     a: state.a + 1\n    //   }\n    // })\n\n    this.setState({\n      a: this.state.a + 1\n    })\n\n    console.log(\"this.state.a\", this.state.a)\n  }\n\n  merge = () => {\n    // 浅合并，只合并外层\n    // 为异步操作\n    this.setState({\n      a: 1,\n      b: 2,\n      c: {\n        ...this.state.c,\n        c1: 9\n      }\n    }, () => {\n      // 回调中才能获取更新后的值\n      console.log(\"this.state0\", this.state)\n    })\n    console.log(\"this.state1\", this.state)\n  }\n\n  refresh = () => {\n    this.setState({\n      a: 1\n    })\n    this.setState({\n      b: 2\n    })\n    // 以上等同于\n    // Object.assign(this.state, {a: 1}, {b: 2})\n  }\n\n  // 数组和对象，是通过内存地址判断是否改变的\n  addArr = () => {\n    let arr_ = [...this.state.arr]\n    arr_.push(4)\n    this.setState({\n      // arr: this.state.arr\n      arr: arr_\n    }, () => {\n      console.log(\"this.state.arr\", this.state.arr)\n    })\n\n    this.setState({\n      c: {\n        ...this.state.c,\n        c1: 8888\n      }\n    }, () => {\n      console.log(\"this.state.c\", this.state.c)\n    })\n  }\n\n  render() {\n    console.log(123)\n    // 不能在 render 中使用 this.setState，会死循环\n    return <div className=\"App\">\n      {this.state.a}\n      <button onClick={() => this.addA()}>加1</button>\n      <button onClick={() => this.merge()}>合并</button>\n      <button onClick={() => this.refresh()}>更新</button>\n      {this.state.arr}\n      <button onClick={() => this.addArr()}>数组增加</button>\n    </div>\n  }\n}\n\nexport default App;\n```\n\n## 五、条件渲染和列表循环\n\nReact 没有 Vue 一样的指令，一切操作本质上是通过运算生成不同的内容，再渲染得到不同的页面\n\n``` js\nimport React from 'react';\n\nclass App extends React.PureComponent {\n  state = {\n    show: true,\n    originArr: [1, 2, 3] // [1, 2, 3] => [<div>1</div>, <div>2</div>, <div>3</div>]\n  }\n\n  f1() {\n    if(this.state.show) {\n      return <div>div1</div>\n    }\n    return \"\"\n  }\n\n  getArr() {\n    let newArr = []\n    this.state.originArr.forEach((item) => {\n      newArr.push(<div>{item}</div>)\n    })\n    console.log('newArr', newArr)\n    return newArr\n  }\n\n  addData = () => {\n    let _arr = [...this.state.originArr]\n    _arr.push(Math.random() * 10)\n    this.setState({\n      originArr: _arr\n    })\n  }\n\n  render() {\n    return <div className=\"App\">\n      <div>条件渲染</div>\n      {/* {this.state.show ? <div>div1</div>: \"\"} */}\n      {this.f1()}\n      <button onClick={() => {\n        this.setState({\n          show: !this.state.show\n        })\n      }}>{this.state.show ? \"隐藏\" : \"显示\"}</button>\n\n      <div>列表渲染</div>\n      {/* { this.getArr() } */}\n      {\n        this.state.originArr.map((item) => {\n          return <div key={item}>{item}</div>\n        })\n      }\n      <button onClick={() => this.addData()}>添加</button>\n    </div>\n  }\n}\n\nexport default App;\n```\n\n## 六、表单绑定\n\nReact 中很多思路都是按原生的操作去做的，表单绑定也是如此\n\n原生表单获取表单输入值，可以通过监听 input、change 等事件，然后获取 e.target.value\n\n如果要设置表单的值，通常设置 value 属性，如果是选择框则是 checked 属性\n\n``` js\nimport React from 'react';\n\nclass App extends React.PureComponent {\n  state = {\n    inputValue: \"\",\n    checkedArr: [\"c2\"]\n  }\n\n  handleChecked = (e) => {\n    let arr = [...this.state.checkedArr]\n    if(e.target.checked) {\n      arr.push(e.target.value)\n    }\n    else {\n      arr.splice(arr.indexOf(e.target.value), 1)\n    }\n    this.setState({\n      checkedArr: arr\n    })\n  }\n  \n  render() {\n    return <div className=\"App\">\n      {/* <input onBlur={} /> */}\n      {/* <input onChange={} /> */}\n      <input value={this.state.inputValue} onInput={(e) => {\n        this.setState({\n          inputValue: e.target.value\n        })\n      }} />\n      { this.state.inputValue }\n\n      {/* checkbox */}\n      <input checked={this.state.checkedArr.indexOf(\"c1\")!==-1} type=\"checkbox\" value=\"c1\" name=\"choose\" onChange={this.handleChecked} />\n      <input checked={this.state.checkedArr.indexOf(\"c2\")!==-1} type=\"checkbox\" value=\"c2\" name=\"choose\" onChange={this.handleChecked} />\n      <input checked={this.state.checkedArr.indexOf(\"c3\")!==-1} type=\"checkbox\" value=\"c3\" name=\"choose\" onChange={this.handleChecked} />\n      { this.state.checkedArr }\n    </div>\n  }\n}\n\nexport default App;\n```\n\n## 七、props 和组件间传值、插槽\n\nprops 是 React 中的核心，一切写在组件上的属性和子节点都被划为 props\n\nReact 父子传值，插槽全都基于 props，不像 Vue 有事件监听、emit、专门的插槽 这类东西\n\n``` js\n/* App.js */\nimport React from 'react';\nimport Son from './Son';\n\nclass App extends React.PureComponent {\n  state = {\n    // msg: 123 // 抛出类型错误\n    msg: \"app message\"\n  }\n\n  changeMsg = (sonMsg) => {\n    console.log(\"sonMsg\", sonMsg)\n    this.setState({\n      msg: sonMsg\n    })\n  }\n  \n  render() {\n    return <div className=\"App\">\n      I'm App.\n      <br></br>\n      {/* 具名插槽 */}\n      {/* 在插槽中显示子组件内容 */}\n      {/* <Son msg={this.state.msg} a={<div>I'm slot2</div>} scopeslot={(scope) => {\n        return <div>scope: {scope}</div>\n      }}>\n        <div>I'm slot</div>\n      </Son> */}\n\n      <Son msg={this.state.msg} changeMsg={this.changeMsg}>\n\n      </Son>\n    </div>\n  }\n}\n\nexport default App;\n```\n\n``` js\n/* Son.js */\nimport React from \"react\"\nimport proptypes from \"proptypes\"\n\nclass Son extends React.PureComponent {\n    // constructor(props) {\n    //     super(props)\n    //     this.state = {\n    //         sonMsg: \"hello\"\n    //     }\n    // }\n\n    state = {\n        sonMsg: \"son message\"\n    }\n\n    render() {\n        // console.log(\"this.props\", this.props)\n        // return <div>\n        //     {/* 具名插槽 */}\n        //     {this.props.a}\n\n        //     {\"this.props.msg: \" + this.props.msg}\n        //     <br></br>\n        //     {\"this.state.sonMsg: \" + this.state.sonMsg}\n        //     <br></br>\n        //     I'm Son.\n        //     {this.props.children}\n        //     {/* 在插槽中显示子组件内容 */}\n        //     {this.props.scopeslot(this.state.sonMsg)}\n        // </div>\n\n        return <div>\n            {this.props.msg}\n            <button onClick={() => this.props.changeMsg(\"hello, father\")}>修改</button>\n        </div>\n    }\n}\n\n// Son.propTypes = {\n//     msg: function(props) {\n//         if (typeof props.msg !== \"string\") {\n//             throw new Error(\"msg must be a string\")\n//         }\n//     }\n// }\n// proptypes 库\nSon.propTypes = {\n    msg: proptypes.string\n}\n\nSon.defaultProps = {\n    msg: \"default\"\n}\n\nexport default Son;\n```\n\n## 八、React 样式设置\n\n### 1、class 类名设置\n\n（1）必须写为 className\n\n（2）类名和样式写在 css 文件里\n\n（3）必须接受一个字符串\n \n### 2、style 内联\n\n不能像原生一样写成字符串，必须写成对象\n\n``` js\n/* App.js */\nimport './App.css';\nimport React from 'react';\nimport Son from './Son';\n\nclass App extends React.PureComponent {\n  state = {\n    msg: \"app message\"\n  }\n  \n  render() {\n    return <div>\n      <div className=\"father\" style={\n        {\n          background: \"yellow\",\n          fontSize: \"25px\"\n        }\n      }>father</div>\n      <Son></Son>\n    </div>\n  }\n}\n\nexport default App;\n```\n\n``` js\n/* Son.js */\nimport React from \"react\"\nimport proptypes from \"proptypes\"\n// import \"./Son.css\"\nimport sonStyle from \"./Son.module.css\"\n// console.log(\"sonStyle\", sonStyle)\n// 组件名 - .module.css\n// vue style scoped\n// import classnames from \"classnames\" // 非模块化\nimport classnames from \"classnames/bind\" // 模块化\nlet bindClassnames = classnames.bind(sonStyle) // 模块化方法\nlet str = classnames({\n    son: true,\n    son1: true\n})\nconsole.log(\"str\", str)\n// 更方便操作类名的库 - classnames\n// 本质是生成一个字符串\n\nclass Son extends React.PureComponent {\n    state = {\n        sonMsg: \"son message\",\n        hasSon1: false\n    }\n\n    render() {\n        return <div>\n            {/* 取出新的 class 名 */}\n            <div className={sonStyle.son + \" \" + sonStyle.son1}>son1</div>\n            \n            {/* classnames 库 */}\n            {/* 非模块化 */}\n            <div className={classnames({\n                son: true,\n                son1: this.state.hasSon1\n            })}>son2</div>\n            {/* 模块化 */}\n            <div className={bindClassnames({\n                son: true,\n                son1: this.state.hasSon1\n            })}>son3</div>\n        </div>\n    }\n}\n\n// proptypes 库\nSon.propTypes = {\n    msg: proptypes.string\n}\n\nSon.defaultProps = {\n    msg: \"default\"\n}\n\nexport default Son;\n```\n\n``` css\n/* App.css */\n.father {\n  color: red\n}\n```\n\n``` css\n/* Son.module.css */\n.son {\n    color: blue\n}\n.son1 {\n    background-color: bisque;\n}\n```\n\n## 九、React 生命周期\n\n### 1、生命周期图示\n\n![图一](../images/56/1.png)\n\n### 2、严格模式\n\n严格模式只在开发模式下生效，生产上线时会去除，作用如下：\n\n（1）检测危险操作（比如：使用已经废弃 api 和不推荐的 api）\n\n（2）把生命周期执行两次，来检测额外副作用（比如：render）\n\n``` js\n/* index.js */\nconst root = ReactDOM.createRoot(document.getElementById('root'));\nroot.render(\n  // 严格模式\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);\n```\n\n### 3、React 和 Vue 更新\n\n#### （1）Vue\n\nVue 是在 get 和 set 里触发更新，在 get 部分会进行依赖收集的操作\n\n在更改数据后，只会更新用到该数据的地方，做到最小的更新范围\n\n#### （2）React\n\nReact 的更新是调用方法时触发的，没有依赖收集的过程\n\n所以会更新整个组件树、同时更新子组件，即使更新的数据和子组件没有关系\n\n``` js\n/* App.js */\nimport './App.css';\nimport React from 'react';\nimport Son from './Son';\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      msg: \"app message\"\n    }\n    console.log(\"constructor\")\n  }\n\n  // derived 派生的\n  static getDerivedStateFromProps(props, state) {\n    console.log(\"derived\")\n    console.log(\"derived-props\", props)\n    console.log(\"derived-state\", state)\n    return null\n  }\n\n  // 优化生命周期（只能在 React.Component 中使用，因为 PureComponent 已经实现了）\n  shouldComponentUpdate(props, state) {\n    console.log(\"shouldUpdate\")\n    // console.log(\"shouldUpdate-props\", props)\n    console.log(\"shouldUpdate-this.state 修改前\", this.state)\n    console.log(\"shouldUpdate-state 修改后\", state)\n    // 实现 PureComponent 优化\n    for(let item in this.state) {\n      if(this.state[item] != state[item]) {\n        return true\n      }\n    }\n    return false\n  }\n  \n  // 一定不要修改数据\n  render() {\n    console.log(\"render\")\n    return <div>\n      <div className=\"father\">\n        <div>{this.state.msg}</div>\n        <button onClick={() => {\n          this.setState({\n            msg: \"hello\"\n          })\n        }}>修改msg</button>\n        <Son></Son>\n      </div>\n    </div>\n  }\n\n  // 类似 Vue mounted\n  componentDidMount() {\n    console.log(\"didMount\")\n  }\n\n  // 类似 Vue updated\n  componentDidUpdate() {\n    console.log(\"didUpdate\")\n  }\n\n  // 类似 Vue unmounted\n  componentWillUnmount() {\n    console.log(\"willUnmount\")\n  }\n}\n\nexport default App;\n```\n\n``` js\n/* Son.js */\nimport React from \"react\"\nimport proptypes from \"proptypes\"\n\n// 如果使用 Component，父组件更新会导致子组件更新，即使子组件数组没变化\nclass Son extends React.Component {\n    state = {\n        sonMsg: \"son message\",\n        hasSon1: false\n    }\n\n    render() {\n        console.log(\"son render\")\n        return <div>\n        </div>\n    }\n}\n\n// proptypes 库\nSon.propTypes = {\n    msg: proptypes.string\n}\n\nSon.defaultProps = {\n    msg: \"default\"\n}\n\nexport default Son;\n```\n","slug":"56-React1","published":1,"updated":"2025-05-20T04:36:31.092Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvuf004x6kpr8p6t1dul","content":"<h2 id=\"一、项目的创建\"><a href=\"#一、项目的创建\" class=\"headerlink\" title=\"一、项目的创建\"></a>一、项目的创建</h2><h3 id=\"1、创建方式\"><a href=\"#1、创建方式\" class=\"headerlink\" title=\"1、创建方式\"></a>1、创建方式</h3><h4 id=\"（1）使用官方的脚手架\"><a href=\"#（1）使用官方的脚手架\" class=\"headerlink\" title=\"（1）使用官方的脚手架\"></a>（1）使用官方的脚手架</h4><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npx create-react-app &lt;projectname&gt;</span><br></pre></td></tr></table></figure></div>\n\n<p>只做 React 基本的搭建和构建，没有路由和状态管理，项目使用 Webpack 构建</p>\n<h4 id=\"（2）使用一些市场上的集成脚手架\"><a href=\"#（2）使用一些市场上的集成脚手架\" class=\"headerlink\" title=\"（2）使用一些市场上的集成脚手架\"></a>（2）使用一些市场上的集成脚手架</h4><p>官方脚手架提供的项目模板非常简单，因此也有很多集成的脚手架，比如：umi</p>\n<p>这类脚手架创建的项目会集成很多功能，比如：路由、mock</p>\n<h3 id=\"2、两个核心库\"><a href=\"#2、两个核心库\" class=\"headerlink\" title=\"2、两个核心库\"></a>2、两个核心库</h3><h4 id=\"（1）React\"><a href=\"#（1）React\" class=\"headerlink\" title=\"（1）React\"></a>（1）React</h4><p>创建一个 React 对象，提供 React 的各个功能</p>\n<h4 id=\"（2）React-dom\"><a href=\"#（2）React-dom\" class=\"headerlink\" title=\"（2）React-dom\"></a>（2）React-dom</h4><p>提供一些 DOM 操作方法，用于把 React 创建出来的 React 对象 挂载到真正的 html DOM 中，或者从 HTML DOM 中卸载，作用类似于 Vue 的 mount</p>\n<h2 id=\"二、React-组件-和-JSX\"><a href=\"#二、React-组件-和-JSX\" class=\"headerlink\" title=\"二、React 组件 和 JSX\"></a>二、React 组件 和 JSX</h2><h3 id=\"1、组件分类\"><a href=\"#1、组件分类\" class=\"headerlink\" title=\"1、组件分类\"></a>1、组件分类</h3><h4 id=\"（1）函数组件\"><a href=\"#（1）函数组件\" class=\"headerlink\" title=\"（1）函数组件\"></a>（1）函数组件</h4><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Hello</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>hello<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"class-组件（老版本）\"><a href=\"#class-组件（老版本）\" class=\"headerlink\" title=\"class 组件（老版本）\"></a>class 组件（老版本）</h4><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Hello</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">render</span> () &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>hello<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"2、JSX-特点\"><a href=\"#2、JSX-特点\" class=\"headerlink\" title=\"2、JSX 特点\"></a>2、JSX 特点</h3><h4 id=\"（1）直接在-JS-中混用\"><a href=\"#（1）直接在-JS-中混用\" class=\"headerlink\" title=\"（1）直接在 JS 中混用\"></a>（1）直接在 JS 中混用</h4><p>React 项目利用 Babel 做了对 JS 的编译，所以能直接在 JS 里写 JSX</p>\n<h4 id=\"（2）写法接近-JS\"><a href=\"#（2）写法接近-JS\" class=\"headerlink\" title=\"（2）写法接近 JS\"></a>（2）写法接近 JS</h4><p>JSX 几乎和 JS 一样，不同点在于，可以在 JS 里写 HTML，且写在 JS 里的 HTML 最后会被编译成一个 JS 对象，也可以用 React 自带 createElement 创建这个对象</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">FnHello</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// return &lt;div&gt;hello&lt;/div&gt;</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title class_\">React</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>, [], <span class=\"string\">&quot;Hello&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"3、JSX-里面渲染不同内容的区别\"><a href=\"#3、JSX-里面渲染不同内容的区别\" class=\"headerlink\" title=\"3、JSX 里面渲染不同内容的区别\"></a>3、JSX 里面渲染不同内容的区别</h3><p>（1）字符串、数字：直接渲染</p>\n<p>（2）对象：只能渲染 element 对象，否则会报错</p>\n<p>（3）数组：把数组中的每一项单独渲染</p>\n<p>（4）表达式：运行表达式</p>\n<p>（5）方法：无法渲染</p>\n<p>（6）布尔值，undifined, null：不渲染</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 新版本 - vue3 组合式 API</span></span><br><span class=\"line\">  <span class=\"comment\">// 首字母一定要大写，区分组件和方法</span></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">FnHello</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// return &lt;div&gt;hello&lt;/div&gt;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title class_\">React</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>, [], <span class=\"string\">&quot;Hello&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 老版本 - vue2 选项式 API</span></span><br><span class=\"line\">  <span class=\"keyword\">class</span> <span class=\"title class_\">ClassHello</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">super</span>(props)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>hello class<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;FnHello&quot;</span>, <span class=\"title class_\">FnHello</span>) <span class=\"comment\">// 方法</span></span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;&lt;FnHello/&gt;&quot;</span>, <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">FnHello</span>/&gt;</span></span>) <span class=\"comment\">// React element（虚拟 DOM）</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">let</span> eleObj = <span class=\"title class_\">FnHello</span>()</span><br><span class=\"line\">  <span class=\"keyword\">let</span> com1 = <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">ClassHello</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">ClassHello</span>&gt;</span></span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">let</span> obj = &#123; <span class=\"attr\">a</span>: <span class=\"number\">123</span> &#125;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> arr = [com1, <span class=\"number\">5</span>, <span class=\"string\">&#x27;abc&#x27;</span>]</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;App&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">FnHello</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">FnHello</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">ClassHello</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">ClassHello</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      -------</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;eleObj&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;com1&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      -------</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;&quot;Hello Str&quot;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;123&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* &#123;obj&#125; 报错 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* &#123;FnHello&#125; 报错 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;arr&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;1+2+3+4&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;true?<span class=\"tag\">&lt;<span class=\"name\">FnHello</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">FnHello</span>&gt;</span>:&#x27;123&#x27;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* &#123;false&#125; 不展示 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* &#123;undefined&#125; 不展示 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* &#123;null&#125; 不展示 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"三、React-的时事件绑定\"><a href=\"#三、React-的时事件绑定\" class=\"headerlink\" title=\"三、React 的时事件绑定\"></a>三、React 的时事件绑定</h2><h3 id=\"1、规则模式\"><a href=\"#1、规则模式\" class=\"headerlink\" title=\"1、规则模式\"></a>1、规则模式</h3><p>（1）类似于原生，on+方法名（首字母大写，为了和原生区分）</p>\n<p>（2）一定要赋值给事件一个方法</p>\n<h3 id=\"2、特别注意的问题\"><a href=\"#2、特别注意的问题\" class=\"headerlink\" title=\"2、特别注意的问题\"></a>2、特别注意的问题</h3><p>（1）不作处理的情况下，this 会指向 undefined</p>\n<p>（2）事件绑定的必须是一个方法，不要直接调用方法，否则只会在页面初次渲染时执行</p>\n<h3 id=\"3、事件绑定其他操作\"><a href=\"#3、事件绑定其他操作\" class=\"headerlink\" title=\"3、事件绑定其他操作\"></a>3、事件绑定其他操作</h3><p>（1）传递参数</p>\n<p>（2）获取事件对象</p>\n<p>（3）阻止默认行为，冒泡等</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 1、方法调用使用 bind 规定 this（可以）</span></span><br><span class=\"line\"><span class=\"comment\">   * 2、写成一个匿名箭头函数</span></span><br><span class=\"line\"><span class=\"comment\">   * 3、方法本身写成箭头函数（可以）</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"title function_\">f1</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;this&quot;</span>, <span class=\"variable language_\">this</span>) <span class=\"comment\">// 不用 bind 的话，默认指向 undefined</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  f2 = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;this&quot;</span>, <span class=\"variable language_\">this</span>) <span class=\"comment\">// 使用箭头函数</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">f3</span>(<span class=\"params\">a, b</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;a + b =&quot;</span>, a + b)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  f4 = <span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;a + b =&quot;</span>, a + b)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">f5</span>(<span class=\"params\">a</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;a&quot;</span>, a)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">f6</span>(<span class=\"params\">a, b, e</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 不是原生的事件对象（在 nativeEvent 中），而是合成的事件对象</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;e&quot;</span>, e)</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *     event.stopPropagation(); // 原生阻止冒泡</span></span><br><span class=\"line\"><span class=\"comment\">     *     event.preventDefault(); // 原生阻止默认</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    e.<span class=\"title function_\">stopPropagation</span>(); <span class=\"comment\">// 阻止冒泡</span></span><br><span class=\"line\">    e.<span class=\"title function_\">preventDefault</span>(); <span class=\"comment\">// 阻止默认</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;App&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">        console.log(1)</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#125;&#125;&gt;123<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;this.f1.bind(this)&#125;</span>&gt;</span>456<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;this.f2&#125;</span>&gt;</span>789<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 不能传方法的调用 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;this.f2()&#125;</span>&gt;</span>error<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 箭头函数改变 this 指向 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">        console.log(&quot;this&quot;, this)</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#125;&#125;&gt;匿名1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      </span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 普通函数不行 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;function</span> () &#123;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">console.log</span>(&quot;<span class=\"attr\">this</span>&quot;, <span class=\"attr\">this</span>)</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">      &#125;&#125;&gt;</span>匿名2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 事件传参 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 1、普通函数.bind() + 普通函数 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;this.f3.bind(this,</span> <span class=\"attr\">1</span>, <span class=\"attr\">2</span>)&#125;&gt;</span>传参1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 2、箭头函数 + 箭头函数 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.f4(1, 2)&#125;&gt;传参2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 获取事件对象 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 1、不传参 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;this.f5.bind(this)&#125;</span>&gt;</span>事件1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 2、传参 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;this.f6.bind(this,</span> <span class=\"attr\">1</span>, <span class=\"attr\">2</span>)&#125;&gt;</span>事件2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"四、React-中的响应式数据\"><a href=\"#四、React-中的响应式数据\" class=\"headerlink\" title=\"四、React 中的响应式数据\"></a>四、React 中的响应式数据</h2><h3 id=\"1、类组件响应式数据\"><a href=\"#1、类组件响应式数据\" class=\"headerlink\" title=\"1、类组件响应式数据\"></a>1、类组件响应式数据</h3><p>响应式数据定义在类的 state 属性中</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">ClassState</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">super</span>(props)</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">state</span> = &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 这里写响应式数据，类似 vue 的 data 方法返回的对象</span></span><br><span class=\"line\">            <span class=\"attr\">a</span>: <span class=\"number\">123</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"2、React-响应式原理\"><a href=\"#2、React-响应式原理\" class=\"headerlink\" title=\"2、React 响应式原理\"></a>2、React 响应式原理</h3><p>（1）React 不能像 Vue 一样直接修改触发更新</p>\n<p>（2）React 修改能改值，但无法触发更新，因为 React 不像 Vue 监听了 get 和 set，而是在调用 setState 时调用 React 的更新操作</p>\n<h3 id=\"3、setState-关键点\"><a href=\"#3、setState-关键点\" class=\"headerlink\" title=\"3、setState 关键点\"></a>3、setState 关键点</h3><p>（1）通过浅合并来修改数据</p>\n<p>（2）调用 setState 方法会触发更新，修改 state 不会触发更新</p>\n<p>（3）setState 方法是异步的，如果要获取修改后的值，需要在 setState 的第二个参数里获取</p>\n<p>（4）setState 方法多次修改，会合并为一次，统一更新</p>\n<p>（5）setState 返回会触发更新，不管是否有修改，这导致：重复修改为相同的值也会让组件更新</p>\n<p>（6）一定不要在 render 里直接 setState</p>\n<h3 id=\"4、PureComponent-下对于对象和数组的修改\"><a href=\"#4、PureComponent-下对于对象和数组的修改\" class=\"headerlink\" title=\"4、PureComponent 下对于对象和数组的修改\"></a>4、PureComponent 下对于对象和数组的修改</h3><p>PureComponent 会根据 state 是否改变来决定是否更新，而对于对象、数组这种引用类型判断是否改变的原理是看内存地址，而不是内容</p>\n<p>因此在 PureComponent 下修改对象和数组，需要声明一个新对象赋值。所以一般不直接操作原对象，而是先拷贝一份，再进行操作</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 解决了普通 component 的一些问题，比如：更新为同一个值仍然重新渲染</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 老写法</span></span><br><span class=\"line\">  <span class=\"comment\">// constructor(props) &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//   super(props)</span></span><br><span class=\"line\">  <span class=\"comment\">//   this.state = &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//     ...</span></span><br><span class=\"line\">  <span class=\"comment\">//   &#125;</span></span><br><span class=\"line\">  <span class=\"comment\">// &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 新写法</span></span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    <span class=\"attr\">b</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"attr\">c</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">c1</span>: <span class=\"number\">123</span>,</span><br><span class=\"line\">      <span class=\"attr\">c2</span>: <span class=\"number\">999</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">arr</span>: [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  addA = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 常用</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">a</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">a</span> + <span class=\"number\">1</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 也可以更新</span></span><br><span class=\"line\">    <span class=\"comment\">// this.state.a += 1</span></span><br><span class=\"line\">    <span class=\"comment\">// this.setState(&#123;&#125;)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 函数形式，不常用</span></span><br><span class=\"line\">    <span class=\"comment\">// this.setState((state) =&gt; &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//   return &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     a: state.a + 1</span></span><br><span class=\"line\">    <span class=\"comment\">//   &#125;</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">a</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">a</span> + <span class=\"number\">1</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;this.state.a&quot;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">a</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  merge = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 浅合并，只合并外层</span></span><br><span class=\"line\">    <span class=\"comment\">// 为异步操作</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">a</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">      <span class=\"attr\">b</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">      <span class=\"attr\">c</span>: &#123;</span><br><span class=\"line\">        ...<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">c</span>,</span><br><span class=\"line\">        <span class=\"attr\">c1</span>: <span class=\"number\">9</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 回调中才能获取更新后的值</span></span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;this.state0&quot;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;this.state1&quot;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  refresh = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">a</span>: <span class=\"number\">1</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">b</span>: <span class=\"number\">2</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">// 以上等同于</span></span><br><span class=\"line\">    <span class=\"comment\">// Object.assign(this.state, &#123;a: 1&#125;, &#123;b: 2&#125;)</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 数组和对象，是通过内存地址判断是否改变的</span></span><br><span class=\"line\">  addArr = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> arr_ = [...<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">arr</span>]</span><br><span class=\"line\">    arr_.<span class=\"title function_\">push</span>(<span class=\"number\">4</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"comment\">// arr: this.state.arr</span></span><br><span class=\"line\">      <span class=\"attr\">arr</span>: arr_</span><br><span class=\"line\">    &#125;, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;this.state.arr&quot;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">arr</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">c</span>: &#123;</span><br><span class=\"line\">        ...<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">c</span>,</span><br><span class=\"line\">        <span class=\"attr\">c1</span>: <span class=\"number\">8888</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;this.state.c&quot;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">c</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">123</span>)</span><br><span class=\"line\">    <span class=\"comment\">// 不能在 render 中使用 this.setState，会死循环</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;App&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;this.state.a&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.addA()&#125;&gt;加1<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.merge()&#125;&gt;合并<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.refresh()&#125;&gt;更新<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;this.state.arr&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.addArr()&#125;&gt;数组增加<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"五、条件渲染和列表循环\"><a href=\"#五、条件渲染和列表循环\" class=\"headerlink\" title=\"五、条件渲染和列表循环\"></a>五、条件渲染和列表循环</h2><p>React 没有 Vue 一样的指令，一切操作本质上是通过运算生成不同的内容，再渲染得到不同的页面</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">show</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">originArr</span>: [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>] <span class=\"comment\">// [1, 2, 3] =&gt; [&lt;div&gt;1&lt;/div&gt;, &lt;div&gt;2&lt;/div&gt;, &lt;div&gt;3&lt;/div&gt;]</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">f1</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">show</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>div1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">getArr</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> newArr = []</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">originArr</span>.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      newArr.<span class=\"title function_\">push</span>(<span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;item&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;newArr&#x27;</span>, newArr)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> newArr</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  addData = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> _arr = [...<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">originArr</span>]</span><br><span class=\"line\">    _arr.<span class=\"title function_\">push</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"number\">10</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">originArr</span>: _arr</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;App&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>条件渲染<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* &#123;this.state.show ? <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>div1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>: &quot;&quot;&#125; */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;this.f1()&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">        this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          show: !this.state.show</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;)</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#125;&#125;&gt;&#123;this.state.show ? &quot;隐藏&quot; : &quot;显示&quot;&#125;<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>列表渲染<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* &#123; this.getArr() &#125; */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">        this.state.originArr.map((item) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          return <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">key</span>=<span class=\"string\">&#123;item&#125;</span>&gt;</span>&#123;item&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;)</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.addData()&#125;&gt;添加<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"六、表单绑定\"><a href=\"#六、表单绑定\" class=\"headerlink\" title=\"六、表单绑定\"></a>六、表单绑定</h2><p>React 中很多思路都是按原生的操作去做的，表单绑定也是如此</p>\n<p>原生表单获取表单输入值，可以通过监听 input、change 等事件，然后获取 e.target.value</p>\n<p>如果要设置表单的值，通常设置 value 属性，如果是选择框则是 checked 属性</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">inputValue</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">checkedArr</span>: [<span class=\"string\">&quot;c2&quot;</span>]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  handleChecked = <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> arr = [...<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">checkedArr</span>]</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(e.<span class=\"property\">target</span>.<span class=\"property\">checked</span>) &#123;</span><br><span class=\"line\">      arr.<span class=\"title function_\">push</span>(e.<span class=\"property\">target</span>.<span class=\"property\">value</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      arr.<span class=\"title function_\">splice</span>(arr.<span class=\"title function_\">indexOf</span>(e.<span class=\"property\">target</span>.<span class=\"property\">value</span>), <span class=\"number\">1</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">checkedArr</span>: arr</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;App&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">onBlur</span>=<span class=\"string\">&#123;&#125;</span> /&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">onChange</span>=<span class=\"string\">&#123;&#125;</span> /&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">value</span>=<span class=\"string\">&#123;this.state.inputValue&#125;</span> <span class=\"attr\">onInput</span>=<span class=\"string\">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">        this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          inputValue: e.target.value</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;)</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#125;&#125; /&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123; this.state.inputValue &#125;</span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* checkbox */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">checked</span>=<span class=\"string\">&#123;this.state.checkedArr.indexOf(</span>&quot;<span class=\"attr\">c1</span>&quot;)!==<span class=\"string\">-1&#125;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;c1&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;choose&quot;</span> <span class=\"attr\">onChange</span>=<span class=\"string\">&#123;this.handleChecked&#125;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">checked</span>=<span class=\"string\">&#123;this.state.checkedArr.indexOf(</span>&quot;<span class=\"attr\">c2</span>&quot;)!==<span class=\"string\">-1&#125;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;c2&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;choose&quot;</span> <span class=\"attr\">onChange</span>=<span class=\"string\">&#123;this.handleChecked&#125;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">checked</span>=<span class=\"string\">&#123;this.state.checkedArr.indexOf(</span>&quot;<span class=\"attr\">c3</span>&quot;)!==<span class=\"string\">-1&#125;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;c3&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;choose&quot;</span> <span class=\"attr\">onChange</span>=<span class=\"string\">&#123;this.handleChecked&#125;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123; this.state.checkedArr &#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"七、props-和组件间传值、插槽\"><a href=\"#七、props-和组件间传值、插槽\" class=\"headerlink\" title=\"七、props 和组件间传值、插槽\"></a>七、props 和组件间传值、插槽</h2><p>props 是 React 中的核心，一切写在组件上的属性和子节点都被划为 props</p>\n<p>React 父子传值，插槽全都基于 props，不像 Vue 有事件监听、emit、专门的插槽 这类东西</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./Son&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"comment\">// msg: 123 // 抛出类型错误</span></span><br><span class=\"line\">    <span class=\"attr\">msg</span>: <span class=\"string\">&quot;app message&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  changeMsg = <span class=\"function\">(<span class=\"params\">sonMsg</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;sonMsg&quot;</span>, sonMsg)</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">msg</span>: sonMsg</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;App&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      I&#x27;m App.</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">br</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 具名插槽 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 在插槽中显示子组件内容 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* <span class=\"tag\">&lt;<span class=\"name\">Son</span> <span class=\"attr\">msg</span>=<span class=\"string\">&#123;this.state.msg&#125;</span> <span class=\"attr\">a</span>=<span class=\"string\">&#123;</span>&lt;<span class=\"attr\">div</span>&gt;</span>I&#x27;m slot2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>&#125; scopeslot=&#123;(scope) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">        return <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>scope: &#123;scope&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#125;&#125;&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>I&#x27;m slot<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">Son</span>&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">Son</span> <span class=\"attr\">msg</span>=<span class=\"string\">&#123;this.state.msg&#125;</span> <span class=\"attr\">changeMsg</span>=<span class=\"string\">&#123;this.changeMsg&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">Son</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Son.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> proptypes <span class=\"keyword\">from</span> <span class=\"string\">&quot;proptypes&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// constructor(props) &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     super(props)</span></span><br><span class=\"line\">    <span class=\"comment\">//     this.state = &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//         sonMsg: &quot;hello&quot;</span></span><br><span class=\"line\">    <span class=\"comment\">//     &#125;</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    state = &#123;</span><br><span class=\"line\">        <span class=\"attr\">sonMsg</span>: <span class=\"string\">&quot;son message&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// console.log(&quot;this.props&quot;, this.props)</span></span><br><span class=\"line\">        <span class=\"comment\">// return &lt;div&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">//     &#123;/* 具名插槽 */&#125;</span></span><br><span class=\"line\">        <span class=\"comment\">//     &#123;this.props.a&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//     &#123;&quot;this.props.msg: &quot; + this.props.msg&#125;</span></span><br><span class=\"line\">        <span class=\"comment\">//     &lt;br&gt;&lt;/br&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">//     &#123;&quot;this.state.sonMsg: &quot; + this.state.sonMsg&#125;</span></span><br><span class=\"line\">        <span class=\"comment\">//     &lt;br&gt;&lt;/br&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">//     I&#x27;m Son.</span></span><br><span class=\"line\">        <span class=\"comment\">//     &#123;this.props.children&#125;</span></span><br><span class=\"line\">        <span class=\"comment\">//     &#123;/* 在插槽中显示子组件内容 */&#125;</span></span><br><span class=\"line\">        <span class=\"comment\">//     &#123;this.props.scopeslot(this.state.sonMsg)&#125;</span></span><br><span class=\"line\">        <span class=\"comment\">// &lt;/div&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;this.props.msg&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.props.changeMsg(&quot;hello, father&quot;)&#125;&gt;修改<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Son.propTypes = &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//     msg: function(props) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//         if (typeof props.msg !== &quot;string&quot;) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             throw new Error(&quot;msg must be a string&quot;)</span></span><br><span class=\"line\"><span class=\"comment\">//         &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//     &#125;</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br><span class=\"line\"><span class=\"comment\">// proptypes 库</span></span><br><span class=\"line\"><span class=\"title class_\">Son</span>.<span class=\"property\">propTypes</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">msg</span>: proptypes.<span class=\"property\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Son</span>.<span class=\"property\">defaultProps</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">msg</span>: <span class=\"string\">&quot;default&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Son</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"八、React-样式设置\"><a href=\"#八、React-样式设置\" class=\"headerlink\" title=\"八、React 样式设置\"></a>八、React 样式设置</h2><h3 id=\"1、class-类名设置\"><a href=\"#1、class-类名设置\" class=\"headerlink\" title=\"1、class 类名设置\"></a>1、class 类名设置</h3><p>（1）必须写为 className</p>\n<p>（2）类名和样式写在 css 文件里</p>\n<p>（3）必须接受一个字符串</p>\n<h3 id=\"2、style-内联\"><a href=\"#2、style-内联\" class=\"headerlink\" title=\"2、style 内联\"></a>2、style 内联</h3><p>不能像原生一样写成字符串，必须写成对象</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;./App.css&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./Son&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">msg</span>: <span class=\"string\">&quot;app message&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;father&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&#123;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        &#123;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">          <span class=\"attr\">background:</span> &quot;<span class=\"attr\">yellow</span>&quot;,</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">          <span class=\"attr\">fontSize:</span> &quot;<span class=\"attr\">25px</span>&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">      &#125;&gt;</span>father<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">Son</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Son</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Son.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> proptypes <span class=\"keyword\">from</span> <span class=\"string\">&quot;proptypes&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// import &quot;./Son.css&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> sonStyle <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Son.module.css&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// console.log(&quot;sonStyle&quot;, sonStyle)</span></span><br><span class=\"line\"><span class=\"comment\">// 组件名 - .module.css</span></span><br><span class=\"line\"><span class=\"comment\">// vue style scoped</span></span><br><span class=\"line\"><span class=\"comment\">// import classnames from &quot;classnames&quot; // 非模块化</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> classnames <span class=\"keyword\">from</span> <span class=\"string\">&quot;classnames/bind&quot;</span> <span class=\"comment\">// 模块化</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> bindClassnames = classnames.<span class=\"title function_\">bind</span>(sonStyle) <span class=\"comment\">// 模块化方法</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> str = <span class=\"title function_\">classnames</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">son</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">son1</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;str&quot;</span>, str)</span><br><span class=\"line\"><span class=\"comment\">// 更方便操作类名的库 - classnames</span></span><br><span class=\"line\"><span class=\"comment\">// 本质是生成一个字符串</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">    state = &#123;</span><br><span class=\"line\">        <span class=\"attr\">sonMsg</span>: <span class=\"string\">&quot;son message&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">hasSon1</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;/* 取出新的 class 名 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&#123;sonStyle.son</span> + &quot; &quot; + <span class=\"attr\">sonStyle.son1</span>&#125;&gt;</span>son1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            </span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;/* classnames 库 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;/* 非模块化 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&#123;classnames(&#123;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                <span class=\"attr\">son:</span> <span class=\"attr\">true</span>,</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                <span class=\"attr\">son1:</span> <span class=\"attr\">this.state.hasSon1</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            &#125;)&#125;&gt;</span>son2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;/* 模块化 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&#123;bindClassnames(&#123;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                <span class=\"attr\">son:</span> <span class=\"attr\">true</span>,</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                <span class=\"attr\">son1:</span> <span class=\"attr\">this.state.hasSon1</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            &#125;)&#125;&gt;</span>son3<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// proptypes 库</span></span><br><span class=\"line\"><span class=\"title class_\">Son</span>.<span class=\"property\">propTypes</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">msg</span>: proptypes.<span class=\"property\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Son</span>.<span class=\"property\">defaultProps</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">msg</span>: <span class=\"string\">&quot;default&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Son</span>;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Css\"><figure class=\"iseeu highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.css */</span></span><br><span class=\"line\"><span class=\"selector-class\">.father</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: red</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Css\"><figure class=\"iseeu highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Son.module.css */</span></span><br><span class=\"line\"><span class=\"selector-class\">.son</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: blue</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.son1</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: bisque;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"九、React-生命周期\"><a href=\"#九、React-生命周期\" class=\"headerlink\" title=\"九、React 生命周期\"></a>九、React 生命周期</h2><h3 id=\"1、生命周期图示\"><a href=\"#1、生命周期图示\" class=\"headerlink\" title=\"1、生命周期图示\"></a>1、生命周期图示</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/56/1.png\"\n                      alt=\"图一\"\n                ></p>\n<h3 id=\"2、严格模式\"><a href=\"#2、严格模式\" class=\"headerlink\" title=\"2、严格模式\"></a>2、严格模式</h3><p>严格模式只在开发模式下生效，生产上线时会去除，作用如下：</p>\n<p>（1）检测危险操作（比如：使用已经废弃 api 和不推荐的 api）</p>\n<p>（2）把生命周期执行两次，来检测额外副作用（比如：render）</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* index.js */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> root = <span class=\"title class_\">ReactDOM</span>.<span class=\"title function_\">createRoot</span>(<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;root&#x27;</span>));</span><br><span class=\"line\">root.<span class=\"title function_\">render</span>(</span><br><span class=\"line\">  <span class=\"comment\">// 严格模式</span></span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">App</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;/<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"3、React-和-Vue-更新\"><a href=\"#3、React-和-Vue-更新\" class=\"headerlink\" title=\"3、React 和 Vue 更新\"></a>3、React 和 Vue 更新</h3><h4 id=\"（1）Vue\"><a href=\"#（1）Vue\" class=\"headerlink\" title=\"（1）Vue\"></a>（1）Vue</h4><p>Vue 是在 get 和 set 里触发更新，在 get 部分会进行依赖收集的操作</p>\n<p>在更改数据后，只会更新用到该数据的地方，做到最小的更新范围</p>\n<h4 id=\"（2）React\"><a href=\"#（2）React\" class=\"headerlink\" title=\"（2）React\"></a>（2）React</h4><p>React 的更新是调用方法时触发的，没有依赖收集的过程</p>\n<p>所以会更新整个组件树、同时更新子组件，即使更新的数据和子组件没有关系</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;./App.css&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./Son&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">super</span>(props)</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">state</span> = &#123;</span><br><span class=\"line\">      <span class=\"attr\">msg</span>: <span class=\"string\">&quot;app message&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;constructor&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// derived 派生的</span></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"title function_\">getDerivedStateFromProps</span>(<span class=\"params\">props, state</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;derived&quot;</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;derived-props&quot;</span>, props)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;derived-state&quot;</span>, state)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 优化生命周期（只能在 React.Component 中使用，因为 PureComponent 已经实现了）</span></span><br><span class=\"line\">  <span class=\"title function_\">shouldComponentUpdate</span>(<span class=\"params\">props, state</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;shouldUpdate&quot;</span>)</span><br><span class=\"line\">    <span class=\"comment\">// console.log(&quot;shouldUpdate-props&quot;, props)</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;shouldUpdate-this.state 修改前&quot;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;shouldUpdate-state 修改后&quot;</span>, state)</span><br><span class=\"line\">    <span class=\"comment\">// 实现 PureComponent 优化</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> item <span class=\"keyword\">in</span> <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>[item] != state[item]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 一定不要修改数据</span></span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;render&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;father&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;this.state.msg&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">            msg: &quot;hello&quot;</span></span><br><span class=\"line\"><span class=\"language-xml\">          &#125;)</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;&gt;修改msg<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">Son</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Son</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 类似 Vue mounted</span></span><br><span class=\"line\">  <span class=\"title function_\">componentDidMount</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;didMount&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 类似 Vue updated</span></span><br><span class=\"line\">  <span class=\"title function_\">componentDidUpdate</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;didUpdate&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 类似 Vue unmounted</span></span><br><span class=\"line\">  <span class=\"title function_\">componentWillUnmount</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;willUnmount&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Son.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> proptypes <span class=\"keyword\">from</span> <span class=\"string\">&quot;proptypes&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 如果使用 Component，父组件更新会导致子组件更新，即使子组件数组没变化</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">    state = &#123;</span><br><span class=\"line\">        <span class=\"attr\">sonMsg</span>: <span class=\"string\">&quot;son message&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">hasSon1</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;son render&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// proptypes 库</span></span><br><span class=\"line\"><span class=\"title class_\">Son</span>.<span class=\"property\">propTypes</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">msg</span>: proptypes.<span class=\"property\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Son</span>.<span class=\"property\">defaultProps</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">msg</span>: <span class=\"string\">&quot;default&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Son</span>;</span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、项目的创建\"><a href=\"#一、项目的创建\" class=\"headerlink\" title=\"一、项目的创建\"></a>一、项目的创建</h2><h3 id=\"1、创建方式\"><a href=\"#1、创建方式\" class=\"headerlink\" title=\"1、创建方式\"></a>1、创建方式</h3><h4 id=\"（1）使用官方的脚手架\"><a href=\"#（1）使用官方的脚手架\" class=\"headerlink\" title=\"（1）使用官方的脚手架\"></a>（1）使用官方的脚手架</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npx create-react-app &lt;projectname&gt;</span><br></pre></td></tr></table></figure>\n\n<p>只做 React 基本的搭建和构建，没有路由和状态管理，项目使用 Webpack 构建</p>\n<h4 id=\"（2）使用一些市场上的集成脚手架\"><a href=\"#（2）使用一些市场上的集成脚手架\" class=\"headerlink\" title=\"（2）使用一些市场上的集成脚手架\"></a>（2）使用一些市场上的集成脚手架</h4><p>官方脚手架提供的项目模板非常简单，因此也有很多集成的脚手架，比如：umi</p>\n<p>这类脚手架创建的项目会集成很多功能，比如：路由、mock</p>\n<h3 id=\"2、两个核心库\"><a href=\"#2、两个核心库\" class=\"headerlink\" title=\"2、两个核心库\"></a>2、两个核心库</h3><h4 id=\"（1）React\"><a href=\"#（1）React\" class=\"headerlink\" title=\"（1）React\"></a>（1）React</h4><p>创建一个 React 对象，提供 React 的各个功能</p>\n<h4 id=\"（2）React-dom\"><a href=\"#（2）React-dom\" class=\"headerlink\" title=\"（2）React-dom\"></a>（2）React-dom</h4><p>提供一些 DOM 操作方法，用于把 React 创建出来的 React 对象 挂载到真正的 html DOM 中，或者从 HTML DOM 中卸载，作用类似于 Vue 的 mount</p>\n<h2 id=\"二、React-组件-和-JSX\"><a href=\"#二、React-组件-和-JSX\" class=\"headerlink\" title=\"二、React 组件 和 JSX\"></a>二、React 组件 和 JSX</h2><h3 id=\"1、组件分类\"><a href=\"#1、组件分类\" class=\"headerlink\" title=\"1、组件分类\"></a>1、组件分类</h3><h4 id=\"（1）函数组件\"><a href=\"#（1）函数组件\" class=\"headerlink\" title=\"（1）函数组件\"></a>（1）函数组件</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Hello</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>hello<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"class-组件（老版本）\"><a href=\"#class-组件（老版本）\" class=\"headerlink\" title=\"class 组件（老版本）\"></a>class 组件（老版本）</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Hello</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">render</span> () &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>hello<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、JSX-特点\"><a href=\"#2、JSX-特点\" class=\"headerlink\" title=\"2、JSX 特点\"></a>2、JSX 特点</h3><h4 id=\"（1）直接在-JS-中混用\"><a href=\"#（1）直接在-JS-中混用\" class=\"headerlink\" title=\"（1）直接在 JS 中混用\"></a>（1）直接在 JS 中混用</h4><p>React 项目利用 Babel 做了对 JS 的编译，所以能直接在 JS 里写 JSX</p>\n<h4 id=\"（2）写法接近-JS\"><a href=\"#（2）写法接近-JS\" class=\"headerlink\" title=\"（2）写法接近 JS\"></a>（2）写法接近 JS</h4><p>JSX 几乎和 JS 一样，不同点在于，可以在 JS 里写 HTML，且写在 JS 里的 HTML 最后会被编译成一个 JS 对象，也可以用 React 自带 createElement 创建这个对象</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">FnHello</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// return &lt;div&gt;hello&lt;/div&gt;</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title class_\">React</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>, [], <span class=\"string\">&quot;Hello&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3、JSX-里面渲染不同内容的区别\"><a href=\"#3、JSX-里面渲染不同内容的区别\" class=\"headerlink\" title=\"3、JSX 里面渲染不同内容的区别\"></a>3、JSX 里面渲染不同内容的区别</h3><p>（1）字符串、数字：直接渲染</p>\n<p>（2）对象：只能渲染 element 对象，否则会报错</p>\n<p>（3）数组：把数组中的每一项单独渲染</p>\n<p>（4）表达式：运行表达式</p>\n<p>（5）方法：无法渲染</p>\n<p>（6）布尔值，undifined, null：不渲染</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 新版本 - vue3 组合式 API</span></span><br><span class=\"line\">  <span class=\"comment\">// 首字母一定要大写，区分组件和方法</span></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">FnHello</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// return &lt;div&gt;hello&lt;/div&gt;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title class_\">React</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>, [], <span class=\"string\">&quot;Hello&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 老版本 - vue2 选项式 API</span></span><br><span class=\"line\">  <span class=\"keyword\">class</span> <span class=\"title class_\">ClassHello</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">super</span>(props)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>hello class<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;FnHello&quot;</span>, <span class=\"title class_\">FnHello</span>) <span class=\"comment\">// 方法</span></span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;&lt;FnHello/&gt;&quot;</span>, <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">FnHello</span>/&gt;</span></span>) <span class=\"comment\">// React element（虚拟 DOM）</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">let</span> eleObj = <span class=\"title class_\">FnHello</span>()</span><br><span class=\"line\">  <span class=\"keyword\">let</span> com1 = <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">ClassHello</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">ClassHello</span>&gt;</span></span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">let</span> obj = &#123; <span class=\"attr\">a</span>: <span class=\"number\">123</span> &#125;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> arr = [com1, <span class=\"number\">5</span>, <span class=\"string\">&#x27;abc&#x27;</span>]</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;App&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">FnHello</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">FnHello</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">ClassHello</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">ClassHello</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      -------</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;eleObj&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;com1&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      -------</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;&quot;Hello Str&quot;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;123&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* &#123;obj&#125; 报错 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* &#123;FnHello&#125; 报错 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;arr&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;1+2+3+4&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;true?<span class=\"tag\">&lt;<span class=\"name\">FnHello</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">FnHello</span>&gt;</span>:&#x27;123&#x27;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* &#123;false&#125; 不展示 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* &#123;undefined&#125; 不展示 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* &#123;null&#125; 不展示 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"三、React-的时事件绑定\"><a href=\"#三、React-的时事件绑定\" class=\"headerlink\" title=\"三、React 的时事件绑定\"></a>三、React 的时事件绑定</h2><h3 id=\"1、规则模式\"><a href=\"#1、规则模式\" class=\"headerlink\" title=\"1、规则模式\"></a>1、规则模式</h3><p>（1）类似于原生，on+方法名（首字母大写，为了和原生区分）</p>\n<p>（2）一定要赋值给事件一个方法</p>\n<h3 id=\"2、特别注意的问题\"><a href=\"#2、特别注意的问题\" class=\"headerlink\" title=\"2、特别注意的问题\"></a>2、特别注意的问题</h3><p>（1）不作处理的情况下，this 会指向 undefined</p>\n<p>（2）事件绑定的必须是一个方法，不要直接调用方法，否则只会在页面初次渲染时执行</p>\n<h3 id=\"3、事件绑定其他操作\"><a href=\"#3、事件绑定其他操作\" class=\"headerlink\" title=\"3、事件绑定其他操作\"></a>3、事件绑定其他操作</h3><p>（1）传递参数</p>\n<p>（2）获取事件对象</p>\n<p>（3）阻止默认行为，冒泡等</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 1、方法调用使用 bind 规定 this（可以）</span></span><br><span class=\"line\"><span class=\"comment\">   * 2、写成一个匿名箭头函数</span></span><br><span class=\"line\"><span class=\"comment\">   * 3、方法本身写成箭头函数（可以）</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"title function_\">f1</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;this&quot;</span>, <span class=\"variable language_\">this</span>) <span class=\"comment\">// 不用 bind 的话，默认指向 undefined</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  f2 = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;this&quot;</span>, <span class=\"variable language_\">this</span>) <span class=\"comment\">// 使用箭头函数</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">f3</span>(<span class=\"params\">a, b</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;a + b =&quot;</span>, a + b)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  f4 = <span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;a + b =&quot;</span>, a + b)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">f5</span>(<span class=\"params\">a</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;a&quot;</span>, a)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">f6</span>(<span class=\"params\">a, b, e</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 不是原生的事件对象（在 nativeEvent 中），而是合成的事件对象</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;e&quot;</span>, e)</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *     event.stopPropagation(); // 原生阻止冒泡</span></span><br><span class=\"line\"><span class=\"comment\">     *     event.preventDefault(); // 原生阻止默认</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    e.<span class=\"title function_\">stopPropagation</span>(); <span class=\"comment\">// 阻止冒泡</span></span><br><span class=\"line\">    e.<span class=\"title function_\">preventDefault</span>(); <span class=\"comment\">// 阻止默认</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;App&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">        console.log(1)</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#125;&#125;&gt;123<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;this.f1.bind(this)&#125;</span>&gt;</span>456<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;this.f2&#125;</span>&gt;</span>789<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 不能传方法的调用 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;this.f2()&#125;</span>&gt;</span>error<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 箭头函数改变 this 指向 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">        console.log(&quot;this&quot;, this)</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#125;&#125;&gt;匿名1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      </span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 普通函数不行 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;function</span> () &#123;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">console.log</span>(&quot;<span class=\"attr\">this</span>&quot;, <span class=\"attr\">this</span>)</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">      &#125;&#125;&gt;</span>匿名2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 事件传参 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 1、普通函数.bind() + 普通函数 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;this.f3.bind(this,</span> <span class=\"attr\">1</span>, <span class=\"attr\">2</span>)&#125;&gt;</span>传参1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 2、箭头函数 + 箭头函数 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.f4(1, 2)&#125;&gt;传参2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 获取事件对象 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 1、不传参 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;this.f5.bind(this)&#125;</span>&gt;</span>事件1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 2、传参 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;this.f6.bind(this,</span> <span class=\"attr\">1</span>, <span class=\"attr\">2</span>)&#125;&gt;</span>事件2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"四、React-中的响应式数据\"><a href=\"#四、React-中的响应式数据\" class=\"headerlink\" title=\"四、React 中的响应式数据\"></a>四、React 中的响应式数据</h2><h3 id=\"1、类组件响应式数据\"><a href=\"#1、类组件响应式数据\" class=\"headerlink\" title=\"1、类组件响应式数据\"></a>1、类组件响应式数据</h3><p>响应式数据定义在类的 state 属性中</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">ClassState</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">super</span>(props)</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">state</span> = &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 这里写响应式数据，类似 vue 的 data 方法返回的对象</span></span><br><span class=\"line\">            <span class=\"attr\">a</span>: <span class=\"number\">123</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、React-响应式原理\"><a href=\"#2、React-响应式原理\" class=\"headerlink\" title=\"2、React 响应式原理\"></a>2、React 响应式原理</h3><p>（1）React 不能像 Vue 一样直接修改触发更新</p>\n<p>（2）React 修改能改值，但无法触发更新，因为 React 不像 Vue 监听了 get 和 set，而是在调用 setState 时调用 React 的更新操作</p>\n<h3 id=\"3、setState-关键点\"><a href=\"#3、setState-关键点\" class=\"headerlink\" title=\"3、setState 关键点\"></a>3、setState 关键点</h3><p>（1）通过浅合并来修改数据</p>\n<p>（2）调用 setState 方法会触发更新，修改 state 不会触发更新</p>\n<p>（3）setState 方法是异步的，如果要获取修改后的值，需要在 setState 的第二个参数里获取</p>\n<p>（4）setState 方法多次修改，会合并为一次，统一更新</p>\n<p>（5）setState 返回会触发更新，不管是否有修改，这导致：重复修改为相同的值也会让组件更新</p>\n<p>（6）一定不要在 render 里直接 setState</p>\n<h3 id=\"4、PureComponent-下对于对象和数组的修改\"><a href=\"#4、PureComponent-下对于对象和数组的修改\" class=\"headerlink\" title=\"4、PureComponent 下对于对象和数组的修改\"></a>4、PureComponent 下对于对象和数组的修改</h3><p>PureComponent 会根据 state 是否改变来决定是否更新，而对于对象、数组这种引用类型判断是否改变的原理是看内存地址，而不是内容</p>\n<p>因此在 PureComponent 下修改对象和数组，需要声明一个新对象赋值。所以一般不直接操作原对象，而是先拷贝一份，再进行操作</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 解决了普通 component 的一些问题，比如：更新为同一个值仍然重新渲染</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 老写法</span></span><br><span class=\"line\">  <span class=\"comment\">// constructor(props) &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//   super(props)</span></span><br><span class=\"line\">  <span class=\"comment\">//   this.state = &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//     ...</span></span><br><span class=\"line\">  <span class=\"comment\">//   &#125;</span></span><br><span class=\"line\">  <span class=\"comment\">// &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 新写法</span></span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    <span class=\"attr\">b</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"attr\">c</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">c1</span>: <span class=\"number\">123</span>,</span><br><span class=\"line\">      <span class=\"attr\">c2</span>: <span class=\"number\">999</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">arr</span>: [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  addA = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 常用</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">a</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">a</span> + <span class=\"number\">1</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 也可以更新</span></span><br><span class=\"line\">    <span class=\"comment\">// this.state.a += 1</span></span><br><span class=\"line\">    <span class=\"comment\">// this.setState(&#123;&#125;)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 函数形式，不常用</span></span><br><span class=\"line\">    <span class=\"comment\">// this.setState((state) =&gt; &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//   return &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     a: state.a + 1</span></span><br><span class=\"line\">    <span class=\"comment\">//   &#125;</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">a</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">a</span> + <span class=\"number\">1</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;this.state.a&quot;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">a</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  merge = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 浅合并，只合并外层</span></span><br><span class=\"line\">    <span class=\"comment\">// 为异步操作</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">a</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">      <span class=\"attr\">b</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">      <span class=\"attr\">c</span>: &#123;</span><br><span class=\"line\">        ...<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">c</span>,</span><br><span class=\"line\">        <span class=\"attr\">c1</span>: <span class=\"number\">9</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 回调中才能获取更新后的值</span></span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;this.state0&quot;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;this.state1&quot;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  refresh = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">a</span>: <span class=\"number\">1</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">b</span>: <span class=\"number\">2</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">// 以上等同于</span></span><br><span class=\"line\">    <span class=\"comment\">// Object.assign(this.state, &#123;a: 1&#125;, &#123;b: 2&#125;)</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 数组和对象，是通过内存地址判断是否改变的</span></span><br><span class=\"line\">  addArr = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> arr_ = [...<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">arr</span>]</span><br><span class=\"line\">    arr_.<span class=\"title function_\">push</span>(<span class=\"number\">4</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"comment\">// arr: this.state.arr</span></span><br><span class=\"line\">      <span class=\"attr\">arr</span>: arr_</span><br><span class=\"line\">    &#125;, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;this.state.arr&quot;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">arr</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">c</span>: &#123;</span><br><span class=\"line\">        ...<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">c</span>,</span><br><span class=\"line\">        <span class=\"attr\">c1</span>: <span class=\"number\">8888</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;this.state.c&quot;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">c</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">123</span>)</span><br><span class=\"line\">    <span class=\"comment\">// 不能在 render 中使用 this.setState，会死循环</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;App&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;this.state.a&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.addA()&#125;&gt;加1<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.merge()&#125;&gt;合并<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.refresh()&#125;&gt;更新<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;this.state.arr&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.addArr()&#125;&gt;数组增加<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"五、条件渲染和列表循环\"><a href=\"#五、条件渲染和列表循环\" class=\"headerlink\" title=\"五、条件渲染和列表循环\"></a>五、条件渲染和列表循环</h2><p>React 没有 Vue 一样的指令，一切操作本质上是通过运算生成不同的内容，再渲染得到不同的页面</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">show</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">originArr</span>: [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>] <span class=\"comment\">// [1, 2, 3] =&gt; [&lt;div&gt;1&lt;/div&gt;, &lt;div&gt;2&lt;/div&gt;, &lt;div&gt;3&lt;/div&gt;]</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">f1</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">show</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>div1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">getArr</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> newArr = []</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">originArr</span>.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      newArr.<span class=\"title function_\">push</span>(<span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;item&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;newArr&#x27;</span>, newArr)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> newArr</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  addData = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> _arr = [...<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">originArr</span>]</span><br><span class=\"line\">    _arr.<span class=\"title function_\">push</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"number\">10</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">originArr</span>: _arr</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;App&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>条件渲染<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* &#123;this.state.show ? <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>div1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>: &quot;&quot;&#125; */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;this.f1()&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">        this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          show: !this.state.show</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;)</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#125;&#125;&gt;&#123;this.state.show ? &quot;隐藏&quot; : &quot;显示&quot;&#125;<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>列表渲染<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* &#123; this.getArr() &#125; */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">        this.state.originArr.map((item) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          return <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">key</span>=<span class=\"string\">&#123;item&#125;</span>&gt;</span>&#123;item&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;)</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.addData()&#125;&gt;添加<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"六、表单绑定\"><a href=\"#六、表单绑定\" class=\"headerlink\" title=\"六、表单绑定\"></a>六、表单绑定</h2><p>React 中很多思路都是按原生的操作去做的，表单绑定也是如此</p>\n<p>原生表单获取表单输入值，可以通过监听 input、change 等事件，然后获取 e.target.value</p>\n<p>如果要设置表单的值，通常设置 value 属性，如果是选择框则是 checked 属性</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">inputValue</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">checkedArr</span>: [<span class=\"string\">&quot;c2&quot;</span>]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  handleChecked = <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> arr = [...<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">checkedArr</span>]</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(e.<span class=\"property\">target</span>.<span class=\"property\">checked</span>) &#123;</span><br><span class=\"line\">      arr.<span class=\"title function_\">push</span>(e.<span class=\"property\">target</span>.<span class=\"property\">value</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      arr.<span class=\"title function_\">splice</span>(arr.<span class=\"title function_\">indexOf</span>(e.<span class=\"property\">target</span>.<span class=\"property\">value</span>), <span class=\"number\">1</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">checkedArr</span>: arr</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;App&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">onBlur</span>=<span class=\"string\">&#123;&#125;</span> /&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">onChange</span>=<span class=\"string\">&#123;&#125;</span> /&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">value</span>=<span class=\"string\">&#123;this.state.inputValue&#125;</span> <span class=\"attr\">onInput</span>=<span class=\"string\">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">        this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          inputValue: e.target.value</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;)</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#125;&#125; /&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123; this.state.inputValue &#125;</span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* checkbox */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">checked</span>=<span class=\"string\">&#123;this.state.checkedArr.indexOf(</span>&quot;<span class=\"attr\">c1</span>&quot;)!==<span class=\"string\">-1&#125;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;c1&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;choose&quot;</span> <span class=\"attr\">onChange</span>=<span class=\"string\">&#123;this.handleChecked&#125;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">checked</span>=<span class=\"string\">&#123;this.state.checkedArr.indexOf(</span>&quot;<span class=\"attr\">c2</span>&quot;)!==<span class=\"string\">-1&#125;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;c2&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;choose&quot;</span> <span class=\"attr\">onChange</span>=<span class=\"string\">&#123;this.handleChecked&#125;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">checked</span>=<span class=\"string\">&#123;this.state.checkedArr.indexOf(</span>&quot;<span class=\"attr\">c3</span>&quot;)!==<span class=\"string\">-1&#125;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;c3&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;choose&quot;</span> <span class=\"attr\">onChange</span>=<span class=\"string\">&#123;this.handleChecked&#125;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123; this.state.checkedArr &#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"七、props-和组件间传值、插槽\"><a href=\"#七、props-和组件间传值、插槽\" class=\"headerlink\" title=\"七、props 和组件间传值、插槽\"></a>七、props 和组件间传值、插槽</h2><p>props 是 React 中的核心，一切写在组件上的属性和子节点都被划为 props</p>\n<p>React 父子传值，插槽全都基于 props，不像 Vue 有事件监听、emit、专门的插槽 这类东西</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./Son&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"comment\">// msg: 123 // 抛出类型错误</span></span><br><span class=\"line\">    <span class=\"attr\">msg</span>: <span class=\"string\">&quot;app message&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  changeMsg = <span class=\"function\">(<span class=\"params\">sonMsg</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;sonMsg&quot;</span>, sonMsg)</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">msg</span>: sonMsg</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;App&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      I&#x27;m App.</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">br</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 具名插槽 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 在插槽中显示子组件内容 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* <span class=\"tag\">&lt;<span class=\"name\">Son</span> <span class=\"attr\">msg</span>=<span class=\"string\">&#123;this.state.msg&#125;</span> <span class=\"attr\">a</span>=<span class=\"string\">&#123;</span>&lt;<span class=\"attr\">div</span>&gt;</span>I&#x27;m slot2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>&#125; scopeslot=&#123;(scope) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">        return <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>scope: &#123;scope&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#125;&#125;&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>I&#x27;m slot<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">Son</span>&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">Son</span> <span class=\"attr\">msg</span>=<span class=\"string\">&#123;this.state.msg&#125;</span> <span class=\"attr\">changeMsg</span>=<span class=\"string\">&#123;this.changeMsg&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">Son</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Son.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> proptypes <span class=\"keyword\">from</span> <span class=\"string\">&quot;proptypes&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// constructor(props) &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     super(props)</span></span><br><span class=\"line\">    <span class=\"comment\">//     this.state = &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//         sonMsg: &quot;hello&quot;</span></span><br><span class=\"line\">    <span class=\"comment\">//     &#125;</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    state = &#123;</span><br><span class=\"line\">        <span class=\"attr\">sonMsg</span>: <span class=\"string\">&quot;son message&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// console.log(&quot;this.props&quot;, this.props)</span></span><br><span class=\"line\">        <span class=\"comment\">// return &lt;div&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">//     &#123;/* 具名插槽 */&#125;</span></span><br><span class=\"line\">        <span class=\"comment\">//     &#123;this.props.a&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//     &#123;&quot;this.props.msg: &quot; + this.props.msg&#125;</span></span><br><span class=\"line\">        <span class=\"comment\">//     &lt;br&gt;&lt;/br&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">//     &#123;&quot;this.state.sonMsg: &quot; + this.state.sonMsg&#125;</span></span><br><span class=\"line\">        <span class=\"comment\">//     &lt;br&gt;&lt;/br&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">//     I&#x27;m Son.</span></span><br><span class=\"line\">        <span class=\"comment\">//     &#123;this.props.children&#125;</span></span><br><span class=\"line\">        <span class=\"comment\">//     &#123;/* 在插槽中显示子组件内容 */&#125;</span></span><br><span class=\"line\">        <span class=\"comment\">//     &#123;this.props.scopeslot(this.state.sonMsg)&#125;</span></span><br><span class=\"line\">        <span class=\"comment\">// &lt;/div&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;this.props.msg&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.props.changeMsg(&quot;hello, father&quot;)&#125;&gt;修改<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Son.propTypes = &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//     msg: function(props) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//         if (typeof props.msg !== &quot;string&quot;) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//             throw new Error(&quot;msg must be a string&quot;)</span></span><br><span class=\"line\"><span class=\"comment\">//         &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//     &#125;</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br><span class=\"line\"><span class=\"comment\">// proptypes 库</span></span><br><span class=\"line\"><span class=\"title class_\">Son</span>.<span class=\"property\">propTypes</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">msg</span>: proptypes.<span class=\"property\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Son</span>.<span class=\"property\">defaultProps</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">msg</span>: <span class=\"string\">&quot;default&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Son</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"八、React-样式设置\"><a href=\"#八、React-样式设置\" class=\"headerlink\" title=\"八、React 样式设置\"></a>八、React 样式设置</h2><h3 id=\"1、class-类名设置\"><a href=\"#1、class-类名设置\" class=\"headerlink\" title=\"1、class 类名设置\"></a>1、class 类名设置</h3><p>（1）必须写为 className</p>\n<p>（2）类名和样式写在 css 文件里</p>\n<p>（3）必须接受一个字符串</p>\n<h3 id=\"2、style-内联\"><a href=\"#2、style-内联\" class=\"headerlink\" title=\"2、style 内联\"></a>2、style 内联</h3><p>不能像原生一样写成字符串，必须写成对象</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;./App.css&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./Son&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">msg</span>: <span class=\"string\">&quot;app message&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;father&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&#123;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        &#123;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">          <span class=\"attr\">background:</span> &quot;<span class=\"attr\">yellow</span>&quot;,</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">          <span class=\"attr\">fontSize:</span> &quot;<span class=\"attr\">25px</span>&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">      &#125;&gt;</span>father<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">Son</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Son</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Son.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> proptypes <span class=\"keyword\">from</span> <span class=\"string\">&quot;proptypes&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// import &quot;./Son.css&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> sonStyle <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Son.module.css&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// console.log(&quot;sonStyle&quot;, sonStyle)</span></span><br><span class=\"line\"><span class=\"comment\">// 组件名 - .module.css</span></span><br><span class=\"line\"><span class=\"comment\">// vue style scoped</span></span><br><span class=\"line\"><span class=\"comment\">// import classnames from &quot;classnames&quot; // 非模块化</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> classnames <span class=\"keyword\">from</span> <span class=\"string\">&quot;classnames/bind&quot;</span> <span class=\"comment\">// 模块化</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> bindClassnames = classnames.<span class=\"title function_\">bind</span>(sonStyle) <span class=\"comment\">// 模块化方法</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> str = <span class=\"title function_\">classnames</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">son</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">son1</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;str&quot;</span>, str)</span><br><span class=\"line\"><span class=\"comment\">// 更方便操作类名的库 - classnames</span></span><br><span class=\"line\"><span class=\"comment\">// 本质是生成一个字符串</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">    state = &#123;</span><br><span class=\"line\">        <span class=\"attr\">sonMsg</span>: <span class=\"string\">&quot;son message&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">hasSon1</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;/* 取出新的 class 名 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&#123;sonStyle.son</span> + &quot; &quot; + <span class=\"attr\">sonStyle.son1</span>&#125;&gt;</span>son1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            </span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;/* classnames 库 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;/* 非模块化 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&#123;classnames(&#123;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                <span class=\"attr\">son:</span> <span class=\"attr\">true</span>,</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                <span class=\"attr\">son1:</span> <span class=\"attr\">this.state.hasSon1</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            &#125;)&#125;&gt;</span>son2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;/* 模块化 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&#123;bindClassnames(&#123;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                <span class=\"attr\">son:</span> <span class=\"attr\">true</span>,</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                <span class=\"attr\">son1:</span> <span class=\"attr\">this.state.hasSon1</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            &#125;)&#125;&gt;</span>son3<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// proptypes 库</span></span><br><span class=\"line\"><span class=\"title class_\">Son</span>.<span class=\"property\">propTypes</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">msg</span>: proptypes.<span class=\"property\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Son</span>.<span class=\"property\">defaultProps</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">msg</span>: <span class=\"string\">&quot;default&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Son</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.css */</span></span><br><span class=\"line\"><span class=\"selector-class\">.father</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: red</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Son.module.css */</span></span><br><span class=\"line\"><span class=\"selector-class\">.son</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: blue</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.son1</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: bisque;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"九、React-生命周期\"><a href=\"#九、React-生命周期\" class=\"headerlink\" title=\"九、React 生命周期\"></a>九、React 生命周期</h2><h3 id=\"1、生命周期图示\"><a href=\"#1、生命周期图示\" class=\"headerlink\" title=\"1、生命周期图示\"></a>1、生命周期图示</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/56/1.png\"\n                      alt=\"图一\"\n                ></p>\n<h3 id=\"2、严格模式\"><a href=\"#2、严格模式\" class=\"headerlink\" title=\"2、严格模式\"></a>2、严格模式</h3><p>严格模式只在开发模式下生效，生产上线时会去除，作用如下：</p>\n<p>（1）检测危险操作（比如：使用已经废弃 api 和不推荐的 api）</p>\n<p>（2）把生命周期执行两次，来检测额外副作用（比如：render）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* index.js */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> root = <span class=\"title class_\">ReactDOM</span>.<span class=\"title function_\">createRoot</span>(<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;root&#x27;</span>));</span><br><span class=\"line\">root.<span class=\"title function_\">render</span>(</span><br><span class=\"line\">  <span class=\"comment\">// 严格模式</span></span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">App</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;/<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3、React-和-Vue-更新\"><a href=\"#3、React-和-Vue-更新\" class=\"headerlink\" title=\"3、React 和 Vue 更新\"></a>3、React 和 Vue 更新</h3><h4 id=\"（1）Vue\"><a href=\"#（1）Vue\" class=\"headerlink\" title=\"（1）Vue\"></a>（1）Vue</h4><p>Vue 是在 get 和 set 里触发更新，在 get 部分会进行依赖收集的操作</p>\n<p>在更改数据后，只会更新用到该数据的地方，做到最小的更新范围</p>\n<h4 id=\"（2）React\"><a href=\"#（2）React\" class=\"headerlink\" title=\"（2）React\"></a>（2）React</h4><p>React 的更新是调用方法时触发的，没有依赖收集的过程</p>\n<p>所以会更新整个组件树、同时更新子组件，即使更新的数据和子组件没有关系</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;./App.css&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./Son&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">super</span>(props)</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">state</span> = &#123;</span><br><span class=\"line\">      <span class=\"attr\">msg</span>: <span class=\"string\">&quot;app message&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;constructor&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// derived 派生的</span></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"title function_\">getDerivedStateFromProps</span>(<span class=\"params\">props, state</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;derived&quot;</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;derived-props&quot;</span>, props)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;derived-state&quot;</span>, state)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 优化生命周期（只能在 React.Component 中使用，因为 PureComponent 已经实现了）</span></span><br><span class=\"line\">  <span class=\"title function_\">shouldComponentUpdate</span>(<span class=\"params\">props, state</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;shouldUpdate&quot;</span>)</span><br><span class=\"line\">    <span class=\"comment\">// console.log(&quot;shouldUpdate-props&quot;, props)</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;shouldUpdate-this.state 修改前&quot;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;shouldUpdate-state 修改后&quot;</span>, state)</span><br><span class=\"line\">    <span class=\"comment\">// 实现 PureComponent 优化</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> item <span class=\"keyword\">in</span> <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>[item] != state[item]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 一定不要修改数据</span></span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;render&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;father&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;this.state.msg&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">            msg: &quot;hello&quot;</span></span><br><span class=\"line\"><span class=\"language-xml\">          &#125;)</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;&gt;修改msg<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">Son</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Son</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 类似 Vue mounted</span></span><br><span class=\"line\">  <span class=\"title function_\">componentDidMount</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;didMount&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 类似 Vue updated</span></span><br><span class=\"line\">  <span class=\"title function_\">componentDidUpdate</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;didUpdate&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 类似 Vue unmounted</span></span><br><span class=\"line\">  <span class=\"title function_\">componentWillUnmount</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;willUnmount&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Son.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> proptypes <span class=\"keyword\">from</span> <span class=\"string\">&quot;proptypes&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 如果使用 Component，父组件更新会导致子组件更新，即使子组件数组没变化</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">    state = &#123;</span><br><span class=\"line\">        <span class=\"attr\">sonMsg</span>: <span class=\"string\">&quot;son message&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">hasSon1</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;son render&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// proptypes 库</span></span><br><span class=\"line\"><span class=\"title class_\">Son</span>.<span class=\"property\">propTypes</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">msg</span>: proptypes.<span class=\"property\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Son</span>.<span class=\"property\">defaultProps</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">msg</span>: <span class=\"string\">&quot;default&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Son</span>;</span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"React2","date":"2025-01-24T06:49:10.000Z","_content":"\n## 十、实战-制作一个增删改查列表\n\n``` js\n/* App.js */\nimport \"./App.css\";\nimport React from \"react\";\nimport axios from \"axios\";\nimport Pop from \"./Pop\";\n\n// 状态列表\nlet arr = [\n  {\n    text: \"进行中\",\n    color: \"blue\",\n  },\n  {\n    text: \"已完成\",\n    color: \"green\",\n  },\n  {\n    text: \"已延期\",\n    color: \"red\",\n  },\n];\n\nclass App extends React.Component {\n  state = {\n    tableArr: [],\n    searchParams: {\n      dateValue: \"\",\n      nameValue: \"\",\n      statusValue: 0,\n    },\n    popForm: {\n      dateValue: \"\",\n      nameValue: \"\",\n      statusValue: 0,\n    },\n    popShow: false,\n    popTitle: undefined,\n    // confirmFn: undefined,\n  };\n\n  componentDidMount() {\n    this.getList();\n  }\n\n  // 查询列表\n  getList(params) {\n    axios({\n      url: \"http://localhost:8000/list\",\n      method: \"get\",\n      params,\n    }).then((res) => {\n      console.log(\"res\", res);\n      this.setState({\n        tableArr: res.data.data,\n      });\n    });\n  }\n\n  // 展示状态文字\n  showStatus(status) {\n    return (\n      <span\n        style={{\n          color: arr[status]?.color,\n        }}\n      >\n        {arr[status]?.text}\n      </span>\n    );\n  }\n\n  // 搜索\n  searchData() {\n    this.getList({\n      date: this.state.searchParams.dateValue,\n      name: this.state.searchParams.nameValue,\n      status: this.state.searchParams.statusValue,\n    });\n  }\n\n  // 重置\n  resetData() {\n    this.setState(\n      {\n        searchParams: {\n          dateValue: \"\",\n          nameValue: \"\",\n          statusValue: 0,\n        },\n      },\n      () => {\n        this.getList();\n      }\n    );\n  }\n\n  // 新增\n  addFn() {\n    axios({\n      url: \"http://localhost:8000/addOrder\",\n      method: \"post\",\n      data: this.state.popForm,\n    }).then((res) => {\n      console.log(\"addFn res\", res);\n      this.setState({\n        popShow: false,\n      });\n      this.getList();\n    });\n  }\n\n  // 编辑\n  updateFn() {\n    axios({\n      url: \"http://localhost:8000/updateOrder\",\n      method: \"post\",\n      data: this.state.popForm,\n    }).then((res) => {\n      console.log(\"updateFn res\", res);\n      this.setState({\n        popShow: false,\n        popForm: {\n          dateValue: \"\",\n          nameValue: \"\",\n          statusValue: 0,\n        },\n      });\n      this.getList();\n    });\n  }\n\n  // 删除\n  deleteFn(id) {\n    axios({\n      url: \"http://localhost:8000/updateOrder\",\n      method: \"post\",\n      data: {\n        id\n      },\n    }).then((res) => {\n      console.log(\"deleteFn res\", res);\n      this.getList();\n    });\n  }\n\n  render() {\n    return (\n      <div>\n        <div>\n          <label>日期</label>\n          <input\n            value={this.state.searchParams.dateValue}\n            onInput={(e) => {\n              this.setState({\n                searchParams: {\n                  ...this.state.searchParams,\n                  dateValue: e.target.value,\n                },\n              });\n            }}\n          />\n          <label>订单名</label>\n          <input\n            value={this.state.searchParams.nameValue}\n            onInput={(e) => {\n              this.setState({\n                searchParams: {\n                  ...this.state.searchParams,\n                  nameValue: e.target.value,\n                },\n              });\n            }}\n          />\n          <label>订单状态</label>\n          <select\n            value={this.state.searchParams.statusValue}\n            onChange={(e) => {\n              this.setState({\n                searchParams: {\n                  ...this.state.searchParams,\n                  statusValue: e.target.value,\n                },\n              });\n            }}\n          >\n            {arr.map((item, index) => {\n              return (\n                <option value={index} key={index}>\n                  {item.text}\n                </option>\n              );\n            })}\n          </select>\n          <button onClick={() => this.searchData()}>搜索</button>\n          <button onClick={() => this.resetData()}>重置</button>\n        </div>\n\n        {/* 新增按钮 */}\n        <div>\n          <button\n            onClick={() => {\n              this.setState({\n                popShow: true,\n                popTitle: \"新增\",\n                // confirmFn: this.addFn.bind(this),\n              });\n            }}\n          >\n            新增\n          </button>\n        </div>\n\n        {/* 表格 */}\n        <table>\n          <thead>\n            <tr>\n              <td>日期</td>\n              <td>订单名</td>\n              <td>订单状态</td>\n              <td>操作</td>\n            </tr>\n          </thead>\n          <tbody>\n            {this.state.tableArr.map((item) => {\n              return (\n                <tr key={item.id}>\n                  <td>{item.date}</td>\n                  <td>{item.name}</td>\n                  <td>{this.showStatus(item.status)}</td>\n                  <td>\n                    <button\n                      onClick={() => {\n                        this.setState({\n                          popShow: true,\n                          popTitle: \"编辑\",\n                          popForm: {\n                            dateValue: item.date,\n                            nameValue: item.name,\n                            statusValue: item.status,\n                          },\n                          // confirmFn: this.updateFn.bind(this)\n                        });\n                      }}\n                    >\n                      编辑\n                    </button>\n                    <button onClick={() => this.deleteFn(item.id)}>删除</button>\n                  </td>\n                </tr>\n              );\n            })}\n          </tbody>\n        </table>\n\n        {/* 弹窗 */}\n        {this.state.popShow ? (\n          <Pop\n            title={this.state.popTitle}\n            confirm={\n              this.state.popTitle === \"新增\"\n                ? this.addFn.bind(this)\n                : this.updateFn.bind(this)\n            }\n            cancel={() => {\n              this.setState({\n                popShow: false,\n              });\n            }}\n          >\n            <div>\n              <div>\n                <label>日期</label>\n                <input\n                  value={this.state.popForm.dateValue}\n                  onInput={(e) => {\n                    this.setState({\n                      popForm: {\n                        ...this.state.popForm,\n                        dateValue: e.target.value,\n                      },\n                    });\n                  }}\n                />\n              </div>\n              <div>\n                <label>订单名</label>\n                <input\n                  value={this.state.popForm.nameValue}\n                  onInput={(e) => {\n                    this.setState({\n                      popForm: {\n                        ...this.state.popForm,\n                        nameValue: e.target.value,\n                      },\n                    });\n                  }}\n                />\n              </div>\n              <div>\n                <label>状态</label>\n                <select\n                  value={this.state.popForm.statusValue}\n                  onChange={(e) => {\n                    this.setState({\n                      popForm: {\n                        ...this.state.popForm,\n                        statusValue: e.target.value,\n                      },\n                    });\n                  }}\n                >\n                  {arr.map((item, index) => {\n                    return (\n                      <option value={index} key={index}>\n                        {item.text}\n                      </option>\n                    );\n                  })}\n                </select>\n              </div>\n            </div>\n          </Pop>\n        ) : null}\n      </div>\n    );\n  }\n}\n\nexport default App;\n```\n\n``` js\n/* Pop.js */\nimport React from \"react\";\nimport popStyle from \"./Pop.module.css\";\n\nclass Pop extends React.PureComponent {\n  render() {\n    return (\n      <div className={popStyle.cover}>\n        <div className={popStyle.content}>\n          <div className={popStyle.title}>\n            {/* {this.props.title ? this.props.title : \"标题\"} */}\n            {this.props.title}\n          </div>\n          {/* <div>{this.props.content}</div> */}\n          <div>{this.props.children}</div>\n          <div>\n            <button onClick={() => this.props.confirm()}>确定</button>\n            <button onClick={() => this.props.cancel()}>取消</button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nPop.defaultProps = {\n  title: \"标题\",\n};\n\nexport default Pop;\n```\n\n``` css\n/* Pop.module.css */\n.cover {\n    position: fixed;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    background-color: rgba(0, 0, 0, 0.6);\n}\n\n.content {\n    width: 500px;\n    margin: 200px auto;\n    background-color: #fff;\n}\n\n.title {\n    padding: 30px;\n    border-bottom: 1px solid #000;\n}\n```\n\n## 十一、ref 和 context\n\n### 1、ref\n\n用于获取真实 DOM，和 Vue 中的 ref 类似，注意：\n\n（1）ref 必须在挂载后才能获取，通常在 componentDidMount\n\n（2）ref 只能获取类组件，不能获取函数组件\n\n### 2、context\n\n类似 Vue 的 provider 和 injected，用于嵌套很深的爷孙组件之间传值，注意：\n\n子组件使用父组件创建的 context 对象，不能自己创建\n\n``` js\n/* App.js */\nimport React from \"react\";\nimport Son from \"./Son\";\n\nlet div1 = React.createRef()\nlet sonComp = React.createRef();\n\n// 是一个组件\nexport let Context1 = React.createContext();\n\nclass App extends React.PureComponent {\n  state = {\n    msg: \"父组件\",\n    passMsg: \"传递消息\"\n  }\n\n  // div1 = React.createRef()\n\n  componentDidMount() {\n    // 真实 DOM\n    console.log(\"div1.current\", div1.current)\n    // \n    console.log(\"sonComp.current\", sonComp.current)\n  }\n\n  render() {\n    return (\n      // 类似 Vue 中的 template\n      <>\n        <div className=\"App\" ref={div1}>{this.state.msg}</div>\n        \n        {/* 只能使用 value 这一个 props */}\n        <Context1.Provider value={this.state.passMsg}>\n          <Son ref={sonComp}></Son>\n        </Context1.Provider>\n      </>\n    );\n  }\n}\n\nexport default App;\n```\n\n``` js\n/* Son.js */\nimport React from \"react\";\nimport GrandSon from \"./GrandSon\";\n\nclass Son extends React.PureComponent {\n  state = {\n    sonMsg: \"子组件\",\n  };\n\n  render() {\n    return (\n      <>\n        <div className=\"Son\">{this.state.sonMsg}</div>\n        <GrandSon></GrandSon>\n      </>\n    );\n  }\n}\n\nexport default Son;\n```\n\n``` js\n/* GrandSon.js */\nimport React from \"react\";\nimport { Context1 } from \"./App\";\n\nclass GrandSon extends React.PureComponent {\n  state = {\n    grandsonMsg: \"孙子组件\",\n  };\n\n  render() {\n    return (\n      <>\n        <div className=\"Son\">{this.state.grandsonMsg}</div>\n        <Context1.Consumer>\n          {\n            (value) => {\n              console.log(value);\n              return <div>{value}</div>\n            }\n          }\n        </Context1.Consumer>\n      </>\n    );\n  }\n}\n\nexport default GrandSon;\n```\n\n## 十二、函数组件 和 hook\n\n### 1、函数组件和类组件的区别\n\n（1）函数组件没有生命周期\n\n（2）函数组件没有 this\n\n（3）函数组件通过 hook 来完成各种操作\n\n（4）函数组件本身的函数体相当于 render 函数\n\n（5）props 在函数的第一个参数接受\n\n### 2、useEffect()\n\n不传第二个参数 = componentDidMount 和 componentDidUpdate\n\n第二个参数传空数组 = componentDidMount\n\n第二个参数数组里放某个数据 = watch 监听\n\n### 3、useMemo()\n\n让一段计算在开始运行一次，后续只有依赖的数据发生变化时才重新运算，作用：\n\n（1）类似于 Vue 的一个计算属性的效果\n\n（2）缓存一个数据，让其不会重新创建\n\n### 4、 useCallback()\n\n缓存一个方法，让方法不会每次更新都重新创建\n\n### 5、其他 hooks\n\nuseRef：函数组件中使用 ref\n\nuseContext：更方便解析 context 的 provider 的数据\n\n``` js\n/* App.js */\nimport Son from \"./Son\";\n// vue3 - ref, reactive\nimport { useState, useEffect, useMemo, useCallback, useRef, createContext } from \"react\";\n\nexport let Context1 = createContext();\n\nfunction App() {\n  // 相当于 render\n  // return 的内容相当于组件的 html\n  let [msg, setMsg] = useState(\"hello\");\n  let [msg2, setMsg2] = useState(\"hello2\");\n  let [arr, setArr] = useState([1, 2, 3]);\n  let dom1 = useRef();\n\n  // 想要第二次更新不会运行，第二个参数需要传监听的数组\n  let all = useMemo(() => {\n    console.log(\"recount\");\n    let _all = 0;\n    arr.forEach((item) => {\n      _all += item;\n    });\n    return _all;\n  }, [arr]);\n\n  // useEffect, useMemo, useCallback 第二个参数的作用一样\n  let changeMsg = useCallback(() => {\n    setMsg(\"1\");\n  }, []);\n\n  function changeArr() {\n    let _arr = [...arr];\n    _arr.push(4);\n    setArr(_arr);\n  }\n\n  // // 第一个参数是回调函数 - 必填\n  // // 不传第二个参数 = componentDidMount 和 componentDidUpdate\n  // useEffect(() => {\n  //   console.log(\"effect\")\n  // })\n\n  // // 第二个参数传空数组 = componentDidMount\n  // useEffect(() => {\n  //   console.log(\"effect\")\n  // }, [])\n\n  // 第二个参数传非空数组 = watch 监听\n  // 一开始就会执行\n  useEffect(() => {\n    console.log(\"effect\");\n  }, [msg]);\n\n  useEffect(() => {\n    console.log(\"dom1\", dom1);\n  }, []);\n\n  return (\n    <>\n      <div>this is App</div>\n      <div>{msg}</div>\n      <div>{msg2}</div>\n      <div>{all}</div>\n      <div>{arr}</div>\n      <button ref={dom1} onClick={changeMsg}>\n        修改msg\n      </button>\n      <button\n        onClick={() => {\n          setMsg2(\"2\");\n        }}\n      >\n        修改msg2\n      </button>\n      <button onClick={changeArr}>修改arr</button>\n      <Context1.Provider value=\"I'm context msg\">\n        <Son fatherMsg=\"I'm father\"></Son>\n      </Context1.Provider>\n    </>\n  );\n}\n\nexport default App;\n```\n\n``` js\n/* Son.js */\nimport { useContext } from \"react\";\nimport { Context1 } from \"./App\";\n\nfunction Son(props) {\n  console.log(\"props\", props);\n  let value = useContext(Context1);\n  console.log(\"value\", value);\n  return <div>this is son</div>;\n}\n\nexport default Son;\n```\n\n## 十三、高阶组件\n\n如果是 UI 内容和操作的复用是使用组件，但如果是单纯逻辑的复用，可以使用高阶组件\n\n可以类比于 Vue 中的 Mixin 和自定义指令\n\n### 什么时候用高阶组件\n\n#### （1）组件\n\n组件既包含了 UI 界面的复用，也包含了逻辑的复用\n\n#### （2）高阶组件\n\n高阶组件只是复用操作逻辑、运算。类似 Vue 中 Mixin 的用途\n\n``` js\n/* App.js */\nimport { useState } from \"react\";\nimport Son from \"./Son\";\n// import TestHoc from \"./TestHoc\";\nimport MemoHoc from \"./MemoHoc\";\n\n// let HocSon = TestHoc(Son);\nlet MemoSon = MemoHoc(Son);\n\nfunction App() {\n  let [num, setNum] = useState(0);\n  return (\n    <>\n      {/* 鼠标位置监听 */}\n      {/* <HocSon></HocSon> */}\n\n      <MemoSon></MemoSon>\n\n      <div>num: {num}</div>\n      <button\n        onClick={() => {\n          setNum(1);\n        }}\n      >\n        修改数字\n      </button>\n    </>\n  );\n}\n\nexport default App;\n```\n\n``` js\n/* TestHoc.js */\nimport React from \"react\";\n\n// 抛出一个 返回匿名类组件的方法\n// 复用了其中的 state 数据 和 fn1 方法\nexport default function TestHoc(UserComp) {\n  return class extends React.PureComponent {\n    state = {\n    //   a: 123,\n      x: 0,\n      y: 0,\n    };\n\n    // fn1 = () => {\n    //     console.log(\"this.state.a\", this.state.a)\n    // }\n\n    componentDidMount() {\n      window.addEventListener(\"mousemove\", (e) => {\n        let x = e.clientX;\n        let y = e.clientY;\n        this.setState({\n          x,\n          y,\n        });\n      });\n    }\n\n    render() {\n      return (\n        <>\n          {/* <UserComp f1={this.fn1} {...this.props} /> */}\n\n          {/* 鼠标位置监听 */}\n          <UserComp x={this.state.x} y={this.state.y} {...this.props} />\n        </>\n      );\n    }\n  };\n}\n```\n\n``` js\n/* MemoHoc.js */\nimport React from \"react\";\n\nexport default function MemoHoc(UserComp) {\n  return class extends React.Component {\n    shouldComponentUpdate(props, state) {\n        for(let item in props) {\n            if(this.props[item] !== props[item]) {\n                return true;\n            }\n        }\n        for(let item in state) {\n            if(this.state[item] !== state[item]) {\n                return true;\n            }\n        }\n        return false\n    }\n\n    render() {\n      return (\n        <>\n          <UserComp {...this.props}></UserComp>\n        </>\n      );\n    }\n  };\n}\n```\n\n``` js\n/* Son.js */\nfunction Son(props) {\n  // props.f1()\n  console.log(\"son render\");\n  return (\n    <>\n      <div>高阶组件的使用</div>\n\n      {/* 鼠标位置监听 */}\n      {/* <div>x: {props.x}</div>\n      <div>y: {props.y}</div> */}\n    </>\n  );\n}\n\nexport default Son;\n```\n\n## 十四、React 性能优化\n\n### 1、React 性能问题\n\nReact 最大的性能问题就是：某个组件的更新 会连带其子组件一起更新，所以需要：\n\n（1）源码层面上尽量弥补这个问题\n\n（2）让子组件只做合理的更新\n\n### 2、React 时间切片\n\nVue 有依赖收集，做到了最小的更新范围\n\n而 React 没有，所以 React 要更新，会有大量的 diff 算法比对和计算工作，可能会阻塞浏览器的工作，导致页面长时间白屏\n\nReact 为解决该问题选择了一种策略——时间切片，也就是先计算一部分更新，接着让渡给渲染进程渲染，然后再进行下一步更新\n\n![图一](../images//57/1.png)\n\n为支持这种切片，React 设计了数据结构 fiber\n\n每个组件会被转化为一个 fiber 结构的对象，组成一个个单元，并且能够恢复上次中断的计算进度\n\n![图二](../images//57/2.png)\n\n### 3、减少无意义的组件更新\n\n（1）避免父组件数据更改导致子组件更新\n\n类组件：PureComponent，函数组件：React.memo\n\n（2）避免 state 的导致的无畏更新\n\n类组件：PureComponent，函数组件：本来就会判断\n\n（3）props\n\n如果组件使用了 PureComponent 或者 React.Memo，已经做到了如果父组件传的 props 没变，就不会更新\n\n但需要特别注意父组件传入的引用数据类型：方法、对象、数组\n\n- 用 useCallback 包裹传给子组件的方法\n- 非 state 对象、数组数据，要用 useMemo 包裹\n\n\n``` js\n/* App.js */\nimport { useMemo, useCallback } from \"react\";\nimport Son from \"./Son\";\n// React.memo 也是一种高阶函数\nlet MemoSon = React.memo(Son);\n\nfunction App() {\n  // 内部数据更新 -> App 组件更新 -> 重新执行 App 函数 -> 重新定义 obj 和 f1 -> 更新 MemoSon 子组件\n  // let obj = {\n  //     a: 1\n  // }\n  let obj = useMemo(() => {\n    return {\n      a: 1,\n    };\n  }, []);\n  // function f1() {\n  //     console.log(123)\n  // }\n  let f1 = useCallback(() => {\n    console.log(123);\n  }, []);\n  return (\n    <>\n      <MemoSon obj={obj} f1={f1}></MemoSon>\n    </>\n  );\n}\n```\n","source":"_posts/57-React2.md","raw":"---\ntitle: React2\ndate: 2025-01-24 14:49:10\ntags:\n    - React\ncategories:\n    - React\n      - 基础课程\n---\n\n## 十、实战-制作一个增删改查列表\n\n``` js\n/* App.js */\nimport \"./App.css\";\nimport React from \"react\";\nimport axios from \"axios\";\nimport Pop from \"./Pop\";\n\n// 状态列表\nlet arr = [\n  {\n    text: \"进行中\",\n    color: \"blue\",\n  },\n  {\n    text: \"已完成\",\n    color: \"green\",\n  },\n  {\n    text: \"已延期\",\n    color: \"red\",\n  },\n];\n\nclass App extends React.Component {\n  state = {\n    tableArr: [],\n    searchParams: {\n      dateValue: \"\",\n      nameValue: \"\",\n      statusValue: 0,\n    },\n    popForm: {\n      dateValue: \"\",\n      nameValue: \"\",\n      statusValue: 0,\n    },\n    popShow: false,\n    popTitle: undefined,\n    // confirmFn: undefined,\n  };\n\n  componentDidMount() {\n    this.getList();\n  }\n\n  // 查询列表\n  getList(params) {\n    axios({\n      url: \"http://localhost:8000/list\",\n      method: \"get\",\n      params,\n    }).then((res) => {\n      console.log(\"res\", res);\n      this.setState({\n        tableArr: res.data.data,\n      });\n    });\n  }\n\n  // 展示状态文字\n  showStatus(status) {\n    return (\n      <span\n        style={{\n          color: arr[status]?.color,\n        }}\n      >\n        {arr[status]?.text}\n      </span>\n    );\n  }\n\n  // 搜索\n  searchData() {\n    this.getList({\n      date: this.state.searchParams.dateValue,\n      name: this.state.searchParams.nameValue,\n      status: this.state.searchParams.statusValue,\n    });\n  }\n\n  // 重置\n  resetData() {\n    this.setState(\n      {\n        searchParams: {\n          dateValue: \"\",\n          nameValue: \"\",\n          statusValue: 0,\n        },\n      },\n      () => {\n        this.getList();\n      }\n    );\n  }\n\n  // 新增\n  addFn() {\n    axios({\n      url: \"http://localhost:8000/addOrder\",\n      method: \"post\",\n      data: this.state.popForm,\n    }).then((res) => {\n      console.log(\"addFn res\", res);\n      this.setState({\n        popShow: false,\n      });\n      this.getList();\n    });\n  }\n\n  // 编辑\n  updateFn() {\n    axios({\n      url: \"http://localhost:8000/updateOrder\",\n      method: \"post\",\n      data: this.state.popForm,\n    }).then((res) => {\n      console.log(\"updateFn res\", res);\n      this.setState({\n        popShow: false,\n        popForm: {\n          dateValue: \"\",\n          nameValue: \"\",\n          statusValue: 0,\n        },\n      });\n      this.getList();\n    });\n  }\n\n  // 删除\n  deleteFn(id) {\n    axios({\n      url: \"http://localhost:8000/updateOrder\",\n      method: \"post\",\n      data: {\n        id\n      },\n    }).then((res) => {\n      console.log(\"deleteFn res\", res);\n      this.getList();\n    });\n  }\n\n  render() {\n    return (\n      <div>\n        <div>\n          <label>日期</label>\n          <input\n            value={this.state.searchParams.dateValue}\n            onInput={(e) => {\n              this.setState({\n                searchParams: {\n                  ...this.state.searchParams,\n                  dateValue: e.target.value,\n                },\n              });\n            }}\n          />\n          <label>订单名</label>\n          <input\n            value={this.state.searchParams.nameValue}\n            onInput={(e) => {\n              this.setState({\n                searchParams: {\n                  ...this.state.searchParams,\n                  nameValue: e.target.value,\n                },\n              });\n            }}\n          />\n          <label>订单状态</label>\n          <select\n            value={this.state.searchParams.statusValue}\n            onChange={(e) => {\n              this.setState({\n                searchParams: {\n                  ...this.state.searchParams,\n                  statusValue: e.target.value,\n                },\n              });\n            }}\n          >\n            {arr.map((item, index) => {\n              return (\n                <option value={index} key={index}>\n                  {item.text}\n                </option>\n              );\n            })}\n          </select>\n          <button onClick={() => this.searchData()}>搜索</button>\n          <button onClick={() => this.resetData()}>重置</button>\n        </div>\n\n        {/* 新增按钮 */}\n        <div>\n          <button\n            onClick={() => {\n              this.setState({\n                popShow: true,\n                popTitle: \"新增\",\n                // confirmFn: this.addFn.bind(this),\n              });\n            }}\n          >\n            新增\n          </button>\n        </div>\n\n        {/* 表格 */}\n        <table>\n          <thead>\n            <tr>\n              <td>日期</td>\n              <td>订单名</td>\n              <td>订单状态</td>\n              <td>操作</td>\n            </tr>\n          </thead>\n          <tbody>\n            {this.state.tableArr.map((item) => {\n              return (\n                <tr key={item.id}>\n                  <td>{item.date}</td>\n                  <td>{item.name}</td>\n                  <td>{this.showStatus(item.status)}</td>\n                  <td>\n                    <button\n                      onClick={() => {\n                        this.setState({\n                          popShow: true,\n                          popTitle: \"编辑\",\n                          popForm: {\n                            dateValue: item.date,\n                            nameValue: item.name,\n                            statusValue: item.status,\n                          },\n                          // confirmFn: this.updateFn.bind(this)\n                        });\n                      }}\n                    >\n                      编辑\n                    </button>\n                    <button onClick={() => this.deleteFn(item.id)}>删除</button>\n                  </td>\n                </tr>\n              );\n            })}\n          </tbody>\n        </table>\n\n        {/* 弹窗 */}\n        {this.state.popShow ? (\n          <Pop\n            title={this.state.popTitle}\n            confirm={\n              this.state.popTitle === \"新增\"\n                ? this.addFn.bind(this)\n                : this.updateFn.bind(this)\n            }\n            cancel={() => {\n              this.setState({\n                popShow: false,\n              });\n            }}\n          >\n            <div>\n              <div>\n                <label>日期</label>\n                <input\n                  value={this.state.popForm.dateValue}\n                  onInput={(e) => {\n                    this.setState({\n                      popForm: {\n                        ...this.state.popForm,\n                        dateValue: e.target.value,\n                      },\n                    });\n                  }}\n                />\n              </div>\n              <div>\n                <label>订单名</label>\n                <input\n                  value={this.state.popForm.nameValue}\n                  onInput={(e) => {\n                    this.setState({\n                      popForm: {\n                        ...this.state.popForm,\n                        nameValue: e.target.value,\n                      },\n                    });\n                  }}\n                />\n              </div>\n              <div>\n                <label>状态</label>\n                <select\n                  value={this.state.popForm.statusValue}\n                  onChange={(e) => {\n                    this.setState({\n                      popForm: {\n                        ...this.state.popForm,\n                        statusValue: e.target.value,\n                      },\n                    });\n                  }}\n                >\n                  {arr.map((item, index) => {\n                    return (\n                      <option value={index} key={index}>\n                        {item.text}\n                      </option>\n                    );\n                  })}\n                </select>\n              </div>\n            </div>\n          </Pop>\n        ) : null}\n      </div>\n    );\n  }\n}\n\nexport default App;\n```\n\n``` js\n/* Pop.js */\nimport React from \"react\";\nimport popStyle from \"./Pop.module.css\";\n\nclass Pop extends React.PureComponent {\n  render() {\n    return (\n      <div className={popStyle.cover}>\n        <div className={popStyle.content}>\n          <div className={popStyle.title}>\n            {/* {this.props.title ? this.props.title : \"标题\"} */}\n            {this.props.title}\n          </div>\n          {/* <div>{this.props.content}</div> */}\n          <div>{this.props.children}</div>\n          <div>\n            <button onClick={() => this.props.confirm()}>确定</button>\n            <button onClick={() => this.props.cancel()}>取消</button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nPop.defaultProps = {\n  title: \"标题\",\n};\n\nexport default Pop;\n```\n\n``` css\n/* Pop.module.css */\n.cover {\n    position: fixed;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    background-color: rgba(0, 0, 0, 0.6);\n}\n\n.content {\n    width: 500px;\n    margin: 200px auto;\n    background-color: #fff;\n}\n\n.title {\n    padding: 30px;\n    border-bottom: 1px solid #000;\n}\n```\n\n## 十一、ref 和 context\n\n### 1、ref\n\n用于获取真实 DOM，和 Vue 中的 ref 类似，注意：\n\n（1）ref 必须在挂载后才能获取，通常在 componentDidMount\n\n（2）ref 只能获取类组件，不能获取函数组件\n\n### 2、context\n\n类似 Vue 的 provider 和 injected，用于嵌套很深的爷孙组件之间传值，注意：\n\n子组件使用父组件创建的 context 对象，不能自己创建\n\n``` js\n/* App.js */\nimport React from \"react\";\nimport Son from \"./Son\";\n\nlet div1 = React.createRef()\nlet sonComp = React.createRef();\n\n// 是一个组件\nexport let Context1 = React.createContext();\n\nclass App extends React.PureComponent {\n  state = {\n    msg: \"父组件\",\n    passMsg: \"传递消息\"\n  }\n\n  // div1 = React.createRef()\n\n  componentDidMount() {\n    // 真实 DOM\n    console.log(\"div1.current\", div1.current)\n    // \n    console.log(\"sonComp.current\", sonComp.current)\n  }\n\n  render() {\n    return (\n      // 类似 Vue 中的 template\n      <>\n        <div className=\"App\" ref={div1}>{this.state.msg}</div>\n        \n        {/* 只能使用 value 这一个 props */}\n        <Context1.Provider value={this.state.passMsg}>\n          <Son ref={sonComp}></Son>\n        </Context1.Provider>\n      </>\n    );\n  }\n}\n\nexport default App;\n```\n\n``` js\n/* Son.js */\nimport React from \"react\";\nimport GrandSon from \"./GrandSon\";\n\nclass Son extends React.PureComponent {\n  state = {\n    sonMsg: \"子组件\",\n  };\n\n  render() {\n    return (\n      <>\n        <div className=\"Son\">{this.state.sonMsg}</div>\n        <GrandSon></GrandSon>\n      </>\n    );\n  }\n}\n\nexport default Son;\n```\n\n``` js\n/* GrandSon.js */\nimport React from \"react\";\nimport { Context1 } from \"./App\";\n\nclass GrandSon extends React.PureComponent {\n  state = {\n    grandsonMsg: \"孙子组件\",\n  };\n\n  render() {\n    return (\n      <>\n        <div className=\"Son\">{this.state.grandsonMsg}</div>\n        <Context1.Consumer>\n          {\n            (value) => {\n              console.log(value);\n              return <div>{value}</div>\n            }\n          }\n        </Context1.Consumer>\n      </>\n    );\n  }\n}\n\nexport default GrandSon;\n```\n\n## 十二、函数组件 和 hook\n\n### 1、函数组件和类组件的区别\n\n（1）函数组件没有生命周期\n\n（2）函数组件没有 this\n\n（3）函数组件通过 hook 来完成各种操作\n\n（4）函数组件本身的函数体相当于 render 函数\n\n（5）props 在函数的第一个参数接受\n\n### 2、useEffect()\n\n不传第二个参数 = componentDidMount 和 componentDidUpdate\n\n第二个参数传空数组 = componentDidMount\n\n第二个参数数组里放某个数据 = watch 监听\n\n### 3、useMemo()\n\n让一段计算在开始运行一次，后续只有依赖的数据发生变化时才重新运算，作用：\n\n（1）类似于 Vue 的一个计算属性的效果\n\n（2）缓存一个数据，让其不会重新创建\n\n### 4、 useCallback()\n\n缓存一个方法，让方法不会每次更新都重新创建\n\n### 5、其他 hooks\n\nuseRef：函数组件中使用 ref\n\nuseContext：更方便解析 context 的 provider 的数据\n\n``` js\n/* App.js */\nimport Son from \"./Son\";\n// vue3 - ref, reactive\nimport { useState, useEffect, useMemo, useCallback, useRef, createContext } from \"react\";\n\nexport let Context1 = createContext();\n\nfunction App() {\n  // 相当于 render\n  // return 的内容相当于组件的 html\n  let [msg, setMsg] = useState(\"hello\");\n  let [msg2, setMsg2] = useState(\"hello2\");\n  let [arr, setArr] = useState([1, 2, 3]);\n  let dom1 = useRef();\n\n  // 想要第二次更新不会运行，第二个参数需要传监听的数组\n  let all = useMemo(() => {\n    console.log(\"recount\");\n    let _all = 0;\n    arr.forEach((item) => {\n      _all += item;\n    });\n    return _all;\n  }, [arr]);\n\n  // useEffect, useMemo, useCallback 第二个参数的作用一样\n  let changeMsg = useCallback(() => {\n    setMsg(\"1\");\n  }, []);\n\n  function changeArr() {\n    let _arr = [...arr];\n    _arr.push(4);\n    setArr(_arr);\n  }\n\n  // // 第一个参数是回调函数 - 必填\n  // // 不传第二个参数 = componentDidMount 和 componentDidUpdate\n  // useEffect(() => {\n  //   console.log(\"effect\")\n  // })\n\n  // // 第二个参数传空数组 = componentDidMount\n  // useEffect(() => {\n  //   console.log(\"effect\")\n  // }, [])\n\n  // 第二个参数传非空数组 = watch 监听\n  // 一开始就会执行\n  useEffect(() => {\n    console.log(\"effect\");\n  }, [msg]);\n\n  useEffect(() => {\n    console.log(\"dom1\", dom1);\n  }, []);\n\n  return (\n    <>\n      <div>this is App</div>\n      <div>{msg}</div>\n      <div>{msg2}</div>\n      <div>{all}</div>\n      <div>{arr}</div>\n      <button ref={dom1} onClick={changeMsg}>\n        修改msg\n      </button>\n      <button\n        onClick={() => {\n          setMsg2(\"2\");\n        }}\n      >\n        修改msg2\n      </button>\n      <button onClick={changeArr}>修改arr</button>\n      <Context1.Provider value=\"I'm context msg\">\n        <Son fatherMsg=\"I'm father\"></Son>\n      </Context1.Provider>\n    </>\n  );\n}\n\nexport default App;\n```\n\n``` js\n/* Son.js */\nimport { useContext } from \"react\";\nimport { Context1 } from \"./App\";\n\nfunction Son(props) {\n  console.log(\"props\", props);\n  let value = useContext(Context1);\n  console.log(\"value\", value);\n  return <div>this is son</div>;\n}\n\nexport default Son;\n```\n\n## 十三、高阶组件\n\n如果是 UI 内容和操作的复用是使用组件，但如果是单纯逻辑的复用，可以使用高阶组件\n\n可以类比于 Vue 中的 Mixin 和自定义指令\n\n### 什么时候用高阶组件\n\n#### （1）组件\n\n组件既包含了 UI 界面的复用，也包含了逻辑的复用\n\n#### （2）高阶组件\n\n高阶组件只是复用操作逻辑、运算。类似 Vue 中 Mixin 的用途\n\n``` js\n/* App.js */\nimport { useState } from \"react\";\nimport Son from \"./Son\";\n// import TestHoc from \"./TestHoc\";\nimport MemoHoc from \"./MemoHoc\";\n\n// let HocSon = TestHoc(Son);\nlet MemoSon = MemoHoc(Son);\n\nfunction App() {\n  let [num, setNum] = useState(0);\n  return (\n    <>\n      {/* 鼠标位置监听 */}\n      {/* <HocSon></HocSon> */}\n\n      <MemoSon></MemoSon>\n\n      <div>num: {num}</div>\n      <button\n        onClick={() => {\n          setNum(1);\n        }}\n      >\n        修改数字\n      </button>\n    </>\n  );\n}\n\nexport default App;\n```\n\n``` js\n/* TestHoc.js */\nimport React from \"react\";\n\n// 抛出一个 返回匿名类组件的方法\n// 复用了其中的 state 数据 和 fn1 方法\nexport default function TestHoc(UserComp) {\n  return class extends React.PureComponent {\n    state = {\n    //   a: 123,\n      x: 0,\n      y: 0,\n    };\n\n    // fn1 = () => {\n    //     console.log(\"this.state.a\", this.state.a)\n    // }\n\n    componentDidMount() {\n      window.addEventListener(\"mousemove\", (e) => {\n        let x = e.clientX;\n        let y = e.clientY;\n        this.setState({\n          x,\n          y,\n        });\n      });\n    }\n\n    render() {\n      return (\n        <>\n          {/* <UserComp f1={this.fn1} {...this.props} /> */}\n\n          {/* 鼠标位置监听 */}\n          <UserComp x={this.state.x} y={this.state.y} {...this.props} />\n        </>\n      );\n    }\n  };\n}\n```\n\n``` js\n/* MemoHoc.js */\nimport React from \"react\";\n\nexport default function MemoHoc(UserComp) {\n  return class extends React.Component {\n    shouldComponentUpdate(props, state) {\n        for(let item in props) {\n            if(this.props[item] !== props[item]) {\n                return true;\n            }\n        }\n        for(let item in state) {\n            if(this.state[item] !== state[item]) {\n                return true;\n            }\n        }\n        return false\n    }\n\n    render() {\n      return (\n        <>\n          <UserComp {...this.props}></UserComp>\n        </>\n      );\n    }\n  };\n}\n```\n\n``` js\n/* Son.js */\nfunction Son(props) {\n  // props.f1()\n  console.log(\"son render\");\n  return (\n    <>\n      <div>高阶组件的使用</div>\n\n      {/* 鼠标位置监听 */}\n      {/* <div>x: {props.x}</div>\n      <div>y: {props.y}</div> */}\n    </>\n  );\n}\n\nexport default Son;\n```\n\n## 十四、React 性能优化\n\n### 1、React 性能问题\n\nReact 最大的性能问题就是：某个组件的更新 会连带其子组件一起更新，所以需要：\n\n（1）源码层面上尽量弥补这个问题\n\n（2）让子组件只做合理的更新\n\n### 2、React 时间切片\n\nVue 有依赖收集，做到了最小的更新范围\n\n而 React 没有，所以 React 要更新，会有大量的 diff 算法比对和计算工作，可能会阻塞浏览器的工作，导致页面长时间白屏\n\nReact 为解决该问题选择了一种策略——时间切片，也就是先计算一部分更新，接着让渡给渲染进程渲染，然后再进行下一步更新\n\n![图一](../images//57/1.png)\n\n为支持这种切片，React 设计了数据结构 fiber\n\n每个组件会被转化为一个 fiber 结构的对象，组成一个个单元，并且能够恢复上次中断的计算进度\n\n![图二](../images//57/2.png)\n\n### 3、减少无意义的组件更新\n\n（1）避免父组件数据更改导致子组件更新\n\n类组件：PureComponent，函数组件：React.memo\n\n（2）避免 state 的导致的无畏更新\n\n类组件：PureComponent，函数组件：本来就会判断\n\n（3）props\n\n如果组件使用了 PureComponent 或者 React.Memo，已经做到了如果父组件传的 props 没变，就不会更新\n\n但需要特别注意父组件传入的引用数据类型：方法、对象、数组\n\n- 用 useCallback 包裹传给子组件的方法\n- 非 state 对象、数组数据，要用 useMemo 包裹\n\n\n``` js\n/* App.js */\nimport { useMemo, useCallback } from \"react\";\nimport Son from \"./Son\";\n// React.memo 也是一种高阶函数\nlet MemoSon = React.memo(Son);\n\nfunction App() {\n  // 内部数据更新 -> App 组件更新 -> 重新执行 App 函数 -> 重新定义 obj 和 f1 -> 更新 MemoSon 子组件\n  // let obj = {\n  //     a: 1\n  // }\n  let obj = useMemo(() => {\n    return {\n      a: 1,\n    };\n  }, []);\n  // function f1() {\n  //     console.log(123)\n  // }\n  let f1 = useCallback(() => {\n    console.log(123);\n  }, []);\n  return (\n    <>\n      <MemoSon obj={obj} f1={f1}></MemoSon>\n    </>\n  );\n}\n```\n","slug":"57-React2","published":1,"updated":"2025-05-20T04:36:34.107Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvuf00506kpr1kp49ham","content":"<h2 id=\"十、实战-制作一个增删改查列表\"><a href=\"#十、实战-制作一个增删改查列表\" class=\"headerlink\" title=\"十、实战-制作一个增删改查列表\"></a>十、实战-制作一个增删改查列表</h2><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;./App.css&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> axios <span class=\"keyword\">from</span> <span class=\"string\">&quot;axios&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Pop</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Pop&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 状态列表</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> arr = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">text</span>: <span class=\"string\">&quot;进行中&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">color</span>: <span class=\"string\">&quot;blue&quot;</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">text</span>: <span class=\"string\">&quot;已完成&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">color</span>: <span class=\"string\">&quot;green&quot;</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">text</span>: <span class=\"string\">&quot;已延期&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">color</span>: <span class=\"string\">&quot;red&quot;</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">tableArr</span>: [],</span><br><span class=\"line\">    <span class=\"attr\">searchParams</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">dateValue</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">nameValue</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">statusValue</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">popForm</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">dateValue</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">nameValue</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">statusValue</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">popShow</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">popTitle</span>: <span class=\"literal\">undefined</span>,</span><br><span class=\"line\">    <span class=\"comment\">// confirmFn: undefined,</span></span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">componentDidMount</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">getList</span>();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 查询列表</span></span><br><span class=\"line\">  <span class=\"title function_\">getList</span>(<span class=\"params\">params</span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">axios</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">url</span>: <span class=\"string\">&quot;http://localhost:8000/list&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">method</span>: <span class=\"string\">&quot;get&quot;</span>,</span><br><span class=\"line\">      params,</span><br><span class=\"line\">    &#125;).<span class=\"title function_\">then</span>(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;res&quot;</span>, res);</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">tableArr</span>: res.<span class=\"property\">data</span>.<span class=\"property\">data</span>,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 展示状态文字</span></span><br><span class=\"line\">  <span class=\"title function_\">showStatus</span>(<span class=\"params\">status</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">span</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">style</span>=<span class=\"string\">&#123;&#123;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">          <span class=\"attr\">color:</span> <span class=\"attr\">arr</span>[<span class=\"attr\">status</span>]?<span class=\"attr\">.color</span>,</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        &#125;&#125;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">      &gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        &#123;arr[status]?.text&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 搜索</span></span><br><span class=\"line\">  <span class=\"title function_\">searchData</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">getList</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">date</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">searchParams</span>.<span class=\"property\">dateValue</span>,</span><br><span class=\"line\">      <span class=\"attr\">name</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">searchParams</span>.<span class=\"property\">nameValue</span>,</span><br><span class=\"line\">      <span class=\"attr\">status</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">searchParams</span>.<span class=\"property\">statusValue</span>,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 重置</span></span><br><span class=\"line\">  <span class=\"title function_\">resetData</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">searchParams</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">dateValue</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">          <span class=\"attr\">nameValue</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">          <span class=\"attr\">statusValue</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">getList</span>();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 新增</span></span><br><span class=\"line\">  <span class=\"title function_\">addFn</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">axios</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">url</span>: <span class=\"string\">&quot;http://localhost:8000/addOrder&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">method</span>: <span class=\"string\">&quot;post&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">data</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">popForm</span>,</span><br><span class=\"line\">    &#125;).<span class=\"title function_\">then</span>(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;addFn res&quot;</span>, res);</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">popShow</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">getList</span>();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 编辑</span></span><br><span class=\"line\">  <span class=\"title function_\">updateFn</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">axios</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">url</span>: <span class=\"string\">&quot;http://localhost:8000/updateOrder&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">method</span>: <span class=\"string\">&quot;post&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">data</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">popForm</span>,</span><br><span class=\"line\">    &#125;).<span class=\"title function_\">then</span>(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;updateFn res&quot;</span>, res);</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">popShow</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"attr\">popForm</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">dateValue</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">          <span class=\"attr\">nameValue</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">          <span class=\"attr\">statusValue</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">getList</span>();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 删除</span></span><br><span class=\"line\">  <span class=\"title function_\">deleteFn</span>(<span class=\"params\">id</span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">axios</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">url</span>: <span class=\"string\">&quot;http://localhost:8000/updateOrder&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">method</span>: <span class=\"string\">&quot;post&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">data</span>: &#123;</span><br><span class=\"line\">        id</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;).<span class=\"title function_\">then</span>(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;deleteFn res&quot;</span>, res);</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">getList</span>();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>日期<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">input</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">value</span>=<span class=\"string\">&#123;this.state.searchParams.dateValue&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">onInput</span>=<span class=\"string\">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">              this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                searchParams: &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                  ...this.state.searchParams,</span></span><br><span class=\"line\"><span class=\"language-xml\">                  dateValue: e.target.value,</span></span><br><span class=\"line\"><span class=\"language-xml\">                &#125;,</span></span><br><span class=\"line\"><span class=\"language-xml\">              &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          /&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>订单名<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">input</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">value</span>=<span class=\"string\">&#123;this.state.searchParams.nameValue&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">onInput</span>=<span class=\"string\">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">              this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                searchParams: &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                  ...this.state.searchParams,</span></span><br><span class=\"line\"><span class=\"language-xml\">                  nameValue: e.target.value,</span></span><br><span class=\"line\"><span class=\"language-xml\">                &#125;,</span></span><br><span class=\"line\"><span class=\"language-xml\">              &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          /&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>订单状态<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">select</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">value</span>=<span class=\"string\">&#123;this.state.searchParams.statusValue&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">onChange</span>=<span class=\"string\">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">              this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                searchParams: &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                  ...this.state.searchParams,</span></span><br><span class=\"line\"><span class=\"language-xml\">                  statusValue: e.target.value,</span></span><br><span class=\"line\"><span class=\"language-xml\">                &#125;,</span></span><br><span class=\"line\"><span class=\"language-xml\">              &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;arr.map((item, index) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">              return (</span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">value</span>=<span class=\"string\">&#123;index&#125;</span> <span class=\"attr\">key</span>=<span class=\"string\">&#123;index&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                  &#123;item.text&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              );</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#125;)&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.searchData()&#125;&gt;搜索<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.resetData()&#125;&gt;重置<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">        &#123;/* 新增按钮 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">              this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                popShow: true,</span></span><br><span class=\"line\"><span class=\"language-xml\">                popTitle: &quot;新增&quot;,</span></span><br><span class=\"line\"><span class=\"language-xml\">                // confirmFn: this.addFn.bind(this),</span></span><br><span class=\"line\"><span class=\"language-xml\">              &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">            新增</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">        &#123;/* 表格 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">thead</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>日期<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>订单名<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>订单状态<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>操作<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;/<span class=\"name\">thead</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">tbody</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;this.state.tableArr.map((item) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">              return (</span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">tr</span> <span class=\"attr\">key</span>=<span class=\"string\">&#123;item.id&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                  <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;item.date&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                  <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;item.name&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                  <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;this.showStatus(item.status)&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                  <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                      <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                        this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                          popShow: true,</span></span><br><span class=\"line\"><span class=\"language-xml\">                          popTitle: &quot;编辑&quot;,</span></span><br><span class=\"line\"><span class=\"language-xml\">                          popForm: &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                            dateValue: item.date,</span></span><br><span class=\"line\"><span class=\"language-xml\">                            nameValue: item.name,</span></span><br><span class=\"line\"><span class=\"language-xml\">                            statusValue: item.status,</span></span><br><span class=\"line\"><span class=\"language-xml\">                          &#125;,</span></span><br><span class=\"line\"><span class=\"language-xml\">                          // confirmFn: this.updateFn.bind(this)</span></span><br><span class=\"line\"><span class=\"language-xml\">                        &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">                      &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">                    &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">                      编辑</span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.deleteFn(item.id)&#125;&gt;删除<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                  <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              );</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#125;)&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;/<span class=\"name\">tbody</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">        &#123;/* 弹窗 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#123;this.state.popShow ? (</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">Pop</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">title</span>=<span class=\"string\">&#123;this.state.popTitle&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">confirm</span>=<span class=\"string\">&#123;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">              <span class=\"attr\">this.state.popTitle</span> === <span class=\"string\">&quot;新增&quot;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                ? <span class=\"attr\">this.addFn.bind</span>(<span class=\"attr\">this</span>)</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                <span class=\"attr\">:</span> <span class=\"attr\">this.updateFn.bind</span>(<span class=\"attr\">this</span>)</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">cancel</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">              this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                popShow: false,</span></span><br><span class=\"line\"><span class=\"language-xml\">              &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>日期<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">input</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                  <span class=\"attr\">value</span>=<span class=\"string\">&#123;this.state.popForm.dateValue&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                  <span class=\"attr\">onInput</span>=<span class=\"string\">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                    this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                      popForm: &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                        ...this.state.popForm,</span></span><br><span class=\"line\"><span class=\"language-xml\">                        dateValue: e.target.value,</span></span><br><span class=\"line\"><span class=\"language-xml\">                      &#125;,</span></span><br><span class=\"line\"><span class=\"language-xml\">                    &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">                  &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">                /&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>订单名<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">input</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                  <span class=\"attr\">value</span>=<span class=\"string\">&#123;this.state.popForm.nameValue&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                  <span class=\"attr\">onInput</span>=<span class=\"string\">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                    this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                      popForm: &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                        ...this.state.popForm,</span></span><br><span class=\"line\"><span class=\"language-xml\">                        nameValue: e.target.value,</span></span><br><span class=\"line\"><span class=\"language-xml\">                      &#125;,</span></span><br><span class=\"line\"><span class=\"language-xml\">                    &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">                  &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">                /&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>状态<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">select</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                  <span class=\"attr\">value</span>=<span class=\"string\">&#123;this.state.popForm.statusValue&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                  <span class=\"attr\">onChange</span>=<span class=\"string\">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                    this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                      popForm: &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                        ...this.state.popForm,</span></span><br><span class=\"line\"><span class=\"language-xml\">                        statusValue: e.target.value,</span></span><br><span class=\"line\"><span class=\"language-xml\">                      &#125;,</span></span><br><span class=\"line\"><span class=\"language-xml\">                    &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">                  &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">                &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">                  &#123;arr.map((item, index) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                    return (</span></span><br><span class=\"line\"><span class=\"language-xml\">                      <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">value</span>=<span class=\"string\">&#123;index&#125;</span> <span class=\"attr\">key</span>=<span class=\"string\">&#123;index&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                        &#123;item.text&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">                      <span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    );</span></span><br><span class=\"line\"><span class=\"language-xml\">                  &#125;)&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;/<span class=\"name\">Pop</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        ) : null&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Pop.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> popStyle <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Pop.module.css&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Pop</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&#123;popStyle.cover&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&#123;popStyle.content&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&#123;popStyle.title&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;/* &#123;this.props.title ? this.props.title : &quot;标题&quot;&#125; */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;this.props.title&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          &#123;/* <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;this.props.content&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;this.props.children&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.props.confirm()&#125;&gt;确定<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.props.cancel()&#125;&gt;取消<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Pop</span>.<span class=\"property\">defaultProps</span> = &#123;</span><br><span class=\"line\">  <span class=\"attr\">title</span>: <span class=\"string\">&quot;标题&quot;</span>,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Pop</span>;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Css\"><figure class=\"iseeu highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Pop.module.css */</span></span><br><span class=\"line\"><span class=\"selector-class\">.cover</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">bottom</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">right</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.6</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">500px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">200px</span> auto;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#fff</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">30px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border-bottom</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#000</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"十一、ref-和-context\"><a href=\"#十一、ref-和-context\" class=\"headerlink\" title=\"十一、ref 和 context\"></a>十一、ref 和 context</h2><h3 id=\"1、ref\"><a href=\"#1、ref\" class=\"headerlink\" title=\"1、ref\"></a>1、ref</h3><p>用于获取真实 DOM，和 Vue 中的 ref 类似，注意：</p>\n<p>（1）ref 必须在挂载后才能获取，通常在 componentDidMount</p>\n<p>（2）ref 只能获取类组件，不能获取函数组件</p>\n<h3 id=\"2、context\"><a href=\"#2、context\" class=\"headerlink\" title=\"2、context\"></a>2、context</h3><p>类似 Vue 的 provider 和 injected，用于嵌套很深的爷孙组件之间传值，注意：</p>\n<p>子组件使用父组件创建的 context 对象，不能自己创建</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Son&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> div1 = <span class=\"title class_\">React</span>.<span class=\"title function_\">createRef</span>()</span><br><span class=\"line\"><span class=\"keyword\">let</span> sonComp = <span class=\"title class_\">React</span>.<span class=\"title function_\">createRef</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 是一个组件</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">let</span> <span class=\"title class_\">Context1</span> = <span class=\"title class_\">React</span>.<span class=\"title function_\">createContext</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">msg</span>: <span class=\"string\">&quot;父组件&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">passMsg</span>: <span class=\"string\">&quot;传递消息&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// div1 = React.createRef()</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">componentDidMount</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 真实 DOM</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;div1.current&quot;</span>, div1.<span class=\"property\">current</span>)</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;sonComp.current&quot;</span>, sonComp.<span class=\"property\">current</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"comment\">// 类似 Vue 中的 template</span></span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;App&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;div1&#125;</span>&gt;</span>&#123;this.state.msg&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        </span></span><br><span class=\"line\"><span class=\"language-xml\">        &#123;/* 只能使用 value 这一个 props */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">Context1.Provider</span> <span class=\"attr\">value</span>=<span class=\"string\">&#123;this.state.passMsg&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">Son</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;sonComp&#125;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Son</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">Context1.Provider</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Son.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">GrandSon</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./GrandSon&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">sonMsg</span>: <span class=\"string\">&quot;子组件&quot;</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;Son&quot;</span>&gt;</span>&#123;this.state.sonMsg&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">GrandSon</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">GrandSon</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Son</span>;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* GrandSon.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Context1</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;./App&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">GrandSon</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">grandsonMsg</span>: <span class=\"string\">&quot;孙子组件&quot;</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;Son&quot;</span>&gt;</span>&#123;this.state.grandsonMsg&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">Context1.Consumer</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">            (value) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">              console.log(value);</span></span><br><span class=\"line\"><span class=\"language-xml\">              return <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;value&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          &#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">Context1.Consumer</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">GrandSon</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"十二、函数组件-和-hook\"><a href=\"#十二、函数组件-和-hook\" class=\"headerlink\" title=\"十二、函数组件 和 hook\"></a>十二、函数组件 和 hook</h2><h3 id=\"1、函数组件和类组件的区别\"><a href=\"#1、函数组件和类组件的区别\" class=\"headerlink\" title=\"1、函数组件和类组件的区别\"></a>1、函数组件和类组件的区别</h3><p>（1）函数组件没有生命周期</p>\n<p>（2）函数组件没有 this</p>\n<p>（3）函数组件通过 hook 来完成各种操作</p>\n<p>（4）函数组件本身的函数体相当于 render 函数</p>\n<p>（5）props 在函数的第一个参数接受</p>\n<h3 id=\"2、useEffect\"><a href=\"#2、useEffect\" class=\"headerlink\" title=\"2、useEffect()\"></a>2、useEffect()</h3><p>不传第二个参数 &#x3D; componentDidMount 和 componentDidUpdate</p>\n<p>第二个参数传空数组 &#x3D; componentDidMount</p>\n<p>第二个参数数组里放某个数据 &#x3D; watch 监听</p>\n<h3 id=\"3、useMemo\"><a href=\"#3、useMemo\" class=\"headerlink\" title=\"3、useMemo()\"></a>3、useMemo()</h3><p>让一段计算在开始运行一次，后续只有依赖的数据发生变化时才重新运算，作用：</p>\n<p>（1）类似于 Vue 的一个计算属性的效果</p>\n<p>（2）缓存一个数据，让其不会重新创建</p>\n<h3 id=\"4、-useCallback\"><a href=\"#4、-useCallback\" class=\"headerlink\" title=\"4、 useCallback()\"></a>4、 useCallback()</h3><p>缓存一个方法，让方法不会每次更新都重新创建</p>\n<h3 id=\"5、其他-hooks\"><a href=\"#5、其他-hooks\" class=\"headerlink\" title=\"5、其他 hooks\"></a>5、其他 hooks</h3><p>useRef：函数组件中使用 ref</p>\n<p>useContext：更方便解析 context 的 provider 的数据</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Son&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">// vue3 - ref, reactive</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useState, useEffect, useMemo, useCallback, useRef, createContext &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">let</span> <span class=\"title class_\">Context1</span> = <span class=\"title function_\">createContext</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 相当于 render</span></span><br><span class=\"line\">  <span class=\"comment\">// return 的内容相当于组件的 html</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> [msg, setMsg] = <span class=\"title function_\">useState</span>(<span class=\"string\">&quot;hello&quot;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> [msg2, setMsg2] = <span class=\"title function_\">useState</span>(<span class=\"string\">&quot;hello2&quot;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> [arr, setArr] = <span class=\"title function_\">useState</span>([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> dom1 = <span class=\"title function_\">useRef</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 想要第二次更新不会运行，第二个参数需要传监听的数组</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> all = <span class=\"title function_\">useMemo</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;recount&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> _all = <span class=\"number\">0</span>;</span><br><span class=\"line\">    arr.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      _all += item;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _all;</span><br><span class=\"line\">  &#125;, [arr]);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// useEffect, useMemo, useCallback 第二个参数的作用一样</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> changeMsg = <span class=\"title function_\">useCallback</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">setMsg</span>(<span class=\"string\">&quot;1&quot;</span>);</span><br><span class=\"line\">  &#125;, []);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">changeArr</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> _arr = [...arr];</span><br><span class=\"line\">    _arr.<span class=\"title function_\">push</span>(<span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"title function_\">setArr</span>(_arr);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// // 第一个参数是回调函数 - 必填</span></span><br><span class=\"line\">  <span class=\"comment\">// // 不传第二个参数 = componentDidMount 和 componentDidUpdate</span></span><br><span class=\"line\">  <span class=\"comment\">// useEffect(() =&gt; &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//   console.log(&quot;effect&quot;)</span></span><br><span class=\"line\">  <span class=\"comment\">// &#125;)</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// // 第二个参数传空数组 = componentDidMount</span></span><br><span class=\"line\">  <span class=\"comment\">// useEffect(() =&gt; &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//   console.log(&quot;effect&quot;)</span></span><br><span class=\"line\">  <span class=\"comment\">// &#125;, [])</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 第二个参数传非空数组 = watch 监听</span></span><br><span class=\"line\">  <span class=\"comment\">// 一开始就会执行</span></span><br><span class=\"line\">  <span class=\"title function_\">useEffect</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;effect&quot;</span>);</span><br><span class=\"line\">  &#125;, [msg]);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">useEffect</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;dom1&quot;</span>, dom1);</span><br><span class=\"line\">  &#125;, []);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>this is App<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;msg&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;msg2&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;all&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;arr&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;dom1&#125;</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;changeMsg&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        修改msg</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          setMsg2(&quot;2&quot;);</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        修改msg2</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;changeArr&#125;</span>&gt;</span>修改arr<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">Context1.Provider</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;I&#x27;m context msg&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">Son</span> <span class=\"attr\">fatherMsg</span>=<span class=\"string\">&quot;I&#x27;m father&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Son</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">Context1.Provider</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Son.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useContext &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Context1</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;./App&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Son</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;props&quot;</span>, props);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> value = <span class=\"title function_\">useContext</span>(<span class=\"title class_\">Context1</span>);</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;value&quot;</span>, value);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>this is son<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Son</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"十三、高阶组件\"><a href=\"#十三、高阶组件\" class=\"headerlink\" title=\"十三、高阶组件\"></a>十三、高阶组件</h2><p>如果是 UI 内容和操作的复用是使用组件，但如果是单纯逻辑的复用，可以使用高阶组件</p>\n<p>可以类比于 Vue 中的 Mixin 和自定义指令</p>\n<h3 id=\"什么时候用高阶组件\"><a href=\"#什么时候用高阶组件\" class=\"headerlink\" title=\"什么时候用高阶组件\"></a>什么时候用高阶组件</h3><h4 id=\"（1）组件\"><a href=\"#（1）组件\" class=\"headerlink\" title=\"（1）组件\"></a>（1）组件</h4><p>组件既包含了 UI 界面的复用，也包含了逻辑的复用</p>\n<h4 id=\"（2）高阶组件\"><a href=\"#（2）高阶组件\" class=\"headerlink\" title=\"（2）高阶组件\"></a>（2）高阶组件</h4><p>高阶组件只是复用操作逻辑、运算。类似 Vue 中 Mixin 的用途</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useState &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Son&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">// import TestHoc from &quot;./TestHoc&quot;;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">MemoHoc</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./MemoHoc&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// let HocSon = TestHoc(Son);</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title class_\">MemoSon</span> = <span class=\"title class_\">MemoHoc</span>(<span class=\"title class_\">Son</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> [num, setNum] = <span class=\"title function_\">useState</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 鼠标位置监听 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* <span class=\"tag\">&lt;<span class=\"name\">HocSon</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">HocSon</span>&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">MemoSon</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">MemoSon</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>num: &#123;num&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          setNum(1);</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        修改数字</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* TestHoc.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 抛出一个 返回匿名类组件的方法</span></span><br><span class=\"line\"><span class=\"comment\">// 复用了其中的 state 数据 和 fn1 方法</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">function</span> <span class=\"title function_\">TestHoc</span>(<span class=\"params\">UserComp</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">class</span> <span class=\"title class_\">extends</span> <span class=\"title class_\">React</span>.<span class=\"property\">PureComponent</span> &#123;</span><br><span class=\"line\">    state = &#123;</span><br><span class=\"line\">    <span class=\"comment\">//   a: 123,</span></span><br><span class=\"line\">      <span class=\"attr\">x</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">y</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// fn1 = () =&gt; &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     console.log(&quot;this.state.a&quot;, this.state.a)</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">componentDidMount</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mousemove&quot;</span>, <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> x = e.<span class=\"property\">clientX</span>;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> y = e.<span class=\"property\">clientY</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">          x,</span><br><span class=\"line\">          y,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          &#123;/* <span class=\"tag\">&lt;<span class=\"name\">UserComp</span> <span class=\"attr\">f1</span>=<span class=\"string\">&#123;this.fn1&#125;</span> &#123;<span class=\"attr\">...this.props</span>&#125; /&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">          &#123;/* 鼠标位置监听 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">UserComp</span> <span class=\"attr\">x</span>=<span class=\"string\">&#123;this.state.x&#125;</span> <span class=\"attr\">y</span>=<span class=\"string\">&#123;this.state.y&#125;</span> &#123;<span class=\"attr\">...this.props</span>&#125; /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* MemoHoc.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">function</span> <span class=\"title function_\">MemoHoc</span>(<span class=\"params\">UserComp</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">class</span> <span class=\"title class_\">extends</span> <span class=\"title class_\">React</span>.<span class=\"property\">Component</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">shouldComponentUpdate</span>(<span class=\"params\">props, state</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> item <span class=\"keyword\">in</span> props) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">props</span>[item] !== props[item]) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> item <span class=\"keyword\">in</span> state) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>[item] !== state[item]) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">UserComp</span> &#123;<span class=\"attr\">...this.props</span>&#125;&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">UserComp</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Son.js */</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Son</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// props.f1()</span></span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;son render&quot;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>高阶组件的使用<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 鼠标位置监听 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>x: &#123;props.x&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>y: &#123;props.y&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Son</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"十四、React-性能优化\"><a href=\"#十四、React-性能优化\" class=\"headerlink\" title=\"十四、React 性能优化\"></a>十四、React 性能优化</h2><h3 id=\"1、React-性能问题\"><a href=\"#1、React-性能问题\" class=\"headerlink\" title=\"1、React 性能问题\"></a>1、React 性能问题</h3><p>React 最大的性能问题就是：某个组件的更新 会连带其子组件一起更新，所以需要：</p>\n<p>（1）源码层面上尽量弥补这个问题</p>\n<p>（2）让子组件只做合理的更新</p>\n<h3 id=\"2、React-时间切片\"><a href=\"#2、React-时间切片\" class=\"headerlink\" title=\"2、React 时间切片\"></a>2、React 时间切片</h3><p>Vue 有依赖收集，做到了最小的更新范围</p>\n<p>而 React 没有，所以 React 要更新，会有大量的 diff 算法比对和计算工作，可能会阻塞浏览器的工作，导致页面长时间白屏</p>\n<p>React 为解决该问题选择了一种策略——时间切片，也就是先计算一部分更新，接着让渡给渲染进程渲染，然后再进行下一步更新</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/57/1.png\"\n                      alt=\"图一\"\n                ></p>\n<p>为支持这种切片，React 设计了数据结构 fiber</p>\n<p>每个组件会被转化为一个 fiber 结构的对象，组成一个个单元，并且能够恢复上次中断的计算进度</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/57/2.png\"\n                      alt=\"图二\"\n                ></p>\n<h3 id=\"3、减少无意义的组件更新\"><a href=\"#3、减少无意义的组件更新\" class=\"headerlink\" title=\"3、减少无意义的组件更新\"></a>3、减少无意义的组件更新</h3><p>（1）避免父组件数据更改导致子组件更新</p>\n<p>类组件：PureComponent，函数组件：React.memo</p>\n<p>（2）避免 state 的导致的无畏更新</p>\n<p>类组件：PureComponent，函数组件：本来就会判断</p>\n<p>（3）props</p>\n<p>如果组件使用了 PureComponent 或者 React.Memo，已经做到了如果父组件传的 props 没变，就不会更新</p>\n<p>但需要特别注意父组件传入的引用数据类型：方法、对象、数组</p>\n<ul>\n<li>用 useCallback 包裹传给子组件的方法</li>\n<li>非 state 对象、数组数据，要用 useMemo 包裹</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useMemo, useCallback &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Son&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">// React.memo 也是一种高阶函数</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title class_\">MemoSon</span> = <span class=\"title class_\">React</span>.<span class=\"title function_\">memo</span>(<span class=\"title class_\">Son</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 内部数据更新 -&gt; App 组件更新 -&gt; 重新执行 App 函数 -&gt; 重新定义 obj 和 f1 -&gt; 更新 MemoSon 子组件</span></span><br><span class=\"line\">  <span class=\"comment\">// let obj = &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//     a: 1</span></span><br><span class=\"line\">  <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> obj = <span class=\"title function_\">useMemo</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"attr\">a</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;, []);</span><br><span class=\"line\">  <span class=\"comment\">// function f1() &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//     console.log(123)</span></span><br><span class=\"line\">  <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> f1 = <span class=\"title function_\">useCallback</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">123</span>);</span><br><span class=\"line\">  &#125;, []);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">MemoSon</span> <span class=\"attr\">obj</span>=<span class=\"string\">&#123;obj&#125;</span> <span class=\"attr\">f1</span>=<span class=\"string\">&#123;f1&#125;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">MemoSon</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"十、实战-制作一个增删改查列表\"><a href=\"#十、实战-制作一个增删改查列表\" class=\"headerlink\" title=\"十、实战-制作一个增删改查列表\"></a>十、实战-制作一个增删改查列表</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;./App.css&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> axios <span class=\"keyword\">from</span> <span class=\"string\">&quot;axios&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Pop</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Pop&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 状态列表</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> arr = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">text</span>: <span class=\"string\">&quot;进行中&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">color</span>: <span class=\"string\">&quot;blue&quot;</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">text</span>: <span class=\"string\">&quot;已完成&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">color</span>: <span class=\"string\">&quot;green&quot;</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">text</span>: <span class=\"string\">&quot;已延期&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">color</span>: <span class=\"string\">&quot;red&quot;</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.Component</span> &#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">tableArr</span>: [],</span><br><span class=\"line\">    <span class=\"attr\">searchParams</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">dateValue</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">nameValue</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">statusValue</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">popForm</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">dateValue</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">nameValue</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">statusValue</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">popShow</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">popTitle</span>: <span class=\"literal\">undefined</span>,</span><br><span class=\"line\">    <span class=\"comment\">// confirmFn: undefined,</span></span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">componentDidMount</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">getList</span>();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 查询列表</span></span><br><span class=\"line\">  <span class=\"title function_\">getList</span>(<span class=\"params\">params</span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">axios</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">url</span>: <span class=\"string\">&quot;http://localhost:8000/list&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">method</span>: <span class=\"string\">&quot;get&quot;</span>,</span><br><span class=\"line\">      params,</span><br><span class=\"line\">    &#125;).<span class=\"title function_\">then</span>(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;res&quot;</span>, res);</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">tableArr</span>: res.<span class=\"property\">data</span>.<span class=\"property\">data</span>,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 展示状态文字</span></span><br><span class=\"line\">  <span class=\"title function_\">showStatus</span>(<span class=\"params\">status</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">span</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">style</span>=<span class=\"string\">&#123;&#123;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">          <span class=\"attr\">color:</span> <span class=\"attr\">arr</span>[<span class=\"attr\">status</span>]?<span class=\"attr\">.color</span>,</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        &#125;&#125;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">      &gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        &#123;arr[status]?.text&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 搜索</span></span><br><span class=\"line\">  <span class=\"title function_\">searchData</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">getList</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">date</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">searchParams</span>.<span class=\"property\">dateValue</span>,</span><br><span class=\"line\">      <span class=\"attr\">name</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">searchParams</span>.<span class=\"property\">nameValue</span>,</span><br><span class=\"line\">      <span class=\"attr\">status</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">searchParams</span>.<span class=\"property\">statusValue</span>,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 重置</span></span><br><span class=\"line\">  <span class=\"title function_\">resetData</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">searchParams</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">dateValue</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">          <span class=\"attr\">nameValue</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">          <span class=\"attr\">statusValue</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">getList</span>();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 新增</span></span><br><span class=\"line\">  <span class=\"title function_\">addFn</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">axios</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">url</span>: <span class=\"string\">&quot;http://localhost:8000/addOrder&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">method</span>: <span class=\"string\">&quot;post&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">data</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">popForm</span>,</span><br><span class=\"line\">    &#125;).<span class=\"title function_\">then</span>(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;addFn res&quot;</span>, res);</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">popShow</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">getList</span>();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 编辑</span></span><br><span class=\"line\">  <span class=\"title function_\">updateFn</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">axios</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">url</span>: <span class=\"string\">&quot;http://localhost:8000/updateOrder&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">method</span>: <span class=\"string\">&quot;post&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">data</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">state</span>.<span class=\"property\">popForm</span>,</span><br><span class=\"line\">    &#125;).<span class=\"title function_\">then</span>(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;updateFn res&quot;</span>, res);</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">popShow</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"attr\">popForm</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">dateValue</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">          <span class=\"attr\">nameValue</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">          <span class=\"attr\">statusValue</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">getList</span>();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 删除</span></span><br><span class=\"line\">  <span class=\"title function_\">deleteFn</span>(<span class=\"params\">id</span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">axios</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">url</span>: <span class=\"string\">&quot;http://localhost:8000/updateOrder&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">method</span>: <span class=\"string\">&quot;post&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">data</span>: &#123;</span><br><span class=\"line\">        id</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;).<span class=\"title function_\">then</span>(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;deleteFn res&quot;</span>, res);</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">getList</span>();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>日期<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">input</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">value</span>=<span class=\"string\">&#123;this.state.searchParams.dateValue&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">onInput</span>=<span class=\"string\">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">              this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                searchParams: &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                  ...this.state.searchParams,</span></span><br><span class=\"line\"><span class=\"language-xml\">                  dateValue: e.target.value,</span></span><br><span class=\"line\"><span class=\"language-xml\">                &#125;,</span></span><br><span class=\"line\"><span class=\"language-xml\">              &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          /&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>订单名<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">input</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">value</span>=<span class=\"string\">&#123;this.state.searchParams.nameValue&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">onInput</span>=<span class=\"string\">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">              this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                searchParams: &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                  ...this.state.searchParams,</span></span><br><span class=\"line\"><span class=\"language-xml\">                  nameValue: e.target.value,</span></span><br><span class=\"line\"><span class=\"language-xml\">                &#125;,</span></span><br><span class=\"line\"><span class=\"language-xml\">              &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          /&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>订单状态<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">select</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">value</span>=<span class=\"string\">&#123;this.state.searchParams.statusValue&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">onChange</span>=<span class=\"string\">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">              this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                searchParams: &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                  ...this.state.searchParams,</span></span><br><span class=\"line\"><span class=\"language-xml\">                  statusValue: e.target.value,</span></span><br><span class=\"line\"><span class=\"language-xml\">                &#125;,</span></span><br><span class=\"line\"><span class=\"language-xml\">              &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;arr.map((item, index) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">              return (</span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">value</span>=<span class=\"string\">&#123;index&#125;</span> <span class=\"attr\">key</span>=<span class=\"string\">&#123;index&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                  &#123;item.text&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              );</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#125;)&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.searchData()&#125;&gt;搜索<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.resetData()&#125;&gt;重置<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">        &#123;/* 新增按钮 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">              this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                popShow: true,</span></span><br><span class=\"line\"><span class=\"language-xml\">                popTitle: &quot;新增&quot;,</span></span><br><span class=\"line\"><span class=\"language-xml\">                // confirmFn: this.addFn.bind(this),</span></span><br><span class=\"line\"><span class=\"language-xml\">              &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">            新增</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">        &#123;/* 表格 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">thead</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>日期<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>订单名<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>订单状态<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>操作<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;/<span class=\"name\">thead</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">tbody</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;this.state.tableArr.map((item) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">              return (</span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">tr</span> <span class=\"attr\">key</span>=<span class=\"string\">&#123;item.id&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                  <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;item.date&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                  <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;item.name&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                  <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;this.showStatus(item.status)&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                  <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                      <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                        this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                          popShow: true,</span></span><br><span class=\"line\"><span class=\"language-xml\">                          popTitle: &quot;编辑&quot;,</span></span><br><span class=\"line\"><span class=\"language-xml\">                          popForm: &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                            dateValue: item.date,</span></span><br><span class=\"line\"><span class=\"language-xml\">                            nameValue: item.name,</span></span><br><span class=\"line\"><span class=\"language-xml\">                            statusValue: item.status,</span></span><br><span class=\"line\"><span class=\"language-xml\">                          &#125;,</span></span><br><span class=\"line\"><span class=\"language-xml\">                          // confirmFn: this.updateFn.bind(this)</span></span><br><span class=\"line\"><span class=\"language-xml\">                        &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">                      &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">                    &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">                      编辑</span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.deleteFn(item.id)&#125;&gt;删除<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                  <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              );</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#125;)&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;/<span class=\"name\">tbody</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">        &#123;/* 弹窗 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#123;this.state.popShow ? (</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">Pop</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">title</span>=<span class=\"string\">&#123;this.state.popTitle&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">confirm</span>=<span class=\"string\">&#123;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">              <span class=\"attr\">this.state.popTitle</span> === <span class=\"string\">&quot;新增&quot;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                ? <span class=\"attr\">this.addFn.bind</span>(<span class=\"attr\">this</span>)</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                <span class=\"attr\">:</span> <span class=\"attr\">this.updateFn.bind</span>(<span class=\"attr\">this</span>)</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">            <span class=\"attr\">cancel</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">              this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                popShow: false,</span></span><br><span class=\"line\"><span class=\"language-xml\">              &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>日期<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">input</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                  <span class=\"attr\">value</span>=<span class=\"string\">&#123;this.state.popForm.dateValue&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                  <span class=\"attr\">onInput</span>=<span class=\"string\">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                    this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                      popForm: &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                        ...this.state.popForm,</span></span><br><span class=\"line\"><span class=\"language-xml\">                        dateValue: e.target.value,</span></span><br><span class=\"line\"><span class=\"language-xml\">                      &#125;,</span></span><br><span class=\"line\"><span class=\"language-xml\">                    &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">                  &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">                /&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>订单名<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">input</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                  <span class=\"attr\">value</span>=<span class=\"string\">&#123;this.state.popForm.nameValue&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                  <span class=\"attr\">onInput</span>=<span class=\"string\">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                    this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                      popForm: &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                        ...this.state.popForm,</span></span><br><span class=\"line\"><span class=\"language-xml\">                        nameValue: e.target.value,</span></span><br><span class=\"line\"><span class=\"language-xml\">                      &#125;,</span></span><br><span class=\"line\"><span class=\"language-xml\">                    &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">                  &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">                /&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>状态<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">select</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                  <span class=\"attr\">value</span>=<span class=\"string\">&#123;this.state.popForm.statusValue&#125;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">                  <span class=\"attr\">onChange</span>=<span class=\"string\">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                    this.setState(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                      popForm: &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                        ...this.state.popForm,</span></span><br><span class=\"line\"><span class=\"language-xml\">                        statusValue: e.target.value,</span></span><br><span class=\"line\"><span class=\"language-xml\">                      &#125;,</span></span><br><span class=\"line\"><span class=\"language-xml\">                    &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">                  &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">                &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">                  &#123;arr.map((item, index) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">                    return (</span></span><br><span class=\"line\"><span class=\"language-xml\">                      <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">value</span>=<span class=\"string\">&#123;index&#125;</span> <span class=\"attr\">key</span>=<span class=\"string\">&#123;index&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                        &#123;item.text&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">                      <span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    );</span></span><br><span class=\"line\"><span class=\"language-xml\">                  &#125;)&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;/<span class=\"name\">Pop</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        ) : null&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Pop.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> popStyle <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Pop.module.css&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Pop</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&#123;popStyle.cover&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&#123;popStyle.content&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&#123;popStyle.title&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;/* &#123;this.props.title ? this.props.title : &quot;标题&quot;&#125; */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;this.props.title&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          &#123;/* <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;this.props.content&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;this.props.children&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.props.confirm()&#125;&gt;确定<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> this.props.cancel()&#125;&gt;取消<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Pop</span>.<span class=\"property\">defaultProps</span> = &#123;</span><br><span class=\"line\">  <span class=\"attr\">title</span>: <span class=\"string\">&quot;标题&quot;</span>,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Pop</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Pop.module.css */</span></span><br><span class=\"line\"><span class=\"selector-class\">.cover</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">bottom</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">right</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.6</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">500px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">200px</span> auto;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#fff</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">30px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border-bottom</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#000</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"十一、ref-和-context\"><a href=\"#十一、ref-和-context\" class=\"headerlink\" title=\"十一、ref 和 context\"></a>十一、ref 和 context</h2><h3 id=\"1、ref\"><a href=\"#1、ref\" class=\"headerlink\" title=\"1、ref\"></a>1、ref</h3><p>用于获取真实 DOM，和 Vue 中的 ref 类似，注意：</p>\n<p>（1）ref 必须在挂载后才能获取，通常在 componentDidMount</p>\n<p>（2）ref 只能获取类组件，不能获取函数组件</p>\n<h3 id=\"2、context\"><a href=\"#2、context\" class=\"headerlink\" title=\"2、context\"></a>2、context</h3><p>类似 Vue 的 provider 和 injected，用于嵌套很深的爷孙组件之间传值，注意：</p>\n<p>子组件使用父组件创建的 context 对象，不能自己创建</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Son&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> div1 = <span class=\"title class_\">React</span>.<span class=\"title function_\">createRef</span>()</span><br><span class=\"line\"><span class=\"keyword\">let</span> sonComp = <span class=\"title class_\">React</span>.<span class=\"title function_\">createRef</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 是一个组件</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">let</span> <span class=\"title class_\">Context1</span> = <span class=\"title class_\">React</span>.<span class=\"title function_\">createContext</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">App</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">msg</span>: <span class=\"string\">&quot;父组件&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">passMsg</span>: <span class=\"string\">&quot;传递消息&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// div1 = React.createRef()</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">componentDidMount</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 真实 DOM</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;div1.current&quot;</span>, div1.<span class=\"property\">current</span>)</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;sonComp.current&quot;</span>, sonComp.<span class=\"property\">current</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"comment\">// 类似 Vue 中的 template</span></span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;App&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;div1&#125;</span>&gt;</span>&#123;this.state.msg&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        </span></span><br><span class=\"line\"><span class=\"language-xml\">        &#123;/* 只能使用 value 这一个 props */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">Context1.Provider</span> <span class=\"attr\">value</span>=<span class=\"string\">&#123;this.state.passMsg&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">Son</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;sonComp&#125;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Son</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">Context1.Provider</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Son.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">GrandSon</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./GrandSon&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">sonMsg</span>: <span class=\"string\">&quot;子组件&quot;</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;Son&quot;</span>&gt;</span>&#123;this.state.sonMsg&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">GrandSon</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">GrandSon</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Son</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* GrandSon.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Context1</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;./App&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">GrandSon</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">React.PureComponent</span> &#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">grandsonMsg</span>: <span class=\"string\">&quot;孙子组件&quot;</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&quot;Son&quot;</span>&gt;</span>&#123;this.state.grandsonMsg&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">Context1.Consumer</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">            (value) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">              console.log(value);</span></span><br><span class=\"line\"><span class=\"language-xml\">              return <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;value&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          &#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">Context1.Consumer</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">GrandSon</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"十二、函数组件-和-hook\"><a href=\"#十二、函数组件-和-hook\" class=\"headerlink\" title=\"十二、函数组件 和 hook\"></a>十二、函数组件 和 hook</h2><h3 id=\"1、函数组件和类组件的区别\"><a href=\"#1、函数组件和类组件的区别\" class=\"headerlink\" title=\"1、函数组件和类组件的区别\"></a>1、函数组件和类组件的区别</h3><p>（1）函数组件没有生命周期</p>\n<p>（2）函数组件没有 this</p>\n<p>（3）函数组件通过 hook 来完成各种操作</p>\n<p>（4）函数组件本身的函数体相当于 render 函数</p>\n<p>（5）props 在函数的第一个参数接受</p>\n<h3 id=\"2、useEffect\"><a href=\"#2、useEffect\" class=\"headerlink\" title=\"2、useEffect()\"></a>2、useEffect()</h3><p>不传第二个参数 &#x3D; componentDidMount 和 componentDidUpdate</p>\n<p>第二个参数传空数组 &#x3D; componentDidMount</p>\n<p>第二个参数数组里放某个数据 &#x3D; watch 监听</p>\n<h3 id=\"3、useMemo\"><a href=\"#3、useMemo\" class=\"headerlink\" title=\"3、useMemo()\"></a>3、useMemo()</h3><p>让一段计算在开始运行一次，后续只有依赖的数据发生变化时才重新运算，作用：</p>\n<p>（1）类似于 Vue 的一个计算属性的效果</p>\n<p>（2）缓存一个数据，让其不会重新创建</p>\n<h3 id=\"4、-useCallback\"><a href=\"#4、-useCallback\" class=\"headerlink\" title=\"4、 useCallback()\"></a>4、 useCallback()</h3><p>缓存一个方法，让方法不会每次更新都重新创建</p>\n<h3 id=\"5、其他-hooks\"><a href=\"#5、其他-hooks\" class=\"headerlink\" title=\"5、其他 hooks\"></a>5、其他 hooks</h3><p>useRef：函数组件中使用 ref</p>\n<p>useContext：更方便解析 context 的 provider 的数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Son&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">// vue3 - ref, reactive</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useState, useEffect, useMemo, useCallback, useRef, createContext &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">let</span> <span class=\"title class_\">Context1</span> = <span class=\"title function_\">createContext</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 相当于 render</span></span><br><span class=\"line\">  <span class=\"comment\">// return 的内容相当于组件的 html</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> [msg, setMsg] = <span class=\"title function_\">useState</span>(<span class=\"string\">&quot;hello&quot;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> [msg2, setMsg2] = <span class=\"title function_\">useState</span>(<span class=\"string\">&quot;hello2&quot;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> [arr, setArr] = <span class=\"title function_\">useState</span>([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> dom1 = <span class=\"title function_\">useRef</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 想要第二次更新不会运行，第二个参数需要传监听的数组</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> all = <span class=\"title function_\">useMemo</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;recount&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> _all = <span class=\"number\">0</span>;</span><br><span class=\"line\">    arr.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      _all += item;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _all;</span><br><span class=\"line\">  &#125;, [arr]);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// useEffect, useMemo, useCallback 第二个参数的作用一样</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> changeMsg = <span class=\"title function_\">useCallback</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">setMsg</span>(<span class=\"string\">&quot;1&quot;</span>);</span><br><span class=\"line\">  &#125;, []);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">changeArr</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> _arr = [...arr];</span><br><span class=\"line\">    _arr.<span class=\"title function_\">push</span>(<span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"title function_\">setArr</span>(_arr);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// // 第一个参数是回调函数 - 必填</span></span><br><span class=\"line\">  <span class=\"comment\">// // 不传第二个参数 = componentDidMount 和 componentDidUpdate</span></span><br><span class=\"line\">  <span class=\"comment\">// useEffect(() =&gt; &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//   console.log(&quot;effect&quot;)</span></span><br><span class=\"line\">  <span class=\"comment\">// &#125;)</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// // 第二个参数传空数组 = componentDidMount</span></span><br><span class=\"line\">  <span class=\"comment\">// useEffect(() =&gt; &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//   console.log(&quot;effect&quot;)</span></span><br><span class=\"line\">  <span class=\"comment\">// &#125;, [])</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 第二个参数传非空数组 = watch 监听</span></span><br><span class=\"line\">  <span class=\"comment\">// 一开始就会执行</span></span><br><span class=\"line\">  <span class=\"title function_\">useEffect</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;effect&quot;</span>);</span><br><span class=\"line\">  &#125;, [msg]);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">useEffect</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;dom1&quot;</span>, dom1);</span><br><span class=\"line\">  &#125;, []);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>this is App<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;msg&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;msg2&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;all&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;arr&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;dom1&#125;</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;changeMsg&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        修改msg</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          setMsg2(&quot;2&quot;);</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        修改msg2</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;changeArr&#125;</span>&gt;</span>修改arr<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">Context1.Provider</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;I&#x27;m context msg&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">Son</span> <span class=\"attr\">fatherMsg</span>=<span class=\"string\">&quot;I&#x27;m father&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Son</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">Context1.Provider</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Son.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useContext &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Context1</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;./App&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Son</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;props&quot;</span>, props);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> value = <span class=\"title function_\">useContext</span>(<span class=\"title class_\">Context1</span>);</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;value&quot;</span>, value);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>this is son<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Son</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"十三、高阶组件\"><a href=\"#十三、高阶组件\" class=\"headerlink\" title=\"十三、高阶组件\"></a>十三、高阶组件</h2><p>如果是 UI 内容和操作的复用是使用组件，但如果是单纯逻辑的复用，可以使用高阶组件</p>\n<p>可以类比于 Vue 中的 Mixin 和自定义指令</p>\n<h3 id=\"什么时候用高阶组件\"><a href=\"#什么时候用高阶组件\" class=\"headerlink\" title=\"什么时候用高阶组件\"></a>什么时候用高阶组件</h3><h4 id=\"（1）组件\"><a href=\"#（1）组件\" class=\"headerlink\" title=\"（1）组件\"></a>（1）组件</h4><p>组件既包含了 UI 界面的复用，也包含了逻辑的复用</p>\n<h4 id=\"（2）高阶组件\"><a href=\"#（2）高阶组件\" class=\"headerlink\" title=\"（2）高阶组件\"></a>（2）高阶组件</h4><p>高阶组件只是复用操作逻辑、运算。类似 Vue 中 Mixin 的用途</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useState &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Son&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">// import TestHoc from &quot;./TestHoc&quot;;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">MemoHoc</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./MemoHoc&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// let HocSon = TestHoc(Son);</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title class_\">MemoSon</span> = <span class=\"title class_\">MemoHoc</span>(<span class=\"title class_\">Son</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> [num, setNum] = <span class=\"title function_\">useState</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 鼠标位置监听 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* <span class=\"tag\">&lt;<span class=\"name\">HocSon</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">HocSon</span>&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">MemoSon</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">MemoSon</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>num: &#123;num&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          setNum(1);</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        修改数字</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* TestHoc.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 抛出一个 返回匿名类组件的方法</span></span><br><span class=\"line\"><span class=\"comment\">// 复用了其中的 state 数据 和 fn1 方法</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">function</span> <span class=\"title function_\">TestHoc</span>(<span class=\"params\">UserComp</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">class</span> <span class=\"title class_\">extends</span> <span class=\"title class_\">React</span>.<span class=\"property\">PureComponent</span> &#123;</span><br><span class=\"line\">    state = &#123;</span><br><span class=\"line\">    <span class=\"comment\">//   a: 123,</span></span><br><span class=\"line\">      <span class=\"attr\">x</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">y</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// fn1 = () =&gt; &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     console.log(&quot;this.state.a&quot;, this.state.a)</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">componentDidMount</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mousemove&quot;</span>, <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> x = e.<span class=\"property\">clientX</span>;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> y = e.<span class=\"property\">clientY</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">setState</span>(&#123;</span><br><span class=\"line\">          x,</span><br><span class=\"line\">          y,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          &#123;/* <span class=\"tag\">&lt;<span class=\"name\">UserComp</span> <span class=\"attr\">f1</span>=<span class=\"string\">&#123;this.fn1&#125;</span> &#123;<span class=\"attr\">...this.props</span>&#125; /&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">          &#123;/* 鼠标位置监听 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">UserComp</span> <span class=\"attr\">x</span>=<span class=\"string\">&#123;this.state.x&#125;</span> <span class=\"attr\">y</span>=<span class=\"string\">&#123;this.state.y&#125;</span> &#123;<span class=\"attr\">...this.props</span>&#125; /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* MemoHoc.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">function</span> <span class=\"title function_\">MemoHoc</span>(<span class=\"params\">UserComp</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">class</span> <span class=\"title class_\">extends</span> <span class=\"title class_\">React</span>.<span class=\"property\">Component</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">shouldComponentUpdate</span>(<span class=\"params\">props, state</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> item <span class=\"keyword\">in</span> props) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">props</span>[item] !== props[item]) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> item <span class=\"keyword\">in</span> state) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">state</span>[item] !== state[item]) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">render</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">UserComp</span> &#123;<span class=\"attr\">...this.props</span>&#125;&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">UserComp</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Son.js */</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Son</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// props.f1()</span></span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;son render&quot;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>高阶组件的使用<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 鼠标位置监听 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>x: &#123;props.x&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>y: &#123;props.y&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Son</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"十四、React-性能优化\"><a href=\"#十四、React-性能优化\" class=\"headerlink\" title=\"十四、React 性能优化\"></a>十四、React 性能优化</h2><h3 id=\"1、React-性能问题\"><a href=\"#1、React-性能问题\" class=\"headerlink\" title=\"1、React 性能问题\"></a>1、React 性能问题</h3><p>React 最大的性能问题就是：某个组件的更新 会连带其子组件一起更新，所以需要：</p>\n<p>（1）源码层面上尽量弥补这个问题</p>\n<p>（2）让子组件只做合理的更新</p>\n<h3 id=\"2、React-时间切片\"><a href=\"#2、React-时间切片\" class=\"headerlink\" title=\"2、React 时间切片\"></a>2、React 时间切片</h3><p>Vue 有依赖收集，做到了最小的更新范围</p>\n<p>而 React 没有，所以 React 要更新，会有大量的 diff 算法比对和计算工作，可能会阻塞浏览器的工作，导致页面长时间白屏</p>\n<p>React 为解决该问题选择了一种策略——时间切片，也就是先计算一部分更新，接着让渡给渲染进程渲染，然后再进行下一步更新</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/57/1.png\"\n                      alt=\"图一\"\n                ></p>\n<p>为支持这种切片，React 设计了数据结构 fiber</p>\n<p>每个组件会被转化为一个 fiber 结构的对象，组成一个个单元，并且能够恢复上次中断的计算进度</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/57/2.png\"\n                      alt=\"图二\"\n                ></p>\n<h3 id=\"3、减少无意义的组件更新\"><a href=\"#3、减少无意义的组件更新\" class=\"headerlink\" title=\"3、减少无意义的组件更新\"></a>3、减少无意义的组件更新</h3><p>（1）避免父组件数据更改导致子组件更新</p>\n<p>类组件：PureComponent，函数组件：React.memo</p>\n<p>（2）避免 state 的导致的无畏更新</p>\n<p>类组件：PureComponent，函数组件：本来就会判断</p>\n<p>（3）props</p>\n<p>如果组件使用了 PureComponent 或者 React.Memo，已经做到了如果父组件传的 props 没变，就不会更新</p>\n<p>但需要特别注意父组件传入的引用数据类型：方法、对象、数组</p>\n<ul>\n<li>用 useCallback 包裹传给子组件的方法</li>\n<li>非 state 对象、数组数据，要用 useMemo 包裹</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useMemo, useCallback &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Son&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">// React.memo 也是一种高阶函数</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title class_\">MemoSon</span> = <span class=\"title class_\">React</span>.<span class=\"title function_\">memo</span>(<span class=\"title class_\">Son</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 内部数据更新 -&gt; App 组件更新 -&gt; 重新执行 App 函数 -&gt; 重新定义 obj 和 f1 -&gt; 更新 MemoSon 子组件</span></span><br><span class=\"line\">  <span class=\"comment\">// let obj = &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//     a: 1</span></span><br><span class=\"line\">  <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> obj = <span class=\"title function_\">useMemo</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"attr\">a</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;, []);</span><br><span class=\"line\">  <span class=\"comment\">// function f1() &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//     console.log(123)</span></span><br><span class=\"line\">  <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> f1 = <span class=\"title function_\">useCallback</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">123</span>);</span><br><span class=\"line\">  &#125;, []);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">MemoSon</span> <span class=\"attr\">obj</span>=<span class=\"string\">&#123;obj&#125;</span> <span class=\"attr\">f1</span>=<span class=\"string\">&#123;f1&#125;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">MemoSon</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"React3","date":"2025-01-25T02:45:27.000Z","_content":"\n## 十五、React-router 使用\n\n### 1、React-router 的三个版本\n\n#### （1）React-router\n\n服务端渲染使用\n\n#### （2）React-router-dom\n\n浏览器端渲染使用（常用）\n\n#### （3）React-router-native\n\nReact-native 混合开发使用\n\n### 2、React-router 使用步骤\n\n（1）通过 BrowserRouter 或者 HashRouter 包裹要使用路由的根组件\n\n（2）使用 Routes 组件，定义路由显示区域\n\n（3）使用 Route 组件，定义具体路由规则\n\n（4）使用 NavLink 或者 Link 组件，定义跳转链接\n\n### 3、React-router 其他组件\n\n（1）Navigate：路由重定向\n\n（2）Outlet：嵌套路由的子路由显示处\n\n### 4、获取路由参数\n\n#### （1）Params 参数\n\n- V5：useParams\n- V6：this.props.match.params\n\n#### （2）Query 参数\n\n- V5：useSearchParams\n- V6：this.props.location.search\n\n#### （3）Location 信息\n\n- V5：useLocation\n- V6：this.props.location.state\n\n### 5、js 控制跳转地址\n\n- V6：useNavigate 创建跳转方法、然后跳转\n- V5：this.props.history.push()\n\n### 6、React 异步路由\n\nReact 做异步路由，要配合 React 的方法 lazy 和 组件 suspense\n\n``` js\n/* index.js */\nimport React from \"react\";\nimport ReactDOM from \"react-dom/client\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { BrowserRouter, HashRouter } from \"react-router-dom\";\n\nconst root = ReactDOM.createRoot(document.getElementById(\"root\"));\nroot.render(\n  <React.StrictMode>\n    {/* history 模式，路径为 .../page1 */}\n    <BrowserRouter>\n      {/* hash 模式，路径为 .../#/page1 */}\n      {/* <HashRouter> */}\n      <App />\n      {/* </HashRouter> */}\n    </BrowserRouter>\n  </React.StrictMode>\n);\nreportWebVitals();\n```\n\n``` js\n/* App.js */\nimport \"./App.css\";\nimport { Routes, Route, NavLink, Link, Navigate } from \"react-router-dom\";\nimport Page1 from \"./Page1\";\nimport Page2 from \"./Page2\";\nimport Page3 from \"./Page3\";\nimport Page4 from \"./Page4\";\nimport Page2Son1 from \"./Page2Son1\";\nimport Page2Son2 from \"./Page2Son2\";\n\n// 异步路由（懒加载）\nimport { lazy, Suspense } from \"react\";\nlet LazyPage4 = lazy(() => {\n  return import(\"./Page4\");\n});\n\nfunction App() {\n  let _token = localStorage.getItem(\"token\");\n  return (\n    <>\n      {/* 菜单 */}\n      <div>\n        {/* NavLink 有 active 类 */}\n        <NavLink to=\"/page1\">page1</NavLink>\n        <NavLink to=\"/page2\">page2</NavLink>\n        <NavLink to=\"/page3\">page3</NavLink>\n        <NavLink to=\"/page4\">page4</NavLink>\n        <NavLink to=\"/lazyPage4\">lazyPage4</NavLink>\n\n        {/* Link 没有 active 类 */}\n        {/* <Link to=\"/page1\">page1</Link>\n        <Link to=\"/page2\">page2</Link>\n        <Link to=\"/page3\">page3</Link>\n        <Link to=\"/page4\">page4</Link> */}\n      </div>\n\n      {/* React v5 和 v6 有较大的区别 */}\n      {/* v5 是 switch，只有 Component */}\n      {/* Routes 里只能放 Route，Route 也只能放到 Routes 里 */}\n      <Suspense fallback={<h2>加载中</h2>}>\n        <Routes>\n          {/* 控制访问权限1：通过 navigate 跳转到其他页面 */}\n          {/* <Route\n          path=\"/page1\"\n          element={_token ? <Page1></Page1> : <Navigate to=\"/page4\"></Navigate>}\n        ></Route> */}\n          {/* 控制访问权限2：直接不生成 */}\n          <Route path=\"/page1\" element={_token ? <Page1></Page1> : \"\"}></Route>\n          <Route path=\"/page2\" Component={Page2}>\n            <Route path=\"son1\" Component={Page2Son1}></Route>\n            <Route path=\"son2\" Component={Page2Son2}></Route>\n          </Route>\n          <Route path=\"/page3/:id\" Component={Page3}></Route>\n          <Route path=\"/page4\" Component={Page4}></Route>\n          <Route path=\"/lazyPage4\" Component={LazyPage4}></Route>\n        </Routes>\n      </Suspense>\n    </>\n  );\n}\n\nexport default App;\n```\n\n``` js\n/* Page1.js */\n// location 路径信息\nimport { useLocation } from \"react-router-dom\";\n\nfunction Page1() {\n  let location = useLocation();\n  console.log(\"location\", location);\n  return <div>this is page1</div>;\n}\n\nexport default Page1;\n```\n\n``` js\n/* Page2.js */\nimport { Outlet, useNavigate } from \"react-router-dom\";\n\nfunction Page2() {\n  let nav = useNavigate()\n  return (\n    <>\n      <div>this is page2</div>\n      <button onClick={() => {\n        nav(\"/page1?a=12345\", {\n          state: {\n            msg: \"state msg\"\n          }\n        })\n      }}>跳转到 page1</button>\n      {/* 嵌套路由 */}\n      <Outlet></Outlet>\n    </>\n  );\n}\n\nexport default Page2;\n```\n\n``` js\n/* Page2Son1.js */\nfunction Page2Son1() {\n  return <div>this is page2son1</div>;\n}\nexport default Page2Son1;\n\n```\n\n``` js\n/* Page2Son2.js */\nfunction Page2Son2() {\n  return <div>this is page2son2</div>;\n}\nexport default Page2Son2;\n```\n\n``` js\n/* Page3.js */\n// ../page3?a=1&b=2 - Query 参数\n// ../page3/123 - Param 参数\nimport { useParams } from \"react-router-dom\";\n\nfunction Page3() {\n  let params = useParams()\n  console.log(\"params\", params)\n  return <div>this is page3</div>;\n}\n\nexport default Page3;\n```\n\n``` js\n/* Page4.js */\nimport { useSearchParams } from \"react-router-dom\";\n\nfunction Page4() {\n  let [searchParams, setSearchParams] = useSearchParams();\n  console.log(\"searchParams.get('a')\", searchParams.get(\"a\"));\n  // console.log(\"setSearchParams\", setSearchParams)\n  return (\n    <>\n      <div>this is page4</div>\n      <button\n        onClick={() => {\n          setSearchParams({\n            a: 888,\n            b: 666,\n          });\n        }}\n      >\n        改变 search\n      </button>\n    </>\n  );\n}\n\nexport default Page4;\n```\n\n## 十六、React 状态管理\n\n### 1、状态管理\n\n（1）React 没有专门的状态管理库，只有通用的 JS 状态管理库，所以首先创建一个全局的数据储存和管理工具\n\n（2）通过其他工具，数据修改能触发 React 页面更新\n\n### 2、React 状态管理库\n\n![图一](../images/58/1.png)\n\n### 3、Redux\n\n``` js\n/* index.js */\nimport React from \"react\";\nimport ReactDOM from \"react-dom/client\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { Provider } from \"react-redux\";\nimport store from \"./store/index\";\n\nconst root = ReactDOM.createRoot(document.getElementById(\"root\"));\n// store.subscribe(() => {\n//   root.render(\n//     <React.StrictMode>\n//       <App />\n//     </React.StrictMode>\n//   );\n// });\nroot.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>\n);\nreportWebVitals();\n```\n\n``` js\n/* App.js */\nimport store from \"./store/index\";\n// let state = store.getState();\nimport { connect } from \"react-redux\";\n\nfunction App(props) {\n  console.log(\"props\", props);\n  // console.log(\"state1\", state);\n  return (\n    <>\n      {/* <div>{state.msg}</div>\n      <button\n        onClick={() => {\n          store.dispatch({\n            type: \"changeMsg\",\n            payload: \"world\",\n          });\n          console.log(\"state2\", state);\n        }}\n      >\n        修改 state\n      </button> */}\n      <div>{props.msg}</div>\n      <button\n        onClick={() => {\n          console.log(\"store.getState()\", store.getState());\n          // props.dispatch({\n          //   type: \"changeMsg\",\n          //   payload: \"world\",\n          // });\n          props.changeMsg();\n        }}\n      >\n        修改 state\n      </button>\n    </>\n  );\n}\n\n// connect 第一个参数是 state 的映射，即需要把哪些 state 映射到该组件的 props 里\n// connect 第二个参数是方法的映射，即需要给 props 加入的方法\nlet ReduxApp = connect(\n  (state) => {\n    console.log(\"state\", state);\n    // return state;\n    return {\n      msg: state.msgReducer.msg,\n    };\n  },\n  (dispatch) => {\n    return {\n      // 把 dispatch 封装成 changeMsg\n      changeMsg() {\n        dispatch({\n          type: \"changeMsg\",\n          payload: \"world\",\n        });\n      },\n    };\n  }\n)(App);\n\nexport default ReduxApp;\n```\n\n``` js\n/* store/index.js */\nimport { legacy_createStore as createStore, combineReducers } from \"redux\";\n\nfunction msgReducer(state = { msg: \"hello\" }, action) {\n  // 具体修改数据的行为\n  // 通常约定叫 type\n  switch (action.type) {\n    case \"changeMsg\":\n      // 通常约定叫 payload\n      state.msg = action.payload;\n      // 最后一定要 return 并展开，解除引用\n      return { ...state };\n    case \"resetMsg\":\n      state.msg = \"hello\";\n      return { ...state };\n    default:\n      return state;\n  }\n}\n\nfunction numReducer(state = { num: 0 }, action) {\n  switch (action.type) {\n    case \"addNum\":\n      state.num++;\n      return { ...state };\n    default:\n      return state;\n  }\n}\n\nlet reducer = combineReducers({\n  msgReducer,\n  numReducer,\n});\n\nlet store = createStore(reducer);\nexport default store;\n```\n\n### 4、Redux-toolkit\n\n#### （1）connect 方式\n\n``` js\n/* index.js */\nimport React from \"react\";\nimport ReactDOM from \"react-dom/client\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { Provider } from \"react-redux\";\nimport store from \"./store/toolkitIndex\";\n\nconst root = ReactDOM.createRoot(document.getElementById(\"root\"));\nroot.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>\n);\nreportWebVitals();\n```\n\n``` js\n/* App.js */\nimport store from \"./store/toolkitIndex\";\nimport { connect } from \"react-redux\";\nimport { changeMsg, addNum } from \"./store/toolkitIndex\";\n\nfunction App(props) {\n  console.log(\"props\", props);\n  return (\n    <>\n      <div>{props.msg}</div>\n      <div>{props.num}</div>\n      <button\n        onClick={() => {\n          console.log(\"store.getState()\", store.getState());\n          props.changeMsg();\n        }}\n      >\n        修改 state\n      </button>\n      <button\n        onClick={() => {\n          console.log(\"store.getState()\", store.getState());\n          props.addNum();\n        }}\n      >\n        增加 num\n      </button>\n    </>\n  );\n}\n\n// connect 第一个参数是 state 的映射，即需要把哪些 state 映射到该组件的 props 里\n// connect 第二个参数是方法的映射，即需要给 props 加入的方法\nlet ReduxApp = connect(\n  (state) => {\n    console.log(\"state\", state);\n    return {\n      msg: state.msgReducer.msg,\n      num: state.numReducer.num,\n    };\n  },\n  (dispatch) => {\n    return {\n      changeMsg() {\n        // dispatch({\n        //   type: \"changeMsg\",\n        //   payload: \"world\",\n        // });\n        // toolkit 的触发方法\n        dispatch(changeMsg(\"world\"))\n      },\n      addNum() {\n        // dispatch({\n        //   type: \"addNum\",\n        // });\n        dispatch(addNum())\n      },\n    };\n  }\n)(App);\n\nexport default ReduxApp;\n```\n\n#### （2）hook 方式\n\n``` js\n/* App2.js */\n// hook 方式只能用于 toolkit，只能用于 函数组件\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { addNum } from \"./store/toolkitIndex\";\n\nfunction App2() {\n  // 取出 state\n  let num = useSelector((state) => {\n    console.log(\"state\", state);\n    return state.numReducer.num;\n  });\n  let dispatch = useDispatch()\n  return (\n    <>\n      <div>{num}</div>\n      <button onClick={()=> {\n        // dispatch({\n        //   type: \"numSlice/addNum\"\n        // })\n        dispatch(addNum())\n      }}>增加</button>\n    </>\n  );\n}\n\nexport default App2;\n```\n\n### 5、异步操作\n\n``` js\n/* toolkitIndex.js */\nimport {\n  createSlice,\n  configureStore,\n  createAsyncThunk,\n} from \"@reduxjs/toolkit\";\n\n// 异步操作\n// 第一个参数名字\n// 第二个参数好似具体的异步操作\nexport let changeNumThunk = createAsyncThunk(\n  \"numSlice/changeNum\",\n  async (params) => {\n    let res = await new Promise((resolve) => {\n      console.log(\"params\", params);\n      setTimeout((state, action) => {\n        resolve(999);\n      }, 1000);\n    });\n    return res;\n  }\n);\n\nlet msgSlice = createSlice({\n  name: \"msgSlice\",\n  initialState: {\n    msg: \"hello\",\n  },\n  reducers: {\n    changeMsg(state, action) {\n      state.msg = action.payload;\n    },\n  },\n});\n\nlet numSlice = createSlice({\n  name: \"numSlice\",\n  initialState: {\n    num: 0,\n  },\n  reducers: {\n    addNum(state) {\n      state.num++;\n    },\n  },\n    extraReducers: (chunk) => {\n      chunk\n        .addCase(changeNumThunk.pending, () => {\n          console.log(\"pending\");\n        })\n        .addCase(changeNumThunk.fulfilled, (state, action) => {\n          console.log(\"fulfilled\");\n          state.num = action.payload;\n        });\n    },\n});\n\nexport let { changeMsg } = msgSlice.actions;\nexport let { addNum } = numSlice.actions;\n\nlet store = configureStore({\n  reducer: {\n    msgReducer: msgSlice.reducer,\n    numReducer: numSlice.reducer,\n  },\n});\n\nexport default store;\n```\n\n``` js\n/* App.js */\nimport store from \"./store/toolkitIndex\";\nimport { connect } from \"react-redux\";\nimport { changeMsg, addNum, changeNumThunk } from \"./store/toolkitIndex\";\n\nfunction App(props) {\n  console.log(\"props\", props);\n  return (\n    <>\n      <div>{props.msg}</div>\n      <div>{props.num}</div>\n      <button\n        onClick={() => {\n          console.log(\"store.getState()\", store.getState());\n          props.changeMsg();\n        }}\n      >\n        修改 state\n      </button>\n      <button\n        onClick={() => {\n          console.log(\"store.getState()\", store.getState());\n          props.addNum();\n        }}\n      >\n        增加 num\n      </button>\n      <button\n        onClick={() => {\n          props.changeNumThunk();\n        }}\n      >\n        异步修改\n      </button>\n    </>\n  );\n}\n\n// connect 第一个参数是 state 的映射，即需要把哪些 state 映射到该组件的 props 里\n// connect 第二个参数是方法的映射，即需要给 props 加入的方法\nlet ReduxApp = connect(\n  (state) => {\n    console.log(\"state\", state);\n    return {\n      msg: state.msgReducer.msg,\n      num: state.numReducer.num,\n    };\n  },\n  (dispatch) => {\n    return {\n      changeMsg() {\n        // dispatch({\n        //   type: \"changeMsg\",\n        //   payload: \"world\",\n        // });\n        // toolkit 的触发方法\n        dispatch(changeMsg(\"world\"));\n      },\n      addNum() {\n        // dispatch({\n        //   type: \"addNum\",\n        // });\n        dispatch(addNum());\n      },\n      changeNumThunk() {\n        dispatch(changeNumThunk(1));\n      },\n    };\n  }\n)(App);\n\nexport default ReduxApp;\n```\n\n## 十七、React 路由权限控制\n\n``` js\n/* index.js */\nimport React from \"react\";\nimport ReactDOM from \"react-dom/client\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { BrowserRouter } from \"react-router-dom\";\n\nconst root = ReactDOM.createRoot(document.getElementById(\"root\"));\nroot.render(\n  // <React.StrictMode>\n  <BrowserRouter>\n    <App />\n  </BrowserRouter>\n  // </React.StrictMode>\n);\n\nreportWebVitals();\n```\n\n``` js\n/* App.js */\nimport { Routes } from \"react-router-dom\";\nimport { createRoute } from \"./router/createRoute\";\nimport routerArr from \"./router/routerArr\";\n\nfunction App() {\n  console.log(\"createRoute(routerArr)\", createRoute(routerArr));\n  return (\n    <>\n      <Routes>{createRoute(routerArr)}</Routes>\n    </>\n  );\n}\n\nexport default App;\n```\n\n``` js\n/* createRoute.js */\nimport { Route } from \"react-router-dom\";\n\nexport function createRoute(routerArr, parentPath = \"\") {\n  return routerArr.map((item) => {\n    // 生成唯一的 key\n    const uniqueKey = parentPath ? `${parentPath}-${item.path}` : item.path;\n\n    if (item.children && item.children.length > 0) {\n      return (\n        <Route key={uniqueKey} path={item.path} element={<item.component />}>\n          {createRoute(item.children, item.path)}\n        </Route>\n      );\n    } else {\n      return (\n        <Route key={uniqueKey} path={item.path} element={<item.component />} />\n      );\n    }\n  });\n}\n```\n\n``` js\n/* routerArr.js */\nimport Page1 from \"../Page1\";\nimport Page2 from \"../Page2\";\nimport Page3 from \"../Page3\";\nimport Page2Son1 from \"../Page2Son1\";\nimport Page2Son2 from \"../Page2Son2\";\n\nexport default [\n  {\n    path: \"/page1\",\n    component: Page1,\n  },\n  {\n    path: \"/page2\",\n    component: Page2,\n    children: [\n      {\n        path: \"son1\",\n        component: Page2Son1,\n      },\n      {\n        path: \"son2\",\n        component: Page2Son2,\n      },\n    ],\n  },\n  {\n    path: \"/page3\",\n    component: Page3,\n  },\n];\n```\n\n## 十八、组件库等相关生态\n\n### 1、React 组件库\n\n最常用：PC 端 - Ant Design，移动端 - Ant Design Mobile\n\n``` js\n/* index.js */\nimport React from \"react\";\nimport ReactDOM from \"react-dom/client\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { ConfigProvider } from \"antd\";\n\nconst root = ReactDOM.createRoot(document.getElementById(\"root\"));\nroot.render(\n  <React.StrictMode>\n    <ConfigProvider\n      theme={{\n        token: {\n          colorPrimary: \"#666\",\n        },\n      }}\n    >\n      <App />\n    </ConfigProvider>\n  </React.StrictMode>\n);\n\nreportWebVitals();\n```\n\n``` js\n/* App.js */\nimport { Button } from \"antd\";\nimport { Table } from \"antd\";\nimport { useMemo } from \"react\";\n\nfunction App() {\n  let arr = [\n    {\n      id: 0,\n      name: \"name1\",\n      status: 0,\n    },\n    {\n      id: 1,\n      name: \"name2\",\n      status: 1,\n    },\n    {\n      id: 2,\n      name: \"name3\",\n      status: 0,\n    },\n  ];\n  let columns = useMemo(() => {\n    return [\n      {\n        title: \"名字\",\n        dataIndex: \"name\",\n      },\n      {\n        title: \"状态\",\n        dataIndex: \"status\",\n        render(status) {\n          console.log(\"status1\", status); // 0 1 2\n          return <>{status === 0 ? <span>在校</span> : <span>已休学</span>}</>;\n        },\n      },\n      {\n        title: \"操作\",\n        render(status) {\n          console.log(\"status2\", status); // 没有 dataIndex，整列数据\n          return (\n            <>\n              <Button type=\"primary\">增加</Button>\n              <Button>删除</Button>\n            </>\n          );\n        },\n      },\n    ];\n  });\n  return (\n    <>\n      <Button>按钮</Button>\n      <Table columns={columns} dataSource={arr} rowKey=\"id\"></Table>\n    </>\n  );\n}\n\nexport default App;\n```\n\n### 2、应用框架\n\n最常用：umi\n\n``` shell\nnpm i pnpm -g\n\npnpm dix create-umi@latest\n```\n","source":"_posts/58-React3.md","raw":"---\ntitle: React3\ndate: 2025-01-25 10:45:27\ntags:\n    - React\ncategories:\n    - React\n      - 基础课程\n---\n\n## 十五、React-router 使用\n\n### 1、React-router 的三个版本\n\n#### （1）React-router\n\n服务端渲染使用\n\n#### （2）React-router-dom\n\n浏览器端渲染使用（常用）\n\n#### （3）React-router-native\n\nReact-native 混合开发使用\n\n### 2、React-router 使用步骤\n\n（1）通过 BrowserRouter 或者 HashRouter 包裹要使用路由的根组件\n\n（2）使用 Routes 组件，定义路由显示区域\n\n（3）使用 Route 组件，定义具体路由规则\n\n（4）使用 NavLink 或者 Link 组件，定义跳转链接\n\n### 3、React-router 其他组件\n\n（1）Navigate：路由重定向\n\n（2）Outlet：嵌套路由的子路由显示处\n\n### 4、获取路由参数\n\n#### （1）Params 参数\n\n- V5：useParams\n- V6：this.props.match.params\n\n#### （2）Query 参数\n\n- V5：useSearchParams\n- V6：this.props.location.search\n\n#### （3）Location 信息\n\n- V5：useLocation\n- V6：this.props.location.state\n\n### 5、js 控制跳转地址\n\n- V6：useNavigate 创建跳转方法、然后跳转\n- V5：this.props.history.push()\n\n### 6、React 异步路由\n\nReact 做异步路由，要配合 React 的方法 lazy 和 组件 suspense\n\n``` js\n/* index.js */\nimport React from \"react\";\nimport ReactDOM from \"react-dom/client\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { BrowserRouter, HashRouter } from \"react-router-dom\";\n\nconst root = ReactDOM.createRoot(document.getElementById(\"root\"));\nroot.render(\n  <React.StrictMode>\n    {/* history 模式，路径为 .../page1 */}\n    <BrowserRouter>\n      {/* hash 模式，路径为 .../#/page1 */}\n      {/* <HashRouter> */}\n      <App />\n      {/* </HashRouter> */}\n    </BrowserRouter>\n  </React.StrictMode>\n);\nreportWebVitals();\n```\n\n``` js\n/* App.js */\nimport \"./App.css\";\nimport { Routes, Route, NavLink, Link, Navigate } from \"react-router-dom\";\nimport Page1 from \"./Page1\";\nimport Page2 from \"./Page2\";\nimport Page3 from \"./Page3\";\nimport Page4 from \"./Page4\";\nimport Page2Son1 from \"./Page2Son1\";\nimport Page2Son2 from \"./Page2Son2\";\n\n// 异步路由（懒加载）\nimport { lazy, Suspense } from \"react\";\nlet LazyPage4 = lazy(() => {\n  return import(\"./Page4\");\n});\n\nfunction App() {\n  let _token = localStorage.getItem(\"token\");\n  return (\n    <>\n      {/* 菜单 */}\n      <div>\n        {/* NavLink 有 active 类 */}\n        <NavLink to=\"/page1\">page1</NavLink>\n        <NavLink to=\"/page2\">page2</NavLink>\n        <NavLink to=\"/page3\">page3</NavLink>\n        <NavLink to=\"/page4\">page4</NavLink>\n        <NavLink to=\"/lazyPage4\">lazyPage4</NavLink>\n\n        {/* Link 没有 active 类 */}\n        {/* <Link to=\"/page1\">page1</Link>\n        <Link to=\"/page2\">page2</Link>\n        <Link to=\"/page3\">page3</Link>\n        <Link to=\"/page4\">page4</Link> */}\n      </div>\n\n      {/* React v5 和 v6 有较大的区别 */}\n      {/* v5 是 switch，只有 Component */}\n      {/* Routes 里只能放 Route，Route 也只能放到 Routes 里 */}\n      <Suspense fallback={<h2>加载中</h2>}>\n        <Routes>\n          {/* 控制访问权限1：通过 navigate 跳转到其他页面 */}\n          {/* <Route\n          path=\"/page1\"\n          element={_token ? <Page1></Page1> : <Navigate to=\"/page4\"></Navigate>}\n        ></Route> */}\n          {/* 控制访问权限2：直接不生成 */}\n          <Route path=\"/page1\" element={_token ? <Page1></Page1> : \"\"}></Route>\n          <Route path=\"/page2\" Component={Page2}>\n            <Route path=\"son1\" Component={Page2Son1}></Route>\n            <Route path=\"son2\" Component={Page2Son2}></Route>\n          </Route>\n          <Route path=\"/page3/:id\" Component={Page3}></Route>\n          <Route path=\"/page4\" Component={Page4}></Route>\n          <Route path=\"/lazyPage4\" Component={LazyPage4}></Route>\n        </Routes>\n      </Suspense>\n    </>\n  );\n}\n\nexport default App;\n```\n\n``` js\n/* Page1.js */\n// location 路径信息\nimport { useLocation } from \"react-router-dom\";\n\nfunction Page1() {\n  let location = useLocation();\n  console.log(\"location\", location);\n  return <div>this is page1</div>;\n}\n\nexport default Page1;\n```\n\n``` js\n/* Page2.js */\nimport { Outlet, useNavigate } from \"react-router-dom\";\n\nfunction Page2() {\n  let nav = useNavigate()\n  return (\n    <>\n      <div>this is page2</div>\n      <button onClick={() => {\n        nav(\"/page1?a=12345\", {\n          state: {\n            msg: \"state msg\"\n          }\n        })\n      }}>跳转到 page1</button>\n      {/* 嵌套路由 */}\n      <Outlet></Outlet>\n    </>\n  );\n}\n\nexport default Page2;\n```\n\n``` js\n/* Page2Son1.js */\nfunction Page2Son1() {\n  return <div>this is page2son1</div>;\n}\nexport default Page2Son1;\n\n```\n\n``` js\n/* Page2Son2.js */\nfunction Page2Son2() {\n  return <div>this is page2son2</div>;\n}\nexport default Page2Son2;\n```\n\n``` js\n/* Page3.js */\n// ../page3?a=1&b=2 - Query 参数\n// ../page3/123 - Param 参数\nimport { useParams } from \"react-router-dom\";\n\nfunction Page3() {\n  let params = useParams()\n  console.log(\"params\", params)\n  return <div>this is page3</div>;\n}\n\nexport default Page3;\n```\n\n``` js\n/* Page4.js */\nimport { useSearchParams } from \"react-router-dom\";\n\nfunction Page4() {\n  let [searchParams, setSearchParams] = useSearchParams();\n  console.log(\"searchParams.get('a')\", searchParams.get(\"a\"));\n  // console.log(\"setSearchParams\", setSearchParams)\n  return (\n    <>\n      <div>this is page4</div>\n      <button\n        onClick={() => {\n          setSearchParams({\n            a: 888,\n            b: 666,\n          });\n        }}\n      >\n        改变 search\n      </button>\n    </>\n  );\n}\n\nexport default Page4;\n```\n\n## 十六、React 状态管理\n\n### 1、状态管理\n\n（1）React 没有专门的状态管理库，只有通用的 JS 状态管理库，所以首先创建一个全局的数据储存和管理工具\n\n（2）通过其他工具，数据修改能触发 React 页面更新\n\n### 2、React 状态管理库\n\n![图一](../images/58/1.png)\n\n### 3、Redux\n\n``` js\n/* index.js */\nimport React from \"react\";\nimport ReactDOM from \"react-dom/client\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { Provider } from \"react-redux\";\nimport store from \"./store/index\";\n\nconst root = ReactDOM.createRoot(document.getElementById(\"root\"));\n// store.subscribe(() => {\n//   root.render(\n//     <React.StrictMode>\n//       <App />\n//     </React.StrictMode>\n//   );\n// });\nroot.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>\n);\nreportWebVitals();\n```\n\n``` js\n/* App.js */\nimport store from \"./store/index\";\n// let state = store.getState();\nimport { connect } from \"react-redux\";\n\nfunction App(props) {\n  console.log(\"props\", props);\n  // console.log(\"state1\", state);\n  return (\n    <>\n      {/* <div>{state.msg}</div>\n      <button\n        onClick={() => {\n          store.dispatch({\n            type: \"changeMsg\",\n            payload: \"world\",\n          });\n          console.log(\"state2\", state);\n        }}\n      >\n        修改 state\n      </button> */}\n      <div>{props.msg}</div>\n      <button\n        onClick={() => {\n          console.log(\"store.getState()\", store.getState());\n          // props.dispatch({\n          //   type: \"changeMsg\",\n          //   payload: \"world\",\n          // });\n          props.changeMsg();\n        }}\n      >\n        修改 state\n      </button>\n    </>\n  );\n}\n\n// connect 第一个参数是 state 的映射，即需要把哪些 state 映射到该组件的 props 里\n// connect 第二个参数是方法的映射，即需要给 props 加入的方法\nlet ReduxApp = connect(\n  (state) => {\n    console.log(\"state\", state);\n    // return state;\n    return {\n      msg: state.msgReducer.msg,\n    };\n  },\n  (dispatch) => {\n    return {\n      // 把 dispatch 封装成 changeMsg\n      changeMsg() {\n        dispatch({\n          type: \"changeMsg\",\n          payload: \"world\",\n        });\n      },\n    };\n  }\n)(App);\n\nexport default ReduxApp;\n```\n\n``` js\n/* store/index.js */\nimport { legacy_createStore as createStore, combineReducers } from \"redux\";\n\nfunction msgReducer(state = { msg: \"hello\" }, action) {\n  // 具体修改数据的行为\n  // 通常约定叫 type\n  switch (action.type) {\n    case \"changeMsg\":\n      // 通常约定叫 payload\n      state.msg = action.payload;\n      // 最后一定要 return 并展开，解除引用\n      return { ...state };\n    case \"resetMsg\":\n      state.msg = \"hello\";\n      return { ...state };\n    default:\n      return state;\n  }\n}\n\nfunction numReducer(state = { num: 0 }, action) {\n  switch (action.type) {\n    case \"addNum\":\n      state.num++;\n      return { ...state };\n    default:\n      return state;\n  }\n}\n\nlet reducer = combineReducers({\n  msgReducer,\n  numReducer,\n});\n\nlet store = createStore(reducer);\nexport default store;\n```\n\n### 4、Redux-toolkit\n\n#### （1）connect 方式\n\n``` js\n/* index.js */\nimport React from \"react\";\nimport ReactDOM from \"react-dom/client\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { Provider } from \"react-redux\";\nimport store from \"./store/toolkitIndex\";\n\nconst root = ReactDOM.createRoot(document.getElementById(\"root\"));\nroot.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>\n);\nreportWebVitals();\n```\n\n``` js\n/* App.js */\nimport store from \"./store/toolkitIndex\";\nimport { connect } from \"react-redux\";\nimport { changeMsg, addNum } from \"./store/toolkitIndex\";\n\nfunction App(props) {\n  console.log(\"props\", props);\n  return (\n    <>\n      <div>{props.msg}</div>\n      <div>{props.num}</div>\n      <button\n        onClick={() => {\n          console.log(\"store.getState()\", store.getState());\n          props.changeMsg();\n        }}\n      >\n        修改 state\n      </button>\n      <button\n        onClick={() => {\n          console.log(\"store.getState()\", store.getState());\n          props.addNum();\n        }}\n      >\n        增加 num\n      </button>\n    </>\n  );\n}\n\n// connect 第一个参数是 state 的映射，即需要把哪些 state 映射到该组件的 props 里\n// connect 第二个参数是方法的映射，即需要给 props 加入的方法\nlet ReduxApp = connect(\n  (state) => {\n    console.log(\"state\", state);\n    return {\n      msg: state.msgReducer.msg,\n      num: state.numReducer.num,\n    };\n  },\n  (dispatch) => {\n    return {\n      changeMsg() {\n        // dispatch({\n        //   type: \"changeMsg\",\n        //   payload: \"world\",\n        // });\n        // toolkit 的触发方法\n        dispatch(changeMsg(\"world\"))\n      },\n      addNum() {\n        // dispatch({\n        //   type: \"addNum\",\n        // });\n        dispatch(addNum())\n      },\n    };\n  }\n)(App);\n\nexport default ReduxApp;\n```\n\n#### （2）hook 方式\n\n``` js\n/* App2.js */\n// hook 方式只能用于 toolkit，只能用于 函数组件\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { addNum } from \"./store/toolkitIndex\";\n\nfunction App2() {\n  // 取出 state\n  let num = useSelector((state) => {\n    console.log(\"state\", state);\n    return state.numReducer.num;\n  });\n  let dispatch = useDispatch()\n  return (\n    <>\n      <div>{num}</div>\n      <button onClick={()=> {\n        // dispatch({\n        //   type: \"numSlice/addNum\"\n        // })\n        dispatch(addNum())\n      }}>增加</button>\n    </>\n  );\n}\n\nexport default App2;\n```\n\n### 5、异步操作\n\n``` js\n/* toolkitIndex.js */\nimport {\n  createSlice,\n  configureStore,\n  createAsyncThunk,\n} from \"@reduxjs/toolkit\";\n\n// 异步操作\n// 第一个参数名字\n// 第二个参数好似具体的异步操作\nexport let changeNumThunk = createAsyncThunk(\n  \"numSlice/changeNum\",\n  async (params) => {\n    let res = await new Promise((resolve) => {\n      console.log(\"params\", params);\n      setTimeout((state, action) => {\n        resolve(999);\n      }, 1000);\n    });\n    return res;\n  }\n);\n\nlet msgSlice = createSlice({\n  name: \"msgSlice\",\n  initialState: {\n    msg: \"hello\",\n  },\n  reducers: {\n    changeMsg(state, action) {\n      state.msg = action.payload;\n    },\n  },\n});\n\nlet numSlice = createSlice({\n  name: \"numSlice\",\n  initialState: {\n    num: 0,\n  },\n  reducers: {\n    addNum(state) {\n      state.num++;\n    },\n  },\n    extraReducers: (chunk) => {\n      chunk\n        .addCase(changeNumThunk.pending, () => {\n          console.log(\"pending\");\n        })\n        .addCase(changeNumThunk.fulfilled, (state, action) => {\n          console.log(\"fulfilled\");\n          state.num = action.payload;\n        });\n    },\n});\n\nexport let { changeMsg } = msgSlice.actions;\nexport let { addNum } = numSlice.actions;\n\nlet store = configureStore({\n  reducer: {\n    msgReducer: msgSlice.reducer,\n    numReducer: numSlice.reducer,\n  },\n});\n\nexport default store;\n```\n\n``` js\n/* App.js */\nimport store from \"./store/toolkitIndex\";\nimport { connect } from \"react-redux\";\nimport { changeMsg, addNum, changeNumThunk } from \"./store/toolkitIndex\";\n\nfunction App(props) {\n  console.log(\"props\", props);\n  return (\n    <>\n      <div>{props.msg}</div>\n      <div>{props.num}</div>\n      <button\n        onClick={() => {\n          console.log(\"store.getState()\", store.getState());\n          props.changeMsg();\n        }}\n      >\n        修改 state\n      </button>\n      <button\n        onClick={() => {\n          console.log(\"store.getState()\", store.getState());\n          props.addNum();\n        }}\n      >\n        增加 num\n      </button>\n      <button\n        onClick={() => {\n          props.changeNumThunk();\n        }}\n      >\n        异步修改\n      </button>\n    </>\n  );\n}\n\n// connect 第一个参数是 state 的映射，即需要把哪些 state 映射到该组件的 props 里\n// connect 第二个参数是方法的映射，即需要给 props 加入的方法\nlet ReduxApp = connect(\n  (state) => {\n    console.log(\"state\", state);\n    return {\n      msg: state.msgReducer.msg,\n      num: state.numReducer.num,\n    };\n  },\n  (dispatch) => {\n    return {\n      changeMsg() {\n        // dispatch({\n        //   type: \"changeMsg\",\n        //   payload: \"world\",\n        // });\n        // toolkit 的触发方法\n        dispatch(changeMsg(\"world\"));\n      },\n      addNum() {\n        // dispatch({\n        //   type: \"addNum\",\n        // });\n        dispatch(addNum());\n      },\n      changeNumThunk() {\n        dispatch(changeNumThunk(1));\n      },\n    };\n  }\n)(App);\n\nexport default ReduxApp;\n```\n\n## 十七、React 路由权限控制\n\n``` js\n/* index.js */\nimport React from \"react\";\nimport ReactDOM from \"react-dom/client\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { BrowserRouter } from \"react-router-dom\";\n\nconst root = ReactDOM.createRoot(document.getElementById(\"root\"));\nroot.render(\n  // <React.StrictMode>\n  <BrowserRouter>\n    <App />\n  </BrowserRouter>\n  // </React.StrictMode>\n);\n\nreportWebVitals();\n```\n\n``` js\n/* App.js */\nimport { Routes } from \"react-router-dom\";\nimport { createRoute } from \"./router/createRoute\";\nimport routerArr from \"./router/routerArr\";\n\nfunction App() {\n  console.log(\"createRoute(routerArr)\", createRoute(routerArr));\n  return (\n    <>\n      <Routes>{createRoute(routerArr)}</Routes>\n    </>\n  );\n}\n\nexport default App;\n```\n\n``` js\n/* createRoute.js */\nimport { Route } from \"react-router-dom\";\n\nexport function createRoute(routerArr, parentPath = \"\") {\n  return routerArr.map((item) => {\n    // 生成唯一的 key\n    const uniqueKey = parentPath ? `${parentPath}-${item.path}` : item.path;\n\n    if (item.children && item.children.length > 0) {\n      return (\n        <Route key={uniqueKey} path={item.path} element={<item.component />}>\n          {createRoute(item.children, item.path)}\n        </Route>\n      );\n    } else {\n      return (\n        <Route key={uniqueKey} path={item.path} element={<item.component />} />\n      );\n    }\n  });\n}\n```\n\n``` js\n/* routerArr.js */\nimport Page1 from \"../Page1\";\nimport Page2 from \"../Page2\";\nimport Page3 from \"../Page3\";\nimport Page2Son1 from \"../Page2Son1\";\nimport Page2Son2 from \"../Page2Son2\";\n\nexport default [\n  {\n    path: \"/page1\",\n    component: Page1,\n  },\n  {\n    path: \"/page2\",\n    component: Page2,\n    children: [\n      {\n        path: \"son1\",\n        component: Page2Son1,\n      },\n      {\n        path: \"son2\",\n        component: Page2Son2,\n      },\n    ],\n  },\n  {\n    path: \"/page3\",\n    component: Page3,\n  },\n];\n```\n\n## 十八、组件库等相关生态\n\n### 1、React 组件库\n\n最常用：PC 端 - Ant Design，移动端 - Ant Design Mobile\n\n``` js\n/* index.js */\nimport React from \"react\";\nimport ReactDOM from \"react-dom/client\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { ConfigProvider } from \"antd\";\n\nconst root = ReactDOM.createRoot(document.getElementById(\"root\"));\nroot.render(\n  <React.StrictMode>\n    <ConfigProvider\n      theme={{\n        token: {\n          colorPrimary: \"#666\",\n        },\n      }}\n    >\n      <App />\n    </ConfigProvider>\n  </React.StrictMode>\n);\n\nreportWebVitals();\n```\n\n``` js\n/* App.js */\nimport { Button } from \"antd\";\nimport { Table } from \"antd\";\nimport { useMemo } from \"react\";\n\nfunction App() {\n  let arr = [\n    {\n      id: 0,\n      name: \"name1\",\n      status: 0,\n    },\n    {\n      id: 1,\n      name: \"name2\",\n      status: 1,\n    },\n    {\n      id: 2,\n      name: \"name3\",\n      status: 0,\n    },\n  ];\n  let columns = useMemo(() => {\n    return [\n      {\n        title: \"名字\",\n        dataIndex: \"name\",\n      },\n      {\n        title: \"状态\",\n        dataIndex: \"status\",\n        render(status) {\n          console.log(\"status1\", status); // 0 1 2\n          return <>{status === 0 ? <span>在校</span> : <span>已休学</span>}</>;\n        },\n      },\n      {\n        title: \"操作\",\n        render(status) {\n          console.log(\"status2\", status); // 没有 dataIndex，整列数据\n          return (\n            <>\n              <Button type=\"primary\">增加</Button>\n              <Button>删除</Button>\n            </>\n          );\n        },\n      },\n    ];\n  });\n  return (\n    <>\n      <Button>按钮</Button>\n      <Table columns={columns} dataSource={arr} rowKey=\"id\"></Table>\n    </>\n  );\n}\n\nexport default App;\n```\n\n### 2、应用框架\n\n最常用：umi\n\n``` shell\nnpm i pnpm -g\n\npnpm dix create-umi@latest\n```\n","slug":"58-React3","published":1,"updated":"2025-05-20T04:36:37.358Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvuf00556kprbqya38ii","content":"<h2 id=\"十五、React-router-使用\"><a href=\"#十五、React-router-使用\" class=\"headerlink\" title=\"十五、React-router 使用\"></a>十五、React-router 使用</h2><h3 id=\"1、React-router-的三个版本\"><a href=\"#1、React-router-的三个版本\" class=\"headerlink\" title=\"1、React-router 的三个版本\"></a>1、React-router 的三个版本</h3><h4 id=\"（1）React-router\"><a href=\"#（1）React-router\" class=\"headerlink\" title=\"（1）React-router\"></a>（1）React-router</h4><p>服务端渲染使用</p>\n<h4 id=\"（2）React-router-dom\"><a href=\"#（2）React-router-dom\" class=\"headerlink\" title=\"（2）React-router-dom\"></a>（2）React-router-dom</h4><p>浏览器端渲染使用（常用）</p>\n<h4 id=\"（3）React-router-native\"><a href=\"#（3）React-router-native\" class=\"headerlink\" title=\"（3）React-router-native\"></a>（3）React-router-native</h4><p>React-native 混合开发使用</p>\n<h3 id=\"2、React-router-使用步骤\"><a href=\"#2、React-router-使用步骤\" class=\"headerlink\" title=\"2、React-router 使用步骤\"></a>2、React-router 使用步骤</h3><p>（1）通过 BrowserRouter 或者 HashRouter 包裹要使用路由的根组件</p>\n<p>（2）使用 Routes 组件，定义路由显示区域</p>\n<p>（3）使用 Route 组件，定义具体路由规则</p>\n<p>（4）使用 NavLink 或者 Link 组件，定义跳转链接</p>\n<h3 id=\"3、React-router-其他组件\"><a href=\"#3、React-router-其他组件\" class=\"headerlink\" title=\"3、React-router 其他组件\"></a>3、React-router 其他组件</h3><p>（1）Navigate：路由重定向</p>\n<p>（2）Outlet：嵌套路由的子路由显示处</p>\n<h3 id=\"4、获取路由参数\"><a href=\"#4、获取路由参数\" class=\"headerlink\" title=\"4、获取路由参数\"></a>4、获取路由参数</h3><h4 id=\"（1）Params-参数\"><a href=\"#（1）Params-参数\" class=\"headerlink\" title=\"（1）Params 参数\"></a>（1）Params 参数</h4><ul>\n<li>V5：useParams</li>\n<li>V6：this.props.match.params</li>\n</ul>\n<h4 id=\"（2）Query-参数\"><a href=\"#（2）Query-参数\" class=\"headerlink\" title=\"（2）Query 参数\"></a>（2）Query 参数</h4><ul>\n<li>V5：useSearchParams</li>\n<li>V6：this.props.location.search</li>\n</ul>\n<h4 id=\"（3）Location-信息\"><a href=\"#（3）Location-信息\" class=\"headerlink\" title=\"（3）Location 信息\"></a>（3）Location 信息</h4><ul>\n<li>V5：useLocation</li>\n<li>V6：this.props.location.state</li>\n</ul>\n<h3 id=\"5、js-控制跳转地址\"><a href=\"#5、js-控制跳转地址\" class=\"headerlink\" title=\"5、js 控制跳转地址\"></a>5、js 控制跳转地址</h3><ul>\n<li>V6：useNavigate 创建跳转方法、然后跳转</li>\n<li>V5：this.props.history.push()</li>\n</ul>\n<h3 id=\"6、React-异步路由\"><a href=\"#6、React-异步路由\" class=\"headerlink\" title=\"6、React 异步路由\"></a>6、React 异步路由</h3><p>React 做异步路由，要配合 React 的方法 lazy 和 组件 suspense</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* index.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">ReactDOM</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-dom/client&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;./index.css&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">App</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./App&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> reportWebVitals <span class=\"keyword\">from</span> <span class=\"string\">&quot;./reportWebVitals&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">BrowserRouter</span>, <span class=\"title class_\">HashRouter</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> root = <span class=\"title class_\">ReactDOM</span>.<span class=\"title function_\">createRoot</span>(<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;root&quot;</span>));</span><br><span class=\"line\">root.<span class=\"title function_\">render</span>(</span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    &#123;/* history 模式，路径为 .../page1 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">BrowserRouter</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* hash 模式，路径为 .../#/page1 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* <span class=\"tag\">&lt;<span class=\"name\">HashRouter</span>&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">App</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* <span class=\"tag\">&lt;/<span class=\"name\">HashRouter</span>&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">BrowserRouter</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;/<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"title function_\">reportWebVitals</span>();</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;./App.css&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Routes</span>, <span class=\"title class_\">Route</span>, <span class=\"title class_\">NavLink</span>, <span class=\"title class_\">Link</span>, <span class=\"title class_\">Navigate</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page1</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Page1&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page2</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Page2&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page3</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Page3&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page4</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Page4&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page2Son1</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Page2Son1&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page2Son2</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Page2Son2&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 异步路由（懒加载）</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; lazy, <span class=\"title class_\">Suspense</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title class_\">LazyPage4</span> = <span class=\"title function_\">lazy</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">import</span>(<span class=\"string\">&quot;./Page4&quot;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> _token = <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">getItem</span>(<span class=\"string\">&quot;token&quot;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 菜单 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        &#123;/* NavLink 有 active 类 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">NavLink</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/page1&quot;</span>&gt;</span>page1<span class=\"tag\">&lt;/<span class=\"name\">NavLink</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">NavLink</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/page2&quot;</span>&gt;</span>page2<span class=\"tag\">&lt;/<span class=\"name\">NavLink</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">NavLink</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/page3&quot;</span>&gt;</span>page3<span class=\"tag\">&lt;/<span class=\"name\">NavLink</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">NavLink</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/page4&quot;</span>&gt;</span>page4<span class=\"tag\">&lt;/<span class=\"name\">NavLink</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">NavLink</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/lazyPage4&quot;</span>&gt;</span>lazyPage4<span class=\"tag\">&lt;/<span class=\"name\">NavLink</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">        &#123;/* Link 没有 active 类 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#123;/* <span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/page1&quot;</span>&gt;</span>page1<span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/page2&quot;</span>&gt;</span>page2<span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/page3&quot;</span>&gt;</span>page3<span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/page4&quot;</span>&gt;</span>page4<span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* React v5 和 v6 有较大的区别 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* v5 是 switch，只有 Component */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* Routes 里只能放 Route，Route 也只能放到 Routes 里 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">Suspense</span> <span class=\"attr\">fallback</span>=<span class=\"string\">&#123;</span>&lt;<span class=\"attr\">h2</span>&gt;</span>加载中<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span>&#125;&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">Routes</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          &#123;/* 控制访问权限1：通过 navigate 跳转到其他页面 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          &#123;/* <span class=\"tag\">&lt;<span class=\"name\">Route</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">          <span class=\"attr\">path</span>=<span class=\"string\">&quot;/page1&quot;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">          <span class=\"attr\">element</span>=<span class=\"string\">&#123;_token</span> ? &lt;<span class=\"attr\">Page1</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Page1</span>&gt;</span> : <span class=\"tag\">&lt;<span class=\"name\">Navigate</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/page4&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Navigate</span>&gt;</span>&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        &gt;<span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          &#123;/* 控制访问权限2：直接不生成 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/page1&quot;</span> <span class=\"attr\">element</span>=<span class=\"string\">&#123;_token</span> ? &lt;<span class=\"attr\">Page1</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Page1</span>&gt;</span> : &quot;&quot;&#125;&gt;<span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/page2&quot;</span> <span class=\"attr\">Component</span>=<span class=\"string\">&#123;Page2&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;son1&quot;</span> <span class=\"attr\">Component</span>=<span class=\"string\">&#123;Page2Son1&#125;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;son2&quot;</span> <span class=\"attr\">Component</span>=<span class=\"string\">&#123;Page2Son2&#125;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/page3/:id&quot;</span> <span class=\"attr\">Component</span>=<span class=\"string\">&#123;Page3&#125;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/page4&quot;</span> <span class=\"attr\">Component</span>=<span class=\"string\">&#123;Page4&#125;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/lazyPage4&quot;</span> <span class=\"attr\">Component</span>=<span class=\"string\">&#123;LazyPage4&#125;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">Routes</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">Suspense</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Page1.js */</span></span><br><span class=\"line\"><span class=\"comment\">// location 路径信息</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useLocation &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Page1</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> location = <span class=\"title function_\">useLocation</span>();</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;location&quot;</span>, location);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>this is page1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Page1</span>;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Page2.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Outlet</span>, useNavigate &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Page2</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> nav = <span class=\"title function_\">useNavigate</span>()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>this is page2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">        nav(&quot;/page1?a=12345&quot;, &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          state: &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">            msg: &quot;state msg&quot;</span></span><br><span class=\"line\"><span class=\"language-xml\">          &#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;)</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#125;&#125;&gt;跳转到 page1<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 嵌套路由 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">Outlet</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Outlet</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Page2</span>;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Page2Son1.js */</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Page2Son1</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>this is page2son1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Page2Son1</span>;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Page2Son2.js */</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Page2Son2</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>this is page2son2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Page2Son2</span>;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Page3.js */</span></span><br><span class=\"line\"><span class=\"comment\">// ../page3?a=1&amp;b=2 - Query 参数</span></span><br><span class=\"line\"><span class=\"comment\">// ../page3/123 - Param 参数</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useParams &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Page3</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> params = <span class=\"title function_\">useParams</span>()</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;params&quot;</span>, params)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>this is page3<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Page3</span>;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Page4.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useSearchParams &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Page4</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> [searchParams, setSearchParams] = <span class=\"title function_\">useSearchParams</span>();</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;searchParams.get(&#x27;a&#x27;)&quot;</span>, searchParams.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;a&quot;</span>));</span><br><span class=\"line\">  <span class=\"comment\">// console.log(&quot;setSearchParams&quot;, setSearchParams)</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>this is page4<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          setSearchParams(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">            a: 888,</span></span><br><span class=\"line\"><span class=\"language-xml\">            b: 666,</span></span><br><span class=\"line\"><span class=\"language-xml\">          &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        改变 search</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Page4</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"十六、React-状态管理\"><a href=\"#十六、React-状态管理\" class=\"headerlink\" title=\"十六、React 状态管理\"></a>十六、React 状态管理</h2><h3 id=\"1、状态管理\"><a href=\"#1、状态管理\" class=\"headerlink\" title=\"1、状态管理\"></a>1、状态管理</h3><p>（1）React 没有专门的状态管理库，只有通用的 JS 状态管理库，所以首先创建一个全局的数据储存和管理工具</p>\n<p>（2）通过其他工具，数据修改能触发 React 页面更新</p>\n<h3 id=\"2、React-状态管理库\"><a href=\"#2、React-状态管理库\" class=\"headerlink\" title=\"2、React 状态管理库\"></a>2、React 状态管理库</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/58/1.png\"\n                      alt=\"图一\"\n                ></p>\n<h3 id=\"3、Redux\"><a href=\"#3、Redux\" class=\"headerlink\" title=\"3、Redux\"></a>3、Redux</h3><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* index.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">ReactDOM</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-dom/client&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;./index.css&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">App</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./App&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> reportWebVitals <span class=\"keyword\">from</span> <span class=\"string\">&quot;./reportWebVitals&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Provider</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-redux&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> store <span class=\"keyword\">from</span> <span class=\"string\">&quot;./store/index&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> root = <span class=\"title class_\">ReactDOM</span>.<span class=\"title function_\">createRoot</span>(<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;root&quot;</span>));</span><br><span class=\"line\"><span class=\"comment\">// store.subscribe(() =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//   root.render(</span></span><br><span class=\"line\"><span class=\"comment\">//     &lt;React.StrictMode&gt;</span></span><br><span class=\"line\"><span class=\"comment\">//       &lt;App /&gt;</span></span><br><span class=\"line\"><span class=\"comment\">//     &lt;/React.StrictMode&gt;</span></span><br><span class=\"line\"><span class=\"comment\">//   );</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">root.<span class=\"title function_\">render</span>(</span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">Provider</span> <span class=\"attr\">store</span>=<span class=\"string\">&#123;store&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">App</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">Provider</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;/<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"title function_\">reportWebVitals</span>();</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> store <span class=\"keyword\">from</span> <span class=\"string\">&quot;./store/index&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">// let state = store.getState();</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; connect &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-redux&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;props&quot;</span>, props);</span><br><span class=\"line\">  <span class=\"comment\">// console.log(&quot;state1&quot;, state);</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;state.msg&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          store.dispatch(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">            type: &quot;changeMsg&quot;,</span></span><br><span class=\"line\"><span class=\"language-xml\">            payload: &quot;world&quot;,</span></span><br><span class=\"line\"><span class=\"language-xml\">          &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">          console.log(&quot;state2&quot;, state);</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        修改 state</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;props.msg&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          console.log(&quot;store.getState()&quot;, store.getState());</span></span><br><span class=\"line\"><span class=\"language-xml\">          // props.dispatch(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          //   type: &quot;changeMsg&quot;,</span></span><br><span class=\"line\"><span class=\"language-xml\">          //   payload: &quot;world&quot;,</span></span><br><span class=\"line\"><span class=\"language-xml\">          // &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">          props.changeMsg();</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        修改 state</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// connect 第一个参数是 state 的映射，即需要把哪些 state 映射到该组件的 props 里</span></span><br><span class=\"line\"><span class=\"comment\">// connect 第二个参数是方法的映射，即需要给 props 加入的方法</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title class_\">ReduxApp</span> = <span class=\"title function_\">connect</span>(</span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;state&quot;</span>, state);</span><br><span class=\"line\">    <span class=\"comment\">// return state;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"attr\">msg</span>: state.<span class=\"property\">msgReducer</span>.<span class=\"property\">msg</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">dispatch</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 把 dispatch 封装成 changeMsg</span></span><br><span class=\"line\">      <span class=\"title function_\">changeMsg</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">dispatch</span>(&#123;</span><br><span class=\"line\">          <span class=\"attr\">type</span>: <span class=\"string\">&quot;changeMsg&quot;</span>,</span><br><span class=\"line\">          <span class=\"attr\">payload</span>: <span class=\"string\">&quot;world&quot;</span>,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">)(<span class=\"title class_\">App</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">ReduxApp</span>;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* store/index.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; legacy_createStore <span class=\"keyword\">as</span> createStore, combineReducers &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;redux&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">msgReducer</span>(<span class=\"params\">state = &#123; msg: <span class=\"string\">&quot;hello&quot;</span> &#125;, action</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 具体修改数据的行为</span></span><br><span class=\"line\">  <span class=\"comment\">// 通常约定叫 type</span></span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (action.<span class=\"property\">type</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&quot;changeMsg&quot;</span>:</span><br><span class=\"line\">      <span class=\"comment\">// 通常约定叫 payload</span></span><br><span class=\"line\">      state.<span class=\"property\">msg</span> = action.<span class=\"property\">payload</span>;</span><br><span class=\"line\">      <span class=\"comment\">// 最后一定要 return 并展开，解除引用</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123; ...state &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&quot;resetMsg&quot;</span>:</span><br><span class=\"line\">      state.<span class=\"property\">msg</span> = <span class=\"string\">&quot;hello&quot;</span>;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123; ...state &#125;;</span><br><span class=\"line\">    <span class=\"attr\">default</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">numReducer</span>(<span class=\"params\">state = &#123; num: <span class=\"number\">0</span> &#125;, action</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (action.<span class=\"property\">type</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&quot;addNum&quot;</span>:</span><br><span class=\"line\">      state.<span class=\"property\">num</span>++;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123; ...state &#125;;</span><br><span class=\"line\">    <span class=\"attr\">default</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> reducer = <span class=\"title function_\">combineReducers</span>(&#123;</span><br><span class=\"line\">  msgReducer,</span><br><span class=\"line\">  numReducer,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> store = <span class=\"title function_\">createStore</span>(reducer);</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> store;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"4、Redux-toolkit\"><a href=\"#4、Redux-toolkit\" class=\"headerlink\" title=\"4、Redux-toolkit\"></a>4、Redux-toolkit</h3><h4 id=\"（1）connect-方式\"><a href=\"#（1）connect-方式\" class=\"headerlink\" title=\"（1）connect 方式\"></a>（1）connect 方式</h4><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* index.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">ReactDOM</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-dom/client&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;./index.css&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">App</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./App&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> reportWebVitals <span class=\"keyword\">from</span> <span class=\"string\">&quot;./reportWebVitals&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Provider</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-redux&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> store <span class=\"keyword\">from</span> <span class=\"string\">&quot;./store/toolkitIndex&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> root = <span class=\"title class_\">ReactDOM</span>.<span class=\"title function_\">createRoot</span>(<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;root&quot;</span>));</span><br><span class=\"line\">root.<span class=\"title function_\">render</span>(</span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">Provider</span> <span class=\"attr\">store</span>=<span class=\"string\">&#123;store&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">App</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">Provider</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;/<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"title function_\">reportWebVitals</span>();</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> store <span class=\"keyword\">from</span> <span class=\"string\">&quot;./store/toolkitIndex&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; connect &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-redux&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; changeMsg, addNum &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;./store/toolkitIndex&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;props&quot;</span>, props);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;props.msg&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;props.num&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          console.log(&quot;store.getState()&quot;, store.getState());</span></span><br><span class=\"line\"><span class=\"language-xml\">          props.changeMsg();</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        修改 state</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          console.log(&quot;store.getState()&quot;, store.getState());</span></span><br><span class=\"line\"><span class=\"language-xml\">          props.addNum();</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        增加 num</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// connect 第一个参数是 state 的映射，即需要把哪些 state 映射到该组件的 props 里</span></span><br><span class=\"line\"><span class=\"comment\">// connect 第二个参数是方法的映射，即需要给 props 加入的方法</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title class_\">ReduxApp</span> = <span class=\"title function_\">connect</span>(</span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;state&quot;</span>, state);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"attr\">msg</span>: state.<span class=\"property\">msgReducer</span>.<span class=\"property\">msg</span>,</span><br><span class=\"line\">      <span class=\"attr\">num</span>: state.<span class=\"property\">numReducer</span>.<span class=\"property\">num</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">dispatch</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"title function_\">changeMsg</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// dispatch(&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//   type: &quot;changeMsg&quot;,</span></span><br><span class=\"line\">        <span class=\"comment\">//   payload: &quot;world&quot;,</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">        <span class=\"comment\">// toolkit 的触发方法</span></span><br><span class=\"line\">        <span class=\"title function_\">dispatch</span>(<span class=\"title function_\">changeMsg</span>(<span class=\"string\">&quot;world&quot;</span>))</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"title function_\">addNum</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// dispatch(&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//   type: &quot;addNum&quot;,</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">        <span class=\"title function_\">dispatch</span>(<span class=\"title function_\">addNum</span>())</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">)(<span class=\"title class_\">App</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">ReduxApp</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"（2）hook-方式\"><a href=\"#（2）hook-方式\" class=\"headerlink\" title=\"（2）hook 方式\"></a>（2）hook 方式</h4><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App2.js */</span></span><br><span class=\"line\"><span class=\"comment\">// hook 方式只能用于 toolkit，只能用于 函数组件</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useSelector, useDispatch &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-redux&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; addNum &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;./store/toolkitIndex&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App2</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 取出 state</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> num = <span class=\"title function_\">useSelector</span>(<span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;state&quot;</span>, state);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> state.<span class=\"property\">numReducer</span>.<span class=\"property\">num</span>;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> dispatch = <span class=\"title function_\">useDispatch</span>()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;num&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span>=&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">        // dispatch(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">        //   type: &quot;numSlice/addNum&quot;</span></span><br><span class=\"line\"><span class=\"language-xml\">        // &#125;)</span></span><br><span class=\"line\"><span class=\"language-xml\">        dispatch(addNum())</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#125;&#125;&gt;增加<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App2</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"5、异步操作\"><a href=\"#5、异步操作\" class=\"headerlink\" title=\"5、异步操作\"></a>5、异步操作</h3><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* toolkitIndex.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">  createSlice,</span><br><span class=\"line\">  configureStore,</span><br><span class=\"line\">  createAsyncThunk,</span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 异步操作</span></span><br><span class=\"line\"><span class=\"comment\">// 第一个参数名字</span></span><br><span class=\"line\"><span class=\"comment\">// 第二个参数好似具体的异步操作</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">let</span> changeNumThunk = <span class=\"title function_\">createAsyncThunk</span>(</span><br><span class=\"line\">  <span class=\"string\">&quot;numSlice/changeNum&quot;</span>,</span><br><span class=\"line\">  <span class=\"title function_\">async</span> (params) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> res = <span class=\"keyword\">await</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;params&quot;</span>, params);</span><br><span class=\"line\">      <span class=\"built_in\">setTimeout</span>(<span class=\"function\">(<span class=\"params\">state, action</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">resolve</span>(<span class=\"number\">999</span>);</span><br><span class=\"line\">      &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> msgSlice = <span class=\"title function_\">createSlice</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"string\">&quot;msgSlice&quot;</span>,</span><br><span class=\"line\">  <span class=\"attr\">initialState</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">msg</span>: <span class=\"string\">&quot;hello&quot;</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">reducers</span>: &#123;</span><br><span class=\"line\">    <span class=\"title function_\">changeMsg</span>(<span class=\"params\">state, action</span>) &#123;</span><br><span class=\"line\">      state.<span class=\"property\">msg</span> = action.<span class=\"property\">payload</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> numSlice = <span class=\"title function_\">createSlice</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"string\">&quot;numSlice&quot;</span>,</span><br><span class=\"line\">  <span class=\"attr\">initialState</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">num</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">reducers</span>: &#123;</span><br><span class=\"line\">    <span class=\"title function_\">addNum</span>(<span class=\"params\">state</span>) &#123;</span><br><span class=\"line\">      state.<span class=\"property\">num</span>++;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">    <span class=\"attr\">extraReducers</span>: <span class=\"function\">(<span class=\"params\">chunk</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      chunk</span><br><span class=\"line\">        .<span class=\"title function_\">addCase</span>(changeNumThunk.<span class=\"property\">pending</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;pending&quot;</span>);</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .<span class=\"title function_\">addCase</span>(changeNumThunk.<span class=\"property\">fulfilled</span>, <span class=\"function\">(<span class=\"params\">state, action</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;fulfilled&quot;</span>);</span><br><span class=\"line\">          state.<span class=\"property\">num</span> = action.<span class=\"property\">payload</span>;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">let</span> &#123; changeMsg &#125; = msgSlice.<span class=\"property\">actions</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">let</span> &#123; addNum &#125; = numSlice.<span class=\"property\">actions</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> store = <span class=\"title function_\">configureStore</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">reducer</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">msgReducer</span>: msgSlice.<span class=\"property\">reducer</span>,</span><br><span class=\"line\">    <span class=\"attr\">numReducer</span>: numSlice.<span class=\"property\">reducer</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> store;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> store <span class=\"keyword\">from</span> <span class=\"string\">&quot;./store/toolkitIndex&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; connect &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-redux&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; changeMsg, addNum, changeNumThunk &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;./store/toolkitIndex&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;props&quot;</span>, props);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;props.msg&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;props.num&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          console.log(&quot;store.getState()&quot;, store.getState());</span></span><br><span class=\"line\"><span class=\"language-xml\">          props.changeMsg();</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        修改 state</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          console.log(&quot;store.getState()&quot;, store.getState());</span></span><br><span class=\"line\"><span class=\"language-xml\">          props.addNum();</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        增加 num</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          props.changeNumThunk();</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        异步修改</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// connect 第一个参数是 state 的映射，即需要把哪些 state 映射到该组件的 props 里</span></span><br><span class=\"line\"><span class=\"comment\">// connect 第二个参数是方法的映射，即需要给 props 加入的方法</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title class_\">ReduxApp</span> = <span class=\"title function_\">connect</span>(</span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;state&quot;</span>, state);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"attr\">msg</span>: state.<span class=\"property\">msgReducer</span>.<span class=\"property\">msg</span>,</span><br><span class=\"line\">      <span class=\"attr\">num</span>: state.<span class=\"property\">numReducer</span>.<span class=\"property\">num</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">dispatch</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"title function_\">changeMsg</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// dispatch(&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//   type: &quot;changeMsg&quot;,</span></span><br><span class=\"line\">        <span class=\"comment\">//   payload: &quot;world&quot;,</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">        <span class=\"comment\">// toolkit 的触发方法</span></span><br><span class=\"line\">        <span class=\"title function_\">dispatch</span>(<span class=\"title function_\">changeMsg</span>(<span class=\"string\">&quot;world&quot;</span>));</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"title function_\">addNum</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// dispatch(&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//   type: &quot;addNum&quot;,</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">        <span class=\"title function_\">dispatch</span>(<span class=\"title function_\">addNum</span>());</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"title function_\">changeNumThunk</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">dispatch</span>(<span class=\"title function_\">changeNumThunk</span>(<span class=\"number\">1</span>));</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">)(<span class=\"title class_\">App</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">ReduxApp</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"十七、React-路由权限控制\"><a href=\"#十七、React-路由权限控制\" class=\"headerlink\" title=\"十七、React 路由权限控制\"></a>十七、React 路由权限控制</h2><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* index.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">ReactDOM</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-dom/client&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;./index.css&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">App</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./App&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> reportWebVitals <span class=\"keyword\">from</span> <span class=\"string\">&quot;./reportWebVitals&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">BrowserRouter</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> root = <span class=\"title class_\">ReactDOM</span>.<span class=\"title function_\">createRoot</span>(<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;root&quot;</span>));</span><br><span class=\"line\">root.<span class=\"title function_\">render</span>(</span><br><span class=\"line\">  <span class=\"comment\">// &lt;React.StrictMode&gt;</span></span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">BrowserRouter</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">App</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;/<span class=\"name\">BrowserRouter</span>&gt;</span></span></span><br><span class=\"line\">  <span class=\"comment\">// &lt;/React.StrictMode&gt;</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">reportWebVitals</span>();</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Routes</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createRoute &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;./router/createRoute&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> routerArr <span class=\"keyword\">from</span> <span class=\"string\">&quot;./router/routerArr&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;createRoute(routerArr)&quot;</span>, <span class=\"title function_\">createRoute</span>(routerArr));</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">Routes</span>&gt;</span>&#123;createRoute(routerArr)&#125;<span class=\"tag\">&lt;/<span class=\"name\">Routes</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* createRoute.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Route</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">createRoute</span>(<span class=\"params\">routerArr, parentPath = <span class=\"string\">&quot;&quot;</span></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> routerArr.<span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 生成唯一的 key</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> uniqueKey = parentPath ? <span class=\"string\">`<span class=\"subst\">$&#123;parentPath&#125;</span>-<span class=\"subst\">$&#123;item.path&#125;</span>`</span> : item.<span class=\"property\">path</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (item.<span class=\"property\">children</span> &amp;&amp; item.<span class=\"property\">children</span>.<span class=\"property\">length</span> &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">key</span>=<span class=\"string\">&#123;uniqueKey&#125;</span> <span class=\"attr\">path</span>=<span class=\"string\">&#123;item.path&#125;</span> <span class=\"attr\">element</span>=<span class=\"string\">&#123;</span>&lt;<span class=\"attr\">item.component</span> /&gt;</span>&#125;&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">          &#123;createRoute(item.children, item.path)&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span></span></span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">key</span>=<span class=\"string\">&#123;uniqueKey&#125;</span> <span class=\"attr\">path</span>=<span class=\"string\">&#123;item.path&#125;</span> <span class=\"attr\">element</span>=<span class=\"string\">&#123;</span>&lt;<span class=\"attr\">item.component</span> /&gt;</span>&#125; /&gt;</span></span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* routerArr.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page1</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;../Page1&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page2</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;../Page2&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page3</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;../Page3&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page2Son1</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;../Page2Son1&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page2Son2</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;../Page2Son2&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">path</span>: <span class=\"string\">&quot;/page1&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">component</span>: <span class=\"title class_\">Page1</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">path</span>: <span class=\"string\">&quot;/page2&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">component</span>: <span class=\"title class_\">Page2</span>,</span><br><span class=\"line\">    <span class=\"attr\">children</span>: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">path</span>: <span class=\"string\">&quot;son1&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">component</span>: <span class=\"title class_\">Page2Son1</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">path</span>: <span class=\"string\">&quot;son2&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">component</span>: <span class=\"title class_\">Page2Son2</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">path</span>: <span class=\"string\">&quot;/page3&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">component</span>: <span class=\"title class_\">Page3</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">];</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"十八、组件库等相关生态\"><a href=\"#十八、组件库等相关生态\" class=\"headerlink\" title=\"十八、组件库等相关生态\"></a>十八、组件库等相关生态</h2><h3 id=\"1、React-组件库\"><a href=\"#1、React-组件库\" class=\"headerlink\" title=\"1、React 组件库\"></a>1、React 组件库</h3><p>最常用：PC 端 - Ant Design，移动端 - Ant Design Mobile</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* index.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">ReactDOM</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-dom/client&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;./index.css&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">App</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./App&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> reportWebVitals <span class=\"keyword\">from</span> <span class=\"string\">&quot;./reportWebVitals&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">ConfigProvider</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;antd&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> root = <span class=\"title class_\">ReactDOM</span>.<span class=\"title function_\">createRoot</span>(<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;root&quot;</span>));</span><br><span class=\"line\">root.<span class=\"title function_\">render</span>(</span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">ConfigProvider</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">      <span class=\"attr\">theme</span>=<span class=\"string\">&#123;&#123;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">token:</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">          <span class=\"attr\">colorPrimary:</span> &quot;#<span class=\"attr\">666</span>&quot;,</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        &#125;,</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">      &#125;&#125;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">    &gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">App</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">ConfigProvider</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;/<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">reportWebVitals</span>();</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Button</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;antd&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Table</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;antd&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useMemo &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> arr = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">id</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">name</span>: <span class=\"string\">&quot;name1&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">status</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">id</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">      <span class=\"attr\">name</span>: <span class=\"string\">&quot;name2&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">status</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">id</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">      <span class=\"attr\">name</span>: <span class=\"string\">&quot;name3&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">status</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> columns = <span class=\"title function_\">useMemo</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">title</span>: <span class=\"string\">&quot;名字&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">dataIndex</span>: <span class=\"string\">&quot;name&quot;</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">title</span>: <span class=\"string\">&quot;状态&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">dataIndex</span>: <span class=\"string\">&quot;status&quot;</span>,</span><br><span class=\"line\">        <span class=\"title function_\">render</span>(<span class=\"params\">status</span>) &#123;</span><br><span class=\"line\">          <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;status1&quot;</span>, status); <span class=\"comment\">// 0 1 2</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span>&#123;status === 0 ? <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>在校<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span> : <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>已休学<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span>&#125;<span class=\"tag\">&lt;/&gt;</span></span>;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">title</span>: <span class=\"string\">&quot;操作&quot;</span>,</span><br><span class=\"line\">        <span class=\"title function_\">render</span>(<span class=\"params\">status</span>) &#123;</span><br><span class=\"line\">          <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;status2&quot;</span>, status); <span class=\"comment\">// 没有 dataIndex，整列数据</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;<span class=\"name\">Button</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;primary&quot;</span>&gt;</span>增加<span class=\"tag\">&lt;/<span class=\"name\">Button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;<span class=\"name\">Button</span>&gt;</span>删除<span class=\"tag\">&lt;/<span class=\"name\">Button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">          );</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    ];</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">Button</span>&gt;</span>按钮<span class=\"tag\">&lt;/<span class=\"name\">Button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">Table</span> <span class=\"attr\">columns</span>=<span class=\"string\">&#123;columns&#125;</span> <span class=\"attr\">dataSource</span>=<span class=\"string\">&#123;arr&#125;</span> <span class=\"attr\">rowKey</span>=<span class=\"string\">&quot;id&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Table</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"2、应用框架\"><a href=\"#2、应用框架\" class=\"headerlink\" title=\"2、应用框架\"></a>2、应用框架</h3><p>最常用：umi</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i pnpm -g</span><br><span class=\"line\"></span><br><span class=\"line\">pnpm dix create-umi@latest</span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"十五、React-router-使用\"><a href=\"#十五、React-router-使用\" class=\"headerlink\" title=\"十五、React-router 使用\"></a>十五、React-router 使用</h2><h3 id=\"1、React-router-的三个版本\"><a href=\"#1、React-router-的三个版本\" class=\"headerlink\" title=\"1、React-router 的三个版本\"></a>1、React-router 的三个版本</h3><h4 id=\"（1）React-router\"><a href=\"#（1）React-router\" class=\"headerlink\" title=\"（1）React-router\"></a>（1）React-router</h4><p>服务端渲染使用</p>\n<h4 id=\"（2）React-router-dom\"><a href=\"#（2）React-router-dom\" class=\"headerlink\" title=\"（2）React-router-dom\"></a>（2）React-router-dom</h4><p>浏览器端渲染使用（常用）</p>\n<h4 id=\"（3）React-router-native\"><a href=\"#（3）React-router-native\" class=\"headerlink\" title=\"（3）React-router-native\"></a>（3）React-router-native</h4><p>React-native 混合开发使用</p>\n<h3 id=\"2、React-router-使用步骤\"><a href=\"#2、React-router-使用步骤\" class=\"headerlink\" title=\"2、React-router 使用步骤\"></a>2、React-router 使用步骤</h3><p>（1）通过 BrowserRouter 或者 HashRouter 包裹要使用路由的根组件</p>\n<p>（2）使用 Routes 组件，定义路由显示区域</p>\n<p>（3）使用 Route 组件，定义具体路由规则</p>\n<p>（4）使用 NavLink 或者 Link 组件，定义跳转链接</p>\n<h3 id=\"3、React-router-其他组件\"><a href=\"#3、React-router-其他组件\" class=\"headerlink\" title=\"3、React-router 其他组件\"></a>3、React-router 其他组件</h3><p>（1）Navigate：路由重定向</p>\n<p>（2）Outlet：嵌套路由的子路由显示处</p>\n<h3 id=\"4、获取路由参数\"><a href=\"#4、获取路由参数\" class=\"headerlink\" title=\"4、获取路由参数\"></a>4、获取路由参数</h3><h4 id=\"（1）Params-参数\"><a href=\"#（1）Params-参数\" class=\"headerlink\" title=\"（1）Params 参数\"></a>（1）Params 参数</h4><ul>\n<li>V5：useParams</li>\n<li>V6：this.props.match.params</li>\n</ul>\n<h4 id=\"（2）Query-参数\"><a href=\"#（2）Query-参数\" class=\"headerlink\" title=\"（2）Query 参数\"></a>（2）Query 参数</h4><ul>\n<li>V5：useSearchParams</li>\n<li>V6：this.props.location.search</li>\n</ul>\n<h4 id=\"（3）Location-信息\"><a href=\"#（3）Location-信息\" class=\"headerlink\" title=\"（3）Location 信息\"></a>（3）Location 信息</h4><ul>\n<li>V5：useLocation</li>\n<li>V6：this.props.location.state</li>\n</ul>\n<h3 id=\"5、js-控制跳转地址\"><a href=\"#5、js-控制跳转地址\" class=\"headerlink\" title=\"5、js 控制跳转地址\"></a>5、js 控制跳转地址</h3><ul>\n<li>V6：useNavigate 创建跳转方法、然后跳转</li>\n<li>V5：this.props.history.push()</li>\n</ul>\n<h3 id=\"6、React-异步路由\"><a href=\"#6、React-异步路由\" class=\"headerlink\" title=\"6、React 异步路由\"></a>6、React 异步路由</h3><p>React 做异步路由，要配合 React 的方法 lazy 和 组件 suspense</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* index.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">ReactDOM</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-dom/client&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;./index.css&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">App</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./App&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> reportWebVitals <span class=\"keyword\">from</span> <span class=\"string\">&quot;./reportWebVitals&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">BrowserRouter</span>, <span class=\"title class_\">HashRouter</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> root = <span class=\"title class_\">ReactDOM</span>.<span class=\"title function_\">createRoot</span>(<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;root&quot;</span>));</span><br><span class=\"line\">root.<span class=\"title function_\">render</span>(</span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    &#123;/* history 模式，路径为 .../page1 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">BrowserRouter</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* hash 模式，路径为 .../#/page1 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* <span class=\"tag\">&lt;<span class=\"name\">HashRouter</span>&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">App</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* <span class=\"tag\">&lt;/<span class=\"name\">HashRouter</span>&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">BrowserRouter</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;/<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"title function_\">reportWebVitals</span>();</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;./App.css&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Routes</span>, <span class=\"title class_\">Route</span>, <span class=\"title class_\">NavLink</span>, <span class=\"title class_\">Link</span>, <span class=\"title class_\">Navigate</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page1</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Page1&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page2</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Page2&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page3</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Page3&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page4</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Page4&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page2Son1</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Page2Son1&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page2Son2</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./Page2Son2&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 异步路由（懒加载）</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; lazy, <span class=\"title class_\">Suspense</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title class_\">LazyPage4</span> = <span class=\"title function_\">lazy</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">import</span>(<span class=\"string\">&quot;./Page4&quot;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> _token = <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">getItem</span>(<span class=\"string\">&quot;token&quot;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 菜单 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        &#123;/* NavLink 有 active 类 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">NavLink</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/page1&quot;</span>&gt;</span>page1<span class=\"tag\">&lt;/<span class=\"name\">NavLink</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">NavLink</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/page2&quot;</span>&gt;</span>page2<span class=\"tag\">&lt;/<span class=\"name\">NavLink</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">NavLink</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/page3&quot;</span>&gt;</span>page3<span class=\"tag\">&lt;/<span class=\"name\">NavLink</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">NavLink</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/page4&quot;</span>&gt;</span>page4<span class=\"tag\">&lt;/<span class=\"name\">NavLink</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">NavLink</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/lazyPage4&quot;</span>&gt;</span>lazyPage4<span class=\"tag\">&lt;/<span class=\"name\">NavLink</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">        &#123;/* Link 没有 active 类 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#123;/* <span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/page1&quot;</span>&gt;</span>page1<span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/page2&quot;</span>&gt;</span>page2<span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/page3&quot;</span>&gt;</span>page3<span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/page4&quot;</span>&gt;</span>page4<span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* React v5 和 v6 有较大的区别 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* v5 是 switch，只有 Component */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* Routes 里只能放 Route，Route 也只能放到 Routes 里 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">Suspense</span> <span class=\"attr\">fallback</span>=<span class=\"string\">&#123;</span>&lt;<span class=\"attr\">h2</span>&gt;</span>加载中<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span>&#125;&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">Routes</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          &#123;/* 控制访问权限1：通过 navigate 跳转到其他页面 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          &#123;/* <span class=\"tag\">&lt;<span class=\"name\">Route</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">          <span class=\"attr\">path</span>=<span class=\"string\">&quot;/page1&quot;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">          <span class=\"attr\">element</span>=<span class=\"string\">&#123;_token</span> ? &lt;<span class=\"attr\">Page1</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Page1</span>&gt;</span> : <span class=\"tag\">&lt;<span class=\"name\">Navigate</span> <span class=\"attr\">to</span>=<span class=\"string\">&quot;/page4&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Navigate</span>&gt;</span>&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        &gt;<span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          &#123;/* 控制访问权限2：直接不生成 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/page1&quot;</span> <span class=\"attr\">element</span>=<span class=\"string\">&#123;_token</span> ? &lt;<span class=\"attr\">Page1</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Page1</span>&gt;</span> : &quot;&quot;&#125;&gt;<span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/page2&quot;</span> <span class=\"attr\">Component</span>=<span class=\"string\">&#123;Page2&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;son1&quot;</span> <span class=\"attr\">Component</span>=<span class=\"string\">&#123;Page2Son1&#125;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;son2&quot;</span> <span class=\"attr\">Component</span>=<span class=\"string\">&#123;Page2Son2&#125;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/page3/:id&quot;</span> <span class=\"attr\">Component</span>=<span class=\"string\">&#123;Page3&#125;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/page4&quot;</span> <span class=\"attr\">Component</span>=<span class=\"string\">&#123;Page4&#125;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/lazyPage4&quot;</span> <span class=\"attr\">Component</span>=<span class=\"string\">&#123;LazyPage4&#125;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">Routes</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">Suspense</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Page1.js */</span></span><br><span class=\"line\"><span class=\"comment\">// location 路径信息</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useLocation &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Page1</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> location = <span class=\"title function_\">useLocation</span>();</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;location&quot;</span>, location);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>this is page1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Page1</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Page2.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Outlet</span>, useNavigate &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Page2</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> nav = <span class=\"title function_\">useNavigate</span>()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>this is page2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">        nav(&quot;/page1?a=12345&quot;, &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          state: &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">            msg: &quot;state msg&quot;</span></span><br><span class=\"line\"><span class=\"language-xml\">          &#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;)</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#125;&#125;&gt;跳转到 page1<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* 嵌套路由 */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">Outlet</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Outlet</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Page2</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Page2Son1.js */</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Page2Son1</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>this is page2son1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Page2Son1</span>;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Page2Son2.js */</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Page2Son2</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>this is page2son2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Page2Son2</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Page3.js */</span></span><br><span class=\"line\"><span class=\"comment\">// ../page3?a=1&amp;b=2 - Query 参数</span></span><br><span class=\"line\"><span class=\"comment\">// ../page3/123 - Param 参数</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useParams &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Page3</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> params = <span class=\"title function_\">useParams</span>()</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;params&quot;</span>, params)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>this is page3<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Page3</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Page4.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useSearchParams &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Page4</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> [searchParams, setSearchParams] = <span class=\"title function_\">useSearchParams</span>();</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;searchParams.get(&#x27;a&#x27;)&quot;</span>, searchParams.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;a&quot;</span>));</span><br><span class=\"line\">  <span class=\"comment\">// console.log(&quot;setSearchParams&quot;, setSearchParams)</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>this is page4<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          setSearchParams(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">            a: 888,</span></span><br><span class=\"line\"><span class=\"language-xml\">            b: 666,</span></span><br><span class=\"line\"><span class=\"language-xml\">          &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        改变 search</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Page4</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"十六、React-状态管理\"><a href=\"#十六、React-状态管理\" class=\"headerlink\" title=\"十六、React 状态管理\"></a>十六、React 状态管理</h2><h3 id=\"1、状态管理\"><a href=\"#1、状态管理\" class=\"headerlink\" title=\"1、状态管理\"></a>1、状态管理</h3><p>（1）React 没有专门的状态管理库，只有通用的 JS 状态管理库，所以首先创建一个全局的数据储存和管理工具</p>\n<p>（2）通过其他工具，数据修改能触发 React 页面更新</p>\n<h3 id=\"2、React-状态管理库\"><a href=\"#2、React-状态管理库\" class=\"headerlink\" title=\"2、React 状态管理库\"></a>2、React 状态管理库</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"/../images/58/1.png\"\n                      alt=\"图一\"\n                ></p>\n<h3 id=\"3、Redux\"><a href=\"#3、Redux\" class=\"headerlink\" title=\"3、Redux\"></a>3、Redux</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* index.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">ReactDOM</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-dom/client&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;./index.css&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">App</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./App&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> reportWebVitals <span class=\"keyword\">from</span> <span class=\"string\">&quot;./reportWebVitals&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Provider</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-redux&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> store <span class=\"keyword\">from</span> <span class=\"string\">&quot;./store/index&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> root = <span class=\"title class_\">ReactDOM</span>.<span class=\"title function_\">createRoot</span>(<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;root&quot;</span>));</span><br><span class=\"line\"><span class=\"comment\">// store.subscribe(() =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//   root.render(</span></span><br><span class=\"line\"><span class=\"comment\">//     &lt;React.StrictMode&gt;</span></span><br><span class=\"line\"><span class=\"comment\">//       &lt;App /&gt;</span></span><br><span class=\"line\"><span class=\"comment\">//     &lt;/React.StrictMode&gt;</span></span><br><span class=\"line\"><span class=\"comment\">//   );</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">root.<span class=\"title function_\">render</span>(</span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">Provider</span> <span class=\"attr\">store</span>=<span class=\"string\">&#123;store&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">App</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">Provider</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;/<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"title function_\">reportWebVitals</span>();</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> store <span class=\"keyword\">from</span> <span class=\"string\">&quot;./store/index&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">// let state = store.getState();</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; connect &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-redux&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;props&quot;</span>, props);</span><br><span class=\"line\">  <span class=\"comment\">// console.log(&quot;state1&quot;, state);</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      &#123;/* <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;state.msg&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          store.dispatch(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">            type: &quot;changeMsg&quot;,</span></span><br><span class=\"line\"><span class=\"language-xml\">            payload: &quot;world&quot;,</span></span><br><span class=\"line\"><span class=\"language-xml\">          &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">          console.log(&quot;state2&quot;, state);</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        修改 state</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span> */&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;props.msg&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          console.log(&quot;store.getState()&quot;, store.getState());</span></span><br><span class=\"line\"><span class=\"language-xml\">          // props.dispatch(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          //   type: &quot;changeMsg&quot;,</span></span><br><span class=\"line\"><span class=\"language-xml\">          //   payload: &quot;world&quot;,</span></span><br><span class=\"line\"><span class=\"language-xml\">          // &#125;);</span></span><br><span class=\"line\"><span class=\"language-xml\">          props.changeMsg();</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        修改 state</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// connect 第一个参数是 state 的映射，即需要把哪些 state 映射到该组件的 props 里</span></span><br><span class=\"line\"><span class=\"comment\">// connect 第二个参数是方法的映射，即需要给 props 加入的方法</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title class_\">ReduxApp</span> = <span class=\"title function_\">connect</span>(</span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;state&quot;</span>, state);</span><br><span class=\"line\">    <span class=\"comment\">// return state;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"attr\">msg</span>: state.<span class=\"property\">msgReducer</span>.<span class=\"property\">msg</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">dispatch</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 把 dispatch 封装成 changeMsg</span></span><br><span class=\"line\">      <span class=\"title function_\">changeMsg</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">dispatch</span>(&#123;</span><br><span class=\"line\">          <span class=\"attr\">type</span>: <span class=\"string\">&quot;changeMsg&quot;</span>,</span><br><span class=\"line\">          <span class=\"attr\">payload</span>: <span class=\"string\">&quot;world&quot;</span>,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">)(<span class=\"title class_\">App</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">ReduxApp</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* store/index.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; legacy_createStore <span class=\"keyword\">as</span> createStore, combineReducers &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;redux&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">msgReducer</span>(<span class=\"params\">state = &#123; msg: <span class=\"string\">&quot;hello&quot;</span> &#125;, action</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 具体修改数据的行为</span></span><br><span class=\"line\">  <span class=\"comment\">// 通常约定叫 type</span></span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (action.<span class=\"property\">type</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&quot;changeMsg&quot;</span>:</span><br><span class=\"line\">      <span class=\"comment\">// 通常约定叫 payload</span></span><br><span class=\"line\">      state.<span class=\"property\">msg</span> = action.<span class=\"property\">payload</span>;</span><br><span class=\"line\">      <span class=\"comment\">// 最后一定要 return 并展开，解除引用</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123; ...state &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&quot;resetMsg&quot;</span>:</span><br><span class=\"line\">      state.<span class=\"property\">msg</span> = <span class=\"string\">&quot;hello&quot;</span>;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123; ...state &#125;;</span><br><span class=\"line\">    <span class=\"attr\">default</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">numReducer</span>(<span class=\"params\">state = &#123; num: <span class=\"number\">0</span> &#125;, action</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (action.<span class=\"property\">type</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&quot;addNum&quot;</span>:</span><br><span class=\"line\">      state.<span class=\"property\">num</span>++;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123; ...state &#125;;</span><br><span class=\"line\">    <span class=\"attr\">default</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> reducer = <span class=\"title function_\">combineReducers</span>(&#123;</span><br><span class=\"line\">  msgReducer,</span><br><span class=\"line\">  numReducer,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> store = <span class=\"title function_\">createStore</span>(reducer);</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> store;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4、Redux-toolkit\"><a href=\"#4、Redux-toolkit\" class=\"headerlink\" title=\"4、Redux-toolkit\"></a>4、Redux-toolkit</h3><h4 id=\"（1）connect-方式\"><a href=\"#（1）connect-方式\" class=\"headerlink\" title=\"（1）connect 方式\"></a>（1）connect 方式</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* index.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">ReactDOM</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-dom/client&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;./index.css&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">App</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./App&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> reportWebVitals <span class=\"keyword\">from</span> <span class=\"string\">&quot;./reportWebVitals&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Provider</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-redux&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> store <span class=\"keyword\">from</span> <span class=\"string\">&quot;./store/toolkitIndex&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> root = <span class=\"title class_\">ReactDOM</span>.<span class=\"title function_\">createRoot</span>(<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;root&quot;</span>));</span><br><span class=\"line\">root.<span class=\"title function_\">render</span>(</span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">Provider</span> <span class=\"attr\">store</span>=<span class=\"string\">&#123;store&#125;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">App</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">Provider</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;/<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"title function_\">reportWebVitals</span>();</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> store <span class=\"keyword\">from</span> <span class=\"string\">&quot;./store/toolkitIndex&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; connect &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-redux&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; changeMsg, addNum &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;./store/toolkitIndex&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;props&quot;</span>, props);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;props.msg&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;props.num&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          console.log(&quot;store.getState()&quot;, store.getState());</span></span><br><span class=\"line\"><span class=\"language-xml\">          props.changeMsg();</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        修改 state</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          console.log(&quot;store.getState()&quot;, store.getState());</span></span><br><span class=\"line\"><span class=\"language-xml\">          props.addNum();</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        增加 num</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// connect 第一个参数是 state 的映射，即需要把哪些 state 映射到该组件的 props 里</span></span><br><span class=\"line\"><span class=\"comment\">// connect 第二个参数是方法的映射，即需要给 props 加入的方法</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title class_\">ReduxApp</span> = <span class=\"title function_\">connect</span>(</span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;state&quot;</span>, state);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"attr\">msg</span>: state.<span class=\"property\">msgReducer</span>.<span class=\"property\">msg</span>,</span><br><span class=\"line\">      <span class=\"attr\">num</span>: state.<span class=\"property\">numReducer</span>.<span class=\"property\">num</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">dispatch</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"title function_\">changeMsg</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// dispatch(&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//   type: &quot;changeMsg&quot;,</span></span><br><span class=\"line\">        <span class=\"comment\">//   payload: &quot;world&quot;,</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">        <span class=\"comment\">// toolkit 的触发方法</span></span><br><span class=\"line\">        <span class=\"title function_\">dispatch</span>(<span class=\"title function_\">changeMsg</span>(<span class=\"string\">&quot;world&quot;</span>))</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"title function_\">addNum</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// dispatch(&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//   type: &quot;addNum&quot;,</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">        <span class=\"title function_\">dispatch</span>(<span class=\"title function_\">addNum</span>())</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">)(<span class=\"title class_\">App</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">ReduxApp</span>;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"（2）hook-方式\"><a href=\"#（2）hook-方式\" class=\"headerlink\" title=\"（2）hook 方式\"></a>（2）hook 方式</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App2.js */</span></span><br><span class=\"line\"><span class=\"comment\">// hook 方式只能用于 toolkit，只能用于 函数组件</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useSelector, useDispatch &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-redux&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; addNum &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;./store/toolkitIndex&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App2</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 取出 state</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> num = <span class=\"title function_\">useSelector</span>(<span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;state&quot;</span>, state);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> state.<span class=\"property\">numReducer</span>.<span class=\"property\">num</span>;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> dispatch = <span class=\"title function_\">useDispatch</span>()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;num&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span>=&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">        // dispatch(&#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">        //   type: &quot;numSlice/addNum&quot;</span></span><br><span class=\"line\"><span class=\"language-xml\">        // &#125;)</span></span><br><span class=\"line\"><span class=\"language-xml\">        dispatch(addNum())</span></span><br><span class=\"line\"><span class=\"language-xml\">      &#125;&#125;&gt;增加<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App2</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5、异步操作\"><a href=\"#5、异步操作\" class=\"headerlink\" title=\"5、异步操作\"></a>5、异步操作</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* toolkitIndex.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">  createSlice,</span><br><span class=\"line\">  configureStore,</span><br><span class=\"line\">  createAsyncThunk,</span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 异步操作</span></span><br><span class=\"line\"><span class=\"comment\">// 第一个参数名字</span></span><br><span class=\"line\"><span class=\"comment\">// 第二个参数好似具体的异步操作</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">let</span> changeNumThunk = <span class=\"title function_\">createAsyncThunk</span>(</span><br><span class=\"line\">  <span class=\"string\">&quot;numSlice/changeNum&quot;</span>,</span><br><span class=\"line\">  <span class=\"title function_\">async</span> (params) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> res = <span class=\"keyword\">await</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;params&quot;</span>, params);</span><br><span class=\"line\">      <span class=\"built_in\">setTimeout</span>(<span class=\"function\">(<span class=\"params\">state, action</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">resolve</span>(<span class=\"number\">999</span>);</span><br><span class=\"line\">      &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> msgSlice = <span class=\"title function_\">createSlice</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"string\">&quot;msgSlice&quot;</span>,</span><br><span class=\"line\">  <span class=\"attr\">initialState</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">msg</span>: <span class=\"string\">&quot;hello&quot;</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">reducers</span>: &#123;</span><br><span class=\"line\">    <span class=\"title function_\">changeMsg</span>(<span class=\"params\">state, action</span>) &#123;</span><br><span class=\"line\">      state.<span class=\"property\">msg</span> = action.<span class=\"property\">payload</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> numSlice = <span class=\"title function_\">createSlice</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"string\">&quot;numSlice&quot;</span>,</span><br><span class=\"line\">  <span class=\"attr\">initialState</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">num</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">reducers</span>: &#123;</span><br><span class=\"line\">    <span class=\"title function_\">addNum</span>(<span class=\"params\">state</span>) &#123;</span><br><span class=\"line\">      state.<span class=\"property\">num</span>++;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">    <span class=\"attr\">extraReducers</span>: <span class=\"function\">(<span class=\"params\">chunk</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      chunk</span><br><span class=\"line\">        .<span class=\"title function_\">addCase</span>(changeNumThunk.<span class=\"property\">pending</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;pending&quot;</span>);</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .<span class=\"title function_\">addCase</span>(changeNumThunk.<span class=\"property\">fulfilled</span>, <span class=\"function\">(<span class=\"params\">state, action</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;fulfilled&quot;</span>);</span><br><span class=\"line\">          state.<span class=\"property\">num</span> = action.<span class=\"property\">payload</span>;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">let</span> &#123; changeMsg &#125; = msgSlice.<span class=\"property\">actions</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">let</span> &#123; addNum &#125; = numSlice.<span class=\"property\">actions</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> store = <span class=\"title function_\">configureStore</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">reducer</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">msgReducer</span>: msgSlice.<span class=\"property\">reducer</span>,</span><br><span class=\"line\">    <span class=\"attr\">numReducer</span>: numSlice.<span class=\"property\">reducer</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> store;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> store <span class=\"keyword\">from</span> <span class=\"string\">&quot;./store/toolkitIndex&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; connect &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-redux&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; changeMsg, addNum, changeNumThunk &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;./store/toolkitIndex&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;props&quot;</span>, props);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;props.msg&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;props.num&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          console.log(&quot;store.getState()&quot;, store.getState());</span></span><br><span class=\"line\"><span class=\"language-xml\">          props.changeMsg();</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        修改 state</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          console.log(&quot;store.getState()&quot;, store.getState());</span></span><br><span class=\"line\"><span class=\"language-xml\">          props.addNum();</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        增加 num</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">          props.changeNumThunk();</span></span><br><span class=\"line\"><span class=\"language-xml\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">      &gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">        异步修改</span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// connect 第一个参数是 state 的映射，即需要把哪些 state 映射到该组件的 props 里</span></span><br><span class=\"line\"><span class=\"comment\">// connect 第二个参数是方法的映射，即需要给 props 加入的方法</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title class_\">ReduxApp</span> = <span class=\"title function_\">connect</span>(</span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;state&quot;</span>, state);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"attr\">msg</span>: state.<span class=\"property\">msgReducer</span>.<span class=\"property\">msg</span>,</span><br><span class=\"line\">      <span class=\"attr\">num</span>: state.<span class=\"property\">numReducer</span>.<span class=\"property\">num</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">dispatch</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"title function_\">changeMsg</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// dispatch(&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//   type: &quot;changeMsg&quot;,</span></span><br><span class=\"line\">        <span class=\"comment\">//   payload: &quot;world&quot;,</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">        <span class=\"comment\">// toolkit 的触发方法</span></span><br><span class=\"line\">        <span class=\"title function_\">dispatch</span>(<span class=\"title function_\">changeMsg</span>(<span class=\"string\">&quot;world&quot;</span>));</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"title function_\">addNum</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// dispatch(&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//   type: &quot;addNum&quot;,</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">        <span class=\"title function_\">dispatch</span>(<span class=\"title function_\">addNum</span>());</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"title function_\">changeNumThunk</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">dispatch</span>(<span class=\"title function_\">changeNumThunk</span>(<span class=\"number\">1</span>));</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">)(<span class=\"title class_\">App</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">ReduxApp</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"十七、React-路由权限控制\"><a href=\"#十七、React-路由权限控制\" class=\"headerlink\" title=\"十七、React 路由权限控制\"></a>十七、React 路由权限控制</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* index.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">ReactDOM</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-dom/client&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;./index.css&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">App</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./App&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> reportWebVitals <span class=\"keyword\">from</span> <span class=\"string\">&quot;./reportWebVitals&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">BrowserRouter</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> root = <span class=\"title class_\">ReactDOM</span>.<span class=\"title function_\">createRoot</span>(<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;root&quot;</span>));</span><br><span class=\"line\">root.<span class=\"title function_\">render</span>(</span><br><span class=\"line\">  <span class=\"comment\">// &lt;React.StrictMode&gt;</span></span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">BrowserRouter</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">App</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;/<span class=\"name\">BrowserRouter</span>&gt;</span></span></span><br><span class=\"line\">  <span class=\"comment\">// &lt;/React.StrictMode&gt;</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">reportWebVitals</span>();</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Routes</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createRoute &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;./router/createRoute&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> routerArr <span class=\"keyword\">from</span> <span class=\"string\">&quot;./router/routerArr&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;createRoute(routerArr)&quot;</span>, <span class=\"title function_\">createRoute</span>(routerArr));</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">Routes</span>&gt;</span>&#123;createRoute(routerArr)&#125;<span class=\"tag\">&lt;/<span class=\"name\">Routes</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* createRoute.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Route</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">createRoute</span>(<span class=\"params\">routerArr, parentPath = <span class=\"string\">&quot;&quot;</span></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> routerArr.<span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 生成唯一的 key</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> uniqueKey = parentPath ? <span class=\"string\">`<span class=\"subst\">$&#123;parentPath&#125;</span>-<span class=\"subst\">$&#123;item.path&#125;</span>`</span> : item.<span class=\"property\">path</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (item.<span class=\"property\">children</span> &amp;&amp; item.<span class=\"property\">children</span>.<span class=\"property\">length</span> &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">key</span>=<span class=\"string\">&#123;uniqueKey&#125;</span> <span class=\"attr\">path</span>=<span class=\"string\">&#123;item.path&#125;</span> <span class=\"attr\">element</span>=<span class=\"string\">&#123;</span>&lt;<span class=\"attr\">item.component</span> /&gt;</span>&#125;&gt;</span></span><br><span class=\"line\"><span class=\"language-xml\">          &#123;createRoute(item.children, item.path)&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span></span></span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">key</span>=<span class=\"string\">&#123;uniqueKey&#125;</span> <span class=\"attr\">path</span>=<span class=\"string\">&#123;item.path&#125;</span> <span class=\"attr\">element</span>=<span class=\"string\">&#123;</span>&lt;<span class=\"attr\">item.component</span> /&gt;</span>&#125; /&gt;</span></span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* routerArr.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page1</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;../Page1&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page2</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;../Page2&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page3</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;../Page3&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page2Son1</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;../Page2Son1&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Page2Son2</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;../Page2Son2&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">path</span>: <span class=\"string\">&quot;/page1&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">component</span>: <span class=\"title class_\">Page1</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">path</span>: <span class=\"string\">&quot;/page2&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">component</span>: <span class=\"title class_\">Page2</span>,</span><br><span class=\"line\">    <span class=\"attr\">children</span>: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">path</span>: <span class=\"string\">&quot;son1&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">component</span>: <span class=\"title class_\">Page2Son1</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">path</span>: <span class=\"string\">&quot;son2&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">component</span>: <span class=\"title class_\">Page2Son2</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">path</span>: <span class=\"string\">&quot;/page3&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">component</span>: <span class=\"title class_\">Page3</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">];</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"十八、组件库等相关生态\"><a href=\"#十八、组件库等相关生态\" class=\"headerlink\" title=\"十八、组件库等相关生态\"></a>十八、组件库等相关生态</h2><h3 id=\"1、React-组件库\"><a href=\"#1、React-组件库\" class=\"headerlink\" title=\"1、React 组件库\"></a>1、React 组件库</h3><p>最常用：PC 端 - Ant Design，移动端 - Ant Design Mobile</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* index.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">ReactDOM</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-dom/client&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;./index.css&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">App</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./App&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> reportWebVitals <span class=\"keyword\">from</span> <span class=\"string\">&quot;./reportWebVitals&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">ConfigProvider</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;antd&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> root = <span class=\"title class_\">ReactDOM</span>.<span class=\"title function_\">createRoot</span>(<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;root&quot;</span>));</span><br><span class=\"line\">root.<span class=\"title function_\">render</span>(</span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">ConfigProvider</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">      <span class=\"attr\">theme</span>=<span class=\"string\">&#123;&#123;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        <span class=\"attr\">token:</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">          <span class=\"attr\">colorPrimary:</span> &quot;#<span class=\"attr\">666</span>&quot;,</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">        &#125;,</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">      &#125;&#125;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">    &gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">App</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">ConfigProvider</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;/<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">reportWebVitals</span>();</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* App.js */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Button</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;antd&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Table</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;antd&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useMemo &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">App</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> arr = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">id</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"attr\">name</span>: <span class=\"string\">&quot;name1&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">status</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">id</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">      <span class=\"attr\">name</span>: <span class=\"string\">&quot;name2&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">status</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">id</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">      <span class=\"attr\">name</span>: <span class=\"string\">&quot;name3&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">status</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> columns = <span class=\"title function_\">useMemo</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">title</span>: <span class=\"string\">&quot;名字&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">dataIndex</span>: <span class=\"string\">&quot;name&quot;</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">title</span>: <span class=\"string\">&quot;状态&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">dataIndex</span>: <span class=\"string\">&quot;status&quot;</span>,</span><br><span class=\"line\">        <span class=\"title function_\">render</span>(<span class=\"params\">status</span>) &#123;</span><br><span class=\"line\">          <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;status1&quot;</span>, status); <span class=\"comment\">// 0 1 2</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span>&#123;status === 0 ? <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>在校<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span> : <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>已休学<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span>&#125;<span class=\"tag\">&lt;/&gt;</span></span>;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">title</span>: <span class=\"string\">&quot;操作&quot;</span>,</span><br><span class=\"line\">        <span class=\"title function_\">render</span>(<span class=\"params\">status</span>) &#123;</span><br><span class=\"line\">          <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;status2&quot;</span>, status); <span class=\"comment\">// 没有 dataIndex，整列数据</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;<span class=\"name\">Button</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;primary&quot;</span>&gt;</span>增加<span class=\"tag\">&lt;/<span class=\"name\">Button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">              <span class=\"tag\">&lt;<span class=\"name\">Button</span>&gt;</span>删除<span class=\"tag\">&lt;/<span class=\"name\">Button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">          );</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    ];</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">Button</span>&gt;</span>按钮<span class=\"tag\">&lt;/<span class=\"name\">Button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">Table</span> <span class=\"attr\">columns</span>=<span class=\"string\">&#123;columns&#125;</span> <span class=\"attr\">dataSource</span>=<span class=\"string\">&#123;arr&#125;</span> <span class=\"attr\">rowKey</span>=<span class=\"string\">&quot;id&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Table</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/&gt;</span></span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">App</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、应用框架\"><a href=\"#2、应用框架\" class=\"headerlink\" title=\"2、应用框架\"></a>2、应用框架</h3><p>最常用：umi</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i pnpm -g</span><br><span class=\"line\"></span><br><span class=\"line\">pnpm dix create-umi@latest</span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"IB-Rust-环境搭建","date":"2025-05-20T04:17:51.000Z","_content":"\n[Codes in lesson1.1](https://github.com/Zoella-w/IB-Rust/tree/main/1.1_hello_world)\n\n[Codes in lesson1.2](https://github.com/Zoella-w/IB-Rust/tree/main/1.2_hello_cargo)\n\n## 一、Rust 介绍\n\n### 1、内存安全\n\n不允许空指针和悬空指针，可预防 C++ 中的许多类型错误\n\n### 2、静态类型\n\n编译器必须在编译期知道所有变量的类型\n\n在编译器能推导变量类型的情况下，不需要手动为变量指定类型\n\n### 3、并发编程\n\n使开发者能编写高效、安全的多线程程序，避免数据竞争等并发问题\n\n## 二、环境搭建\n\n### 1、安装\n\n通过 `rustup` 下载 Rust\n\n```shell\ncurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh\n```\n\n检查是否正确安装 Rust\n\n```console\n$ rustc --version\n```\n\n### 2、rustup 命令\n\n#### （1）升级 rust 工具链和 rustup 本身\n\n```rustup update```\n\n#### （2）卸载 rust\n\n```rustup self uninstall```\n\n#### （3）打开离线文档\n\n```rustup doc```\n\n## 三、vscode 配置\n\n1、rust-analyzer\n\n2、even-better-toml\n\n3、crates（已无法使用，换成了 Dependi）\n\n## 四、hello world\n\nrust 文件以 .rs 结尾，如 main.rs\n\n```rust\nfn main() {\n    println!(\"Hello, world!\");\n}\n```\n\n### 1、编译\n\n```shell\nrustc main.rs\n```\n\n编译成功后输出一个二进制可执行文件 main\n\n### 2、运行\n\nrust 是 **预编译静态类型**（*ahead-of-time compiled*）语言，即一旦拥有了编译后的可执行文件，不需要安装 Rust 即可运行\n\n```shell\n./main\n```\n\n## 五、cargo\n\n### 1、初始化项目\n\n```shell\ncargo new hello_cargo\ncd hello_cargo\n```\n\n其中的 Cargo.toml 文件包含：\n\n```toml\n[package]\nname = \"hello_cargo\"\nversion = \"0.1.0\"\nedition = \"2024\"\n\n[dependencies]\n```\n\n**[package]**\n\n- 项目名称\n- 项目版本\n- Rust 版本\n\n**[dependencies]**\n\n项目依赖，Rust 中的代码包为 crates\n\n### 2、构建并运行\n\n#### （1）构建\n\n```bash\ncargo build\n```\n\n创建可执行文件 *target/debug/hello_cargo*\n\n#### （2）运行\n\n```bash\n./target/debug/hello_cargo\n```\n\n#### （3）构建并运行\n\n```bash\ncargo run\n```\n\n同时编译并运行生成的可执行文件，更方便\n\n#### （4）发布构建\n\n```shell\ncargo build --release\n```\n\n在 *target/release* 下生成可执行文件，编译优化让 Rust 代码运行的更快，但消耗更长的编译时间\n\n**两种构建对比：**\n\n- `cargo build` 用于开发，因为经常需要重新构建\n\n- `cargo build --release` 用于为用户构建最终程序，不会经常重新构建，并希望程序运行得更快\n\n### 3、添加依赖\n\ncrate 是一个 Rust 代码库，可以包含任意能被其他程序使用的代码，但不能自执行\n\n添加一个随机数的库（crate）：\n\n```toml\n[dependencies]\nrand = \"0.8.5\"\n```\n\n然后重新构建项目\n\n---\n\n当增加了新依赖，Cargo 会从 [Crates.io](https://crates.io/) 获取依赖，并将指定的依赖版本写入 Cargo.lock 文件\n\n> Cargo.lock 文件\n> \n> 确保任何人在任何时候重新构建代码，都会产生相同的结果，因为 Cargo 只会使用指定的依赖版本（类似 package-lock.json）\n\n---\n\n如需升级 crate，`cargo update` 会忽略 *Cargo.lock* 文件，并计算出所有符合 *Cargo.toml* 声明的最新版本，接着将其写入 *Cargo.lock*。\n\n但是 Cargo 只会寻找 `0.8.x` 的版本，假设 `rand` crate 发布了 `0.8.6` 和 `0.9.0` 两个新版本，运行 `cargo update` 后会升级到 `0.8.6` 而不是 `0.9.0`。这是因为 `0.9.0` 相对于 `0.8.5` 主版本发生了变化。\n\n如需升级到 `0.9.x` 版本，更新 *Cargo.toml* 文件：\n\n```toml\n[dependencies]\nrand = \"0.9.0\"\n```\n\n### 4、配置国内镜像\n\n为了使用 `crates.io` 之外的注册服务，需要对 `$HOME/.cargo/config.toml` 文件进行配置，添加新的服务提供商\n\n> **cargo v1.68 开始支持稀疏索引**：不需要完整克隆 crates.io-index 仓库，加快获取包的速度\n\n> 协议推荐使用 git，如配置 git 协议后无法正常获取和编译 crate，可以换 https 协议试试\n\n两种实现方式：增加新的镜像地址 和 覆盖默认的镜像地址\n\n#### （1）增加新的镜像地址\n\n如果支持稀疏索引：\n\n```toml\n### https，任选一种即可\n[registries]\nustc = { index = \"sparse+https://mirrors.ustc.edu.cn/crates.io-index/\" }\n[registries.ustc]\nindex = \"sparse+https://mirrors.ustc.edu.cn/crates.io-index/\"\n\n### git，任选一种即可\n[registries]\nustc = { index = \"sparse+git://mirrors.ustc.edu.cn/crates.io-index/\" }\n[registries.ustc]\nindex = \"sparse+git://mirrors.ustc.edu.cn/crates.io-index/\"\n```\n\n---\n\n这种方式只会新增一个新的镜像地址，因此在引入依赖的时候，需要指定该地址，例如在项目中引入 `time` 包，你需要在 `Cargo.toml` 中使用以下方式引入:\n\n```toml\n[dependencies]\nrand = {  registry = \"ustc\" }\n```\n\n#### （2）【推荐】覆盖默认的镜像地址\n\n这种方式不需要修改 `Cargo.toml` 文件，因为它会直接使用新注册服务替代默认的 `crates.io`。\n\n在 `$HOME/.cargo/config.toml` 添加以下内容：\n\n```toml\n[source.crates-io]\nreplace-with = 'ustc'\n\n[source.ustc]\nregistry = \"https://mirrors.ustc.edu.cn/crates.io-index/\"\n```\n\n创建一个新的镜像源 `[source.ustc]`，然后将默认的 `crates-io` 替换成新的镜像源：`replace-with = 'ustc'`\n\n---\n\n**可用镜像列表：**\n\n```toml\n# 中科大\n\"https://mirrors.ustc.edu.cn/crates.io-index/\"\n\"git://mirrors.ustc.edu.cn/crates.io-index\"\n# 清华\n\"https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git/\"\n# 字节\n\"https://rsproxy.cn/crates.io-index/\"\n```\n","source":"_posts/59-IB-Rust-环境搭建.md","raw":"---\ntitle: IB-Rust-环境搭建\ndate: 2025-05-20 12:17:51\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson1.1](https://github.com/Zoella-w/IB-Rust/tree/main/1.1_hello_world)\n\n[Codes in lesson1.2](https://github.com/Zoella-w/IB-Rust/tree/main/1.2_hello_cargo)\n\n## 一、Rust 介绍\n\n### 1、内存安全\n\n不允许空指针和悬空指针，可预防 C++ 中的许多类型错误\n\n### 2、静态类型\n\n编译器必须在编译期知道所有变量的类型\n\n在编译器能推导变量类型的情况下，不需要手动为变量指定类型\n\n### 3、并发编程\n\n使开发者能编写高效、安全的多线程程序，避免数据竞争等并发问题\n\n## 二、环境搭建\n\n### 1、安装\n\n通过 `rustup` 下载 Rust\n\n```shell\ncurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh\n```\n\n检查是否正确安装 Rust\n\n```console\n$ rustc --version\n```\n\n### 2、rustup 命令\n\n#### （1）升级 rust 工具链和 rustup 本身\n\n```rustup update```\n\n#### （2）卸载 rust\n\n```rustup self uninstall```\n\n#### （3）打开离线文档\n\n```rustup doc```\n\n## 三、vscode 配置\n\n1、rust-analyzer\n\n2、even-better-toml\n\n3、crates（已无法使用，换成了 Dependi）\n\n## 四、hello world\n\nrust 文件以 .rs 结尾，如 main.rs\n\n```rust\nfn main() {\n    println!(\"Hello, world!\");\n}\n```\n\n### 1、编译\n\n```shell\nrustc main.rs\n```\n\n编译成功后输出一个二进制可执行文件 main\n\n### 2、运行\n\nrust 是 **预编译静态类型**（*ahead-of-time compiled*）语言，即一旦拥有了编译后的可执行文件，不需要安装 Rust 即可运行\n\n```shell\n./main\n```\n\n## 五、cargo\n\n### 1、初始化项目\n\n```shell\ncargo new hello_cargo\ncd hello_cargo\n```\n\n其中的 Cargo.toml 文件包含：\n\n```toml\n[package]\nname = \"hello_cargo\"\nversion = \"0.1.0\"\nedition = \"2024\"\n\n[dependencies]\n```\n\n**[package]**\n\n- 项目名称\n- 项目版本\n- Rust 版本\n\n**[dependencies]**\n\n项目依赖，Rust 中的代码包为 crates\n\n### 2、构建并运行\n\n#### （1）构建\n\n```bash\ncargo build\n```\n\n创建可执行文件 *target/debug/hello_cargo*\n\n#### （2）运行\n\n```bash\n./target/debug/hello_cargo\n```\n\n#### （3）构建并运行\n\n```bash\ncargo run\n```\n\n同时编译并运行生成的可执行文件，更方便\n\n#### （4）发布构建\n\n```shell\ncargo build --release\n```\n\n在 *target/release* 下生成可执行文件，编译优化让 Rust 代码运行的更快，但消耗更长的编译时间\n\n**两种构建对比：**\n\n- `cargo build` 用于开发，因为经常需要重新构建\n\n- `cargo build --release` 用于为用户构建最终程序，不会经常重新构建，并希望程序运行得更快\n\n### 3、添加依赖\n\ncrate 是一个 Rust 代码库，可以包含任意能被其他程序使用的代码，但不能自执行\n\n添加一个随机数的库（crate）：\n\n```toml\n[dependencies]\nrand = \"0.8.5\"\n```\n\n然后重新构建项目\n\n---\n\n当增加了新依赖，Cargo 会从 [Crates.io](https://crates.io/) 获取依赖，并将指定的依赖版本写入 Cargo.lock 文件\n\n> Cargo.lock 文件\n> \n> 确保任何人在任何时候重新构建代码，都会产生相同的结果，因为 Cargo 只会使用指定的依赖版本（类似 package-lock.json）\n\n---\n\n如需升级 crate，`cargo update` 会忽略 *Cargo.lock* 文件，并计算出所有符合 *Cargo.toml* 声明的最新版本，接着将其写入 *Cargo.lock*。\n\n但是 Cargo 只会寻找 `0.8.x` 的版本，假设 `rand` crate 发布了 `0.8.6` 和 `0.9.0` 两个新版本，运行 `cargo update` 后会升级到 `0.8.6` 而不是 `0.9.0`。这是因为 `0.9.0` 相对于 `0.8.5` 主版本发生了变化。\n\n如需升级到 `0.9.x` 版本，更新 *Cargo.toml* 文件：\n\n```toml\n[dependencies]\nrand = \"0.9.0\"\n```\n\n### 4、配置国内镜像\n\n为了使用 `crates.io` 之外的注册服务，需要对 `$HOME/.cargo/config.toml` 文件进行配置，添加新的服务提供商\n\n> **cargo v1.68 开始支持稀疏索引**：不需要完整克隆 crates.io-index 仓库，加快获取包的速度\n\n> 协议推荐使用 git，如配置 git 协议后无法正常获取和编译 crate，可以换 https 协议试试\n\n两种实现方式：增加新的镜像地址 和 覆盖默认的镜像地址\n\n#### （1）增加新的镜像地址\n\n如果支持稀疏索引：\n\n```toml\n### https，任选一种即可\n[registries]\nustc = { index = \"sparse+https://mirrors.ustc.edu.cn/crates.io-index/\" }\n[registries.ustc]\nindex = \"sparse+https://mirrors.ustc.edu.cn/crates.io-index/\"\n\n### git，任选一种即可\n[registries]\nustc = { index = \"sparse+git://mirrors.ustc.edu.cn/crates.io-index/\" }\n[registries.ustc]\nindex = \"sparse+git://mirrors.ustc.edu.cn/crates.io-index/\"\n```\n\n---\n\n这种方式只会新增一个新的镜像地址，因此在引入依赖的时候，需要指定该地址，例如在项目中引入 `time` 包，你需要在 `Cargo.toml` 中使用以下方式引入:\n\n```toml\n[dependencies]\nrand = {  registry = \"ustc\" }\n```\n\n#### （2）【推荐】覆盖默认的镜像地址\n\n这种方式不需要修改 `Cargo.toml` 文件，因为它会直接使用新注册服务替代默认的 `crates.io`。\n\n在 `$HOME/.cargo/config.toml` 添加以下内容：\n\n```toml\n[source.crates-io]\nreplace-with = 'ustc'\n\n[source.ustc]\nregistry = \"https://mirrors.ustc.edu.cn/crates.io-index/\"\n```\n\n创建一个新的镜像源 `[source.ustc]`，然后将默认的 `crates-io` 替换成新的镜像源：`replace-with = 'ustc'`\n\n---\n\n**可用镜像列表：**\n\n```toml\n# 中科大\n\"https://mirrors.ustc.edu.cn/crates.io-index/\"\n\"git://mirrors.ustc.edu.cn/crates.io-index\"\n# 清华\n\"https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git/\"\n# 字节\n\"https://rsproxy.cn/crates.io-index/\"\n```\n","slug":"59-IB-Rust-环境搭建","published":1,"updated":"2025-05-21T07:30:50.725Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvuf00586kpr08nec301","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/1.1_hello_world\" >Codes in lesson1.1<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/1.2_hello_cargo\" >Codes in lesson1.2<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"一、Rust-介绍\"><a href=\"#一、Rust-介绍\" class=\"headerlink\" title=\"一、Rust 介绍\"></a>一、Rust 介绍</h2><h3 id=\"1、内存安全\"><a href=\"#1、内存安全\" class=\"headerlink\" title=\"1、内存安全\"></a>1、内存安全</h3><p>不允许空指针和悬空指针，可预防 C++ 中的许多类型错误</p>\n<h3 id=\"2、静态类型\"><a href=\"#2、静态类型\" class=\"headerlink\" title=\"2、静态类型\"></a>2、静态类型</h3><p>编译器必须在编译期知道所有变量的类型</p>\n<p>在编译器能推导变量类型的情况下，不需要手动为变量指定类型</p>\n<h3 id=\"3、并发编程\"><a href=\"#3、并发编程\" class=\"headerlink\" title=\"3、并发编程\"></a>3、并发编程</h3><p>使开发者能编写高效、安全的多线程程序，避免数据竞争等并发问题</p>\n<h2 id=\"二、环境搭建\"><a href=\"#二、环境搭建\" class=\"headerlink\" title=\"二、环境搭建\"></a>二、环境搭建</h2><h3 id=\"1、安装\"><a href=\"#1、安装\" class=\"headerlink\" title=\"1、安装\"></a>1、安装</h3><p>通过 <code>rustup</code> 下载 Rust</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl --proto &#x27;=https&#x27; --tlsv1.2 -sSf https://sh.rustup.rs | sh</span><br></pre></td></tr></table></figure></div>\n\n<p>检查是否正确安装 Rust</p>\n<div class=\"code-container\" data-rel=\"Console\"><figure class=\"iseeu highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">rustc --version</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"2、rustup-命令\"><a href=\"#2、rustup-命令\" class=\"headerlink\" title=\"2、rustup 命令\"></a>2、rustup 命令</h3><h4 id=\"（1）升级-rust-工具链和-rustup-本身\"><a href=\"#（1）升级-rust-工具链和-rustup-本身\" class=\"headerlink\" title=\"（1）升级 rust 工具链和 rustup 本身\"></a>（1）升级 rust 工具链和 rustup 本身</h4><p><code>rustup update</code></p>\n<h4 id=\"（2）卸载-rust\"><a href=\"#（2）卸载-rust\" class=\"headerlink\" title=\"（2）卸载 rust\"></a>（2）卸载 rust</h4><p><code>rustup self uninstall</code></p>\n<h4 id=\"（3）打开离线文档\"><a href=\"#（3）打开离线文档\" class=\"headerlink\" title=\"（3）打开离线文档\"></a>（3）打开离线文档</h4><p><code>rustup doc</code></p>\n<h2 id=\"三、vscode-配置\"><a href=\"#三、vscode-配置\" class=\"headerlink\" title=\"三、vscode 配置\"></a>三、vscode 配置</h2><p>1、rust-analyzer</p>\n<p>2、even-better-toml</p>\n<p>3、crates（已无法使用，换成了 Dependi）</p>\n<h2 id=\"四、hello-world\"><a href=\"#四、hello-world\" class=\"headerlink\" title=\"四、hello world\"></a>四、hello world</h2><p>rust 文件以 .rs 结尾，如 main.rs</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Hello, world!&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"1、编译\"><a href=\"#1、编译\" class=\"headerlink\" title=\"1、编译\"></a>1、编译</h3><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rustc main.rs</span><br></pre></td></tr></table></figure></div>\n\n<p>编译成功后输出一个二进制可执行文件 main</p>\n<h3 id=\"2、运行\"><a href=\"#2、运行\" class=\"headerlink\" title=\"2、运行\"></a>2、运行</h3><p>rust 是 <strong>预编译静态类型</strong>（<em>ahead-of-time compiled</em>）语言，即一旦拥有了编译后的可执行文件，不需要安装 Rust 即可运行</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./main</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"五、cargo\"><a href=\"#五、cargo\" class=\"headerlink\" title=\"五、cargo\"></a>五、cargo</h2><h3 id=\"1、初始化项目\"><a href=\"#1、初始化项目\" class=\"headerlink\" title=\"1、初始化项目\"></a>1、初始化项目</h3><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cargo new hello_cargo</span><br><span class=\"line\">cd hello_cargo</span><br></pre></td></tr></table></figure></div>\n\n<p>其中的 Cargo.toml 文件包含：</p>\n<div class=\"code-container\" data-rel=\"Toml\"><figure class=\"iseeu highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[package]</span></span><br><span class=\"line\"><span class=\"attr\">name</span> = <span class=\"string\">&quot;hello_cargo&quot;</span></span><br><span class=\"line\"><span class=\"attr\">version</span> = <span class=\"string\">&quot;0.1.0&quot;</span></span><br><span class=\"line\"><span class=\"attr\">edition</span> = <span class=\"string\">&quot;2024&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[dependencies]</span></span><br></pre></td></tr></table></figure></div>\n\n<p><strong>[package]</strong></p>\n<ul>\n<li>项目名称</li>\n<li>项目版本</li>\n<li>Rust 版本</li>\n</ul>\n<p><strong>[dependencies]</strong></p>\n<p>项目依赖，Rust 中的代码包为 crates</p>\n<h3 id=\"2、构建并运行\"><a href=\"#2、构建并运行\" class=\"headerlink\" title=\"2、构建并运行\"></a>2、构建并运行</h3><h4 id=\"（1）构建\"><a href=\"#（1）构建\" class=\"headerlink\" title=\"（1）构建\"></a>（1）构建</h4><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cargo build</span><br></pre></td></tr></table></figure></div>\n\n<p>创建可执行文件 <em>target&#x2F;debug&#x2F;hello_cargo</em></p>\n<h4 id=\"（2）运行\"><a href=\"#（2）运行\" class=\"headerlink\" title=\"（2）运行\"></a>（2）运行</h4><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./target/debug/hello_cargo</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"（3）构建并运行\"><a href=\"#（3）构建并运行\" class=\"headerlink\" title=\"（3）构建并运行\"></a>（3）构建并运行</h4><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cargo run</span><br></pre></td></tr></table></figure></div>\n\n<p>同时编译并运行生成的可执行文件，更方便</p>\n<h4 id=\"（4）发布构建\"><a href=\"#（4）发布构建\" class=\"headerlink\" title=\"（4）发布构建\"></a>（4）发布构建</h4><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cargo build --release</span><br></pre></td></tr></table></figure></div>\n\n<p>在 <em>target&#x2F;release</em> 下生成可执行文件，编译优化让 Rust 代码运行的更快，但消耗更长的编译时间</p>\n<p><strong>两种构建对比：</strong></p>\n<ul>\n<li><p><code>cargo build</code> 用于开发，因为经常需要重新构建</p>\n</li>\n<li><p><code>cargo build --release</code> 用于为用户构建最终程序，不会经常重新构建，并希望程序运行得更快</p>\n</li>\n</ul>\n<h3 id=\"3、添加依赖\"><a href=\"#3、添加依赖\" class=\"headerlink\" title=\"3、添加依赖\"></a>3、添加依赖</h3><p>crate 是一个 Rust 代码库，可以包含任意能被其他程序使用的代码，但不能自执行</p>\n<p>添加一个随机数的库（crate）：</p>\n<div class=\"code-container\" data-rel=\"Toml\"><figure class=\"iseeu highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[dependencies]</span></span><br><span class=\"line\"><span class=\"attr\">rand</span> = <span class=\"string\">&quot;0.8.5&quot;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>然后重新构建项目</p>\n<hr>\n<p>当增加了新依赖，Cargo 会从 <a class=\"link\"   href=\"https://crates.io/\" >Crates.io<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a> 获取依赖，并将指定的依赖版本写入 Cargo.lock 文件</p>\n<blockquote>\n<p>Cargo.lock 文件</p>\n<p>确保任何人在任何时候重新构建代码，都会产生相同的结果，因为 Cargo 只会使用指定的依赖版本（类似 package-lock.json）</p>\n</blockquote>\n<hr>\n<p>如需升级 crate，<code>cargo update</code> 会忽略 <em>Cargo.lock</em> 文件，并计算出所有符合 <em>Cargo.toml</em> 声明的最新版本，接着将其写入 <em>Cargo.lock</em>。</p>\n<p>但是 Cargo 只会寻找 <code>0.8.x</code> 的版本，假设 <code>rand</code> crate 发布了 <code>0.8.6</code> 和 <code>0.9.0</code> 两个新版本，运行 <code>cargo update</code> 后会升级到 <code>0.8.6</code> 而不是 <code>0.9.0</code>。这是因为 <code>0.9.0</code> 相对于 <code>0.8.5</code> 主版本发生了变化。</p>\n<p>如需升级到 <code>0.9.x</code> 版本，更新 <em>Cargo.toml</em> 文件：</p>\n<div class=\"code-container\" data-rel=\"Toml\"><figure class=\"iseeu highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[dependencies]</span></span><br><span class=\"line\"><span class=\"attr\">rand</span> = <span class=\"string\">&quot;0.9.0&quot;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"4、配置国内镜像\"><a href=\"#4、配置国内镜像\" class=\"headerlink\" title=\"4、配置国内镜像\"></a>4、配置国内镜像</h3><p>为了使用 <code>crates.io</code> 之外的注册服务，需要对 <code>$HOME/.cargo/config.toml</code> 文件进行配置，添加新的服务提供商</p>\n<blockquote>\n<p><strong>cargo v1.68 开始支持稀疏索引</strong>：不需要完整克隆 crates.io-index 仓库，加快获取包的速度</p>\n</blockquote>\n<blockquote>\n<p>协议推荐使用 git，如配置 git 协议后无法正常获取和编译 crate，可以换 https 协议试试</p>\n</blockquote>\n<p>两种实现方式：增加新的镜像地址 和 覆盖默认的镜像地址</p>\n<h4 id=\"（1）增加新的镜像地址\"><a href=\"#（1）增加新的镜像地址\" class=\"headerlink\" title=\"（1）增加新的镜像地址\"></a>（1）增加新的镜像地址</h4><p>如果支持稀疏索引：</p>\n<div class=\"code-container\" data-rel=\"Toml\"><figure class=\"iseeu highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### https，任选一种即可</span></span><br><span class=\"line\"><span class=\"section\">[registries]</span></span><br><span class=\"line\"><span class=\"attr\">ustc</span> = &#123; index = <span class=\"string\">&quot;sparse+https://mirrors.ustc.edu.cn/crates.io-index/&quot;</span> &#125;</span><br><span class=\"line\"><span class=\"section\">[registries.ustc]</span></span><br><span class=\"line\"><span class=\"attr\">index</span> = <span class=\"string\">&quot;sparse+https://mirrors.ustc.edu.cn/crates.io-index/&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### git，任选一种即可</span></span><br><span class=\"line\"><span class=\"section\">[registries]</span></span><br><span class=\"line\"><span class=\"attr\">ustc</span> = &#123; index = <span class=\"string\">&quot;sparse+git://mirrors.ustc.edu.cn/crates.io-index/&quot;</span> &#125;</span><br><span class=\"line\"><span class=\"section\">[registries.ustc]</span></span><br><span class=\"line\"><span class=\"attr\">index</span> = <span class=\"string\">&quot;sparse+git://mirrors.ustc.edu.cn/crates.io-index/&quot;</span></span><br></pre></td></tr></table></figure></div>\n\n<hr>\n<p>这种方式只会新增一个新的镜像地址，因此在引入依赖的时候，需要指定该地址，例如在项目中引入 <code>time</code> 包，你需要在 <code>Cargo.toml</code> 中使用以下方式引入:</p>\n<div class=\"code-container\" data-rel=\"Toml\"><figure class=\"iseeu highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[dependencies]</span></span><br><span class=\"line\"><span class=\"attr\">rand</span> = &#123;  registry = <span class=\"string\">&quot;ustc&quot;</span> &#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"（2）【推荐】覆盖默认的镜像地址\"><a href=\"#（2）【推荐】覆盖默认的镜像地址\" class=\"headerlink\" title=\"（2）【推荐】覆盖默认的镜像地址\"></a>（2）【推荐】覆盖默认的镜像地址</h4><p>这种方式不需要修改 <code>Cargo.toml</code> 文件，因为它会直接使用新注册服务替代默认的 <code>crates.io</code>。</p>\n<p>在 <code>$HOME/.cargo/config.toml</code> 添加以下内容：</p>\n<div class=\"code-container\" data-rel=\"Toml\"><figure class=\"iseeu highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[source.crates-io]</span></span><br><span class=\"line\"><span class=\"attr\">replace-with</span> = <span class=\"string\">&#x27;ustc&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[source.ustc]</span></span><br><span class=\"line\"><span class=\"attr\">registry</span> = <span class=\"string\">&quot;https://mirrors.ustc.edu.cn/crates.io-index/&quot;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>创建一个新的镜像源 <code>[source.ustc]</code>，然后将默认的 <code>crates-io</code> 替换成新的镜像源：<code>replace-with = &#39;ustc&#39;</code></p>\n<hr>\n<p><strong>可用镜像列表：</strong></p>\n<div class=\"code-container\" data-rel=\"Toml\"><figure class=\"iseeu highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 中科大</span></span><br><span class=\"line\">&quot;https://mirrors.ustc.edu.cn/crates.io-index/&quot;</span><br><span class=\"line\">&quot;git://mirrors.ustc.edu.cn/crates.io-index&quot;</span><br><span class=\"line\"><span class=\"comment\"># 清华</span></span><br><span class=\"line\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git/&quot;</span><br><span class=\"line\"><span class=\"comment\"># 字节</span></span><br><span class=\"line\">&quot;https://rsproxy.cn/crates.io-index/&quot;</span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/1.1_hello_world\" >Codes in lesson1.1<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/1.2_hello_cargo\" >Codes in lesson1.2<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"一、Rust-介绍\"><a href=\"#一、Rust-介绍\" class=\"headerlink\" title=\"一、Rust 介绍\"></a>一、Rust 介绍</h2><h3 id=\"1、内存安全\"><a href=\"#1、内存安全\" class=\"headerlink\" title=\"1、内存安全\"></a>1、内存安全</h3><p>不允许空指针和悬空指针，可预防 C++ 中的许多类型错误</p>\n<h3 id=\"2、静态类型\"><a href=\"#2、静态类型\" class=\"headerlink\" title=\"2、静态类型\"></a>2、静态类型</h3><p>编译器必须在编译期知道所有变量的类型</p>\n<p>在编译器能推导变量类型的情况下，不需要手动为变量指定类型</p>\n<h3 id=\"3、并发编程\"><a href=\"#3、并发编程\" class=\"headerlink\" title=\"3、并发编程\"></a>3、并发编程</h3><p>使开发者能编写高效、安全的多线程程序，避免数据竞争等并发问题</p>\n<h2 id=\"二、环境搭建\"><a href=\"#二、环境搭建\" class=\"headerlink\" title=\"二、环境搭建\"></a>二、环境搭建</h2><h3 id=\"1、安装\"><a href=\"#1、安装\" class=\"headerlink\" title=\"1、安装\"></a>1、安装</h3><p>通过 <code>rustup</code> 下载 Rust</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl --proto &#x27;=https&#x27; --tlsv1.2 -sSf https://sh.rustup.rs | sh</span><br></pre></td></tr></table></figure>\n\n<p>检查是否正确安装 Rust</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">rustc --version</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、rustup-命令\"><a href=\"#2、rustup-命令\" class=\"headerlink\" title=\"2、rustup 命令\"></a>2、rustup 命令</h3><h4 id=\"（1）升级-rust-工具链和-rustup-本身\"><a href=\"#（1）升级-rust-工具链和-rustup-本身\" class=\"headerlink\" title=\"（1）升级 rust 工具链和 rustup 本身\"></a>（1）升级 rust 工具链和 rustup 本身</h4><p><code>rustup update</code></p>\n<h4 id=\"（2）卸载-rust\"><a href=\"#（2）卸载-rust\" class=\"headerlink\" title=\"（2）卸载 rust\"></a>（2）卸载 rust</h4><p><code>rustup self uninstall</code></p>\n<h4 id=\"（3）打开离线文档\"><a href=\"#（3）打开离线文档\" class=\"headerlink\" title=\"（3）打开离线文档\"></a>（3）打开离线文档</h4><p><code>rustup doc</code></p>\n<h2 id=\"三、vscode-配置\"><a href=\"#三、vscode-配置\" class=\"headerlink\" title=\"三、vscode 配置\"></a>三、vscode 配置</h2><p>1、rust-analyzer</p>\n<p>2、even-better-toml</p>\n<p>3、crates（已无法使用，换成了 Dependi）</p>\n<h2 id=\"四、hello-world\"><a href=\"#四、hello-world\" class=\"headerlink\" title=\"四、hello world\"></a>四、hello world</h2><p>rust 文件以 .rs 结尾，如 main.rs</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Hello, world!&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1、编译\"><a href=\"#1、编译\" class=\"headerlink\" title=\"1、编译\"></a>1、编译</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rustc main.rs</span><br></pre></td></tr></table></figure>\n\n<p>编译成功后输出一个二进制可执行文件 main</p>\n<h3 id=\"2、运行\"><a href=\"#2、运行\" class=\"headerlink\" title=\"2、运行\"></a>2、运行</h3><p>rust 是 <strong>预编译静态类型</strong>（<em>ahead-of-time compiled</em>）语言，即一旦拥有了编译后的可执行文件，不需要安装 Rust 即可运行</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./main</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"五、cargo\"><a href=\"#五、cargo\" class=\"headerlink\" title=\"五、cargo\"></a>五、cargo</h2><h3 id=\"1、初始化项目\"><a href=\"#1、初始化项目\" class=\"headerlink\" title=\"1、初始化项目\"></a>1、初始化项目</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cargo new hello_cargo</span><br><span class=\"line\">cd hello_cargo</span><br></pre></td></tr></table></figure>\n\n<p>其中的 Cargo.toml 文件包含：</p>\n<figure class=\"highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[package]</span></span><br><span class=\"line\"><span class=\"attr\">name</span> = <span class=\"string\">&quot;hello_cargo&quot;</span></span><br><span class=\"line\"><span class=\"attr\">version</span> = <span class=\"string\">&quot;0.1.0&quot;</span></span><br><span class=\"line\"><span class=\"attr\">edition</span> = <span class=\"string\">&quot;2024&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[dependencies]</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>[package]</strong></p>\n<ul>\n<li>项目名称</li>\n<li>项目版本</li>\n<li>Rust 版本</li>\n</ul>\n<p><strong>[dependencies]</strong></p>\n<p>项目依赖，Rust 中的代码包为 crates</p>\n<h3 id=\"2、构建并运行\"><a href=\"#2、构建并运行\" class=\"headerlink\" title=\"2、构建并运行\"></a>2、构建并运行</h3><h4 id=\"（1）构建\"><a href=\"#（1）构建\" class=\"headerlink\" title=\"（1）构建\"></a>（1）构建</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cargo build</span><br></pre></td></tr></table></figure>\n\n<p>创建可执行文件 <em>target&#x2F;debug&#x2F;hello_cargo</em></p>\n<h4 id=\"（2）运行\"><a href=\"#（2）运行\" class=\"headerlink\" title=\"（2）运行\"></a>（2）运行</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./target/debug/hello_cargo</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"（3）构建并运行\"><a href=\"#（3）构建并运行\" class=\"headerlink\" title=\"（3）构建并运行\"></a>（3）构建并运行</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cargo run</span><br></pre></td></tr></table></figure>\n\n<p>同时编译并运行生成的可执行文件，更方便</p>\n<h4 id=\"（4）发布构建\"><a href=\"#（4）发布构建\" class=\"headerlink\" title=\"（4）发布构建\"></a>（4）发布构建</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cargo build --release</span><br></pre></td></tr></table></figure>\n\n<p>在 <em>target&#x2F;release</em> 下生成可执行文件，编译优化让 Rust 代码运行的更快，但消耗更长的编译时间</p>\n<p><strong>两种构建对比：</strong></p>\n<ul>\n<li><p><code>cargo build</code> 用于开发，因为经常需要重新构建</p>\n</li>\n<li><p><code>cargo build --release</code> 用于为用户构建最终程序，不会经常重新构建，并希望程序运行得更快</p>\n</li>\n</ul>\n<h3 id=\"3、添加依赖\"><a href=\"#3、添加依赖\" class=\"headerlink\" title=\"3、添加依赖\"></a>3、添加依赖</h3><p>crate 是一个 Rust 代码库，可以包含任意能被其他程序使用的代码，但不能自执行</p>\n<p>添加一个随机数的库（crate）：</p>\n<figure class=\"highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[dependencies]</span></span><br><span class=\"line\"><span class=\"attr\">rand</span> = <span class=\"string\">&quot;0.8.5&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>然后重新构建项目</p>\n<hr>\n<p>当增加了新依赖，Cargo 会从 <a class=\"link\"   href=\"https://crates.io/\" >Crates.io<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a> 获取依赖，并将指定的依赖版本写入 Cargo.lock 文件</p>\n<blockquote>\n<p>Cargo.lock 文件</p>\n<p>确保任何人在任何时候重新构建代码，都会产生相同的结果，因为 Cargo 只会使用指定的依赖版本（类似 package-lock.json）</p>\n</blockquote>\n<hr>\n<p>如需升级 crate，<code>cargo update</code> 会忽略 <em>Cargo.lock</em> 文件，并计算出所有符合 <em>Cargo.toml</em> 声明的最新版本，接着将其写入 <em>Cargo.lock</em>。</p>\n<p>但是 Cargo 只会寻找 <code>0.8.x</code> 的版本，假设 <code>rand</code> crate 发布了 <code>0.8.6</code> 和 <code>0.9.0</code> 两个新版本，运行 <code>cargo update</code> 后会升级到 <code>0.8.6</code> 而不是 <code>0.9.0</code>。这是因为 <code>0.9.0</code> 相对于 <code>0.8.5</code> 主版本发生了变化。</p>\n<p>如需升级到 <code>0.9.x</code> 版本，更新 <em>Cargo.toml</em> 文件：</p>\n<figure class=\"highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[dependencies]</span></span><br><span class=\"line\"><span class=\"attr\">rand</span> = <span class=\"string\">&quot;0.9.0&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4、配置国内镜像\"><a href=\"#4、配置国内镜像\" class=\"headerlink\" title=\"4、配置国内镜像\"></a>4、配置国内镜像</h3><p>为了使用 <code>crates.io</code> 之外的注册服务，需要对 <code>$HOME/.cargo/config.toml</code> 文件进行配置，添加新的服务提供商</p>\n<blockquote>\n<p><strong>cargo v1.68 开始支持稀疏索引</strong>：不需要完整克隆 crates.io-index 仓库，加快获取包的速度</p>\n</blockquote>\n<blockquote>\n<p>协议推荐使用 git，如配置 git 协议后无法正常获取和编译 crate，可以换 https 协议试试</p>\n</blockquote>\n<p>两种实现方式：增加新的镜像地址 和 覆盖默认的镜像地址</p>\n<h4 id=\"（1）增加新的镜像地址\"><a href=\"#（1）增加新的镜像地址\" class=\"headerlink\" title=\"（1）增加新的镜像地址\"></a>（1）增加新的镜像地址</h4><p>如果支持稀疏索引：</p>\n<figure class=\"highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### https，任选一种即可</span></span><br><span class=\"line\"><span class=\"section\">[registries]</span></span><br><span class=\"line\"><span class=\"attr\">ustc</span> = &#123; index = <span class=\"string\">&quot;sparse+https://mirrors.ustc.edu.cn/crates.io-index/&quot;</span> &#125;</span><br><span class=\"line\"><span class=\"section\">[registries.ustc]</span></span><br><span class=\"line\"><span class=\"attr\">index</span> = <span class=\"string\">&quot;sparse+https://mirrors.ustc.edu.cn/crates.io-index/&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### git，任选一种即可</span></span><br><span class=\"line\"><span class=\"section\">[registries]</span></span><br><span class=\"line\"><span class=\"attr\">ustc</span> = &#123; index = <span class=\"string\">&quot;sparse+git://mirrors.ustc.edu.cn/crates.io-index/&quot;</span> &#125;</span><br><span class=\"line\"><span class=\"section\">[registries.ustc]</span></span><br><span class=\"line\"><span class=\"attr\">index</span> = <span class=\"string\">&quot;sparse+git://mirrors.ustc.edu.cn/crates.io-index/&quot;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<p>这种方式只会新增一个新的镜像地址，因此在引入依赖的时候，需要指定该地址，例如在项目中引入 <code>time</code> 包，你需要在 <code>Cargo.toml</code> 中使用以下方式引入:</p>\n<figure class=\"highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[dependencies]</span></span><br><span class=\"line\"><span class=\"attr\">rand</span> = &#123;  registry = <span class=\"string\">&quot;ustc&quot;</span> &#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"（2）【推荐】覆盖默认的镜像地址\"><a href=\"#（2）【推荐】覆盖默认的镜像地址\" class=\"headerlink\" title=\"（2）【推荐】覆盖默认的镜像地址\"></a>（2）【推荐】覆盖默认的镜像地址</h4><p>这种方式不需要修改 <code>Cargo.toml</code> 文件，因为它会直接使用新注册服务替代默认的 <code>crates.io</code>。</p>\n<p>在 <code>$HOME/.cargo/config.toml</code> 添加以下内容：</p>\n<figure class=\"highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[source.crates-io]</span></span><br><span class=\"line\"><span class=\"attr\">replace-with</span> = <span class=\"string\">&#x27;ustc&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[source.ustc]</span></span><br><span class=\"line\"><span class=\"attr\">registry</span> = <span class=\"string\">&quot;https://mirrors.ustc.edu.cn/crates.io-index/&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>创建一个新的镜像源 <code>[source.ustc]</code>，然后将默认的 <code>crates-io</code> 替换成新的镜像源：<code>replace-with = &#39;ustc&#39;</code></p>\n<hr>\n<p><strong>可用镜像列表：</strong></p>\n<figure class=\"highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 中科大</span></span><br><span class=\"line\">&quot;https://mirrors.ustc.edu.cn/crates.io-index/&quot;</span><br><span class=\"line\">&quot;git://mirrors.ustc.edu.cn/crates.io-index&quot;</span><br><span class=\"line\"><span class=\"comment\"># 清华</span></span><br><span class=\"line\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git/&quot;</span><br><span class=\"line\"><span class=\"comment\"># 字节</span></span><br><span class=\"line\">&quot;https://rsproxy.cn/crates.io-index/&quot;</span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"vue class 与 style 绑定","date":"2023-11-28T11:03:13.000Z","_content":"\n## 绑定一个返回对象的计算属性\n\n``` js\nconst isActive = ref(true);\nconst error = ref(null);\n\nconst classObject = computed(() => ({\n    active: isActive.value && !error.value,\n    'text-danger': error.value && error.value.type === 'fatal'\n}));\n```\n\n``` html\n<div :class=\"classObject\"></div>\n```\n\n## 子组件继承父组件传入的class\n\n### 有一个根元素的组件\n\n子组件的根元素，在渲染时会添加父组件的 class。\n\n### 有多个根元素的组件\n\n子组件中 ```:class='$attrs.class'``` 的根元素，在渲染时会添加父组件的 class。\n\n``` html\n<!-- 子组件 MyComponent.vue -->\n<p :class=\"$attrs.class\">one root element</p>\n<span>another root element</span>\n```\n\n``` html\n<!-- 父组件 -->\n<MyComponent class=\"fatherClass\"/>\n```\n\n渲染后结果：\n\n``` html\n<p class=\"fatherClass\">one root element</p>\n<span>another root element</span>\n```\n\n## 內联样式\n\n### 绑定对象\n\n``` js\nconst styleObject = reactive({\n    color: \"red\",\n    fontSize: \"13px\"\n});\n```\n\n``` html\n<div :style=\"styleObject\"></div>\n```\n\n### 绑定对象数组\n\n``` html\n<div :style=\"[baseStyle, overriddingStyle]\"></div>\n```\n\n``` js\nconst baseStyle = reactive({\n    color: \"red\",\n    ...\n});\nconst overriddingStyle = reactive({\n    color: \"black\",\n    ...\n});\n```\n","source":"_posts/6-vue class与style绑定.md","raw":"---\ntitle: vue class 与 style 绑定\ndate: 2023-11-28 19:03:13\ntags:\n    - vue3\n    - vue\ncategories:\n    - vue\n      - 样式\n    - vue3\n      - 文档\n---\n\n## 绑定一个返回对象的计算属性\n\n``` js\nconst isActive = ref(true);\nconst error = ref(null);\n\nconst classObject = computed(() => ({\n    active: isActive.value && !error.value,\n    'text-danger': error.value && error.value.type === 'fatal'\n}));\n```\n\n``` html\n<div :class=\"classObject\"></div>\n```\n\n## 子组件继承父组件传入的class\n\n### 有一个根元素的组件\n\n子组件的根元素，在渲染时会添加父组件的 class。\n\n### 有多个根元素的组件\n\n子组件中 ```:class='$attrs.class'``` 的根元素，在渲染时会添加父组件的 class。\n\n``` html\n<!-- 子组件 MyComponent.vue -->\n<p :class=\"$attrs.class\">one root element</p>\n<span>another root element</span>\n```\n\n``` html\n<!-- 父组件 -->\n<MyComponent class=\"fatherClass\"/>\n```\n\n渲染后结果：\n\n``` html\n<p class=\"fatherClass\">one root element</p>\n<span>another root element</span>\n```\n\n## 內联样式\n\n### 绑定对象\n\n``` js\nconst styleObject = reactive({\n    color: \"red\",\n    fontSize: \"13px\"\n});\n```\n\n``` html\n<div :style=\"styleObject\"></div>\n```\n\n### 绑定对象数组\n\n``` html\n<div :style=\"[baseStyle, overriddingStyle]\"></div>\n```\n\n``` js\nconst baseStyle = reactive({\n    color: \"red\",\n    ...\n});\nconst overriddingStyle = reactive({\n    color: \"black\",\n    ...\n});\n```\n","slug":"6-vue class与style绑定","published":1,"updated":"2025-05-20T02:47:28.686Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvuf005d6kpr7x28epn8","content":"<h2 id=\"绑定一个返回对象的计算属性\"><a href=\"#绑定一个返回对象的计算属性\" class=\"headerlink\" title=\"绑定一个返回对象的计算属性\"></a>绑定一个返回对象的计算属性</h2><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> isActive = <span class=\"title function_\">ref</span>(<span class=\"literal\">true</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> error = <span class=\"title function_\">ref</span>(<span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> classObject = <span class=\"title function_\">computed</span>(<span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"attr\">active</span>: isActive.<span class=\"property\">value</span> &amp;&amp; !error.<span class=\"property\">value</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;text-danger&#x27;</span>: error.<span class=\"property\">value</span> &amp;&amp; error.<span class=\"property\">value</span>.<span class=\"property\">type</span> === <span class=\"string\">&#x27;fatal&#x27;</span></span><br><span class=\"line\">&#125;));</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;classObject&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"子组件继承父组件传入的class\"><a href=\"#子组件继承父组件传入的class\" class=\"headerlink\" title=\"子组件继承父组件传入的class\"></a>子组件继承父组件传入的class</h2><h3 id=\"有一个根元素的组件\"><a href=\"#有一个根元素的组件\" class=\"headerlink\" title=\"有一个根元素的组件\"></a>有一个根元素的组件</h3><p>子组件的根元素，在渲染时会添加父组件的 class。</p>\n<h3 id=\"有多个根元素的组件\"><a href=\"#有多个根元素的组件\" class=\"headerlink\" title=\"有多个根元素的组件\"></a>有多个根元素的组件</h3><p>子组件中 <code>:class=&#39;$attrs.class&#39;</code> 的根元素，在渲染时会添加父组件的 class。</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 MyComponent.vue --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;$attrs.class&quot;</span>&gt;</span>one root element<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>another root element<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">MyComponent</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fatherClass&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>渲染后结果：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fatherClass&quot;</span>&gt;</span>one root element<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>another root element<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"內联样式\"><a href=\"#內联样式\" class=\"headerlink\" title=\"內联样式\"></a>內联样式</h2><h3 id=\"绑定对象\"><a href=\"#绑定对象\" class=\"headerlink\" title=\"绑定对象\"></a>绑定对象</h3><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> styleObject = <span class=\"title function_\">reactive</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">color</span>: <span class=\"string\">&quot;red&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">fontSize</span>: <span class=\"string\">&quot;13px&quot;</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">:style</span>=<span class=\"string\">&quot;styleObject&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"绑定对象数组\"><a href=\"#绑定对象数组\" class=\"headerlink\" title=\"绑定对象数组\"></a>绑定对象数组</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">:style</span>=<span class=\"string\">&quot;[baseStyle, overriddingStyle]&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> baseStyle = <span class=\"title function_\">reactive</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">color</span>: <span class=\"string\">&quot;red&quot;</span>,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">const</span> overriddingStyle = <span class=\"title function_\">reactive</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">color</span>: <span class=\"string\">&quot;black&quot;</span>,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"绑定一个返回对象的计算属性\"><a href=\"#绑定一个返回对象的计算属性\" class=\"headerlink\" title=\"绑定一个返回对象的计算属性\"></a>绑定一个返回对象的计算属性</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> isActive = <span class=\"title function_\">ref</span>(<span class=\"literal\">true</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> error = <span class=\"title function_\">ref</span>(<span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> classObject = <span class=\"title function_\">computed</span>(<span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"attr\">active</span>: isActive.<span class=\"property\">value</span> &amp;&amp; !error.<span class=\"property\">value</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;text-danger&#x27;</span>: error.<span class=\"property\">value</span> &amp;&amp; error.<span class=\"property\">value</span>.<span class=\"property\">type</span> === <span class=\"string\">&#x27;fatal&#x27;</span></span><br><span class=\"line\">&#125;));</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;classObject&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"子组件继承父组件传入的class\"><a href=\"#子组件继承父组件传入的class\" class=\"headerlink\" title=\"子组件继承父组件传入的class\"></a>子组件继承父组件传入的class</h2><h3 id=\"有一个根元素的组件\"><a href=\"#有一个根元素的组件\" class=\"headerlink\" title=\"有一个根元素的组件\"></a>有一个根元素的组件</h3><p>子组件的根元素，在渲染时会添加父组件的 class。</p>\n<h3 id=\"有多个根元素的组件\"><a href=\"#有多个根元素的组件\" class=\"headerlink\" title=\"有多个根元素的组件\"></a>有多个根元素的组件</h3><p>子组件中 <code>:class=&#39;$attrs.class&#39;</code> 的根元素，在渲染时会添加父组件的 class。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 子组件 MyComponent.vue --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;$attrs.class&quot;</span>&gt;</span>one root element<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>another root element<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 父组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">MyComponent</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fatherClass&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>渲染后结果：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fatherClass&quot;</span>&gt;</span>one root element<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>another root element<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"內联样式\"><a href=\"#內联样式\" class=\"headerlink\" title=\"內联样式\"></a>內联样式</h2><h3 id=\"绑定对象\"><a href=\"#绑定对象\" class=\"headerlink\" title=\"绑定对象\"></a>绑定对象</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> styleObject = <span class=\"title function_\">reactive</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">color</span>: <span class=\"string\">&quot;red&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">fontSize</span>: <span class=\"string\">&quot;13px&quot;</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">:style</span>=<span class=\"string\">&quot;styleObject&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"绑定对象数组\"><a href=\"#绑定对象数组\" class=\"headerlink\" title=\"绑定对象数组\"></a>绑定对象数组</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">:style</span>=<span class=\"string\">&quot;[baseStyle, overriddingStyle]&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> baseStyle = <span class=\"title function_\">reactive</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">color</span>: <span class=\"string\">&quot;red&quot;</span>,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">const</span> overriddingStyle = <span class=\"title function_\">reactive</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">color</span>: <span class=\"string\">&quot;black&quot;</span>,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"IB-Rust-变量&可变类型","date":"2025-05-20T09:50:23.000Z","_content":"\n[Codes in lesson2](https://github.com/Zoella-w/IB-Rust/tree/main/2_variable_mut)\n\n## 一、可变 & 不可变变量（Mutable & Immutable）\n\nRust 的变量默认不可改变（immutable），如果想改变，需要声明可变变量（mutable）\n\n### 1、声明不可变变量\n\n``` rust \nlet x = 5;\n```\n\n### 2、声明可变变量\n\n``` rust\nlet mut x = 5;\nx = 6;\n```\n\n## 二、常量（Constants）\n\nRust 中用 const 关键字定义一个常量，定义时需要指定其数据类型\n\n### 常量的特点：\n\n- 必须指定数据类型\n- 常量名使用大写字母，否则会 warning\n- 必须使用常量表达式赋值，即编译期能计算出的值\n- 不支持重定义（遮蔽）\n\n> 常量与不可变变量的区别？\n>\n> - 常量使用 const 声明，不可变变量使用 let 声明\n> - 常量的值不能在运行时改变，不可变变量在运行期才确定\n> - 常量不可修改，不可变变量可通过重定义（shadowing）修改\n> - 常量必须声明类型\n> - 常量必须使用大写字母\n\n## 三、静态变量\n\n- 静态变量使用 static 关键字声明，在编译时分配内存，并在程序运行期间一直存在\n- 静态变量可以在整个程序中共存，并可以在多个线程之间共享\n- 静态变量的值在运行期间不会改变，常用于存储程序的全局状态\n\n> 静态变量与常量的异同\n>\n> 相似性：\n> - 名称要求使用大写，否则 warning\n> - 必须指定类型\n> - 必须使用常量表达式赋值，即编译期能计算出的值\n> - 都不支持重定义（shadowing）\n>\n> 不同点：\n>\n> 常量值直接嵌入代码，无独立存储，而静态变量存储在静态内存区，独立占用内存\n> 常量不可变，而**静态变量和普通变量一样，默认不可变，但可以通过 mut 关键字定义为可变**（必须在 unsafe{} 中）\n> 变量用于数学常数、固定配置，静态变量用于全局状态管理、跨线程共享数据\n\n## 四、作用域 & 遮蔽（variable & shadowing）\n\n变量绑定在一个作用域（scope）中，即被限定只在一个代码块（block）中生存（live）\n\n变量遮蔽（variable shadowing）即重定义\n","source":"_posts/60-IB-Rust-变量&可变类型.md","raw":"---\ntitle: IB-Rust-变量&可变类型\ndate: 2025-05-20 17:50:23\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson2](https://github.com/Zoella-w/IB-Rust/tree/main/2_variable_mut)\n\n## 一、可变 & 不可变变量（Mutable & Immutable）\n\nRust 的变量默认不可改变（immutable），如果想改变，需要声明可变变量（mutable）\n\n### 1、声明不可变变量\n\n``` rust \nlet x = 5;\n```\n\n### 2、声明可变变量\n\n``` rust\nlet mut x = 5;\nx = 6;\n```\n\n## 二、常量（Constants）\n\nRust 中用 const 关键字定义一个常量，定义时需要指定其数据类型\n\n### 常量的特点：\n\n- 必须指定数据类型\n- 常量名使用大写字母，否则会 warning\n- 必须使用常量表达式赋值，即编译期能计算出的值\n- 不支持重定义（遮蔽）\n\n> 常量与不可变变量的区别？\n>\n> - 常量使用 const 声明，不可变变量使用 let 声明\n> - 常量的值不能在运行时改变，不可变变量在运行期才确定\n> - 常量不可修改，不可变变量可通过重定义（shadowing）修改\n> - 常量必须声明类型\n> - 常量必须使用大写字母\n\n## 三、静态变量\n\n- 静态变量使用 static 关键字声明，在编译时分配内存，并在程序运行期间一直存在\n- 静态变量可以在整个程序中共存，并可以在多个线程之间共享\n- 静态变量的值在运行期间不会改变，常用于存储程序的全局状态\n\n> 静态变量与常量的异同\n>\n> 相似性：\n> - 名称要求使用大写，否则 warning\n> - 必须指定类型\n> - 必须使用常量表达式赋值，即编译期能计算出的值\n> - 都不支持重定义（shadowing）\n>\n> 不同点：\n>\n> 常量值直接嵌入代码，无独立存储，而静态变量存储在静态内存区，独立占用内存\n> 常量不可变，而**静态变量和普通变量一样，默认不可变，但可以通过 mut 关键字定义为可变**（必须在 unsafe{} 中）\n> 变量用于数学常数、固定配置，静态变量用于全局状态管理、跨线程共享数据\n\n## 四、作用域 & 遮蔽（variable & shadowing）\n\n变量绑定在一个作用域（scope）中，即被限定只在一个代码块（block）中生存（live）\n\n变量遮蔽（variable shadowing）即重定义\n","slug":"60-IB-Rust-变量&可变类型","published":1,"updated":"2025-05-21T07:31:50.446Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvuf005g6kpr7tuc3l9o","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/2_variable_mut\" >Codes in lesson2<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"一、可变-不可变变量（Mutable-Immutable）\"><a href=\"#一、可变-不可变变量（Mutable-Immutable）\" class=\"headerlink\" title=\"一、可变 &amp; 不可变变量（Mutable &amp; Immutable）\"></a>一、可变 &amp; 不可变变量（Mutable &amp; Immutable）</h2><p>Rust 的变量默认不可改变（immutable），如果想改变，需要声明可变变量（mutable）</p>\n<h3 id=\"1、声明不可变变量\"><a href=\"#1、声明不可变变量\" class=\"headerlink\" title=\"1、声明不可变变量\"></a>1、声明不可变变量</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">x</span> = <span class=\"number\">5</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"2、声明可变变量\"><a href=\"#2、声明可变变量\" class=\"headerlink\" title=\"2、声明可变变量\"></a>2、声明可变变量</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">x</span> = <span class=\"number\">5</span>;</span><br><span class=\"line\">x = <span class=\"number\">6</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"二、常量（Constants）\"><a href=\"#二、常量（Constants）\" class=\"headerlink\" title=\"二、常量（Constants）\"></a>二、常量（Constants）</h2><p>Rust 中用 const 关键字定义一个常量，定义时需要指定其数据类型</p>\n<h3 id=\"常量的特点：\"><a href=\"#常量的特点：\" class=\"headerlink\" title=\"常量的特点：\"></a>常量的特点：</h3><ul>\n<li>必须指定数据类型</li>\n<li>常量名使用大写字母，否则会 warning</li>\n<li>必须使用常量表达式赋值，即编译期能计算出的值</li>\n<li>不支持重定义（遮蔽）</li>\n</ul>\n<blockquote>\n<p>常量与不可变变量的区别？</p>\n<ul>\n<li>常量使用 const 声明，不可变变量使用 let 声明</li>\n<li>常量的值不能在运行时改变，不可变变量在运行期才确定</li>\n<li>常量不可修改，不可变变量可通过重定义（shadowing）修改</li>\n<li>常量必须声明类型</li>\n<li>常量必须使用大写字母</li>\n</ul>\n</blockquote>\n<h2 id=\"三、静态变量\"><a href=\"#三、静态变量\" class=\"headerlink\" title=\"三、静态变量\"></a>三、静态变量</h2><ul>\n<li>静态变量使用 static 关键字声明，在编译时分配内存，并在程序运行期间一直存在</li>\n<li>静态变量可以在整个程序中共存，并可以在多个线程之间共享</li>\n<li>静态变量的值在运行期间不会改变，常用于存储程序的全局状态</li>\n</ul>\n<blockquote>\n<p>静态变量与常量的异同</p>\n<p>相似性：</p>\n<ul>\n<li>名称要求使用大写，否则 warning</li>\n<li>必须指定类型</li>\n<li>必须使用常量表达式赋值，即编译期能计算出的值</li>\n<li>都不支持重定义（shadowing）</li>\n</ul>\n<p>不同点：</p>\n<p>常量值直接嵌入代码，无独立存储，而静态变量存储在静态内存区，独立占用内存<br>常量不可变，而<strong>静态变量和普通变量一样，默认不可变，但可以通过 mut 关键字定义为可变</strong>（必须在 unsafe{} 中）<br>变量用于数学常数、固定配置，静态变量用于全局状态管理、跨线程共享数据</p>\n</blockquote>\n<h2 id=\"四、作用域-遮蔽（variable-shadowing）\"><a href=\"#四、作用域-遮蔽（variable-shadowing）\" class=\"headerlink\" title=\"四、作用域 &amp; 遮蔽（variable &amp; shadowing）\"></a>四、作用域 &amp; 遮蔽（variable &amp; shadowing）</h2><p>变量绑定在一个作用域（scope）中，即被限定只在一个代码块（block）中生存（live）</p>\n<p>变量遮蔽（variable shadowing）即重定义</p>\n","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/2_variable_mut\" >Codes in lesson2<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"一、可变-不可变变量（Mutable-Immutable）\"><a href=\"#一、可变-不可变变量（Mutable-Immutable）\" class=\"headerlink\" title=\"一、可变 &amp; 不可变变量（Mutable &amp; Immutable）\"></a>一、可变 &amp; 不可变变量（Mutable &amp; Immutable）</h2><p>Rust 的变量默认不可改变（immutable），如果想改变，需要声明可变变量（mutable）</p>\n<h3 id=\"1、声明不可变变量\"><a href=\"#1、声明不可变变量\" class=\"headerlink\" title=\"1、声明不可变变量\"></a>1、声明不可变变量</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">x</span> = <span class=\"number\">5</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、声明可变变量\"><a href=\"#2、声明可变变量\" class=\"headerlink\" title=\"2、声明可变变量\"></a>2、声明可变变量</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">x</span> = <span class=\"number\">5</span>;</span><br><span class=\"line\">x = <span class=\"number\">6</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"二、常量（Constants）\"><a href=\"#二、常量（Constants）\" class=\"headerlink\" title=\"二、常量（Constants）\"></a>二、常量（Constants）</h2><p>Rust 中用 const 关键字定义一个常量，定义时需要指定其数据类型</p>\n<h3 id=\"常量的特点：\"><a href=\"#常量的特点：\" class=\"headerlink\" title=\"常量的特点：\"></a>常量的特点：</h3><ul>\n<li>必须指定数据类型</li>\n<li>常量名使用大写字母，否则会 warning</li>\n<li>必须使用常量表达式赋值，即编译期能计算出的值</li>\n<li>不支持重定义（遮蔽）</li>\n</ul>\n<blockquote>\n<p>常量与不可变变量的区别？</p>\n<ul>\n<li>常量使用 const 声明，不可变变量使用 let 声明</li>\n<li>常量的值不能在运行时改变，不可变变量在运行期才确定</li>\n<li>常量不可修改，不可变变量可通过重定义（shadowing）修改</li>\n<li>常量必须声明类型</li>\n<li>常量必须使用大写字母</li>\n</ul>\n</blockquote>\n<h2 id=\"三、静态变量\"><a href=\"#三、静态变量\" class=\"headerlink\" title=\"三、静态变量\"></a>三、静态变量</h2><ul>\n<li>静态变量使用 static 关键字声明，在编译时分配内存，并在程序运行期间一直存在</li>\n<li>静态变量可以在整个程序中共存，并可以在多个线程之间共享</li>\n<li>静态变量的值在运行期间不会改变，常用于存储程序的全局状态</li>\n</ul>\n<blockquote>\n<p>静态变量与常量的异同</p>\n<p>相似性：</p>\n<ul>\n<li>名称要求使用大写，否则 warning</li>\n<li>必须指定类型</li>\n<li>必须使用常量表达式赋值，即编译期能计算出的值</li>\n<li>都不支持重定义（shadowing）</li>\n</ul>\n<p>不同点：</p>\n<p>常量值直接嵌入代码，无独立存储，而静态变量存储在静态内存区，独立占用内存<br>常量不可变，而<strong>静态变量和普通变量一样，默认不可变，但可以通过 mut 关键字定义为可变</strong>（必须在 unsafe{} 中）<br>变量用于数学常数、固定配置，静态变量用于全局状态管理、跨线程共享数据</p>\n</blockquote>\n<h2 id=\"四、作用域-遮蔽（variable-shadowing）\"><a href=\"#四、作用域-遮蔽（variable-shadowing）\" class=\"headerlink\" title=\"四、作用域 &amp; 遮蔽（variable &amp; shadowing）\"></a>四、作用域 &amp; 遮蔽（variable &amp; shadowing）</h2><p>变量绑定在一个作用域（scope）中，即被限定只在一个代码块（block）中生存（live）</p>\n<p>变量遮蔽（variable shadowing）即重定义</p>\n","_processedHighlight":true},{"title":"IB-Rust-函数","date":"2025-05-21T05:48:11.000Z","_content":"\n[Codes in lesson3](https://github.com/Zoella-w/IB-Rust/tree/main/3_func)\n\n## 函数组成\n\n- 声明函数的关键字 `fn`\n- 函数名 `add()`\n- 参数 `i` 和 `j`和参数类型`i32`\n- 返回值类型`i32`\n- 函数体`i + j` <!--注意这里没有return -->\n\n注意：函数可以在任意位置定义\n\n### 函数名\n\n开头是字符/下划线，后面是数字，下划线，字母（不能仅有下划线）\n\n函数名和变量名使用[蛇形命名法（snake case）](https://course.rs/practice/naming.html)，如：`fn add_two() -> {}`\n\n### 函数参数\n\nRust 是强类型语言，需要为所有函数参数标识具体类型\n\n### 函数返回\n\n函数返回值是函数体最后一条表达式的返回值，也可以使用 `return` 提前返回，初学者只需记住两种形态：\n\n```rust\n// 没有return + 没有分号\nfn add(i: i32, j: i32) -> i32 {\n    i + j\n}\n\n// return + 分号\nfn add(i: i32, j: i32) -> i32 {\n    return i + j;\n}\n```\n\n#### 特殊返回类型\n\n##### 1、无返回值`()`\n\n如果一个函数没有返回值，就返回`()`\n\n```rust\nfn print(i: i32) {\n    println!(\"{}\", i);\n}\n\nfn print(i: i32) -> () {\n    println!(\"{}\", i);\n}\n```\n\n##### 2、函数永不返回\n\n函数返回类型为`!`时，表示该函数永不返回（diverge function），常用做会导致程序崩溃的函数：\n\n```rust\nfn dead_end() -> ! {\n  panic!(\"崩溃\");\n}\n```\n\n下面的函数创建了一个无限循环，也永不返回：\n\n```rust\nfn forever() -> ! {\n  loop {\n    //...\n  };\n}\n```\n\n## 练习题\n\nhttps://practice-zh.course.rs/basic-types/functions.html\n","source":"_posts/61-IB-Rust-函数.md","raw":"---\ntitle: IB-Rust-函数\ndate: 2025-05-21 13:48:11\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson3](https://github.com/Zoella-w/IB-Rust/tree/main/3_func)\n\n## 函数组成\n\n- 声明函数的关键字 `fn`\n- 函数名 `add()`\n- 参数 `i` 和 `j`和参数类型`i32`\n- 返回值类型`i32`\n- 函数体`i + j` <!--注意这里没有return -->\n\n注意：函数可以在任意位置定义\n\n### 函数名\n\n开头是字符/下划线，后面是数字，下划线，字母（不能仅有下划线）\n\n函数名和变量名使用[蛇形命名法（snake case）](https://course.rs/practice/naming.html)，如：`fn add_two() -> {}`\n\n### 函数参数\n\nRust 是强类型语言，需要为所有函数参数标识具体类型\n\n### 函数返回\n\n函数返回值是函数体最后一条表达式的返回值，也可以使用 `return` 提前返回，初学者只需记住两种形态：\n\n```rust\n// 没有return + 没有分号\nfn add(i: i32, j: i32) -> i32 {\n    i + j\n}\n\n// return + 分号\nfn add(i: i32, j: i32) -> i32 {\n    return i + j;\n}\n```\n\n#### 特殊返回类型\n\n##### 1、无返回值`()`\n\n如果一个函数没有返回值，就返回`()`\n\n```rust\nfn print(i: i32) {\n    println!(\"{}\", i);\n}\n\nfn print(i: i32) -> () {\n    println!(\"{}\", i);\n}\n```\n\n##### 2、函数永不返回\n\n函数返回类型为`!`时，表示该函数永不返回（diverge function），常用做会导致程序崩溃的函数：\n\n```rust\nfn dead_end() -> ! {\n  panic!(\"崩溃\");\n}\n```\n\n下面的函数创建了一个无限循环，也永不返回：\n\n```rust\nfn forever() -> ! {\n  loop {\n    //...\n  };\n}\n```\n\n## 练习题\n\nhttps://practice-zh.course.rs/basic-types/functions.html\n","slug":"61-IB-Rust-函数","published":1,"updated":"2025-05-21T07:31:34.188Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvuf005l6kprh8ih1vh9","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/3_func\" >Codes in lesson3<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"函数组成\"><a href=\"#函数组成\" class=\"headerlink\" title=\"函数组成\"></a>函数组成</h2><ul>\n<li>声明函数的关键字 <code>fn</code></li>\n<li>函数名 <code>add()</code></li>\n<li>参数 <code>i</code> 和 <code>j</code>和参数类型<code>i32</code></li>\n<li>返回值类型<code>i32</code></li>\n<li>函数体<code>i + j</code> <!--注意这里没有return --></li>\n</ul>\n<p>注意：函数可以在任意位置定义</p>\n<h3 id=\"函数名\"><a href=\"#函数名\" class=\"headerlink\" title=\"函数名\"></a>函数名</h3><p>开头是字符&#x2F;下划线，后面是数字，下划线，字母（不能仅有下划线）</p>\n<p>函数名和变量名使用<a class=\"link\"   href=\"https://course.rs/practice/naming.html\" >蛇形命名法（snake case）<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>，如：<code>fn add_two() -&gt; &#123;&#125;</code></p>\n<h3 id=\"函数参数\"><a href=\"#函数参数\" class=\"headerlink\" title=\"函数参数\"></a>函数参数</h3><p>Rust 是强类型语言，需要为所有函数参数标识具体类型</p>\n<h3 id=\"函数返回\"><a href=\"#函数返回\" class=\"headerlink\" title=\"函数返回\"></a>函数返回</h3><p>函数返回值是函数体最后一条表达式的返回值，也可以使用 <code>return</code> 提前返回，初学者只需记住两种形态：</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 没有return + 没有分号</span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">add</span>(i: <span class=\"type\">i32</span>, j: <span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">i32</span> &#123;</span><br><span class=\"line\">    i + j</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// return + 分号</span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">add</span>(i: <span class=\"type\">i32</span>, j: <span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">i32</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> i + j;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"特殊返回类型\"><a href=\"#特殊返回类型\" class=\"headerlink\" title=\"特殊返回类型\"></a>特殊返回类型</h4><h5 id=\"1、无返回值\"><a href=\"#1、无返回值\" class=\"headerlink\" title=\"1、无返回值()\"></a>1、无返回值<code>()</code></h5><p>如果一个函数没有返回值，就返回<code>()</code></p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">print</span>(i: <span class=\"type\">i32</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, i);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">print</span>(i: <span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> () &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, i);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h5 id=\"2、函数永不返回\"><a href=\"#2、函数永不返回\" class=\"headerlink\" title=\"2、函数永不返回\"></a>2、函数永不返回</h5><p>函数返回类型为<code>!</code>时，表示该函数永不返回（diverge function），常用做会导致程序崩溃的函数：</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">dead_end</span>() <span class=\"punctuation\">-&gt;</span> ! &#123;</span><br><span class=\"line\">  <span class=\"built_in\">panic!</span>(<span class=\"string\">&quot;崩溃&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>下面的函数创建了一个无限循环，也永不返回：</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">forever</span>() <span class=\"punctuation\">-&gt;</span> ! &#123;</span><br><span class=\"line\">  <span class=\"keyword\">loop</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"练习题\"><a href=\"#练习题\" class=\"headerlink\" title=\"练习题\"></a>练习题</h2><p><a class=\"link\"   href=\"https://practice-zh.course.rs/basic-types/functions.html\" >https://practice-zh.course.rs/basic-types/functions.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/3_func\" >Codes in lesson3<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"函数组成\"><a href=\"#函数组成\" class=\"headerlink\" title=\"函数组成\"></a>函数组成</h2><ul>\n<li>声明函数的关键字 <code>fn</code></li>\n<li>函数名 <code>add()</code></li>\n<li>参数 <code>i</code> 和 <code>j</code>和参数类型<code>i32</code></li>\n<li>返回值类型<code>i32</code></li>\n<li>函数体<code>i + j</code> <!--注意这里没有return --></li>\n</ul>\n<p>注意：函数可以在任意位置定义</p>\n<h3 id=\"函数名\"><a href=\"#函数名\" class=\"headerlink\" title=\"函数名\"></a>函数名</h3><p>开头是字符&#x2F;下划线，后面是数字，下划线，字母（不能仅有下划线）</p>\n<p>函数名和变量名使用<a class=\"link\"   href=\"https://course.rs/practice/naming.html\" >蛇形命名法（snake case）<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>，如：<code>fn add_two() -&gt; &#123;&#125;</code></p>\n<h3 id=\"函数参数\"><a href=\"#函数参数\" class=\"headerlink\" title=\"函数参数\"></a>函数参数</h3><p>Rust 是强类型语言，需要为所有函数参数标识具体类型</p>\n<h3 id=\"函数返回\"><a href=\"#函数返回\" class=\"headerlink\" title=\"函数返回\"></a>函数返回</h3><p>函数返回值是函数体最后一条表达式的返回值，也可以使用 <code>return</code> 提前返回，初学者只需记住两种形态：</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 没有return + 没有分号</span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">add</span>(i: <span class=\"type\">i32</span>, j: <span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">i32</span> &#123;</span><br><span class=\"line\">    i + j</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// return + 分号</span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">add</span>(i: <span class=\"type\">i32</span>, j: <span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">i32</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> i + j;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"特殊返回类型\"><a href=\"#特殊返回类型\" class=\"headerlink\" title=\"特殊返回类型\"></a>特殊返回类型</h4><h5 id=\"1、无返回值\"><a href=\"#1、无返回值\" class=\"headerlink\" title=\"1、无返回值()\"></a>1、无返回值<code>()</code></h5><p>如果一个函数没有返回值，就返回<code>()</code></p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">print</span>(i: <span class=\"type\">i32</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, i);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">print</span>(i: <span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> () &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, i);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"2、函数永不返回\"><a href=\"#2、函数永不返回\" class=\"headerlink\" title=\"2、函数永不返回\"></a>2、函数永不返回</h5><p>函数返回类型为<code>!</code>时，表示该函数永不返回（diverge function），常用做会导致程序崩溃的函数：</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">dead_end</span>() <span class=\"punctuation\">-&gt;</span> ! &#123;</span><br><span class=\"line\">  <span class=\"built_in\">panic!</span>(<span class=\"string\">&quot;崩溃&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>下面的函数创建了一个无限循环，也永不返回：</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">forever</span>() <span class=\"punctuation\">-&gt;</span> ! &#123;</span><br><span class=\"line\">  <span class=\"keyword\">loop</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"练习题\"><a href=\"#练习题\" class=\"headerlink\" title=\"练习题\"></a>练习题</h2><p><a class=\"link\"   href=\"https://practice-zh.course.rs/basic-types/functions.html\" >https://practice-zh.course.rs/basic-types/functions.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","_processedHighlight":true},{"title":"IB-Rust-流程控制","date":"2025-05-21T06:12:36.000Z","_content":"\n[Codes in lesson4](https://github.com/Zoella-w/IB-Rust/tree/main/4_flow_control)\n\n## 条件控制\n\n### `if` 表达式\n\nRust 不会自动将非布尔值转换为布尔值，必须显式使用布尔值作为 `if` 的条件\n\n### 使用 `else if` 处理多重条件\n\n只会执行第一个条件为 `true` 的代码块\n\n### 在 `let` 语句中使用 `if`\n\n声明的变量将会绑定到表示 `if` 表达式结果的值上\n\n- `if` 的每个分支可能的返回值必须是相同类型\n- 代码块的值是其最后一个表达式的值，即不需要分号\n\n\n## 循环\n\nRust 有三种循环：`loop`、`while` 和 `for`\n\n### `loop`\n\n运行时会出现反复打印的 `again!`，直到手动停止程序：\n\n```rust\nfn main() {\n    loop {\n        println!(\"again!\");\n    }\n}\n```\n\n#### break & continue\n\n`break` 关键字告诉程序停止循环\n\n`continue` 关键字告诉程序继续循环\n\n#### 从循环返回值\n\n和 if 类似，loop 也能赋值\n\n```rust\nfn main() {\n    let mut counter = 0;\n    let result = loop {\n        counter += 1;\n        if counter == 10 {\n            break counter * 2;\n        }\n    };\n    println!(\"The result is {result}\");\n}\n```\n\n#### 循环标签\n\nbreak + 循环标签 可以退出外层循环\n\n```rust\nfn main() {\n    let mut count = 0;\n    'counting_up: loop {\n        println!(\"count = {count}\");\n        let mut remaining = 10;\n        loop {\n            println!(\"remaining = {remaining}\");\n            if remaining == 9 {\n                break;\n            }\n            if count == 2 {\n                break 'counting_up;\n            }\n            remaining -= 1;\n        }\n        count += 1;\n    }\n    println!(\"End count = {count}\");\n}\n```\n\n### `while` 条件循环\n\n条件为 `true` 执行循环，条件不为 `true` 停止循环\n\n```rust\nfn main() {\n    let mut number = 3;\n    while number != 0 {\n        println!(\"{number}!\");\n\n        number -= 1;\n    }\n    println!(\"LIFTOFF!!!\");\n}\n```\n\n#### 用 loop 实现\n\n```rust\nfn main() {\n    let mut number = 3;\n    loop {\n        if number == 0 {\n            break;\n        }\n        println!(\"{number}!\");\n        number -= 1;\n    }\n    println!(\"LIFTOFF!!!\");\n}\n```\n\n### `for`\n\n```rust\nfn main() {\n    let a = [10, 20, 30, 40, 50];\n    for element in a {\n        println!(\"the value is: {element}\");\n    }\n}\n```\n\n倒序输出 [1, 2, 3]，结果为 3, 2, 1：\n\n```rust\nfn main() {\n    for number in (1..4).rev() {\n        println!(\"{number}!\");\n    }\n}\n```\n\n#### 所有权转移\n\n> 对于实现了 `copy` 特征的数组（如 [i32; 10]）而言，`for item in arr` 不会转移 `arr` 的所有权，而是对其进行了拷贝，因此循环之后仍可以使用 `arr` \n\n| 使用方法  | 等价使用方式 | 所有权 |\n| -- | -- | -- |\n| `for item in collection` | `for item in IntoIterator::into_iter(collection)` | 转移所有权 |\n| `for item in &collection` | `for item in collection.iter()` | 不可变借用 |\n| `for item in &mut collection` | `for item in collection.iter_mut()` | 可变借用 |\n\n## 练习题\n\nhttps://practice-zh.course.rs/flow-control.html\n","source":"_posts/62-IB-Rust-流程控制.md","raw":"---\ntitle: IB-Rust-流程控制\ndate: 2025-05-21 14:12:36\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson4](https://github.com/Zoella-w/IB-Rust/tree/main/4_flow_control)\n\n## 条件控制\n\n### `if` 表达式\n\nRust 不会自动将非布尔值转换为布尔值，必须显式使用布尔值作为 `if` 的条件\n\n### 使用 `else if` 处理多重条件\n\n只会执行第一个条件为 `true` 的代码块\n\n### 在 `let` 语句中使用 `if`\n\n声明的变量将会绑定到表示 `if` 表达式结果的值上\n\n- `if` 的每个分支可能的返回值必须是相同类型\n- 代码块的值是其最后一个表达式的值，即不需要分号\n\n\n## 循环\n\nRust 有三种循环：`loop`、`while` 和 `for`\n\n### `loop`\n\n运行时会出现反复打印的 `again!`，直到手动停止程序：\n\n```rust\nfn main() {\n    loop {\n        println!(\"again!\");\n    }\n}\n```\n\n#### break & continue\n\n`break` 关键字告诉程序停止循环\n\n`continue` 关键字告诉程序继续循环\n\n#### 从循环返回值\n\n和 if 类似，loop 也能赋值\n\n```rust\nfn main() {\n    let mut counter = 0;\n    let result = loop {\n        counter += 1;\n        if counter == 10 {\n            break counter * 2;\n        }\n    };\n    println!(\"The result is {result}\");\n}\n```\n\n#### 循环标签\n\nbreak + 循环标签 可以退出外层循环\n\n```rust\nfn main() {\n    let mut count = 0;\n    'counting_up: loop {\n        println!(\"count = {count}\");\n        let mut remaining = 10;\n        loop {\n            println!(\"remaining = {remaining}\");\n            if remaining == 9 {\n                break;\n            }\n            if count == 2 {\n                break 'counting_up;\n            }\n            remaining -= 1;\n        }\n        count += 1;\n    }\n    println!(\"End count = {count}\");\n}\n```\n\n### `while` 条件循环\n\n条件为 `true` 执行循环，条件不为 `true` 停止循环\n\n```rust\nfn main() {\n    let mut number = 3;\n    while number != 0 {\n        println!(\"{number}!\");\n\n        number -= 1;\n    }\n    println!(\"LIFTOFF!!!\");\n}\n```\n\n#### 用 loop 实现\n\n```rust\nfn main() {\n    let mut number = 3;\n    loop {\n        if number == 0 {\n            break;\n        }\n        println!(\"{number}!\");\n        number -= 1;\n    }\n    println!(\"LIFTOFF!!!\");\n}\n```\n\n### `for`\n\n```rust\nfn main() {\n    let a = [10, 20, 30, 40, 50];\n    for element in a {\n        println!(\"the value is: {element}\");\n    }\n}\n```\n\n倒序输出 [1, 2, 3]，结果为 3, 2, 1：\n\n```rust\nfn main() {\n    for number in (1..4).rev() {\n        println!(\"{number}!\");\n    }\n}\n```\n\n#### 所有权转移\n\n> 对于实现了 `copy` 特征的数组（如 [i32; 10]）而言，`for item in arr` 不会转移 `arr` 的所有权，而是对其进行了拷贝，因此循环之后仍可以使用 `arr` \n\n| 使用方法  | 等价使用方式 | 所有权 |\n| -- | -- | -- |\n| `for item in collection` | `for item in IntoIterator::into_iter(collection)` | 转移所有权 |\n| `for item in &collection` | `for item in collection.iter()` | 不可变借用 |\n| `for item in &mut collection` | `for item in collection.iter_mut()` | 可变借用 |\n\n## 练习题\n\nhttps://practice-zh.course.rs/flow-control.html\n","slug":"62-IB-Rust-流程控制","published":1,"updated":"2025-05-21T09:11:43.006Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvug005o6kpr8j8r9f8p","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/4_flow_control\" >Codes in lesson4<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"条件控制\"><a href=\"#条件控制\" class=\"headerlink\" title=\"条件控制\"></a>条件控制</h2><h3 id=\"if-表达式\"><a href=\"#if-表达式\" class=\"headerlink\" title=\"if 表达式\"></a><code>if</code> 表达式</h3><p>Rust 不会自动将非布尔值转换为布尔值，必须显式使用布尔值作为 <code>if</code> 的条件</p>\n<h3 id=\"使用-else-if-处理多重条件\"><a href=\"#使用-else-if-处理多重条件\" class=\"headerlink\" title=\"使用 else if 处理多重条件\"></a>使用 <code>else if</code> 处理多重条件</h3><p>只会执行第一个条件为 <code>true</code> 的代码块</p>\n<h3 id=\"在-let-语句中使用-if\"><a href=\"#在-let-语句中使用-if\" class=\"headerlink\" title=\"在 let 语句中使用 if\"></a>在 <code>let</code> 语句中使用 <code>if</code></h3><p>声明的变量将会绑定到表示 <code>if</code> 表达式结果的值上</p>\n<ul>\n<li><code>if</code> 的每个分支可能的返回值必须是相同类型</li>\n<li>代码块的值是其最后一个表达式的值，即不需要分号</li>\n</ul>\n<h2 id=\"循环\"><a href=\"#循环\" class=\"headerlink\" title=\"循环\"></a>循环</h2><p>Rust 有三种循环：<code>loop</code>、<code>while</code> 和 <code>for</code></p>\n<h3 id=\"loop\"><a href=\"#loop\" class=\"headerlink\" title=\"loop\"></a><code>loop</code></h3><p>运行时会出现反复打印的 <code>again!</code>，直到手动停止程序：</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">loop</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;again!&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"break-continue\"><a href=\"#break-continue\" class=\"headerlink\" title=\"break &amp; continue\"></a>break &amp; continue</h4><p><code>break</code> 关键字告诉程序停止循环</p>\n<p><code>continue</code> 关键字告诉程序继续循环</p>\n<h4 id=\"从循环返回值\"><a href=\"#从循环返回值\" class=\"headerlink\" title=\"从循环返回值\"></a>从循环返回值</h4><p>和 if 类似，loop 也能赋值</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">counter</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">result</span> = <span class=\"keyword\">loop</span> &#123;</span><br><span class=\"line\">        counter += <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> counter == <span class=\"number\">10</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">break</span> counter * <span class=\"number\">2</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;The result is &#123;result&#125;&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"循环标签\"><a href=\"#循环标签\" class=\"headerlink\" title=\"循环标签\"></a>循环标签</h4><p>break + 循环标签 可以退出外层循环</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">count</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"symbol\">&#x27;counting_up</span>: <span class=\"keyword\">loop</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;count = &#123;count&#125;&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">remaining</span> = <span class=\"number\">10</span>;</span><br><span class=\"line\">        <span class=\"keyword\">loop</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;remaining = &#123;remaining&#125;&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> remaining == <span class=\"number\">9</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> count == <span class=\"number\">2</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">break</span> <span class=\"symbol\">&#x27;counting_up</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            remaining -= <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        count += <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;End count = &#123;count&#125;&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"while-条件循环\"><a href=\"#while-条件循环\" class=\"headerlink\" title=\"while 条件循环\"></a><code>while</code> 条件循环</h3><p>条件为 <code>true</code> 执行循环，条件不为 <code>true</code> 停止循环</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">number</span> = <span class=\"number\">3</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> number != <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;number&#125;!&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        number -= <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;LIFTOFF!!!&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"用-loop-实现\"><a href=\"#用-loop-实现\" class=\"headerlink\" title=\"用 loop 实现\"></a>用 loop 实现</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">number</span> = <span class=\"number\">3</span>;</span><br><span class=\"line\">    <span class=\"keyword\">loop</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> number == <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;number&#125;!&quot;</span>);</span><br><span class=\"line\">        number -= <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;LIFTOFF!!!&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"for\"><a href=\"#for\" class=\"headerlink\" title=\"for\"></a><code>for</code></h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">a</span> = [<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">30</span>, <span class=\"number\">40</span>, <span class=\"number\">50</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"variable\">element</span> <span class=\"keyword\">in</span> a &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;the value is: &#123;element&#125;&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>倒序输出 [1, 2, 3]，结果为 3, 2, 1：</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"variable\">number</span> <span class=\"keyword\">in</span> (<span class=\"number\">1</span>..<span class=\"number\">4</span>).<span class=\"title function_ invoke__\">rev</span>() &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;number&#125;!&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"所有权转移\"><a href=\"#所有权转移\" class=\"headerlink\" title=\"所有权转移\"></a>所有权转移</h4><blockquote>\n<p>对于实现了 <code>copy</code> 特征的数组（如 [i32; 10]）而言，<code>for item in arr</code> 不会转移 <code>arr</code> 的所有权，而是对其进行了拷贝，因此循环之后仍可以使用 <code>arr</code> </p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>使用方法</th>\n<th>等价使用方式</th>\n<th>所有权</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>for item in collection</code></td>\n<td><code>for item in IntoIterator::into_iter(collection)</code></td>\n<td>转移所有权</td>\n</tr>\n<tr>\n<td><code>for item in &amp;collection</code></td>\n<td><code>for item in collection.iter()</code></td>\n<td>不可变借用</td>\n</tr>\n<tr>\n<td><code>for item in &amp;mut collection</code></td>\n<td><code>for item in collection.iter_mut()</code></td>\n<td>可变借用</td>\n</tr>\n</tbody></table>\n<h2 id=\"练习题\"><a href=\"#练习题\" class=\"headerlink\" title=\"练习题\"></a>练习题</h2><p><a class=\"link\"   href=\"https://practice-zh.course.rs/flow-control.html\" >https://practice-zh.course.rs/flow-control.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/4_flow_control\" >Codes in lesson4<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"条件控制\"><a href=\"#条件控制\" class=\"headerlink\" title=\"条件控制\"></a>条件控制</h2><h3 id=\"if-表达式\"><a href=\"#if-表达式\" class=\"headerlink\" title=\"if 表达式\"></a><code>if</code> 表达式</h3><p>Rust 不会自动将非布尔值转换为布尔值，必须显式使用布尔值作为 <code>if</code> 的条件</p>\n<h3 id=\"使用-else-if-处理多重条件\"><a href=\"#使用-else-if-处理多重条件\" class=\"headerlink\" title=\"使用 else if 处理多重条件\"></a>使用 <code>else if</code> 处理多重条件</h3><p>只会执行第一个条件为 <code>true</code> 的代码块</p>\n<h3 id=\"在-let-语句中使用-if\"><a href=\"#在-let-语句中使用-if\" class=\"headerlink\" title=\"在 let 语句中使用 if\"></a>在 <code>let</code> 语句中使用 <code>if</code></h3><p>声明的变量将会绑定到表示 <code>if</code> 表达式结果的值上</p>\n<ul>\n<li><code>if</code> 的每个分支可能的返回值必须是相同类型</li>\n<li>代码块的值是其最后一个表达式的值，即不需要分号</li>\n</ul>\n<h2 id=\"循环\"><a href=\"#循环\" class=\"headerlink\" title=\"循环\"></a>循环</h2><p>Rust 有三种循环：<code>loop</code>、<code>while</code> 和 <code>for</code></p>\n<h3 id=\"loop\"><a href=\"#loop\" class=\"headerlink\" title=\"loop\"></a><code>loop</code></h3><p>运行时会出现反复打印的 <code>again!</code>，直到手动停止程序：</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">loop</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;again!&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"break-continue\"><a href=\"#break-continue\" class=\"headerlink\" title=\"break &amp; continue\"></a>break &amp; continue</h4><p><code>break</code> 关键字告诉程序停止循环</p>\n<p><code>continue</code> 关键字告诉程序继续循环</p>\n<h4 id=\"从循环返回值\"><a href=\"#从循环返回值\" class=\"headerlink\" title=\"从循环返回值\"></a>从循环返回值</h4><p>和 if 类似，loop 也能赋值</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">counter</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">result</span> = <span class=\"keyword\">loop</span> &#123;</span><br><span class=\"line\">        counter += <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> counter == <span class=\"number\">10</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">break</span> counter * <span class=\"number\">2</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;The result is &#123;result&#125;&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"循环标签\"><a href=\"#循环标签\" class=\"headerlink\" title=\"循环标签\"></a>循环标签</h4><p>break + 循环标签 可以退出外层循环</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">count</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"symbol\">&#x27;counting_up</span>: <span class=\"keyword\">loop</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;count = &#123;count&#125;&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">remaining</span> = <span class=\"number\">10</span>;</span><br><span class=\"line\">        <span class=\"keyword\">loop</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;remaining = &#123;remaining&#125;&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> remaining == <span class=\"number\">9</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> count == <span class=\"number\">2</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">break</span> <span class=\"symbol\">&#x27;counting_up</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            remaining -= <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        count += <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;End count = &#123;count&#125;&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"while-条件循环\"><a href=\"#while-条件循环\" class=\"headerlink\" title=\"while 条件循环\"></a><code>while</code> 条件循环</h3><p>条件为 <code>true</code> 执行循环，条件不为 <code>true</code> 停止循环</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">number</span> = <span class=\"number\">3</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> number != <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;number&#125;!&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        number -= <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;LIFTOFF!!!&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"用-loop-实现\"><a href=\"#用-loop-实现\" class=\"headerlink\" title=\"用 loop 实现\"></a>用 loop 实现</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">number</span> = <span class=\"number\">3</span>;</span><br><span class=\"line\">    <span class=\"keyword\">loop</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> number == <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;number&#125;!&quot;</span>);</span><br><span class=\"line\">        number -= <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;LIFTOFF!!!&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"for\"><a href=\"#for\" class=\"headerlink\" title=\"for\"></a><code>for</code></h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">a</span> = [<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">30</span>, <span class=\"number\">40</span>, <span class=\"number\">50</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"variable\">element</span> <span class=\"keyword\">in</span> a &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;the value is: &#123;element&#125;&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>倒序输出 [1, 2, 3]，结果为 3, 2, 1：</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"variable\">number</span> <span class=\"keyword\">in</span> (<span class=\"number\">1</span>..<span class=\"number\">4</span>).<span class=\"title function_ invoke__\">rev</span>() &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;number&#125;!&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"所有权转移\"><a href=\"#所有权转移\" class=\"headerlink\" title=\"所有权转移\"></a>所有权转移</h4><blockquote>\n<p>对于实现了 <code>copy</code> 特征的数组（如 [i32; 10]）而言，<code>for item in arr</code> 不会转移 <code>arr</code> 的所有权，而是对其进行了拷贝，因此循环之后仍可以使用 <code>arr</code> </p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>使用方法</th>\n<th>等价使用方式</th>\n<th>所有权</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>for item in collection</code></td>\n<td><code>for item in IntoIterator::into_iter(collection)</code></td>\n<td>转移所有权</td>\n</tr>\n<tr>\n<td><code>for item in &amp;collection</code></td>\n<td><code>for item in collection.iter()</code></td>\n<td>不可变借用</td>\n</tr>\n<tr>\n<td><code>for item in &amp;mut collection</code></td>\n<td><code>for item in collection.iter_mut()</code></td>\n<td>可变借用</td>\n</tr>\n</tbody></table>\n<h2 id=\"练习题\"><a href=\"#练习题\" class=\"headerlink\" title=\"练习题\"></a>练习题</h2><p><a class=\"link\"   href=\"https://practice-zh.course.rs/flow-control.html\" >https://practice-zh.course.rs/flow-control.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","_processedHighlight":true},{"title":"IB-Rust-基础类型","date":"2025-05-21T09:07:26.000Z","_content":"\n[Codes in lesson5](https://github.com/Zoella-w/IB-Rust/tree/main/5_data_type)\n\n## 整型\n\n根据数据大小和有无符号对整数进行分类：\n\n| 大小  | 有符号 | 无符号 |\n| -- | -- | -- |\n| 8位 | i8 | u8 |\n| 16位 | i16 | u16 |\n| 32位 | i32 | u32 |\n| 64位 | i64 | u64 |\n| 128位 | i128 | u128 |\n| 视架构而定 | isize | usize |\n\n整型字面量可以用下表的形式书写\n\n| 数字字面量  | 示例 |\n| -- | -- |\n| 十进制 | 98_222 |\n| 十六进制 | 0xff |\n| 八进制 | 0o77 |\n| 二进制 | 0b1111_0000 |\n| 字节 | （仅限 u8）b'A' |\n\n## 浮点数\n\n浮点类型数字是有小数点的数字，rust 的浮点类型数字有两种基本类型：f32 和 f64\n\n默认浮点类型是 f64，在现代 CPU 中它的速度与 f32 几乎相同，但精度更高\n\n> NaN 是什么？\n>\n> 对于数学上未定义的结果，如负数开平方根，rust 的浮点数类型会使用 NAN 来处理。\n> 任何与 NaN 交互的操作都返回 NaN，且 NaN 不能用于比较（如断言），否则会导致程序崩溃\n\n## 布尔型\n\n布尔型有 true 和 false 两个值，占用1个字节的内存\n\n## 字符\n\nRust 的字符不仅是 ASCII，所有的 Unicode 值都可以作为 Rust 字符，包括中日韩文、emoji等\n\n字节类型占用4个字节\n\n## 序列\n\nRust 可以生成连续的数值，比如：`1..5` 生成从 1到4 的连续数字；`1..=5` 生成从 1到5 的连续数字\n\n序列常用于循环\n\n## 类型强制转换\n\nas 关键字用于在**原始类型**之间进行类型转换，而复合类型的转换通常需要使用其他方法或函数\n","source":"_posts/63-IB-Rust-基础类型.md","raw":"---\ntitle: IB-Rust-基础类型\ndate: 2025-05-21 17:07:26\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson5](https://github.com/Zoella-w/IB-Rust/tree/main/5_data_type)\n\n## 整型\n\n根据数据大小和有无符号对整数进行分类：\n\n| 大小  | 有符号 | 无符号 |\n| -- | -- | -- |\n| 8位 | i8 | u8 |\n| 16位 | i16 | u16 |\n| 32位 | i32 | u32 |\n| 64位 | i64 | u64 |\n| 128位 | i128 | u128 |\n| 视架构而定 | isize | usize |\n\n整型字面量可以用下表的形式书写\n\n| 数字字面量  | 示例 |\n| -- | -- |\n| 十进制 | 98_222 |\n| 十六进制 | 0xff |\n| 八进制 | 0o77 |\n| 二进制 | 0b1111_0000 |\n| 字节 | （仅限 u8）b'A' |\n\n## 浮点数\n\n浮点类型数字是有小数点的数字，rust 的浮点类型数字有两种基本类型：f32 和 f64\n\n默认浮点类型是 f64，在现代 CPU 中它的速度与 f32 几乎相同，但精度更高\n\n> NaN 是什么？\n>\n> 对于数学上未定义的结果，如负数开平方根，rust 的浮点数类型会使用 NAN 来处理。\n> 任何与 NaN 交互的操作都返回 NaN，且 NaN 不能用于比较（如断言），否则会导致程序崩溃\n\n## 布尔型\n\n布尔型有 true 和 false 两个值，占用1个字节的内存\n\n## 字符\n\nRust 的字符不仅是 ASCII，所有的 Unicode 值都可以作为 Rust 字符，包括中日韩文、emoji等\n\n字节类型占用4个字节\n\n## 序列\n\nRust 可以生成连续的数值，比如：`1..5` 生成从 1到4 的连续数字；`1..=5` 生成从 1到5 的连续数字\n\n序列常用于循环\n\n## 类型强制转换\n\nas 关键字用于在**原始类型**之间进行类型转换，而复合类型的转换通常需要使用其他方法或函数\n","slug":"63-IB-Rust-基础类型","published":1,"updated":"2025-05-21T09:56:45.477Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvug005s6kprevgn4c4h","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/5_data_type\" >Codes in lesson5<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"整型\"><a href=\"#整型\" class=\"headerlink\" title=\"整型\"></a>整型</h2><p>根据数据大小和有无符号对整数进行分类：</p>\n<table>\n<thead>\n<tr>\n<th>大小</th>\n<th>有符号</th>\n<th>无符号</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>8位</td>\n<td>i8</td>\n<td>u8</td>\n</tr>\n<tr>\n<td>16位</td>\n<td>i16</td>\n<td>u16</td>\n</tr>\n<tr>\n<td>32位</td>\n<td>i32</td>\n<td>u32</td>\n</tr>\n<tr>\n<td>64位</td>\n<td>i64</td>\n<td>u64</td>\n</tr>\n<tr>\n<td>128位</td>\n<td>i128</td>\n<td>u128</td>\n</tr>\n<tr>\n<td>视架构而定</td>\n<td>isize</td>\n<td>usize</td>\n</tr>\n</tbody></table>\n<p>整型字面量可以用下表的形式书写</p>\n<table>\n<thead>\n<tr>\n<th>数字字面量</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>十进制</td>\n<td>98_222</td>\n</tr>\n<tr>\n<td>十六进制</td>\n<td>0xff</td>\n</tr>\n<tr>\n<td>八进制</td>\n<td>0o77</td>\n</tr>\n<tr>\n<td>二进制</td>\n<td>0b1111_0000</td>\n</tr>\n<tr>\n<td>字节</td>\n<td>（仅限 u8）b’A’</td>\n</tr>\n</tbody></table>\n<h2 id=\"浮点数\"><a href=\"#浮点数\" class=\"headerlink\" title=\"浮点数\"></a>浮点数</h2><p>浮点类型数字是有小数点的数字，rust 的浮点类型数字有两种基本类型：f32 和 f64</p>\n<p>默认浮点类型是 f64，在现代 CPU 中它的速度与 f32 几乎相同，但精度更高</p>\n<blockquote>\n<p>NaN 是什么？</p>\n<p>对于数学上未定义的结果，如负数开平方根，rust 的浮点数类型会使用 NAN 来处理。<br>任何与 NaN 交互的操作都返回 NaN，且 NaN 不能用于比较（如断言），否则会导致程序崩溃</p>\n</blockquote>\n<h2 id=\"布尔型\"><a href=\"#布尔型\" class=\"headerlink\" title=\"布尔型\"></a>布尔型</h2><p>布尔型有 true 和 false 两个值，占用1个字节的内存</p>\n<h2 id=\"字符\"><a href=\"#字符\" class=\"headerlink\" title=\"字符\"></a>字符</h2><p>Rust 的字符不仅是 ASCII，所有的 Unicode 值都可以作为 Rust 字符，包括中日韩文、emoji等</p>\n<p>字节类型占用4个字节</p>\n<h2 id=\"序列\"><a href=\"#序列\" class=\"headerlink\" title=\"序列\"></a>序列</h2><p>Rust 可以生成连续的数值，比如：<code>1..5</code> 生成从 1到4 的连续数字；<code>1..=5</code> 生成从 1到5 的连续数字</p>\n<p>序列常用于循环</p>\n<h2 id=\"类型强制转换\"><a href=\"#类型强制转换\" class=\"headerlink\" title=\"类型强制转换\"></a>类型强制转换</h2><p>as 关键字用于在<strong>原始类型</strong>之间进行类型转换，而复合类型的转换通常需要使用其他方法或函数</p>\n","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/5_data_type\" >Codes in lesson5<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"整型\"><a href=\"#整型\" class=\"headerlink\" title=\"整型\"></a>整型</h2><p>根据数据大小和有无符号对整数进行分类：</p>\n<table>\n<thead>\n<tr>\n<th>大小</th>\n<th>有符号</th>\n<th>无符号</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>8位</td>\n<td>i8</td>\n<td>u8</td>\n</tr>\n<tr>\n<td>16位</td>\n<td>i16</td>\n<td>u16</td>\n</tr>\n<tr>\n<td>32位</td>\n<td>i32</td>\n<td>u32</td>\n</tr>\n<tr>\n<td>64位</td>\n<td>i64</td>\n<td>u64</td>\n</tr>\n<tr>\n<td>128位</td>\n<td>i128</td>\n<td>u128</td>\n</tr>\n<tr>\n<td>视架构而定</td>\n<td>isize</td>\n<td>usize</td>\n</tr>\n</tbody></table>\n<p>整型字面量可以用下表的形式书写</p>\n<table>\n<thead>\n<tr>\n<th>数字字面量</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>十进制</td>\n<td>98_222</td>\n</tr>\n<tr>\n<td>十六进制</td>\n<td>0xff</td>\n</tr>\n<tr>\n<td>八进制</td>\n<td>0o77</td>\n</tr>\n<tr>\n<td>二进制</td>\n<td>0b1111_0000</td>\n</tr>\n<tr>\n<td>字节</td>\n<td>（仅限 u8）b’A’</td>\n</tr>\n</tbody></table>\n<h2 id=\"浮点数\"><a href=\"#浮点数\" class=\"headerlink\" title=\"浮点数\"></a>浮点数</h2><p>浮点类型数字是有小数点的数字，rust 的浮点类型数字有两种基本类型：f32 和 f64</p>\n<p>默认浮点类型是 f64，在现代 CPU 中它的速度与 f32 几乎相同，但精度更高</p>\n<blockquote>\n<p>NaN 是什么？</p>\n<p>对于数学上未定义的结果，如负数开平方根，rust 的浮点数类型会使用 NAN 来处理。<br>任何与 NaN 交互的操作都返回 NaN，且 NaN 不能用于比较（如断言），否则会导致程序崩溃</p>\n</blockquote>\n<h2 id=\"布尔型\"><a href=\"#布尔型\" class=\"headerlink\" title=\"布尔型\"></a>布尔型</h2><p>布尔型有 true 和 false 两个值，占用1个字节的内存</p>\n<h2 id=\"字符\"><a href=\"#字符\" class=\"headerlink\" title=\"字符\"></a>字符</h2><p>Rust 的字符不仅是 ASCII，所有的 Unicode 值都可以作为 Rust 字符，包括中日韩文、emoji等</p>\n<p>字节类型占用4个字节</p>\n<h2 id=\"序列\"><a href=\"#序列\" class=\"headerlink\" title=\"序列\"></a>序列</h2><p>Rust 可以生成连续的数值，比如：<code>1..5</code> 生成从 1到4 的连续数字；<code>1..=5</code> 生成从 1到5 的连续数字</p>\n<p>序列常用于循环</p>\n<h2 id=\"类型强制转换\"><a href=\"#类型强制转换\" class=\"headerlink\" title=\"类型强制转换\"></a>类型强制转换</h2><p>as 关键字用于在<strong>原始类型</strong>之间进行类型转换，而复合类型的转换通常需要使用其他方法或函数</p>\n","_processedHighlight":true},{"title":"IB-Rust-所有权","date":"2025-05-22T06:32:11.000Z","_content":"\n[Codes in lesson6](https://github.com/Zoella-w/IB-Rust/tree/main/6_ownership)\n\n## 内存回收\n\nRust 的设计目的是确保内存安全并防止数据竞争，而不依赖垃圾回收器，这种内存安全性主要通过所有权（ownership）来实现\n\n主流编程语言的内存回收机制：\n- 静态语言\n  - 在编译时对变量类型进行检查和确认\n  - C, C++, Rust\n- 动态语言\n  - 在运行时进行类型检查和确认\n  - Javascript, Python\n\n| 特性 | 静态语言 | 动态语言 |\n| -- | -- | -- |\n| 类型检查时间 | 编译时 | 运行时 | \n| 类型安全 | 更安全，减少运行时类型错误 | 较灵活，但类型错误可能在运行时出现\n| 性能 | 通常更高效，编译器优化 | 通常较低，运行时类型检查 |\n| 灵活性 | 较低，需明确声明类型 | 较高，允许在运行时改变类型 |\n| 代码简洁性 | 需要显式类型声明，代码相对冗⻓ | 通常更简洁，适合快速开发 |\n| 开发工具支持 | 更强大的静态分析和重构工具 | 开发工具支持有限，但在快速开发上占优势\n\n### C/C++\n\n- 内存管理方式：手动管理\n- 特点\n  - 程序员通过 malloc 和 free (C) 或 new 和 delete (C++) 释放内存\n  - 没有内置的垃圾回收机制\n- 优点：高效灵活，适用于对性能要求极高的系统级编程\n- 缺点：容易出现内存泄漏、悬垂指针和缓冲区溢出等问题\n\n``` C\n// 释放分配的内存\nfree(ptr);\nptr = NULL; // 将指针设为 NULL，避免悬空指针 \n// 动态分配一个数组的内存\nint n = 5;\nint *arr = (int *)malloc(n * sizeof(int));\n```\n\n### Javascript\n\n- 内存管理方式：垃圾回收\n- 特点\n  - 浏览器和 Node.js 环境中均使用垃圾回收器（如 V8 引擎的垃圾回收器）\n  - 采用标记-清除、标记-压缩等算法\n- 优点：自动内存管理，适合快速开发和运行在多平台上的应用\n- 缺点：垃圾回收机制在某些情况下可能导致性能问题，如线程停顿\n\n### Rust\n\n- 内存管理方式：所有权系统\n- 特点\n  - 使用所有权系统进行内存管理，编译器在编译时通过静态分析来确保内存安全\n  - 每个值都有一个所有者，且任何时候只能有一个有效的所有者\n  - 通过借用（引用）机制来共享数据，避免数据竞争和悬垂指针\n- 优点\n  - 在编译时保证内存安全，没有运行时开销\n  - 避免了数据竞争和悬垂指针\n- 缺点：需要程序员理解和遵循所有权和借用规则，学习曲线较陡\n\n## 所有权规则\n\nRust 所有权系统的三个基本规则：\n- 每一个值都有一个所有者（owner）\n- 在任一时刻，值只能有一个所有者\n- 当所有者离开作用域（scope），值会被丢弃（drop）\n\n## 课后习题\n用 2 种方式实现，确保 s1 s2 都能正常打印出来\n``` rust\n// TODO:\nfn take_ownership(s: String) -> String {\n    s\n}\nlet s1 = String::from(\"Hello\");\nlet s2 = take_ownership(s1);\n// 如下代码不能修改\nprintln!(\"{}\", s1);\nprintln!(\"{}\", s2);\n```\n\n### 方式一：借用\n``` rust\nfn take_ownership(s: &String) -> String {\n    s.clone()\n}\nfn main() {\n    let s1 = String::from(\"Hello\");\n    let s2 = take_ownership(&s1);\n    // 如下代码不能修改\n    println!(\"{}\", s1);\n    println!(\"{}\", s2);\n}\n```\n\n### 方式二：调用时 clone\n``` rust\nfn take_ownership(s: &String) -> &String {\n    s\n}\nfn main() {\n    let s1 = String::from(\"Hello\");\n    let s2 = take_ownership(&s1);\n    // 如下代码不能修改\n    println!(\"{}\", s1);\n    println!(\"{}\", s2);\n}\n```\n","source":"_posts/64-IB-Rust-所有权.md","raw":"---\ntitle: IB-Rust-所有权\ndate: 2025-05-22 14:32:11\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson6](https://github.com/Zoella-w/IB-Rust/tree/main/6_ownership)\n\n## 内存回收\n\nRust 的设计目的是确保内存安全并防止数据竞争，而不依赖垃圾回收器，这种内存安全性主要通过所有权（ownership）来实现\n\n主流编程语言的内存回收机制：\n- 静态语言\n  - 在编译时对变量类型进行检查和确认\n  - C, C++, Rust\n- 动态语言\n  - 在运行时进行类型检查和确认\n  - Javascript, Python\n\n| 特性 | 静态语言 | 动态语言 |\n| -- | -- | -- |\n| 类型检查时间 | 编译时 | 运行时 | \n| 类型安全 | 更安全，减少运行时类型错误 | 较灵活，但类型错误可能在运行时出现\n| 性能 | 通常更高效，编译器优化 | 通常较低，运行时类型检查 |\n| 灵活性 | 较低，需明确声明类型 | 较高，允许在运行时改变类型 |\n| 代码简洁性 | 需要显式类型声明，代码相对冗⻓ | 通常更简洁，适合快速开发 |\n| 开发工具支持 | 更强大的静态分析和重构工具 | 开发工具支持有限，但在快速开发上占优势\n\n### C/C++\n\n- 内存管理方式：手动管理\n- 特点\n  - 程序员通过 malloc 和 free (C) 或 new 和 delete (C++) 释放内存\n  - 没有内置的垃圾回收机制\n- 优点：高效灵活，适用于对性能要求极高的系统级编程\n- 缺点：容易出现内存泄漏、悬垂指针和缓冲区溢出等问题\n\n``` C\n// 释放分配的内存\nfree(ptr);\nptr = NULL; // 将指针设为 NULL，避免悬空指针 \n// 动态分配一个数组的内存\nint n = 5;\nint *arr = (int *)malloc(n * sizeof(int));\n```\n\n### Javascript\n\n- 内存管理方式：垃圾回收\n- 特点\n  - 浏览器和 Node.js 环境中均使用垃圾回收器（如 V8 引擎的垃圾回收器）\n  - 采用标记-清除、标记-压缩等算法\n- 优点：自动内存管理，适合快速开发和运行在多平台上的应用\n- 缺点：垃圾回收机制在某些情况下可能导致性能问题，如线程停顿\n\n### Rust\n\n- 内存管理方式：所有权系统\n- 特点\n  - 使用所有权系统进行内存管理，编译器在编译时通过静态分析来确保内存安全\n  - 每个值都有一个所有者，且任何时候只能有一个有效的所有者\n  - 通过借用（引用）机制来共享数据，避免数据竞争和悬垂指针\n- 优点\n  - 在编译时保证内存安全，没有运行时开销\n  - 避免了数据竞争和悬垂指针\n- 缺点：需要程序员理解和遵循所有权和借用规则，学习曲线较陡\n\n## 所有权规则\n\nRust 所有权系统的三个基本规则：\n- 每一个值都有一个所有者（owner）\n- 在任一时刻，值只能有一个所有者\n- 当所有者离开作用域（scope），值会被丢弃（drop）\n\n## 课后习题\n用 2 种方式实现，确保 s1 s2 都能正常打印出来\n``` rust\n// TODO:\nfn take_ownership(s: String) -> String {\n    s\n}\nlet s1 = String::from(\"Hello\");\nlet s2 = take_ownership(s1);\n// 如下代码不能修改\nprintln!(\"{}\", s1);\nprintln!(\"{}\", s2);\n```\n\n### 方式一：借用\n``` rust\nfn take_ownership(s: &String) -> String {\n    s.clone()\n}\nfn main() {\n    let s1 = String::from(\"Hello\");\n    let s2 = take_ownership(&s1);\n    // 如下代码不能修改\n    println!(\"{}\", s1);\n    println!(\"{}\", s2);\n}\n```\n\n### 方式二：调用时 clone\n``` rust\nfn take_ownership(s: &String) -> &String {\n    s\n}\nfn main() {\n    let s1 = String::from(\"Hello\");\n    let s2 = take_ownership(&s1);\n    // 如下代码不能修改\n    println!(\"{}\", s1);\n    println!(\"{}\", s2);\n}\n```\n","slug":"64-IB-Rust-所有权","published":1,"updated":"2025-05-22T08:27:39.535Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvug005w6kprb35o35u5","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/6_ownership\" >Codes in lesson6<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"内存回收\"><a href=\"#内存回收\" class=\"headerlink\" title=\"内存回收\"></a>内存回收</h2><p>Rust 的设计目的是确保内存安全并防止数据竞争，而不依赖垃圾回收器，这种内存安全性主要通过所有权（ownership）来实现</p>\n<p>主流编程语言的内存回收机制：</p>\n<ul>\n<li>静态语言<ul>\n<li>在编译时对变量类型进行检查和确认</li>\n<li>C, C++, Rust</li>\n</ul>\n</li>\n<li>动态语言<ul>\n<li>在运行时进行类型检查和确认</li>\n<li>Javascript, Python</li>\n</ul>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>静态语言</th>\n<th>动态语言</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>类型检查时间</td>\n<td>编译时</td>\n<td>运行时</td>\n</tr>\n<tr>\n<td>类型安全</td>\n<td>更安全，减少运行时类型错误</td>\n<td>较灵活，但类型错误可能在运行时出现</td>\n</tr>\n<tr>\n<td>性能</td>\n<td>通常更高效，编译器优化</td>\n<td>通常较低，运行时类型检查</td>\n</tr>\n<tr>\n<td>灵活性</td>\n<td>较低，需明确声明类型</td>\n<td>较高，允许在运行时改变类型</td>\n</tr>\n<tr>\n<td>代码简洁性</td>\n<td>需要显式类型声明，代码相对冗⻓</td>\n<td>通常更简洁，适合快速开发</td>\n</tr>\n<tr>\n<td>开发工具支持</td>\n<td>更强大的静态分析和重构工具</td>\n<td>开发工具支持有限，但在快速开发上占优势</td>\n</tr>\n</tbody></table>\n<h3 id=\"C-C\"><a href=\"#C-C\" class=\"headerlink\" title=\"C&#x2F;C++\"></a>C&#x2F;C++</h3><ul>\n<li>内存管理方式：手动管理</li>\n<li>特点<ul>\n<li>程序员通过 malloc 和 free (C) 或 new 和 delete (C++) 释放内存</li>\n<li>没有内置的垃圾回收机制</li>\n</ul>\n</li>\n<li>优点：高效灵活，适用于对性能要求极高的系统级编程</li>\n<li>缺点：容易出现内存泄漏、悬垂指针和缓冲区溢出等问题</li>\n</ul>\n<div class=\"code-container\" data-rel=\"C\"><figure class=\"iseeu highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 释放分配的内存</span></span><br><span class=\"line\"><span class=\"built_in\">free</span>(ptr);</span><br><span class=\"line\">ptr = <span class=\"literal\">NULL</span>; <span class=\"comment\">// 将指针设为 NULL，避免悬空指针 </span></span><br><span class=\"line\"><span class=\"comment\">// 动态分配一个数组的内存</span></span><br><span class=\"line\"><span class=\"type\">int</span> n = <span class=\"number\">5</span>;</span><br><span class=\"line\"><span class=\"type\">int</span> *arr = (<span class=\"type\">int</span> *)<span class=\"built_in\">malloc</span>(n * <span class=\"keyword\">sizeof</span>(<span class=\"type\">int</span>));</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"Javascript\"><a href=\"#Javascript\" class=\"headerlink\" title=\"Javascript\"></a>Javascript</h3><ul>\n<li>内存管理方式：垃圾回收</li>\n<li>特点<ul>\n<li>浏览器和 Node.js 环境中均使用垃圾回收器（如 V8 引擎的垃圾回收器）</li>\n<li>采用标记-清除、标记-压缩等算法</li>\n</ul>\n</li>\n<li>优点：自动内存管理，适合快速开发和运行在多平台上的应用</li>\n<li>缺点：垃圾回收机制在某些情况下可能导致性能问题，如线程停顿</li>\n</ul>\n<h3 id=\"Rust\"><a href=\"#Rust\" class=\"headerlink\" title=\"Rust\"></a>Rust</h3><ul>\n<li>内存管理方式：所有权系统</li>\n<li>特点<ul>\n<li>使用所有权系统进行内存管理，编译器在编译时通过静态分析来确保内存安全</li>\n<li>每个值都有一个所有者，且任何时候只能有一个有效的所有者</li>\n<li>通过借用（引用）机制来共享数据，避免数据竞争和悬垂指针</li>\n</ul>\n</li>\n<li>优点<ul>\n<li>在编译时保证内存安全，没有运行时开销</li>\n<li>避免了数据竞争和悬垂指针</li>\n</ul>\n</li>\n<li>缺点：需要程序员理解和遵循所有权和借用规则，学习曲线较陡</li>\n</ul>\n<h2 id=\"所有权规则\"><a href=\"#所有权规则\" class=\"headerlink\" title=\"所有权规则\"></a>所有权规则</h2><p>Rust 所有权系统的三个基本规则：</p>\n<ul>\n<li>每一个值都有一个所有者（owner）</li>\n<li>在任一时刻，值只能有一个所有者</li>\n<li>当所有者离开作用域（scope），值会被丢弃（drop）</li>\n</ul>\n<h2 id=\"课后习题\"><a href=\"#课后习题\" class=\"headerlink\" title=\"课后习题\"></a>课后习题</h2><p>用 2 种方式实现，确保 s1 s2 都能正常打印出来</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// <span class=\"doctag\">TODO:</span></span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">take_ownership</span>(s: <span class=\"type\">String</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">    s</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s1</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Hello&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s2</span> = <span class=\"title function_ invoke__\">take_ownership</span>(s1);</span><br><span class=\"line\"><span class=\"comment\">// 如下代码不能修改</span></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, s1);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, s2);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"方式一：借用\"><a href=\"#方式一：借用\" class=\"headerlink\" title=\"方式一：借用\"></a>方式一：借用</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">take_ownership</span>(s: &amp;<span class=\"type\">String</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">    s.<span class=\"title function_ invoke__\">clone</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">s1</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Hello&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">s2</span> = <span class=\"title function_ invoke__\">take_ownership</span>(&amp;s1);</span><br><span class=\"line\">    <span class=\"comment\">// 如下代码不能修改</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, s1);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, s2);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"方式二：调用时-clone\"><a href=\"#方式二：调用时-clone\" class=\"headerlink\" title=\"方式二：调用时 clone\"></a>方式二：调用时 clone</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">take_ownership</span>(s: &amp;<span class=\"type\">String</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"type\">String</span> &#123;</span><br><span class=\"line\">    s</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">s1</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Hello&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">s2</span> = <span class=\"title function_ invoke__\">take_ownership</span>(&amp;s1);</span><br><span class=\"line\">    <span class=\"comment\">// 如下代码不能修改</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, s1);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, s2);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/6_ownership\" >Codes in lesson6<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"内存回收\"><a href=\"#内存回收\" class=\"headerlink\" title=\"内存回收\"></a>内存回收</h2><p>Rust 的设计目的是确保内存安全并防止数据竞争，而不依赖垃圾回收器，这种内存安全性主要通过所有权（ownership）来实现</p>\n<p>主流编程语言的内存回收机制：</p>\n<ul>\n<li>静态语言<ul>\n<li>在编译时对变量类型进行检查和确认</li>\n<li>C, C++, Rust</li>\n</ul>\n</li>\n<li>动态语言<ul>\n<li>在运行时进行类型检查和确认</li>\n<li>Javascript, Python</li>\n</ul>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>静态语言</th>\n<th>动态语言</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>类型检查时间</td>\n<td>编译时</td>\n<td>运行时</td>\n</tr>\n<tr>\n<td>类型安全</td>\n<td>更安全，减少运行时类型错误</td>\n<td>较灵活，但类型错误可能在运行时出现</td>\n</tr>\n<tr>\n<td>性能</td>\n<td>通常更高效，编译器优化</td>\n<td>通常较低，运行时类型检查</td>\n</tr>\n<tr>\n<td>灵活性</td>\n<td>较低，需明确声明类型</td>\n<td>较高，允许在运行时改变类型</td>\n</tr>\n<tr>\n<td>代码简洁性</td>\n<td>需要显式类型声明，代码相对冗⻓</td>\n<td>通常更简洁，适合快速开发</td>\n</tr>\n<tr>\n<td>开发工具支持</td>\n<td>更强大的静态分析和重构工具</td>\n<td>开发工具支持有限，但在快速开发上占优势</td>\n</tr>\n</tbody></table>\n<h3 id=\"C-C\"><a href=\"#C-C\" class=\"headerlink\" title=\"C&#x2F;C++\"></a>C&#x2F;C++</h3><ul>\n<li>内存管理方式：手动管理</li>\n<li>特点<ul>\n<li>程序员通过 malloc 和 free (C) 或 new 和 delete (C++) 释放内存</li>\n<li>没有内置的垃圾回收机制</li>\n</ul>\n</li>\n<li>优点：高效灵活，适用于对性能要求极高的系统级编程</li>\n<li>缺点：容易出现内存泄漏、悬垂指针和缓冲区溢出等问题</li>\n</ul>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 释放分配的内存</span></span><br><span class=\"line\"><span class=\"built_in\">free</span>(ptr);</span><br><span class=\"line\">ptr = <span class=\"literal\">NULL</span>; <span class=\"comment\">// 将指针设为 NULL，避免悬空指针 </span></span><br><span class=\"line\"><span class=\"comment\">// 动态分配一个数组的内存</span></span><br><span class=\"line\"><span class=\"type\">int</span> n = <span class=\"number\">5</span>;</span><br><span class=\"line\"><span class=\"type\">int</span> *arr = (<span class=\"type\">int</span> *)<span class=\"built_in\">malloc</span>(n * <span class=\"keyword\">sizeof</span>(<span class=\"type\">int</span>));</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Javascript\"><a href=\"#Javascript\" class=\"headerlink\" title=\"Javascript\"></a>Javascript</h3><ul>\n<li>内存管理方式：垃圾回收</li>\n<li>特点<ul>\n<li>浏览器和 Node.js 环境中均使用垃圾回收器（如 V8 引擎的垃圾回收器）</li>\n<li>采用标记-清除、标记-压缩等算法</li>\n</ul>\n</li>\n<li>优点：自动内存管理，适合快速开发和运行在多平台上的应用</li>\n<li>缺点：垃圾回收机制在某些情况下可能导致性能问题，如线程停顿</li>\n</ul>\n<h3 id=\"Rust\"><a href=\"#Rust\" class=\"headerlink\" title=\"Rust\"></a>Rust</h3><ul>\n<li>内存管理方式：所有权系统</li>\n<li>特点<ul>\n<li>使用所有权系统进行内存管理，编译器在编译时通过静态分析来确保内存安全</li>\n<li>每个值都有一个所有者，且任何时候只能有一个有效的所有者</li>\n<li>通过借用（引用）机制来共享数据，避免数据竞争和悬垂指针</li>\n</ul>\n</li>\n<li>优点<ul>\n<li>在编译时保证内存安全，没有运行时开销</li>\n<li>避免了数据竞争和悬垂指针</li>\n</ul>\n</li>\n<li>缺点：需要程序员理解和遵循所有权和借用规则，学习曲线较陡</li>\n</ul>\n<h2 id=\"所有权规则\"><a href=\"#所有权规则\" class=\"headerlink\" title=\"所有权规则\"></a>所有权规则</h2><p>Rust 所有权系统的三个基本规则：</p>\n<ul>\n<li>每一个值都有一个所有者（owner）</li>\n<li>在任一时刻，值只能有一个所有者</li>\n<li>当所有者离开作用域（scope），值会被丢弃（drop）</li>\n</ul>\n<h2 id=\"课后习题\"><a href=\"#课后习题\" class=\"headerlink\" title=\"课后习题\"></a>课后习题</h2><p>用 2 种方式实现，确保 s1 s2 都能正常打印出来</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// <span class=\"doctag\">TODO:</span></span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">take_ownership</span>(s: <span class=\"type\">String</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">    s</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s1</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Hello&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s2</span> = <span class=\"title function_ invoke__\">take_ownership</span>(s1);</span><br><span class=\"line\"><span class=\"comment\">// 如下代码不能修改</span></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, s1);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, s2);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"方式一：借用\"><a href=\"#方式一：借用\" class=\"headerlink\" title=\"方式一：借用\"></a>方式一：借用</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">take_ownership</span>(s: &amp;<span class=\"type\">String</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">    s.<span class=\"title function_ invoke__\">clone</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">s1</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Hello&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">s2</span> = <span class=\"title function_ invoke__\">take_ownership</span>(&amp;s1);</span><br><span class=\"line\">    <span class=\"comment\">// 如下代码不能修改</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, s1);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, s2);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"方式二：调用时-clone\"><a href=\"#方式二：调用时-clone\" class=\"headerlink\" title=\"方式二：调用时 clone\"></a>方式二：调用时 clone</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">take_ownership</span>(s: &amp;<span class=\"type\">String</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"type\">String</span> &#123;</span><br><span class=\"line\">    s</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">s1</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Hello&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">s2</span> = <span class=\"title function_ invoke__\">take_ownership</span>(&amp;s1);</span><br><span class=\"line\">    <span class=\"comment\">// 如下代码不能修改</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, s1);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, s2);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"IB-Rust-引用","date":"2025-05-22T08:26:31.000Z","_content":"\n[Codes in lesson7](https://github.com/Zoella-w/IB-Rust/tree/main/7_reference)\n\n## 引用的分类\n\n- **不可变引用（Immutable Reference）**\n  - 可以读取数据，但不能修改\n  - 一个变量可以有多个不可变引用，但不能与可变引用共存\n- **可变引用（Mutable Reference）**\n  - 可以读取和修改数据\n  - 一个变量在某一时刻只能有一个可变引用，且不能与不可变引用共存\n\n## 借用的规则\n\n- 同一时间内，一个变量只能有一个可变引用或多个不可变引用\n- 引用必须总是有效（被引用的数据在其引用的生命周期内必须始终存在，且不能被销毁）\n\n## move & borrow & slice\n\n### move\n\n当​堆数据被赋值给另一个变量或作为参数传递时，其所有权会 ​​转移​​（move）到新变量或函数中，原变量将失效\n\n### borrow\n\n借用是 Rust 中通过引用 ​​临时访问数据​​ 的逻辑概念\n\n### slice\n\n切片（slices）分为：\n\n#### 字符串切片\n\n```rust\nlet s = String::from(\"hello world\");\nlet hello = &s[0..5]; // 引用 \"hello\"\nlet world = &s[6..11]; // 引用 \"world\"\n```\n\n#### 数组切片\n\n```rust\nlet arr = [1, 2, 3, 4, 5];\nlet slice = &arr[1..3]; // 引用 [2, 3]\n```\n\n## 课后习题\n\n通过编译器错误提示，修复并运行代码\n```rust\n#[test]\nfn test_lifetime() {\n    let large = longest(\"a\", \"ab\");\n    println!(\"large one is {large}\");\n    // expected named lifetime parameter\n    fn longest(x: &str, y: &str) -> &str {\n        if x.len() > y.len() {\n          x\n        } else {\n          y\n        }\n    }\n}\n```\n\n如果函数返回引用，且该引用依赖于输入参数的引用，必须显式标注生命周期参数\n```rust\n#[test]\nfn test_lifetime() {\n    let large = longest(\"a\", \"ab\");\n    println!(\"large one is {large}\");\n    // modified\n    fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {\n        if x.len() > y.len() {\n          x\n        } else {\n          y\n        }\n    }\n}\n","source":"_posts/65-IB-Rust-引用.md","raw":"---\ntitle: IB-Rust-引用\ndate: 2025-05-22 16:26:31\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson7](https://github.com/Zoella-w/IB-Rust/tree/main/7_reference)\n\n## 引用的分类\n\n- **不可变引用（Immutable Reference）**\n  - 可以读取数据，但不能修改\n  - 一个变量可以有多个不可变引用，但不能与可变引用共存\n- **可变引用（Mutable Reference）**\n  - 可以读取和修改数据\n  - 一个变量在某一时刻只能有一个可变引用，且不能与不可变引用共存\n\n## 借用的规则\n\n- 同一时间内，一个变量只能有一个可变引用或多个不可变引用\n- 引用必须总是有效（被引用的数据在其引用的生命周期内必须始终存在，且不能被销毁）\n\n## move & borrow & slice\n\n### move\n\n当​堆数据被赋值给另一个变量或作为参数传递时，其所有权会 ​​转移​​（move）到新变量或函数中，原变量将失效\n\n### borrow\n\n借用是 Rust 中通过引用 ​​临时访问数据​​ 的逻辑概念\n\n### slice\n\n切片（slices）分为：\n\n#### 字符串切片\n\n```rust\nlet s = String::from(\"hello world\");\nlet hello = &s[0..5]; // 引用 \"hello\"\nlet world = &s[6..11]; // 引用 \"world\"\n```\n\n#### 数组切片\n\n```rust\nlet arr = [1, 2, 3, 4, 5];\nlet slice = &arr[1..3]; // 引用 [2, 3]\n```\n\n## 课后习题\n\n通过编译器错误提示，修复并运行代码\n```rust\n#[test]\nfn test_lifetime() {\n    let large = longest(\"a\", \"ab\");\n    println!(\"large one is {large}\");\n    // expected named lifetime parameter\n    fn longest(x: &str, y: &str) -> &str {\n        if x.len() > y.len() {\n          x\n        } else {\n          y\n        }\n    }\n}\n```\n\n如果函数返回引用，且该引用依赖于输入参数的引用，必须显式标注生命周期参数\n```rust\n#[test]\nfn test_lifetime() {\n    let large = longest(\"a\", \"ab\");\n    println!(\"large one is {large}\");\n    // modified\n    fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {\n        if x.len() > y.len() {\n          x\n        } else {\n          y\n        }\n    }\n}\n","slug":"65-IB-Rust-引用","published":1,"updated":"2025-05-22T09:22:21.278Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvug00606kpr625zhdfd","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/7_reference\" >Codes in lesson7<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"引用的分类\"><a href=\"#引用的分类\" class=\"headerlink\" title=\"引用的分类\"></a>引用的分类</h2><ul>\n<li><strong>不可变引用（Immutable Reference）</strong><ul>\n<li>可以读取数据，但不能修改</li>\n<li>一个变量可以有多个不可变引用，但不能与可变引用共存</li>\n</ul>\n</li>\n<li><strong>可变引用（Mutable Reference）</strong><ul>\n<li>可以读取和修改数据</li>\n<li>一个变量在某一时刻只能有一个可变引用，且不能与不可变引用共存</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"借用的规则\"><a href=\"#借用的规则\" class=\"headerlink\" title=\"借用的规则\"></a>借用的规则</h2><ul>\n<li>同一时间内，一个变量只能有一个可变引用或多个不可变引用</li>\n<li>引用必须总是有效（被引用的数据在其引用的生命周期内必须始终存在，且不能被销毁）</li>\n</ul>\n<h2 id=\"move-borrow-slice\"><a href=\"#move-borrow-slice\" class=\"headerlink\" title=\"move &amp; borrow &amp; slice\"></a>move &amp; borrow &amp; slice</h2><h3 id=\"move\"><a href=\"#move\" class=\"headerlink\" title=\"move\"></a>move</h3><p>当​堆数据被赋值给另一个变量或作为参数传递时，其所有权会 ​​转移​​（move）到新变量或函数中，原变量将失效</p>\n<h3 id=\"borrow\"><a href=\"#borrow\" class=\"headerlink\" title=\"borrow\"></a>borrow</h3><p>借用是 Rust 中通过引用 ​​临时访问数据​​ 的逻辑概念</p>\n<h3 id=\"slice\"><a href=\"#slice\" class=\"headerlink\" title=\"slice\"></a>slice</h3><p>切片（slices）分为：</p>\n<h4 id=\"字符串切片\"><a href=\"#字符串切片\" class=\"headerlink\" title=\"字符串切片\"></a>字符串切片</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;hello world&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">hello</span> = &amp;s[<span class=\"number\">0</span>..<span class=\"number\">5</span>]; <span class=\"comment\">// 引用 &quot;hello&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">world</span> = &amp;s[<span class=\"number\">6</span>..<span class=\"number\">11</span>]; <span class=\"comment\">// 引用 &quot;world&quot;</span></span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"数组切片\"><a href=\"#数组切片\" class=\"headerlink\" title=\"数组切片\"></a>数组切片</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">arr</span> = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">slice</span> = &amp;arr[<span class=\"number\">1</span>..<span class=\"number\">3</span>]; <span class=\"comment\">// 引用 [2, 3]</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"课后习题\"><a href=\"#课后习题\" class=\"headerlink\" title=\"课后习题\"></a>课后习题</h2><p>通过编译器错误提示，修复并运行代码</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#[test]</span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">test_lifetime</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">large</span> = <span class=\"title function_ invoke__\">longest</span>(<span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;ab&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;large one is &#123;large&#125;&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">// expected named lifetime parameter</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">longest</span>(x: &amp;<span class=\"type\">str</span>, y: &amp;<span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"type\">str</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> x.<span class=\"title function_ invoke__\">len</span>() &gt; y.<span class=\"title function_ invoke__\">len</span>() &#123;</span><br><span class=\"line\">          x</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          y</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>如果函数返回引用，且该引用依赖于输入参数的引用，必须显式标注生命周期参数</p>\n<pre><code class=\"rust\">#[test]\nfn test_lifetime() &#123;\n    let large = longest(&quot;a&quot;, &quot;ab&quot;);\n    println!(&quot;large one is &#123;large&#125;&quot;);\n    // modified\n    fn longest&lt;&#39;a&gt;(x: &amp;&#39;a str, y: &amp;&#39;a str) -&gt; &amp;&#39;a str &#123;\n        if x.len() &gt; y.len() &#123;\n          x\n        &#125; else &#123;\n          y\n        &#125;\n    &#125;\n&#125;\n</code></pre>\n","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/7_reference\" >Codes in lesson7<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"引用的分类\"><a href=\"#引用的分类\" class=\"headerlink\" title=\"引用的分类\"></a>引用的分类</h2><ul>\n<li><strong>不可变引用（Immutable Reference）</strong><ul>\n<li>可以读取数据，但不能修改</li>\n<li>一个变量可以有多个不可变引用，但不能与可变引用共存</li>\n</ul>\n</li>\n<li><strong>可变引用（Mutable Reference）</strong><ul>\n<li>可以读取和修改数据</li>\n<li>一个变量在某一时刻只能有一个可变引用，且不能与不可变引用共存</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"借用的规则\"><a href=\"#借用的规则\" class=\"headerlink\" title=\"借用的规则\"></a>借用的规则</h2><ul>\n<li>同一时间内，一个变量只能有一个可变引用或多个不可变引用</li>\n<li>引用必须总是有效（被引用的数据在其引用的生命周期内必须始终存在，且不能被销毁）</li>\n</ul>\n<h2 id=\"move-borrow-slice\"><a href=\"#move-borrow-slice\" class=\"headerlink\" title=\"move &amp; borrow &amp; slice\"></a>move &amp; borrow &amp; slice</h2><h3 id=\"move\"><a href=\"#move\" class=\"headerlink\" title=\"move\"></a>move</h3><p>当​堆数据被赋值给另一个变量或作为参数传递时，其所有权会 ​​转移​​（move）到新变量或函数中，原变量将失效</p>\n<h3 id=\"borrow\"><a href=\"#borrow\" class=\"headerlink\" title=\"borrow\"></a>borrow</h3><p>借用是 Rust 中通过引用 ​​临时访问数据​​ 的逻辑概念</p>\n<h3 id=\"slice\"><a href=\"#slice\" class=\"headerlink\" title=\"slice\"></a>slice</h3><p>切片（slices）分为：</p>\n<h4 id=\"字符串切片\"><a href=\"#字符串切片\" class=\"headerlink\" title=\"字符串切片\"></a>字符串切片</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;hello world&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">hello</span> = &amp;s[<span class=\"number\">0</span>..<span class=\"number\">5</span>]; <span class=\"comment\">// 引用 &quot;hello&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">world</span> = &amp;s[<span class=\"number\">6</span>..<span class=\"number\">11</span>]; <span class=\"comment\">// 引用 &quot;world&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"数组切片\"><a href=\"#数组切片\" class=\"headerlink\" title=\"数组切片\"></a>数组切片</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">arr</span> = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">slice</span> = &amp;arr[<span class=\"number\">1</span>..<span class=\"number\">3</span>]; <span class=\"comment\">// 引用 [2, 3]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"课后习题\"><a href=\"#课后习题\" class=\"headerlink\" title=\"课后习题\"></a>课后习题</h2><p>通过编译器错误提示，修复并运行代码</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#[test]</span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">test_lifetime</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">large</span> = <span class=\"title function_ invoke__\">longest</span>(<span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;ab&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;large one is &#123;large&#125;&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">// expected named lifetime parameter</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">longest</span>(x: &amp;<span class=\"type\">str</span>, y: &amp;<span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"type\">str</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> x.<span class=\"title function_ invoke__\">len</span>() &gt; y.<span class=\"title function_ invoke__\">len</span>() &#123;</span><br><span class=\"line\">          x</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          y</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果函数返回引用，且该引用依赖于输入参数的引用，必须显式标注生命周期参数</p>\n<pre><code class=\"rust\">#[test]\nfn test_lifetime() &#123;\n    let large = longest(&quot;a&quot;, &quot;ab&quot;);\n    println!(&quot;large one is &#123;large&#125;&quot;);\n    // modified\n    fn longest&lt;&#39;a&gt;(x: &amp;&#39;a str, y: &amp;&#39;a str) -&gt; &amp;&#39;a str &#123;\n        if x.len() &gt; y.len() &#123;\n          x\n        &#125; else &#123;\n          y\n        &#125;\n    &#125;\n&#125;\n</code></pre>\n","_processedHighlight":true},{"title":"IB-Rust-数组与切片","date":"2025-05-22T09:23:49.000Z","_content":"\n[Codes in lesson8](https://github.com/Zoella-w/IB-Rust/tree/main/8_array_slice)\n\n## 数组介绍\n\n[T; N] 表示 N 个值的数组，每个值的类型为 T。数组的大小是在编译期就已确定的常量，并且是类型的一部分，不能追加新元素或缩小数组\n\n任意一种类型的值 v，表达式 v.len() 会给出 v 中的元素数，v[i] 引用的是 v 的第 i 个元素（i 的类型必须是 usize）。Rust 会检查 i 是否在 0～v.len()-1 的范围内，如果没在则会出现 panic\n\n## 数组切片介绍\n\n&[T] 和 &mut [T] 可称为 T 的共享切片和 T 的可变切片，它们是对一系列元素的引用，这些元素是某个其他值（如：数组或向量）的一部分\n\n可以将切片视为指向其第一个元素的指针，以及从该点开始允许访问的元素数量的计数\n\n可变切片 &mut [T] 允许读取和修改元素，但不能共享；共享切片 &[T] 允许在多个读取者之间共享访问权限，但不允许修改\n\n## 数组\n\n- 数组是一段分配的**连续的相同数据类型的**内存块\n\n- 数组是静态的，一旦定义和初始化（为数组中每个元素赋值），则长度不可更改\n\n- 数组的元素有相同的数据类型，每个元素都独占数据类型大小的内存块，即数组的内存大小等于数组长度乘数组的数据类型大小\n\n- 数组中每个元素都按顺序依次存储，数组下标既代表元素的存储位置，也是数组元素的唯一标识\n\n- 可以更新或修改数组元素的值，但不能删除数组元素。如果要删除，可将值赋为表示删除的值（比如 0）\n\n## 切片\n\n切片（Slice）表示从包含多个元素的容器中取得局部数据，Rust 有三种数据类型支持 Slice 操作：String、Array 和 Vec\n\nRust 中的切片操作只允许获取一段连续的局部数据，该数据称作切片数据。而有些语言可以取得离散元素，甚至有些语言可以对 hash 结构进行切片操作\n\n## 切片常用函数\n\n- len()：slice 元素个数\n- is_empty()：判断 slice 是否为空\n- contains()：判断是否包含某个元素\n- repeat()：重复 slice 指定次数\n- reverse()：反转 slice\n- join()：将各元素压平（flatten）并通过指定的分隔符连接起来\n- swap()：交换两个索引处的元素\n- windows()：以指定大小的窗口进行滚动迭代\n- starts_with()：判断 slice 是否以某个 slice 开头\n\n## 课后习题\n\n> 给定一个整数数组 nums，返回一个数组 answer ，使得 answer[i] 等于 nums 除之外 nums[i] 的所有元素的乘积。\n> 任何前缀或后缀的乘积 nums 都保证适合 32 位整数。\n> 您必须编写一个能够及时运行 O(n) 且无需使用除法运算的算法。\n> \n> 示例 1：\n> 输入： nums = [1,2,3,4]\n> 输出： [24,12,8,6]\n> \n> 示例 2：\n> 输入： nums = [-1,1,0,-3,3]\n> 输出： [0,0,9,0,0]\n> \n> 限制：\n> 2 <= nums.length <= 105\n> -30 <= nums[i] <= 30\n> 任何前缀或后缀的乘积 nums 都保证适合 32 位整数。\n> \n> 进阶： 你能以 O(1) 额外空间复杂度解决这个问题吗？（输出数组不算作空间复杂度分析的额外空间。）\n\n``` rust\nfn main() {\n    let nums = [1, 2, 3, 4];\n    let answer = get_answer(nums.to_vec());\n    println!(\"answer is {:?}\", answer); // [24, 12, 8, 6]\n}\n\nfn get_answer(nums: Vec<i32>) -> Vec<i32> {\n    let n = nums.len();\n    let mut answer = vec![1; n];\n\n    // 计算前缀乘积：answer[i]\n    for i in 1..n {\n        // nums[1, n-1] 的前缀乘积（nums[0] 没有前缀）\n        answer[i] = answer[i - 1] * nums[i - 1];\n    }\n\n    // 计算后缀乘积，并更新 answer[i]\n    let mut right = 1; // right 表示当前元素右侧所有元素的乘积\n    for i in (0..n).rev() {\n        // 从 nums[n-1..0] 的乘积\n        answer[i] *= right; // 前缀乘积 * 后缀乘积\n        right *= nums[i]; // 更新后缀乘积\n    }\n\n    answer\n}\n```","source":"_posts/66-IB-Rust-数组与切片.md","raw":"---\ntitle: IB-Rust-数组与切片\ndate: 2025-05-22 17:23:49\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson8](https://github.com/Zoella-w/IB-Rust/tree/main/8_array_slice)\n\n## 数组介绍\n\n[T; N] 表示 N 个值的数组，每个值的类型为 T。数组的大小是在编译期就已确定的常量，并且是类型的一部分，不能追加新元素或缩小数组\n\n任意一种类型的值 v，表达式 v.len() 会给出 v 中的元素数，v[i] 引用的是 v 的第 i 个元素（i 的类型必须是 usize）。Rust 会检查 i 是否在 0～v.len()-1 的范围内，如果没在则会出现 panic\n\n## 数组切片介绍\n\n&[T] 和 &mut [T] 可称为 T 的共享切片和 T 的可变切片，它们是对一系列元素的引用，这些元素是某个其他值（如：数组或向量）的一部分\n\n可以将切片视为指向其第一个元素的指针，以及从该点开始允许访问的元素数量的计数\n\n可变切片 &mut [T] 允许读取和修改元素，但不能共享；共享切片 &[T] 允许在多个读取者之间共享访问权限，但不允许修改\n\n## 数组\n\n- 数组是一段分配的**连续的相同数据类型的**内存块\n\n- 数组是静态的，一旦定义和初始化（为数组中每个元素赋值），则长度不可更改\n\n- 数组的元素有相同的数据类型，每个元素都独占数据类型大小的内存块，即数组的内存大小等于数组长度乘数组的数据类型大小\n\n- 数组中每个元素都按顺序依次存储，数组下标既代表元素的存储位置，也是数组元素的唯一标识\n\n- 可以更新或修改数组元素的值，但不能删除数组元素。如果要删除，可将值赋为表示删除的值（比如 0）\n\n## 切片\n\n切片（Slice）表示从包含多个元素的容器中取得局部数据，Rust 有三种数据类型支持 Slice 操作：String、Array 和 Vec\n\nRust 中的切片操作只允许获取一段连续的局部数据，该数据称作切片数据。而有些语言可以取得离散元素，甚至有些语言可以对 hash 结构进行切片操作\n\n## 切片常用函数\n\n- len()：slice 元素个数\n- is_empty()：判断 slice 是否为空\n- contains()：判断是否包含某个元素\n- repeat()：重复 slice 指定次数\n- reverse()：反转 slice\n- join()：将各元素压平（flatten）并通过指定的分隔符连接起来\n- swap()：交换两个索引处的元素\n- windows()：以指定大小的窗口进行滚动迭代\n- starts_with()：判断 slice 是否以某个 slice 开头\n\n## 课后习题\n\n> 给定一个整数数组 nums，返回一个数组 answer ，使得 answer[i] 等于 nums 除之外 nums[i] 的所有元素的乘积。\n> 任何前缀或后缀的乘积 nums 都保证适合 32 位整数。\n> 您必须编写一个能够及时运行 O(n) 且无需使用除法运算的算法。\n> \n> 示例 1：\n> 输入： nums = [1,2,3,4]\n> 输出： [24,12,8,6]\n> \n> 示例 2：\n> 输入： nums = [-1,1,0,-3,3]\n> 输出： [0,0,9,0,0]\n> \n> 限制：\n> 2 <= nums.length <= 105\n> -30 <= nums[i] <= 30\n> 任何前缀或后缀的乘积 nums 都保证适合 32 位整数。\n> \n> 进阶： 你能以 O(1) 额外空间复杂度解决这个问题吗？（输出数组不算作空间复杂度分析的额外空间。）\n\n``` rust\nfn main() {\n    let nums = [1, 2, 3, 4];\n    let answer = get_answer(nums.to_vec());\n    println!(\"answer is {:?}\", answer); // [24, 12, 8, 6]\n}\n\nfn get_answer(nums: Vec<i32>) -> Vec<i32> {\n    let n = nums.len();\n    let mut answer = vec![1; n];\n\n    // 计算前缀乘积：answer[i]\n    for i in 1..n {\n        // nums[1, n-1] 的前缀乘积（nums[0] 没有前缀）\n        answer[i] = answer[i - 1] * nums[i - 1];\n    }\n\n    // 计算后缀乘积，并更新 answer[i]\n    let mut right = 1; // right 表示当前元素右侧所有元素的乘积\n    for i in (0..n).rev() {\n        // 从 nums[n-1..0] 的乘积\n        answer[i] *= right; // 前缀乘积 * 后缀乘积\n        right *= nums[i]; // 更新后缀乘积\n    }\n\n    answer\n}\n```","slug":"66-IB-Rust-数组与切片","published":1,"updated":"2025-05-23T06:36:18.193Z","_id":"cmb0ffvug00646kpr0fnm64i5","comments":1,"layout":"post","photos":[],"link":"","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/8_array_slice\" >Codes in lesson8<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"数组介绍\"><a href=\"#数组介绍\" class=\"headerlink\" title=\"数组介绍\"></a>数组介绍</h2><p>[T; N] 表示 N 个值的数组，每个值的类型为 T。数组的大小是在编译期就已确定的常量，并且是类型的一部分，不能追加新元素或缩小数组</p>\n<p>任意一种类型的值 v，表达式 v.len() 会给出 v 中的元素数，v[i] 引用的是 v 的第 i 个元素（i 的类型必须是 usize）。Rust 会检查 i 是否在 0～v.len()-1 的范围内，如果没在则会出现 panic</p>\n<h2 id=\"数组切片介绍\"><a href=\"#数组切片介绍\" class=\"headerlink\" title=\"数组切片介绍\"></a>数组切片介绍</h2><p>&amp;[T] 和 &amp;mut [T] 可称为 T 的共享切片和 T 的可变切片，它们是对一系列元素的引用，这些元素是某个其他值（如：数组或向量）的一部分</p>\n<p>可以将切片视为指向其第一个元素的指针，以及从该点开始允许访问的元素数量的计数</p>\n<p>可变切片 &amp;mut [T] 允许读取和修改元素，但不能共享；共享切片 &amp;[T] 允许在多个读取者之间共享访问权限，但不允许修改</p>\n<h2 id=\"数组\"><a href=\"#数组\" class=\"headerlink\" title=\"数组\"></a>数组</h2><ul>\n<li><p>数组是一段分配的<strong>连续的相同数据类型的</strong>内存块</p>\n</li>\n<li><p>数组是静态的，一旦定义和初始化（为数组中每个元素赋值），则长度不可更改</p>\n</li>\n<li><p>数组的元素有相同的数据类型，每个元素都独占数据类型大小的内存块，即数组的内存大小等于数组长度乘数组的数据类型大小</p>\n</li>\n<li><p>数组中每个元素都按顺序依次存储，数组下标既代表元素的存储位置，也是数组元素的唯一标识</p>\n</li>\n<li><p>可以更新或修改数组元素的值，但不能删除数组元素。如果要删除，可将值赋为表示删除的值（比如 0）</p>\n</li>\n</ul>\n<h2 id=\"切片\"><a href=\"#切片\" class=\"headerlink\" title=\"切片\"></a>切片</h2><p>切片（Slice）表示从包含多个元素的容器中取得局部数据，Rust 有三种数据类型支持 Slice 操作：String、Array 和 Vec</p>\n<p>Rust 中的切片操作只允许获取一段连续的局部数据，该数据称作切片数据。而有些语言可以取得离散元素，甚至有些语言可以对 hash 结构进行切片操作</p>\n<h2 id=\"切片常用函数\"><a href=\"#切片常用函数\" class=\"headerlink\" title=\"切片常用函数\"></a>切片常用函数</h2><ul>\n<li>len()：slice 元素个数</li>\n<li>is_empty()：判断 slice 是否为空</li>\n<li>contains()：判断是否包含某个元素</li>\n<li>repeat()：重复 slice 指定次数</li>\n<li>reverse()：反转 slice</li>\n<li>join()：将各元素压平（flatten）并通过指定的分隔符连接起来</li>\n<li>swap()：交换两个索引处的元素</li>\n<li>windows()：以指定大小的窗口进行滚动迭代</li>\n<li>starts_with()：判断 slice 是否以某个 slice 开头</li>\n</ul>\n<h2 id=\"课后习题\"><a href=\"#课后习题\" class=\"headerlink\" title=\"课后习题\"></a>课后习题</h2><blockquote>\n<p>给定一个整数数组 nums，返回一个数组 answer ，使得 answer[i] 等于 nums 除之外 nums[i] 的所有元素的乘积。<br>任何前缀或后缀的乘积 nums 都保证适合 32 位整数。<br>您必须编写一个能够及时运行 O(n) 且无需使用除法运算的算法。</p>\n<p>示例 1：<br>输入： nums &#x3D; [1,2,3,4]<br>输出： [24,12,8,6]</p>\n<p>示例 2：<br>输入： nums &#x3D; [-1,1,0,-3,3]<br>输出： [0,0,9,0,0]</p>\n<p>限制：<br>2 &lt;&#x3D; nums.length &lt;&#x3D; 105<br>-30 &lt;&#x3D; nums[i] &lt;&#x3D; 30<br>任何前缀或后缀的乘积 nums 都保证适合 32 位整数。</p>\n<p>进阶： 你能以 O(1) 额外空间复杂度解决这个问题吗？（输出数组不算作空间复杂度分析的额外空间。）</p>\n</blockquote>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">nums</span> = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>];</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">answer</span> = <span class=\"title function_ invoke__\">get_answer</span>(nums.<span class=\"title function_ invoke__\">to_vec</span>());</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;answer is &#123;:?&#125;&quot;</span>, answer); <span class=\"comment\">// [24, 12, 8, 6]</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">get_answer</span>(nums: <span class=\"type\">Vec</span>&lt;<span class=\"type\">i32</span>&gt;) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Vec</span>&lt;<span class=\"type\">i32</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">n</span> = nums.<span class=\"title function_ invoke__\">len</span>();</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">answer</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>; n];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 计算前缀乘积：answer[i]</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"variable\">i</span> <span class=\"keyword\">in</span> <span class=\"number\">1</span>..n &#123;</span><br><span class=\"line\">        <span class=\"comment\">// nums[1, n-1] 的前缀乘积（nums[0] 没有前缀）</span></span><br><span class=\"line\">        answer[i] = answer[i - <span class=\"number\">1</span>] * nums[i - <span class=\"number\">1</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 计算后缀乘积，并更新 answer[i]</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">right</span> = <span class=\"number\">1</span>; <span class=\"comment\">// right 表示当前元素右侧所有元素的乘积</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"variable\">i</span> <span class=\"keyword\">in</span> (<span class=\"number\">0</span>..n).<span class=\"title function_ invoke__\">rev</span>() &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 从 nums[n-1..0] 的乘积</span></span><br><span class=\"line\">        answer[i] *= right; <span class=\"comment\">// 前缀乘积 * 后缀乘积</span></span><br><span class=\"line\">        right *= nums[i]; <span class=\"comment\">// 更新后缀乘积</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    answer</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/8_array_slice\" >Codes in lesson8<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"数组介绍\"><a href=\"#数组介绍\" class=\"headerlink\" title=\"数组介绍\"></a>数组介绍</h2><p>[T; N] 表示 N 个值的数组，每个值的类型为 T。数组的大小是在编译期就已确定的常量，并且是类型的一部分，不能追加新元素或缩小数组</p>\n<p>任意一种类型的值 v，表达式 v.len() 会给出 v 中的元素数，v[i] 引用的是 v 的第 i 个元素（i 的类型必须是 usize）。Rust 会检查 i 是否在 0～v.len()-1 的范围内，如果没在则会出现 panic</p>\n<h2 id=\"数组切片介绍\"><a href=\"#数组切片介绍\" class=\"headerlink\" title=\"数组切片介绍\"></a>数组切片介绍</h2><p>&amp;[T] 和 &amp;mut [T] 可称为 T 的共享切片和 T 的可变切片，它们是对一系列元素的引用，这些元素是某个其他值（如：数组或向量）的一部分</p>\n<p>可以将切片视为指向其第一个元素的指针，以及从该点开始允许访问的元素数量的计数</p>\n<p>可变切片 &amp;mut [T] 允许读取和修改元素，但不能共享；共享切片 &amp;[T] 允许在多个读取者之间共享访问权限，但不允许修改</p>\n<h2 id=\"数组\"><a href=\"#数组\" class=\"headerlink\" title=\"数组\"></a>数组</h2><ul>\n<li><p>数组是一段分配的<strong>连续的相同数据类型的</strong>内存块</p>\n</li>\n<li><p>数组是静态的，一旦定义和初始化（为数组中每个元素赋值），则长度不可更改</p>\n</li>\n<li><p>数组的元素有相同的数据类型，每个元素都独占数据类型大小的内存块，即数组的内存大小等于数组长度乘数组的数据类型大小</p>\n</li>\n<li><p>数组中每个元素都按顺序依次存储，数组下标既代表元素的存储位置，也是数组元素的唯一标识</p>\n</li>\n<li><p>可以更新或修改数组元素的值，但不能删除数组元素。如果要删除，可将值赋为表示删除的值（比如 0）</p>\n</li>\n</ul>\n<h2 id=\"切片\"><a href=\"#切片\" class=\"headerlink\" title=\"切片\"></a>切片</h2><p>切片（Slice）表示从包含多个元素的容器中取得局部数据，Rust 有三种数据类型支持 Slice 操作：String、Array 和 Vec</p>\n<p>Rust 中的切片操作只允许获取一段连续的局部数据，该数据称作切片数据。而有些语言可以取得离散元素，甚至有些语言可以对 hash 结构进行切片操作</p>\n<h2 id=\"切片常用函数\"><a href=\"#切片常用函数\" class=\"headerlink\" title=\"切片常用函数\"></a>切片常用函数</h2><ul>\n<li>len()：slice 元素个数</li>\n<li>is_empty()：判断 slice 是否为空</li>\n<li>contains()：判断是否包含某个元素</li>\n<li>repeat()：重复 slice 指定次数</li>\n<li>reverse()：反转 slice</li>\n<li>join()：将各元素压平（flatten）并通过指定的分隔符连接起来</li>\n<li>swap()：交换两个索引处的元素</li>\n<li>windows()：以指定大小的窗口进行滚动迭代</li>\n<li>starts_with()：判断 slice 是否以某个 slice 开头</li>\n</ul>\n<h2 id=\"课后习题\"><a href=\"#课后习题\" class=\"headerlink\" title=\"课后习题\"></a>课后习题</h2><blockquote>\n<p>给定一个整数数组 nums，返回一个数组 answer ，使得 answer[i] 等于 nums 除之外 nums[i] 的所有元素的乘积。<br>任何前缀或后缀的乘积 nums 都保证适合 32 位整数。<br>您必须编写一个能够及时运行 O(n) 且无需使用除法运算的算法。</p>\n<p>示例 1：<br>输入： nums &#x3D; [1,2,3,4]<br>输出： [24,12,8,6]</p>\n<p>示例 2：<br>输入： nums &#x3D; [-1,1,0,-3,3]<br>输出： [0,0,9,0,0]</p>\n<p>限制：<br>2 &lt;&#x3D; nums.length &lt;&#x3D; 105<br>-30 &lt;&#x3D; nums[i] &lt;&#x3D; 30<br>任何前缀或后缀的乘积 nums 都保证适合 32 位整数。</p>\n<p>进阶： 你能以 O(1) 额外空间复杂度解决这个问题吗？（输出数组不算作空间复杂度分析的额外空间。）</p>\n</blockquote>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">nums</span> = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>];</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">answer</span> = <span class=\"title function_ invoke__\">get_answer</span>(nums.<span class=\"title function_ invoke__\">to_vec</span>());</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;answer is &#123;:?&#125;&quot;</span>, answer); <span class=\"comment\">// [24, 12, 8, 6]</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">get_answer</span>(nums: <span class=\"type\">Vec</span>&lt;<span class=\"type\">i32</span>&gt;) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Vec</span>&lt;<span class=\"type\">i32</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">n</span> = nums.<span class=\"title function_ invoke__\">len</span>();</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">answer</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>; n];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 计算前缀乘积：answer[i]</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"variable\">i</span> <span class=\"keyword\">in</span> <span class=\"number\">1</span>..n &#123;</span><br><span class=\"line\">        <span class=\"comment\">// nums[1, n-1] 的前缀乘积（nums[0] 没有前缀）</span></span><br><span class=\"line\">        answer[i] = answer[i - <span class=\"number\">1</span>] * nums[i - <span class=\"number\">1</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 计算后缀乘积，并更新 answer[i]</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">right</span> = <span class=\"number\">1</span>; <span class=\"comment\">// right 表示当前元素右侧所有元素的乘积</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"variable\">i</span> <span class=\"keyword\">in</span> (<span class=\"number\">0</span>..n).<span class=\"title function_ invoke__\">rev</span>() &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 从 nums[n-1..0] 的乘积</span></span><br><span class=\"line\">        answer[i] *= right; <span class=\"comment\">// 前缀乘积 * 后缀乘积</span></span><br><span class=\"line\">        right *= nums[i]; <span class=\"comment\">// 更新后缀乘积</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    answer</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","_processedHighlight":true},{"title":"v-for","date":"2023-11-29T02:41:57.000Z","_content":"\n## 基础\n\n``` html\n<li v-for=\"(item, index) in items\"></li>\n```\n\n可以使用 of 代替 in：\n\n``` html\n<li v-for=\"(item, index) of items\"></li>\n```\n\n支持解构语法：\n\n``` html\n<li v-for=\"{message} in items\">\n    {{ message }}\n</li>\n\n<li v-for=\"({message}, index) in items\">\n    {{ message }}\n</li>\n```\n\n## 遍历对象属性\n\n使用 v-for 遍历对象属性，遍历的顺序和 Object.keys() 返回值的顺序一致\n\n三个参数依次为 索引、属性名、属性值：\n\n``` js\nconst myObject = reactive({\n  title: 'How to do lists in Vue',\n  author: 'Jane Doe',\n  publishedAt: '2016-04-10'\n});\n```\n\n``` html\n<li v-for=\"(index, key, value) in myObject\">\n{{ index }}. {{ key }}: {{ value }}\n</li>\n```\n\n结果为：\n\n``` txt\n0. title: How to do lists in Vue\n1. author: Jane Doe\n2. publishedAt: 2016-04-10\n```\n\n## v-for 与 v-if\n\nv-if 比 v-for 优先级高\n\n错误用法：\n\n``` html\n<!-- 此时 v-if 的 todo 还没有定义 -->\n<li v-for=\"todo in todos\" v-if=\"!todo.isComplete\">\n{{ todo.name }}\n</li>\n```\n\n正确用法：\n\n``` html\n<template v-for=\"todo in todos\">\n   <li v-if=\"!todo.isComplete\">\n   {{ todo.name }}\n   </li>\n</template>\n```\n\n## 通过 key 管理状态\n\nVue 默认按照 “就地更新” 的策略更新通过 v-for 渲染的列表。当数据项的顺序改变时，Vue 不会随之移动 DOM 元素的顺序，而是就地更新每个元素，确保它们在原本指定的索引位置上渲染。\n\n默认模式是高效的，但只适用于 **列表渲染输出的结果不依赖子组件状态或者临时 DOM 状态 (例如表单输入值) 的情况**。\n\n推荐在任何时候为 v-for 提供一个 key attribute，除非所迭代的 DOM 内容非常简单。\n","source":"_posts/7-v-for.md","raw":"---\ntitle: v-for\ndate: 2023-11-29 10:41:57\ntags: \n    - vue\ncategories:\n    - vue\n      - 文档\n---\n\n## 基础\n\n``` html\n<li v-for=\"(item, index) in items\"></li>\n```\n\n可以使用 of 代替 in：\n\n``` html\n<li v-for=\"(item, index) of items\"></li>\n```\n\n支持解构语法：\n\n``` html\n<li v-for=\"{message} in items\">\n    {{ message }}\n</li>\n\n<li v-for=\"({message}, index) in items\">\n    {{ message }}\n</li>\n```\n\n## 遍历对象属性\n\n使用 v-for 遍历对象属性，遍历的顺序和 Object.keys() 返回值的顺序一致\n\n三个参数依次为 索引、属性名、属性值：\n\n``` js\nconst myObject = reactive({\n  title: 'How to do lists in Vue',\n  author: 'Jane Doe',\n  publishedAt: '2016-04-10'\n});\n```\n\n``` html\n<li v-for=\"(index, key, value) in myObject\">\n{{ index }}. {{ key }}: {{ value }}\n</li>\n```\n\n结果为：\n\n``` txt\n0. title: How to do lists in Vue\n1. author: Jane Doe\n2. publishedAt: 2016-04-10\n```\n\n## v-for 与 v-if\n\nv-if 比 v-for 优先级高\n\n错误用法：\n\n``` html\n<!-- 此时 v-if 的 todo 还没有定义 -->\n<li v-for=\"todo in todos\" v-if=\"!todo.isComplete\">\n{{ todo.name }}\n</li>\n```\n\n正确用法：\n\n``` html\n<template v-for=\"todo in todos\">\n   <li v-if=\"!todo.isComplete\">\n   {{ todo.name }}\n   </li>\n</template>\n```\n\n## 通过 key 管理状态\n\nVue 默认按照 “就地更新” 的策略更新通过 v-for 渲染的列表。当数据项的顺序改变时，Vue 不会随之移动 DOM 元素的顺序，而是就地更新每个元素，确保它们在原本指定的索引位置上渲染。\n\n默认模式是高效的，但只适用于 **列表渲染输出的结果不依赖子组件状态或者临时 DOM 状态 (例如表单输入值) 的情况**。\n\n推荐在任何时候为 v-for 提供一个 key attribute，除非所迭代的 DOM 内容非常简单。\n","slug":"7-v-for","published":1,"updated":"2025-05-20T02:47:28.686Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvug00686kprfkn0c08i","content":"<h2 id=\"基础\"><a href=\"#基础\" class=\"headerlink\" title=\"基础\"></a>基础</h2><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(item, index) in items&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>可以使用 of 代替 in：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(item, index) of items&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>支持解构语法：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;&#123;message&#125; in items&quot;</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123; message &#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(&#123;message&#125;, index) in items&quot;</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123; message &#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"遍历对象属性\"><a href=\"#遍历对象属性\" class=\"headerlink\" title=\"遍历对象属性\"></a>遍历对象属性</h2><p>使用 v-for 遍历对象属性，遍历的顺序和 Object.keys() 返回值的顺序一致</p>\n<p>三个参数依次为 索引、属性名、属性值：</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> myObject = <span class=\"title function_\">reactive</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">title</span>: <span class=\"string\">&#x27;How to do lists in Vue&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">author</span>: <span class=\"string\">&#x27;Jane Doe&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">publishedAt</span>: <span class=\"string\">&#x27;2016-04-10&#x27;</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(index, key, value) in myObject&quot;</span>&gt;</span></span><br><span class=\"line\">&#123;&#123; index &#125;&#125;. &#123;&#123; key &#125;&#125;: &#123;&#123; value &#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>结果为：</p>\n<div class=\"code-container\" data-rel=\"Txt\"><figure class=\"iseeu highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0. title: How to do lists in Vue</span><br><span class=\"line\">1. author: Jane Doe</span><br><span class=\"line\">2. publishedAt: 2016-04-10</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"v-for-与-v-if\"><a href=\"#v-for-与-v-if\" class=\"headerlink\" title=\"v-for 与 v-if\"></a>v-for 与 v-if</h2><p>v-if 比 v-for 优先级高</p>\n<p>错误用法：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 此时 v-if 的 todo 还没有定义 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;todo in todos&quot;</span> <span class=\"attr\">v-if</span>=<span class=\"string\">&quot;!todo.isComplete&quot;</span>&gt;</span></span><br><span class=\"line\">&#123;&#123; todo.name &#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>正确用法：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;todo in todos&quot;</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-if</span>=<span class=\"string\">&quot;!todo.isComplete&quot;</span>&gt;</span></span><br><span class=\"line\">   &#123;&#123; todo.name &#125;&#125;</span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"通过-key-管理状态\"><a href=\"#通过-key-管理状态\" class=\"headerlink\" title=\"通过 key 管理状态\"></a>通过 key 管理状态</h2><p>Vue 默认按照 “就地更新” 的策略更新通过 v-for 渲染的列表。当数据项的顺序改变时，Vue 不会随之移动 DOM 元素的顺序，而是就地更新每个元素，确保它们在原本指定的索引位置上渲染。</p>\n<p>默认模式是高效的，但只适用于 <strong>列表渲染输出的结果不依赖子组件状态或者临时 DOM 状态 (例如表单输入值) 的情况</strong>。</p>\n<p>推荐在任何时候为 v-for 提供一个 key attribute，除非所迭代的 DOM 内容非常简单。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"基础\"><a href=\"#基础\" class=\"headerlink\" title=\"基础\"></a>基础</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(item, index) in items&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>可以使用 of 代替 in：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(item, index) of items&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>支持解构语法：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;&#123;message&#125; in items&quot;</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123; message &#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(&#123;message&#125;, index) in items&quot;</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123; message &#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"遍历对象属性\"><a href=\"#遍历对象属性\" class=\"headerlink\" title=\"遍历对象属性\"></a>遍历对象属性</h2><p>使用 v-for 遍历对象属性，遍历的顺序和 Object.keys() 返回值的顺序一致</p>\n<p>三个参数依次为 索引、属性名、属性值：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> myObject = <span class=\"title function_\">reactive</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">title</span>: <span class=\"string\">&#x27;How to do lists in Vue&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">author</span>: <span class=\"string\">&#x27;Jane Doe&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">publishedAt</span>: <span class=\"string\">&#x27;2016-04-10&#x27;</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(index, key, value) in myObject&quot;</span>&gt;</span></span><br><span class=\"line\">&#123;&#123; index &#125;&#125;. &#123;&#123; key &#125;&#125;: &#123;&#123; value &#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>结果为：</p>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0. title: How to do lists in Vue</span><br><span class=\"line\">1. author: Jane Doe</span><br><span class=\"line\">2. publishedAt: 2016-04-10</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"v-for-与-v-if\"><a href=\"#v-for-与-v-if\" class=\"headerlink\" title=\"v-for 与 v-if\"></a>v-for 与 v-if</h2><p>v-if 比 v-for 优先级高</p>\n<p>错误用法：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 此时 v-if 的 todo 还没有定义 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;todo in todos&quot;</span> <span class=\"attr\">v-if</span>=<span class=\"string\">&quot;!todo.isComplete&quot;</span>&gt;</span></span><br><span class=\"line\">&#123;&#123; todo.name &#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>正确用法：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;todo in todos&quot;</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-if</span>=<span class=\"string\">&quot;!todo.isComplete&quot;</span>&gt;</span></span><br><span class=\"line\">   &#123;&#123; todo.name &#125;&#125;</span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"通过-key-管理状态\"><a href=\"#通过-key-管理状态\" class=\"headerlink\" title=\"通过 key 管理状态\"></a>通过 key 管理状态</h2><p>Vue 默认按照 “就地更新” 的策略更新通过 v-for 渲染的列表。当数据项的顺序改变时，Vue 不会随之移动 DOM 元素的顺序，而是就地更新每个元素，确保它们在原本指定的索引位置上渲染。</p>\n<p>默认模式是高效的，但只适用于 <strong>列表渲染输出的结果不依赖子组件状态或者临时 DOM 状态 (例如表单输入值) 的情况</strong>。</p>\n<p>推荐在任何时候为 v-for 提供一个 key attribute，除非所迭代的 DOM 内容非常简单。</p>\n","_processedHighlight":true},{"title":"js 事件","date":"2023-11-29T09:38:02.000Z","_content":"\n事件捕获和事件冒泡 是浏览器处理DOM元素事件的两种方式（顺序：先捕获，再冒泡）。\n\n``` html\n<!DOCTYPE html>\n<html>\n  <body>\n      <div>click me</div>\n  </body>\n</html>\n```\n\n## 事件捕获\n\n事件捕获从文档根节点开始，逐级向下传播到目标元素。\n\n点击 div，事件传播方向：document -> html -> body -> div\n\n## 事件冒泡\n\n事件冒泡指当目标元素触发了某事件时，事件会从该元素开始逐级向上传播，直到文档根节点。\n\n点击 div，事件传播方向：div -> body -> html -> document\n\n## 事件模型\n\n### DOM0 事件模型\n\nDOM0 只在冒泡阶段处理事件处理程序。\n\n``` html\n<div onclick=\"handleClick\">click</div>\n<script>\n  function handleClick() {\n    alert('clicked');\n  }\n</script>\n```\n\n### DOM2 事件模型\n\nDOM2 在捕获阶段和冒泡阶段都可以处理事件处理程序（更灵活可控）。\n\n使用：addEventListener() 和 removeEventListener()\n\n``` html\n<div id=\"myBtn\">click</div>\n<script>\n  function handleClick() {\n    alert('clicked');\n  }\n  const btn = document.getElementById('myBtn');\n  btn.addEventListener('click', handleClick);\n</script>\n```\n\n### IE 事件模型\n\n功能类似于 DOM0，使用方式上类似于 DOM2。\n\n使用 attachEvent() 和 detachEvent() 方法。\n\n``` html\n<div id=\"myBtn\">click</div>\n<script>\n  function handleClick() {\n    alert('clicked');\n  }\n  const btn = document.getElementById('myBtn');\n  btn.attachEvent('click', handleClick);\n</script>\n```\n\n## js 实现事件修饰符\n\n### 阻止默认行为 preventDefault\n\n比如阻止链接的跳转或表单的提交\n\n``` js\ndocument.getElementById('btn').addEventListener('click', (event) => {\n  event.preventDefault();\n});\n```\n\n### 阻止事件冒泡 stopPropagation()\n\n阻止事件传到父元素\n\n``` js\ndocument.getElementById('btn').addEventListener('click', (event) => {\n  event.stopPropagation();\n});\n```\n\n### 一次性事件处理\n\n``` js\nfunction handleClick(event) {\n  this.removeEventListener('click', handleClick); // 点击一次移除监听器\n}\ndocument.getElementById('btn').addEventListener('click', handleClick);\n```\n\n### 获取键盘按键\n\n``` js\ndocument.addEventListener('keydown', (event) => {\n  console.log(event.key);\n});\n```\n\n### 获取鼠标按键\n\n``` js\ndocument.addEventListener('mousedown', (event) => {\n  console.log(event.key);\n});\n```\n","source":"_posts/8-js事件.md","raw":"---\ntitle: js 事件\ndate: 2023-11-29 17:38:02\ntags:\n    - JavaScript\ncategories:\n    - JavaScript\n      - 事件\n---\n\n事件捕获和事件冒泡 是浏览器处理DOM元素事件的两种方式（顺序：先捕获，再冒泡）。\n\n``` html\n<!DOCTYPE html>\n<html>\n  <body>\n      <div>click me</div>\n  </body>\n</html>\n```\n\n## 事件捕获\n\n事件捕获从文档根节点开始，逐级向下传播到目标元素。\n\n点击 div，事件传播方向：document -> html -> body -> div\n\n## 事件冒泡\n\n事件冒泡指当目标元素触发了某事件时，事件会从该元素开始逐级向上传播，直到文档根节点。\n\n点击 div，事件传播方向：div -> body -> html -> document\n\n## 事件模型\n\n### DOM0 事件模型\n\nDOM0 只在冒泡阶段处理事件处理程序。\n\n``` html\n<div onclick=\"handleClick\">click</div>\n<script>\n  function handleClick() {\n    alert('clicked');\n  }\n</script>\n```\n\n### DOM2 事件模型\n\nDOM2 在捕获阶段和冒泡阶段都可以处理事件处理程序（更灵活可控）。\n\n使用：addEventListener() 和 removeEventListener()\n\n``` html\n<div id=\"myBtn\">click</div>\n<script>\n  function handleClick() {\n    alert('clicked');\n  }\n  const btn = document.getElementById('myBtn');\n  btn.addEventListener('click', handleClick);\n</script>\n```\n\n### IE 事件模型\n\n功能类似于 DOM0，使用方式上类似于 DOM2。\n\n使用 attachEvent() 和 detachEvent() 方法。\n\n``` html\n<div id=\"myBtn\">click</div>\n<script>\n  function handleClick() {\n    alert('clicked');\n  }\n  const btn = document.getElementById('myBtn');\n  btn.attachEvent('click', handleClick);\n</script>\n```\n\n## js 实现事件修饰符\n\n### 阻止默认行为 preventDefault\n\n比如阻止链接的跳转或表单的提交\n\n``` js\ndocument.getElementById('btn').addEventListener('click', (event) => {\n  event.preventDefault();\n});\n```\n\n### 阻止事件冒泡 stopPropagation()\n\n阻止事件传到父元素\n\n``` js\ndocument.getElementById('btn').addEventListener('click', (event) => {\n  event.stopPropagation();\n});\n```\n\n### 一次性事件处理\n\n``` js\nfunction handleClick(event) {\n  this.removeEventListener('click', handleClick); // 点击一次移除监听器\n}\ndocument.getElementById('btn').addEventListener('click', handleClick);\n```\n\n### 获取键盘按键\n\n``` js\ndocument.addEventListener('keydown', (event) => {\n  console.log(event.key);\n});\n```\n\n### 获取鼠标按键\n\n``` js\ndocument.addEventListener('mousedown', (event) => {\n  console.log(event.key);\n});\n```\n","slug":"8-js事件","published":1,"updated":"2025-05-20T02:47:28.686Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvug006c6kpr5cxphaim","content":"<p>事件捕获和事件冒泡 是浏览器处理DOM元素事件的两种方式（顺序：先捕获，再冒泡）。</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>click me<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"事件捕获\"><a href=\"#事件捕获\" class=\"headerlink\" title=\"事件捕获\"></a>事件捕获</h2><p>事件捕获从文档根节点开始，逐级向下传播到目标元素。</p>\n<p>点击 div，事件传播方向：document -&gt; html -&gt; body -&gt; div</p>\n<h2 id=\"事件冒泡\"><a href=\"#事件冒泡\" class=\"headerlink\" title=\"事件冒泡\"></a>事件冒泡</h2><p>事件冒泡指当目标元素触发了某事件时，事件会从该元素开始逐级向上传播，直到文档根节点。</p>\n<p>点击 div，事件传播方向：div -&gt; body -&gt; html -&gt; document</p>\n<h2 id=\"事件模型\"><a href=\"#事件模型\" class=\"headerlink\" title=\"事件模型\"></a>事件模型</h2><h3 id=\"DOM0-事件模型\"><a href=\"#DOM0-事件模型\" class=\"headerlink\" title=\"DOM0 事件模型\"></a>DOM0 事件模型</h3><p>DOM0 只在冒泡阶段处理事件处理程序。</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onclick</span>=<span class=\"string\">&quot;handleClick&quot;</span>&gt;</span>click<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">function</span> <span class=\"title function_\">handleClick</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">alert</span>(<span class=\"string\">&#x27;clicked&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"DOM2-事件模型\"><a href=\"#DOM2-事件模型\" class=\"headerlink\" title=\"DOM2 事件模型\"></a>DOM2 事件模型</h3><p>DOM2 在捕获阶段和冒泡阶段都可以处理事件处理程序（更灵活可控）。</p>\n<p>使用：addEventListener() 和 removeEventListener()</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;myBtn&quot;</span>&gt;</span>click<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">function</span> <span class=\"title function_\">handleClick</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">alert</span>(<span class=\"string\">&#x27;clicked&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">const</span> btn = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;myBtn&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">  btn.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, handleClick);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"IE-事件模型\"><a href=\"#IE-事件模型\" class=\"headerlink\" title=\"IE 事件模型\"></a>IE 事件模型</h3><p>功能类似于 DOM0，使用方式上类似于 DOM2。</p>\n<p>使用 attachEvent() 和 detachEvent() 方法。</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;myBtn&quot;</span>&gt;</span>click<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">function</span> <span class=\"title function_\">handleClick</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">alert</span>(<span class=\"string\">&#x27;clicked&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">const</span> btn = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;myBtn&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">  btn.<span class=\"title function_\">attachEvent</span>(<span class=\"string\">&#x27;click&#x27;</span>, handleClick);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"js-实现事件修饰符\"><a href=\"#js-实现事件修饰符\" class=\"headerlink\" title=\"js 实现事件修饰符\"></a>js 实现事件修饰符</h2><h3 id=\"阻止默认行为-preventDefault\"><a href=\"#阻止默认行为-preventDefault\" class=\"headerlink\" title=\"阻止默认行为 preventDefault\"></a>阻止默认行为 preventDefault</h3><p>比如阻止链接的跳转或表单的提交</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;btn&#x27;</span>).<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, <span class=\"function\">(<span class=\"params\">event</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  event.<span class=\"title function_\">preventDefault</span>();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"阻止事件冒泡-stopPropagation\"><a href=\"#阻止事件冒泡-stopPropagation\" class=\"headerlink\" title=\"阻止事件冒泡 stopPropagation()\"></a>阻止事件冒泡 stopPropagation()</h3><p>阻止事件传到父元素</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;btn&#x27;</span>).<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, <span class=\"function\">(<span class=\"params\">event</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  event.<span class=\"title function_\">stopPropagation</span>();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"一次性事件处理\"><a href=\"#一次性事件处理\" class=\"headerlink\" title=\"一次性事件处理\"></a>一次性事件处理</h3><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">handleClick</span>(<span class=\"params\">event</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, handleClick); <span class=\"comment\">// 点击一次移除监听器</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;btn&#x27;</span>).<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, handleClick);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"获取键盘按键\"><a href=\"#获取键盘按键\" class=\"headerlink\" title=\"获取键盘按键\"></a>获取键盘按键</h3><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;keydown&#x27;</span>, <span class=\"function\">(<span class=\"params\">event</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(event.<span class=\"property\">key</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"获取鼠标按键\"><a href=\"#获取鼠标按键\" class=\"headerlink\" title=\"获取鼠标按键\"></a>获取鼠标按键</h3><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, <span class=\"function\">(<span class=\"params\">event</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(event.<span class=\"property\">key</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<p>事件捕获和事件冒泡 是浏览器处理DOM元素事件的两种方式（顺序：先捕获，再冒泡）。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>click me<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"事件捕获\"><a href=\"#事件捕获\" class=\"headerlink\" title=\"事件捕获\"></a>事件捕获</h2><p>事件捕获从文档根节点开始，逐级向下传播到目标元素。</p>\n<p>点击 div，事件传播方向：document -&gt; html -&gt; body -&gt; div</p>\n<h2 id=\"事件冒泡\"><a href=\"#事件冒泡\" class=\"headerlink\" title=\"事件冒泡\"></a>事件冒泡</h2><p>事件冒泡指当目标元素触发了某事件时，事件会从该元素开始逐级向上传播，直到文档根节点。</p>\n<p>点击 div，事件传播方向：div -&gt; body -&gt; html -&gt; document</p>\n<h2 id=\"事件模型\"><a href=\"#事件模型\" class=\"headerlink\" title=\"事件模型\"></a>事件模型</h2><h3 id=\"DOM0-事件模型\"><a href=\"#DOM0-事件模型\" class=\"headerlink\" title=\"DOM0 事件模型\"></a>DOM0 事件模型</h3><p>DOM0 只在冒泡阶段处理事件处理程序。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onclick</span>=<span class=\"string\">&quot;handleClick&quot;</span>&gt;</span>click<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">function</span> <span class=\"title function_\">handleClick</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">alert</span>(<span class=\"string\">&#x27;clicked&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"DOM2-事件模型\"><a href=\"#DOM2-事件模型\" class=\"headerlink\" title=\"DOM2 事件模型\"></a>DOM2 事件模型</h3><p>DOM2 在捕获阶段和冒泡阶段都可以处理事件处理程序（更灵活可控）。</p>\n<p>使用：addEventListener() 和 removeEventListener()</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;myBtn&quot;</span>&gt;</span>click<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">function</span> <span class=\"title function_\">handleClick</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">alert</span>(<span class=\"string\">&#x27;clicked&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">const</span> btn = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;myBtn&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">  btn.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, handleClick);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"IE-事件模型\"><a href=\"#IE-事件模型\" class=\"headerlink\" title=\"IE 事件模型\"></a>IE 事件模型</h3><p>功能类似于 DOM0，使用方式上类似于 DOM2。</p>\n<p>使用 attachEvent() 和 detachEvent() 方法。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;myBtn&quot;</span>&gt;</span>click<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">function</span> <span class=\"title function_\">handleClick</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">alert</span>(<span class=\"string\">&#x27;clicked&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"keyword\">const</span> btn = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;myBtn&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">  btn.<span class=\"title function_\">attachEvent</span>(<span class=\"string\">&#x27;click&#x27;</span>, handleClick);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"js-实现事件修饰符\"><a href=\"#js-实现事件修饰符\" class=\"headerlink\" title=\"js 实现事件修饰符\"></a>js 实现事件修饰符</h2><h3 id=\"阻止默认行为-preventDefault\"><a href=\"#阻止默认行为-preventDefault\" class=\"headerlink\" title=\"阻止默认行为 preventDefault\"></a>阻止默认行为 preventDefault</h3><p>比如阻止链接的跳转或表单的提交</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;btn&#x27;</span>).<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, <span class=\"function\">(<span class=\"params\">event</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  event.<span class=\"title function_\">preventDefault</span>();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"阻止事件冒泡-stopPropagation\"><a href=\"#阻止事件冒泡-stopPropagation\" class=\"headerlink\" title=\"阻止事件冒泡 stopPropagation()\"></a>阻止事件冒泡 stopPropagation()</h3><p>阻止事件传到父元素</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;btn&#x27;</span>).<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, <span class=\"function\">(<span class=\"params\">event</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  event.<span class=\"title function_\">stopPropagation</span>();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"一次性事件处理\"><a href=\"#一次性事件处理\" class=\"headerlink\" title=\"一次性事件处理\"></a>一次性事件处理</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">handleClick</span>(<span class=\"params\">event</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, handleClick); <span class=\"comment\">// 点击一次移除监听器</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;btn&#x27;</span>).<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;click&#x27;</span>, handleClick);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"获取键盘按键\"><a href=\"#获取键盘按键\" class=\"headerlink\" title=\"获取键盘按键\"></a>获取键盘按键</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;keydown&#x27;</span>, <span class=\"function\">(<span class=\"params\">event</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(event.<span class=\"property\">key</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"获取鼠标按键\"><a href=\"#获取鼠标按键\" class=\"headerlink\" title=\"获取鼠标按键\"></a>获取鼠标按键</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, <span class=\"function\">(<span class=\"params\">event</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(event.<span class=\"property\">key</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"vue 事件处理","date":"2023-11-30T10:50:13.000Z","_content":"\nv-on:click=\"\" 缩写为 @click\n\n## 在內联事件处理器中访问事件参数\n\n在內联事件中访问原生 DOM 事件：\n\n### 向处理器中传入一个 $event 变量\n\n``` html\n<button @click=\"warn('message1', $event)\">\nSubmit\n</button>\n```\n\n### 使用内联箭头函数\n\n``` html\n<button @click=\"(event) => warn('message1', event)\">\nSubmit\n</button>\n```\n\n``` js\nfunction warn(message, event) {\n  // 在此处可以访问原生事件\n  if (event) {\n    event.preventDefault()\n  }\n  alert(message)\n}\n```\n\n## 事件修饰符\n\n- stop：调用 event.stopPropagation()，阻止事件继续传播。\n- prevent：调用 event.preventDefault()，阻止事件的默认行为。\n- self：只当事件是从原始目标元素本身触发时触发回调，如果事件是从内部元素冒泡上来的则不触发。\n- capture：添加事件监听器时使用 capture 模式，即在捕获阶段触发而不是冒泡阶段。\n- once：只触发一次事件，之后移除该监听器。\n- passive：提升页面滚动性能，告诉浏览器事件处理函数不会调用 event.preventDefault()。\n\n### （1）.stop\n\n``` html\n<div @click.stop=\"handleOuterClick\">\n  <button @click=\"handleInnerClick\">内部按钮</button>\n</div>\n```\n\n当内部按钮被点击时，handleOuterClick 不会被触发，因为事件不会继续向外部元素传播。\n\n### （2）.prevent\n\n``` html\n<form @submit.prevent=\"handleSubmit\">\n  <button type=\"submit\">提交</button>\n</form>\n```\n\nhandleSubmit 方法中的 event.preventDefault() 将会被调用，从而阻止表单的默认提交行为。\n\n### （3）.self\n\n``` html\n<div @click.self=\"handleClick\">只有当点击该div本身时触发</div>\n```\n\n只有当点击该 div 元素本身时，handleClick 方法才会被触发；div 内部其他元素冒泡上来的事件不会触发。\n\n### （4）.once\n\n``` html\n<button @click.once=\"handleClick\">点击我，只触发一次</button>\n```\n\n当按钮被点击后，handleClick 方法只会被触发一次，之后该事件监听器会被移除。\n\n### （5）.capture\n\n``` html\n<div @click.capture=\"handleCaptureClick\">捕获阶段触发</div>\n```\n\n事件监听器将在捕获阶段（从外向内）触发，而不是在冒泡阶段触发。\n\n### （6）.passive\n\n``` html\n<div @touchstart.passive=\"handleTouchStart\">优化页面滚动性能</div>\n```\n\n告诉浏览器 handleTouchStart 方法不会调用 event.preventDefault()，从而有助于提升页面滚动的性能。\n\n## 按键修饰符\n\n```@keyup.enter``` 中的 .enter 就是按键修饰符。\n\n### 常规按键\n\n- enter\n- tab\n- delete (捕获“Delete”和“Backspace”两个按键)\n- esc\n- space\n- up\n- down\n- left\n- right\n\n### 系统按键\n\n系统按键和常规按键不同的是，与 keyup 一起使用时，只有当系统按键被 **按下** 并松开其他键才会触发。\n\n- ctrl\n- alt\n- shift\n- meta\n\n举例：\n\n``` html\n<!-- 常规按键 -->\n<!-- 当 Alt + Enter 抬起时，触发 submit 事件 -->\n<input @keyup.alt.enter=\"submit\" />\n\n<!-- 系统按键 -->\n<!-- 当 按下 ctrl 时触发 -->\n<div @click.ctrl=\"doSth\">A</div>\n<!-- 当 按住 ctrl + 抬起其他键 时触发 -->\n<div @keyup.ctrl=\"doSth\">A</div>\n```\n\n### .exact 修饰符\n\n.exact 用于确定触发事件的确定组合。\n\n举例：\n\n``` html\n<!-- 当抬起 Ctrl 时，即使同时抬起其他系统按键也会触发 -->\n<button @keyup.ctrl=\"doSth\">A</button>\n\n<!-- 仅当抬起 Ctrl 且未抬起任何其他键时才会触发 -->\n<button @keyup.ctrl.exact=\"doSth\">A</button>\n\n<!-- 仅当没有抬起任何系统按键时触发 -->\n<button @keyup.exact=\"doSth\">A</button>\n```\n","source":"_posts/9-vue事件处理.md","raw":"---\ntitle: vue 事件处理\ndate: 2023-11-30 18:50:13\ntags: \n    - vue\ncategories:\n    - vue\n      - 文档\n---\n\nv-on:click=\"\" 缩写为 @click\n\n## 在內联事件处理器中访问事件参数\n\n在內联事件中访问原生 DOM 事件：\n\n### 向处理器中传入一个 $event 变量\n\n``` html\n<button @click=\"warn('message1', $event)\">\nSubmit\n</button>\n```\n\n### 使用内联箭头函数\n\n``` html\n<button @click=\"(event) => warn('message1', event)\">\nSubmit\n</button>\n```\n\n``` js\nfunction warn(message, event) {\n  // 在此处可以访问原生事件\n  if (event) {\n    event.preventDefault()\n  }\n  alert(message)\n}\n```\n\n## 事件修饰符\n\n- stop：调用 event.stopPropagation()，阻止事件继续传播。\n- prevent：调用 event.preventDefault()，阻止事件的默认行为。\n- self：只当事件是从原始目标元素本身触发时触发回调，如果事件是从内部元素冒泡上来的则不触发。\n- capture：添加事件监听器时使用 capture 模式，即在捕获阶段触发而不是冒泡阶段。\n- once：只触发一次事件，之后移除该监听器。\n- passive：提升页面滚动性能，告诉浏览器事件处理函数不会调用 event.preventDefault()。\n\n### （1）.stop\n\n``` html\n<div @click.stop=\"handleOuterClick\">\n  <button @click=\"handleInnerClick\">内部按钮</button>\n</div>\n```\n\n当内部按钮被点击时，handleOuterClick 不会被触发，因为事件不会继续向外部元素传播。\n\n### （2）.prevent\n\n``` html\n<form @submit.prevent=\"handleSubmit\">\n  <button type=\"submit\">提交</button>\n</form>\n```\n\nhandleSubmit 方法中的 event.preventDefault() 将会被调用，从而阻止表单的默认提交行为。\n\n### （3）.self\n\n``` html\n<div @click.self=\"handleClick\">只有当点击该div本身时触发</div>\n```\n\n只有当点击该 div 元素本身时，handleClick 方法才会被触发；div 内部其他元素冒泡上来的事件不会触发。\n\n### （4）.once\n\n``` html\n<button @click.once=\"handleClick\">点击我，只触发一次</button>\n```\n\n当按钮被点击后，handleClick 方法只会被触发一次，之后该事件监听器会被移除。\n\n### （5）.capture\n\n``` html\n<div @click.capture=\"handleCaptureClick\">捕获阶段触发</div>\n```\n\n事件监听器将在捕获阶段（从外向内）触发，而不是在冒泡阶段触发。\n\n### （6）.passive\n\n``` html\n<div @touchstart.passive=\"handleTouchStart\">优化页面滚动性能</div>\n```\n\n告诉浏览器 handleTouchStart 方法不会调用 event.preventDefault()，从而有助于提升页面滚动的性能。\n\n## 按键修饰符\n\n```@keyup.enter``` 中的 .enter 就是按键修饰符。\n\n### 常规按键\n\n- enter\n- tab\n- delete (捕获“Delete”和“Backspace”两个按键)\n- esc\n- space\n- up\n- down\n- left\n- right\n\n### 系统按键\n\n系统按键和常规按键不同的是，与 keyup 一起使用时，只有当系统按键被 **按下** 并松开其他键才会触发。\n\n- ctrl\n- alt\n- shift\n- meta\n\n举例：\n\n``` html\n<!-- 常规按键 -->\n<!-- 当 Alt + Enter 抬起时，触发 submit 事件 -->\n<input @keyup.alt.enter=\"submit\" />\n\n<!-- 系统按键 -->\n<!-- 当 按下 ctrl 时触发 -->\n<div @click.ctrl=\"doSth\">A</div>\n<!-- 当 按住 ctrl + 抬起其他键 时触发 -->\n<div @keyup.ctrl=\"doSth\">A</div>\n```\n\n### .exact 修饰符\n\n.exact 用于确定触发事件的确定组合。\n\n举例：\n\n``` html\n<!-- 当抬起 Ctrl 时，即使同时抬起其他系统按键也会触发 -->\n<button @keyup.ctrl=\"doSth\">A</button>\n\n<!-- 仅当抬起 Ctrl 且未抬起任何其他键时才会触发 -->\n<button @keyup.ctrl.exact=\"doSth\">A</button>\n\n<!-- 仅当没有抬起任何系统按键时触发 -->\n<button @keyup.exact=\"doSth\">A</button>\n```\n","slug":"9-vue事件处理","published":1,"updated":"2025-05-20T02:47:28.686Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb0ffvul00ar6kprear795zh","content":"<p>v-on:click&#x3D;”” 缩写为 @click</p>\n<h2 id=\"在內联事件处理器中访问事件参数\"><a href=\"#在內联事件处理器中访问事件参数\" class=\"headerlink\" title=\"在內联事件处理器中访问事件参数\"></a>在內联事件处理器中访问事件参数</h2><p>在內联事件中访问原生 DOM 事件：</p>\n<h3 id=\"向处理器中传入一个-event-变量\"><a href=\"#向处理器中传入一个-event-变量\" class=\"headerlink\" title=\"向处理器中传入一个 $event 变量\"></a>向处理器中传入一个 $event 变量</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;warn(&#x27;message1&#x27;, $event)&quot;</span>&gt;</span></span><br><span class=\"line\">Submit</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"使用内联箭头函数\"><a href=\"#使用内联箭头函数\" class=\"headerlink\" title=\"使用内联箭头函数\"></a>使用内联箭头函数</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;(event) =&gt; warn(&#x27;message1&#x27;, event)&quot;</span>&gt;</span></span><br><span class=\"line\">Submit</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">warn</span>(<span class=\"params\">message, event</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 在此处可以访问原生事件</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (event) &#123;</span><br><span class=\"line\">    event.<span class=\"title function_\">preventDefault</span>()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_\">alert</span>(message)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"事件修饰符\"><a href=\"#事件修饰符\" class=\"headerlink\" title=\"事件修饰符\"></a>事件修饰符</h2><ul>\n<li>stop：调用 event.stopPropagation()，阻止事件继续传播。</li>\n<li>prevent：调用 event.preventDefault()，阻止事件的默认行为。</li>\n<li>self：只当事件是从原始目标元素本身触发时触发回调，如果事件是从内部元素冒泡上来的则不触发。</li>\n<li>capture：添加事件监听器时使用 capture 模式，即在捕获阶段触发而不是冒泡阶段。</li>\n<li>once：只触发一次事件，之后移除该监听器。</li>\n<li>passive：提升页面滚动性能，告诉浏览器事件处理函数不会调用 event.preventDefault()。</li>\n</ul>\n<h3 id=\"（1）-stop\"><a href=\"#（1）-stop\" class=\"headerlink\" title=\"（1）.stop\"></a>（1）.stop</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> @<span class=\"attr\">click.stop</span>=<span class=\"string\">&quot;handleOuterClick&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;handleInnerClick&quot;</span>&gt;</span>内部按钮<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>当内部按钮被点击时，handleOuterClick 不会被触发，因为事件不会继续向外部元素传播。</p>\n<h3 id=\"（2）-prevent\"><a href=\"#（2）-prevent\" class=\"headerlink\" title=\"（2）.prevent\"></a>（2）.prevent</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> @<span class=\"attr\">submit.prevent</span>=<span class=\"string\">&quot;handleSubmit&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span>&gt;</span>提交<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>handleSubmit 方法中的 event.preventDefault() 将会被调用，从而阻止表单的默认提交行为。</p>\n<h3 id=\"（3）-self\"><a href=\"#（3）-self\" class=\"headerlink\" title=\"（3）.self\"></a>（3）.self</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> @<span class=\"attr\">click.self</span>=<span class=\"string\">&quot;handleClick&quot;</span>&gt;</span>只有当点击该div本身时触发<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>只有当点击该 div 元素本身时，handleClick 方法才会被触发；div 内部其他元素冒泡上来的事件不会触发。</p>\n<h3 id=\"（4）-once\"><a href=\"#（4）-once\" class=\"headerlink\" title=\"（4）.once\"></a>（4）.once</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click.once</span>=<span class=\"string\">&quot;handleClick&quot;</span>&gt;</span>点击我，只触发一次<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>当按钮被点击后，handleClick 方法只会被触发一次，之后该事件监听器会被移除。</p>\n<h3 id=\"（5）-capture\"><a href=\"#（5）-capture\" class=\"headerlink\" title=\"（5）.capture\"></a>（5）.capture</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> @<span class=\"attr\">click.capture</span>=<span class=\"string\">&quot;handleCaptureClick&quot;</span>&gt;</span>捕获阶段触发<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>事件监听器将在捕获阶段（从外向内）触发，而不是在冒泡阶段触发。</p>\n<h3 id=\"（6）-passive\"><a href=\"#（6）-passive\" class=\"headerlink\" title=\"（6）.passive\"></a>（6）.passive</h3><div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> @<span class=\"attr\">touchstart.passive</span>=<span class=\"string\">&quot;handleTouchStart&quot;</span>&gt;</span>优化页面滚动性能<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>告诉浏览器 handleTouchStart 方法不会调用 event.preventDefault()，从而有助于提升页面滚动的性能。</p>\n<h2 id=\"按键修饰符\"><a href=\"#按键修饰符\" class=\"headerlink\" title=\"按键修饰符\"></a>按键修饰符</h2><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><figcaption><span>中的 .enter 就是按键修饰符。</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">### 常规按键</span><br><span class=\"line\"></span><br><span class=\"line\">- enter</span><br><span class=\"line\">- tab</span><br><span class=\"line\">- delete (捕获“Delete”和“Backspace”两个按键)</span><br><span class=\"line\">- esc</span><br><span class=\"line\">- space</span><br><span class=\"line\">- up</span><br><span class=\"line\">- down</span><br><span class=\"line\">- left</span><br><span class=\"line\">- right</span><br><span class=\"line\"></span><br><span class=\"line\">### 系统按键</span><br><span class=\"line\"></span><br><span class=\"line\">系统按键和常规按键不同的是，与 keyup 一起使用时，只有当系统按键被 **按下** 并松开其他键才会触发。</span><br><span class=\"line\"></span><br><span class=\"line\">- ctrl</span><br><span class=\"line\">- alt</span><br><span class=\"line\">- shift</span><br><span class=\"line\">- meta</span><br><span class=\"line\"></span><br><span class=\"line\">举例：</span><br><span class=\"line\"></span><br><span class=\"line\">``` html</span><br><span class=\"line\">&lt;!-- 常规按键 --&gt;</span><br><span class=\"line\">&lt;!-- 当 Alt + Enter 抬起时，触发 submit 事件 --&gt;</span><br><span class=\"line\">&lt;input @keyup.alt.enter=&quot;submit&quot; /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- 系统按键 --&gt;</span><br><span class=\"line\">&lt;!-- 当 按下 ctrl 时触发 --&gt;</span><br><span class=\"line\">&lt;div @click.ctrl=&quot;doSth&quot;&gt;A&lt;/div&gt;</span><br><span class=\"line\">&lt;!-- 当 按住 ctrl + 抬起其他键 时触发 --&gt;</span><br><span class=\"line\">&lt;div @keyup.ctrl=&quot;doSth&quot;&gt;A&lt;/div&gt;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"exact-修饰符\"><a href=\"#exact-修饰符\" class=\"headerlink\" title=\".exact 修饰符\"></a>.exact 修饰符</h3><p>.exact 用于确定触发事件的确定组合。</p>\n<p>举例：</p>\n<div class=\"code-container\" data-rel=\"Html\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 当抬起 Ctrl 时，即使同时抬起其他系统按键也会触发 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">keyup.ctrl</span>=<span class=\"string\">&quot;doSth&quot;</span>&gt;</span>A<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 仅当抬起 Ctrl 且未抬起任何其他键时才会触发 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">keyup.ctrl.exact</span>=<span class=\"string\">&quot;doSth&quot;</span>&gt;</span>A<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 仅当没有抬起任何系统按键时触发 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">keyup.exact</span>=<span class=\"string\">&quot;doSth&quot;</span>&gt;</span>A<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<p>v-on:click&#x3D;”” 缩写为 @click</p>\n<h2 id=\"在內联事件处理器中访问事件参数\"><a href=\"#在內联事件处理器中访问事件参数\" class=\"headerlink\" title=\"在內联事件处理器中访问事件参数\"></a>在內联事件处理器中访问事件参数</h2><p>在內联事件中访问原生 DOM 事件：</p>\n<h3 id=\"向处理器中传入一个-event-变量\"><a href=\"#向处理器中传入一个-event-变量\" class=\"headerlink\" title=\"向处理器中传入一个 $event 变量\"></a>向处理器中传入一个 $event 变量</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;warn(&#x27;message1&#x27;, $event)&quot;</span>&gt;</span></span><br><span class=\"line\">Submit</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用内联箭头函数\"><a href=\"#使用内联箭头函数\" class=\"headerlink\" title=\"使用内联箭头函数\"></a>使用内联箭头函数</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;(event) =&gt; warn(&#x27;message1&#x27;, event)&quot;</span>&gt;</span></span><br><span class=\"line\">Submit</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">warn</span>(<span class=\"params\">message, event</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 在此处可以访问原生事件</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (event) &#123;</span><br><span class=\"line\">    event.<span class=\"title function_\">preventDefault</span>()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_\">alert</span>(message)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"事件修饰符\"><a href=\"#事件修饰符\" class=\"headerlink\" title=\"事件修饰符\"></a>事件修饰符</h2><ul>\n<li>stop：调用 event.stopPropagation()，阻止事件继续传播。</li>\n<li>prevent：调用 event.preventDefault()，阻止事件的默认行为。</li>\n<li>self：只当事件是从原始目标元素本身触发时触发回调，如果事件是从内部元素冒泡上来的则不触发。</li>\n<li>capture：添加事件监听器时使用 capture 模式，即在捕获阶段触发而不是冒泡阶段。</li>\n<li>once：只触发一次事件，之后移除该监听器。</li>\n<li>passive：提升页面滚动性能，告诉浏览器事件处理函数不会调用 event.preventDefault()。</li>\n</ul>\n<h3 id=\"（1）-stop\"><a href=\"#（1）-stop\" class=\"headerlink\" title=\"（1）.stop\"></a>（1）.stop</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> @<span class=\"attr\">click.stop</span>=<span class=\"string\">&quot;handleOuterClick&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;handleInnerClick&quot;</span>&gt;</span>内部按钮<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>当内部按钮被点击时，handleOuterClick 不会被触发，因为事件不会继续向外部元素传播。</p>\n<h3 id=\"（2）-prevent\"><a href=\"#（2）-prevent\" class=\"headerlink\" title=\"（2）.prevent\"></a>（2）.prevent</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> @<span class=\"attr\">submit.prevent</span>=<span class=\"string\">&quot;handleSubmit&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span>&gt;</span>提交<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>handleSubmit 方法中的 event.preventDefault() 将会被调用，从而阻止表单的默认提交行为。</p>\n<h3 id=\"（3）-self\"><a href=\"#（3）-self\" class=\"headerlink\" title=\"（3）.self\"></a>（3）.self</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> @<span class=\"attr\">click.self</span>=<span class=\"string\">&quot;handleClick&quot;</span>&gt;</span>只有当点击该div本身时触发<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>只有当点击该 div 元素本身时，handleClick 方法才会被触发；div 内部其他元素冒泡上来的事件不会触发。</p>\n<h3 id=\"（4）-once\"><a href=\"#（4）-once\" class=\"headerlink\" title=\"（4）.once\"></a>（4）.once</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click.once</span>=<span class=\"string\">&quot;handleClick&quot;</span>&gt;</span>点击我，只触发一次<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>当按钮被点击后，handleClick 方法只会被触发一次，之后该事件监听器会被移除。</p>\n<h3 id=\"（5）-capture\"><a href=\"#（5）-capture\" class=\"headerlink\" title=\"（5）.capture\"></a>（5）.capture</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> @<span class=\"attr\">click.capture</span>=<span class=\"string\">&quot;handleCaptureClick&quot;</span>&gt;</span>捕获阶段触发<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>事件监听器将在捕获阶段（从外向内）触发，而不是在冒泡阶段触发。</p>\n<h3 id=\"（6）-passive\"><a href=\"#（6）-passive\" class=\"headerlink\" title=\"（6）.passive\"></a>（6）.passive</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> @<span class=\"attr\">touchstart.passive</span>=<span class=\"string\">&quot;handleTouchStart&quot;</span>&gt;</span>优化页面滚动性能<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>告诉浏览器 handleTouchStart 方法不会调用 event.preventDefault()，从而有助于提升页面滚动的性能。</p>\n<h2 id=\"按键修饰符\"><a href=\"#按键修饰符\" class=\"headerlink\" title=\"按键修饰符\"></a>按键修饰符</h2><figure class=\"highlight plaintext\"><figcaption><span>中的 .enter 就是按键修饰符。</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">### 常规按键</span><br><span class=\"line\"></span><br><span class=\"line\">- enter</span><br><span class=\"line\">- tab</span><br><span class=\"line\">- delete (捕获“Delete”和“Backspace”两个按键)</span><br><span class=\"line\">- esc</span><br><span class=\"line\">- space</span><br><span class=\"line\">- up</span><br><span class=\"line\">- down</span><br><span class=\"line\">- left</span><br><span class=\"line\">- right</span><br><span class=\"line\"></span><br><span class=\"line\">### 系统按键</span><br><span class=\"line\"></span><br><span class=\"line\">系统按键和常规按键不同的是，与 keyup 一起使用时，只有当系统按键被 **按下** 并松开其他键才会触发。</span><br><span class=\"line\"></span><br><span class=\"line\">- ctrl</span><br><span class=\"line\">- alt</span><br><span class=\"line\">- shift</span><br><span class=\"line\">- meta</span><br><span class=\"line\"></span><br><span class=\"line\">举例：</span><br><span class=\"line\"></span><br><span class=\"line\">``` html</span><br><span class=\"line\">&lt;!-- 常规按键 --&gt;</span><br><span class=\"line\">&lt;!-- 当 Alt + Enter 抬起时，触发 submit 事件 --&gt;</span><br><span class=\"line\">&lt;input @keyup.alt.enter=&quot;submit&quot; /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- 系统按键 --&gt;</span><br><span class=\"line\">&lt;!-- 当 按下 ctrl 时触发 --&gt;</span><br><span class=\"line\">&lt;div @click.ctrl=&quot;doSth&quot;&gt;A&lt;/div&gt;</span><br><span class=\"line\">&lt;!-- 当 按住 ctrl + 抬起其他键 时触发 --&gt;</span><br><span class=\"line\">&lt;div @keyup.ctrl=&quot;doSth&quot;&gt;A&lt;/div&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"exact-修饰符\"><a href=\"#exact-修饰符\" class=\"headerlink\" title=\".exact 修饰符\"></a>.exact 修饰符</h3><p>.exact 用于确定触发事件的确定组合。</p>\n<p>举例：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 当抬起 Ctrl 时，即使同时抬起其他系统按键也会触发 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">keyup.ctrl</span>=<span class=\"string\">&quot;doSth&quot;</span>&gt;</span>A<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 仅当抬起 Ctrl 且未抬起任何其他键时才会触发 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">keyup.ctrl.exact</span>=<span class=\"string\">&quot;doSth&quot;</span>&gt;</span>A<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 仅当没有抬起任何系统按键时触发 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">keyup.exact</span>=<span class=\"string\">&quot;doSth&quot;</span>&gt;</span>A<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"IB-Rust-字符串","date":"2025-05-23T06:37:53.000Z","_content":"\n[Codes in lesson9](https://github.com/Zoella-w/IB-Rust/tree/main/9_string)\n\n## 字符串的定义\n\n字符串是由字符组成的连续集合\n\nRust 中的字符是 Unicode 类型，因此每个字符占据 4 字节内存空间，但字符串是 UTF-8 编码，也就是字符串中的字符所占的字节数是变化的（1～4）\n\n比如，对于“hello 中国”来说，utf8 编码为：\n\n```shell\nh    e   l   l   o   _   中           国\n[104 101 108 108 111 32  228,184,173  229,155,189]\n```\n\n### str\n\nstr 是 Rust 的一个基础类型，本质是一个字节数组`[u8]`\n\n`str` 或 `[u8]` 类型的值存放在内存：可能是堆，可能是栈，还可能硬编码进可执行程序\n\n#### 字符串字面量\n\n字符串字面量是 `str` 类型，在编译时就知道其内容，其字面值文本被直接硬编码进可执行程序\n\n在存储了该字符串之后，需要通过切片引用 `&str` 来访问它\n\n- `&str`是一种不可变引用，所以它没有所有权\n- `str` 类型是硬编码进可执行文件，无法被修改\n\n``` rust\nlet s: &str = \"hello world\";\n```\n\n### String\n\nString 字符串是在程序运行得过程中动态生成的，其在 rust 中是一个复合数据类型，定义如下：\n\n```rust\npub struct String {\n    vec: Vec<u8>,}\n```\n\n这说明 `String` 是可改变的，并且拥有所有权\n\n### 其他\n\n除了 `String` 类型的字符串，Rust 的标准库还提供了其他类型的字符串，例如 `OsString`， `OsStr`， `CsString` 和` CsStr` 等\n\n#### &str vs String\n\n`&str`: 这是一个字符串切片，它是固定大小的，并且不能改变。\n\n`String`: 这是一个可增长的、可改变的、拥有所有权的、UTF-8 编码的字符串类型。它通常用于需要改变或者增长字符串的情况。\n\n## 类型转换\n\n### &str 的转换\n\n#### 字节数组 `[u8]`|`Vec<u8>`->`&str`\n\n```rust\nuse std::str;\nfn main() {\n    let b = [104, 101, 108, 108, 111, 32, 228, 184, 173, 229, 155, 189];\n    // 实现了从 Vec<u8> 到 [u8] 的隐式类型转换\n  \t// let b = vec!(104, 101, 108, 108, 111, 32, 228, 184, 173, 229, 155, 189);\n    let s = str::from_utf8(&b).unwrap();\n}\n```\n\n#### 字符串字面量->`[u8]`\n\n```rust\nlet s = \"hello 中国\";\nlet b = s.as_bytes();\ndbg!(\"{}\", b);\n```\n\n#### `String`->`&str`\n\nString 转变为 &str 是无损的（性能无损，不会造成重写 malloc 或者数据移动）\n\n`&String` 可以自动转换为 `&str`，因此在函数中，如果接收参数是 `&String`，通常会采用 `&str` 作为入参，提升数据兼容性\n\n字符串是 UTF-8 编码，因此需要保证索引的字节刚好落在字符的边界，因为有些字符的长度超过 1 个字节\n\n``` rust\nlet s = String::from(\"hello, world\");\n// 方法一、使用 &String 直接转换\nsome_func(&s);\n// 方法二、使用 .as_str() 转换\nsome_func(s.as_str());\n```\n\n### String的转换\n\n#### 字节数组 `Vec<u8>`->`String`\n\n```rust\nfn main() {\n    let b = vec!(104, 101, 108, 108, 111, 32, 228, 184, 173, 229, 155, 189);\n\n    let s = String::from_utf8(b).unwrap();\n\n    println!(\"{}\", s);\n}\n```\n\n#### `&str`->`String`\n\n从 &str 获得 String 是低效的，因为要重新 malloc 数据\n\n```rust\nlet s = String::from(\"hello 世界\");\n```\n\n### Overview\n\n```none\n&str    -> String  | String::from(s) or s.to_string() or s.to_owned()\n&str    -> &[u8]   | s.as_bytes()\n&str    -> Vec<u8> | s.as_bytes().to_vec() or s.as_bytes().to_owned()\nString  -> &str    | &s if possible* else s.as_str()\nString  -> &[u8]   | s.as_bytes()\nString  -> Vec<u8> | s.into_bytes()\n&[u8]   -> &str    | s.to_vec() or s.to_owned()\n&[u8]   -> String  | std::str::from_utf8(s).unwrap(), but unsafe\n&[u8]   -> Vec<u8> | String::from_utf8(s).unwrap(), but unsafe\nVec<u8> -> &str    | &s if possible* else s.as_slice()\nVec<u8> -> String  | std::str::from_utf8(&s).unwrap(), but unsafe\nVec<u8> -> &[u8]   | String::from_utf8(s).unwrap(), but unsafe\n```\n\n## 操作字符串\n\n可变字符串 `String` 的修改，添加，删除等常用方法，且如果执行这些操作会修改原字符串，则字符串必须是 mut 的\n\n### 追加 (Push)\n\n- 使用 `push()` 方法追加字符 `char`\n- 使用 `push_str()` 方法追加字符串字面量\n- 两个方法都是**在原有的字符串上追加**，需要用 `mut` 修饰\n\n```rust\nlet mut s = String::from(\"Hello \");\ns.push_str(\"rust\");\ns.push('!');\n```\n\n### 插入 (Insert)\n\n- 使用 `insert()` 方法插入单个字符 `char`\n- 使用 `insert_str()` 方法插入字符串字面量\n- 这俩方法需要传入两个参数，第一个参数是字符（串）插入位置的索引，索引从 0 开始计数；第二个参数是要插入的字符（串），注意不要越界\n- 两个方法都是**在原有的字符串上追加**，需要用 `mut` 修饰\n\n```rust\n    let mut s = String::from(\"Hello rust!中文\");\n    s.insert(5, ',');\n    s.insert_str(6, \" I like\");\n```\n\n### 替换 (Replace)\n\n#### `replace`\n\n- `replace()` 方法接收两个参数，第一个参数是要被替换的字符串，第二个参数是新的字符串\n- 该方法会替换所有匹配到的字符串\n- 该方法返回一个新的字符串，而不是操作原来的字符串，所以不需要 mut 修饰\n\n```rust\nlet s = String::from(\"I like rust. Learning rust is my favorite!\");\nlet new_string_replace = s.replace(\"rust\", \"RUST\");\n```\n\n#### `replacen`\n\n方法接收三个参数，前两个参数与 `replace()` 方法一样，第三个参数则表示替换的个数\n\n```rust\nlet s = \"I like rust. Learning rust is my favorite!\";\nlet new_string_replacen = s.replacen(\"rust\", \"RUST\", 1);\n```\n\n#### `replace_range`\n\n- `replace_range` 接收两个参数，第一个参数是要替换字符串的范围（Range），第二个参数是新的字符串\n- 该方法是直接操作原来的字符串，需要使用 `mut` 修饰\n- 如果range的范围大于/小于新字符串长度会怎样？\n- 参数的位置需要在合法的字符边界\n\n```rust\n  let mut s = String::from(\"hello rust 中国\");\n  s.replace_range(7..8, \"R\");\n```\n\n### 删除 (Delete)\n\n####  `pop` \n\n- 删除并返回字符串的最后一个字符\n- 其返回值是一个 `Option` 类型，如果字符串为空，则返回 `None`\n- 该方法直接操作原来的字符串，需要用 `mut` 修饰\n\n```rust\nlet mut s = String::from(\"中文!\");\nlet p1 = s.pop(); // 中\nlet p2 = s.pop(); // 文\nlet p3 = s.pop(); // ！\nlet p4 = s.pop(); // `None`\n```\n\n####  `remove` \n\n- 其返回值是删除位置的字符串\n- 接收一个参数，表示该字符起始索引位置\n- 参数的位置需要在合法的字符边界\n- 该方法直接操作原来的字符串，需要用 `mut` 修饰\n\n```rust\nfn main() {\n    let mut s = String::from(\"测试remove方法\");\n    println!(\n        \"string_remove 占 {} 个字节\",\n        std::mem::size_of_val(s.as_str())\n    );\n    // 删除第一个汉字\n    s.remove(0);\n    // 下面代码会发生错误\n    // s_remove.remove(1);\n    // 直接删除第二个汉字\n    // s_remove.remove(3);\n    dbg!(s);\n}\n```\n\n####  `truncate` \n\n- 删除字符串中从指定位置开始到结尾的全部字符\n- 参数的位置需要在合法的字符边界\n- 该方法是直接操作原来的字符串，需要用 `mut` 修饰\n\n```rust\nlet mut s = String::from(\"测试truncate\");\ns.truncate(3);\n```\n\n####  `clear` \n\n- 清空字符串\n- 该方法直接操作原来的字符串，需要用 `mut` 修饰\n\n```rust\nlet mut s = String::from(\"string clear\");\ns.clear();\n```\n\n### 连接 (Concatenate)\n\n#### 使用 Add()\n\n`add()` 方法的第二个参数必须为字符串切片引用（Slice）类型\n\n```rust\nuse std::ops::Add;\nfn main() {\n    let s = String::from(\"hello \");\n    let string_rust = String::from(\"rust\");\n    let result = s.add(&string_rust);\n}\n```\n\n#### 使用 + 或者 += 连接字符串\n\n之所以可以直接 + 是因为 Add 实现了 + 的 trait\n\n```rust\nlet s = String::from(\"hello \");\nlet string_rust = String::from(\"rust\");\nlet result = s + &string_rust; // &string_rust 会解引用为 &str\nlet mut result = result + \"!\";\nresult += \"!!!\";\n```\n\n##### 关于自动解引用\n\n`std::String` -> `&str` 没有任何成本，反过来则需要重新申请空间\n\n所以在定义使用字符串的函数的时候，优先定义成字符串切片的类型\n\n##### 关于所有权移动\n\n- 无论是 + 还是 add 都发生了所有权移动\n\n```rust\n    let s = String::from(\"hello \");\n    let string_rust = String::from(\"rust\");\n    let result = s + &string_rust; // &string_rust 会解引用转为 &str\n    // println!(\"{}\", s); // 报错\n    let mut result = result + \"!\";\n    result += \"!!!\";\n    println!(\"连接字符串 + -> {}\", result);\n```\n\n#### 使用 `format!` 连接字符串\n\n- `format!` 的用法与 `println!` 的用法类似\n\n```rust\nlet s1 = \"hello\";\nlet s2 = String::from(\"rust\");\nlet s = format!(\"{} {}!\", s1, s2);\nprintln!(\"{}\", s);\n```\n\n### Rust 手册 String 相关的函数\n\nhttps://doc.rust-lang.org/std/string/struct.String.html#\n\n## 字符串转义\n\n可以通过转义的方式 `\\` 输出 ASCII 和 Unicode 字符。\n\n```rust\n// 通过 \\ + 字符的十六进制表示，转义输出一个字符\nlet byte_escape = \"I'm writing \\x52\\x75\\x73\\x74!\";\nprintln!(\"What are you doing\\x3F (\\\\x3F means ?) {}\", byte_escape); // What are you doing? (\\x3F means ?) I'm writing Rust!\n\n// \\u 可以输出一个 unicode 字符\nlet unicode_codepoint = \"\\u{211D}\";\nlet character_name = \"\\\"DOUBLE-STRUCK CAPITAL R\\\"\";\nprintln!(\n    \"Unicode character {} (U+211D) is called {}\",\n    unicode_codepoint, character_name\n); // Unicode character ℝ (U+211D) is called \"DOUBLE-STRUCK CAPITAL R\"\n\n// 换行了也会保持之前的字符串格式\n// 使用\\忽略换行符\nlet long_string = \"String literals\n                    can span multiple lines.\n                    The linebreak and indentation here ->\\\n                    <- can be escaped too!\";\nprintln!(\"{}\", long_string); // The linebreak and indentation here -><- can be escaped too!\n```\n\n### 原样输出\n\n```rust\nprintln!(\"{}\", \"hello \\\\x52\\\\x75\\\\x73\\\\x74\");\nlet raw_str = r\"Escapes don't work here: \\x3F \\u{211D}\";\nprintln!(\"{}\", raw_str);\n// 如果字符串包含双引号，可以在开头和结尾加 #\nlet quotes = r#\"And then I said: \"There is no escape!\"\"#;\nprintln!(\"{}\", quotes);\n// 如果还是有歧义，可以继续增加，没有限制\nlet longer_delimiter = r###\"A string with \"# in it. And even \"##!\"###;\nprintln!(\"{}\", longer_delimiter);\n```\n","source":"_posts/67-IB-Rust-字符串.md","raw":"---\ntitle: IB-Rust-字符串\ndate: 2025-05-23 14:37:53\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson9](https://github.com/Zoella-w/IB-Rust/tree/main/9_string)\n\n## 字符串的定义\n\n字符串是由字符组成的连续集合\n\nRust 中的字符是 Unicode 类型，因此每个字符占据 4 字节内存空间，但字符串是 UTF-8 编码，也就是字符串中的字符所占的字节数是变化的（1～4）\n\n比如，对于“hello 中国”来说，utf8 编码为：\n\n```shell\nh    e   l   l   o   _   中           国\n[104 101 108 108 111 32  228,184,173  229,155,189]\n```\n\n### str\n\nstr 是 Rust 的一个基础类型，本质是一个字节数组`[u8]`\n\n`str` 或 `[u8]` 类型的值存放在内存：可能是堆，可能是栈，还可能硬编码进可执行程序\n\n#### 字符串字面量\n\n字符串字面量是 `str` 类型，在编译时就知道其内容，其字面值文本被直接硬编码进可执行程序\n\n在存储了该字符串之后，需要通过切片引用 `&str` 来访问它\n\n- `&str`是一种不可变引用，所以它没有所有权\n- `str` 类型是硬编码进可执行文件，无法被修改\n\n``` rust\nlet s: &str = \"hello world\";\n```\n\n### String\n\nString 字符串是在程序运行得过程中动态生成的，其在 rust 中是一个复合数据类型，定义如下：\n\n```rust\npub struct String {\n    vec: Vec<u8>,}\n```\n\n这说明 `String` 是可改变的，并且拥有所有权\n\n### 其他\n\n除了 `String` 类型的字符串，Rust 的标准库还提供了其他类型的字符串，例如 `OsString`， `OsStr`， `CsString` 和` CsStr` 等\n\n#### &str vs String\n\n`&str`: 这是一个字符串切片，它是固定大小的，并且不能改变。\n\n`String`: 这是一个可增长的、可改变的、拥有所有权的、UTF-8 编码的字符串类型。它通常用于需要改变或者增长字符串的情况。\n\n## 类型转换\n\n### &str 的转换\n\n#### 字节数组 `[u8]`|`Vec<u8>`->`&str`\n\n```rust\nuse std::str;\nfn main() {\n    let b = [104, 101, 108, 108, 111, 32, 228, 184, 173, 229, 155, 189];\n    // 实现了从 Vec<u8> 到 [u8] 的隐式类型转换\n  \t// let b = vec!(104, 101, 108, 108, 111, 32, 228, 184, 173, 229, 155, 189);\n    let s = str::from_utf8(&b).unwrap();\n}\n```\n\n#### 字符串字面量->`[u8]`\n\n```rust\nlet s = \"hello 中国\";\nlet b = s.as_bytes();\ndbg!(\"{}\", b);\n```\n\n#### `String`->`&str`\n\nString 转变为 &str 是无损的（性能无损，不会造成重写 malloc 或者数据移动）\n\n`&String` 可以自动转换为 `&str`，因此在函数中，如果接收参数是 `&String`，通常会采用 `&str` 作为入参，提升数据兼容性\n\n字符串是 UTF-8 编码，因此需要保证索引的字节刚好落在字符的边界，因为有些字符的长度超过 1 个字节\n\n``` rust\nlet s = String::from(\"hello, world\");\n// 方法一、使用 &String 直接转换\nsome_func(&s);\n// 方法二、使用 .as_str() 转换\nsome_func(s.as_str());\n```\n\n### String的转换\n\n#### 字节数组 `Vec<u8>`->`String`\n\n```rust\nfn main() {\n    let b = vec!(104, 101, 108, 108, 111, 32, 228, 184, 173, 229, 155, 189);\n\n    let s = String::from_utf8(b).unwrap();\n\n    println!(\"{}\", s);\n}\n```\n\n#### `&str`->`String`\n\n从 &str 获得 String 是低效的，因为要重新 malloc 数据\n\n```rust\nlet s = String::from(\"hello 世界\");\n```\n\n### Overview\n\n```none\n&str    -> String  | String::from(s) or s.to_string() or s.to_owned()\n&str    -> &[u8]   | s.as_bytes()\n&str    -> Vec<u8> | s.as_bytes().to_vec() or s.as_bytes().to_owned()\nString  -> &str    | &s if possible* else s.as_str()\nString  -> &[u8]   | s.as_bytes()\nString  -> Vec<u8> | s.into_bytes()\n&[u8]   -> &str    | s.to_vec() or s.to_owned()\n&[u8]   -> String  | std::str::from_utf8(s).unwrap(), but unsafe\n&[u8]   -> Vec<u8> | String::from_utf8(s).unwrap(), but unsafe\nVec<u8> -> &str    | &s if possible* else s.as_slice()\nVec<u8> -> String  | std::str::from_utf8(&s).unwrap(), but unsafe\nVec<u8> -> &[u8]   | String::from_utf8(s).unwrap(), but unsafe\n```\n\n## 操作字符串\n\n可变字符串 `String` 的修改，添加，删除等常用方法，且如果执行这些操作会修改原字符串，则字符串必须是 mut 的\n\n### 追加 (Push)\n\n- 使用 `push()` 方法追加字符 `char`\n- 使用 `push_str()` 方法追加字符串字面量\n- 两个方法都是**在原有的字符串上追加**，需要用 `mut` 修饰\n\n```rust\nlet mut s = String::from(\"Hello \");\ns.push_str(\"rust\");\ns.push('!');\n```\n\n### 插入 (Insert)\n\n- 使用 `insert()` 方法插入单个字符 `char`\n- 使用 `insert_str()` 方法插入字符串字面量\n- 这俩方法需要传入两个参数，第一个参数是字符（串）插入位置的索引，索引从 0 开始计数；第二个参数是要插入的字符（串），注意不要越界\n- 两个方法都是**在原有的字符串上追加**，需要用 `mut` 修饰\n\n```rust\n    let mut s = String::from(\"Hello rust!中文\");\n    s.insert(5, ',');\n    s.insert_str(6, \" I like\");\n```\n\n### 替换 (Replace)\n\n#### `replace`\n\n- `replace()` 方法接收两个参数，第一个参数是要被替换的字符串，第二个参数是新的字符串\n- 该方法会替换所有匹配到的字符串\n- 该方法返回一个新的字符串，而不是操作原来的字符串，所以不需要 mut 修饰\n\n```rust\nlet s = String::from(\"I like rust. Learning rust is my favorite!\");\nlet new_string_replace = s.replace(\"rust\", \"RUST\");\n```\n\n#### `replacen`\n\n方法接收三个参数，前两个参数与 `replace()` 方法一样，第三个参数则表示替换的个数\n\n```rust\nlet s = \"I like rust. Learning rust is my favorite!\";\nlet new_string_replacen = s.replacen(\"rust\", \"RUST\", 1);\n```\n\n#### `replace_range`\n\n- `replace_range` 接收两个参数，第一个参数是要替换字符串的范围（Range），第二个参数是新的字符串\n- 该方法是直接操作原来的字符串，需要使用 `mut` 修饰\n- 如果range的范围大于/小于新字符串长度会怎样？\n- 参数的位置需要在合法的字符边界\n\n```rust\n  let mut s = String::from(\"hello rust 中国\");\n  s.replace_range(7..8, \"R\");\n```\n\n### 删除 (Delete)\n\n####  `pop` \n\n- 删除并返回字符串的最后一个字符\n- 其返回值是一个 `Option` 类型，如果字符串为空，则返回 `None`\n- 该方法直接操作原来的字符串，需要用 `mut` 修饰\n\n```rust\nlet mut s = String::from(\"中文!\");\nlet p1 = s.pop(); // 中\nlet p2 = s.pop(); // 文\nlet p3 = s.pop(); // ！\nlet p4 = s.pop(); // `None`\n```\n\n####  `remove` \n\n- 其返回值是删除位置的字符串\n- 接收一个参数，表示该字符起始索引位置\n- 参数的位置需要在合法的字符边界\n- 该方法直接操作原来的字符串，需要用 `mut` 修饰\n\n```rust\nfn main() {\n    let mut s = String::from(\"测试remove方法\");\n    println!(\n        \"string_remove 占 {} 个字节\",\n        std::mem::size_of_val(s.as_str())\n    );\n    // 删除第一个汉字\n    s.remove(0);\n    // 下面代码会发生错误\n    // s_remove.remove(1);\n    // 直接删除第二个汉字\n    // s_remove.remove(3);\n    dbg!(s);\n}\n```\n\n####  `truncate` \n\n- 删除字符串中从指定位置开始到结尾的全部字符\n- 参数的位置需要在合法的字符边界\n- 该方法是直接操作原来的字符串，需要用 `mut` 修饰\n\n```rust\nlet mut s = String::from(\"测试truncate\");\ns.truncate(3);\n```\n\n####  `clear` \n\n- 清空字符串\n- 该方法直接操作原来的字符串，需要用 `mut` 修饰\n\n```rust\nlet mut s = String::from(\"string clear\");\ns.clear();\n```\n\n### 连接 (Concatenate)\n\n#### 使用 Add()\n\n`add()` 方法的第二个参数必须为字符串切片引用（Slice）类型\n\n```rust\nuse std::ops::Add;\nfn main() {\n    let s = String::from(\"hello \");\n    let string_rust = String::from(\"rust\");\n    let result = s.add(&string_rust);\n}\n```\n\n#### 使用 + 或者 += 连接字符串\n\n之所以可以直接 + 是因为 Add 实现了 + 的 trait\n\n```rust\nlet s = String::from(\"hello \");\nlet string_rust = String::from(\"rust\");\nlet result = s + &string_rust; // &string_rust 会解引用为 &str\nlet mut result = result + \"!\";\nresult += \"!!!\";\n```\n\n##### 关于自动解引用\n\n`std::String` -> `&str` 没有任何成本，反过来则需要重新申请空间\n\n所以在定义使用字符串的函数的时候，优先定义成字符串切片的类型\n\n##### 关于所有权移动\n\n- 无论是 + 还是 add 都发生了所有权移动\n\n```rust\n    let s = String::from(\"hello \");\n    let string_rust = String::from(\"rust\");\n    let result = s + &string_rust; // &string_rust 会解引用转为 &str\n    // println!(\"{}\", s); // 报错\n    let mut result = result + \"!\";\n    result += \"!!!\";\n    println!(\"连接字符串 + -> {}\", result);\n```\n\n#### 使用 `format!` 连接字符串\n\n- `format!` 的用法与 `println!` 的用法类似\n\n```rust\nlet s1 = \"hello\";\nlet s2 = String::from(\"rust\");\nlet s = format!(\"{} {}!\", s1, s2);\nprintln!(\"{}\", s);\n```\n\n### Rust 手册 String 相关的函数\n\nhttps://doc.rust-lang.org/std/string/struct.String.html#\n\n## 字符串转义\n\n可以通过转义的方式 `\\` 输出 ASCII 和 Unicode 字符。\n\n```rust\n// 通过 \\ + 字符的十六进制表示，转义输出一个字符\nlet byte_escape = \"I'm writing \\x52\\x75\\x73\\x74!\";\nprintln!(\"What are you doing\\x3F (\\\\x3F means ?) {}\", byte_escape); // What are you doing? (\\x3F means ?) I'm writing Rust!\n\n// \\u 可以输出一个 unicode 字符\nlet unicode_codepoint = \"\\u{211D}\";\nlet character_name = \"\\\"DOUBLE-STRUCK CAPITAL R\\\"\";\nprintln!(\n    \"Unicode character {} (U+211D) is called {}\",\n    unicode_codepoint, character_name\n); // Unicode character ℝ (U+211D) is called \"DOUBLE-STRUCK CAPITAL R\"\n\n// 换行了也会保持之前的字符串格式\n// 使用\\忽略换行符\nlet long_string = \"String literals\n                    can span multiple lines.\n                    The linebreak and indentation here ->\\\n                    <- can be escaped too!\";\nprintln!(\"{}\", long_string); // The linebreak and indentation here -><- can be escaped too!\n```\n\n### 原样输出\n\n```rust\nprintln!(\"{}\", \"hello \\\\x52\\\\x75\\\\x73\\\\x74\");\nlet raw_str = r\"Escapes don't work here: \\x3F \\u{211D}\";\nprintln!(\"{}\", raw_str);\n// 如果字符串包含双引号，可以在开头和结尾加 #\nlet quotes = r#\"And then I said: \"There is no escape!\"\"#;\nprintln!(\"{}\", quotes);\n// 如果还是有歧义，可以继续增加，没有限制\nlet longer_delimiter = r###\"A string with \"# in it. And even \"##!\"###;\nprintln!(\"{}\", longer_delimiter);\n```\n","slug":"67-IB-Rust-字符串","published":1,"updated":"2025-05-24T13:04:19.533Z","_id":"cmb21qots0000vypr0xt21n8e","comments":1,"layout":"post","photos":[],"link":"","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/9_string\" >Codes in lesson9<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"字符串的定义\"><a href=\"#字符串的定义\" class=\"headerlink\" title=\"字符串的定义\"></a>字符串的定义</h2><p>字符串是由字符组成的连续集合</p>\n<p>Rust 中的字符是 Unicode 类型，因此每个字符占据 4 字节内存空间，但字符串是 UTF-8 编码，也就是字符串中的字符所占的字节数是变化的（1～4）</p>\n<p>比如，对于“hello 中国”来说，utf8 编码为：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">h    e   l   l   o   _   中           国</span><br><span class=\"line\">[104 101 108 108 111 32  228,184,173  229,155,189]</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"str\"><a href=\"#str\" class=\"headerlink\" title=\"str\"></a>str</h3><p>str 是 Rust 的一个基础类型，本质是一个字节数组<code>[u8]</code></p>\n<p><code>str</code> 或 <code>[u8]</code> 类型的值存放在内存：可能是堆，可能是栈，还可能硬编码进可执行程序</p>\n<h4 id=\"字符串字面量\"><a href=\"#字符串字面量\" class=\"headerlink\" title=\"字符串字面量\"></a>字符串字面量</h4><p>字符串字面量是 <code>str</code> 类型，在编译时就知道其内容，其字面值文本被直接硬编码进可执行程序</p>\n<p>在存储了该字符串之后，需要通过切片引用 <code>&amp;str</code> 来访问它</p>\n<ul>\n<li><code>&amp;str</code>是一种不可变引用，所以它没有所有权</li>\n<li><code>str</code> 类型是硬编码进可执行文件，无法被修改</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span>: &amp;<span class=\"type\">str</span> = <span class=\"string\">&quot;hello world&quot;</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"String\"><a href=\"#String\" class=\"headerlink\" title=\"String\"></a>String</h3><p>String 字符串是在程序运行得过程中动态生成的，其在 rust 中是一个复合数据类型，定义如下：</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">struct</span> <span class=\"title class_\">String</span> &#123;</span><br><span class=\"line\">    vec: <span class=\"type\">Vec</span>&lt;<span class=\"type\">u8</span>&gt;,&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>这说明 <code>String</code> 是可改变的，并且拥有所有权</p>\n<h3 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h3><p>除了 <code>String</code> 类型的字符串，Rust 的标准库还提供了其他类型的字符串，例如 <code>OsString</code>， <code>OsStr</code>， <code>CsString</code> 和<code> CsStr</code> 等</p>\n<h4 id=\"str-vs-String\"><a href=\"#str-vs-String\" class=\"headerlink\" title=\"&amp;str vs String\"></a>&amp;str vs String</h4><p><code>&amp;str</code>: 这是一个字符串切片，它是固定大小的，并且不能改变。</p>\n<p><code>String</code>: 这是一个可增长的、可改变的、拥有所有权的、UTF-8 编码的字符串类型。它通常用于需要改变或者增长字符串的情况。</p>\n<h2 id=\"类型转换\"><a href=\"#类型转换\" class=\"headerlink\" title=\"类型转换\"></a>类型转换</h2><h3 id=\"str-的转换\"><a href=\"#str-的转换\" class=\"headerlink\" title=\"&amp;str 的转换\"></a>&amp;str 的转换</h3><h4 id=\"字节数组-u8-Vec-str\"><a href=\"#字节数组-u8-Vec-str\" class=\"headerlink\" title=\"字节数组 [u8]|Vec&lt;u8&gt;-&gt;&amp;str\"></a>字节数组 <code>[u8]</code>|<code>Vec&lt;u8&gt;</code>-&gt;<code>&amp;str</code></h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::<span class=\"type\">str</span>;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">b</span> = [<span class=\"number\">104</span>, <span class=\"number\">101</span>, <span class=\"number\">108</span>, <span class=\"number\">108</span>, <span class=\"number\">111</span>, <span class=\"number\">32</span>, <span class=\"number\">228</span>, <span class=\"number\">184</span>, <span class=\"number\">173</span>, <span class=\"number\">229</span>, <span class=\"number\">155</span>, <span class=\"number\">189</span>];</span><br><span class=\"line\">    <span class=\"comment\">// 实现了从 Vec&lt;u8&gt; 到 [u8] 的隐式类型转换</span></span><br><span class=\"line\">  \t<span class=\"comment\">// let b = vec!(104, 101, 108, 108, 111, 32, 228, 184, 173, 229, 155, 189);</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"type\">str</span>::<span class=\"title function_ invoke__\">from_utf8</span>(&amp;b).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"字符串字面量-u8\"><a href=\"#字符串字面量-u8\" class=\"headerlink\" title=\"字符串字面量-&gt;[u8]\"></a>字符串字面量-&gt;<code>[u8]</code></h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"string\">&quot;hello 中国&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">b</span> = s.<span class=\"title function_ invoke__\">as_bytes</span>();</span><br><span class=\"line\">dbg!(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, b);</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"String-str\"><a href=\"#String-str\" class=\"headerlink\" title=\"String-&gt;&amp;str\"></a><code>String</code>-&gt;<code>&amp;str</code></h4><p>String 转变为 &amp;str 是无损的（性能无损，不会造成重写 malloc 或者数据移动）</p>\n<p><code>&amp;String</code> 可以自动转换为 <code>&amp;str</code>，因此在函数中，如果接收参数是 <code>&amp;String</code>，通常会采用 <code>&amp;str</code> 作为入参，提升数据兼容性</p>\n<p>字符串是 UTF-8 编码，因此需要保证索引的字节刚好落在字符的边界，因为有些字符的长度超过 1 个字节</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;hello, world&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// 方法一、使用 &amp;String 直接转换</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">some_func</span>(&amp;s);</span><br><span class=\"line\"><span class=\"comment\">// 方法二、使用 .as_str() 转换</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">some_func</span>(s.<span class=\"title function_ invoke__\">as_str</span>());</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"String的转换\"><a href=\"#String的转换\" class=\"headerlink\" title=\"String的转换\"></a>String的转换</h3><h4 id=\"字节数组-Vec-String\"><a href=\"#字节数组-Vec-String\" class=\"headerlink\" title=\"字节数组 Vec&lt;u8&gt;-&gt;String\"></a>字节数组 <code>Vec&lt;u8&gt;</code>-&gt;<code>String</code></h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">b</span> = <span class=\"built_in\">vec!</span>(<span class=\"number\">104</span>, <span class=\"number\">101</span>, <span class=\"number\">108</span>, <span class=\"number\">108</span>, <span class=\"number\">111</span>, <span class=\"number\">32</span>, <span class=\"number\">228</span>, <span class=\"number\">184</span>, <span class=\"number\">173</span>, <span class=\"number\">229</span>, <span class=\"number\">155</span>, <span class=\"number\">189</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from_utf8</span>(b).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, s);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"str-String\"><a href=\"#str-String\" class=\"headerlink\" title=\"&amp;str-&gt;String\"></a><code>&amp;str</code>-&gt;<code>String</code></h4><p>从 &amp;str 获得 String 是低效的，因为要重新 malloc 数据</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;hello 世界&quot;</span>);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"Overview\"><a href=\"#Overview\" class=\"headerlink\" title=\"Overview\"></a>Overview</h3><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&amp;str    -&gt; String  | String::from(s) or s.to_string() or s.to_owned()</span><br><span class=\"line\">&amp;str    -&gt; &amp;[u8]   | s.as_bytes()</span><br><span class=\"line\">&amp;str    -&gt; Vec&lt;u8&gt; | s.as_bytes().to_vec() or s.as_bytes().to_owned()</span><br><span class=\"line\">String  -&gt; &amp;str    | &amp;s if possible* else s.as_str()</span><br><span class=\"line\">String  -&gt; &amp;[u8]   | s.as_bytes()</span><br><span class=\"line\">String  -&gt; Vec&lt;u8&gt; | s.into_bytes()</span><br><span class=\"line\">&amp;[u8]   -&gt; &amp;str    | s.to_vec() or s.to_owned()</span><br><span class=\"line\">&amp;[u8]   -&gt; String  | std::str::from_utf8(s).unwrap(), but unsafe</span><br><span class=\"line\">&amp;[u8]   -&gt; Vec&lt;u8&gt; | String::from_utf8(s).unwrap(), but unsafe</span><br><span class=\"line\">Vec&lt;u8&gt; -&gt; &amp;str    | &amp;s if possible* else s.as_slice()</span><br><span class=\"line\">Vec&lt;u8&gt; -&gt; String  | std::str::from_utf8(&amp;s).unwrap(), but unsafe</span><br><span class=\"line\">Vec&lt;u8&gt; -&gt; &amp;[u8]   | String::from_utf8(s).unwrap(), but unsafe</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"操作字符串\"><a href=\"#操作字符串\" class=\"headerlink\" title=\"操作字符串\"></a>操作字符串</h2><p>可变字符串 <code>String</code> 的修改，添加，删除等常用方法，且如果执行这些操作会修改原字符串，则字符串必须是 mut 的</p>\n<h3 id=\"追加-Push\"><a href=\"#追加-Push\" class=\"headerlink\" title=\"追加 (Push)\"></a>追加 (Push)</h3><ul>\n<li>使用 <code>push()</code> 方法追加字符 <code>char</code></li>\n<li>使用 <code>push_str()</code> 方法追加字符串字面量</li>\n<li>两个方法都是<strong>在原有的字符串上追加</strong>，需要用 <code>mut</code> 修饰</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Hello &quot;</span>);</span><br><span class=\"line\">s.<span class=\"title function_ invoke__\">push_str</span>(<span class=\"string\">&quot;rust&quot;</span>);</span><br><span class=\"line\">s.<span class=\"title function_ invoke__\">push</span>(<span class=\"string\">&#x27;!&#x27;</span>);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"插入-Insert\"><a href=\"#插入-Insert\" class=\"headerlink\" title=\"插入 (Insert)\"></a>插入 (Insert)</h3><ul>\n<li>使用 <code>insert()</code> 方法插入单个字符 <code>char</code></li>\n<li>使用 <code>insert_str()</code> 方法插入字符串字面量</li>\n<li>这俩方法需要传入两个参数，第一个参数是字符（串）插入位置的索引，索引从 0 开始计数；第二个参数是要插入的字符（串），注意不要越界</li>\n<li>两个方法都是<strong>在原有的字符串上追加</strong>，需要用 <code>mut</code> 修饰</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Hello rust!中文&quot;</span>);</span><br><span class=\"line\">s.<span class=\"title function_ invoke__\">insert</span>(<span class=\"number\">5</span>, <span class=\"string\">&#x27;,&#x27;</span>);</span><br><span class=\"line\">s.<span class=\"title function_ invoke__\">insert_str</span>(<span class=\"number\">6</span>, <span class=\"string\">&quot; I like&quot;</span>);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"替换-Replace\"><a href=\"#替换-Replace\" class=\"headerlink\" title=\"替换 (Replace)\"></a>替换 (Replace)</h3><h4 id=\"replace\"><a href=\"#replace\" class=\"headerlink\" title=\"replace\"></a><code>replace</code></h4><ul>\n<li><code>replace()</code> 方法接收两个参数，第一个参数是要被替换的字符串，第二个参数是新的字符串</li>\n<li>该方法会替换所有匹配到的字符串</li>\n<li>该方法返回一个新的字符串，而不是操作原来的字符串，所以不需要 mut 修饰</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;I like rust. Learning rust is my favorite!&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">new_string_replace</span> = s.<span class=\"title function_ invoke__\">replace</span>(<span class=\"string\">&quot;rust&quot;</span>, <span class=\"string\">&quot;RUST&quot;</span>);</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"replacen\"><a href=\"#replacen\" class=\"headerlink\" title=\"replacen\"></a><code>replacen</code></h4><p>方法接收三个参数，前两个参数与 <code>replace()</code> 方法一样，第三个参数则表示替换的个数</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"string\">&quot;I like rust. Learning rust is my favorite!&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">new_string_replacen</span> = s.<span class=\"title function_ invoke__\">replacen</span>(<span class=\"string\">&quot;rust&quot;</span>, <span class=\"string\">&quot;RUST&quot;</span>, <span class=\"number\">1</span>);</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"replace-range\"><a href=\"#replace-range\" class=\"headerlink\" title=\"replace_range\"></a><code>replace_range</code></h4><ul>\n<li><code>replace_range</code> 接收两个参数，第一个参数是要替换字符串的范围（Range），第二个参数是新的字符串</li>\n<li>该方法是直接操作原来的字符串，需要使用 <code>mut</code> 修饰</li>\n<li>如果range的范围大于&#x2F;小于新字符串长度会怎样？</li>\n<li>参数的位置需要在合法的字符边界</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;hello rust 中国&quot;</span>);</span><br><span class=\"line\">s.<span class=\"title function_ invoke__\">replace_range</span>(<span class=\"number\">7</span>..<span class=\"number\">8</span>, <span class=\"string\">&quot;R&quot;</span>);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"删除-Delete\"><a href=\"#删除-Delete\" class=\"headerlink\" title=\"删除 (Delete)\"></a>删除 (Delete)</h3><h4 id=\"pop\"><a href=\"#pop\" class=\"headerlink\" title=\"pop\"></a><code>pop</code></h4><ul>\n<li>删除并返回字符串的最后一个字符</li>\n<li>其返回值是一个 <code>Option</code> 类型，如果字符串为空，则返回 <code>None</code></li>\n<li>该方法直接操作原来的字符串，需要用 <code>mut</code> 修饰</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;中文!&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">p1</span> = s.<span class=\"title function_ invoke__\">pop</span>(); <span class=\"comment\">// 中</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">p2</span> = s.<span class=\"title function_ invoke__\">pop</span>(); <span class=\"comment\">// 文</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">p3</span> = s.<span class=\"title function_ invoke__\">pop</span>(); <span class=\"comment\">// ！</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">p4</span> = s.<span class=\"title function_ invoke__\">pop</span>(); <span class=\"comment\">// `None`</span></span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"remove\"><a href=\"#remove\" class=\"headerlink\" title=\"remove\"></a><code>remove</code></h4><ul>\n<li>其返回值是删除位置的字符串</li>\n<li>接收一个参数，表示该字符起始索引位置</li>\n<li>参数的位置需要在合法的字符边界</li>\n<li>该方法直接操作原来的字符串，需要用 <code>mut</code> 修饰</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;测试remove方法&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;string_remove 占 &#123;&#125; 个字节&quot;</span>,</span><br><span class=\"line\">        std::mem::<span class=\"title function_ invoke__\">size_of_val</span>(s.<span class=\"title function_ invoke__\">as_str</span>())</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"comment\">// 删除第一个汉字</span></span><br><span class=\"line\">    s.<span class=\"title function_ invoke__\">remove</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 下面代码会发生错误</span></span><br><span class=\"line\">    <span class=\"comment\">// s_remove.remove(1);</span></span><br><span class=\"line\">    <span class=\"comment\">// 直接删除第二个汉字</span></span><br><span class=\"line\">    <span class=\"comment\">// s_remove.remove(3);</span></span><br><span class=\"line\">    dbg!(s);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"truncate\"><a href=\"#truncate\" class=\"headerlink\" title=\"truncate\"></a><code>truncate</code></h4><ul>\n<li>删除字符串中从指定位置开始到结尾的全部字符</li>\n<li>参数的位置需要在合法的字符边界</li>\n<li>该方法是直接操作原来的字符串，需要用 <code>mut</code> 修饰</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;测试truncate&quot;</span>);</span><br><span class=\"line\">s.<span class=\"title function_ invoke__\">truncate</span>(<span class=\"number\">3</span>);</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"clear\"><a href=\"#clear\" class=\"headerlink\" title=\"clear\"></a><code>clear</code></h4><ul>\n<li>清空字符串</li>\n<li>该方法直接操作原来的字符串，需要用 <code>mut</code> 修饰</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;string clear&quot;</span>);</span><br><span class=\"line\">s.<span class=\"title function_ invoke__\">clear</span>();</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"连接-Concatenate\"><a href=\"#连接-Concatenate\" class=\"headerlink\" title=\"连接 (Concatenate)\"></a>连接 (Concatenate)</h3><h4 id=\"使用-Add\"><a href=\"#使用-Add\" class=\"headerlink\" title=\"使用 Add()\"></a>使用 Add()</h4><p><code>add()</code> 方法的第二个参数必须为字符串切片引用（Slice）类型</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::ops::Add;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;hello &quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">string_rust</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;rust&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">result</span> = s.<span class=\"title function_ invoke__\">add</span>(&amp;string_rust);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"使用-或者-连接字符串\"><a href=\"#使用-或者-连接字符串\" class=\"headerlink\" title=\"使用 + 或者 +&#x3D; 连接字符串\"></a>使用 + 或者 +&#x3D; 连接字符串</h4><p>之所以可以直接 + 是因为 Add 实现了 + 的 trait</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;hello &quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">string_rust</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;rust&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">result</span> = s + &amp;string_rust; <span class=\"comment\">// &amp;string_rust 会解引用为 &amp;str</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">result</span> = result + <span class=\"string\">&quot;!&quot;</span>;</span><br><span class=\"line\">result += <span class=\"string\">&quot;!!!&quot;</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h5 id=\"关于自动解引用\"><a href=\"#关于自动解引用\" class=\"headerlink\" title=\"关于自动解引用\"></a>关于自动解引用</h5><p><code>std::String</code> -&gt; <code>&amp;str</code> 没有任何成本，反过来则需要重新申请空间</p>\n<p>所以在定义使用字符串的函数的时候，优先定义成字符串切片的类型</p>\n<h5 id=\"关于所有权移动\"><a href=\"#关于所有权移动\" class=\"headerlink\" title=\"关于所有权移动\"></a>关于所有权移动</h5><ul>\n<li>无论是 + 还是 add 都发生了所有权移动</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;hello &quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">string_rust</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;rust&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">result</span> = s + &amp;string_rust; <span class=\"comment\">// &amp;string_rust 会解引用转为 &amp;str</span></span><br><span class=\"line\"><span class=\"comment\">// println!(&quot;&#123;&#125;&quot;, s); // 报错</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">result</span> = result + <span class=\"string\">&quot;!&quot;</span>;</span><br><span class=\"line\">result += <span class=\"string\">&quot;!!!&quot;</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;连接字符串 + -&gt; &#123;&#125;&quot;</span>, result);</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"使用-format-连接字符串\"><a href=\"#使用-format-连接字符串\" class=\"headerlink\" title=\"使用 format! 连接字符串\"></a>使用 <code>format!</code> 连接字符串</h4><ul>\n<li><code>format!</code> 的用法与 <code>println!</code> 的用法类似</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s1</span> = <span class=\"string\">&quot;hello&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s2</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;rust&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"built_in\">format!</span>(<span class=\"string\">&quot;&#123;&#125; &#123;&#125;!&quot;</span>, s1, s2);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, s);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"Rust-手册-String-相关的函数\"><a href=\"#Rust-手册-String-相关的函数\" class=\"headerlink\" title=\"Rust 手册 String 相关的函数\"></a>Rust 手册 String 相关的函数</h3><p><a class=\"link\"   href=\"https://doc.rust-lang.org/std/string/struct.String.html#\" >https://doc.rust-lang.org/std/string/struct.String.html#<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"字符串转义\"><a href=\"#字符串转义\" class=\"headerlink\" title=\"字符串转义\"></a>字符串转义</h2><p>可以通过转义的方式 <code>\\</code> 输出 ASCII 和 Unicode 字符。</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 通过 \\ + 字符的十六进制表示，转义输出一个字符</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">byte_escape</span> = <span class=\"string\">&quot;I&#x27;m writing \\x52\\x75\\x73\\x74!&quot;</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;What are you doing\\x3F (\\\\x3F means ?) &#123;&#125;&quot;</span>, byte_escape); <span class=\"comment\">// What are you doing? (\\x3F means ?) I&#x27;m writing Rust!</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// \\u 可以输出一个 unicode 字符</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">unicode_codepoint</span> = <span class=\"string\">&quot;\\u&#123;211D&#125;&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">character_name</span> = <span class=\"string\">&quot;\\&quot;DOUBLE-STRUCK CAPITAL R\\&quot;&quot;</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(</span><br><span class=\"line\">    <span class=\"string\">&quot;Unicode character &#123;&#125; (U+211D) is called &#123;&#125;&quot;</span>,</span><br><span class=\"line\">    unicode_codepoint, character_name</span><br><span class=\"line\">); <span class=\"comment\">// Unicode character ℝ (U+211D) is called &quot;DOUBLE-STRUCK CAPITAL R&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 换行了也会保持之前的字符串格式</span></span><br><span class=\"line\"><span class=\"comment\">// 使用\\忽略换行符</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">long_string</span> = <span class=\"string\">&quot;String literals</span></span><br><span class=\"line\"><span class=\"string\">                    can span multiple lines.</span></span><br><span class=\"line\"><span class=\"string\">                    The linebreak and indentation here -&gt;\\</span></span><br><span class=\"line\"><span class=\"string\">                    &lt;- can be escaped too!&quot;</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, long_string); <span class=\"comment\">// The linebreak and indentation here -&gt;&lt;- can be escaped too!</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"原样输出\"><a href=\"#原样输出\" class=\"headerlink\" title=\"原样输出\"></a>原样输出</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, <span class=\"string\">&quot;hello \\\\x52\\\\x75\\\\x73\\\\x74&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">raw_str</span> = <span class=\"string\">r&quot;Escapes don&#x27;t work here: \\x3F \\u&#123;211D&#125;&quot;</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, raw_str);</span><br><span class=\"line\"><span class=\"comment\">// 如果字符串包含双引号，可以在开头和结尾加 #</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">quotes</span> = <span class=\"string\">r#&quot;And then I said: &quot;There is no escape!&quot;&quot;#</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, quotes);</span><br><span class=\"line\"><span class=\"comment\">// 如果还是有歧义，可以继续增加，没有限制</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">longer_delimiter</span> = <span class=\"string\">r###&quot;A string with &quot;# in it. And even &quot;##!&quot;###</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, longer_delimiter);</span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/9_string\" >Codes in lesson9<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"字符串的定义\"><a href=\"#字符串的定义\" class=\"headerlink\" title=\"字符串的定义\"></a>字符串的定义</h2><p>字符串是由字符组成的连续集合</p>\n<p>Rust 中的字符是 Unicode 类型，因此每个字符占据 4 字节内存空间，但字符串是 UTF-8 编码，也就是字符串中的字符所占的字节数是变化的（1～4）</p>\n<p>比如，对于“hello 中国”来说，utf8 编码为：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">h    e   l   l   o   _   中           国</span><br><span class=\"line\">[104 101 108 108 111 32  228,184,173  229,155,189]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"str\"><a href=\"#str\" class=\"headerlink\" title=\"str\"></a>str</h3><p>str 是 Rust 的一个基础类型，本质是一个字节数组<code>[u8]</code></p>\n<p><code>str</code> 或 <code>[u8]</code> 类型的值存放在内存：可能是堆，可能是栈，还可能硬编码进可执行程序</p>\n<h4 id=\"字符串字面量\"><a href=\"#字符串字面量\" class=\"headerlink\" title=\"字符串字面量\"></a>字符串字面量</h4><p>字符串字面量是 <code>str</code> 类型，在编译时就知道其内容，其字面值文本被直接硬编码进可执行程序</p>\n<p>在存储了该字符串之后，需要通过切片引用 <code>&amp;str</code> 来访问它</p>\n<ul>\n<li><code>&amp;str</code>是一种不可变引用，所以它没有所有权</li>\n<li><code>str</code> 类型是硬编码进可执行文件，无法被修改</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span>: &amp;<span class=\"type\">str</span> = <span class=\"string\">&quot;hello world&quot;</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"String\"><a href=\"#String\" class=\"headerlink\" title=\"String\"></a>String</h3><p>String 字符串是在程序运行得过程中动态生成的，其在 rust 中是一个复合数据类型，定义如下：</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">struct</span> <span class=\"title class_\">String</span> &#123;</span><br><span class=\"line\">    vec: <span class=\"type\">Vec</span>&lt;<span class=\"type\">u8</span>&gt;,&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这说明 <code>String</code> 是可改变的，并且拥有所有权</p>\n<h3 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h3><p>除了 <code>String</code> 类型的字符串，Rust 的标准库还提供了其他类型的字符串，例如 <code>OsString</code>， <code>OsStr</code>， <code>CsString</code> 和<code> CsStr</code> 等</p>\n<h4 id=\"str-vs-String\"><a href=\"#str-vs-String\" class=\"headerlink\" title=\"&amp;str vs String\"></a>&amp;str vs String</h4><p><code>&amp;str</code>: 这是一个字符串切片，它是固定大小的，并且不能改变。</p>\n<p><code>String</code>: 这是一个可增长的、可改变的、拥有所有权的、UTF-8 编码的字符串类型。它通常用于需要改变或者增长字符串的情况。</p>\n<h2 id=\"类型转换\"><a href=\"#类型转换\" class=\"headerlink\" title=\"类型转换\"></a>类型转换</h2><h3 id=\"str-的转换\"><a href=\"#str-的转换\" class=\"headerlink\" title=\"&amp;str 的转换\"></a>&amp;str 的转换</h3><h4 id=\"字节数组-u8-Vec-str\"><a href=\"#字节数组-u8-Vec-str\" class=\"headerlink\" title=\"字节数组 [u8]|Vec&lt;u8&gt;-&gt;&amp;str\"></a>字节数组 <code>[u8]</code>|<code>Vec&lt;u8&gt;</code>-&gt;<code>&amp;str</code></h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::<span class=\"type\">str</span>;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">b</span> = [<span class=\"number\">104</span>, <span class=\"number\">101</span>, <span class=\"number\">108</span>, <span class=\"number\">108</span>, <span class=\"number\">111</span>, <span class=\"number\">32</span>, <span class=\"number\">228</span>, <span class=\"number\">184</span>, <span class=\"number\">173</span>, <span class=\"number\">229</span>, <span class=\"number\">155</span>, <span class=\"number\">189</span>];</span><br><span class=\"line\">    <span class=\"comment\">// 实现了从 Vec&lt;u8&gt; 到 [u8] 的隐式类型转换</span></span><br><span class=\"line\">  \t<span class=\"comment\">// let b = vec!(104, 101, 108, 108, 111, 32, 228, 184, 173, 229, 155, 189);</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"type\">str</span>::<span class=\"title function_ invoke__\">from_utf8</span>(&amp;b).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"字符串字面量-u8\"><a href=\"#字符串字面量-u8\" class=\"headerlink\" title=\"字符串字面量-&gt;[u8]\"></a>字符串字面量-&gt;<code>[u8]</code></h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"string\">&quot;hello 中国&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">b</span> = s.<span class=\"title function_ invoke__\">as_bytes</span>();</span><br><span class=\"line\">dbg!(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, b);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"String-str\"><a href=\"#String-str\" class=\"headerlink\" title=\"String-&gt;&amp;str\"></a><code>String</code>-&gt;<code>&amp;str</code></h4><p>String 转变为 &amp;str 是无损的（性能无损，不会造成重写 malloc 或者数据移动）</p>\n<p><code>&amp;String</code> 可以自动转换为 <code>&amp;str</code>，因此在函数中，如果接收参数是 <code>&amp;String</code>，通常会采用 <code>&amp;str</code> 作为入参，提升数据兼容性</p>\n<p>字符串是 UTF-8 编码，因此需要保证索引的字节刚好落在字符的边界，因为有些字符的长度超过 1 个字节</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;hello, world&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// 方法一、使用 &amp;String 直接转换</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">some_func</span>(&amp;s);</span><br><span class=\"line\"><span class=\"comment\">// 方法二、使用 .as_str() 转换</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">some_func</span>(s.<span class=\"title function_ invoke__\">as_str</span>());</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"String的转换\"><a href=\"#String的转换\" class=\"headerlink\" title=\"String的转换\"></a>String的转换</h3><h4 id=\"字节数组-Vec-String\"><a href=\"#字节数组-Vec-String\" class=\"headerlink\" title=\"字节数组 Vec&lt;u8&gt;-&gt;String\"></a>字节数组 <code>Vec&lt;u8&gt;</code>-&gt;<code>String</code></h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">b</span> = <span class=\"built_in\">vec!</span>(<span class=\"number\">104</span>, <span class=\"number\">101</span>, <span class=\"number\">108</span>, <span class=\"number\">108</span>, <span class=\"number\">111</span>, <span class=\"number\">32</span>, <span class=\"number\">228</span>, <span class=\"number\">184</span>, <span class=\"number\">173</span>, <span class=\"number\">229</span>, <span class=\"number\">155</span>, <span class=\"number\">189</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from_utf8</span>(b).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, s);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"str-String\"><a href=\"#str-String\" class=\"headerlink\" title=\"&amp;str-&gt;String\"></a><code>&amp;str</code>-&gt;<code>String</code></h4><p>从 &amp;str 获得 String 是低效的，因为要重新 malloc 数据</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;hello 世界&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Overview\"><a href=\"#Overview\" class=\"headerlink\" title=\"Overview\"></a>Overview</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&amp;str    -&gt; String  | String::from(s) or s.to_string() or s.to_owned()</span><br><span class=\"line\">&amp;str    -&gt; &amp;[u8]   | s.as_bytes()</span><br><span class=\"line\">&amp;str    -&gt; Vec&lt;u8&gt; | s.as_bytes().to_vec() or s.as_bytes().to_owned()</span><br><span class=\"line\">String  -&gt; &amp;str    | &amp;s if possible* else s.as_str()</span><br><span class=\"line\">String  -&gt; &amp;[u8]   | s.as_bytes()</span><br><span class=\"line\">String  -&gt; Vec&lt;u8&gt; | s.into_bytes()</span><br><span class=\"line\">&amp;[u8]   -&gt; &amp;str    | s.to_vec() or s.to_owned()</span><br><span class=\"line\">&amp;[u8]   -&gt; String  | std::str::from_utf8(s).unwrap(), but unsafe</span><br><span class=\"line\">&amp;[u8]   -&gt; Vec&lt;u8&gt; | String::from_utf8(s).unwrap(), but unsafe</span><br><span class=\"line\">Vec&lt;u8&gt; -&gt; &amp;str    | &amp;s if possible* else s.as_slice()</span><br><span class=\"line\">Vec&lt;u8&gt; -&gt; String  | std::str::from_utf8(&amp;s).unwrap(), but unsafe</span><br><span class=\"line\">Vec&lt;u8&gt; -&gt; &amp;[u8]   | String::from_utf8(s).unwrap(), but unsafe</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"操作字符串\"><a href=\"#操作字符串\" class=\"headerlink\" title=\"操作字符串\"></a>操作字符串</h2><p>可变字符串 <code>String</code> 的修改，添加，删除等常用方法，且如果执行这些操作会修改原字符串，则字符串必须是 mut 的</p>\n<h3 id=\"追加-Push\"><a href=\"#追加-Push\" class=\"headerlink\" title=\"追加 (Push)\"></a>追加 (Push)</h3><ul>\n<li>使用 <code>push()</code> 方法追加字符 <code>char</code></li>\n<li>使用 <code>push_str()</code> 方法追加字符串字面量</li>\n<li>两个方法都是<strong>在原有的字符串上追加</strong>，需要用 <code>mut</code> 修饰</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Hello &quot;</span>);</span><br><span class=\"line\">s.<span class=\"title function_ invoke__\">push_str</span>(<span class=\"string\">&quot;rust&quot;</span>);</span><br><span class=\"line\">s.<span class=\"title function_ invoke__\">push</span>(<span class=\"string\">&#x27;!&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"插入-Insert\"><a href=\"#插入-Insert\" class=\"headerlink\" title=\"插入 (Insert)\"></a>插入 (Insert)</h3><ul>\n<li>使用 <code>insert()</code> 方法插入单个字符 <code>char</code></li>\n<li>使用 <code>insert_str()</code> 方法插入字符串字面量</li>\n<li>这俩方法需要传入两个参数，第一个参数是字符（串）插入位置的索引，索引从 0 开始计数；第二个参数是要插入的字符（串），注意不要越界</li>\n<li>两个方法都是<strong>在原有的字符串上追加</strong>，需要用 <code>mut</code> 修饰</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Hello rust!中文&quot;</span>);</span><br><span class=\"line\">s.<span class=\"title function_ invoke__\">insert</span>(<span class=\"number\">5</span>, <span class=\"string\">&#x27;,&#x27;</span>);</span><br><span class=\"line\">s.<span class=\"title function_ invoke__\">insert_str</span>(<span class=\"number\">6</span>, <span class=\"string\">&quot; I like&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"替换-Replace\"><a href=\"#替换-Replace\" class=\"headerlink\" title=\"替换 (Replace)\"></a>替换 (Replace)</h3><h4 id=\"replace\"><a href=\"#replace\" class=\"headerlink\" title=\"replace\"></a><code>replace</code></h4><ul>\n<li><code>replace()</code> 方法接收两个参数，第一个参数是要被替换的字符串，第二个参数是新的字符串</li>\n<li>该方法会替换所有匹配到的字符串</li>\n<li>该方法返回一个新的字符串，而不是操作原来的字符串，所以不需要 mut 修饰</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;I like rust. Learning rust is my favorite!&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">new_string_replace</span> = s.<span class=\"title function_ invoke__\">replace</span>(<span class=\"string\">&quot;rust&quot;</span>, <span class=\"string\">&quot;RUST&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"replacen\"><a href=\"#replacen\" class=\"headerlink\" title=\"replacen\"></a><code>replacen</code></h4><p>方法接收三个参数，前两个参数与 <code>replace()</code> 方法一样，第三个参数则表示替换的个数</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"string\">&quot;I like rust. Learning rust is my favorite!&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">new_string_replacen</span> = s.<span class=\"title function_ invoke__\">replacen</span>(<span class=\"string\">&quot;rust&quot;</span>, <span class=\"string\">&quot;RUST&quot;</span>, <span class=\"number\">1</span>);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"replace-range\"><a href=\"#replace-range\" class=\"headerlink\" title=\"replace_range\"></a><code>replace_range</code></h4><ul>\n<li><code>replace_range</code> 接收两个参数，第一个参数是要替换字符串的范围（Range），第二个参数是新的字符串</li>\n<li>该方法是直接操作原来的字符串，需要使用 <code>mut</code> 修饰</li>\n<li>如果range的范围大于&#x2F;小于新字符串长度会怎样？</li>\n<li>参数的位置需要在合法的字符边界</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;hello rust 中国&quot;</span>);</span><br><span class=\"line\">s.<span class=\"title function_ invoke__\">replace_range</span>(<span class=\"number\">7</span>..<span class=\"number\">8</span>, <span class=\"string\">&quot;R&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"删除-Delete\"><a href=\"#删除-Delete\" class=\"headerlink\" title=\"删除 (Delete)\"></a>删除 (Delete)</h3><h4 id=\"pop\"><a href=\"#pop\" class=\"headerlink\" title=\"pop\"></a><code>pop</code></h4><ul>\n<li>删除并返回字符串的最后一个字符</li>\n<li>其返回值是一个 <code>Option</code> 类型，如果字符串为空，则返回 <code>None</code></li>\n<li>该方法直接操作原来的字符串，需要用 <code>mut</code> 修饰</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;中文!&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">p1</span> = s.<span class=\"title function_ invoke__\">pop</span>(); <span class=\"comment\">// 中</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">p2</span> = s.<span class=\"title function_ invoke__\">pop</span>(); <span class=\"comment\">// 文</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">p3</span> = s.<span class=\"title function_ invoke__\">pop</span>(); <span class=\"comment\">// ！</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">p4</span> = s.<span class=\"title function_ invoke__\">pop</span>(); <span class=\"comment\">// `None`</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"remove\"><a href=\"#remove\" class=\"headerlink\" title=\"remove\"></a><code>remove</code></h4><ul>\n<li>其返回值是删除位置的字符串</li>\n<li>接收一个参数，表示该字符起始索引位置</li>\n<li>参数的位置需要在合法的字符边界</li>\n<li>该方法直接操作原来的字符串，需要用 <code>mut</code> 修饰</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;测试remove方法&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;string_remove 占 &#123;&#125; 个字节&quot;</span>,</span><br><span class=\"line\">        std::mem::<span class=\"title function_ invoke__\">size_of_val</span>(s.<span class=\"title function_ invoke__\">as_str</span>())</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"comment\">// 删除第一个汉字</span></span><br><span class=\"line\">    s.<span class=\"title function_ invoke__\">remove</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 下面代码会发生错误</span></span><br><span class=\"line\">    <span class=\"comment\">// s_remove.remove(1);</span></span><br><span class=\"line\">    <span class=\"comment\">// 直接删除第二个汉字</span></span><br><span class=\"line\">    <span class=\"comment\">// s_remove.remove(3);</span></span><br><span class=\"line\">    dbg!(s);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"truncate\"><a href=\"#truncate\" class=\"headerlink\" title=\"truncate\"></a><code>truncate</code></h4><ul>\n<li>删除字符串中从指定位置开始到结尾的全部字符</li>\n<li>参数的位置需要在合法的字符边界</li>\n<li>该方法是直接操作原来的字符串，需要用 <code>mut</code> 修饰</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;测试truncate&quot;</span>);</span><br><span class=\"line\">s.<span class=\"title function_ invoke__\">truncate</span>(<span class=\"number\">3</span>);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"clear\"><a href=\"#clear\" class=\"headerlink\" title=\"clear\"></a><code>clear</code></h4><ul>\n<li>清空字符串</li>\n<li>该方法直接操作原来的字符串，需要用 <code>mut</code> 修饰</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;string clear&quot;</span>);</span><br><span class=\"line\">s.<span class=\"title function_ invoke__\">clear</span>();</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"连接-Concatenate\"><a href=\"#连接-Concatenate\" class=\"headerlink\" title=\"连接 (Concatenate)\"></a>连接 (Concatenate)</h3><h4 id=\"使用-Add\"><a href=\"#使用-Add\" class=\"headerlink\" title=\"使用 Add()\"></a>使用 Add()</h4><p><code>add()</code> 方法的第二个参数必须为字符串切片引用（Slice）类型</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::ops::Add;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;hello &quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">string_rust</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;rust&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">result</span> = s.<span class=\"title function_ invoke__\">add</span>(&amp;string_rust);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"使用-或者-连接字符串\"><a href=\"#使用-或者-连接字符串\" class=\"headerlink\" title=\"使用 + 或者 +&#x3D; 连接字符串\"></a>使用 + 或者 +&#x3D; 连接字符串</h4><p>之所以可以直接 + 是因为 Add 实现了 + 的 trait</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;hello &quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">string_rust</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;rust&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">result</span> = s + &amp;string_rust; <span class=\"comment\">// &amp;string_rust 会解引用为 &amp;str</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">result</span> = result + <span class=\"string\">&quot;!&quot;</span>;</span><br><span class=\"line\">result += <span class=\"string\">&quot;!!!&quot;</span>;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"关于自动解引用\"><a href=\"#关于自动解引用\" class=\"headerlink\" title=\"关于自动解引用\"></a>关于自动解引用</h5><p><code>std::String</code> -&gt; <code>&amp;str</code> 没有任何成本，反过来则需要重新申请空间</p>\n<p>所以在定义使用字符串的函数的时候，优先定义成字符串切片的类型</p>\n<h5 id=\"关于所有权移动\"><a href=\"#关于所有权移动\" class=\"headerlink\" title=\"关于所有权移动\"></a>关于所有权移动</h5><ul>\n<li>无论是 + 还是 add 都发生了所有权移动</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;hello &quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">string_rust</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;rust&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">result</span> = s + &amp;string_rust; <span class=\"comment\">// &amp;string_rust 会解引用转为 &amp;str</span></span><br><span class=\"line\"><span class=\"comment\">// println!(&quot;&#123;&#125;&quot;, s); // 报错</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">result</span> = result + <span class=\"string\">&quot;!&quot;</span>;</span><br><span class=\"line\">result += <span class=\"string\">&quot;!!!&quot;</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;连接字符串 + -&gt; &#123;&#125;&quot;</span>, result);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"使用-format-连接字符串\"><a href=\"#使用-format-连接字符串\" class=\"headerlink\" title=\"使用 format! 连接字符串\"></a>使用 <code>format!</code> 连接字符串</h4><ul>\n<li><code>format!</code> 的用法与 <code>println!</code> 的用法类似</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s1</span> = <span class=\"string\">&quot;hello&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s2</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;rust&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"built_in\">format!</span>(<span class=\"string\">&quot;&#123;&#125; &#123;&#125;!&quot;</span>, s1, s2);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, s);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Rust-手册-String-相关的函数\"><a href=\"#Rust-手册-String-相关的函数\" class=\"headerlink\" title=\"Rust 手册 String 相关的函数\"></a>Rust 手册 String 相关的函数</h3><p><a class=\"link\"   href=\"https://doc.rust-lang.org/std/string/struct.String.html#\" >https://doc.rust-lang.org/std/string/struct.String.html#<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"字符串转义\"><a href=\"#字符串转义\" class=\"headerlink\" title=\"字符串转义\"></a>字符串转义</h2><p>可以通过转义的方式 <code>\\</code> 输出 ASCII 和 Unicode 字符。</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 通过 \\ + 字符的十六进制表示，转义输出一个字符</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">byte_escape</span> = <span class=\"string\">&quot;I&#x27;m writing \\x52\\x75\\x73\\x74!&quot;</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;What are you doing\\x3F (\\\\x3F means ?) &#123;&#125;&quot;</span>, byte_escape); <span class=\"comment\">// What are you doing? (\\x3F means ?) I&#x27;m writing Rust!</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// \\u 可以输出一个 unicode 字符</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">unicode_codepoint</span> = <span class=\"string\">&quot;\\u&#123;211D&#125;&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">character_name</span> = <span class=\"string\">&quot;\\&quot;DOUBLE-STRUCK CAPITAL R\\&quot;&quot;</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(</span><br><span class=\"line\">    <span class=\"string\">&quot;Unicode character &#123;&#125; (U+211D) is called &#123;&#125;&quot;</span>,</span><br><span class=\"line\">    unicode_codepoint, character_name</span><br><span class=\"line\">); <span class=\"comment\">// Unicode character ℝ (U+211D) is called &quot;DOUBLE-STRUCK CAPITAL R&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 换行了也会保持之前的字符串格式</span></span><br><span class=\"line\"><span class=\"comment\">// 使用\\忽略换行符</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">long_string</span> = <span class=\"string\">&quot;String literals</span></span><br><span class=\"line\"><span class=\"string\">                    can span multiple lines.</span></span><br><span class=\"line\"><span class=\"string\">                    The linebreak and indentation here -&gt;\\</span></span><br><span class=\"line\"><span class=\"string\">                    &lt;- can be escaped too!&quot;</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, long_string); <span class=\"comment\">// The linebreak and indentation here -&gt;&lt;- can be escaped too!</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"原样输出\"><a href=\"#原样输出\" class=\"headerlink\" title=\"原样输出\"></a>原样输出</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, <span class=\"string\">&quot;hello \\\\x52\\\\x75\\\\x73\\\\x74&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">raw_str</span> = <span class=\"string\">r&quot;Escapes don&#x27;t work here: \\x3F \\u&#123;211D&#125;&quot;</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, raw_str);</span><br><span class=\"line\"><span class=\"comment\">// 如果字符串包含双引号，可以在开头和结尾加 #</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">quotes</span> = <span class=\"string\">r#&quot;And then I said: &quot;There is no escape!&quot;&quot;#</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, quotes);</span><br><span class=\"line\"><span class=\"comment\">// 如果还是有歧义，可以继续增加，没有限制</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">longer_delimiter</span> = <span class=\"string\">r###&quot;A string with &quot;# in it. And even &quot;##!&quot;###</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, longer_delimiter);</span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"IB-Rust-enum元组","date":"2025-05-24T13:02:46.000Z","_content":"\n[Codes in lesson10](https://github.com/Zoella-w/IB-Rust/tree/main/10_enum)\n\n## 不同语言 enum 对比\n\n### typescript\n\n``` ts\nenum Direction {\n    North,\n    East,\n    South,\n    West\n}\nlet dir: Direction = Direction.North;\n```\n\n### c++\n\n``` c++\nenum Direction {\n    North,\n    East,\n    South,\n    West\n}\nint main() {\n    Direction dir = North;\n}\n```\n\n### rust\n\n``` rust\nenum Direction {\n    North,\n    East,\n    South,\n    West\n}\nlet dir: Direction = Direction::North;\n```\n\n## enum 语法\n\n### field-less enum\n\n只定义类型，但没有定义值\n\n``` rust\nenum Fieldless {\n    Tuple(),\n    Struct {},\n    Unit,\n}\n```\n\n### unit-only enum\n\n全都是 unit 类型\n\n``` rust\nenum UnitOnlyEnum {\n    Foo = 0,\n    Bar = 1,\n    Baz = 2,\n}\n```\n\n## enum 规范\n\n### Pascal Case\n\nenum 名和 enum 值采用 Pascal Case\n\n``` rust\nenum PascalCase {\n    PascalCase1,\n    PascalCase2,\n    PascalCase3,\n}\n```\n\n### snake_case\n\n函数或关联函数采用 snake_case\n\n``` rust\n// 方法\nimpl Pets {\n    // 入参是 mut 或 &mut\n    fn snake_case1(&self) {\n        println!(\"hi\");\n    }\n}\n// 关联函数\nimpl Pets {\n    fn snake_case2(name: String) {\n        println!(\"name is {name}\");\n    }\n}\n```\n\n## enum 用法\n\n### match\n\nmatch 必须能匹配所有条件\n\n``` rust\nenum Pets {\n    Cat,\n    Dog,\n}\nlet cat = Pets::Cat;\nlet dog = Pets::Dog;\nmatch cat {\n    Pets::Cat => {\n        println!(\"is cat\");\n    }\n    Pets::Dog => {\n        println!(\"is dog\");\n    }\n    _ => {}\n}\n```\n\n### if let\n\n``` rust\nif let cat = Pets::Cat {\n    println!(\"is cat\");\n}\n```\n\n## option & result\n\n### option\n\n- 表示一个值可能为 Some（存在）或 None（不存在）\n- 替代其他语言中的 null 或 undefined，强制开发者处理可能的空值\n\n``` rust\nlet num = Some(1);\nlet none: Option<usize> = None; // Option<T>\nmatch num {\n    Some(val) => {}\n    None => {}\n}\n```\n\n### result\n\n- 表示一个操作可能成功（Ok）或失败（Err）\n- 替代其他语言中的异常（Exception），强制开发者处理可能的错误\n\n``` rust\nfn main() -> Result<(), ()> {\n    let num: Result<usize, ()> = Ok(1);\n    match num {\n        Ok(val) => {}\n        Err(_) => {}\n    }\n    // Err(())\n    Ok(())\n}\n```\n\n## option 和 result 的转换\n\n### option -> result: `ok_or`\n\n当 Option 的 None 需要携带具体的错误信息时（例如在函数中需要返回 Result，但内部逻辑依赖 Option）\n\n``` rust\nlet opt: Option<i32> = Some(42);\nlet result: Result<i32, &str> = opt.ok_or(\"error\");\nlet none: Option<i32> = None;\nlet result: Result<i32, &str> = none.ok_or(\"error\");\n```\n\n### result -> option : `ok()`, `err()`\n\n当错误无关紧要，只需关注操作是否成功时（例如日志记录或快速判断）\n\n``` rust\nlet res: Result<i32, &str> = Ok(42);\nlet opt: Option<i32> = res.ok();\nlet res: Result<i32, &str> = Err(\"error\");\nlet opt: Option<i32> = res.ok();\n```\n\n## 常用 API\n\n### `Option` API\n\n#### `.map()` `.unwrap()`\n\n`map()` 对 Option 中的值应用一个闭包，返回一个新的布尔值 Option。若原 Option 是 None，直接返回 None\n\n`.unwrap()` 取值，如果是 None 则会 panic\n\n``` rust\nlet opt: Option<i32> = Some(1);\nlet a1 = opt.map(|num| num > 0); // Some(true)\nassert!(a1.unwrap()); // true\n```\n\n#### `.and_then()`\n\n`.and_then()` 对 Option 中的值应用一个闭包，闭包返回新的 Option，实现链式调用。若原 Option 是 None，直接返回 None\n\n``` rust\nlet opt: Option<i32> = Some(1);\nlet b1 = opt.and_then(|val| Some(val + 1)); // Some(2)\nassert_eq!(b1, Some(2));\n```\n\n#### `.or_else()`\n\n`.or_else()` 在 Option 为 None 时调用闭包生成一个替代的 Option。若原 Option 是 Some，直接返回原值\n\n``` rust\nlet opt: Option<i32> = Some(1);\nlet c1 = opt.or_else(|| Some(2)); // Some(1)；如果不是 Some，返回 Some(2)\nassert_eq!(c1, Some(1));\n```\n\n### Result API\n\n#### `.map()`\n\n`.map()` 对 Result 中的 Ok 值应用一个闭包，返回新的 Result。若原 Result 是 Err，直接返回原 Err\n\n``` rust\nlet ret: Result<i32, &str> = Ok(1);\nlet a2 = ret.map(|val| val > 0); // Ok(true)\nassert!(a2.unwrap()); // true\n```\n\n#### `.and_then()`\n\n`.and_then()` 对 Result 中的 Ok 值应用一个闭包，闭包返回新的 Result，实现链式调用。若原 Result 是 Err，直接返回原 Err\n\n``` rust\nlet ret: Result<i32, &str> = Ok(1);\nlet b2 = ret.and_then(|val| Ok((val + 1))); // Ok(2)\nassert_eq!(b2, Ok(2));\n```\n\n#### `.or_else()`\n\n`.or_else()` 在 Result 为 Err 时调用闭包生成一个替代的 Result。若原 Result 是 Ok，直接返回原值\n\n``` rust\nlet ret: Result<i32, &str> = Ok(1);\nlet c2 = ret.or_else(|str| Err(3)); // Ok(1)；如果不是 Ok，返回 Err(3)\nassert_eq!(c2, Ok(1));\n```\n\n## enum 内存占用\n\n每个 enum 包含标签（tag）​​和​​数据（data）​​两部分：\n- ​​标签​​：用于区分不同变体，大小取决于变体数量\n  - 比如：1 byte = 8 bits，能表示 2^8=256 个变体\n​- ​数据​​：存储变体中的具体值，大小由最大的变体决定\n  - 因为每次当枚举变量被赋值为某个变体时，只有该变体的数据会被写入内存，而旧数据会被销毁\n\n## 课后习题\n\n``` rust\nenum MyEnum {\n    A(u8, u8), // 2\n    B,\n    C {},\n}\n// 标签1，内存2\n// 1 + 2 = 3\nprintln!(\"size of MyEnum: {}\", size_of::<MyEnum>());\n\nenum EnumA {\n    A = 255,\n}\n// 当枚举只有一个变体时，Rust 编译器会将其优化为 ​​零大小类型（ZST）​​，即不占用任何内存\n// 即使显式指定判别值，判别值仅在 ​​编译时存在​​，不会在运行时存储\n// 标签0，内存0\nprintln!(\"size of EnumA: {}\", size_of::<EnumA>());\n\nenum EnumB {\n    A = 255,\n    B, // 256 -> 2\n}\n// 当定义枚举时，如果某个变体​​没有显式指定判别值（discriminant）​​\n// Rust 会默认将其判别值设为 ​​前一个变体的判别值加 1​​\n// 判别值的整数值直接用于标识变体，无需额外标签\n// 标签0，内存2\n// 0 + 2 = 2\nprintln!(\"size of EnumB: {}\", size_of::<EnumB>());\n```\n","source":"_posts/68-IB-Rust-enum元组.md","raw":"---\ntitle: IB-Rust-enum元组\ndate: 2025-05-24 21:02:46\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson10](https://github.com/Zoella-w/IB-Rust/tree/main/10_enum)\n\n## 不同语言 enum 对比\n\n### typescript\n\n``` ts\nenum Direction {\n    North,\n    East,\n    South,\n    West\n}\nlet dir: Direction = Direction.North;\n```\n\n### c++\n\n``` c++\nenum Direction {\n    North,\n    East,\n    South,\n    West\n}\nint main() {\n    Direction dir = North;\n}\n```\n\n### rust\n\n``` rust\nenum Direction {\n    North,\n    East,\n    South,\n    West\n}\nlet dir: Direction = Direction::North;\n```\n\n## enum 语法\n\n### field-less enum\n\n只定义类型，但没有定义值\n\n``` rust\nenum Fieldless {\n    Tuple(),\n    Struct {},\n    Unit,\n}\n```\n\n### unit-only enum\n\n全都是 unit 类型\n\n``` rust\nenum UnitOnlyEnum {\n    Foo = 0,\n    Bar = 1,\n    Baz = 2,\n}\n```\n\n## enum 规范\n\n### Pascal Case\n\nenum 名和 enum 值采用 Pascal Case\n\n``` rust\nenum PascalCase {\n    PascalCase1,\n    PascalCase2,\n    PascalCase3,\n}\n```\n\n### snake_case\n\n函数或关联函数采用 snake_case\n\n``` rust\n// 方法\nimpl Pets {\n    // 入参是 mut 或 &mut\n    fn snake_case1(&self) {\n        println!(\"hi\");\n    }\n}\n// 关联函数\nimpl Pets {\n    fn snake_case2(name: String) {\n        println!(\"name is {name}\");\n    }\n}\n```\n\n## enum 用法\n\n### match\n\nmatch 必须能匹配所有条件\n\n``` rust\nenum Pets {\n    Cat,\n    Dog,\n}\nlet cat = Pets::Cat;\nlet dog = Pets::Dog;\nmatch cat {\n    Pets::Cat => {\n        println!(\"is cat\");\n    }\n    Pets::Dog => {\n        println!(\"is dog\");\n    }\n    _ => {}\n}\n```\n\n### if let\n\n``` rust\nif let cat = Pets::Cat {\n    println!(\"is cat\");\n}\n```\n\n## option & result\n\n### option\n\n- 表示一个值可能为 Some（存在）或 None（不存在）\n- 替代其他语言中的 null 或 undefined，强制开发者处理可能的空值\n\n``` rust\nlet num = Some(1);\nlet none: Option<usize> = None; // Option<T>\nmatch num {\n    Some(val) => {}\n    None => {}\n}\n```\n\n### result\n\n- 表示一个操作可能成功（Ok）或失败（Err）\n- 替代其他语言中的异常（Exception），强制开发者处理可能的错误\n\n``` rust\nfn main() -> Result<(), ()> {\n    let num: Result<usize, ()> = Ok(1);\n    match num {\n        Ok(val) => {}\n        Err(_) => {}\n    }\n    // Err(())\n    Ok(())\n}\n```\n\n## option 和 result 的转换\n\n### option -> result: `ok_or`\n\n当 Option 的 None 需要携带具体的错误信息时（例如在函数中需要返回 Result，但内部逻辑依赖 Option）\n\n``` rust\nlet opt: Option<i32> = Some(42);\nlet result: Result<i32, &str> = opt.ok_or(\"error\");\nlet none: Option<i32> = None;\nlet result: Result<i32, &str> = none.ok_or(\"error\");\n```\n\n### result -> option : `ok()`, `err()`\n\n当错误无关紧要，只需关注操作是否成功时（例如日志记录或快速判断）\n\n``` rust\nlet res: Result<i32, &str> = Ok(42);\nlet opt: Option<i32> = res.ok();\nlet res: Result<i32, &str> = Err(\"error\");\nlet opt: Option<i32> = res.ok();\n```\n\n## 常用 API\n\n### `Option` API\n\n#### `.map()` `.unwrap()`\n\n`map()` 对 Option 中的值应用一个闭包，返回一个新的布尔值 Option。若原 Option 是 None，直接返回 None\n\n`.unwrap()` 取值，如果是 None 则会 panic\n\n``` rust\nlet opt: Option<i32> = Some(1);\nlet a1 = opt.map(|num| num > 0); // Some(true)\nassert!(a1.unwrap()); // true\n```\n\n#### `.and_then()`\n\n`.and_then()` 对 Option 中的值应用一个闭包，闭包返回新的 Option，实现链式调用。若原 Option 是 None，直接返回 None\n\n``` rust\nlet opt: Option<i32> = Some(1);\nlet b1 = opt.and_then(|val| Some(val + 1)); // Some(2)\nassert_eq!(b1, Some(2));\n```\n\n#### `.or_else()`\n\n`.or_else()` 在 Option 为 None 时调用闭包生成一个替代的 Option。若原 Option 是 Some，直接返回原值\n\n``` rust\nlet opt: Option<i32> = Some(1);\nlet c1 = opt.or_else(|| Some(2)); // Some(1)；如果不是 Some，返回 Some(2)\nassert_eq!(c1, Some(1));\n```\n\n### Result API\n\n#### `.map()`\n\n`.map()` 对 Result 中的 Ok 值应用一个闭包，返回新的 Result。若原 Result 是 Err，直接返回原 Err\n\n``` rust\nlet ret: Result<i32, &str> = Ok(1);\nlet a2 = ret.map(|val| val > 0); // Ok(true)\nassert!(a2.unwrap()); // true\n```\n\n#### `.and_then()`\n\n`.and_then()` 对 Result 中的 Ok 值应用一个闭包，闭包返回新的 Result，实现链式调用。若原 Result 是 Err，直接返回原 Err\n\n``` rust\nlet ret: Result<i32, &str> = Ok(1);\nlet b2 = ret.and_then(|val| Ok((val + 1))); // Ok(2)\nassert_eq!(b2, Ok(2));\n```\n\n#### `.or_else()`\n\n`.or_else()` 在 Result 为 Err 时调用闭包生成一个替代的 Result。若原 Result 是 Ok，直接返回原值\n\n``` rust\nlet ret: Result<i32, &str> = Ok(1);\nlet c2 = ret.or_else(|str| Err(3)); // Ok(1)；如果不是 Ok，返回 Err(3)\nassert_eq!(c2, Ok(1));\n```\n\n## enum 内存占用\n\n每个 enum 包含标签（tag）​​和​​数据（data）​​两部分：\n- ​​标签​​：用于区分不同变体，大小取决于变体数量\n  - 比如：1 byte = 8 bits，能表示 2^8=256 个变体\n​- ​数据​​：存储变体中的具体值，大小由最大的变体决定\n  - 因为每次当枚举变量被赋值为某个变体时，只有该变体的数据会被写入内存，而旧数据会被销毁\n\n## 课后习题\n\n``` rust\nenum MyEnum {\n    A(u8, u8), // 2\n    B,\n    C {},\n}\n// 标签1，内存2\n// 1 + 2 = 3\nprintln!(\"size of MyEnum: {}\", size_of::<MyEnum>());\n\nenum EnumA {\n    A = 255,\n}\n// 当枚举只有一个变体时，Rust 编译器会将其优化为 ​​零大小类型（ZST）​​，即不占用任何内存\n// 即使显式指定判别值，判别值仅在 ​​编译时存在​​，不会在运行时存储\n// 标签0，内存0\nprintln!(\"size of EnumA: {}\", size_of::<EnumA>());\n\nenum EnumB {\n    A = 255,\n    B, // 256 -> 2\n}\n// 当定义枚举时，如果某个变体​​没有显式指定判别值（discriminant）​​\n// Rust 会默认将其判别值设为 ​​前一个变体的判别值加 1​​\n// 判别值的整数值直接用于标识变体，无需额外标签\n// 标签0，内存2\n// 0 + 2 = 2\nprintln!(\"size of EnumB: {}\", size_of::<EnumB>());\n```\n","slug":"68-IB-Rust-enum元组","published":1,"updated":"2025-05-26T15:21:42.441Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb6c8z8y0000p9pr9jz459uf","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/10_enum\" >Codes in lesson10<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"不同语言-enum-对比\"><a href=\"#不同语言-enum-对比\" class=\"headerlink\" title=\"不同语言 enum 对比\"></a>不同语言 enum 对比</h2><h3 id=\"typescript\"><a href=\"#typescript\" class=\"headerlink\" title=\"typescript\"></a>typescript</h3><div class=\"code-container\" data-rel=\"Ts\"><figure class=\"iseeu highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Direction</span> &#123;</span><br><span class=\"line\">    <span class=\"title class_\">North</span>,</span><br><span class=\"line\">    <span class=\"title class_\">East</span>,</span><br><span class=\"line\">    <span class=\"title class_\">South</span>,</span><br><span class=\"line\">    <span class=\"title class_\">West</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">dir</span>: <span class=\"title class_\">Direction</span> = <span class=\"title class_\">Direction</span>.<span class=\"property\">North</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"c\"><a href=\"#c\" class=\"headerlink\" title=\"c++\"></a>c++</h3><div class=\"code-container\" data-rel=\"C++\"><figure class=\"iseeu highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Direction</span> &#123;</span><br><span class=\"line\">    North,</span><br><span class=\"line\">    East,</span><br><span class=\"line\">    South,</span><br><span class=\"line\">    West</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    Direction dir = North;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"rust\"><a href=\"#rust\" class=\"headerlink\" title=\"rust\"></a>rust</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Direction</span> &#123;</span><br><span class=\"line\">    North,</span><br><span class=\"line\">    East,</span><br><span class=\"line\">    South,</span><br><span class=\"line\">    West</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">dir</span>: Direction = Direction::North;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"enum-语法\"><a href=\"#enum-语法\" class=\"headerlink\" title=\"enum 语法\"></a>enum 语法</h2><h3 id=\"field-less-enum\"><a href=\"#field-less-enum\" class=\"headerlink\" title=\"field-less enum\"></a>field-less enum</h3><p>只定义类型，但没有定义值</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Fieldless</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Tuple</span>(),</span><br><span class=\"line\">    Struct &#123;&#125;,</span><br><span class=\"line\">    Unit,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"unit-only-enum\"><a href=\"#unit-only-enum\" class=\"headerlink\" title=\"unit-only enum\"></a>unit-only enum</h3><p>全都是 unit 类型</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">UnitOnlyEnum</span> &#123;</span><br><span class=\"line\">    Foo = <span class=\"number\">0</span>,</span><br><span class=\"line\">    Bar = <span class=\"number\">1</span>,</span><br><span class=\"line\">    Baz = <span class=\"number\">2</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"enum-规范\"><a href=\"#enum-规范\" class=\"headerlink\" title=\"enum 规范\"></a>enum 规范</h2><h3 id=\"Pascal-Case\"><a href=\"#Pascal-Case\" class=\"headerlink\" title=\"Pascal Case\"></a>Pascal Case</h3><p>enum 名和 enum 值采用 Pascal Case</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">PascalCase</span> &#123;</span><br><span class=\"line\">    PascalCase1,</span><br><span class=\"line\">    PascalCase2,</span><br><span class=\"line\">    PascalCase3,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"snake-case\"><a href=\"#snake-case\" class=\"headerlink\" title=\"snake_case\"></a>snake_case</h3><p>函数或关联函数采用 snake_case</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 方法</span></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Pets</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 入参是 mut 或 &amp;mut</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">snake_case1</span>(&amp;<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;hi&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 关联函数</span></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Pets</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">snake_case2</span>(name: <span class=\"type\">String</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;name is &#123;name&#125;&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"enum-用法\"><a href=\"#enum-用法\" class=\"headerlink\" title=\"enum 用法\"></a>enum 用法</h2><h3 id=\"match\"><a href=\"#match\" class=\"headerlink\" title=\"match\"></a>match</h3><p>match 必须能匹配所有条件</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Pets</span> &#123;</span><br><span class=\"line\">    Cat,</span><br><span class=\"line\">    Dog,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">cat</span> = Pets::Cat;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">dog</span> = Pets::Dog;</span><br><span class=\"line\"><span class=\"keyword\">match</span> cat &#123;</span><br><span class=\"line\">    Pets::Cat =&gt; &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;is cat&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Pets::Dog =&gt; &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;is dog&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    _ =&gt; &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"if-let\"><a href=\"#if-let\" class=\"headerlink\" title=\"if let\"></a>if let</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">cat</span> = Pets::Cat &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;is cat&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"option-result\"><a href=\"#option-result\" class=\"headerlink\" title=\"option &amp; result\"></a>option &amp; result</h2><h3 id=\"option\"><a href=\"#option\" class=\"headerlink\" title=\"option\"></a>option</h3><ul>\n<li>表示一个值可能为 Some（存在）或 None（不存在）</li>\n<li>替代其他语言中的 null 或 undefined，强制开发者处理可能的空值</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">num</span> = <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">none</span>: <span class=\"type\">Option</span>&lt;<span class=\"type\">usize</span>&gt; = <span class=\"literal\">None</span>; <span class=\"comment\">// Option&lt;T&gt;</span></span><br><span class=\"line\"><span class=\"keyword\">match</span> num &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Some</span>(val) =&gt; &#123;&#125;</span><br><span class=\"line\">    <span class=\"literal\">None</span> =&gt; &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"result\"><a href=\"#result\" class=\"headerlink\" title=\"result\"></a>result</h3><ul>\n<li>表示一个操作可能成功（Ok）或失败（Err）</li>\n<li>替代其他语言中的异常（Exception），强制开发者处理可能的错误</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;(), ()&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">num</span>: <span class=\"type\">Result</span>&lt;<span class=\"type\">usize</span>, ()&gt; = <span class=\"title function_ invoke__\">Ok</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">match</span> num &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(val) =&gt; &#123;&#125;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(_) =&gt; &#123;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// Err(())</span></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Ok</span>(())</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"option-和-result-的转换\"><a href=\"#option-和-result-的转换\" class=\"headerlink\" title=\"option 和 result 的转换\"></a>option 和 result 的转换</h2><h3 id=\"option-result-ok-or\"><a href=\"#option-result-ok-or\" class=\"headerlink\" title=\"option -&gt; result: ok_or\"></a>option -&gt; result: <code>ok_or</code></h3><p>当 Option 的 None 需要携带具体的错误信息时（例如在函数中需要返回 Result，但内部逻辑依赖 Option）</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">opt</span>: <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt; = <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">42</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">result</span>: <span class=\"type\">Result</span>&lt;<span class=\"type\">i32</span>, &amp;<span class=\"type\">str</span>&gt; = opt.<span class=\"title function_ invoke__\">ok_or</span>(<span class=\"string\">&quot;error&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">none</span>: <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt; = <span class=\"literal\">None</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">result</span>: <span class=\"type\">Result</span>&lt;<span class=\"type\">i32</span>, &amp;<span class=\"type\">str</span>&gt; = none.<span class=\"title function_ invoke__\">ok_or</span>(<span class=\"string\">&quot;error&quot;</span>);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"result-option-ok-err\"><a href=\"#result-option-ok-err\" class=\"headerlink\" title=\"result -&gt; option : ok(), err()\"></a>result -&gt; option : <code>ok()</code>, <code>err()</code></h3><p>当错误无关紧要，只需关注操作是否成功时（例如日志记录或快速判断）</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">res</span>: <span class=\"type\">Result</span>&lt;<span class=\"type\">i32</span>, &amp;<span class=\"type\">str</span>&gt; = <span class=\"title function_ invoke__\">Ok</span>(<span class=\"number\">42</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">opt</span>: <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt; = res.<span class=\"title function_ invoke__\">ok</span>();</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">res</span>: <span class=\"type\">Result</span>&lt;<span class=\"type\">i32</span>, &amp;<span class=\"type\">str</span>&gt; = <span class=\"title function_ invoke__\">Err</span>(<span class=\"string\">&quot;error&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">opt</span>: <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt; = res.<span class=\"title function_ invoke__\">ok</span>();</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"常用-API\"><a href=\"#常用-API\" class=\"headerlink\" title=\"常用 API\"></a>常用 API</h2><h3 id=\"Option-API\"><a href=\"#Option-API\" class=\"headerlink\" title=\"Option API\"></a><code>Option</code> API</h3><h4 id=\"map-unwrap\"><a href=\"#map-unwrap\" class=\"headerlink\" title=\".map() .unwrap()\"></a><code>.map()</code> <code>.unwrap()</code></h4><p><code>map()</code> 对 Option 中的值应用一个闭包，返回一个新的布尔值 Option。若原 Option 是 None，直接返回 None</p>\n<p><code>.unwrap()</code> 取值，如果是 None 则会 panic</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">opt</span>: <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt; = <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">a1</span> = opt.<span class=\"title function_ invoke__\">map</span>(|num| num &gt; <span class=\"number\">0</span>); <span class=\"comment\">// Some(true)</span></span><br><span class=\"line\"><span class=\"built_in\">assert!</span>(a1.<span class=\"title function_ invoke__\">unwrap</span>()); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"and-then\"><a href=\"#and-then\" class=\"headerlink\" title=\".and_then()\"></a><code>.and_then()</code></h4><p><code>.and_then()</code> 对 Option 中的值应用一个闭包，闭包返回新的 Option，实现链式调用。若原 Option 是 None，直接返回 None</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">opt</span>: <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt; = <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">b1</span> = opt.<span class=\"title function_ invoke__\">and_then</span>(|val| <span class=\"title function_ invoke__\">Some</span>(val + <span class=\"number\">1</span>)); <span class=\"comment\">// Some(2)</span></span><br><span class=\"line\"><span class=\"built_in\">assert_eq!</span>(b1, <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">2</span>));</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"or-else\"><a href=\"#or-else\" class=\"headerlink\" title=\".or_else()\"></a><code>.or_else()</code></h4><p><code>.or_else()</code> 在 Option 为 None 时调用闭包生成一个替代的 Option。若原 Option 是 Some，直接返回原值</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">opt</span>: <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt; = <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">c1</span> = opt.<span class=\"title function_ invoke__\">or_else</span>(|| <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">2</span>)); <span class=\"comment\">// Some(1)；如果不是 Some，返回 Some(2)</span></span><br><span class=\"line\"><span class=\"built_in\">assert_eq!</span>(c1, <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">1</span>));</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"Result-API\"><a href=\"#Result-API\" class=\"headerlink\" title=\"Result API\"></a>Result API</h3><h4 id=\"map\"><a href=\"#map\" class=\"headerlink\" title=\".map()\"></a><code>.map()</code></h4><p><code>.map()</code> 对 Result 中的 Ok 值应用一个闭包，返回新的 Result。若原 Result 是 Err，直接返回原 Err</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">ret</span>: <span class=\"type\">Result</span>&lt;<span class=\"type\">i32</span>, &amp;<span class=\"type\">str</span>&gt; = <span class=\"title function_ invoke__\">Ok</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">a2</span> = ret.<span class=\"title function_ invoke__\">map</span>(|val| val &gt; <span class=\"number\">0</span>); <span class=\"comment\">// Ok(true)</span></span><br><span class=\"line\"><span class=\"built_in\">assert!</span>(a2.<span class=\"title function_ invoke__\">unwrap</span>()); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"and-then-1\"><a href=\"#and-then-1\" class=\"headerlink\" title=\".and_then()\"></a><code>.and_then()</code></h4><p><code>.and_then()</code> 对 Result 中的 Ok 值应用一个闭包，闭包返回新的 Result，实现链式调用。若原 Result 是 Err，直接返回原 Err</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">ret</span>: <span class=\"type\">Result</span>&lt;<span class=\"type\">i32</span>, &amp;<span class=\"type\">str</span>&gt; = <span class=\"title function_ invoke__\">Ok</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">b2</span> = ret.<span class=\"title function_ invoke__\">and_then</span>(|val| <span class=\"title function_ invoke__\">Ok</span>((val + <span class=\"number\">1</span>))); <span class=\"comment\">// Ok(2)</span></span><br><span class=\"line\"><span class=\"built_in\">assert_eq!</span>(b2, <span class=\"title function_ invoke__\">Ok</span>(<span class=\"number\">2</span>));</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"or-else-1\"><a href=\"#or-else-1\" class=\"headerlink\" title=\".or_else()\"></a><code>.or_else()</code></h4><p><code>.or_else()</code> 在 Result 为 Err 时调用闭包生成一个替代的 Result。若原 Result 是 Ok，直接返回原值</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">ret</span>: <span class=\"type\">Result</span>&lt;<span class=\"type\">i32</span>, &amp;<span class=\"type\">str</span>&gt; = <span class=\"title function_ invoke__\">Ok</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">c2</span> = ret.<span class=\"title function_ invoke__\">or_else</span>(|<span class=\"type\">str</span>| <span class=\"title function_ invoke__\">Err</span>(<span class=\"number\">3</span>)); <span class=\"comment\">// Ok(1)；如果不是 Ok，返回 Err(3)</span></span><br><span class=\"line\"><span class=\"built_in\">assert_eq!</span>(c2, <span class=\"title function_ invoke__\">Ok</span>(<span class=\"number\">1</span>));</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"enum-内存占用\"><a href=\"#enum-内存占用\" class=\"headerlink\" title=\"enum 内存占用\"></a>enum 内存占用</h2><p>每个 enum 包含标签（tag）​​和​​数据（data）​​两部分：</p>\n<ul>\n<li>​​标签​​：用于区分不同变体，大小取决于变体数量<ul>\n<li>比如：1 byte &#x3D; 8 bits，能表示 2^8&#x3D;256 个变体<br>​- ​数据​​：存储变体中的具体值，大小由最大的变体决定</li>\n<li>因为每次当枚举变量被赋值为某个变体时，只有该变体的数据会被写入内存，而旧数据会被销毁</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"课后习题\"><a href=\"#课后习题\" class=\"headerlink\" title=\"课后习题\"></a>课后习题</h2><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">MyEnum</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">A</span>(<span class=\"type\">u8</span>, <span class=\"type\">u8</span>), <span class=\"comment\">// 2</span></span><br><span class=\"line\">    B,</span><br><span class=\"line\">    C &#123;&#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 标签1，内存2</span></span><br><span class=\"line\"><span class=\"comment\">// 1 + 2 = 3</span></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;size of MyEnum: &#123;&#125;&quot;</span>, size_of::&lt;MyEnum&gt;());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">EnumA</span> &#123;</span><br><span class=\"line\">    A = <span class=\"number\">255</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 当枚举只有一个变体时，Rust 编译器会将其优化为 ​​零大小类型（ZST）​​，即不占用任何内存</span></span><br><span class=\"line\"><span class=\"comment\">// 即使显式指定判别值，判别值仅在 ​​编译时存在​​，不会在运行时存储</span></span><br><span class=\"line\"><span class=\"comment\">// 标签0，内存0</span></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;size of EnumA: &#123;&#125;&quot;</span>, size_of::&lt;EnumA&gt;());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">EnumB</span> &#123;</span><br><span class=\"line\">    A = <span class=\"number\">255</span>,</span><br><span class=\"line\">    B, <span class=\"comment\">// 256 -&gt; 2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 当定义枚举时，如果某个变体​​没有显式指定判别值（discriminant）​​</span></span><br><span class=\"line\"><span class=\"comment\">// Rust 会默认将其判别值设为 ​​前一个变体的判别值加 1​​</span></span><br><span class=\"line\"><span class=\"comment\">// 判别值的整数值直接用于标识变体，无需额外标签</span></span><br><span class=\"line\"><span class=\"comment\">// 标签0，内存2</span></span><br><span class=\"line\"><span class=\"comment\">// 0 + 2 = 2</span></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;size of EnumB: &#123;&#125;&quot;</span>, size_of::&lt;EnumB&gt;());</span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/10_enum\" >Codes in lesson10<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"不同语言-enum-对比\"><a href=\"#不同语言-enum-对比\" class=\"headerlink\" title=\"不同语言 enum 对比\"></a>不同语言 enum 对比</h2><h3 id=\"typescript\"><a href=\"#typescript\" class=\"headerlink\" title=\"typescript\"></a>typescript</h3><figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Direction</span> &#123;</span><br><span class=\"line\">    <span class=\"title class_\">North</span>,</span><br><span class=\"line\">    <span class=\"title class_\">East</span>,</span><br><span class=\"line\">    <span class=\"title class_\">South</span>,</span><br><span class=\"line\">    <span class=\"title class_\">West</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">dir</span>: <span class=\"title class_\">Direction</span> = <span class=\"title class_\">Direction</span>.<span class=\"property\">North</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"c\"><a href=\"#c\" class=\"headerlink\" title=\"c++\"></a>c++</h3><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Direction</span> &#123;</span><br><span class=\"line\">    North,</span><br><span class=\"line\">    East,</span><br><span class=\"line\">    South,</span><br><span class=\"line\">    West</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    Direction dir = North;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"rust\"><a href=\"#rust\" class=\"headerlink\" title=\"rust\"></a>rust</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Direction</span> &#123;</span><br><span class=\"line\">    North,</span><br><span class=\"line\">    East,</span><br><span class=\"line\">    South,</span><br><span class=\"line\">    West</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">dir</span>: Direction = Direction::North;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"enum-语法\"><a href=\"#enum-语法\" class=\"headerlink\" title=\"enum 语法\"></a>enum 语法</h2><h3 id=\"field-less-enum\"><a href=\"#field-less-enum\" class=\"headerlink\" title=\"field-less enum\"></a>field-less enum</h3><p>只定义类型，但没有定义值</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Fieldless</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Tuple</span>(),</span><br><span class=\"line\">    Struct &#123;&#125;,</span><br><span class=\"line\">    Unit,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"unit-only-enum\"><a href=\"#unit-only-enum\" class=\"headerlink\" title=\"unit-only enum\"></a>unit-only enum</h3><p>全都是 unit 类型</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">UnitOnlyEnum</span> &#123;</span><br><span class=\"line\">    Foo = <span class=\"number\">0</span>,</span><br><span class=\"line\">    Bar = <span class=\"number\">1</span>,</span><br><span class=\"line\">    Baz = <span class=\"number\">2</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"enum-规范\"><a href=\"#enum-规范\" class=\"headerlink\" title=\"enum 规范\"></a>enum 规范</h2><h3 id=\"Pascal-Case\"><a href=\"#Pascal-Case\" class=\"headerlink\" title=\"Pascal Case\"></a>Pascal Case</h3><p>enum 名和 enum 值采用 Pascal Case</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">PascalCase</span> &#123;</span><br><span class=\"line\">    PascalCase1,</span><br><span class=\"line\">    PascalCase2,</span><br><span class=\"line\">    PascalCase3,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"snake-case\"><a href=\"#snake-case\" class=\"headerlink\" title=\"snake_case\"></a>snake_case</h3><p>函数或关联函数采用 snake_case</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 方法</span></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Pets</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 入参是 mut 或 &amp;mut</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">snake_case1</span>(&amp;<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;hi&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 关联函数</span></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Pets</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">snake_case2</span>(name: <span class=\"type\">String</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;name is &#123;name&#125;&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"enum-用法\"><a href=\"#enum-用法\" class=\"headerlink\" title=\"enum 用法\"></a>enum 用法</h2><h3 id=\"match\"><a href=\"#match\" class=\"headerlink\" title=\"match\"></a>match</h3><p>match 必须能匹配所有条件</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Pets</span> &#123;</span><br><span class=\"line\">    Cat,</span><br><span class=\"line\">    Dog,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">cat</span> = Pets::Cat;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">dog</span> = Pets::Dog;</span><br><span class=\"line\"><span class=\"keyword\">match</span> cat &#123;</span><br><span class=\"line\">    Pets::Cat =&gt; &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;is cat&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Pets::Dog =&gt; &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;is dog&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    _ =&gt; &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"if-let\"><a href=\"#if-let\" class=\"headerlink\" title=\"if let\"></a>if let</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">cat</span> = Pets::Cat &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;is cat&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"option-result\"><a href=\"#option-result\" class=\"headerlink\" title=\"option &amp; result\"></a>option &amp; result</h2><h3 id=\"option\"><a href=\"#option\" class=\"headerlink\" title=\"option\"></a>option</h3><ul>\n<li>表示一个值可能为 Some（存在）或 None（不存在）</li>\n<li>替代其他语言中的 null 或 undefined，强制开发者处理可能的空值</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">num</span> = <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">none</span>: <span class=\"type\">Option</span>&lt;<span class=\"type\">usize</span>&gt; = <span class=\"literal\">None</span>; <span class=\"comment\">// Option&lt;T&gt;</span></span><br><span class=\"line\"><span class=\"keyword\">match</span> num &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Some</span>(val) =&gt; &#123;&#125;</span><br><span class=\"line\">    <span class=\"literal\">None</span> =&gt; &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"result\"><a href=\"#result\" class=\"headerlink\" title=\"result\"></a>result</h3><ul>\n<li>表示一个操作可能成功（Ok）或失败（Err）</li>\n<li>替代其他语言中的异常（Exception），强制开发者处理可能的错误</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;(), ()&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">num</span>: <span class=\"type\">Result</span>&lt;<span class=\"type\">usize</span>, ()&gt; = <span class=\"title function_ invoke__\">Ok</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">match</span> num &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(val) =&gt; &#123;&#125;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(_) =&gt; &#123;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// Err(())</span></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Ok</span>(())</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"option-和-result-的转换\"><a href=\"#option-和-result-的转换\" class=\"headerlink\" title=\"option 和 result 的转换\"></a>option 和 result 的转换</h2><h3 id=\"option-result-ok-or\"><a href=\"#option-result-ok-or\" class=\"headerlink\" title=\"option -&gt; result: ok_or\"></a>option -&gt; result: <code>ok_or</code></h3><p>当 Option 的 None 需要携带具体的错误信息时（例如在函数中需要返回 Result，但内部逻辑依赖 Option）</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">opt</span>: <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt; = <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">42</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">result</span>: <span class=\"type\">Result</span>&lt;<span class=\"type\">i32</span>, &amp;<span class=\"type\">str</span>&gt; = opt.<span class=\"title function_ invoke__\">ok_or</span>(<span class=\"string\">&quot;error&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">none</span>: <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt; = <span class=\"literal\">None</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">result</span>: <span class=\"type\">Result</span>&lt;<span class=\"type\">i32</span>, &amp;<span class=\"type\">str</span>&gt; = none.<span class=\"title function_ invoke__\">ok_or</span>(<span class=\"string\">&quot;error&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"result-option-ok-err\"><a href=\"#result-option-ok-err\" class=\"headerlink\" title=\"result -&gt; option : ok(), err()\"></a>result -&gt; option : <code>ok()</code>, <code>err()</code></h3><p>当错误无关紧要，只需关注操作是否成功时（例如日志记录或快速判断）</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">res</span>: <span class=\"type\">Result</span>&lt;<span class=\"type\">i32</span>, &amp;<span class=\"type\">str</span>&gt; = <span class=\"title function_ invoke__\">Ok</span>(<span class=\"number\">42</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">opt</span>: <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt; = res.<span class=\"title function_ invoke__\">ok</span>();</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">res</span>: <span class=\"type\">Result</span>&lt;<span class=\"type\">i32</span>, &amp;<span class=\"type\">str</span>&gt; = <span class=\"title function_ invoke__\">Err</span>(<span class=\"string\">&quot;error&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">opt</span>: <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt; = res.<span class=\"title function_ invoke__\">ok</span>();</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"常用-API\"><a href=\"#常用-API\" class=\"headerlink\" title=\"常用 API\"></a>常用 API</h2><h3 id=\"Option-API\"><a href=\"#Option-API\" class=\"headerlink\" title=\"Option API\"></a><code>Option</code> API</h3><h4 id=\"map-unwrap\"><a href=\"#map-unwrap\" class=\"headerlink\" title=\".map() .unwrap()\"></a><code>.map()</code> <code>.unwrap()</code></h4><p><code>map()</code> 对 Option 中的值应用一个闭包，返回一个新的布尔值 Option。若原 Option 是 None，直接返回 None</p>\n<p><code>.unwrap()</code> 取值，如果是 None 则会 panic</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">opt</span>: <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt; = <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">a1</span> = opt.<span class=\"title function_ invoke__\">map</span>(|num| num &gt; <span class=\"number\">0</span>); <span class=\"comment\">// Some(true)</span></span><br><span class=\"line\"><span class=\"built_in\">assert!</span>(a1.<span class=\"title function_ invoke__\">unwrap</span>()); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"and-then\"><a href=\"#and-then\" class=\"headerlink\" title=\".and_then()\"></a><code>.and_then()</code></h4><p><code>.and_then()</code> 对 Option 中的值应用一个闭包，闭包返回新的 Option，实现链式调用。若原 Option 是 None，直接返回 None</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">opt</span>: <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt; = <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">b1</span> = opt.<span class=\"title function_ invoke__\">and_then</span>(|val| <span class=\"title function_ invoke__\">Some</span>(val + <span class=\"number\">1</span>)); <span class=\"comment\">// Some(2)</span></span><br><span class=\"line\"><span class=\"built_in\">assert_eq!</span>(b1, <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">2</span>));</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"or-else\"><a href=\"#or-else\" class=\"headerlink\" title=\".or_else()\"></a><code>.or_else()</code></h4><p><code>.or_else()</code> 在 Option 为 None 时调用闭包生成一个替代的 Option。若原 Option 是 Some，直接返回原值</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">opt</span>: <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt; = <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">c1</span> = opt.<span class=\"title function_ invoke__\">or_else</span>(|| <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">2</span>)); <span class=\"comment\">// Some(1)；如果不是 Some，返回 Some(2)</span></span><br><span class=\"line\"><span class=\"built_in\">assert_eq!</span>(c1, <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">1</span>));</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Result-API\"><a href=\"#Result-API\" class=\"headerlink\" title=\"Result API\"></a>Result API</h3><h4 id=\"map\"><a href=\"#map\" class=\"headerlink\" title=\".map()\"></a><code>.map()</code></h4><p><code>.map()</code> 对 Result 中的 Ok 值应用一个闭包，返回新的 Result。若原 Result 是 Err，直接返回原 Err</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">ret</span>: <span class=\"type\">Result</span>&lt;<span class=\"type\">i32</span>, &amp;<span class=\"type\">str</span>&gt; = <span class=\"title function_ invoke__\">Ok</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">a2</span> = ret.<span class=\"title function_ invoke__\">map</span>(|val| val &gt; <span class=\"number\">0</span>); <span class=\"comment\">// Ok(true)</span></span><br><span class=\"line\"><span class=\"built_in\">assert!</span>(a2.<span class=\"title function_ invoke__\">unwrap</span>()); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"and-then-1\"><a href=\"#and-then-1\" class=\"headerlink\" title=\".and_then()\"></a><code>.and_then()</code></h4><p><code>.and_then()</code> 对 Result 中的 Ok 值应用一个闭包，闭包返回新的 Result，实现链式调用。若原 Result 是 Err，直接返回原 Err</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">ret</span>: <span class=\"type\">Result</span>&lt;<span class=\"type\">i32</span>, &amp;<span class=\"type\">str</span>&gt; = <span class=\"title function_ invoke__\">Ok</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">b2</span> = ret.<span class=\"title function_ invoke__\">and_then</span>(|val| <span class=\"title function_ invoke__\">Ok</span>((val + <span class=\"number\">1</span>))); <span class=\"comment\">// Ok(2)</span></span><br><span class=\"line\"><span class=\"built_in\">assert_eq!</span>(b2, <span class=\"title function_ invoke__\">Ok</span>(<span class=\"number\">2</span>));</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"or-else-1\"><a href=\"#or-else-1\" class=\"headerlink\" title=\".or_else()\"></a><code>.or_else()</code></h4><p><code>.or_else()</code> 在 Result 为 Err 时调用闭包生成一个替代的 Result。若原 Result 是 Ok，直接返回原值</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">ret</span>: <span class=\"type\">Result</span>&lt;<span class=\"type\">i32</span>, &amp;<span class=\"type\">str</span>&gt; = <span class=\"title function_ invoke__\">Ok</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">c2</span> = ret.<span class=\"title function_ invoke__\">or_else</span>(|<span class=\"type\">str</span>| <span class=\"title function_ invoke__\">Err</span>(<span class=\"number\">3</span>)); <span class=\"comment\">// Ok(1)；如果不是 Ok，返回 Err(3)</span></span><br><span class=\"line\"><span class=\"built_in\">assert_eq!</span>(c2, <span class=\"title function_ invoke__\">Ok</span>(<span class=\"number\">1</span>));</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"enum-内存占用\"><a href=\"#enum-内存占用\" class=\"headerlink\" title=\"enum 内存占用\"></a>enum 内存占用</h2><p>每个 enum 包含标签（tag）​​和​​数据（data）​​两部分：</p>\n<ul>\n<li>​​标签​​：用于区分不同变体，大小取决于变体数量<ul>\n<li>比如：1 byte &#x3D; 8 bits，能表示 2^8&#x3D;256 个变体<br>​- ​数据​​：存储变体中的具体值，大小由最大的变体决定</li>\n<li>因为每次当枚举变量被赋值为某个变体时，只有该变体的数据会被写入内存，而旧数据会被销毁</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"课后习题\"><a href=\"#课后习题\" class=\"headerlink\" title=\"课后习题\"></a>课后习题</h2><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">MyEnum</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">A</span>(<span class=\"type\">u8</span>, <span class=\"type\">u8</span>), <span class=\"comment\">// 2</span></span><br><span class=\"line\">    B,</span><br><span class=\"line\">    C &#123;&#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 标签1，内存2</span></span><br><span class=\"line\"><span class=\"comment\">// 1 + 2 = 3</span></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;size of MyEnum: &#123;&#125;&quot;</span>, size_of::&lt;MyEnum&gt;());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">EnumA</span> &#123;</span><br><span class=\"line\">    A = <span class=\"number\">255</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 当枚举只有一个变体时，Rust 编译器会将其优化为 ​​零大小类型（ZST）​​，即不占用任何内存</span></span><br><span class=\"line\"><span class=\"comment\">// 即使显式指定判别值，判别值仅在 ​​编译时存在​​，不会在运行时存储</span></span><br><span class=\"line\"><span class=\"comment\">// 标签0，内存0</span></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;size of EnumA: &#123;&#125;&quot;</span>, size_of::&lt;EnumA&gt;());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">EnumB</span> &#123;</span><br><span class=\"line\">    A = <span class=\"number\">255</span>,</span><br><span class=\"line\">    B, <span class=\"comment\">// 256 -&gt; 2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 当定义枚举时，如果某个变体​​没有显式指定判别值（discriminant）​​</span></span><br><span class=\"line\"><span class=\"comment\">// Rust 会默认将其判别值设为 ​​前一个变体的判别值加 1​​</span></span><br><span class=\"line\"><span class=\"comment\">// 判别值的整数值直接用于标识变体，无需额外标签</span></span><br><span class=\"line\"><span class=\"comment\">// 标签0，内存2</span></span><br><span class=\"line\"><span class=\"comment\">// 0 + 2 = 2</span></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;size of EnumB: &#123;&#125;&quot;</span>, size_of::&lt;EnumB&gt;());</span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"IB-Rust-结构体","date":"2025-05-26T15:22:16.000Z","_content":"\n[Codes in lesson11](https://github.com/Zoella-w/IB-Rust/tree/main/11_struct)\n\n\n## 普通结构体\n\n### 定义结构体\n\n- 结构体的定义的位置没有要求，实例化的作用域在定义的范围内即可\n- 大括号中，定义每一部分数据的名字和类型，称为字段（field）\n\n```rust\nstruct User {\n    active: bool,\n    username: String,\n    email: String,\n    sign_in_count: u64,\n}\n```\n\n### 创建结构体实例\n\n初始化实例时，每个字段都需要进行初始化，没有初始值\n\n```rust\nlet user1 = User {\n    email: String::from(\"someone@example.com\"),\n    username: String::from(\"someusername123\"),\n    active: true,\n    sign_in_count: 1,\n};\n```\n\n#### 使用字段初始化简写语法\n\n变量名与字段名完全相同（类似 js）\n\n```rust\nlet email = String::from(\"someone@example.com\");\nlet username = String::from(\"someusername123\");\n\nlet user1 = User {\n    email,\n    username,\n    active: true,\n    sign_in_count: 1,\n};\n```\n\n#### 从其他实例创建实例\n\n- 结构体更新语法允许从一个实例中创建一个新实例，同时保留部分字段值\n- 最后没有逗号\n\n```rust\nlet user2 = User {\n    email: String::from(\"another@example.com\"),\n    active: user1.active,\n    username: user1.username,\n    sign_in_count: user1.sign_in_count,\n};\n```\n\n```rust\nlet user2 = User {\n    email: String::from(\"another@example.com\"),\n    ..user1 // 简写\n};\n```\n\n### 修改结构体字段（可变性）\n\n整个实例必须是可变的，不允许只将某个字段标记为可变\n\n```rust\nlet mut user1 = User {\n    email: String::from(\"someone@example.com\"),\n    username: String::from(\"someusername123\"),\n    active: true,\n    sign_in_count: 1,\n};\nuser1.email = String::from(\"anotheremail@example.com\");\n```\n\n## 特殊的结构体\n\n- 元组结构体（Tuple Struct）\n- 单元结构体（Unit-like Struct）\n\n### 元组结构体\n\n字段没有名称的结构体，这种结构体长得像元组，因此被称为元组结构体\n\n例如 `Point` 元组结构体，是 `(x, y, z)` 形式的坐标点\n\n- 使用 `struct` 关键字，接着是圆括号，然后是各字段类型\n- 实例化时使用圆括号\n\n```rust\nstruct Color(i32, i32, i32);\nstruct Point(i32, i32, i32);\nlet black = Color(0, 0, 0); // 访问\nlet origin = Point(0, 0, 0);\n```\n\n### 单元结构体\n\n如果定义一个类型，但是不关心该类型的内容, 只关心其行为时，就可以使用 `单元结构体`\n\n- 使用 `struct` 关键字，接着是名称\n- 实例化不需要花括号或圆括号\n\n```rust\nstruct AlwaysEqual;\nlet subject = AlwaysEqual;\n// 不关心 AlwaysEqual 的字段数据，只关心其行为\n// 因此将它声明为单元结构体，然后再为它实现某个特征\nimpl SomeTrait for AlwaysEqual { }\n```\n\n## 所有权\n\n### 实现 Copy 特征的类型\n\n实现了 Copy 特征的类型无需所有权转移，可以直接在赋值时进行数据拷贝\n\n```rust\nfn main() {\n    let user1 = User {\n        email: String::from(\"someone@example.com\"),\n        username: String::from(\"someusername123\"),\n        active: true,\n        sign_in_count: 1,\n    };\n    let active = user1.active;\n    println!(\"{}\", user1.active); // true\n    print_username(user1); // someusername123\n}\nfn print_username(user: User) {\n    println!(\"{}\", user.username);\n}\n```\n\n### 没有实现 Copy 特征的类型\n\n- 字段所有权发生了移动，但其他字段不受影响\n- 结构体整体也无法再被使用\n- 结构体更新语法同样适用\n\n```rust\nfn main() {\n    let user1 = User {\n        email: String::from(\"someone@example.com\"),\n        username: String::from(\"someusername123\"),\n        active: true,\n        sign_in_count: 1,\n    };\n    let name = user1.username;\n    println!(\"{}\", user1.email); // someone@example.com\n    println!(\"{}\", user1.username); // error\n    print_username(user1); // error \n}\nfn print_username(user: User) {\n    println!(\"{}\", user.username);\n}\n```\n\n### 结构体更新语法\n\n```rust\nfn main() {\n    let user1 = User {\n        email: String::from(\"someone@example.com\"),\n        username: String::from(\"someusername123\"),\n        active: true,\n        sign_in_count: 1,\n    };\n    let user2 = User {\n        email: String::from(\"another@example.com\"),\n        ..user1\n    };\n    // let user2 = User {\n    //     email: String::from(\"another@example.com\"),\n\n    //     active: user1.active,\n    //     username: user1.username,\n    //     sign_in_count: user1.sign_in_count,\n    // };\n    println!(\"{}\",user1.active);\n    println!(\"{}\",user1.username); // 报错\n    print_username(user1); // 报错\n}\nfn print_username(user: User) {\n    println!(\"{}\", user.username);\n}\n```\n\n### 结构体中的借用\n\n可以让 `User` 结构体从其它对象借用数据，不过需要引入生命周期\n\n生命周期能确保结构体的作用范围要比它所借用的数据的作用范围要小\n\n```rust\nstruct User<'a> {\n    username: &'a str,\n    email: &'a str,\n    sign_in_count: u64,\n    active: bool,\n}\nlet user1 = User {\n    email: \"someone@example.com\",\n    username: \"someusername123\",\n    active: true,\n    sign_in_count: 1,\n};\n```\n\n## 方法\n\n### 定义方法\n\n方法与函数不同，方法的第一个参数是 `self`，代表调用该方法的结构体实例\n\n```rust\n#[derive(Debug)]\nstruct Rectangle {\n    width: u32,\n    height: u32,\n}\nimpl Rectangle {\n    fn area(&self) -> u32 {\n        self.width * self.height\n    }\n}\nfn main() {\n    let rect1 = Rectangle { width: 30, height: 50 };\n}\n```\n\n一般使用 `&self` 替代 \n-  `self: &Self`\n- `rectangle: &Rectangle`\n\n```rust\nimpl Rectangle {\n    fn area(&self) -> u32 {\n        self.width * self.height\n    }\n    // fn area(self: &Self) -> u32 {\n    //     self.width * self.height\n    // }\n    // fn area(self: &Rectangle) -> u32 {\n    //     self.width * self.height\n    // }\n}\n\n```\n\n---\n\n`self` 依然有所有权的概念：\n\n- `self` 表示 `Rectangle` 的所有权转移到该方法中，这种形式较少\n- `&self` 表示对 `Rectangle` 的不可变借用\n- `&mut self` 表示可变借用\n\n#### 方法名跟结构体字段名相同\n\n在外部的包里，用户只能通过方法获取字段，而不能直接访问，作用类似 getter\n\n```rust\npub struct Rectangle {\n    width: u32,\n    height: u32,\n}\nimpl Rectangle {\n    // getter\n    pub fn width(&self) -> bool {\n        self.width > 0\n    }\n}\nfn main() {\n    let rect1 = Rectangle {\n        width: 30,\n        height: 50,\n    };\n    if rect1.width() {\n        println!(\"The rectangle has a nonzero width; it is {}\", rect1.width);\n    }\n}\n```\n\n### 关联函数\n\n在 `impl` 块中定义的函数被称为**关联函数**（associated functions），因为它们与 `impl` 后面命名的类型相关\n\n在 `String` 类型上定义的 `String::from()` 也是这样的函数\n\n- 关联函数没有 `self`\n- 不能用 `.` 的方式来调用，需要用 `::` 来调用，例如 `let sq = Rectangle::new(3, 3);`\n- 一般使用 `new` 来作为构造器的名称\n\n```rust\npub struct Rectangle {\n    width: u32,\n    height: u32,\n}\nimpl Rectangle {\n    fn new(width: u32, height: u32) -> Rectangle {\n        Rectangle { width, height }\n    }\n}\nfn main() {\n    let rect1 = Rectangle::new(30, 50);\n}\n```\n\n### 多个 impl 定义\n\n允许为一个结构体定义多个 `impl` 块，目的是提供更多的灵活性和代码组织性\n\n```rust\nimpl Rectangle {\n    fn area(&self) -> u32 {\n        self.width * self.height\n    }\n}\nimpl Rectangle {\n    fn can_hold(&self, other: &Rectangle) -> bool {\n        self.width > other.width && self.height > other.height\n    }\n}\n```\n\n## 实现trait\n\n### 为类型实现特征\n\n如果不同的类型具有相同的行为，可以定义一个特征，然后为这些类型实现该特征\n\n**定义特征**是把一些方法组合在一起，目的是定义一个实现某些目标所必需的行为的集合\n\n```rust\ntrait Shape {\n    fn area(&self) -> f64;\n}\n#[derive(Debug)]\nstruct Rectangle {\n    width: u32,\n    height: u32,\n}\nimpl Shape for Rectangle {\n    fn area(&self) -> f64 {\n        (self.width * self.height) as f64\n    }\n}\nfn print_area(shape: &impl Shape) {\n    println!(\"{}\", shape.area());\n}\n```\n\n## 打印结构体的信息\n\n### ❌ println!(\"{}\", r) \n\n结构体默认没有实现 `Display` 特征\n\n> 结构体为什么不默认实现 `Display` 特征呢？\n> \n> 原因在于结构体较为复杂，例如：想要逗号对字段进行分割吗？需要括号吗？等等\n> 因此如果要用 `{}` 的方式打印结构体，那就自己实现 `Display` 特征\n\n### ❌ println!(\"{:?}\", r) \n\n结构体默认没有实现 `Debug` 特征\n\n### ✅  #[derive(Debug)]\n\n```rust\n#[derive(Debug)]\nstruct Rectangle {\n    width: u32,\n    height: u32,\n}\nfn main() {\n    let rect1 = Rectangle {\n        width: 30,\n        height: 50,\n    };\n    println!(\"rect1 is {:?}\", rect1);  // rect1 is Rectangle { width: 30, height: 50 }\n}\n```\n\n#### println!(\"{:#?}\", r) \n\n```rust\nprintln!(\"rect1 is {:#?}\", rect1);\n// rect1 is Rectangle {\n//     width: 30,\n//     height: 50,\n// }\n```\n\n#### dbg!(&r)\n\n代码所在的文件名、行号、表达式以及表达式的值\n\n```rust\n#[derive(Debug)]\nstruct Rectangle {\n    width: u32,\n    height: u32,\n}\nfn main() {\n    let scale = 2;\n    let rect1 = Rectangle {\n        width: dbg!(30 * scale),\n        height: 50,\n    };\n    dbg!(&rect1);\n    // [src/rectangle/main.rs:97:16] 30 * scale = 60\n    // [src/rectangle/main.rs:100:5] &rect1 = Rectangle {\n    //     width: 60,\n    //     height: 50,\n    // }\n}\n```\n\n### ✅ 自己实现 `Display` 特征\n\n```rust\nimpl std::fmt::Display for Rectangle {\n    fn fmt(&self, f: &mut std::fmt::Formatter<'_>) -> std::fmt::Result {\n        for _ in 0..self.height {\n            let mut s = String::new();\n            for _ in 0..self.width {\n                s.push('#');\n            }\n            write!(f, \"{}\\n\", s);\n        }\n        return Ok(());\n    }\n}\n```\n\n## 课后作业\n\n### ✅ 自己实现 `Debug` 特征\n\n```rust\nimpl std::fmt::Debug for Rectangle {\n    fn fmt(&self, f: &mut std::fmt::Formatter<'_>) -> std::fmt::Result {\n        for _ in 0..self.height {\n            let mut s = String::new();\n            for _ in 0..self.width {\n                s.push('#');\n            }\n            write!(f, \"{}\\n\", s);\n        }\n        return Ok(());\n    }\n}\n```","source":"_posts/69-IB-Rust-结构体.md","raw":"---\ntitle: IB-Rust-结构体\ndate: 2025-05-26 23:22:16\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson11](https://github.com/Zoella-w/IB-Rust/tree/main/11_struct)\n\n\n## 普通结构体\n\n### 定义结构体\n\n- 结构体的定义的位置没有要求，实例化的作用域在定义的范围内即可\n- 大括号中，定义每一部分数据的名字和类型，称为字段（field）\n\n```rust\nstruct User {\n    active: bool,\n    username: String,\n    email: String,\n    sign_in_count: u64,\n}\n```\n\n### 创建结构体实例\n\n初始化实例时，每个字段都需要进行初始化，没有初始值\n\n```rust\nlet user1 = User {\n    email: String::from(\"someone@example.com\"),\n    username: String::from(\"someusername123\"),\n    active: true,\n    sign_in_count: 1,\n};\n```\n\n#### 使用字段初始化简写语法\n\n变量名与字段名完全相同（类似 js）\n\n```rust\nlet email = String::from(\"someone@example.com\");\nlet username = String::from(\"someusername123\");\n\nlet user1 = User {\n    email,\n    username,\n    active: true,\n    sign_in_count: 1,\n};\n```\n\n#### 从其他实例创建实例\n\n- 结构体更新语法允许从一个实例中创建一个新实例，同时保留部分字段值\n- 最后没有逗号\n\n```rust\nlet user2 = User {\n    email: String::from(\"another@example.com\"),\n    active: user1.active,\n    username: user1.username,\n    sign_in_count: user1.sign_in_count,\n};\n```\n\n```rust\nlet user2 = User {\n    email: String::from(\"another@example.com\"),\n    ..user1 // 简写\n};\n```\n\n### 修改结构体字段（可变性）\n\n整个实例必须是可变的，不允许只将某个字段标记为可变\n\n```rust\nlet mut user1 = User {\n    email: String::from(\"someone@example.com\"),\n    username: String::from(\"someusername123\"),\n    active: true,\n    sign_in_count: 1,\n};\nuser1.email = String::from(\"anotheremail@example.com\");\n```\n\n## 特殊的结构体\n\n- 元组结构体（Tuple Struct）\n- 单元结构体（Unit-like Struct）\n\n### 元组结构体\n\n字段没有名称的结构体，这种结构体长得像元组，因此被称为元组结构体\n\n例如 `Point` 元组结构体，是 `(x, y, z)` 形式的坐标点\n\n- 使用 `struct` 关键字，接着是圆括号，然后是各字段类型\n- 实例化时使用圆括号\n\n```rust\nstruct Color(i32, i32, i32);\nstruct Point(i32, i32, i32);\nlet black = Color(0, 0, 0); // 访问\nlet origin = Point(0, 0, 0);\n```\n\n### 单元结构体\n\n如果定义一个类型，但是不关心该类型的内容, 只关心其行为时，就可以使用 `单元结构体`\n\n- 使用 `struct` 关键字，接着是名称\n- 实例化不需要花括号或圆括号\n\n```rust\nstruct AlwaysEqual;\nlet subject = AlwaysEqual;\n// 不关心 AlwaysEqual 的字段数据，只关心其行为\n// 因此将它声明为单元结构体，然后再为它实现某个特征\nimpl SomeTrait for AlwaysEqual { }\n```\n\n## 所有权\n\n### 实现 Copy 特征的类型\n\n实现了 Copy 特征的类型无需所有权转移，可以直接在赋值时进行数据拷贝\n\n```rust\nfn main() {\n    let user1 = User {\n        email: String::from(\"someone@example.com\"),\n        username: String::from(\"someusername123\"),\n        active: true,\n        sign_in_count: 1,\n    };\n    let active = user1.active;\n    println!(\"{}\", user1.active); // true\n    print_username(user1); // someusername123\n}\nfn print_username(user: User) {\n    println!(\"{}\", user.username);\n}\n```\n\n### 没有实现 Copy 特征的类型\n\n- 字段所有权发生了移动，但其他字段不受影响\n- 结构体整体也无法再被使用\n- 结构体更新语法同样适用\n\n```rust\nfn main() {\n    let user1 = User {\n        email: String::from(\"someone@example.com\"),\n        username: String::from(\"someusername123\"),\n        active: true,\n        sign_in_count: 1,\n    };\n    let name = user1.username;\n    println!(\"{}\", user1.email); // someone@example.com\n    println!(\"{}\", user1.username); // error\n    print_username(user1); // error \n}\nfn print_username(user: User) {\n    println!(\"{}\", user.username);\n}\n```\n\n### 结构体更新语法\n\n```rust\nfn main() {\n    let user1 = User {\n        email: String::from(\"someone@example.com\"),\n        username: String::from(\"someusername123\"),\n        active: true,\n        sign_in_count: 1,\n    };\n    let user2 = User {\n        email: String::from(\"another@example.com\"),\n        ..user1\n    };\n    // let user2 = User {\n    //     email: String::from(\"another@example.com\"),\n\n    //     active: user1.active,\n    //     username: user1.username,\n    //     sign_in_count: user1.sign_in_count,\n    // };\n    println!(\"{}\",user1.active);\n    println!(\"{}\",user1.username); // 报错\n    print_username(user1); // 报错\n}\nfn print_username(user: User) {\n    println!(\"{}\", user.username);\n}\n```\n\n### 结构体中的借用\n\n可以让 `User` 结构体从其它对象借用数据，不过需要引入生命周期\n\n生命周期能确保结构体的作用范围要比它所借用的数据的作用范围要小\n\n```rust\nstruct User<'a> {\n    username: &'a str,\n    email: &'a str,\n    sign_in_count: u64,\n    active: bool,\n}\nlet user1 = User {\n    email: \"someone@example.com\",\n    username: \"someusername123\",\n    active: true,\n    sign_in_count: 1,\n};\n```\n\n## 方法\n\n### 定义方法\n\n方法与函数不同，方法的第一个参数是 `self`，代表调用该方法的结构体实例\n\n```rust\n#[derive(Debug)]\nstruct Rectangle {\n    width: u32,\n    height: u32,\n}\nimpl Rectangle {\n    fn area(&self) -> u32 {\n        self.width * self.height\n    }\n}\nfn main() {\n    let rect1 = Rectangle { width: 30, height: 50 };\n}\n```\n\n一般使用 `&self` 替代 \n-  `self: &Self`\n- `rectangle: &Rectangle`\n\n```rust\nimpl Rectangle {\n    fn area(&self) -> u32 {\n        self.width * self.height\n    }\n    // fn area(self: &Self) -> u32 {\n    //     self.width * self.height\n    // }\n    // fn area(self: &Rectangle) -> u32 {\n    //     self.width * self.height\n    // }\n}\n\n```\n\n---\n\n`self` 依然有所有权的概念：\n\n- `self` 表示 `Rectangle` 的所有权转移到该方法中，这种形式较少\n- `&self` 表示对 `Rectangle` 的不可变借用\n- `&mut self` 表示可变借用\n\n#### 方法名跟结构体字段名相同\n\n在外部的包里，用户只能通过方法获取字段，而不能直接访问，作用类似 getter\n\n```rust\npub struct Rectangle {\n    width: u32,\n    height: u32,\n}\nimpl Rectangle {\n    // getter\n    pub fn width(&self) -> bool {\n        self.width > 0\n    }\n}\nfn main() {\n    let rect1 = Rectangle {\n        width: 30,\n        height: 50,\n    };\n    if rect1.width() {\n        println!(\"The rectangle has a nonzero width; it is {}\", rect1.width);\n    }\n}\n```\n\n### 关联函数\n\n在 `impl` 块中定义的函数被称为**关联函数**（associated functions），因为它们与 `impl` 后面命名的类型相关\n\n在 `String` 类型上定义的 `String::from()` 也是这样的函数\n\n- 关联函数没有 `self`\n- 不能用 `.` 的方式来调用，需要用 `::` 来调用，例如 `let sq = Rectangle::new(3, 3);`\n- 一般使用 `new` 来作为构造器的名称\n\n```rust\npub struct Rectangle {\n    width: u32,\n    height: u32,\n}\nimpl Rectangle {\n    fn new(width: u32, height: u32) -> Rectangle {\n        Rectangle { width, height }\n    }\n}\nfn main() {\n    let rect1 = Rectangle::new(30, 50);\n}\n```\n\n### 多个 impl 定义\n\n允许为一个结构体定义多个 `impl` 块，目的是提供更多的灵活性和代码组织性\n\n```rust\nimpl Rectangle {\n    fn area(&self) -> u32 {\n        self.width * self.height\n    }\n}\nimpl Rectangle {\n    fn can_hold(&self, other: &Rectangle) -> bool {\n        self.width > other.width && self.height > other.height\n    }\n}\n```\n\n## 实现trait\n\n### 为类型实现特征\n\n如果不同的类型具有相同的行为，可以定义一个特征，然后为这些类型实现该特征\n\n**定义特征**是把一些方法组合在一起，目的是定义一个实现某些目标所必需的行为的集合\n\n```rust\ntrait Shape {\n    fn area(&self) -> f64;\n}\n#[derive(Debug)]\nstruct Rectangle {\n    width: u32,\n    height: u32,\n}\nimpl Shape for Rectangle {\n    fn area(&self) -> f64 {\n        (self.width * self.height) as f64\n    }\n}\nfn print_area(shape: &impl Shape) {\n    println!(\"{}\", shape.area());\n}\n```\n\n## 打印结构体的信息\n\n### ❌ println!(\"{}\", r) \n\n结构体默认没有实现 `Display` 特征\n\n> 结构体为什么不默认实现 `Display` 特征呢？\n> \n> 原因在于结构体较为复杂，例如：想要逗号对字段进行分割吗？需要括号吗？等等\n> 因此如果要用 `{}` 的方式打印结构体，那就自己实现 `Display` 特征\n\n### ❌ println!(\"{:?}\", r) \n\n结构体默认没有实现 `Debug` 特征\n\n### ✅  #[derive(Debug)]\n\n```rust\n#[derive(Debug)]\nstruct Rectangle {\n    width: u32,\n    height: u32,\n}\nfn main() {\n    let rect1 = Rectangle {\n        width: 30,\n        height: 50,\n    };\n    println!(\"rect1 is {:?}\", rect1);  // rect1 is Rectangle { width: 30, height: 50 }\n}\n```\n\n#### println!(\"{:#?}\", r) \n\n```rust\nprintln!(\"rect1 is {:#?}\", rect1);\n// rect1 is Rectangle {\n//     width: 30,\n//     height: 50,\n// }\n```\n\n#### dbg!(&r)\n\n代码所在的文件名、行号、表达式以及表达式的值\n\n```rust\n#[derive(Debug)]\nstruct Rectangle {\n    width: u32,\n    height: u32,\n}\nfn main() {\n    let scale = 2;\n    let rect1 = Rectangle {\n        width: dbg!(30 * scale),\n        height: 50,\n    };\n    dbg!(&rect1);\n    // [src/rectangle/main.rs:97:16] 30 * scale = 60\n    // [src/rectangle/main.rs:100:5] &rect1 = Rectangle {\n    //     width: 60,\n    //     height: 50,\n    // }\n}\n```\n\n### ✅ 自己实现 `Display` 特征\n\n```rust\nimpl std::fmt::Display for Rectangle {\n    fn fmt(&self, f: &mut std::fmt::Formatter<'_>) -> std::fmt::Result {\n        for _ in 0..self.height {\n            let mut s = String::new();\n            for _ in 0..self.width {\n                s.push('#');\n            }\n            write!(f, \"{}\\n\", s);\n        }\n        return Ok(());\n    }\n}\n```\n\n## 课后作业\n\n### ✅ 自己实现 `Debug` 特征\n\n```rust\nimpl std::fmt::Debug for Rectangle {\n    fn fmt(&self, f: &mut std::fmt::Formatter<'_>) -> std::fmt::Result {\n        for _ in 0..self.height {\n            let mut s = String::new();\n            for _ in 0..self.width {\n                s.push('#');\n            }\n            write!(f, \"{}\\n\", s);\n        }\n        return Ok(());\n    }\n}\n```","slug":"69-IB-Rust-结构体","published":1,"updated":"2025-05-27T09:51:58.090Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb6c8z8z0001p9prbhys297b","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/11_struct\" >Codes in lesson11<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"普通结构体\"><a href=\"#普通结构体\" class=\"headerlink\" title=\"普通结构体\"></a>普通结构体</h2><h3 id=\"定义结构体\"><a href=\"#定义结构体\" class=\"headerlink\" title=\"定义结构体\"></a>定义结构体</h3><ul>\n<li>结构体的定义的位置没有要求，实例化的作用域在定义的范围内即可</li>\n<li>大括号中，定义每一部分数据的名字和类型，称为字段（field）</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">User</span> &#123;</span><br><span class=\"line\">    active: <span class=\"type\">bool</span>,</span><br><span class=\"line\">    username: <span class=\"type\">String</span>,</span><br><span class=\"line\">    email: <span class=\"type\">String</span>,</span><br><span class=\"line\">    sign_in_count: <span class=\"type\">u64</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"创建结构体实例\"><a href=\"#创建结构体实例\" class=\"headerlink\" title=\"创建结构体实例\"></a>创建结构体实例</h3><p>初始化实例时，每个字段都需要进行初始化，没有初始值</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">user1</span> = User &#123;</span><br><span class=\"line\">    email: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someone@example.com&quot;</span>),</span><br><span class=\"line\">    username: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someusername123&quot;</span>),</span><br><span class=\"line\">    active: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    sign_in_count: <span class=\"number\">1</span>,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"使用字段初始化简写语法\"><a href=\"#使用字段初始化简写语法\" class=\"headerlink\" title=\"使用字段初始化简写语法\"></a>使用字段初始化简写语法</h4><p>变量名与字段名完全相同（类似 js）</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">email</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someone@example.com&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">username</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someusername123&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">user1</span> = User &#123;</span><br><span class=\"line\">    email,</span><br><span class=\"line\">    username,</span><br><span class=\"line\">    active: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    sign_in_count: <span class=\"number\">1</span>,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"从其他实例创建实例\"><a href=\"#从其他实例创建实例\" class=\"headerlink\" title=\"从其他实例创建实例\"></a>从其他实例创建实例</h4><ul>\n<li>结构体更新语法允许从一个实例中创建一个新实例，同时保留部分字段值</li>\n<li>最后没有逗号</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">user2</span> = User &#123;</span><br><span class=\"line\">    email: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;another@example.com&quot;</span>),</span><br><span class=\"line\">    active: user1.active,</span><br><span class=\"line\">    username: user1.username,</span><br><span class=\"line\">    sign_in_count: user1.sign_in_count,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">user2</span> = User &#123;</span><br><span class=\"line\">    email: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;another@example.com&quot;</span>),</span><br><span class=\"line\">    ..user1 <span class=\"comment\">// 简写</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"修改结构体字段（可变性）\"><a href=\"#修改结构体字段（可变性）\" class=\"headerlink\" title=\"修改结构体字段（可变性）\"></a>修改结构体字段（可变性）</h3><p>整个实例必须是可变的，不允许只将某个字段标记为可变</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">user1</span> = User &#123;</span><br><span class=\"line\">    email: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someone@example.com&quot;</span>),</span><br><span class=\"line\">    username: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someusername123&quot;</span>),</span><br><span class=\"line\">    active: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    sign_in_count: <span class=\"number\">1</span>,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">user1.email = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;anotheremail@example.com&quot;</span>);</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"特殊的结构体\"><a href=\"#特殊的结构体\" class=\"headerlink\" title=\"特殊的结构体\"></a>特殊的结构体</h2><ul>\n<li>元组结构体（Tuple Struct）</li>\n<li>单元结构体（Unit-like Struct）</li>\n</ul>\n<h3 id=\"元组结构体\"><a href=\"#元组结构体\" class=\"headerlink\" title=\"元组结构体\"></a>元组结构体</h3><p>字段没有名称的结构体，这种结构体长得像元组，因此被称为元组结构体</p>\n<p>例如 <code>Point</code> 元组结构体，是 <code>(x, y, z)</code> 形式的坐标点</p>\n<ul>\n<li>使用 <code>struct</code> 关键字，接着是圆括号，然后是各字段类型</li>\n<li>实例化时使用圆括号</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Color</span>(<span class=\"type\">i32</span>, <span class=\"type\">i32</span>, <span class=\"type\">i32</span>);</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Point</span>(<span class=\"type\">i32</span>, <span class=\"type\">i32</span>, <span class=\"type\">i32</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">black</span> = <span class=\"title function_ invoke__\">Color</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>); <span class=\"comment\">// 访问</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">origin</span> = <span class=\"title function_ invoke__\">Point</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"单元结构体\"><a href=\"#单元结构体\" class=\"headerlink\" title=\"单元结构体\"></a>单元结构体</h3><p>如果定义一个类型，但是不关心该类型的内容, 只关心其行为时，就可以使用 <code>单元结构体</code></p>\n<ul>\n<li>使用 <code>struct</code> 关键字，接着是名称</li>\n<li>实例化不需要花括号或圆括号</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">AlwaysEqual</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">subject</span> = AlwaysEqual;</span><br><span class=\"line\"><span class=\"comment\">// 不关心 AlwaysEqual 的字段数据，只关心其行为</span></span><br><span class=\"line\"><span class=\"comment\">// 因此将它声明为单元结构体，然后再为它实现某个特征</span></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">SomeTrait</span> <span class=\"keyword\">for</span> <span class=\"title class_\">AlwaysEqual</span> &#123; &#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"所有权\"><a href=\"#所有权\" class=\"headerlink\" title=\"所有权\"></a>所有权</h2><h3 id=\"实现-Copy-特征的类型\"><a href=\"#实现-Copy-特征的类型\" class=\"headerlink\" title=\"实现 Copy 特征的类型\"></a>实现 Copy 特征的类型</h3><p>实现了 Copy 特征的类型无需所有权转移，可以直接在赋值时进行数据拷贝</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">user1</span> = User &#123;</span><br><span class=\"line\">        email: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someone@example.com&quot;</span>),</span><br><span class=\"line\">        username: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someusername123&quot;</span>),</span><br><span class=\"line\">        active: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        sign_in_count: <span class=\"number\">1</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">active</span> = user1.active;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, user1.active); <span class=\"comment\">// true</span></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">print_username</span>(user1); <span class=\"comment\">// someusername123</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">print_username</span>(user: User) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, user.username);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"没有实现-Copy-特征的类型\"><a href=\"#没有实现-Copy-特征的类型\" class=\"headerlink\" title=\"没有实现 Copy 特征的类型\"></a>没有实现 Copy 特征的类型</h3><ul>\n<li>字段所有权发生了移动，但其他字段不受影响</li>\n<li>结构体整体也无法再被使用</li>\n<li>结构体更新语法同样适用</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">user1</span> = User &#123;</span><br><span class=\"line\">        email: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someone@example.com&quot;</span>),</span><br><span class=\"line\">        username: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someusername123&quot;</span>),</span><br><span class=\"line\">        active: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        sign_in_count: <span class=\"number\">1</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">name</span> = user1.username;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, user1.email); <span class=\"comment\">// someone@example.com</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, user1.username); <span class=\"comment\">// error</span></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">print_username</span>(user1); <span class=\"comment\">// error </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">print_username</span>(user: User) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, user.username);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"结构体更新语法\"><a href=\"#结构体更新语法\" class=\"headerlink\" title=\"结构体更新语法\"></a>结构体更新语法</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">user1</span> = User &#123;</span><br><span class=\"line\">        email: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someone@example.com&quot;</span>),</span><br><span class=\"line\">        username: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someusername123&quot;</span>),</span><br><span class=\"line\">        active: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        sign_in_count: <span class=\"number\">1</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">user2</span> = User &#123;</span><br><span class=\"line\">        email: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;another@example.com&quot;</span>),</span><br><span class=\"line\">        ..user1</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// let user2 = User &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     email: String::from(&quot;another@example.com&quot;),</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//     active: user1.active,</span></span><br><span class=\"line\">    <span class=\"comment\">//     username: user1.username,</span></span><br><span class=\"line\">    <span class=\"comment\">//     sign_in_count: user1.sign_in_count,</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;;</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>,user1.active);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>,user1.username); <span class=\"comment\">// 报错</span></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">print_username</span>(user1); <span class=\"comment\">// 报错</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">print_username</span>(user: User) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, user.username);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"结构体中的借用\"><a href=\"#结构体中的借用\" class=\"headerlink\" title=\"结构体中的借用\"></a>结构体中的借用</h3><p>可以让 <code>User</code> 结构体从其它对象借用数据，不过需要引入生命周期</p>\n<p>生命周期能确保结构体的作用范围要比它所借用的数据的作用范围要小</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">User</span>&lt;<span class=\"symbol\">&#x27;a</span>&gt; &#123;</span><br><span class=\"line\">    username: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span>,</span><br><span class=\"line\">    email: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span>,</span><br><span class=\"line\">    sign_in_count: <span class=\"type\">u64</span>,</span><br><span class=\"line\">    active: <span class=\"type\">bool</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">user1</span> = User &#123;</span><br><span class=\"line\">    email: <span class=\"string\">&quot;someone@example.com&quot;</span>,</span><br><span class=\"line\">    username: <span class=\"string\">&quot;someusername123&quot;</span>,</span><br><span class=\"line\">    active: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    sign_in_count: <span class=\"number\">1</span>,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"方法\"><a href=\"#方法\" class=\"headerlink\" title=\"方法\"></a>方法</h2><h3 id=\"定义方法\"><a href=\"#定义方法\" class=\"headerlink\" title=\"定义方法\"></a>定义方法</h3><p>方法与函数不同，方法的第一个参数是 <code>self</code>，代表调用该方法的结构体实例</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#[derive(Debug)]</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    width: <span class=\"type\">u32</span>,</span><br><span class=\"line\">    height: <span class=\"type\">u32</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">area</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">u32</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.width * <span class=\"keyword\">self</span>.height</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">rect1</span> = Rectangle &#123; width: <span class=\"number\">30</span>, height: <span class=\"number\">50</span> &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>一般使用 <code>&amp;self</code> 替代 </p>\n<ul>\n<li><code>self: &amp;Self</code></li>\n<li><code>rectangle: &amp;Rectangle</code></li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">area</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">u32</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.width * <span class=\"keyword\">self</span>.height</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// fn area(self: &amp;Self) -&gt; u32 &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     self.width * self.height</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">    <span class=\"comment\">// fn area(self: &amp;Rectangle) -&gt; u32 &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     self.width * self.height</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<hr>\n<p><code>self</code> 依然有所有权的概念：</p>\n<ul>\n<li><code>self</code> 表示 <code>Rectangle</code> 的所有权转移到该方法中，这种形式较少</li>\n<li><code>&amp;self</code> 表示对 <code>Rectangle</code> 的不可变借用</li>\n<li><code>&amp;mut self</code> 表示可变借用</li>\n</ul>\n<h4 id=\"方法名跟结构体字段名相同\"><a href=\"#方法名跟结构体字段名相同\" class=\"headerlink\" title=\"方法名跟结构体字段名相同\"></a>方法名跟结构体字段名相同</h4><p>在外部的包里，用户只能通过方法获取字段，而不能直接访问，作用类似 getter</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">struct</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    width: <span class=\"type\">u32</span>,</span><br><span class=\"line\">    height: <span class=\"type\">u32</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// getter</span></span><br><span class=\"line\">    <span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">width</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">bool</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.width &gt; <span class=\"number\">0</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">rect1</span> = Rectangle &#123;</span><br><span class=\"line\">        width: <span class=\"number\">30</span>,</span><br><span class=\"line\">        height: <span class=\"number\">50</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> rect1.<span class=\"title function_ invoke__\">width</span>() &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;The rectangle has a nonzero width; it is &#123;&#125;&quot;</span>, rect1.width);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"关联函数\"><a href=\"#关联函数\" class=\"headerlink\" title=\"关联函数\"></a>关联函数</h3><p>在 <code>impl</code> 块中定义的函数被称为<strong>关联函数</strong>（associated functions），因为它们与 <code>impl</code> 后面命名的类型相关</p>\n<p>在 <code>String</code> 类型上定义的 <code>String::from()</code> 也是这样的函数</p>\n<ul>\n<li>关联函数没有 <code>self</code></li>\n<li>不能用 <code>.</code> 的方式来调用，需要用 <code>::</code> 来调用，例如 <code>let sq = Rectangle::new(3, 3);</code></li>\n<li>一般使用 <code>new</code> 来作为构造器的名称</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">struct</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    width: <span class=\"type\">u32</span>,</span><br><span class=\"line\">    height: <span class=\"type\">u32</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">new</span>(width: <span class=\"type\">u32</span>, height: <span class=\"type\">u32</span>) <span class=\"punctuation\">-&gt;</span> Rectangle &#123;</span><br><span class=\"line\">        Rectangle &#123; width, height &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">rect1</span> = Rectangle::<span class=\"title function_ invoke__\">new</span>(<span class=\"number\">30</span>, <span class=\"number\">50</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"多个-impl-定义\"><a href=\"#多个-impl-定义\" class=\"headerlink\" title=\"多个 impl 定义\"></a>多个 impl 定义</h3><p>允许为一个结构体定义多个 <code>impl</code> 块，目的是提供更多的灵活性和代码组织性</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">area</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">u32</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.width * <span class=\"keyword\">self</span>.height</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">can_hold</span>(&amp;<span class=\"keyword\">self</span>, other: &amp;Rectangle) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">bool</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.width &gt; other.width &amp;&amp; <span class=\"keyword\">self</span>.height &gt; other.height</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"实现trait\"><a href=\"#实现trait\" class=\"headerlink\" title=\"实现trait\"></a>实现trait</h2><h3 id=\"为类型实现特征\"><a href=\"#为类型实现特征\" class=\"headerlink\" title=\"为类型实现特征\"></a>为类型实现特征</h3><p>如果不同的类型具有相同的行为，可以定义一个特征，然后为这些类型实现该特征</p>\n<p><strong>定义特征</strong>是把一些方法组合在一起，目的是定义一个实现某些目标所必需的行为的集合</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">trait</span> <span class=\"title class_\">Shape</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">area</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">f64</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">#[derive(Debug)]</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    width: <span class=\"type\">u32</span>,</span><br><span class=\"line\">    height: <span class=\"type\">u32</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Shape</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">area</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">f64</span> &#123;</span><br><span class=\"line\">        (<span class=\"keyword\">self</span>.width * <span class=\"keyword\">self</span>.height) <span class=\"keyword\">as</span> <span class=\"type\">f64</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">print_area</span>(shape: &amp;<span class=\"keyword\">impl</span> <span class=\"title class_\">Shape</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, shape.<span class=\"title function_ invoke__\">area</span>());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"打印结构体的信息\"><a href=\"#打印结构体的信息\" class=\"headerlink\" title=\"打印结构体的信息\"></a>打印结构体的信息</h2><h3 id=\"❌-println-“-”-r\"><a href=\"#❌-println-“-”-r\" class=\"headerlink\" title=\"❌ println!(“{}”, r)\"></a>❌ println!(“{}”, r)</h3><p>结构体默认没有实现 <code>Display</code> 特征</p>\n<blockquote>\n<p>结构体为什么不默认实现 <code>Display</code> 特征呢？</p>\n<p>原因在于结构体较为复杂，例如：想要逗号对字段进行分割吗？需要括号吗？等等<br>因此如果要用 <code>&#123;&#125;</code> 的方式打印结构体，那就自己实现 <code>Display</code> 特征</p>\n</blockquote>\n<h3 id=\"❌-println-“-”-r-1\"><a href=\"#❌-println-“-”-r-1\" class=\"headerlink\" title=\"❌ println!(“{:?}”, r)\"></a>❌ println!(“{:?}”, r)</h3><p>结构体默认没有实现 <code>Debug</code> 特征</p>\n<h3 id=\"✅-derive-Debug\"><a href=\"#✅-derive-Debug\" class=\"headerlink\" title=\"✅  #[derive(Debug)]\"></a>✅  #[derive(Debug)]</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#[derive(Debug)]</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    width: <span class=\"type\">u32</span>,</span><br><span class=\"line\">    height: <span class=\"type\">u32</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">rect1</span> = Rectangle &#123;</span><br><span class=\"line\">        width: <span class=\"number\">30</span>,</span><br><span class=\"line\">        height: <span class=\"number\">50</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;rect1 is &#123;:?&#125;&quot;</span>, rect1);  <span class=\"comment\">// rect1 is Rectangle &#123; width: 30, height: 50 &#125;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"println-“-”-r\"><a href=\"#println-“-”-r\" class=\"headerlink\" title=\"println!(“{:#?}”, r)\"></a>println!(“{:#?}”, r)</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;rect1 is &#123;:#?&#125;&quot;</span>, rect1);</span><br><span class=\"line\"><span class=\"comment\">// rect1 is Rectangle &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//     width: 30,</span></span><br><span class=\"line\"><span class=\"comment\">//     height: 50,</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"dbg-r\"><a href=\"#dbg-r\" class=\"headerlink\" title=\"dbg!(&amp;r)\"></a>dbg!(&amp;r)</h4><p>代码所在的文件名、行号、表达式以及表达式的值</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#[derive(Debug)]</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    width: <span class=\"type\">u32</span>,</span><br><span class=\"line\">    height: <span class=\"type\">u32</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">scale</span> = <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">rect1</span> = Rectangle &#123;</span><br><span class=\"line\">        width: dbg!(<span class=\"number\">30</span> * scale),</span><br><span class=\"line\">        height: <span class=\"number\">50</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    dbg!(&amp;rect1);</span><br><span class=\"line\">    <span class=\"comment\">// [src/rectangle/main.rs:97:16] 30 * scale = 60</span></span><br><span class=\"line\">    <span class=\"comment\">// [src/rectangle/main.rs:100:5] &amp;rect1 = Rectangle &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     width: 60,</span></span><br><span class=\"line\">    <span class=\"comment\">//     height: 50,</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"✅-自己实现-Display-特征\"><a href=\"#✅-自己实现-Display-特征\" class=\"headerlink\" title=\"✅ 自己实现 Display 特征\"></a>✅ 自己实现 <code>Display</code> 特征</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">std</span>::fmt::Display <span class=\"keyword\">for</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">fmt</span>(&amp;<span class=\"keyword\">self</span>, f: &amp;<span class=\"keyword\">mut</span> std::fmt::Formatter&lt;<span class=\"symbol\">&#x27;_</span>&gt;) <span class=\"punctuation\">-&gt;</span> std::fmt::<span class=\"type\">Result</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> <span class=\"variable\">_</span> <span class=\"keyword\">in</span> <span class=\"number\">0</span>..<span class=\"keyword\">self</span>.height &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> <span class=\"variable\">_</span> <span class=\"keyword\">in</span> <span class=\"number\">0</span>..<span class=\"keyword\">self</span>.width &#123;</span><br><span class=\"line\">                s.<span class=\"title function_ invoke__\">push</span>(<span class=\"string\">&#x27;#&#x27;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">write!</span>(f, <span class=\"string\">&quot;&#123;&#125;\\n&quot;</span>, s);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">Ok</span>(());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"课后作业\"><a href=\"#课后作业\" class=\"headerlink\" title=\"课后作业\"></a>课后作业</h2><h3 id=\"✅-自己实现-Debug-特征\"><a href=\"#✅-自己实现-Debug-特征\" class=\"headerlink\" title=\"✅ 自己实现 Debug 特征\"></a>✅ 自己实现 <code>Debug</code> 特征</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">std</span>::fmt::<span class=\"built_in\">Debug</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">fmt</span>(&amp;<span class=\"keyword\">self</span>, f: &amp;<span class=\"keyword\">mut</span> std::fmt::Formatter&lt;<span class=\"symbol\">&#x27;_</span>&gt;) <span class=\"punctuation\">-&gt;</span> std::fmt::<span class=\"type\">Result</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> <span class=\"variable\">_</span> <span class=\"keyword\">in</span> <span class=\"number\">0</span>..<span class=\"keyword\">self</span>.height &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> <span class=\"variable\">_</span> <span class=\"keyword\">in</span> <span class=\"number\">0</span>..<span class=\"keyword\">self</span>.width &#123;</span><br><span class=\"line\">                s.<span class=\"title function_ invoke__\">push</span>(<span class=\"string\">&#x27;#&#x27;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">write!</span>(f, <span class=\"string\">&quot;&#123;&#125;\\n&quot;</span>, s);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">Ok</span>(());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/11_struct\" >Codes in lesson11<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"普通结构体\"><a href=\"#普通结构体\" class=\"headerlink\" title=\"普通结构体\"></a>普通结构体</h2><h3 id=\"定义结构体\"><a href=\"#定义结构体\" class=\"headerlink\" title=\"定义结构体\"></a>定义结构体</h3><ul>\n<li>结构体的定义的位置没有要求，实例化的作用域在定义的范围内即可</li>\n<li>大括号中，定义每一部分数据的名字和类型，称为字段（field）</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">User</span> &#123;</span><br><span class=\"line\">    active: <span class=\"type\">bool</span>,</span><br><span class=\"line\">    username: <span class=\"type\">String</span>,</span><br><span class=\"line\">    email: <span class=\"type\">String</span>,</span><br><span class=\"line\">    sign_in_count: <span class=\"type\">u64</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建结构体实例\"><a href=\"#创建结构体实例\" class=\"headerlink\" title=\"创建结构体实例\"></a>创建结构体实例</h3><p>初始化实例时，每个字段都需要进行初始化，没有初始值</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">user1</span> = User &#123;</span><br><span class=\"line\">    email: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someone@example.com&quot;</span>),</span><br><span class=\"line\">    username: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someusername123&quot;</span>),</span><br><span class=\"line\">    active: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    sign_in_count: <span class=\"number\">1</span>,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"使用字段初始化简写语法\"><a href=\"#使用字段初始化简写语法\" class=\"headerlink\" title=\"使用字段初始化简写语法\"></a>使用字段初始化简写语法</h4><p>变量名与字段名完全相同（类似 js）</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">email</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someone@example.com&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">username</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someusername123&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">user1</span> = User &#123;</span><br><span class=\"line\">    email,</span><br><span class=\"line\">    username,</span><br><span class=\"line\">    active: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    sign_in_count: <span class=\"number\">1</span>,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"从其他实例创建实例\"><a href=\"#从其他实例创建实例\" class=\"headerlink\" title=\"从其他实例创建实例\"></a>从其他实例创建实例</h4><ul>\n<li>结构体更新语法允许从一个实例中创建一个新实例，同时保留部分字段值</li>\n<li>最后没有逗号</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">user2</span> = User &#123;</span><br><span class=\"line\">    email: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;another@example.com&quot;</span>),</span><br><span class=\"line\">    active: user1.active,</span><br><span class=\"line\">    username: user1.username,</span><br><span class=\"line\">    sign_in_count: user1.sign_in_count,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">user2</span> = User &#123;</span><br><span class=\"line\">    email: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;another@example.com&quot;</span>),</span><br><span class=\"line\">    ..user1 <span class=\"comment\">// 简写</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改结构体字段（可变性）\"><a href=\"#修改结构体字段（可变性）\" class=\"headerlink\" title=\"修改结构体字段（可变性）\"></a>修改结构体字段（可变性）</h3><p>整个实例必须是可变的，不允许只将某个字段标记为可变</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">user1</span> = User &#123;</span><br><span class=\"line\">    email: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someone@example.com&quot;</span>),</span><br><span class=\"line\">    username: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someusername123&quot;</span>),</span><br><span class=\"line\">    active: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    sign_in_count: <span class=\"number\">1</span>,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">user1.email = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;anotheremail@example.com&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"特殊的结构体\"><a href=\"#特殊的结构体\" class=\"headerlink\" title=\"特殊的结构体\"></a>特殊的结构体</h2><ul>\n<li>元组结构体（Tuple Struct）</li>\n<li>单元结构体（Unit-like Struct）</li>\n</ul>\n<h3 id=\"元组结构体\"><a href=\"#元组结构体\" class=\"headerlink\" title=\"元组结构体\"></a>元组结构体</h3><p>字段没有名称的结构体，这种结构体长得像元组，因此被称为元组结构体</p>\n<p>例如 <code>Point</code> 元组结构体，是 <code>(x, y, z)</code> 形式的坐标点</p>\n<ul>\n<li>使用 <code>struct</code> 关键字，接着是圆括号，然后是各字段类型</li>\n<li>实例化时使用圆括号</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Color</span>(<span class=\"type\">i32</span>, <span class=\"type\">i32</span>, <span class=\"type\">i32</span>);</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Point</span>(<span class=\"type\">i32</span>, <span class=\"type\">i32</span>, <span class=\"type\">i32</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">black</span> = <span class=\"title function_ invoke__\">Color</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>); <span class=\"comment\">// 访问</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">origin</span> = <span class=\"title function_ invoke__\">Point</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"单元结构体\"><a href=\"#单元结构体\" class=\"headerlink\" title=\"单元结构体\"></a>单元结构体</h3><p>如果定义一个类型，但是不关心该类型的内容, 只关心其行为时，就可以使用 <code>单元结构体</code></p>\n<ul>\n<li>使用 <code>struct</code> 关键字，接着是名称</li>\n<li>实例化不需要花括号或圆括号</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">AlwaysEqual</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">subject</span> = AlwaysEqual;</span><br><span class=\"line\"><span class=\"comment\">// 不关心 AlwaysEqual 的字段数据，只关心其行为</span></span><br><span class=\"line\"><span class=\"comment\">// 因此将它声明为单元结构体，然后再为它实现某个特征</span></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">SomeTrait</span> <span class=\"keyword\">for</span> <span class=\"title class_\">AlwaysEqual</span> &#123; &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"所有权\"><a href=\"#所有权\" class=\"headerlink\" title=\"所有权\"></a>所有权</h2><h3 id=\"实现-Copy-特征的类型\"><a href=\"#实现-Copy-特征的类型\" class=\"headerlink\" title=\"实现 Copy 特征的类型\"></a>实现 Copy 特征的类型</h3><p>实现了 Copy 特征的类型无需所有权转移，可以直接在赋值时进行数据拷贝</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">user1</span> = User &#123;</span><br><span class=\"line\">        email: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someone@example.com&quot;</span>),</span><br><span class=\"line\">        username: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someusername123&quot;</span>),</span><br><span class=\"line\">        active: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        sign_in_count: <span class=\"number\">1</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">active</span> = user1.active;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, user1.active); <span class=\"comment\">// true</span></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">print_username</span>(user1); <span class=\"comment\">// someusername123</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">print_username</span>(user: User) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, user.username);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"没有实现-Copy-特征的类型\"><a href=\"#没有实现-Copy-特征的类型\" class=\"headerlink\" title=\"没有实现 Copy 特征的类型\"></a>没有实现 Copy 特征的类型</h3><ul>\n<li>字段所有权发生了移动，但其他字段不受影响</li>\n<li>结构体整体也无法再被使用</li>\n<li>结构体更新语法同样适用</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">user1</span> = User &#123;</span><br><span class=\"line\">        email: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someone@example.com&quot;</span>),</span><br><span class=\"line\">        username: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someusername123&quot;</span>),</span><br><span class=\"line\">        active: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        sign_in_count: <span class=\"number\">1</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">name</span> = user1.username;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, user1.email); <span class=\"comment\">// someone@example.com</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, user1.username); <span class=\"comment\">// error</span></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">print_username</span>(user1); <span class=\"comment\">// error </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">print_username</span>(user: User) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, user.username);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"结构体更新语法\"><a href=\"#结构体更新语法\" class=\"headerlink\" title=\"结构体更新语法\"></a>结构体更新语法</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">user1</span> = User &#123;</span><br><span class=\"line\">        email: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someone@example.com&quot;</span>),</span><br><span class=\"line\">        username: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;someusername123&quot;</span>),</span><br><span class=\"line\">        active: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        sign_in_count: <span class=\"number\">1</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">user2</span> = User &#123;</span><br><span class=\"line\">        email: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;another@example.com&quot;</span>),</span><br><span class=\"line\">        ..user1</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// let user2 = User &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     email: String::from(&quot;another@example.com&quot;),</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//     active: user1.active,</span></span><br><span class=\"line\">    <span class=\"comment\">//     username: user1.username,</span></span><br><span class=\"line\">    <span class=\"comment\">//     sign_in_count: user1.sign_in_count,</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;;</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>,user1.active);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>,user1.username); <span class=\"comment\">// 报错</span></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">print_username</span>(user1); <span class=\"comment\">// 报错</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">print_username</span>(user: User) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, user.username);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"结构体中的借用\"><a href=\"#结构体中的借用\" class=\"headerlink\" title=\"结构体中的借用\"></a>结构体中的借用</h3><p>可以让 <code>User</code> 结构体从其它对象借用数据，不过需要引入生命周期</p>\n<p>生命周期能确保结构体的作用范围要比它所借用的数据的作用范围要小</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">User</span>&lt;<span class=\"symbol\">&#x27;a</span>&gt; &#123;</span><br><span class=\"line\">    username: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span>,</span><br><span class=\"line\">    email: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span>,</span><br><span class=\"line\">    sign_in_count: <span class=\"type\">u64</span>,</span><br><span class=\"line\">    active: <span class=\"type\">bool</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">user1</span> = User &#123;</span><br><span class=\"line\">    email: <span class=\"string\">&quot;someone@example.com&quot;</span>,</span><br><span class=\"line\">    username: <span class=\"string\">&quot;someusername123&quot;</span>,</span><br><span class=\"line\">    active: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    sign_in_count: <span class=\"number\">1</span>,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"方法\"><a href=\"#方法\" class=\"headerlink\" title=\"方法\"></a>方法</h2><h3 id=\"定义方法\"><a href=\"#定义方法\" class=\"headerlink\" title=\"定义方法\"></a>定义方法</h3><p>方法与函数不同，方法的第一个参数是 <code>self</code>，代表调用该方法的结构体实例</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#[derive(Debug)]</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    width: <span class=\"type\">u32</span>,</span><br><span class=\"line\">    height: <span class=\"type\">u32</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">area</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">u32</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.width * <span class=\"keyword\">self</span>.height</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">rect1</span> = Rectangle &#123; width: <span class=\"number\">30</span>, height: <span class=\"number\">50</span> &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>一般使用 <code>&amp;self</code> 替代 </p>\n<ul>\n<li><code>self: &amp;Self</code></li>\n<li><code>rectangle: &amp;Rectangle</code></li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">area</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">u32</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.width * <span class=\"keyword\">self</span>.height</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// fn area(self: &amp;Self) -&gt; u32 &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     self.width * self.height</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">    <span class=\"comment\">// fn area(self: &amp;Rectangle) -&gt; u32 &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     self.width * self.height</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><code>self</code> 依然有所有权的概念：</p>\n<ul>\n<li><code>self</code> 表示 <code>Rectangle</code> 的所有权转移到该方法中，这种形式较少</li>\n<li><code>&amp;self</code> 表示对 <code>Rectangle</code> 的不可变借用</li>\n<li><code>&amp;mut self</code> 表示可变借用</li>\n</ul>\n<h4 id=\"方法名跟结构体字段名相同\"><a href=\"#方法名跟结构体字段名相同\" class=\"headerlink\" title=\"方法名跟结构体字段名相同\"></a>方法名跟结构体字段名相同</h4><p>在外部的包里，用户只能通过方法获取字段，而不能直接访问，作用类似 getter</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">struct</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    width: <span class=\"type\">u32</span>,</span><br><span class=\"line\">    height: <span class=\"type\">u32</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// getter</span></span><br><span class=\"line\">    <span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">width</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">bool</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.width &gt; <span class=\"number\">0</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">rect1</span> = Rectangle &#123;</span><br><span class=\"line\">        width: <span class=\"number\">30</span>,</span><br><span class=\"line\">        height: <span class=\"number\">50</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> rect1.<span class=\"title function_ invoke__\">width</span>() &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;The rectangle has a nonzero width; it is &#123;&#125;&quot;</span>, rect1.width);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"关联函数\"><a href=\"#关联函数\" class=\"headerlink\" title=\"关联函数\"></a>关联函数</h3><p>在 <code>impl</code> 块中定义的函数被称为<strong>关联函数</strong>（associated functions），因为它们与 <code>impl</code> 后面命名的类型相关</p>\n<p>在 <code>String</code> 类型上定义的 <code>String::from()</code> 也是这样的函数</p>\n<ul>\n<li>关联函数没有 <code>self</code></li>\n<li>不能用 <code>.</code> 的方式来调用，需要用 <code>::</code> 来调用，例如 <code>let sq = Rectangle::new(3, 3);</code></li>\n<li>一般使用 <code>new</code> 来作为构造器的名称</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">struct</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    width: <span class=\"type\">u32</span>,</span><br><span class=\"line\">    height: <span class=\"type\">u32</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">new</span>(width: <span class=\"type\">u32</span>, height: <span class=\"type\">u32</span>) <span class=\"punctuation\">-&gt;</span> Rectangle &#123;</span><br><span class=\"line\">        Rectangle &#123; width, height &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">rect1</span> = Rectangle::<span class=\"title function_ invoke__\">new</span>(<span class=\"number\">30</span>, <span class=\"number\">50</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"多个-impl-定义\"><a href=\"#多个-impl-定义\" class=\"headerlink\" title=\"多个 impl 定义\"></a>多个 impl 定义</h3><p>允许为一个结构体定义多个 <code>impl</code> 块，目的是提供更多的灵活性和代码组织性</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">area</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">u32</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.width * <span class=\"keyword\">self</span>.height</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">can_hold</span>(&amp;<span class=\"keyword\">self</span>, other: &amp;Rectangle) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">bool</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.width &gt; other.width &amp;&amp; <span class=\"keyword\">self</span>.height &gt; other.height</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"实现trait\"><a href=\"#实现trait\" class=\"headerlink\" title=\"实现trait\"></a>实现trait</h2><h3 id=\"为类型实现特征\"><a href=\"#为类型实现特征\" class=\"headerlink\" title=\"为类型实现特征\"></a>为类型实现特征</h3><p>如果不同的类型具有相同的行为，可以定义一个特征，然后为这些类型实现该特征</p>\n<p><strong>定义特征</strong>是把一些方法组合在一起，目的是定义一个实现某些目标所必需的行为的集合</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">trait</span> <span class=\"title class_\">Shape</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">area</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">f64</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">#[derive(Debug)]</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    width: <span class=\"type\">u32</span>,</span><br><span class=\"line\">    height: <span class=\"type\">u32</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Shape</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">area</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">f64</span> &#123;</span><br><span class=\"line\">        (<span class=\"keyword\">self</span>.width * <span class=\"keyword\">self</span>.height) <span class=\"keyword\">as</span> <span class=\"type\">f64</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">print_area</span>(shape: &amp;<span class=\"keyword\">impl</span> <span class=\"title class_\">Shape</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, shape.<span class=\"title function_ invoke__\">area</span>());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"打印结构体的信息\"><a href=\"#打印结构体的信息\" class=\"headerlink\" title=\"打印结构体的信息\"></a>打印结构体的信息</h2><h3 id=\"❌-println-“-”-r\"><a href=\"#❌-println-“-”-r\" class=\"headerlink\" title=\"❌ println!(“{}”, r)\"></a>❌ println!(“{}”, r)</h3><p>结构体默认没有实现 <code>Display</code> 特征</p>\n<blockquote>\n<p>结构体为什么不默认实现 <code>Display</code> 特征呢？</p>\n<p>原因在于结构体较为复杂，例如：想要逗号对字段进行分割吗？需要括号吗？等等<br>因此如果要用 <code>&#123;&#125;</code> 的方式打印结构体，那就自己实现 <code>Display</code> 特征</p>\n</blockquote>\n<h3 id=\"❌-println-“-”-r-1\"><a href=\"#❌-println-“-”-r-1\" class=\"headerlink\" title=\"❌ println!(“{:?}”, r)\"></a>❌ println!(“{:?}”, r)</h3><p>结构体默认没有实现 <code>Debug</code> 特征</p>\n<h3 id=\"✅-derive-Debug\"><a href=\"#✅-derive-Debug\" class=\"headerlink\" title=\"✅  #[derive(Debug)]\"></a>✅  #[derive(Debug)]</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#[derive(Debug)]</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    width: <span class=\"type\">u32</span>,</span><br><span class=\"line\">    height: <span class=\"type\">u32</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">rect1</span> = Rectangle &#123;</span><br><span class=\"line\">        width: <span class=\"number\">30</span>,</span><br><span class=\"line\">        height: <span class=\"number\">50</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;rect1 is &#123;:?&#125;&quot;</span>, rect1);  <span class=\"comment\">// rect1 is Rectangle &#123; width: 30, height: 50 &#125;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"println-“-”-r\"><a href=\"#println-“-”-r\" class=\"headerlink\" title=\"println!(“{:#?}”, r)\"></a>println!(“{:#?}”, r)</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;rect1 is &#123;:#?&#125;&quot;</span>, rect1);</span><br><span class=\"line\"><span class=\"comment\">// rect1 is Rectangle &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//     width: 30,</span></span><br><span class=\"line\"><span class=\"comment\">//     height: 50,</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"dbg-r\"><a href=\"#dbg-r\" class=\"headerlink\" title=\"dbg!(&amp;r)\"></a>dbg!(&amp;r)</h4><p>代码所在的文件名、行号、表达式以及表达式的值</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#[derive(Debug)]</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    width: <span class=\"type\">u32</span>,</span><br><span class=\"line\">    height: <span class=\"type\">u32</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">scale</span> = <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">rect1</span> = Rectangle &#123;</span><br><span class=\"line\">        width: dbg!(<span class=\"number\">30</span> * scale),</span><br><span class=\"line\">        height: <span class=\"number\">50</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    dbg!(&amp;rect1);</span><br><span class=\"line\">    <span class=\"comment\">// [src/rectangle/main.rs:97:16] 30 * scale = 60</span></span><br><span class=\"line\">    <span class=\"comment\">// [src/rectangle/main.rs:100:5] &amp;rect1 = Rectangle &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     width: 60,</span></span><br><span class=\"line\">    <span class=\"comment\">//     height: 50,</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"✅-自己实现-Display-特征\"><a href=\"#✅-自己实现-Display-特征\" class=\"headerlink\" title=\"✅ 自己实现 Display 特征\"></a>✅ 自己实现 <code>Display</code> 特征</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">std</span>::fmt::Display <span class=\"keyword\">for</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">fmt</span>(&amp;<span class=\"keyword\">self</span>, f: &amp;<span class=\"keyword\">mut</span> std::fmt::Formatter&lt;<span class=\"symbol\">&#x27;_</span>&gt;) <span class=\"punctuation\">-&gt;</span> std::fmt::<span class=\"type\">Result</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> <span class=\"variable\">_</span> <span class=\"keyword\">in</span> <span class=\"number\">0</span>..<span class=\"keyword\">self</span>.height &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> <span class=\"variable\">_</span> <span class=\"keyword\">in</span> <span class=\"number\">0</span>..<span class=\"keyword\">self</span>.width &#123;</span><br><span class=\"line\">                s.<span class=\"title function_ invoke__\">push</span>(<span class=\"string\">&#x27;#&#x27;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">write!</span>(f, <span class=\"string\">&quot;&#123;&#125;\\n&quot;</span>, s);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">Ok</span>(());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"课后作业\"><a href=\"#课后作业\" class=\"headerlink\" title=\"课后作业\"></a>课后作业</h2><h3 id=\"✅-自己实现-Debug-特征\"><a href=\"#✅-自己实现-Debug-特征\" class=\"headerlink\" title=\"✅ 自己实现 Debug 特征\"></a>✅ 自己实现 <code>Debug</code> 特征</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">std</span>::fmt::<span class=\"built_in\">Debug</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Rectangle</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">fmt</span>(&amp;<span class=\"keyword\">self</span>, f: &amp;<span class=\"keyword\">mut</span> std::fmt::Formatter&lt;<span class=\"symbol\">&#x27;_</span>&gt;) <span class=\"punctuation\">-&gt;</span> std::fmt::<span class=\"type\">Result</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> <span class=\"variable\">_</span> <span class=\"keyword\">in</span> <span class=\"number\">0</span>..<span class=\"keyword\">self</span>.height &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> <span class=\"variable\">_</span> <span class=\"keyword\">in</span> <span class=\"number\">0</span>..<span class=\"keyword\">self</span>.width &#123;</span><br><span class=\"line\">                s.<span class=\"title function_ invoke__\">push</span>(<span class=\"string\">&#x27;#&#x27;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">write!</span>(f, <span class=\"string\">&quot;&#123;&#125;\\n&quot;</span>, s);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">Ok</span>(());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","_processedHighlight":true},{"title":"IB-Rust-模式匹配","date":"2025-05-27T09:57:20.000Z","_content":"\n[Codes in lesson12](https://github.com/Zoella-w/IB-Rust/tree/main/12_match)\n\n\n## 概述\n\n模式匹配可以检查数据的结构并进行相应操作，提高代码的可读性和简洁性、减少错误，尤其是在处理复杂数据结构时\n\n## 基础模式匹配\n\n### `match` 表达式\n\n基本用法：match 语句可以用于模式匹配数字、字符串、枚举等\n\n```rust\nlet number = 13;\nmatch number {\n    1 => println!(\"One!\"),\n    2 => println!(\"Two!\"),\n    3 => println!(\"Three!\"),\n    _ => println!(\"Something else!\"),\n}\n```\n\n## 模式匹配的各种模式\n\n### 字面值模式\n\n```rust\nlet x = 1;\nlet y = \"Hello\";\nmatch x {\n    1 => println!(\"One\"),\n    2 => println!(\"Two\"),\n    _ => println!(\"Other\"),\n}\nmatch y {\n    \"Hello\" => println!(\"Greeting\"),\n    \"Goodbye\" => println!(\"Farewell\"),\n    _ => println!(\"Other\"),\n}\n```\n\n### 变量模式\n\n将 x 赋值给 var，注意 x 所有权的转移\n\n```rust\nlet x = 42;\nmatch x {\n    var => println!(\"The value is: {}\", var),\n}\n```\n\n### 通配符模式\n\n```rust\nmatch x {\n    _ => println!(\"Any value\"),\n}\n```\n\n### 结构模式\n\n```rust\nstruct Point { x: i32, y: i32 }\nlet p = Point { x: 0, y: 7 };\nmatch p {\n    Point { x, y: 0 } => println!(\"On the x axis at {}\", x),\n    Point { x: 0, y } => println!(\"On the y axis at {}\", y),\n    Point { x, y } => println!(\"On neither axis: ({}, {})\", x, y),\n}\n```\n\n### 元组模式、枚举模式、解构模式\n\n类似的，用于解构元组、枚举和其他复杂数据结构\n\n## 守卫和绑定\n\n守卫：在模式匹配中，可以使用守卫来添加额外的条件判断\n\n**先匹配模式，再检查条件**\n\n```rust\nlet x = 5;\nmatch x {\n    n if n % 2 == 0 => println!(\"Even\"),\n    n => println!(\"Odd\"),\n}\n```\n\n绑定：在模式匹配中，可以使用绑定来将模式中的值绑定到变量上\n\n**同时匹配模式并绑定变量**\n\n```rust\nlet x = 3\nmatch x {\n    var @ 1..=5 => println!(\"Value in range: {}\", var),\n    _ => println!(\"Out of range\"),\n}\n```\n\n## 模式匹配的应用场景\n\n- 处理错误\n- 解析命令行参数\n- 解析配置文件\n- 解析数据包\n- 解析 XML 或 JSON 等数据格式\n\n### 处理错误\n\n```rust\nfn divide(a: i32, b: i32) -> Result<i32, String> {\n    if b == 0 {\n        Err(String::from(\"Cannot divide by zero\"))\n    } else {\n        Ok(a / b)\n    }\n}\n\nmatch divide(4, 2) {\n    Ok(result) => println!(\"Result is {}\", result),\n    Err(e) => println!(\"Error: {}\", e),\n}\n```\n\n## 高级模式匹配技巧\n\n### 嵌套模式\n\n```rust\nenum Message {\n    Quit,\n    Move { x: i32, y: i32 },\n    Write(String),\n    ChangeColor(i32, i32, i32),\n}\nlet msg = Message::ChangeColor(0, 160, 255);\nmatch msg {\n    // 解构\n    Message::ChangeColor(r, g, b) => {\n        println!(\"Change the color to red {}, green {}, and blue {}\", r, g, b)\n    }\n    _ => (),\n}\n```\n\n### 模式匹配与迭代器： 结合 iter 和 match 使用\n\n```rust\nlet vec1 = vec![1, 2, 3];\nlet vec2 = vec![1, 2, 3];\nfor (a, b) in vec1.iter().zip(vec2) {\n    println!(\"{} + {} = {}\", a, b, a + b);\n}\n```\n\n### if let 和 while let： 简化单个模式匹配\n\n```rust\nlet opt = Some(5);\nif let Some(x) = opt {\n    println!(\"Matched {:?}\", x);\n}\nlet mut iter = vec![1, 2, 3].into_iter();\nwhile let Some(x) = iter.next() {\n    println!(\"Matched {:?}\", x);\n    // Matched 1\n    // Matched 2\n    // Matched 3\n}\n```\n\n### ref 和 ref mut\n\n#### 使用场景\n\n- 借用数据而不转移所有权：在某些情况下，你只需要借用数据而不是转移其所有权。例如在递归数据结构中，借用数据可以避免所有权转移带来的复杂性\n- 对数据进行修改：使用 ref mut 可以在模式匹配时对数据进行修改，而无需转移所有权\n\n```rust\nlet x = String::from(\"Hello\");\nmatch x {\n    // 借用 x 的所有权，x 所有权没有转移\n    ref r => println!(\"Got a reference to a value: {:?}\", r),\n}\nprintln!(\"x is still accessible: {}\", x);\n\nlet x = String::from(\"Hello\");\nmatch x {\n    ref mut r => {\n        *r += String::from(\"world\")\n    },\n}\n```\n\n## 课后习题\n\n编写一个使用模式匹配解析 JSON 字符串的程序\n\n- 作业目标\n  - 理解如何使用 Rust 的模式匹配功能解析 JSON 数据。\n  - 学会使用 serde_json 库进行 JSON 处理。\n  - 练习在实际应用场景中使用模式匹配。\n- 作业要求\n  - 使用 serde_json 库解析 JSON 字符串。\n  - 使用模式匹配提取 JSON 对象中的不同字段。\n  - 处理不同类型的数据（字符串、数字、数组、嵌套对象等）。\n- 作业示例\n假设你有一个包含用户信息的 JSON 字符串：\n\n```json\n{\n  \"name\": \"Alice\",\n  \"age\": 30,\n  \"email\": \"alice@example.com\",\n  \"address\": {\n    \"street\": \"123 Main St\",\n    \"city\": \"Wonderland\"\n  },\n  \"phone_numbers\": [\"123-456-7890\", \"987-654-3210\"]\n}\n```\n\n``` rust\nuse serde_json::{Result, Value};\nuse std::collections::HashMap;\n\nfn main() -> Result<()> {\n    // 原始 JSON 数据\n    // 如果字符串包含双引号，可以在开头和结尾加 #\n    let json_str = r#\"\n    {\n        \"name\": \"Alice\",\n        \"age\": 30,\n        \"email\": \"alice@example.com\",\n        \"address\": {\n            \"street\": \"123 Main St\",\n            \"city\": \"Wonderland\"\n        },\n        \"phone_numbers\": [\"123-456-7890\", \"987-654-3210\"]\n    }\n    \"#;\n\n    // 步骤 1：解析 JSON 字符串为动态类型 Value\n    // serde_json::from_str 返回 Result<Value, Error>\n    let v: Value = serde_json::from_str(json_str)?;\n\n    // 步骤 2：使用模式匹配处理 JSON 结构\n    match v {\n        Value::Object(obj) => {\n            let mut name = String::from(\"Unknown\");\n            let mut age = 0;\n            let mut address = HashMap::new();\n            let mut phone_numbers = Vec::new();\n            for (key, value) in obj {\n                match key.as_str() {\n                    \"name\" => {\n                        if let Value::String(s) = value {\n                            name = s;\n                        }\n                    }\n                    \"age\" => {\n                        if let Value::Number(n) = value {\n                            // as_i64()​​：将 JSON 数值转换为 i64 类型，返回 Option<i64>\n                            // unwrap_or(0)：解包 Option<i64>，如果值为 None，则使用默认值 0\n                            age = n.as_i64().unwrap_or(0) as i32;\n                        }\n                    }\n                    \"address\" => {\n                        if let Value::Object(addr_obj) = value {\n                            let mut street = String::from(\"Unknown\");\n                            let mut city = String::from(\"Unknown\");\n                            for (addr_key, addr_value) in addr_obj {\n                                match addr_key.as_str() {\n                                    \"street\" => {\n                                        if let Value::String(s) = addr_value {\n                                            street = s;\n                                        }\n                                    }\n                                    \"city\" => {\n                                        if let Value::String(s) = addr_value {\n                                            city = s;\n                                        }\n                                    }\n                                    _ => {}\n                                }\n                            }\n                            // 插入 HashMap 键值对\n                            address.insert(\"street\", street);\n                            address.insert(\"city\", city);\n                        }\n                    }\n                    \"phone_numbers\" => {\n                        if let Value::Array(arr) = value {\n                            for num in arr {\n                                if let Value::String(s) = num {\n                                    phone_numbers.push(s.clone());\n                                }\n                            }\n                        }\n                    }\n                    _ => {}\n                }\n            }\n            println!(\"Name: {}\", name);\n            println!(\"Age: {}\", age);\n            println!(\"Address: {:?}\", address);\n            println!(\"Phone Numbers: {:?}\", phone_numbers);\n        }\n        _ => println!(\"Invalid JSON structure\"),\n    }\n    Ok(())\n}\n```","source":"_posts/70-IB-Rust-模式匹配.md","raw":"---\ntitle: IB-Rust-模式匹配\ndate: 2025-05-27 17:57:20\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson12](https://github.com/Zoella-w/IB-Rust/tree/main/12_match)\n\n\n## 概述\n\n模式匹配可以检查数据的结构并进行相应操作，提高代码的可读性和简洁性、减少错误，尤其是在处理复杂数据结构时\n\n## 基础模式匹配\n\n### `match` 表达式\n\n基本用法：match 语句可以用于模式匹配数字、字符串、枚举等\n\n```rust\nlet number = 13;\nmatch number {\n    1 => println!(\"One!\"),\n    2 => println!(\"Two!\"),\n    3 => println!(\"Three!\"),\n    _ => println!(\"Something else!\"),\n}\n```\n\n## 模式匹配的各种模式\n\n### 字面值模式\n\n```rust\nlet x = 1;\nlet y = \"Hello\";\nmatch x {\n    1 => println!(\"One\"),\n    2 => println!(\"Two\"),\n    _ => println!(\"Other\"),\n}\nmatch y {\n    \"Hello\" => println!(\"Greeting\"),\n    \"Goodbye\" => println!(\"Farewell\"),\n    _ => println!(\"Other\"),\n}\n```\n\n### 变量模式\n\n将 x 赋值给 var，注意 x 所有权的转移\n\n```rust\nlet x = 42;\nmatch x {\n    var => println!(\"The value is: {}\", var),\n}\n```\n\n### 通配符模式\n\n```rust\nmatch x {\n    _ => println!(\"Any value\"),\n}\n```\n\n### 结构模式\n\n```rust\nstruct Point { x: i32, y: i32 }\nlet p = Point { x: 0, y: 7 };\nmatch p {\n    Point { x, y: 0 } => println!(\"On the x axis at {}\", x),\n    Point { x: 0, y } => println!(\"On the y axis at {}\", y),\n    Point { x, y } => println!(\"On neither axis: ({}, {})\", x, y),\n}\n```\n\n### 元组模式、枚举模式、解构模式\n\n类似的，用于解构元组、枚举和其他复杂数据结构\n\n## 守卫和绑定\n\n守卫：在模式匹配中，可以使用守卫来添加额外的条件判断\n\n**先匹配模式，再检查条件**\n\n```rust\nlet x = 5;\nmatch x {\n    n if n % 2 == 0 => println!(\"Even\"),\n    n => println!(\"Odd\"),\n}\n```\n\n绑定：在模式匹配中，可以使用绑定来将模式中的值绑定到变量上\n\n**同时匹配模式并绑定变量**\n\n```rust\nlet x = 3\nmatch x {\n    var @ 1..=5 => println!(\"Value in range: {}\", var),\n    _ => println!(\"Out of range\"),\n}\n```\n\n## 模式匹配的应用场景\n\n- 处理错误\n- 解析命令行参数\n- 解析配置文件\n- 解析数据包\n- 解析 XML 或 JSON 等数据格式\n\n### 处理错误\n\n```rust\nfn divide(a: i32, b: i32) -> Result<i32, String> {\n    if b == 0 {\n        Err(String::from(\"Cannot divide by zero\"))\n    } else {\n        Ok(a / b)\n    }\n}\n\nmatch divide(4, 2) {\n    Ok(result) => println!(\"Result is {}\", result),\n    Err(e) => println!(\"Error: {}\", e),\n}\n```\n\n## 高级模式匹配技巧\n\n### 嵌套模式\n\n```rust\nenum Message {\n    Quit,\n    Move { x: i32, y: i32 },\n    Write(String),\n    ChangeColor(i32, i32, i32),\n}\nlet msg = Message::ChangeColor(0, 160, 255);\nmatch msg {\n    // 解构\n    Message::ChangeColor(r, g, b) => {\n        println!(\"Change the color to red {}, green {}, and blue {}\", r, g, b)\n    }\n    _ => (),\n}\n```\n\n### 模式匹配与迭代器： 结合 iter 和 match 使用\n\n```rust\nlet vec1 = vec![1, 2, 3];\nlet vec2 = vec![1, 2, 3];\nfor (a, b) in vec1.iter().zip(vec2) {\n    println!(\"{} + {} = {}\", a, b, a + b);\n}\n```\n\n### if let 和 while let： 简化单个模式匹配\n\n```rust\nlet opt = Some(5);\nif let Some(x) = opt {\n    println!(\"Matched {:?}\", x);\n}\nlet mut iter = vec![1, 2, 3].into_iter();\nwhile let Some(x) = iter.next() {\n    println!(\"Matched {:?}\", x);\n    // Matched 1\n    // Matched 2\n    // Matched 3\n}\n```\n\n### ref 和 ref mut\n\n#### 使用场景\n\n- 借用数据而不转移所有权：在某些情况下，你只需要借用数据而不是转移其所有权。例如在递归数据结构中，借用数据可以避免所有权转移带来的复杂性\n- 对数据进行修改：使用 ref mut 可以在模式匹配时对数据进行修改，而无需转移所有权\n\n```rust\nlet x = String::from(\"Hello\");\nmatch x {\n    // 借用 x 的所有权，x 所有权没有转移\n    ref r => println!(\"Got a reference to a value: {:?}\", r),\n}\nprintln!(\"x is still accessible: {}\", x);\n\nlet x = String::from(\"Hello\");\nmatch x {\n    ref mut r => {\n        *r += String::from(\"world\")\n    },\n}\n```\n\n## 课后习题\n\n编写一个使用模式匹配解析 JSON 字符串的程序\n\n- 作业目标\n  - 理解如何使用 Rust 的模式匹配功能解析 JSON 数据。\n  - 学会使用 serde_json 库进行 JSON 处理。\n  - 练习在实际应用场景中使用模式匹配。\n- 作业要求\n  - 使用 serde_json 库解析 JSON 字符串。\n  - 使用模式匹配提取 JSON 对象中的不同字段。\n  - 处理不同类型的数据（字符串、数字、数组、嵌套对象等）。\n- 作业示例\n假设你有一个包含用户信息的 JSON 字符串：\n\n```json\n{\n  \"name\": \"Alice\",\n  \"age\": 30,\n  \"email\": \"alice@example.com\",\n  \"address\": {\n    \"street\": \"123 Main St\",\n    \"city\": \"Wonderland\"\n  },\n  \"phone_numbers\": [\"123-456-7890\", \"987-654-3210\"]\n}\n```\n\n``` rust\nuse serde_json::{Result, Value};\nuse std::collections::HashMap;\n\nfn main() -> Result<()> {\n    // 原始 JSON 数据\n    // 如果字符串包含双引号，可以在开头和结尾加 #\n    let json_str = r#\"\n    {\n        \"name\": \"Alice\",\n        \"age\": 30,\n        \"email\": \"alice@example.com\",\n        \"address\": {\n            \"street\": \"123 Main St\",\n            \"city\": \"Wonderland\"\n        },\n        \"phone_numbers\": [\"123-456-7890\", \"987-654-3210\"]\n    }\n    \"#;\n\n    // 步骤 1：解析 JSON 字符串为动态类型 Value\n    // serde_json::from_str 返回 Result<Value, Error>\n    let v: Value = serde_json::from_str(json_str)?;\n\n    // 步骤 2：使用模式匹配处理 JSON 结构\n    match v {\n        Value::Object(obj) => {\n            let mut name = String::from(\"Unknown\");\n            let mut age = 0;\n            let mut address = HashMap::new();\n            let mut phone_numbers = Vec::new();\n            for (key, value) in obj {\n                match key.as_str() {\n                    \"name\" => {\n                        if let Value::String(s) = value {\n                            name = s;\n                        }\n                    }\n                    \"age\" => {\n                        if let Value::Number(n) = value {\n                            // as_i64()​​：将 JSON 数值转换为 i64 类型，返回 Option<i64>\n                            // unwrap_or(0)：解包 Option<i64>，如果值为 None，则使用默认值 0\n                            age = n.as_i64().unwrap_or(0) as i32;\n                        }\n                    }\n                    \"address\" => {\n                        if let Value::Object(addr_obj) = value {\n                            let mut street = String::from(\"Unknown\");\n                            let mut city = String::from(\"Unknown\");\n                            for (addr_key, addr_value) in addr_obj {\n                                match addr_key.as_str() {\n                                    \"street\" => {\n                                        if let Value::String(s) = addr_value {\n                                            street = s;\n                                        }\n                                    }\n                                    \"city\" => {\n                                        if let Value::String(s) = addr_value {\n                                            city = s;\n                                        }\n                                    }\n                                    _ => {}\n                                }\n                            }\n                            // 插入 HashMap 键值对\n                            address.insert(\"street\", street);\n                            address.insert(\"city\", city);\n                        }\n                    }\n                    \"phone_numbers\" => {\n                        if let Value::Array(arr) = value {\n                            for num in arr {\n                                if let Value::String(s) = num {\n                                    phone_numbers.push(s.clone());\n                                }\n                            }\n                        }\n                    }\n                    _ => {}\n                }\n            }\n            println!(\"Name: {}\", name);\n            println!(\"Age: {}\", age);\n            println!(\"Address: {:?}\", address);\n            println!(\"Phone Numbers: {:?}\", phone_numbers);\n        }\n        _ => println!(\"Invalid JSON structure\"),\n    }\n    Ok(())\n}\n```","slug":"70-IB-Rust-模式匹配","published":1,"updated":"2025-05-28T14:19:58.038Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmb81918u0000oxpr3x9ngjmy","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/12_match\" >Codes in lesson12<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>模式匹配可以检查数据的结构并进行相应操作，提高代码的可读性和简洁性、减少错误，尤其是在处理复杂数据结构时</p>\n<h2 id=\"基础模式匹配\"><a href=\"#基础模式匹配\" class=\"headerlink\" title=\"基础模式匹配\"></a>基础模式匹配</h2><h3 id=\"match-表达式\"><a href=\"#match-表达式\" class=\"headerlink\" title=\"match 表达式\"></a><code>match</code> 表达式</h3><p>基本用法：match 语句可以用于模式匹配数字、字符串、枚举等</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">number</span> = <span class=\"number\">13</span>;</span><br><span class=\"line\"><span class=\"keyword\">match</span> number &#123;</span><br><span class=\"line\">    <span class=\"number\">1</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;One!&quot;</span>),</span><br><span class=\"line\">    <span class=\"number\">2</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Two!&quot;</span>),</span><br><span class=\"line\">    <span class=\"number\">3</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Three!&quot;</span>),</span><br><span class=\"line\">    _ =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Something else!&quot;</span>),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"模式匹配的各种模式\"><a href=\"#模式匹配的各种模式\" class=\"headerlink\" title=\"模式匹配的各种模式\"></a>模式匹配的各种模式</h2><h3 id=\"字面值模式\"><a href=\"#字面值模式\" class=\"headerlink\" title=\"字面值模式\"></a>字面值模式</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">x</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">y</span> = <span class=\"string\">&quot;Hello&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">match</span> x &#123;</span><br><span class=\"line\">    <span class=\"number\">1</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;One&quot;</span>),</span><br><span class=\"line\">    <span class=\"number\">2</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Two&quot;</span>),</span><br><span class=\"line\">    _ =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Other&quot;</span>),</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">match</span> y &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;Hello&quot;</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Greeting&quot;</span>),</span><br><span class=\"line\">    <span class=\"string\">&quot;Goodbye&quot;</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Farewell&quot;</span>),</span><br><span class=\"line\">    _ =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Other&quot;</span>),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"变量模式\"><a href=\"#变量模式\" class=\"headerlink\" title=\"变量模式\"></a>变量模式</h3><p>将 x 赋值给 var，注意 x 所有权的转移</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">x</span> = <span class=\"number\">42</span>;</span><br><span class=\"line\"><span class=\"keyword\">match</span> x &#123;</span><br><span class=\"line\">    var =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;The value is: &#123;&#125;&quot;</span>, var),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"通配符模式\"><a href=\"#通配符模式\" class=\"headerlink\" title=\"通配符模式\"></a>通配符模式</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">match</span> x &#123;</span><br><span class=\"line\">    _ =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Any value&quot;</span>),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"结构模式\"><a href=\"#结构模式\" class=\"headerlink\" title=\"结构模式\"></a>结构模式</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Point</span> &#123; x: <span class=\"type\">i32</span>, y: <span class=\"type\">i32</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">p</span> = Point &#123; x: <span class=\"number\">0</span>, y: <span class=\"number\">7</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">match</span> p &#123;</span><br><span class=\"line\">    Point &#123; x, y: <span class=\"number\">0</span> &#125; =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;On the x axis at &#123;&#125;&quot;</span>, x),</span><br><span class=\"line\">    Point &#123; x: <span class=\"number\">0</span>, y &#125; =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;On the y axis at &#123;&#125;&quot;</span>, y),</span><br><span class=\"line\">    Point &#123; x, y &#125; =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;On neither axis: (&#123;&#125;, &#123;&#125;)&quot;</span>, x, y),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"元组模式、枚举模式、解构模式\"><a href=\"#元组模式、枚举模式、解构模式\" class=\"headerlink\" title=\"元组模式、枚举模式、解构模式\"></a>元组模式、枚举模式、解构模式</h3><p>类似的，用于解构元组、枚举和其他复杂数据结构</p>\n<h2 id=\"守卫和绑定\"><a href=\"#守卫和绑定\" class=\"headerlink\" title=\"守卫和绑定\"></a>守卫和绑定</h2><p>守卫：在模式匹配中，可以使用守卫来添加额外的条件判断</p>\n<p><strong>先匹配模式，再检查条件</strong></p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">x</span> = <span class=\"number\">5</span>;</span><br><span class=\"line\"><span class=\"keyword\">match</span> x &#123;</span><br><span class=\"line\">    n <span class=\"keyword\">if</span> n % <span class=\"number\">2</span> == <span class=\"number\">0</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Even&quot;</span>),</span><br><span class=\"line\">    n =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Odd&quot;</span>),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>绑定：在模式匹配中，可以使用绑定来将模式中的值绑定到变量上</p>\n<p><strong>同时匹配模式并绑定变量</strong></p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">x</span> = <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"keyword\">match</span> x &#123;</span><br><span class=\"line\">    var @ <span class=\"number\">1</span>..=<span class=\"number\">5</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Value in range: &#123;&#125;&quot;</span>, var),</span><br><span class=\"line\">    _ =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Out of range&quot;</span>),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"模式匹配的应用场景\"><a href=\"#模式匹配的应用场景\" class=\"headerlink\" title=\"模式匹配的应用场景\"></a>模式匹配的应用场景</h2><ul>\n<li>处理错误</li>\n<li>解析命令行参数</li>\n<li>解析配置文件</li>\n<li>解析数据包</li>\n<li>解析 XML 或 JSON 等数据格式</li>\n</ul>\n<h3 id=\"处理错误\"><a href=\"#处理错误\" class=\"headerlink\" title=\"处理错误\"></a>处理错误</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">divide</span>(a: <span class=\"type\">i32</span>, b: <span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;<span class=\"type\">i32</span>, <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> b == <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(<span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Cannot divide by zero&quot;</span>))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(a / b)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">match</span> <span class=\"title function_ invoke__\">divide</span>(<span class=\"number\">4</span>, <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Ok</span>(result) =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Result is &#123;&#125;&quot;</span>, result),</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Err</span>(e) =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Error: &#123;&#125;&quot;</span>, e),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"高级模式匹配技巧\"><a href=\"#高级模式匹配技巧\" class=\"headerlink\" title=\"高级模式匹配技巧\"></a>高级模式匹配技巧</h2><h3 id=\"嵌套模式\"><a href=\"#嵌套模式\" class=\"headerlink\" title=\"嵌套模式\"></a>嵌套模式</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Message</span> &#123;</span><br><span class=\"line\">    Quit,</span><br><span class=\"line\">    Move &#123; x: <span class=\"type\">i32</span>, y: <span class=\"type\">i32</span> &#125;,</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Write</span>(<span class=\"type\">String</span>),</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">ChangeColor</span>(<span class=\"type\">i32</span>, <span class=\"type\">i32</span>, <span class=\"type\">i32</span>),</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">msg</span> = Message::<span class=\"title function_ invoke__\">ChangeColor</span>(<span class=\"number\">0</span>, <span class=\"number\">160</span>, <span class=\"number\">255</span>);</span><br><span class=\"line\"><span class=\"keyword\">match</span> msg &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 解构</span></span><br><span class=\"line\">    Message::<span class=\"title function_ invoke__\">ChangeColor</span>(r, g, b) =&gt; &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Change the color to red &#123;&#125;, green &#123;&#125;, and blue &#123;&#125;&quot;</span>, r, g, b)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    _ =&gt; (),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"模式匹配与迭代器：-结合-iter-和-match-使用\"><a href=\"#模式匹配与迭代器：-结合-iter-和-match-使用\" class=\"headerlink\" title=\"模式匹配与迭代器： 结合 iter 和 match 使用\"></a>模式匹配与迭代器： 结合 iter 和 match 使用</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">vec1</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">vec2</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"keyword\">for</span> (a, b) <span class=\"keyword\">in</span> vec1.<span class=\"title function_ invoke__\">iter</span>().<span class=\"title function_ invoke__\">zip</span>(vec2) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125; + &#123;&#125; = &#123;&#125;&quot;</span>, a, b, a + b);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"if-let-和-while-let：-简化单个模式匹配\"><a href=\"#if-let-和-while-let：-简化单个模式匹配\" class=\"headerlink\" title=\"if let 和 while let： 简化单个模式匹配\"></a>if let 和 while let： 简化单个模式匹配</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">opt</span> = <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">5</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Some</span>(x) = opt &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Matched &#123;:?&#125;&quot;</span>, x);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">iter</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>].<span class=\"title function_ invoke__\">into_iter</span>();</span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"keyword\">let</span> <span class=\"variable\">Some</span>(x) = iter.<span class=\"title function_ invoke__\">next</span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Matched &#123;:?&#125;&quot;</span>, x);</span><br><span class=\"line\">    <span class=\"comment\">// Matched 1</span></span><br><span class=\"line\">    <span class=\"comment\">// Matched 2</span></span><br><span class=\"line\">    <span class=\"comment\">// Matched 3</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"ref-和-ref-mut\"><a href=\"#ref-和-ref-mut\" class=\"headerlink\" title=\"ref 和 ref mut\"></a>ref 和 ref mut</h3><h4 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h4><ul>\n<li>借用数据而不转移所有权：在某些情况下，你只需要借用数据而不是转移其所有权。例如在递归数据结构中，借用数据可以避免所有权转移带来的复杂性</li>\n<li>对数据进行修改：使用 ref mut 可以在模式匹配时对数据进行修改，而无需转移所有权</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">x</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Hello&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">match</span> x &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 借用 x 的所有权，x 所有权没有转移</span></span><br><span class=\"line\">    <span class=\"keyword\">ref</span> r =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Got a reference to a value: &#123;:?&#125;&quot;</span>, r),</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;x is still accessible: &#123;&#125;&quot;</span>, x);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">x</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Hello&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">match</span> x &#123;</span><br><span class=\"line\">    <span class=\"keyword\">ref</span> <span class=\"keyword\">mut</span> r =&gt; &#123;</span><br><span class=\"line\">        *r += <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;world&quot;</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"课后习题\"><a href=\"#课后习题\" class=\"headerlink\" title=\"课后习题\"></a>课后习题</h2><p>编写一个使用模式匹配解析 JSON 字符串的程序</p>\n<ul>\n<li>作业目标<ul>\n<li>理解如何使用 Rust 的模式匹配功能解析 JSON 数据。</li>\n<li>学会使用 serde_json 库进行 JSON 处理。</li>\n<li>练习在实际应用场景中使用模式匹配。</li>\n</ul>\n</li>\n<li>作业要求<ul>\n<li>使用 serde_json 库解析 JSON 字符串。</li>\n<li>使用模式匹配提取 JSON 对象中的不同字段。</li>\n<li>处理不同类型的数据（字符串、数字、数组、嵌套对象等）。</li>\n</ul>\n</li>\n<li>作业示例<br>假设你有一个包含用户信息的 JSON 字符串：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Json\"><figure class=\"iseeu highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Alice&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;age&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">30</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;email&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;alice@example.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;address&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;street&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;123 Main St&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;city&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Wonderland&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;phone_numbers&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"string\">&quot;123-456-7890&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;987-654-3210&quot;</span><span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> serde_json::&#123;<span class=\"type\">Result</span>, Value&#125;;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::collections::HashMap;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;()&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 原始 JSON 数据</span></span><br><span class=\"line\">    <span class=\"comment\">// 如果字符串包含双引号，可以在开头和结尾加 #</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">json_str</span> = <span class=\"string\">r#&quot;</span></span><br><span class=\"line\"><span class=\"string\">    &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;name&quot;: &quot;Alice&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;age&quot;: 30,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;email&quot;: &quot;alice@example.com&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;address&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;street&quot;: &quot;123 Main St&quot;,</span></span><br><span class=\"line\"><span class=\"string\">            &quot;city&quot;: &quot;Wonderland&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;phone_numbers&quot;: [&quot;123-456-7890&quot;, &quot;987-654-3210&quot;]</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;#</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 步骤 1：解析 JSON 字符串为动态类型 Value</span></span><br><span class=\"line\">    <span class=\"comment\">// serde_json::from_str 返回 Result&lt;Value, Error&gt;</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">v</span>: Value = serde_json::<span class=\"title function_ invoke__\">from_str</span>(json_str)?;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 步骤 2：使用模式匹配处理 JSON 结构</span></span><br><span class=\"line\">    <span class=\"keyword\">match</span> v &#123;</span><br><span class=\"line\">        Value::<span class=\"title function_ invoke__\">Object</span>(obj) =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">name</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Unknown&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">age</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">address</span> = HashMap::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">phone_numbers</span> = <span class=\"type\">Vec</span>::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (key, value) <span class=\"keyword\">in</span> obj &#123;</span><br><span class=\"line\">                <span class=\"keyword\">match</span> key.<span class=\"title function_ invoke__\">as_str</span>() &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;name&quot;</span> =&gt; &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Value</span>::<span class=\"title function_ invoke__\">String</span>(s) = value &#123;</span><br><span class=\"line\">                            name = s;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"string\">&quot;age&quot;</span> =&gt; &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Value</span>::<span class=\"title function_ invoke__\">Number</span>(n) = value &#123;</span><br><span class=\"line\">                            <span class=\"comment\">// as_i64()​​：将 JSON 数值转换为 i64 类型，返回 Option&lt;i64&gt;</span></span><br><span class=\"line\">                            <span class=\"comment\">// unwrap_or(0)：解包 Option&lt;i64&gt;，如果值为 None，则使用默认值 0</span></span><br><span class=\"line\">                            age = n.<span class=\"title function_ invoke__\">as_i64</span>().<span class=\"title function_ invoke__\">unwrap_or</span>(<span class=\"number\">0</span>) <span class=\"keyword\">as</span> <span class=\"type\">i32</span>;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"string\">&quot;address&quot;</span> =&gt; &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Value</span>::<span class=\"title function_ invoke__\">Object</span>(addr_obj) = value &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">street</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Unknown&quot;</span>);</span><br><span class=\"line\">                            <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">city</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Unknown&quot;</span>);</span><br><span class=\"line\">                            <span class=\"keyword\">for</span> (addr_key, addr_value) <span class=\"keyword\">in</span> addr_obj &#123;</span><br><span class=\"line\">                                <span class=\"keyword\">match</span> addr_key.<span class=\"title function_ invoke__\">as_str</span>() &#123;</span><br><span class=\"line\">                                    <span class=\"string\">&quot;street&quot;</span> =&gt; &#123;</span><br><span class=\"line\">                                        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Value</span>::<span class=\"title function_ invoke__\">String</span>(s) = addr_value &#123;</span><br><span class=\"line\">                                            street = s;</span><br><span class=\"line\">                                        &#125;</span><br><span class=\"line\">                                    &#125;</span><br><span class=\"line\">                                    <span class=\"string\">&quot;city&quot;</span> =&gt; &#123;</span><br><span class=\"line\">                                        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Value</span>::<span class=\"title function_ invoke__\">String</span>(s) = addr_value &#123;</span><br><span class=\"line\">                                            city = s;</span><br><span class=\"line\">                                        &#125;</span><br><span class=\"line\">                                    &#125;</span><br><span class=\"line\">                                    _ =&gt; &#123;&#125;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"comment\">// 插入 HashMap 键值对</span></span><br><span class=\"line\">                            address.<span class=\"title function_ invoke__\">insert</span>(<span class=\"string\">&quot;street&quot;</span>, street);</span><br><span class=\"line\">                            address.<span class=\"title function_ invoke__\">insert</span>(<span class=\"string\">&quot;city&quot;</span>, city);</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"string\">&quot;phone_numbers&quot;</span> =&gt; &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Value</span>::<span class=\"title function_ invoke__\">Array</span>(arr) = value &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">for</span> <span class=\"variable\">num</span> <span class=\"keyword\">in</span> arr &#123;</span><br><span class=\"line\">                                <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Value</span>::<span class=\"title function_ invoke__\">String</span>(s) = num &#123;</span><br><span class=\"line\">                                    phone_numbers.<span class=\"title function_ invoke__\">push</span>(s.<span class=\"title function_ invoke__\">clone</span>());</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    _ =&gt; &#123;&#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Name: &#123;&#125;&quot;</span>, name);</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Age: &#123;&#125;&quot;</span>, age);</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Address: &#123;:?&#125;&quot;</span>, address);</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Phone Numbers: &#123;:?&#125;&quot;</span>, phone_numbers);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        _ =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Invalid JSON structure&quot;</span>),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Ok</span>(())</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/12_match\" >Codes in lesson12<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>模式匹配可以检查数据的结构并进行相应操作，提高代码的可读性和简洁性、减少错误，尤其是在处理复杂数据结构时</p>\n<h2 id=\"基础模式匹配\"><a href=\"#基础模式匹配\" class=\"headerlink\" title=\"基础模式匹配\"></a>基础模式匹配</h2><h3 id=\"match-表达式\"><a href=\"#match-表达式\" class=\"headerlink\" title=\"match 表达式\"></a><code>match</code> 表达式</h3><p>基本用法：match 语句可以用于模式匹配数字、字符串、枚举等</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">number</span> = <span class=\"number\">13</span>;</span><br><span class=\"line\"><span class=\"keyword\">match</span> number &#123;</span><br><span class=\"line\">    <span class=\"number\">1</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;One!&quot;</span>),</span><br><span class=\"line\">    <span class=\"number\">2</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Two!&quot;</span>),</span><br><span class=\"line\">    <span class=\"number\">3</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Three!&quot;</span>),</span><br><span class=\"line\">    _ =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Something else!&quot;</span>),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"模式匹配的各种模式\"><a href=\"#模式匹配的各种模式\" class=\"headerlink\" title=\"模式匹配的各种模式\"></a>模式匹配的各种模式</h2><h3 id=\"字面值模式\"><a href=\"#字面值模式\" class=\"headerlink\" title=\"字面值模式\"></a>字面值模式</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">x</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">y</span> = <span class=\"string\">&quot;Hello&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">match</span> x &#123;</span><br><span class=\"line\">    <span class=\"number\">1</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;One&quot;</span>),</span><br><span class=\"line\">    <span class=\"number\">2</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Two&quot;</span>),</span><br><span class=\"line\">    _ =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Other&quot;</span>),</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">match</span> y &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;Hello&quot;</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Greeting&quot;</span>),</span><br><span class=\"line\">    <span class=\"string\">&quot;Goodbye&quot;</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Farewell&quot;</span>),</span><br><span class=\"line\">    _ =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Other&quot;</span>),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"变量模式\"><a href=\"#变量模式\" class=\"headerlink\" title=\"变量模式\"></a>变量模式</h3><p>将 x 赋值给 var，注意 x 所有权的转移</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">x</span> = <span class=\"number\">42</span>;</span><br><span class=\"line\"><span class=\"keyword\">match</span> x &#123;</span><br><span class=\"line\">    var =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;The value is: &#123;&#125;&quot;</span>, var),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"通配符模式\"><a href=\"#通配符模式\" class=\"headerlink\" title=\"通配符模式\"></a>通配符模式</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">match</span> x &#123;</span><br><span class=\"line\">    _ =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Any value&quot;</span>),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"结构模式\"><a href=\"#结构模式\" class=\"headerlink\" title=\"结构模式\"></a>结构模式</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Point</span> &#123; x: <span class=\"type\">i32</span>, y: <span class=\"type\">i32</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">p</span> = Point &#123; x: <span class=\"number\">0</span>, y: <span class=\"number\">7</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">match</span> p &#123;</span><br><span class=\"line\">    Point &#123; x, y: <span class=\"number\">0</span> &#125; =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;On the x axis at &#123;&#125;&quot;</span>, x),</span><br><span class=\"line\">    Point &#123; x: <span class=\"number\">0</span>, y &#125; =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;On the y axis at &#123;&#125;&quot;</span>, y),</span><br><span class=\"line\">    Point &#123; x, y &#125; =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;On neither axis: (&#123;&#125;, &#123;&#125;)&quot;</span>, x, y),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"元组模式、枚举模式、解构模式\"><a href=\"#元组模式、枚举模式、解构模式\" class=\"headerlink\" title=\"元组模式、枚举模式、解构模式\"></a>元组模式、枚举模式、解构模式</h3><p>类似的，用于解构元组、枚举和其他复杂数据结构</p>\n<h2 id=\"守卫和绑定\"><a href=\"#守卫和绑定\" class=\"headerlink\" title=\"守卫和绑定\"></a>守卫和绑定</h2><p>守卫：在模式匹配中，可以使用守卫来添加额外的条件判断</p>\n<p><strong>先匹配模式，再检查条件</strong></p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">x</span> = <span class=\"number\">5</span>;</span><br><span class=\"line\"><span class=\"keyword\">match</span> x &#123;</span><br><span class=\"line\">    n <span class=\"keyword\">if</span> n % <span class=\"number\">2</span> == <span class=\"number\">0</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Even&quot;</span>),</span><br><span class=\"line\">    n =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Odd&quot;</span>),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>绑定：在模式匹配中，可以使用绑定来将模式中的值绑定到变量上</p>\n<p><strong>同时匹配模式并绑定变量</strong></p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">x</span> = <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"keyword\">match</span> x &#123;</span><br><span class=\"line\">    var @ <span class=\"number\">1</span>..=<span class=\"number\">5</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Value in range: &#123;&#125;&quot;</span>, var),</span><br><span class=\"line\">    _ =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Out of range&quot;</span>),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"模式匹配的应用场景\"><a href=\"#模式匹配的应用场景\" class=\"headerlink\" title=\"模式匹配的应用场景\"></a>模式匹配的应用场景</h2><ul>\n<li>处理错误</li>\n<li>解析命令行参数</li>\n<li>解析配置文件</li>\n<li>解析数据包</li>\n<li>解析 XML 或 JSON 等数据格式</li>\n</ul>\n<h3 id=\"处理错误\"><a href=\"#处理错误\" class=\"headerlink\" title=\"处理错误\"></a>处理错误</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">divide</span>(a: <span class=\"type\">i32</span>, b: <span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;<span class=\"type\">i32</span>, <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> b == <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(<span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Cannot divide by zero&quot;</span>))</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(a / b)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">match</span> <span class=\"title function_ invoke__\">divide</span>(<span class=\"number\">4</span>, <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Ok</span>(result) =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Result is &#123;&#125;&quot;</span>, result),</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Err</span>(e) =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Error: &#123;&#125;&quot;</span>, e),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"高级模式匹配技巧\"><a href=\"#高级模式匹配技巧\" class=\"headerlink\" title=\"高级模式匹配技巧\"></a>高级模式匹配技巧</h2><h3 id=\"嵌套模式\"><a href=\"#嵌套模式\" class=\"headerlink\" title=\"嵌套模式\"></a>嵌套模式</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Message</span> &#123;</span><br><span class=\"line\">    Quit,</span><br><span class=\"line\">    Move &#123; x: <span class=\"type\">i32</span>, y: <span class=\"type\">i32</span> &#125;,</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Write</span>(<span class=\"type\">String</span>),</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">ChangeColor</span>(<span class=\"type\">i32</span>, <span class=\"type\">i32</span>, <span class=\"type\">i32</span>),</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">msg</span> = Message::<span class=\"title function_ invoke__\">ChangeColor</span>(<span class=\"number\">0</span>, <span class=\"number\">160</span>, <span class=\"number\">255</span>);</span><br><span class=\"line\"><span class=\"keyword\">match</span> msg &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 解构</span></span><br><span class=\"line\">    Message::<span class=\"title function_ invoke__\">ChangeColor</span>(r, g, b) =&gt; &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Change the color to red &#123;&#125;, green &#123;&#125;, and blue &#123;&#125;&quot;</span>, r, g, b)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    _ =&gt; (),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"模式匹配与迭代器：-结合-iter-和-match-使用\"><a href=\"#模式匹配与迭代器：-结合-iter-和-match-使用\" class=\"headerlink\" title=\"模式匹配与迭代器： 结合 iter 和 match 使用\"></a>模式匹配与迭代器： 结合 iter 和 match 使用</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">vec1</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">vec2</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"keyword\">for</span> (a, b) <span class=\"keyword\">in</span> vec1.<span class=\"title function_ invoke__\">iter</span>().<span class=\"title function_ invoke__\">zip</span>(vec2) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125; + &#123;&#125; = &#123;&#125;&quot;</span>, a, b, a + b);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"if-let-和-while-let：-简化单个模式匹配\"><a href=\"#if-let-和-while-let：-简化单个模式匹配\" class=\"headerlink\" title=\"if let 和 while let： 简化单个模式匹配\"></a>if let 和 while let： 简化单个模式匹配</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">opt</span> = <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">5</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Some</span>(x) = opt &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Matched &#123;:?&#125;&quot;</span>, x);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">iter</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>].<span class=\"title function_ invoke__\">into_iter</span>();</span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"keyword\">let</span> <span class=\"variable\">Some</span>(x) = iter.<span class=\"title function_ invoke__\">next</span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Matched &#123;:?&#125;&quot;</span>, x);</span><br><span class=\"line\">    <span class=\"comment\">// Matched 1</span></span><br><span class=\"line\">    <span class=\"comment\">// Matched 2</span></span><br><span class=\"line\">    <span class=\"comment\">// Matched 3</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ref-和-ref-mut\"><a href=\"#ref-和-ref-mut\" class=\"headerlink\" title=\"ref 和 ref mut\"></a>ref 和 ref mut</h3><h4 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h4><ul>\n<li>借用数据而不转移所有权：在某些情况下，你只需要借用数据而不是转移其所有权。例如在递归数据结构中，借用数据可以避免所有权转移带来的复杂性</li>\n<li>对数据进行修改：使用 ref mut 可以在模式匹配时对数据进行修改，而无需转移所有权</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">x</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Hello&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">match</span> x &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 借用 x 的所有权，x 所有权没有转移</span></span><br><span class=\"line\">    <span class=\"keyword\">ref</span> r =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Got a reference to a value: &#123;:?&#125;&quot;</span>, r),</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;x is still accessible: &#123;&#125;&quot;</span>, x);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">x</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Hello&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">match</span> x &#123;</span><br><span class=\"line\">    <span class=\"keyword\">ref</span> <span class=\"keyword\">mut</span> r =&gt; &#123;</span><br><span class=\"line\">        *r += <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;world&quot;</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"课后习题\"><a href=\"#课后习题\" class=\"headerlink\" title=\"课后习题\"></a>课后习题</h2><p>编写一个使用模式匹配解析 JSON 字符串的程序</p>\n<ul>\n<li>作业目标<ul>\n<li>理解如何使用 Rust 的模式匹配功能解析 JSON 数据。</li>\n<li>学会使用 serde_json 库进行 JSON 处理。</li>\n<li>练习在实际应用场景中使用模式匹配。</li>\n</ul>\n</li>\n<li>作业要求<ul>\n<li>使用 serde_json 库解析 JSON 字符串。</li>\n<li>使用模式匹配提取 JSON 对象中的不同字段。</li>\n<li>处理不同类型的数据（字符串、数字、数组、嵌套对象等）。</li>\n</ul>\n</li>\n<li>作业示例<br>假设你有一个包含用户信息的 JSON 字符串：</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Alice&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;age&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">30</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;email&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;alice@example.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;address&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;street&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;123 Main St&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;city&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Wonderland&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;phone_numbers&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"string\">&quot;123-456-7890&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;987-654-3210&quot;</span><span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> serde_json::&#123;<span class=\"type\">Result</span>, Value&#125;;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::collections::HashMap;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;()&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 原始 JSON 数据</span></span><br><span class=\"line\">    <span class=\"comment\">// 如果字符串包含双引号，可以在开头和结尾加 #</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">json_str</span> = <span class=\"string\">r#&quot;</span></span><br><span class=\"line\"><span class=\"string\">    &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;name&quot;: &quot;Alice&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;age&quot;: 30,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;email&quot;: &quot;alice@example.com&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;address&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;street&quot;: &quot;123 Main St&quot;,</span></span><br><span class=\"line\"><span class=\"string\">            &quot;city&quot;: &quot;Wonderland&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;phone_numbers&quot;: [&quot;123-456-7890&quot;, &quot;987-654-3210&quot;]</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;#</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 步骤 1：解析 JSON 字符串为动态类型 Value</span></span><br><span class=\"line\">    <span class=\"comment\">// serde_json::from_str 返回 Result&lt;Value, Error&gt;</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">v</span>: Value = serde_json::<span class=\"title function_ invoke__\">from_str</span>(json_str)?;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 步骤 2：使用模式匹配处理 JSON 结构</span></span><br><span class=\"line\">    <span class=\"keyword\">match</span> v &#123;</span><br><span class=\"line\">        Value::<span class=\"title function_ invoke__\">Object</span>(obj) =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">name</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Unknown&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">age</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">address</span> = HashMap::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">phone_numbers</span> = <span class=\"type\">Vec</span>::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (key, value) <span class=\"keyword\">in</span> obj &#123;</span><br><span class=\"line\">                <span class=\"keyword\">match</span> key.<span class=\"title function_ invoke__\">as_str</span>() &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;name&quot;</span> =&gt; &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Value</span>::<span class=\"title function_ invoke__\">String</span>(s) = value &#123;</span><br><span class=\"line\">                            name = s;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"string\">&quot;age&quot;</span> =&gt; &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Value</span>::<span class=\"title function_ invoke__\">Number</span>(n) = value &#123;</span><br><span class=\"line\">                            <span class=\"comment\">// as_i64()​​：将 JSON 数值转换为 i64 类型，返回 Option&lt;i64&gt;</span></span><br><span class=\"line\">                            <span class=\"comment\">// unwrap_or(0)：解包 Option&lt;i64&gt;，如果值为 None，则使用默认值 0</span></span><br><span class=\"line\">                            age = n.<span class=\"title function_ invoke__\">as_i64</span>().<span class=\"title function_ invoke__\">unwrap_or</span>(<span class=\"number\">0</span>) <span class=\"keyword\">as</span> <span class=\"type\">i32</span>;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"string\">&quot;address&quot;</span> =&gt; &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Value</span>::<span class=\"title function_ invoke__\">Object</span>(addr_obj) = value &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">street</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Unknown&quot;</span>);</span><br><span class=\"line\">                            <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">city</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Unknown&quot;</span>);</span><br><span class=\"line\">                            <span class=\"keyword\">for</span> (addr_key, addr_value) <span class=\"keyword\">in</span> addr_obj &#123;</span><br><span class=\"line\">                                <span class=\"keyword\">match</span> addr_key.<span class=\"title function_ invoke__\">as_str</span>() &#123;</span><br><span class=\"line\">                                    <span class=\"string\">&quot;street&quot;</span> =&gt; &#123;</span><br><span class=\"line\">                                        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Value</span>::<span class=\"title function_ invoke__\">String</span>(s) = addr_value &#123;</span><br><span class=\"line\">                                            street = s;</span><br><span class=\"line\">                                        &#125;</span><br><span class=\"line\">                                    &#125;</span><br><span class=\"line\">                                    <span class=\"string\">&quot;city&quot;</span> =&gt; &#123;</span><br><span class=\"line\">                                        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Value</span>::<span class=\"title function_ invoke__\">String</span>(s) = addr_value &#123;</span><br><span class=\"line\">                                            city = s;</span><br><span class=\"line\">                                        &#125;</span><br><span class=\"line\">                                    &#125;</span><br><span class=\"line\">                                    _ =&gt; &#123;&#125;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"comment\">// 插入 HashMap 键值对</span></span><br><span class=\"line\">                            address.<span class=\"title function_ invoke__\">insert</span>(<span class=\"string\">&quot;street&quot;</span>, street);</span><br><span class=\"line\">                            address.<span class=\"title function_ invoke__\">insert</span>(<span class=\"string\">&quot;city&quot;</span>, city);</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"string\">&quot;phone_numbers&quot;</span> =&gt; &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Value</span>::<span class=\"title function_ invoke__\">Array</span>(arr) = value &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">for</span> <span class=\"variable\">num</span> <span class=\"keyword\">in</span> arr &#123;</span><br><span class=\"line\">                                <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Value</span>::<span class=\"title function_ invoke__\">String</span>(s) = num &#123;</span><br><span class=\"line\">                                    phone_numbers.<span class=\"title function_ invoke__\">push</span>(s.<span class=\"title function_ invoke__\">clone</span>());</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    _ =&gt; &#123;&#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Name: &#123;&#125;&quot;</span>, name);</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Age: &#123;&#125;&quot;</span>, age);</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Address: &#123;:?&#125;&quot;</span>, address);</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Phone Numbers: &#123;:?&#125;&quot;</span>, phone_numbers);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        _ =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Invalid JSON structure&quot;</span>),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Ok</span>(())</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","_processedHighlight":true},{"title":"IB-Rust-常见集合","date":"2025-05-28T14:24:21.000Z","_content":"\n[Codes in lesson13](https://github.com/Zoella-w/IB-Rust/tree/main/13_collection)\n\nRust 中的常见集合有 Vector 和 HashMap\n\n## Vector\n\n### 什么是 Vec\n\nVec 是一个动态数组，可以根据需要动态增长和缩小，适用于需要按顺序存储数据的场景\n\n### Vec 的基本操作\n\n#### 创建和初始化\n\n```rust\nlet v: Vec<i32> = Vec::new();\nlet v = vec![1, 2, 3];\n```\n\n#### 添加元素\n\n```rust\n// let mut v = vec![1, 2, 3];\nv.push(1);\n```\n\n#### 访问元素\n\n```rust\nlet v = vec![1, 2, 3];\n\n// 直接引用访问\nlet third = &v[2];\nprintln!(\"third: {third}\");\n\n// 使用 get 访问\nmatch v.get(2) {\n    Some(val) => println!(\"value: {val}\"),\n    None => println!(\"Index error\"),\n};\n```\n\n#### 修改元素\n\n```rust\nlet mut v = vec![1, 2, 3];\nv[0] = 0;\n```\n\n#### 遍历元素\n\n```rust\n// 如果不用引用，v 的所有权会被转移\nfor i in &v {\n    println!(\"i: {i}\");\n}\n```\n\n### Vec 的进阶用法\n\n#### 使用枚举存储多种类型\n\n```rust\nenum SpreadSheetCell {\n    Int(i32),\n    Float(f64),\n    Test(String),\n}\nlet row = vec![\n    SpreadSheetCell::Int(3),\n    SpreadSheetCell::Float(10.12),\n    SpreadSheetCell::Test(String::from(\"Hello\")),\n];\n```\n\n#### 容量与重新分配\n\n```rust\nlet mut v: Vec<i32> = Vec::with_capacity(10);\nprintln!(\"capacity: {}\", v.capacity()); // 10\nv.push(1);\nprintln!(\"capacity: {}\", v.capacity()); // 10\n```\n\n### Vec 的常见陷阱\n\n#### 不安全的索引访问\n\n用 if 判断索引是否合法，或者使用 match\n\n#### 可变引用与不可变引用的混用\n\n```rust\n// let mut v = vec![1, 2, 3];\n// let first = &v[0]; // 不可变借用\n// v.push(4); // 可变借用，error: mutable borrow occurs here\n// println!(\"The first element is : {}\", first);\n\nlet mut v = vec![1, 2, 3];\n{\n    let first = &v[0]; // 不可变借用\n    println!(\"The first element is : {}\", first);\n}\nv.push(4); // 可变借用，error: mutable borrow occurs here\nprintln!(\"v: {:?}\", v);\n```\n\n## HashMap\n\n### 什么是 HashMap\n\nHashMap 是一个键值对（key-value）存储的数据结构，适用于需要快速查找数据的场景\n\n### HashMap 的基本操作\n\n#### 创建和初始化\n\n```rust\nlet mut scores: HashMap<_, _> = HashMap::new();\nscores.insert(String::from(\"Blue\"), 10);\nscores.insert(String::from(\"yellow\"), 50);\n```\n\n#### 访问元素\n\n```rust\nlet team_name = String::from(\"Blue\");\nlet score = scores.get(&team_name);\nmatch score {\n    Some(s) => println!(\"The {} score is {}\", team_name, s),\n    None => println!(\"No score for this team\"),\n};\n```\n\n#### 遍历元素\n\n```rust\n// 使用引用防止所有权转移\nfor (team, score) in &scores {\n    println!(\"{}: {}\", team, score);\n}\n```\n\n### HashMap 的进阶用法\n\n#### 更新哈希表\n\n```rust\nscores.insert(String::from(\"Blue\"), 25);\nscores.entry(String::from(\"Yellow\")).or_insert(100);\n\nlet entry = scores.entry(String::from(\"Red\")).or_insert(30);\nprintln!(\"entry: {entry}\"); // 30\n*entry += 10;\nprintln!(\"entry: {entry}\"); // 40\nprintln!(\"{:?}\", scores);\n```\n\n#### 合并哈希表\n\n```rust\nlet mut map1 = HashMap::new();\nmap1.insert(\"a\", 1);\nmap1.insert(\"b\", 2);\nlet mut map2 = HashMap::new();\nmap2.insert(\"b\", 3);\nmap2.insert(\"c\", 4);\nfor (k, v) in map2 {\n    // map1.insert(k, v);\n    map1.entry(k).or_insert(v);\n}\n```\n\n#### 生成哈希 key\n\n```rust\nuse std::hash::{DefaultHasher, Hash, Hasher};\n\nfn calculate_hash<T: Hash>(t: &T) -> u64 {\n    let mut s = DefaultHasher::new();\n    t.hash(&mut s);\n    s.finish()\n}\n\nfn hashmap_study() {\n    let key1 = String::from(\"key1\");\n    let key2 = String::from(\"key2\");\n    println!(\n        \"hash of key1: {}, and key2: {}\",\n        calculate_hash(&key1),\n        calculate_hash(&key2)\n    );\n}\n```\n\n### HashMap 的常见陷阱\n\n#### 哈希冲突\n\n使用 `.entry().or_insert()`\n\n#### 值的所有权问题\n\n```rust\nlet field_name = String::from(\"color\");\nlet field_value = String::from(\"Blue\");\nlet mut map = HashMap::new();\n// map.insert(field_name, field_value);\n// println!(\"field_name: {}\", field_name); // error: value borrowed here after move\nmap.insert(field_name.clone(), field_value.clone());\nprintln!(\"field_name: {}\", field_name);\n```\n\n## 练习题\n### 练习 1\n使用 Vec 实现一个简单的栈\n实现一个简单的栈（后进先出，LIFO）数据结构，支持 push、pop 和 peek 操作。\n\n``` rust\nstruct Stack<T> {\n    elements: Vec<T>,\n}\n\nimpl<T> Stack<T> {\n    fn new() -> Self {\n        {\n            Stack {\n                elements: Vec::new(),\n            }\n        }\n    }\n\n    fn push(&mut self, item: T) {\n        self.elements.push(item);\n    }\n\n    fn pop(&mut self) -> Option<T> {\n        self.elements.pop()\n    }\n\n    fn peek(&self) -> Option<&T> {\n        self.elements.last()\n    }\n}\n\nfn main() {\n    let mut stack = Stack::new();\n\n    // 压入元素\n    stack.push(1);\n    stack.push(2);\n    stack.push(3);\n\n    // 查看栈顶\n    assert_eq!(stack.peek(), Some(&3));\n\n    // 弹出元素\n    assert_eq!(stack.pop(), Some(3));\n    assert_eq!(stack.peek(), Some(&2));\n\n    // 继续弹出和压入\n    assert_eq!(stack.pop(), Some(2));\n    stack.push(4);\n    assert_eq!(stack.peek(), Some(&4));\n\n    // 清空栈\n    assert_eq!(stack.pop(), Some(4));\n    assert_eq!(stack.pop(), Some(1));\n    assert_eq!(stack.pop(), None); // 空栈时返回 None\n    assert_eq!(stack.peek(), None); // 空栈时返回 None\n}\n```\n\n### 练习 2\n使用 HashMap 实现一个字频统计器\n编写一个程序，统计一个字符串中每个单词出现的频率。\n\n``` rust\nuse std::collections::HashMap;\n\nfn word_frequency(text: &str) -> HashMap<String, u32> {\n    let mut frequency_map = HashMap::new();\n    for word in text.split_whitespace() {\n        // 清理单词并转换为 String（拥有所有权）\n        let cleaned_word = word\n            .chars() // 将单词分解为字符迭代器\n            .filter(|c| c.is_alphanumeric()) // 保留字母和数字字符，过滤标点符号\n            .collect::<String>() // 将过滤后的字符收集为 String\n            .to_lowercase();\n        if cleaned_word.is_empty() {\n            continue;\n        }\n        // 使用 String 作为键（拥有所有权）\n        *frequency_map.entry(cleaned_word).or_insert(0) += 1;\n    }\n    frequency_map\n}\n\nfn main() {\n    let text = \"Hello world! Hello Rust. Rust is awesome. World says hello to Rust.\";\n    let frequency = word_frequency(text);\n\n    println!(\"Word frequency:\");\n    for (word, count) in &frequency {\n        println!(\"{}: {}\", word, count);\n    }\n\n    // 验证结果\n    assert_eq!(frequency.get(\"hello\"), Some(&3));\n    assert_eq!(frequency.get(\"rust\"), Some(&3));\n    assert_eq!(frequency.get(\"world\"), Some(&2));\n    assert_eq!(frequency.get(\"is\"), Some(&1));\n    assert_eq!(frequency.get(\"says\"), Some(&1));\n    assert_eq!(frequency.get(\"to\"), Some(&1));\n    assert_eq!(frequency.get(\"awesome\"), Some(&1));\n}\n```\n\n### 练习3\n综合练习：使用 Vec 和 HashMap 实现一个简单的书籍库存管理系统\n实现一个书籍库存管理系统，可以添加书籍、查询库存、更新库存以及删除书籍。\n\n``` rust\nuse std::collections::HashMap;\nuse std::fmt;\n\n// 书籍结构体\n#[derive(Debug, Clone)]\nstruct Book {\n    id: u32,        // 唯一标识符\n    title: String,  // 书名\n    author: String, // 作者\n    price: f64,     // 价格\n    quantity: u32,  // 库存数量\n}\n\nimpl Book {\n    // 创建新书籍\n    fn new(id: u32, title: &str, author: &str, price: f64, quantity: u32) -> Self {\n        Book {\n            id,\n            title: title.to_string(),\n            author: author.to_string(),\n            price,\n            quantity,\n        }\n    }\n}\n\n// 为 Book 实现 Display trait 以便打印\nimpl fmt::Display for Book {\n    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n        write!(\n            f,\n            \"ID: {}, Title: '{}', Author: '{}', Price: ${:.2}, Quantity: {}\",\n            self.id, self.title, self.author, self.price, self.quantity\n        )\n    }\n}\n\n// 库存管理系统\nstruct InventoryManager {\n    books_by_id: HashMap<u32, Book>,           // 按 ID 快速查找\n    books_by_title: HashMap<String, Vec<u32>>, // 按书名查找 ID 列表\n    next_id: u32,                              // 下一个可用 ID\n}\n\nimpl InventoryManager {\n    // 创建新的库存管理系统\n    fn new() -> Self {\n        InventoryManager {\n            books_by_id: HashMap::new(),\n            books_by_title: HashMap::new(),\n            next_id: 1,\n        }\n    }\n\n    // 添加新书\n    fn add_book(&mut self, title: &str, author: &str, price: f64, quantity: u32) {\n        let id = self.next_id;\n        self.next_id += 1;\n        let book = Book::new(id, title, author, price, quantity);\n        // 添加到 ID 索引\n        self.books_by_id.insert(id, book.clone());\n        // 添加到书名索引\n        self.books_by_title\n            .entry(title.to_lowercase())\n            .or_insert_with(Vec::new)\n            .push(id);\n        println!(\"Added book: {}\", book);\n    }\n\n    // 按 ID 查找书籍\n    fn find_by_id(&self, id: u32) -> Option<&Book> {\n        self.books_by_id.get(&id)\n    }\n\n    // 按书名查找书籍\n    fn find_by_title(&self, title: &str) -> Vec<&Book> {\n        let title_lower = title.to_lowercase();\n        self.books_by_title\n            .get(&title_lower)\n            .map(|ids| {\n                ids.iter()\n                    .filter_map(|id| self.books_by_id.get(id))\n                    .collect()\n            })\n            .unwrap_or_else(Vec::new)\n    }\n\n    // 更新库存数量\n    fn update_quantity(&mut self, id: u32, delta: i32) -> Result<(), String> {\n        if let Some(book) = self.books_by_id.get_mut(&id) {\n            let new_quantity = book.quantity as i32 + delta;\n            if new_quantity < 0 {\n                return Err(format!(\n                    \"Cannot update quantity for book ID {}. Negative quantity not allowed.\",\n                    id\n                ));\n            }\n            book.quantity = new_quantity as u32;\n            println!(\"Updated book ID {}: new quantity = {}\", id, book.quantity);\n            Ok(())\n        } else {\n            Err(format!(\"Book with ID {} not found\", id))\n        }\n    }\n\n    // 删除书籍\n    fn remove_book(&mut self, id: u32) -> Result<(), String> {\n        if let Some(book) = self.books_by_id.remove(&id) {\n            // 从书名索引中移除\n            if let Some(ids) = self.books_by_title.get_mut(&book.title.to_lowercase()) {\n                ids.retain(|&book_id| book_id != id);\n                // 如果该书名下没有其他书籍，移除整个条目\n                if ids.is_empty() {\n                    self.books_by_title.remove(&book.title.to_lowercase());\n                }\n            }\n            println!(\"Removed book: {}\", book);\n            Ok(())\n        } else {\n            Err(format!(\"Book with ID {} not found\", id))\n        }\n    }\n\n    // 列出所有书籍\n    fn list_all_books(&self) {\n        println!(\"\\n--- Inventory Report ---\");\n        if self.books_by_id.is_empty() {\n            println!(\"No books in inventory\");\n            return;\n        }\n        for book in self.books_by_id.values() {\n            println!(\"{}\", book);\n        }\n        println!(\"Total books: {}\", self.books_by_id.len());\n    }\n}\n\nfn main() {\n    let mut inventory = InventoryManager::new();\n\n    // 添加书籍\n    inventory.add_book(\"The Rust Programming Language\", \"Steve Klabnik\", 39.99, 10);\n    inventory.add_book(\"Programming Rust\", \"Jim Blandy\", 49.99, 5);\n    inventory.add_book(\"Rust in Action\", \"Tim McNamara\", 44.99, 8);\n    inventory.add_book(\"The Rust Programming Language\", \"Carol Nichols\", 39.99, 15); // 同名不同作者\n\n    // 查询书籍\n    println!(\"\\nSearching for books by title 'Rust':\");\n    for book in inventory.find_by_title(\"Rust\") {\n        println!(\"- {}\", book);\n    }\n    println!(\"\\nSearching for book ID 2:\");\n    if let Some(book) = inventory.find_by_id(2) {\n        println!(\"- {}\", book);\n    }\n\n    // 更新库存\n    println!(\"\\nUpdating stock:\");\n    inventory.update_quantity(1, -3).unwrap(); // 卖出3本\n    inventory.update_quantity(1, 5).unwrap(); // 进货5本\n\n    // 尝试无效更新\n    match inventory.update_quantity(1, -20) {\n        Ok(_) => {}\n        Err(e) => println!(\"Error: {}\", e),\n    }\n\n    // 删除书籍\n    println!(\"\\nRemoving book ID 3:\");\n    inventory.remove_book(3).unwrap();\n\n    // 列出所有书籍\n    inventory.list_all_books();\n\n    // 尝试删除不存在的书籍\n    match inventory.remove_book(99) {\n        Ok(_) => {}\n        Err(e) => println!(\"\\nError: {}\", e),\n    }\n}\n```","source":"_posts/71-IB-Rust-常见集合.md","raw":"---\ntitle: IB-Rust-常见集合\ndate: 2025-05-28 22:24:21\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson13](https://github.com/Zoella-w/IB-Rust/tree/main/13_collection)\n\nRust 中的常见集合有 Vector 和 HashMap\n\n## Vector\n\n### 什么是 Vec\n\nVec 是一个动态数组，可以根据需要动态增长和缩小，适用于需要按顺序存储数据的场景\n\n### Vec 的基本操作\n\n#### 创建和初始化\n\n```rust\nlet v: Vec<i32> = Vec::new();\nlet v = vec![1, 2, 3];\n```\n\n#### 添加元素\n\n```rust\n// let mut v = vec![1, 2, 3];\nv.push(1);\n```\n\n#### 访问元素\n\n```rust\nlet v = vec![1, 2, 3];\n\n// 直接引用访问\nlet third = &v[2];\nprintln!(\"third: {third}\");\n\n// 使用 get 访问\nmatch v.get(2) {\n    Some(val) => println!(\"value: {val}\"),\n    None => println!(\"Index error\"),\n};\n```\n\n#### 修改元素\n\n```rust\nlet mut v = vec![1, 2, 3];\nv[0] = 0;\n```\n\n#### 遍历元素\n\n```rust\n// 如果不用引用，v 的所有权会被转移\nfor i in &v {\n    println!(\"i: {i}\");\n}\n```\n\n### Vec 的进阶用法\n\n#### 使用枚举存储多种类型\n\n```rust\nenum SpreadSheetCell {\n    Int(i32),\n    Float(f64),\n    Test(String),\n}\nlet row = vec![\n    SpreadSheetCell::Int(3),\n    SpreadSheetCell::Float(10.12),\n    SpreadSheetCell::Test(String::from(\"Hello\")),\n];\n```\n\n#### 容量与重新分配\n\n```rust\nlet mut v: Vec<i32> = Vec::with_capacity(10);\nprintln!(\"capacity: {}\", v.capacity()); // 10\nv.push(1);\nprintln!(\"capacity: {}\", v.capacity()); // 10\n```\n\n### Vec 的常见陷阱\n\n#### 不安全的索引访问\n\n用 if 判断索引是否合法，或者使用 match\n\n#### 可变引用与不可变引用的混用\n\n```rust\n// let mut v = vec![1, 2, 3];\n// let first = &v[0]; // 不可变借用\n// v.push(4); // 可变借用，error: mutable borrow occurs here\n// println!(\"The first element is : {}\", first);\n\nlet mut v = vec![1, 2, 3];\n{\n    let first = &v[0]; // 不可变借用\n    println!(\"The first element is : {}\", first);\n}\nv.push(4); // 可变借用，error: mutable borrow occurs here\nprintln!(\"v: {:?}\", v);\n```\n\n## HashMap\n\n### 什么是 HashMap\n\nHashMap 是一个键值对（key-value）存储的数据结构，适用于需要快速查找数据的场景\n\n### HashMap 的基本操作\n\n#### 创建和初始化\n\n```rust\nlet mut scores: HashMap<_, _> = HashMap::new();\nscores.insert(String::from(\"Blue\"), 10);\nscores.insert(String::from(\"yellow\"), 50);\n```\n\n#### 访问元素\n\n```rust\nlet team_name = String::from(\"Blue\");\nlet score = scores.get(&team_name);\nmatch score {\n    Some(s) => println!(\"The {} score is {}\", team_name, s),\n    None => println!(\"No score for this team\"),\n};\n```\n\n#### 遍历元素\n\n```rust\n// 使用引用防止所有权转移\nfor (team, score) in &scores {\n    println!(\"{}: {}\", team, score);\n}\n```\n\n### HashMap 的进阶用法\n\n#### 更新哈希表\n\n```rust\nscores.insert(String::from(\"Blue\"), 25);\nscores.entry(String::from(\"Yellow\")).or_insert(100);\n\nlet entry = scores.entry(String::from(\"Red\")).or_insert(30);\nprintln!(\"entry: {entry}\"); // 30\n*entry += 10;\nprintln!(\"entry: {entry}\"); // 40\nprintln!(\"{:?}\", scores);\n```\n\n#### 合并哈希表\n\n```rust\nlet mut map1 = HashMap::new();\nmap1.insert(\"a\", 1);\nmap1.insert(\"b\", 2);\nlet mut map2 = HashMap::new();\nmap2.insert(\"b\", 3);\nmap2.insert(\"c\", 4);\nfor (k, v) in map2 {\n    // map1.insert(k, v);\n    map1.entry(k).or_insert(v);\n}\n```\n\n#### 生成哈希 key\n\n```rust\nuse std::hash::{DefaultHasher, Hash, Hasher};\n\nfn calculate_hash<T: Hash>(t: &T) -> u64 {\n    let mut s = DefaultHasher::new();\n    t.hash(&mut s);\n    s.finish()\n}\n\nfn hashmap_study() {\n    let key1 = String::from(\"key1\");\n    let key2 = String::from(\"key2\");\n    println!(\n        \"hash of key1: {}, and key2: {}\",\n        calculate_hash(&key1),\n        calculate_hash(&key2)\n    );\n}\n```\n\n### HashMap 的常见陷阱\n\n#### 哈希冲突\n\n使用 `.entry().or_insert()`\n\n#### 值的所有权问题\n\n```rust\nlet field_name = String::from(\"color\");\nlet field_value = String::from(\"Blue\");\nlet mut map = HashMap::new();\n// map.insert(field_name, field_value);\n// println!(\"field_name: {}\", field_name); // error: value borrowed here after move\nmap.insert(field_name.clone(), field_value.clone());\nprintln!(\"field_name: {}\", field_name);\n```\n\n## 练习题\n### 练习 1\n使用 Vec 实现一个简单的栈\n实现一个简单的栈（后进先出，LIFO）数据结构，支持 push、pop 和 peek 操作。\n\n``` rust\nstruct Stack<T> {\n    elements: Vec<T>,\n}\n\nimpl<T> Stack<T> {\n    fn new() -> Self {\n        {\n            Stack {\n                elements: Vec::new(),\n            }\n        }\n    }\n\n    fn push(&mut self, item: T) {\n        self.elements.push(item);\n    }\n\n    fn pop(&mut self) -> Option<T> {\n        self.elements.pop()\n    }\n\n    fn peek(&self) -> Option<&T> {\n        self.elements.last()\n    }\n}\n\nfn main() {\n    let mut stack = Stack::new();\n\n    // 压入元素\n    stack.push(1);\n    stack.push(2);\n    stack.push(3);\n\n    // 查看栈顶\n    assert_eq!(stack.peek(), Some(&3));\n\n    // 弹出元素\n    assert_eq!(stack.pop(), Some(3));\n    assert_eq!(stack.peek(), Some(&2));\n\n    // 继续弹出和压入\n    assert_eq!(stack.pop(), Some(2));\n    stack.push(4);\n    assert_eq!(stack.peek(), Some(&4));\n\n    // 清空栈\n    assert_eq!(stack.pop(), Some(4));\n    assert_eq!(stack.pop(), Some(1));\n    assert_eq!(stack.pop(), None); // 空栈时返回 None\n    assert_eq!(stack.peek(), None); // 空栈时返回 None\n}\n```\n\n### 练习 2\n使用 HashMap 实现一个字频统计器\n编写一个程序，统计一个字符串中每个单词出现的频率。\n\n``` rust\nuse std::collections::HashMap;\n\nfn word_frequency(text: &str) -> HashMap<String, u32> {\n    let mut frequency_map = HashMap::new();\n    for word in text.split_whitespace() {\n        // 清理单词并转换为 String（拥有所有权）\n        let cleaned_word = word\n            .chars() // 将单词分解为字符迭代器\n            .filter(|c| c.is_alphanumeric()) // 保留字母和数字字符，过滤标点符号\n            .collect::<String>() // 将过滤后的字符收集为 String\n            .to_lowercase();\n        if cleaned_word.is_empty() {\n            continue;\n        }\n        // 使用 String 作为键（拥有所有权）\n        *frequency_map.entry(cleaned_word).or_insert(0) += 1;\n    }\n    frequency_map\n}\n\nfn main() {\n    let text = \"Hello world! Hello Rust. Rust is awesome. World says hello to Rust.\";\n    let frequency = word_frequency(text);\n\n    println!(\"Word frequency:\");\n    for (word, count) in &frequency {\n        println!(\"{}: {}\", word, count);\n    }\n\n    // 验证结果\n    assert_eq!(frequency.get(\"hello\"), Some(&3));\n    assert_eq!(frequency.get(\"rust\"), Some(&3));\n    assert_eq!(frequency.get(\"world\"), Some(&2));\n    assert_eq!(frequency.get(\"is\"), Some(&1));\n    assert_eq!(frequency.get(\"says\"), Some(&1));\n    assert_eq!(frequency.get(\"to\"), Some(&1));\n    assert_eq!(frequency.get(\"awesome\"), Some(&1));\n}\n```\n\n### 练习3\n综合练习：使用 Vec 和 HashMap 实现一个简单的书籍库存管理系统\n实现一个书籍库存管理系统，可以添加书籍、查询库存、更新库存以及删除书籍。\n\n``` rust\nuse std::collections::HashMap;\nuse std::fmt;\n\n// 书籍结构体\n#[derive(Debug, Clone)]\nstruct Book {\n    id: u32,        // 唯一标识符\n    title: String,  // 书名\n    author: String, // 作者\n    price: f64,     // 价格\n    quantity: u32,  // 库存数量\n}\n\nimpl Book {\n    // 创建新书籍\n    fn new(id: u32, title: &str, author: &str, price: f64, quantity: u32) -> Self {\n        Book {\n            id,\n            title: title.to_string(),\n            author: author.to_string(),\n            price,\n            quantity,\n        }\n    }\n}\n\n// 为 Book 实现 Display trait 以便打印\nimpl fmt::Display for Book {\n    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n        write!(\n            f,\n            \"ID: {}, Title: '{}', Author: '{}', Price: ${:.2}, Quantity: {}\",\n            self.id, self.title, self.author, self.price, self.quantity\n        )\n    }\n}\n\n// 库存管理系统\nstruct InventoryManager {\n    books_by_id: HashMap<u32, Book>,           // 按 ID 快速查找\n    books_by_title: HashMap<String, Vec<u32>>, // 按书名查找 ID 列表\n    next_id: u32,                              // 下一个可用 ID\n}\n\nimpl InventoryManager {\n    // 创建新的库存管理系统\n    fn new() -> Self {\n        InventoryManager {\n            books_by_id: HashMap::new(),\n            books_by_title: HashMap::new(),\n            next_id: 1,\n        }\n    }\n\n    // 添加新书\n    fn add_book(&mut self, title: &str, author: &str, price: f64, quantity: u32) {\n        let id = self.next_id;\n        self.next_id += 1;\n        let book = Book::new(id, title, author, price, quantity);\n        // 添加到 ID 索引\n        self.books_by_id.insert(id, book.clone());\n        // 添加到书名索引\n        self.books_by_title\n            .entry(title.to_lowercase())\n            .or_insert_with(Vec::new)\n            .push(id);\n        println!(\"Added book: {}\", book);\n    }\n\n    // 按 ID 查找书籍\n    fn find_by_id(&self, id: u32) -> Option<&Book> {\n        self.books_by_id.get(&id)\n    }\n\n    // 按书名查找书籍\n    fn find_by_title(&self, title: &str) -> Vec<&Book> {\n        let title_lower = title.to_lowercase();\n        self.books_by_title\n            .get(&title_lower)\n            .map(|ids| {\n                ids.iter()\n                    .filter_map(|id| self.books_by_id.get(id))\n                    .collect()\n            })\n            .unwrap_or_else(Vec::new)\n    }\n\n    // 更新库存数量\n    fn update_quantity(&mut self, id: u32, delta: i32) -> Result<(), String> {\n        if let Some(book) = self.books_by_id.get_mut(&id) {\n            let new_quantity = book.quantity as i32 + delta;\n            if new_quantity < 0 {\n                return Err(format!(\n                    \"Cannot update quantity for book ID {}. Negative quantity not allowed.\",\n                    id\n                ));\n            }\n            book.quantity = new_quantity as u32;\n            println!(\"Updated book ID {}: new quantity = {}\", id, book.quantity);\n            Ok(())\n        } else {\n            Err(format!(\"Book with ID {} not found\", id))\n        }\n    }\n\n    // 删除书籍\n    fn remove_book(&mut self, id: u32) -> Result<(), String> {\n        if let Some(book) = self.books_by_id.remove(&id) {\n            // 从书名索引中移除\n            if let Some(ids) = self.books_by_title.get_mut(&book.title.to_lowercase()) {\n                ids.retain(|&book_id| book_id != id);\n                // 如果该书名下没有其他书籍，移除整个条目\n                if ids.is_empty() {\n                    self.books_by_title.remove(&book.title.to_lowercase());\n                }\n            }\n            println!(\"Removed book: {}\", book);\n            Ok(())\n        } else {\n            Err(format!(\"Book with ID {} not found\", id))\n        }\n    }\n\n    // 列出所有书籍\n    fn list_all_books(&self) {\n        println!(\"\\n--- Inventory Report ---\");\n        if self.books_by_id.is_empty() {\n            println!(\"No books in inventory\");\n            return;\n        }\n        for book in self.books_by_id.values() {\n            println!(\"{}\", book);\n        }\n        println!(\"Total books: {}\", self.books_by_id.len());\n    }\n}\n\nfn main() {\n    let mut inventory = InventoryManager::new();\n\n    // 添加书籍\n    inventory.add_book(\"The Rust Programming Language\", \"Steve Klabnik\", 39.99, 10);\n    inventory.add_book(\"Programming Rust\", \"Jim Blandy\", 49.99, 5);\n    inventory.add_book(\"Rust in Action\", \"Tim McNamara\", 44.99, 8);\n    inventory.add_book(\"The Rust Programming Language\", \"Carol Nichols\", 39.99, 15); // 同名不同作者\n\n    // 查询书籍\n    println!(\"\\nSearching for books by title 'Rust':\");\n    for book in inventory.find_by_title(\"Rust\") {\n        println!(\"- {}\", book);\n    }\n    println!(\"\\nSearching for book ID 2:\");\n    if let Some(book) = inventory.find_by_id(2) {\n        println!(\"- {}\", book);\n    }\n\n    // 更新库存\n    println!(\"\\nUpdating stock:\");\n    inventory.update_quantity(1, -3).unwrap(); // 卖出3本\n    inventory.update_quantity(1, 5).unwrap(); // 进货5本\n\n    // 尝试无效更新\n    match inventory.update_quantity(1, -20) {\n        Ok(_) => {}\n        Err(e) => println!(\"Error: {}\", e),\n    }\n\n    // 删除书籍\n    println!(\"\\nRemoving book ID 3:\");\n    inventory.remove_book(3).unwrap();\n\n    // 列出所有书籍\n    inventory.list_all_books();\n\n    // 尝试删除不存在的书籍\n    match inventory.remove_book(99) {\n        Ok(_) => {}\n        Err(e) => println!(\"\\nError: {}\", e),\n    }\n}\n```","slug":"71-IB-Rust-常见集合","published":1,"updated":"2025-05-29T15:47:07.546Z","_id":"cmb9jnf050000ebpr4eda9i9m","comments":1,"layout":"post","photos":[],"link":"","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/13_collection\" >Codes in lesson13<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p>Rust 中的常见集合有 Vector 和 HashMap</p>\n<h2 id=\"Vector\"><a href=\"#Vector\" class=\"headerlink\" title=\"Vector\"></a>Vector</h2><h3 id=\"什么是-Vec\"><a href=\"#什么是-Vec\" class=\"headerlink\" title=\"什么是 Vec\"></a>什么是 Vec</h3><p>Vec 是一个动态数组，可以根据需要动态增长和缩小，适用于需要按顺序存储数据的场景</p>\n<h3 id=\"Vec-的基本操作\"><a href=\"#Vec-的基本操作\" class=\"headerlink\" title=\"Vec 的基本操作\"></a>Vec 的基本操作</h3><h4 id=\"创建和初始化\"><a href=\"#创建和初始化\" class=\"headerlink\" title=\"创建和初始化\"></a>创建和初始化</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">v</span>: <span class=\"type\">Vec</span>&lt;<span class=\"type\">i32</span>&gt; = <span class=\"type\">Vec</span>::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">v</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"添加元素\"><a href=\"#添加元素\" class=\"headerlink\" title=\"添加元素\"></a>添加元素</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// let mut v = vec![1, 2, 3];</span></span><br><span class=\"line\">v.<span class=\"title function_ invoke__\">push</span>(<span class=\"number\">1</span>);</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"访问元素\"><a href=\"#访问元素\" class=\"headerlink\" title=\"访问元素\"></a>访问元素</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">v</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 直接引用访问</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">third</span> = &amp;v[<span class=\"number\">2</span>];</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;third: &#123;third&#125;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用 get 访问</span></span><br><span class=\"line\"><span class=\"keyword\">match</span> v.<span class=\"title function_ invoke__\">get</span>(<span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Some</span>(val) =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;value: &#123;val&#125;&quot;</span>),</span><br><span class=\"line\">    <span class=\"literal\">None</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Index error&quot;</span>),</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"修改元素\"><a href=\"#修改元素\" class=\"headerlink\" title=\"修改元素\"></a>修改元素</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">v</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\">v[<span class=\"number\">0</span>] = <span class=\"number\">0</span>;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"遍历元素\"><a href=\"#遍历元素\" class=\"headerlink\" title=\"遍历元素\"></a>遍历元素</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 如果不用引用，v 的所有权会被转移</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> <span class=\"variable\">i</span> <span class=\"keyword\">in</span> &amp;v &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;i: &#123;i&#125;&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"Vec-的进阶用法\"><a href=\"#Vec-的进阶用法\" class=\"headerlink\" title=\"Vec 的进阶用法\"></a>Vec 的进阶用法</h3><h4 id=\"使用枚举存储多种类型\"><a href=\"#使用枚举存储多种类型\" class=\"headerlink\" title=\"使用枚举存储多种类型\"></a>使用枚举存储多种类型</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">SpreadSheetCell</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Int</span>(<span class=\"type\">i32</span>),</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Float</span>(<span class=\"type\">f64</span>),</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Test</span>(<span class=\"type\">String</span>),</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">row</span> = <span class=\"built_in\">vec!</span>[</span><br><span class=\"line\">    SpreadSheetCell::<span class=\"title function_ invoke__\">Int</span>(<span class=\"number\">3</span>),</span><br><span class=\"line\">    SpreadSheetCell::<span class=\"title function_ invoke__\">Float</span>(<span class=\"number\">10.12</span>),</span><br><span class=\"line\">    SpreadSheetCell::<span class=\"title function_ invoke__\">Test</span>(<span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Hello&quot;</span>)),</span><br><span class=\"line\">];</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"容量与重新分配\"><a href=\"#容量与重新分配\" class=\"headerlink\" title=\"容量与重新分配\"></a>容量与重新分配</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">v</span>: <span class=\"type\">Vec</span>&lt;<span class=\"type\">i32</span>&gt; = <span class=\"type\">Vec</span>::<span class=\"title function_ invoke__\">with_capacity</span>(<span class=\"number\">10</span>);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;capacity: &#123;&#125;&quot;</span>, v.<span class=\"title function_ invoke__\">capacity</span>()); <span class=\"comment\">// 10</span></span><br><span class=\"line\">v.<span class=\"title function_ invoke__\">push</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;capacity: &#123;&#125;&quot;</span>, v.<span class=\"title function_ invoke__\">capacity</span>()); <span class=\"comment\">// 10</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"Vec-的常见陷阱\"><a href=\"#Vec-的常见陷阱\" class=\"headerlink\" title=\"Vec 的常见陷阱\"></a>Vec 的常见陷阱</h3><h4 id=\"不安全的索引访问\"><a href=\"#不安全的索引访问\" class=\"headerlink\" title=\"不安全的索引访问\"></a>不安全的索引访问</h4><p>用 if 判断索引是否合法，或者使用 match</p>\n<h4 id=\"可变引用与不可变引用的混用\"><a href=\"#可变引用与不可变引用的混用\" class=\"headerlink\" title=\"可变引用与不可变引用的混用\"></a>可变引用与不可变引用的混用</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// let mut v = vec![1, 2, 3];</span></span><br><span class=\"line\"><span class=\"comment\">// let first = &amp;v[0]; // 不可变借用</span></span><br><span class=\"line\"><span class=\"comment\">// v.push(4); // 可变借用，error: mutable borrow occurs here</span></span><br><span class=\"line\"><span class=\"comment\">// println!(&quot;The first element is : &#123;&#125;&quot;, first);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">v</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">first</span> = &amp;v[<span class=\"number\">0</span>]; <span class=\"comment\">// 不可变借用</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;The first element is : &#123;&#125;&quot;</span>, first);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">v.<span class=\"title function_ invoke__\">push</span>(<span class=\"number\">4</span>); <span class=\"comment\">// 可变借用，error: mutable borrow occurs here</span></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;v: &#123;:?&#125;&quot;</span>, v);</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"HashMap\"><a href=\"#HashMap\" class=\"headerlink\" title=\"HashMap\"></a>HashMap</h2><h3 id=\"什么是-HashMap\"><a href=\"#什么是-HashMap\" class=\"headerlink\" title=\"什么是 HashMap\"></a>什么是 HashMap</h3><p>HashMap 是一个键值对（key-value）存储的数据结构，适用于需要快速查找数据的场景</p>\n<h3 id=\"HashMap-的基本操作\"><a href=\"#HashMap-的基本操作\" class=\"headerlink\" title=\"HashMap 的基本操作\"></a>HashMap 的基本操作</h3><h4 id=\"创建和初始化-1\"><a href=\"#创建和初始化-1\" class=\"headerlink\" title=\"创建和初始化\"></a>创建和初始化</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">scores</span>: HashMap&lt;_, _&gt; = HashMap::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">scores.<span class=\"title function_ invoke__\">insert</span>(<span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Blue&quot;</span>), <span class=\"number\">10</span>);</span><br><span class=\"line\">scores.<span class=\"title function_ invoke__\">insert</span>(<span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;yellow&quot;</span>), <span class=\"number\">50</span>);</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"访问元素-1\"><a href=\"#访问元素-1\" class=\"headerlink\" title=\"访问元素\"></a>访问元素</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">team_name</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Blue&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">score</span> = scores.<span class=\"title function_ invoke__\">get</span>(&amp;team_name);</span><br><span class=\"line\"><span class=\"keyword\">match</span> score &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Some</span>(s) =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;The &#123;&#125; score is &#123;&#125;&quot;</span>, team_name, s),</span><br><span class=\"line\">    <span class=\"literal\">None</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;No score for this team&quot;</span>),</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"遍历元素-1\"><a href=\"#遍历元素-1\" class=\"headerlink\" title=\"遍历元素\"></a>遍历元素</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用引用防止所有权转移</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (team, score) <span class=\"keyword\">in</span> &amp;scores &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, team, score);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"HashMap-的进阶用法\"><a href=\"#HashMap-的进阶用法\" class=\"headerlink\" title=\"HashMap 的进阶用法\"></a>HashMap 的进阶用法</h3><h4 id=\"更新哈希表\"><a href=\"#更新哈希表\" class=\"headerlink\" title=\"更新哈希表\"></a>更新哈希表</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scores.<span class=\"title function_ invoke__\">insert</span>(<span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Blue&quot;</span>), <span class=\"number\">25</span>);</span><br><span class=\"line\">scores.<span class=\"title function_ invoke__\">entry</span>(<span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Yellow&quot;</span>)).<span class=\"title function_ invoke__\">or_insert</span>(<span class=\"number\">100</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">entry</span> = scores.<span class=\"title function_ invoke__\">entry</span>(<span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Red&quot;</span>)).<span class=\"title function_ invoke__\">or_insert</span>(<span class=\"number\">30</span>);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;entry: &#123;entry&#125;&quot;</span>); <span class=\"comment\">// 30</span></span><br><span class=\"line\">*entry += <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;entry: &#123;entry&#125;&quot;</span>); <span class=\"comment\">// 40</span></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;:?&#125;&quot;</span>, scores);</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"合并哈希表\"><a href=\"#合并哈希表\" class=\"headerlink\" title=\"合并哈希表\"></a>合并哈希表</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">map1</span> = HashMap::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">map1.<span class=\"title function_ invoke__\">insert</span>(<span class=\"string\">&quot;a&quot;</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">map1.<span class=\"title function_ invoke__\">insert</span>(<span class=\"string\">&quot;b&quot;</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">map2</span> = HashMap::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">map2.<span class=\"title function_ invoke__\">insert</span>(<span class=\"string\">&quot;b&quot;</span>, <span class=\"number\">3</span>);</span><br><span class=\"line\">map2.<span class=\"title function_ invoke__\">insert</span>(<span class=\"string\">&quot;c&quot;</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\"><span class=\"keyword\">for</span> (k, v) <span class=\"keyword\">in</span> map2 &#123;</span><br><span class=\"line\">    <span class=\"comment\">// map1.insert(k, v);</span></span><br><span class=\"line\">    map1.<span class=\"title function_ invoke__\">entry</span>(k).<span class=\"title function_ invoke__\">or_insert</span>(v);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"生成哈希-key\"><a href=\"#生成哈希-key\" class=\"headerlink\" title=\"生成哈希 key\"></a>生成哈希 key</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::hash::&#123;DefaultHasher, Hash, Hasher&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">calculate_hash</span>&lt;T: Hash&gt;(t: &amp;T) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">u64</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = DefaultHasher::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">    t.<span class=\"title function_ invoke__\">hash</span>(&amp;<span class=\"keyword\">mut</span> s);</span><br><span class=\"line\">    s.<span class=\"title function_ invoke__\">finish</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">hashmap_study</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">key1</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;key1&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">key2</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;key2&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;hash of key1: &#123;&#125;, and key2: &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">calculate_hash</span>(&amp;key1),</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">calculate_hash</span>(&amp;key2)</span><br><span class=\"line\">    );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"HashMap-的常见陷阱\"><a href=\"#HashMap-的常见陷阱\" class=\"headerlink\" title=\"HashMap 的常见陷阱\"></a>HashMap 的常见陷阱</h3><h4 id=\"哈希冲突\"><a href=\"#哈希冲突\" class=\"headerlink\" title=\"哈希冲突\"></a>哈希冲突</h4><p>使用 <code>.entry().or_insert()</code></p>\n<h4 id=\"值的所有权问题\"><a href=\"#值的所有权问题\" class=\"headerlink\" title=\"值的所有权问题\"></a>值的所有权问题</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">field_name</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;color&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">field_value</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Blue&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">map</span> = HashMap::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\"><span class=\"comment\">// map.insert(field_name, field_value);</span></span><br><span class=\"line\"><span class=\"comment\">// println!(&quot;field_name: &#123;&#125;&quot;, field_name); // error: value borrowed here after move</span></span><br><span class=\"line\">map.<span class=\"title function_ invoke__\">insert</span>(field_name.<span class=\"title function_ invoke__\">clone</span>(), field_value.<span class=\"title function_ invoke__\">clone</span>());</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;field_name: &#123;&#125;&quot;</span>, field_name);</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"练习题\"><a href=\"#练习题\" class=\"headerlink\" title=\"练习题\"></a>练习题</h2><h3 id=\"练习-1\"><a href=\"#练习-1\" class=\"headerlink\" title=\"练习 1\"></a>练习 1</h3><p>使用 Vec 实现一个简单的栈<br>实现一个简单的栈（后进先出，LIFO）数据结构，支持 push、pop 和 peek 操作。</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Stack</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    elements: <span class=\"type\">Vec</span>&lt;T&gt;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span>&lt;T&gt; Stack&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">new</span>() <span class=\"punctuation\">-&gt;</span> <span class=\"keyword\">Self</span> &#123;</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            Stack &#123;</span><br><span class=\"line\">                elements: <span class=\"type\">Vec</span>::<span class=\"title function_ invoke__\">new</span>(),</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">push</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>, item: T) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.elements.<span class=\"title function_ invoke__\">push</span>(item);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">pop</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Option</span>&lt;T&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.elements.<span class=\"title function_ invoke__\">pop</span>()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">peek</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Option</span>&lt;&amp;T&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.elements.<span class=\"title function_ invoke__\">last</span>()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">stack</span> = Stack::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 压入元素</span></span><br><span class=\"line\">    stack.<span class=\"title function_ invoke__\">push</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">    stack.<span class=\"title function_ invoke__\">push</span>(<span class=\"number\">2</span>);</span><br><span class=\"line\">    stack.<span class=\"title function_ invoke__\">push</span>(<span class=\"number\">3</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 查看栈顶</span></span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(stack.<span class=\"title function_ invoke__\">peek</span>(), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">3</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 弹出元素</span></span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(stack.<span class=\"title function_ invoke__\">pop</span>(), <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">3</span>));</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(stack.<span class=\"title function_ invoke__\">peek</span>(), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">2</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 继续弹出和压入</span></span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(stack.<span class=\"title function_ invoke__\">pop</span>(), <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">2</span>));</span><br><span class=\"line\">    stack.<span class=\"title function_ invoke__\">push</span>(<span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(stack.<span class=\"title function_ invoke__\">peek</span>(), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">4</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 清空栈</span></span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(stack.<span class=\"title function_ invoke__\">pop</span>(), <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">4</span>));</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(stack.<span class=\"title function_ invoke__\">pop</span>(), <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">1</span>));</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(stack.<span class=\"title function_ invoke__\">pop</span>(), <span class=\"literal\">None</span>); <span class=\"comment\">// 空栈时返回 None</span></span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(stack.<span class=\"title function_ invoke__\">peek</span>(), <span class=\"literal\">None</span>); <span class=\"comment\">// 空栈时返回 None</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"练习-2\"><a href=\"#练习-2\" class=\"headerlink\" title=\"练习 2\"></a>练习 2</h3><p>使用 HashMap 实现一个字频统计器<br>编写一个程序，统计一个字符串中每个单词出现的频率。</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::collections::HashMap;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">word_frequency</span>(text: &amp;<span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> HashMap&lt;<span class=\"type\">String</span>, <span class=\"type\">u32</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">frequency_map</span> = HashMap::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"variable\">word</span> <span class=\"keyword\">in</span> text.<span class=\"title function_ invoke__\">split_whitespace</span>() &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 清理单词并转换为 String（拥有所有权）</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"variable\">cleaned_word</span> = word</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">chars</span>() <span class=\"comment\">// 将单词分解为字符迭代器</span></span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">filter</span>(|c| c.<span class=\"title function_ invoke__\">is_alphanumeric</span>()) <span class=\"comment\">// 保留字母和数字字符，过滤标点符号</span></span><br><span class=\"line\">            .collect::&lt;<span class=\"type\">String</span>&gt;() <span class=\"comment\">// 将过滤后的字符收集为 String</span></span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">to_lowercase</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> cleaned_word.<span class=\"title function_ invoke__\">is_empty</span>() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 使用 String 作为键（拥有所有权）</span></span><br><span class=\"line\">        *frequency_map.<span class=\"title function_ invoke__\">entry</span>(cleaned_word).<span class=\"title function_ invoke__\">or_insert</span>(<span class=\"number\">0</span>) += <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    frequency_map</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">text</span> = <span class=\"string\">&quot;Hello world! Hello Rust. Rust is awesome. World says hello to Rust.&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">frequency</span> = <span class=\"title function_ invoke__\">word_frequency</span>(text);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Word frequency:&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (word, count) <span class=\"keyword\">in</span> &amp;frequency &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, word, count);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 验证结果</span></span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(frequency.<span class=\"title function_ invoke__\">get</span>(<span class=\"string\">&quot;hello&quot;</span>), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">3</span>));</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(frequency.<span class=\"title function_ invoke__\">get</span>(<span class=\"string\">&quot;rust&quot;</span>), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">3</span>));</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(frequency.<span class=\"title function_ invoke__\">get</span>(<span class=\"string\">&quot;world&quot;</span>), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">2</span>));</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(frequency.<span class=\"title function_ invoke__\">get</span>(<span class=\"string\">&quot;is&quot;</span>), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">1</span>));</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(frequency.<span class=\"title function_ invoke__\">get</span>(<span class=\"string\">&quot;says&quot;</span>), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">1</span>));</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(frequency.<span class=\"title function_ invoke__\">get</span>(<span class=\"string\">&quot;to&quot;</span>), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">1</span>));</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(frequency.<span class=\"title function_ invoke__\">get</span>(<span class=\"string\">&quot;awesome&quot;</span>), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">1</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"练习3\"><a href=\"#练习3\" class=\"headerlink\" title=\"练习3\"></a>练习3</h3><p>综合练习：使用 Vec 和 HashMap 实现一个简单的书籍库存管理系统<br>实现一个书籍库存管理系统，可以添加书籍、查询库存、更新库存以及删除书籍。</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::collections::HashMap;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::fmt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 书籍结构体</span></span><br><span class=\"line\"><span class=\"meta\">#[derive(Debug, Clone)]</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Book</span> &#123;</span><br><span class=\"line\">    id: <span class=\"type\">u32</span>,        <span class=\"comment\">// 唯一标识符</span></span><br><span class=\"line\">    title: <span class=\"type\">String</span>,  <span class=\"comment\">// 书名</span></span><br><span class=\"line\">    author: <span class=\"type\">String</span>, <span class=\"comment\">// 作者</span></span><br><span class=\"line\">    price: <span class=\"type\">f64</span>,     <span class=\"comment\">// 价格</span></span><br><span class=\"line\">    quantity: <span class=\"type\">u32</span>,  <span class=\"comment\">// 库存数量</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Book</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 创建新书籍</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">new</span>(id: <span class=\"type\">u32</span>, title: &amp;<span class=\"type\">str</span>, author: &amp;<span class=\"type\">str</span>, price: <span class=\"type\">f64</span>, quantity: <span class=\"type\">u32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"keyword\">Self</span> &#123;</span><br><span class=\"line\">        Book &#123;</span><br><span class=\"line\">            id,</span><br><span class=\"line\">            title: title.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">            author: author.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">            price,</span><br><span class=\"line\">            quantity,</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 为 Book 实现 Display trait 以便打印</span></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">fmt</span>::Display <span class=\"keyword\">for</span> <span class=\"title class_\">Book</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">fmt</span>(&amp;<span class=\"keyword\">self</span>, f: &amp;<span class=\"keyword\">mut</span> fmt::Formatter&lt;<span class=\"symbol\">&#x27;_</span>&gt;) <span class=\"punctuation\">-&gt;</span> fmt::<span class=\"type\">Result</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">write!</span>(</span><br><span class=\"line\">            f,</span><br><span class=\"line\">            <span class=\"string\">&quot;ID: &#123;&#125;, Title: &#x27;&#123;&#125;&#x27;, Author: &#x27;&#123;&#125;&#x27;, Price: $&#123;:.2&#125;, Quantity: &#123;&#125;&quot;</span>,</span><br><span class=\"line\">            <span class=\"keyword\">self</span>.id, <span class=\"keyword\">self</span>.title, <span class=\"keyword\">self</span>.author, <span class=\"keyword\">self</span>.price, <span class=\"keyword\">self</span>.quantity</span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 库存管理系统</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">InventoryManager</span> &#123;</span><br><span class=\"line\">    books_by_id: HashMap&lt;<span class=\"type\">u32</span>, Book&gt;,           <span class=\"comment\">// 按 ID 快速查找</span></span><br><span class=\"line\">    books_by_title: HashMap&lt;<span class=\"type\">String</span>, <span class=\"type\">Vec</span>&lt;<span class=\"type\">u32</span>&gt;&gt;, <span class=\"comment\">// 按书名查找 ID 列表</span></span><br><span class=\"line\">    next_id: <span class=\"type\">u32</span>,                              <span class=\"comment\">// 下一个可用 ID</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">InventoryManager</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 创建新的库存管理系统</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">new</span>() <span class=\"punctuation\">-&gt;</span> <span class=\"keyword\">Self</span> &#123;</span><br><span class=\"line\">        InventoryManager &#123;</span><br><span class=\"line\">            books_by_id: HashMap::<span class=\"title function_ invoke__\">new</span>(),</span><br><span class=\"line\">            books_by_title: HashMap::<span class=\"title function_ invoke__\">new</span>(),</span><br><span class=\"line\">            next_id: <span class=\"number\">1</span>,</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 添加新书</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">add_book</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>, title: &amp;<span class=\"type\">str</span>, author: &amp;<span class=\"type\">str</span>, price: <span class=\"type\">f64</span>, quantity: <span class=\"type\">u32</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"variable\">id</span> = <span class=\"keyword\">self</span>.next_id;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.next_id += <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"variable\">book</span> = Book::<span class=\"title function_ invoke__\">new</span>(id, title, author, price, quantity);</span><br><span class=\"line\">        <span class=\"comment\">// 添加到 ID 索引</span></span><br><span class=\"line\">        <span class=\"keyword\">self</span>.books_by_id.<span class=\"title function_ invoke__\">insert</span>(id, book.<span class=\"title function_ invoke__\">clone</span>());</span><br><span class=\"line\">        <span class=\"comment\">// 添加到书名索引</span></span><br><span class=\"line\">        <span class=\"keyword\">self</span>.books_by_title</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">entry</span>(title.<span class=\"title function_ invoke__\">to_lowercase</span>())</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">or_insert_with</span>(<span class=\"type\">Vec</span>::new)</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">push</span>(id);</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Added book: &#123;&#125;&quot;</span>, book);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 按 ID 查找书籍</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">find_by_id</span>(&amp;<span class=\"keyword\">self</span>, id: <span class=\"type\">u32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Option</span>&lt;&amp;Book&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.books_by_id.<span class=\"title function_ invoke__\">get</span>(&amp;id)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 按书名查找书籍</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">find_by_title</span>(&amp;<span class=\"keyword\">self</span>, title: &amp;<span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Vec</span>&lt;&amp;Book&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"variable\">title_lower</span> = title.<span class=\"title function_ invoke__\">to_lowercase</span>();</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.books_by_title</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">get</span>(&amp;title_lower)</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">map</span>(|ids| &#123;</span><br><span class=\"line\">                ids.<span class=\"title function_ invoke__\">iter</span>()</span><br><span class=\"line\">                    .<span class=\"title function_ invoke__\">filter_map</span>(|id| <span class=\"keyword\">self</span>.books_by_id.<span class=\"title function_ invoke__\">get</span>(id))</span><br><span class=\"line\">                    .<span class=\"title function_ invoke__\">collect</span>()</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">unwrap_or_else</span>(<span class=\"type\">Vec</span>::new)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 更新库存数量</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">update_quantity</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>, id: <span class=\"type\">u32</span>, delta: <span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;(), <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Some</span>(book) = <span class=\"keyword\">self</span>.books_by_id.<span class=\"title function_ invoke__\">get_mut</span>(&amp;id) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"variable\">new_quantity</span> = book.quantity <span class=\"keyword\">as</span> <span class=\"type\">i32</span> + delta;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> new_quantity &lt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">Err</span>(<span class=\"built_in\">format!</span>(</span><br><span class=\"line\">                    <span class=\"string\">&quot;Cannot update quantity for book ID &#123;&#125;. Negative quantity not allowed.&quot;</span>,</span><br><span class=\"line\">                    id</span><br><span class=\"line\">                ));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            book.quantity = new_quantity <span class=\"keyword\">as</span> <span class=\"type\">u32</span>;</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Updated book ID &#123;&#125;: new quantity = &#123;&#125;&quot;</span>, id, book.quantity);</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">Ok</span>(())</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">Err</span>(<span class=\"built_in\">format!</span>(<span class=\"string\">&quot;Book with ID &#123;&#125; not found&quot;</span>, id))</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 删除书籍</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">remove_book</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>, id: <span class=\"type\">u32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;(), <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Some</span>(book) = <span class=\"keyword\">self</span>.books_by_id.<span class=\"title function_ invoke__\">remove</span>(&amp;id) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 从书名索引中移除</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Some</span>(ids) = <span class=\"keyword\">self</span>.books_by_title.<span class=\"title function_ invoke__\">get_mut</span>(&amp;book.title.<span class=\"title function_ invoke__\">to_lowercase</span>()) &#123;</span><br><span class=\"line\">                ids.<span class=\"title function_ invoke__\">retain</span>(|&amp;book_id| book_id != id);</span><br><span class=\"line\">                <span class=\"comment\">// 如果该书名下没有其他书籍，移除整个条目</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> ids.<span class=\"title function_ invoke__\">is_empty</span>() &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">self</span>.books_by_title.<span class=\"title function_ invoke__\">remove</span>(&amp;book.title.<span class=\"title function_ invoke__\">to_lowercase</span>());</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Removed book: &#123;&#125;&quot;</span>, book);</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">Ok</span>(())</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">Err</span>(<span class=\"built_in\">format!</span>(<span class=\"string\">&quot;Book with ID &#123;&#125; not found&quot;</span>, id))</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 列出所有书籍</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">list_all_books</span>(&amp;<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;\\n--- Inventory Report ---&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">self</span>.books_by_id.<span class=\"title function_ invoke__\">is_empty</span>() &#123;</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;No books in inventory&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> <span class=\"variable\">book</span> <span class=\"keyword\">in</span> <span class=\"keyword\">self</span>.books_by_id.<span class=\"title function_ invoke__\">values</span>() &#123;</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, book);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Total books: &#123;&#125;&quot;</span>, <span class=\"keyword\">self</span>.books_by_id.<span class=\"title function_ invoke__\">len</span>());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">inventory</span> = InventoryManager::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 添加书籍</span></span><br><span class=\"line\">    inventory.<span class=\"title function_ invoke__\">add_book</span>(<span class=\"string\">&quot;The Rust Programming Language&quot;</span>, <span class=\"string\">&quot;Steve Klabnik&quot;</span>, <span class=\"number\">39.99</span>, <span class=\"number\">10</span>);</span><br><span class=\"line\">    inventory.<span class=\"title function_ invoke__\">add_book</span>(<span class=\"string\">&quot;Programming Rust&quot;</span>, <span class=\"string\">&quot;Jim Blandy&quot;</span>, <span class=\"number\">49.99</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\">    inventory.<span class=\"title function_ invoke__\">add_book</span>(<span class=\"string\">&quot;Rust in Action&quot;</span>, <span class=\"string\">&quot;Tim McNamara&quot;</span>, <span class=\"number\">44.99</span>, <span class=\"number\">8</span>);</span><br><span class=\"line\">    inventory.<span class=\"title function_ invoke__\">add_book</span>(<span class=\"string\">&quot;The Rust Programming Language&quot;</span>, <span class=\"string\">&quot;Carol Nichols&quot;</span>, <span class=\"number\">39.99</span>, <span class=\"number\">15</span>); <span class=\"comment\">// 同名不同作者</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 查询书籍</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;\\nSearching for books by title &#x27;Rust&#x27;:&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"variable\">book</span> <span class=\"keyword\">in</span> inventory.<span class=\"title function_ invoke__\">find_by_title</span>(<span class=\"string\">&quot;Rust&quot;</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;- &#123;&#125;&quot;</span>, book);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;\\nSearching for book ID 2:&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Some</span>(book) = inventory.<span class=\"title function_ invoke__\">find_by_id</span>(<span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;- &#123;&#125;&quot;</span>, book);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 更新库存</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;\\nUpdating stock:&quot;</span>);</span><br><span class=\"line\">    inventory.<span class=\"title function_ invoke__\">update_quantity</span>(<span class=\"number\">1</span>, -<span class=\"number\">3</span>).<span class=\"title function_ invoke__\">unwrap</span>(); <span class=\"comment\">// 卖出3本</span></span><br><span class=\"line\">    inventory.<span class=\"title function_ invoke__\">update_quantity</span>(<span class=\"number\">1</span>, <span class=\"number\">5</span>).<span class=\"title function_ invoke__\">unwrap</span>(); <span class=\"comment\">// 进货5本</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 尝试无效更新</span></span><br><span class=\"line\">    <span class=\"keyword\">match</span> inventory.<span class=\"title function_ invoke__\">update_quantity</span>(<span class=\"number\">1</span>, -<span class=\"number\">20</span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(_) =&gt; &#123;&#125;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(e) =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Error: &#123;&#125;&quot;</span>, e),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 删除书籍</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;\\nRemoving book ID 3:&quot;</span>);</span><br><span class=\"line\">    inventory.<span class=\"title function_ invoke__\">remove_book</span>(<span class=\"number\">3</span>).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 列出所有书籍</span></span><br><span class=\"line\">    inventory.<span class=\"title function_ invoke__\">list_all_books</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 尝试删除不存在的书籍</span></span><br><span class=\"line\">    <span class=\"keyword\">match</span> inventory.<span class=\"title function_ invoke__\">remove_book</span>(<span class=\"number\">99</span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(_) =&gt; &#123;&#125;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(e) =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;\\nError: &#123;&#125;&quot;</span>, e),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/13_collection\" >Codes in lesson13<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p>Rust 中的常见集合有 Vector 和 HashMap</p>\n<h2 id=\"Vector\"><a href=\"#Vector\" class=\"headerlink\" title=\"Vector\"></a>Vector</h2><h3 id=\"什么是-Vec\"><a href=\"#什么是-Vec\" class=\"headerlink\" title=\"什么是 Vec\"></a>什么是 Vec</h3><p>Vec 是一个动态数组，可以根据需要动态增长和缩小，适用于需要按顺序存储数据的场景</p>\n<h3 id=\"Vec-的基本操作\"><a href=\"#Vec-的基本操作\" class=\"headerlink\" title=\"Vec 的基本操作\"></a>Vec 的基本操作</h3><h4 id=\"创建和初始化\"><a href=\"#创建和初始化\" class=\"headerlink\" title=\"创建和初始化\"></a>创建和初始化</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">v</span>: <span class=\"type\">Vec</span>&lt;<span class=\"type\">i32</span>&gt; = <span class=\"type\">Vec</span>::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">v</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"添加元素\"><a href=\"#添加元素\" class=\"headerlink\" title=\"添加元素\"></a>添加元素</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// let mut v = vec![1, 2, 3];</span></span><br><span class=\"line\">v.<span class=\"title function_ invoke__\">push</span>(<span class=\"number\">1</span>);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"访问元素\"><a href=\"#访问元素\" class=\"headerlink\" title=\"访问元素\"></a>访问元素</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">v</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 直接引用访问</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">third</span> = &amp;v[<span class=\"number\">2</span>];</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;third: &#123;third&#125;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用 get 访问</span></span><br><span class=\"line\"><span class=\"keyword\">match</span> v.<span class=\"title function_ invoke__\">get</span>(<span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Some</span>(val) =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;value: &#123;val&#125;&quot;</span>),</span><br><span class=\"line\">    <span class=\"literal\">None</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Index error&quot;</span>),</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"修改元素\"><a href=\"#修改元素\" class=\"headerlink\" title=\"修改元素\"></a>修改元素</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">v</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\">v[<span class=\"number\">0</span>] = <span class=\"number\">0</span>;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"遍历元素\"><a href=\"#遍历元素\" class=\"headerlink\" title=\"遍历元素\"></a>遍历元素</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 如果不用引用，v 的所有权会被转移</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> <span class=\"variable\">i</span> <span class=\"keyword\">in</span> &amp;v &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;i: &#123;i&#125;&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Vec-的进阶用法\"><a href=\"#Vec-的进阶用法\" class=\"headerlink\" title=\"Vec 的进阶用法\"></a>Vec 的进阶用法</h3><h4 id=\"使用枚举存储多种类型\"><a href=\"#使用枚举存储多种类型\" class=\"headerlink\" title=\"使用枚举存储多种类型\"></a>使用枚举存储多种类型</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">SpreadSheetCell</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Int</span>(<span class=\"type\">i32</span>),</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Float</span>(<span class=\"type\">f64</span>),</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Test</span>(<span class=\"type\">String</span>),</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">row</span> = <span class=\"built_in\">vec!</span>[</span><br><span class=\"line\">    SpreadSheetCell::<span class=\"title function_ invoke__\">Int</span>(<span class=\"number\">3</span>),</span><br><span class=\"line\">    SpreadSheetCell::<span class=\"title function_ invoke__\">Float</span>(<span class=\"number\">10.12</span>),</span><br><span class=\"line\">    SpreadSheetCell::<span class=\"title function_ invoke__\">Test</span>(<span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Hello&quot;</span>)),</span><br><span class=\"line\">];</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"容量与重新分配\"><a href=\"#容量与重新分配\" class=\"headerlink\" title=\"容量与重新分配\"></a>容量与重新分配</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">v</span>: <span class=\"type\">Vec</span>&lt;<span class=\"type\">i32</span>&gt; = <span class=\"type\">Vec</span>::<span class=\"title function_ invoke__\">with_capacity</span>(<span class=\"number\">10</span>);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;capacity: &#123;&#125;&quot;</span>, v.<span class=\"title function_ invoke__\">capacity</span>()); <span class=\"comment\">// 10</span></span><br><span class=\"line\">v.<span class=\"title function_ invoke__\">push</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;capacity: &#123;&#125;&quot;</span>, v.<span class=\"title function_ invoke__\">capacity</span>()); <span class=\"comment\">// 10</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Vec-的常见陷阱\"><a href=\"#Vec-的常见陷阱\" class=\"headerlink\" title=\"Vec 的常见陷阱\"></a>Vec 的常见陷阱</h3><h4 id=\"不安全的索引访问\"><a href=\"#不安全的索引访问\" class=\"headerlink\" title=\"不安全的索引访问\"></a>不安全的索引访问</h4><p>用 if 判断索引是否合法，或者使用 match</p>\n<h4 id=\"可变引用与不可变引用的混用\"><a href=\"#可变引用与不可变引用的混用\" class=\"headerlink\" title=\"可变引用与不可变引用的混用\"></a>可变引用与不可变引用的混用</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// let mut v = vec![1, 2, 3];</span></span><br><span class=\"line\"><span class=\"comment\">// let first = &amp;v[0]; // 不可变借用</span></span><br><span class=\"line\"><span class=\"comment\">// v.push(4); // 可变借用，error: mutable borrow occurs here</span></span><br><span class=\"line\"><span class=\"comment\">// println!(&quot;The first element is : &#123;&#125;&quot;, first);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">v</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">first</span> = &amp;v[<span class=\"number\">0</span>]; <span class=\"comment\">// 不可变借用</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;The first element is : &#123;&#125;&quot;</span>, first);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">v.<span class=\"title function_ invoke__\">push</span>(<span class=\"number\">4</span>); <span class=\"comment\">// 可变借用，error: mutable borrow occurs here</span></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;v: &#123;:?&#125;&quot;</span>, v);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"HashMap\"><a href=\"#HashMap\" class=\"headerlink\" title=\"HashMap\"></a>HashMap</h2><h3 id=\"什么是-HashMap\"><a href=\"#什么是-HashMap\" class=\"headerlink\" title=\"什么是 HashMap\"></a>什么是 HashMap</h3><p>HashMap 是一个键值对（key-value）存储的数据结构，适用于需要快速查找数据的场景</p>\n<h3 id=\"HashMap-的基本操作\"><a href=\"#HashMap-的基本操作\" class=\"headerlink\" title=\"HashMap 的基本操作\"></a>HashMap 的基本操作</h3><h4 id=\"创建和初始化-1\"><a href=\"#创建和初始化-1\" class=\"headerlink\" title=\"创建和初始化\"></a>创建和初始化</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">scores</span>: HashMap&lt;_, _&gt; = HashMap::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">scores.<span class=\"title function_ invoke__\">insert</span>(<span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Blue&quot;</span>), <span class=\"number\">10</span>);</span><br><span class=\"line\">scores.<span class=\"title function_ invoke__\">insert</span>(<span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;yellow&quot;</span>), <span class=\"number\">50</span>);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"访问元素-1\"><a href=\"#访问元素-1\" class=\"headerlink\" title=\"访问元素\"></a>访问元素</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">team_name</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Blue&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">score</span> = scores.<span class=\"title function_ invoke__\">get</span>(&amp;team_name);</span><br><span class=\"line\"><span class=\"keyword\">match</span> score &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Some</span>(s) =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;The &#123;&#125; score is &#123;&#125;&quot;</span>, team_name, s),</span><br><span class=\"line\">    <span class=\"literal\">None</span> =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;No score for this team&quot;</span>),</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"遍历元素-1\"><a href=\"#遍历元素-1\" class=\"headerlink\" title=\"遍历元素\"></a>遍历元素</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用引用防止所有权转移</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (team, score) <span class=\"keyword\">in</span> &amp;scores &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, team, score);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"HashMap-的进阶用法\"><a href=\"#HashMap-的进阶用法\" class=\"headerlink\" title=\"HashMap 的进阶用法\"></a>HashMap 的进阶用法</h3><h4 id=\"更新哈希表\"><a href=\"#更新哈希表\" class=\"headerlink\" title=\"更新哈希表\"></a>更新哈希表</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scores.<span class=\"title function_ invoke__\">insert</span>(<span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Blue&quot;</span>), <span class=\"number\">25</span>);</span><br><span class=\"line\">scores.<span class=\"title function_ invoke__\">entry</span>(<span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Yellow&quot;</span>)).<span class=\"title function_ invoke__\">or_insert</span>(<span class=\"number\">100</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">entry</span> = scores.<span class=\"title function_ invoke__\">entry</span>(<span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Red&quot;</span>)).<span class=\"title function_ invoke__\">or_insert</span>(<span class=\"number\">30</span>);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;entry: &#123;entry&#125;&quot;</span>); <span class=\"comment\">// 30</span></span><br><span class=\"line\">*entry += <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;entry: &#123;entry&#125;&quot;</span>); <span class=\"comment\">// 40</span></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;:?&#125;&quot;</span>, scores);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"合并哈希表\"><a href=\"#合并哈希表\" class=\"headerlink\" title=\"合并哈希表\"></a>合并哈希表</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">map1</span> = HashMap::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">map1.<span class=\"title function_ invoke__\">insert</span>(<span class=\"string\">&quot;a&quot;</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">map1.<span class=\"title function_ invoke__\">insert</span>(<span class=\"string\">&quot;b&quot;</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">map2</span> = HashMap::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">map2.<span class=\"title function_ invoke__\">insert</span>(<span class=\"string\">&quot;b&quot;</span>, <span class=\"number\">3</span>);</span><br><span class=\"line\">map2.<span class=\"title function_ invoke__\">insert</span>(<span class=\"string\">&quot;c&quot;</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\"><span class=\"keyword\">for</span> (k, v) <span class=\"keyword\">in</span> map2 &#123;</span><br><span class=\"line\">    <span class=\"comment\">// map1.insert(k, v);</span></span><br><span class=\"line\">    map1.<span class=\"title function_ invoke__\">entry</span>(k).<span class=\"title function_ invoke__\">or_insert</span>(v);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"生成哈希-key\"><a href=\"#生成哈希-key\" class=\"headerlink\" title=\"生成哈希 key\"></a>生成哈希 key</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::hash::&#123;DefaultHasher, Hash, Hasher&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">calculate_hash</span>&lt;T: Hash&gt;(t: &amp;T) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">u64</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = DefaultHasher::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">    t.<span class=\"title function_ invoke__\">hash</span>(&amp;<span class=\"keyword\">mut</span> s);</span><br><span class=\"line\">    s.<span class=\"title function_ invoke__\">finish</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">hashmap_study</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">key1</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;key1&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">key2</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;key2&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;hash of key1: &#123;&#125;, and key2: &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">calculate_hash</span>(&amp;key1),</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">calculate_hash</span>(&amp;key2)</span><br><span class=\"line\">    );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"HashMap-的常见陷阱\"><a href=\"#HashMap-的常见陷阱\" class=\"headerlink\" title=\"HashMap 的常见陷阱\"></a>HashMap 的常见陷阱</h3><h4 id=\"哈希冲突\"><a href=\"#哈希冲突\" class=\"headerlink\" title=\"哈希冲突\"></a>哈希冲突</h4><p>使用 <code>.entry().or_insert()</code></p>\n<h4 id=\"值的所有权问题\"><a href=\"#值的所有权问题\" class=\"headerlink\" title=\"值的所有权问题\"></a>值的所有权问题</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">field_name</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;color&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">field_value</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Blue&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">map</span> = HashMap::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\"><span class=\"comment\">// map.insert(field_name, field_value);</span></span><br><span class=\"line\"><span class=\"comment\">// println!(&quot;field_name: &#123;&#125;&quot;, field_name); // error: value borrowed here after move</span></span><br><span class=\"line\">map.<span class=\"title function_ invoke__\">insert</span>(field_name.<span class=\"title function_ invoke__\">clone</span>(), field_value.<span class=\"title function_ invoke__\">clone</span>());</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;field_name: &#123;&#125;&quot;</span>, field_name);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"练习题\"><a href=\"#练习题\" class=\"headerlink\" title=\"练习题\"></a>练习题</h2><h3 id=\"练习-1\"><a href=\"#练习-1\" class=\"headerlink\" title=\"练习 1\"></a>练习 1</h3><p>使用 Vec 实现一个简单的栈<br>实现一个简单的栈（后进先出，LIFO）数据结构，支持 push、pop 和 peek 操作。</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Stack</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    elements: <span class=\"type\">Vec</span>&lt;T&gt;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span>&lt;T&gt; Stack&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">new</span>() <span class=\"punctuation\">-&gt;</span> <span class=\"keyword\">Self</span> &#123;</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            Stack &#123;</span><br><span class=\"line\">                elements: <span class=\"type\">Vec</span>::<span class=\"title function_ invoke__\">new</span>(),</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">push</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>, item: T) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.elements.<span class=\"title function_ invoke__\">push</span>(item);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">pop</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Option</span>&lt;T&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.elements.<span class=\"title function_ invoke__\">pop</span>()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">peek</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Option</span>&lt;&amp;T&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.elements.<span class=\"title function_ invoke__\">last</span>()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">stack</span> = Stack::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 压入元素</span></span><br><span class=\"line\">    stack.<span class=\"title function_ invoke__\">push</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">    stack.<span class=\"title function_ invoke__\">push</span>(<span class=\"number\">2</span>);</span><br><span class=\"line\">    stack.<span class=\"title function_ invoke__\">push</span>(<span class=\"number\">3</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 查看栈顶</span></span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(stack.<span class=\"title function_ invoke__\">peek</span>(), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">3</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 弹出元素</span></span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(stack.<span class=\"title function_ invoke__\">pop</span>(), <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">3</span>));</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(stack.<span class=\"title function_ invoke__\">peek</span>(), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">2</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 继续弹出和压入</span></span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(stack.<span class=\"title function_ invoke__\">pop</span>(), <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">2</span>));</span><br><span class=\"line\">    stack.<span class=\"title function_ invoke__\">push</span>(<span class=\"number\">4</span>);</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(stack.<span class=\"title function_ invoke__\">peek</span>(), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">4</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 清空栈</span></span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(stack.<span class=\"title function_ invoke__\">pop</span>(), <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">4</span>));</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(stack.<span class=\"title function_ invoke__\">pop</span>(), <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">1</span>));</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(stack.<span class=\"title function_ invoke__\">pop</span>(), <span class=\"literal\">None</span>); <span class=\"comment\">// 空栈时返回 None</span></span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(stack.<span class=\"title function_ invoke__\">peek</span>(), <span class=\"literal\">None</span>); <span class=\"comment\">// 空栈时返回 None</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"练习-2\"><a href=\"#练习-2\" class=\"headerlink\" title=\"练习 2\"></a>练习 2</h3><p>使用 HashMap 实现一个字频统计器<br>编写一个程序，统计一个字符串中每个单词出现的频率。</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::collections::HashMap;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">word_frequency</span>(text: &amp;<span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> HashMap&lt;<span class=\"type\">String</span>, <span class=\"type\">u32</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">frequency_map</span> = HashMap::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"variable\">word</span> <span class=\"keyword\">in</span> text.<span class=\"title function_ invoke__\">split_whitespace</span>() &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 清理单词并转换为 String（拥有所有权）</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"variable\">cleaned_word</span> = word</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">chars</span>() <span class=\"comment\">// 将单词分解为字符迭代器</span></span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">filter</span>(|c| c.<span class=\"title function_ invoke__\">is_alphanumeric</span>()) <span class=\"comment\">// 保留字母和数字字符，过滤标点符号</span></span><br><span class=\"line\">            .collect::&lt;<span class=\"type\">String</span>&gt;() <span class=\"comment\">// 将过滤后的字符收集为 String</span></span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">to_lowercase</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> cleaned_word.<span class=\"title function_ invoke__\">is_empty</span>() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 使用 String 作为键（拥有所有权）</span></span><br><span class=\"line\">        *frequency_map.<span class=\"title function_ invoke__\">entry</span>(cleaned_word).<span class=\"title function_ invoke__\">or_insert</span>(<span class=\"number\">0</span>) += <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    frequency_map</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">text</span> = <span class=\"string\">&quot;Hello world! Hello Rust. Rust is awesome. World says hello to Rust.&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">frequency</span> = <span class=\"title function_ invoke__\">word_frequency</span>(text);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Word frequency:&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (word, count) <span class=\"keyword\">in</span> &amp;frequency &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, word, count);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 验证结果</span></span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(frequency.<span class=\"title function_ invoke__\">get</span>(<span class=\"string\">&quot;hello&quot;</span>), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">3</span>));</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(frequency.<span class=\"title function_ invoke__\">get</span>(<span class=\"string\">&quot;rust&quot;</span>), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">3</span>));</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(frequency.<span class=\"title function_ invoke__\">get</span>(<span class=\"string\">&quot;world&quot;</span>), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">2</span>));</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(frequency.<span class=\"title function_ invoke__\">get</span>(<span class=\"string\">&quot;is&quot;</span>), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">1</span>));</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(frequency.<span class=\"title function_ invoke__\">get</span>(<span class=\"string\">&quot;says&quot;</span>), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">1</span>));</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(frequency.<span class=\"title function_ invoke__\">get</span>(<span class=\"string\">&quot;to&quot;</span>), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">1</span>));</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(frequency.<span class=\"title function_ invoke__\">get</span>(<span class=\"string\">&quot;awesome&quot;</span>), <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"number\">1</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"练习3\"><a href=\"#练习3\" class=\"headerlink\" title=\"练习3\"></a>练习3</h3><p>综合练习：使用 Vec 和 HashMap 实现一个简单的书籍库存管理系统<br>实现一个书籍库存管理系统，可以添加书籍、查询库存、更新库存以及删除书籍。</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::collections::HashMap;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::fmt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 书籍结构体</span></span><br><span class=\"line\"><span class=\"meta\">#[derive(Debug, Clone)]</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Book</span> &#123;</span><br><span class=\"line\">    id: <span class=\"type\">u32</span>,        <span class=\"comment\">// 唯一标识符</span></span><br><span class=\"line\">    title: <span class=\"type\">String</span>,  <span class=\"comment\">// 书名</span></span><br><span class=\"line\">    author: <span class=\"type\">String</span>, <span class=\"comment\">// 作者</span></span><br><span class=\"line\">    price: <span class=\"type\">f64</span>,     <span class=\"comment\">// 价格</span></span><br><span class=\"line\">    quantity: <span class=\"type\">u32</span>,  <span class=\"comment\">// 库存数量</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Book</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 创建新书籍</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">new</span>(id: <span class=\"type\">u32</span>, title: &amp;<span class=\"type\">str</span>, author: &amp;<span class=\"type\">str</span>, price: <span class=\"type\">f64</span>, quantity: <span class=\"type\">u32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"keyword\">Self</span> &#123;</span><br><span class=\"line\">        Book &#123;</span><br><span class=\"line\">            id,</span><br><span class=\"line\">            title: title.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">            author: author.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">            price,</span><br><span class=\"line\">            quantity,</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 为 Book 实现 Display trait 以便打印</span></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">fmt</span>::Display <span class=\"keyword\">for</span> <span class=\"title class_\">Book</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">fmt</span>(&amp;<span class=\"keyword\">self</span>, f: &amp;<span class=\"keyword\">mut</span> fmt::Formatter&lt;<span class=\"symbol\">&#x27;_</span>&gt;) <span class=\"punctuation\">-&gt;</span> fmt::<span class=\"type\">Result</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">write!</span>(</span><br><span class=\"line\">            f,</span><br><span class=\"line\">            <span class=\"string\">&quot;ID: &#123;&#125;, Title: &#x27;&#123;&#125;&#x27;, Author: &#x27;&#123;&#125;&#x27;, Price: $&#123;:.2&#125;, Quantity: &#123;&#125;&quot;</span>,</span><br><span class=\"line\">            <span class=\"keyword\">self</span>.id, <span class=\"keyword\">self</span>.title, <span class=\"keyword\">self</span>.author, <span class=\"keyword\">self</span>.price, <span class=\"keyword\">self</span>.quantity</span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 库存管理系统</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">InventoryManager</span> &#123;</span><br><span class=\"line\">    books_by_id: HashMap&lt;<span class=\"type\">u32</span>, Book&gt;,           <span class=\"comment\">// 按 ID 快速查找</span></span><br><span class=\"line\">    books_by_title: HashMap&lt;<span class=\"type\">String</span>, <span class=\"type\">Vec</span>&lt;<span class=\"type\">u32</span>&gt;&gt;, <span class=\"comment\">// 按书名查找 ID 列表</span></span><br><span class=\"line\">    next_id: <span class=\"type\">u32</span>,                              <span class=\"comment\">// 下一个可用 ID</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">InventoryManager</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 创建新的库存管理系统</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">new</span>() <span class=\"punctuation\">-&gt;</span> <span class=\"keyword\">Self</span> &#123;</span><br><span class=\"line\">        InventoryManager &#123;</span><br><span class=\"line\">            books_by_id: HashMap::<span class=\"title function_ invoke__\">new</span>(),</span><br><span class=\"line\">            books_by_title: HashMap::<span class=\"title function_ invoke__\">new</span>(),</span><br><span class=\"line\">            next_id: <span class=\"number\">1</span>,</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 添加新书</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">add_book</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>, title: &amp;<span class=\"type\">str</span>, author: &amp;<span class=\"type\">str</span>, price: <span class=\"type\">f64</span>, quantity: <span class=\"type\">u32</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"variable\">id</span> = <span class=\"keyword\">self</span>.next_id;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.next_id += <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"variable\">book</span> = Book::<span class=\"title function_ invoke__\">new</span>(id, title, author, price, quantity);</span><br><span class=\"line\">        <span class=\"comment\">// 添加到 ID 索引</span></span><br><span class=\"line\">        <span class=\"keyword\">self</span>.books_by_id.<span class=\"title function_ invoke__\">insert</span>(id, book.<span class=\"title function_ invoke__\">clone</span>());</span><br><span class=\"line\">        <span class=\"comment\">// 添加到书名索引</span></span><br><span class=\"line\">        <span class=\"keyword\">self</span>.books_by_title</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">entry</span>(title.<span class=\"title function_ invoke__\">to_lowercase</span>())</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">or_insert_with</span>(<span class=\"type\">Vec</span>::new)</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">push</span>(id);</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Added book: &#123;&#125;&quot;</span>, book);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 按 ID 查找书籍</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">find_by_id</span>(&amp;<span class=\"keyword\">self</span>, id: <span class=\"type\">u32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Option</span>&lt;&amp;Book&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.books_by_id.<span class=\"title function_ invoke__\">get</span>(&amp;id)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 按书名查找书籍</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">find_by_title</span>(&amp;<span class=\"keyword\">self</span>, title: &amp;<span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Vec</span>&lt;&amp;Book&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"variable\">title_lower</span> = title.<span class=\"title function_ invoke__\">to_lowercase</span>();</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.books_by_title</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">get</span>(&amp;title_lower)</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">map</span>(|ids| &#123;</span><br><span class=\"line\">                ids.<span class=\"title function_ invoke__\">iter</span>()</span><br><span class=\"line\">                    .<span class=\"title function_ invoke__\">filter_map</span>(|id| <span class=\"keyword\">self</span>.books_by_id.<span class=\"title function_ invoke__\">get</span>(id))</span><br><span class=\"line\">                    .<span class=\"title function_ invoke__\">collect</span>()</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">unwrap_or_else</span>(<span class=\"type\">Vec</span>::new)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 更新库存数量</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">update_quantity</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>, id: <span class=\"type\">u32</span>, delta: <span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;(), <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Some</span>(book) = <span class=\"keyword\">self</span>.books_by_id.<span class=\"title function_ invoke__\">get_mut</span>(&amp;id) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"variable\">new_quantity</span> = book.quantity <span class=\"keyword\">as</span> <span class=\"type\">i32</span> + delta;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> new_quantity &lt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">Err</span>(<span class=\"built_in\">format!</span>(</span><br><span class=\"line\">                    <span class=\"string\">&quot;Cannot update quantity for book ID &#123;&#125;. Negative quantity not allowed.&quot;</span>,</span><br><span class=\"line\">                    id</span><br><span class=\"line\">                ));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            book.quantity = new_quantity <span class=\"keyword\">as</span> <span class=\"type\">u32</span>;</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Updated book ID &#123;&#125;: new quantity = &#123;&#125;&quot;</span>, id, book.quantity);</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">Ok</span>(())</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">Err</span>(<span class=\"built_in\">format!</span>(<span class=\"string\">&quot;Book with ID &#123;&#125; not found&quot;</span>, id))</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 删除书籍</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">remove_book</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>, id: <span class=\"type\">u32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;(), <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Some</span>(book) = <span class=\"keyword\">self</span>.books_by_id.<span class=\"title function_ invoke__\">remove</span>(&amp;id) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 从书名索引中移除</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Some</span>(ids) = <span class=\"keyword\">self</span>.books_by_title.<span class=\"title function_ invoke__\">get_mut</span>(&amp;book.title.<span class=\"title function_ invoke__\">to_lowercase</span>()) &#123;</span><br><span class=\"line\">                ids.<span class=\"title function_ invoke__\">retain</span>(|&amp;book_id| book_id != id);</span><br><span class=\"line\">                <span class=\"comment\">// 如果该书名下没有其他书籍，移除整个条目</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> ids.<span class=\"title function_ invoke__\">is_empty</span>() &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">self</span>.books_by_title.<span class=\"title function_ invoke__\">remove</span>(&amp;book.title.<span class=\"title function_ invoke__\">to_lowercase</span>());</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Removed book: &#123;&#125;&quot;</span>, book);</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">Ok</span>(())</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">Err</span>(<span class=\"built_in\">format!</span>(<span class=\"string\">&quot;Book with ID &#123;&#125; not found&quot;</span>, id))</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 列出所有书籍</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">list_all_books</span>(&amp;<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;\\n--- Inventory Report ---&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">self</span>.books_by_id.<span class=\"title function_ invoke__\">is_empty</span>() &#123;</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;No books in inventory&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> <span class=\"variable\">book</span> <span class=\"keyword\">in</span> <span class=\"keyword\">self</span>.books_by_id.<span class=\"title function_ invoke__\">values</span>() &#123;</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, book);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Total books: &#123;&#125;&quot;</span>, <span class=\"keyword\">self</span>.books_by_id.<span class=\"title function_ invoke__\">len</span>());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">inventory</span> = InventoryManager::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 添加书籍</span></span><br><span class=\"line\">    inventory.<span class=\"title function_ invoke__\">add_book</span>(<span class=\"string\">&quot;The Rust Programming Language&quot;</span>, <span class=\"string\">&quot;Steve Klabnik&quot;</span>, <span class=\"number\">39.99</span>, <span class=\"number\">10</span>);</span><br><span class=\"line\">    inventory.<span class=\"title function_ invoke__\">add_book</span>(<span class=\"string\">&quot;Programming Rust&quot;</span>, <span class=\"string\">&quot;Jim Blandy&quot;</span>, <span class=\"number\">49.99</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\">    inventory.<span class=\"title function_ invoke__\">add_book</span>(<span class=\"string\">&quot;Rust in Action&quot;</span>, <span class=\"string\">&quot;Tim McNamara&quot;</span>, <span class=\"number\">44.99</span>, <span class=\"number\">8</span>);</span><br><span class=\"line\">    inventory.<span class=\"title function_ invoke__\">add_book</span>(<span class=\"string\">&quot;The Rust Programming Language&quot;</span>, <span class=\"string\">&quot;Carol Nichols&quot;</span>, <span class=\"number\">39.99</span>, <span class=\"number\">15</span>); <span class=\"comment\">// 同名不同作者</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 查询书籍</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;\\nSearching for books by title &#x27;Rust&#x27;:&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"variable\">book</span> <span class=\"keyword\">in</span> inventory.<span class=\"title function_ invoke__\">find_by_title</span>(<span class=\"string\">&quot;Rust&quot;</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;- &#123;&#125;&quot;</span>, book);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;\\nSearching for book ID 2:&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Some</span>(book) = inventory.<span class=\"title function_ invoke__\">find_by_id</span>(<span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;- &#123;&#125;&quot;</span>, book);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 更新库存</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;\\nUpdating stock:&quot;</span>);</span><br><span class=\"line\">    inventory.<span class=\"title function_ invoke__\">update_quantity</span>(<span class=\"number\">1</span>, -<span class=\"number\">3</span>).<span class=\"title function_ invoke__\">unwrap</span>(); <span class=\"comment\">// 卖出3本</span></span><br><span class=\"line\">    inventory.<span class=\"title function_ invoke__\">update_quantity</span>(<span class=\"number\">1</span>, <span class=\"number\">5</span>).<span class=\"title function_ invoke__\">unwrap</span>(); <span class=\"comment\">// 进货5本</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 尝试无效更新</span></span><br><span class=\"line\">    <span class=\"keyword\">match</span> inventory.<span class=\"title function_ invoke__\">update_quantity</span>(<span class=\"number\">1</span>, -<span class=\"number\">20</span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(_) =&gt; &#123;&#125;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(e) =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Error: &#123;&#125;&quot;</span>, e),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 删除书籍</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;\\nRemoving book ID 3:&quot;</span>);</span><br><span class=\"line\">    inventory.<span class=\"title function_ invoke__\">remove_book</span>(<span class=\"number\">3</span>).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 列出所有书籍</span></span><br><span class=\"line\">    inventory.<span class=\"title function_ invoke__\">list_all_books</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 尝试删除不存在的书籍</span></span><br><span class=\"line\">    <span class=\"keyword\">match</span> inventory.<span class=\"title function_ invoke__\">remove_book</span>(<span class=\"number\">99</span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(_) =&gt; &#123;&#125;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(e) =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;\\nError: &#123;&#125;&quot;</span>, e),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","_processedHighlight":true},{"title":"IB-Rust-返回值与错误处理","date":"2025-06-02T13:59:06.000Z","_content":"\n[Codes in lesson14](https://github.com/Zoella-w/IB-Rust/tree/main/14_return_error)\n\n\n## Option 返回值\n\n```rust\nlet mut s = String::from(\"A\");\nlet p1 = s.pop();\ndbg!(p1); // Some('A')\nlet p2 = s.pop();\ndbg!(p2); // None\n```\n\n### 解构 Option\n\n```rust\nenum Option<T> {\n    Some(T),\n    None,\n}\n```\n\n### 匹配 `Option`\n\n```rust\nfn plus_one(x: Option<i32>) -> Option<i32> {\n    match x {\n        None => None,\n        Some(i) => Some(i + 1),\n    }\n}\nfn main() {\n    let five = Some(5);\n    let six = plus_one(five); // Some(6)\n    let none = plus_one(None); // None\n}\n```\n\n### `Option<T>` 的辅助函数\n\n>  Method overview https://doc.rust-lang.org/std/option/\n\n#### 使用 unwrap\n\n如果确定 Option 存在值，可以使用 `unwrap` 方法来获取该值；如果 Option 不存在值，则会触发 panic\n\n```rust\nlet mut s = String::from(\"A\");\nlet p1 = s.pop().unwrap(); // \"A\"\n// let p2 = s.pop().unwrap(); // panic: called `Option::unwrap()` on a `None` value\n```\n\n#### 使用 is_some 和 is_none\n\n可以使用 `is_some` 和 `is_none` 方法来判断 Option 中是否存在值。\n\n```rust\nlet v = [10, 40, 30];\nif v.get(1).is_some() {\n    println!(\"{}\", v[1]); // 40\n}\n```\n\n#### 使用 unwrap_or 提供默认值\n\n```rust\nfn div(a: i32, b: i32) -> Option<f64> {\n    if b != 0 {\n        Some(a as f64 / b as f64)\n    } else {\n        None\n    }\n}\nfn main() {\n    let a = 10;\n    let b = 0;\n    let result = div(a, b).unwrap_or(0.0); // 0.0\n}\n```\n\n## 错误处理\n\nRust 中的错误主要分为两类：\n\n- **可恢复错误**，通常是从系统全局角度看可以接受的错误，例如处理用户的访问、操作等错误，这些错误只会影响某用户自身的操作进程，而不会影响系统的全局稳定性\n- **不可恢复错误**，通常是全局性或者系统性的错误，例如数组越界访问，系统启动时发生了影响启动流程的错误等，这些错误对系统来说往往是致命的\n\n- `Result<T, E>` 用于可恢复错误\n- `panic!` 用于不可恢复错误\n\n## 用 `panic!` 处理不可恢复的错误\n\n### 触发\n\n#### 被动触发\n\nC 语言中，读取数据结构未定义的值，会得到对应数据结构中这个元素内存位置的值（这些内存可能并不属于该数据结构），这被称为**缓冲区溢出**，并会导致安全漏洞，比如攻击者可以通过操作索引，读取储存在数据结构之后不被允许的数据\n\n为防范此类漏洞，如果读取索引不存在的元素，Rust 会停止执行，发生 panic\n\n```rust\nlet v = vec![1, 2, 3];\nv[99];\n```\n\n#### 主动调用\n\nRust 提供了 `panic!` 宏，当调用执行该宏时，程序会打印出错误信息，展开报错点之前的函数调用堆栈，并退出程序\n\n```rust\npanic!(\"crash and burn\");\n```\n\n### backtrace 栈展开\n\n```shell\nRUST_BACKTRACE=1 cargo run\n```\n\n在栈展开（或栈回溯）中，函数调用按照逆序排列：最近调用的排在最上方\n\n要获取栈回溯信息，还需要开启 `debug` 标志。当不使用 `--release` 参数运行 `cargo build` 或 `cargo run` 时， `debug` 标识会默认启用\n\n### panic 的两种终止方式\n\n- **栈展开（*unwinding*）（默认）**: Rust 会回溯栈上数据和函数调用，可以给出充分的报错和栈调用信息，便于问题复盘，不过也意味着更多的善后工作\n- **直接终止（*abort*）**: 不清理数据就直接退出程序，善后工作交与操作系统负责\n\n大多数情况，使用默认选择最好；当关心编译出的二进制可执行文件大小时，可以使用直接终止的方式，例如下面的 `Cargo.toml` 配置文件，可以实现在 `release` 模式下，遇到 `panic` 直接终止：\n\n```toml\n[profile.release]\npanic = 'abort'\n```\n```shell\nRUST_BACKTRACE=1 cargo run --release\n```\n\n## 用 `Result` 处理可恢复的错误\n\n大部分错误并没有严重到需要程序完全停止执行，例如，如果因为打开一个并不存在的文件而失败，此时我们可能想创建这个文件，而不是终止进程\n\n- `Ok(T)`：泛型参数 `T` 代表成功时存入的正确值的类型\n- `Err(E)`：`E` 代表错误时存入的错误值，存放方式是\n\n```rust\nenum Result<T, E> {\n    Ok(T),\n    Err(E),\n}\n```\n\n### 返回 `Result`\n\n#### 例1\n\n```rust\nfn div(x: f64, y: f64) -> Result<f64, String> {\n    if y == 0.0 {\n        // 此操作将会失败，那么（与其让程序崩溃）不如把失败的原因包装在 Err 中并返回\n        Err((\"y is zero\").to_string())\n    } else {\n        // 此操作是有效的，返回包装在 Ok 中的结果\n        Ok(x / y)\n    }\n}\n```\n\n#### 例2\n\n```rust\n#[derive(Debug)]\npub enum MathError {\n    DivisionByZero,\n    NegativeSquareRoot,\n}\nfn div(x: f64, y: f64) -> Result<f64, MathError> {\n    if y == 0.0 {\n        Err(MathError::DivisionByZero)\n    } else {\n        Ok(x / y)\n    }\n}\nfn sqrt(x: f64) -> Result<f64, MathError> {\n    if x < 0.0 {\n        Err(MathError::NegativeSquareRoot)\n    } else {\n        Ok(x.sqrt())\n    }\n}\n```\n\n### 处理 `Result` \n\n```rust\nuse std::fs::File;\nfn main() {\n    let f = File::open(\"hello.txt\");\n    let f = match f {\n        Ok(file) => file,\n        Err(error) => {\n            panic!(\"Problem opening the file: {:?}\", error)\n        },\n    };\n}\n```\n\n#### 对返回的错误进行处理\n\n对不同的错误原因采取不同的行为：\n\n- 如果 `File::open `因为文件不存在而失败，我们希望创建这个文件并返回新文件的句柄\n- 如果 `File::open` 因为任何其他原因失败，例如没有打开文件的权限，我们仍然 `panic!`\n\n```rust\nuse std::fs::File;\nuse std::io::ErrorKind;\nfn main() {\n    let greeting_file_result = File::open(\"hello.txt\");\n    // `File::open` 返回的 `Err` 成员中的值类型 `io::Error` 是一个标准库中提供的结构体\n    // 该结构体有一个返回 `io::ErrorKind` 值的 `kind` 方法可供调用\n    // `io::ErrorKind` 是一个标准库提供的枚举，其成员对应 `io` 操作可能导致的不同错误类型\n    let greeting_file = match greeting_file_result {\n        Ok(file) => file,\n        Err(error) => match error.kind() {\n            ErrorKind::NotFound => match File::create(\"hello.txt\") {\n                Ok(fc) => fc,\n                Err(e) => panic!(\"Problem creating the file: {e:?}\"),\n            },\n            other_error => {\n                panic!(\"Problem opening the file: {other_error:?}\");\n            }\n        },\n    };\n}\n```\n\n### `Result<T, E>` 的辅助方法\n\n`match` 能够胜任，不过可能有点冗长且不总能很好的表明其意图`Result<T, E>` 类型定义了很多辅助方法来处理各种情况\n\n> Method overview: https://doc.rust-lang.org/std/result/index.html\n\n#### unwrap\n\n- 如果 `Result` 值是成员 `Ok`，`unwrap` 会返回 `Ok` 中的值\n- 如果 `Result` 是成员 `Err`，`unwrap` 会调用 `panic!`\n\n```rust\nuse std::fs::File;\nfn main() {\n    let f = File::open(\"hello.txt\").unwrap();\n}\n```\n\n#### expect\n\n`expect` 跟 `unwrap` 很像，也是遇到错误直接 `panic`, 但会有自定义的错误提示信息，相当于重载了错误打印的函数：\n\n```rust\nuse std::fs::File;\nfn main() {\n    let f = File::open(\"hello.txt\").expect(\"Failed to open hello.txt\");\n}\n```\n\n#### map\n\n`Result<T, E>` -> `Result<U, E>`\n\n```rust\nlet line = \"1\\n2\\n3\\n4\\n\";\nfor num in line.lines() {\n    match num.parse::<i32>().map(|i| i * 2) {\n        Ok(n) => println!(\"{n}\"),\n        Err(..) => {}\n    }\n}\n```\n\n#### map_err\n\n`Result<T, E>` ->`Result<T, F>`\n\n```rust\nfn x() -> Result<(), String> {\n    let f = File::open(\"hello.txt\").map_err(|e: std::io::Error| format!(\"{e}\") );\n    match f{\n        Err(e)=>Err(e),\n        Ok(_)=>{\n            Ok(())\n        }\n    }\n}\n```\n\n### 传播错误\n\n可以使用 `?` 运算符来简写\n\n对于 Result\n\n- 如果结果是 `Ok(T)`，则把 `T` 赋值给 `f`\n- 如果结果是 `Err(E)`，则返回该错误\n\n对于 Option\n\n- 如果值是 `Some`，`Some` 中的值作为表达式的返回值同时函数继续\n- 如果值是 `None`，此时 `None` 会从函数中提前返回\n\n```rust\nuse std::fs::File;\nuse std::io::Read;\nfn read_username_from_file() -> Result<String, std::io::Error> {\n    // // 打开文件，f是`Result<文件句柄,io::Error>`\n    // let f = File::open(\"hello.txt\");\n    // let mut f = match f {\n    //     // 打开文件成功，将file句柄赋值给f\n    //     Ok(file) => file,\n    //     // 打开文件失败，将错误返回(向上传播)\n    //     Err(e) => return Err(e),\n    // };\n    let mut f = File::open(\"hello.txt\")?;\n\n    // 创建动态字符串s\n    let mut s = String::new();\n\n    // // 从f文件句柄读取数据并写入s中\n    // match f.read_to_string(&mut s) {\n    //     // 读取成功，返回Ok封装的字符串\n    //     Ok(_) => Ok(s),\n    //     // 将错误向上传播\n    //     Err(e) => Err(e),\n    // }\n    f.read_to_string(&mut s)?;\n    Ok(s)\n}\n```\n\n### 链式方法调用\n\n```rust\nfn read_username_from_file() -> Result<String, std::io::Error> {\n    let mut s = String::new();\n    File::open(\"hello.txt\")?.read_to_string(&mut s)?;\n    Ok(s)\n}\n```\n\n### 常见错误\n\n```rust\nfn first(arr: &[i32]) -> Option<&i32> {\n   arr.get(0)?\n   // 正确\n   // let a = arr.get(0)?;\n   // return a;\n}\n```\n\n这段代码无法通过编译：`?` 操作符需要一个变量来承载值，这个函数只会返回 `Some(&i32)` 或者 `None`。而事实上，只有错误值能直接返回，正确的值不行，因为如果数组存在 0 号元素，函数第二行使用 `?` 后的返回类型是 `&i32` 而不是 `Some(&i32)`\n\n## Option 与 Result 的互相转换\n\n### `Option` -> `Result`: `ok_or()`\n\n-  `Some(v)` to `Ok(v)`\n-  `None` to `Err(err)` \n\n```rust\nfn first(arr: &[i32]) -> Result<&i32, &str> {\n    arr.get(0).ok_or(\"out of index\")\n}\n```\n\n### `Result` -> `Opiton`: `err()`\n\n- `Err(e)` to `Some(e)` \n- `Ok(v)` to `None`\n\n```rust\nlet f = File::open(\"hello.txt\").err();\nif f.is_some() {\n    println!(\"no file\");\n}\n```\n\n### `Result` -> `Opiton`: `ok()`\n\n- `Ok(e)` to `Some(e)` \n- `Err(v)` to `None`\n\n```rust\nlet f = File::open(\"hello.txt\").ok();\nif f.is_none(){\n    println!(\"no file\");\n}\n```\n\n## 课后习题\n\n```rust\n// 修复 call 函数的错误\n// 当 b 为 None 时，按默认值 1\nfn call(a: i32, b: i32) -> Result<f64, String> {\n    let r = divide(a, b); \n    let s = sqrt(r);\n    \n    Ok(s);\n}\n\nfn divide(a: i32, b: i32) -> Option<f64> {\n    if b != 0 {\n        Some(a as f64 / b as f64)\n    } else {\n        None\n    }\n}\n\npub enum MathError {\n    DivisionByZero,\n    NegativeSquareRoot,\n}\n\nfn sqrt(x: f64) -> Result<f64, MathError> {\n    if x < 0.0 {\n        Err(MathError::NegativeSquareRoot)\n    } else {\n        Ok(x.sqrt())\n    }\n}\n```\n\n#### 答案\n\n```rust\nfn call(a: i32, b: Option<i32>) -> Result<f64, String> {\n    let r = divide(a, b.unwrap_or(1)).ok_or(\"Division by zero\".to_string())?;\n    let s = sqrt(r).map_err(|e: MathError| -> String {\n        match e {\n            MathError::DivisionByZero => {\n                return \"DivisionByZero\".to_string();\n            }\n            MathError::NegativeSquareRoot => {\n                return \"NegativeSquareRoot\".to_string();\n            }\n        }\n    })?;\n    return Ok(s);\n}\n```\n","source":"_posts/72-IB-Rust-返回值与错误处理.md","raw":"---\ntitle: IB-Rust-返回值与错误处理\ndate: 2025-06-02 21:59:06\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson14](https://github.com/Zoella-w/IB-Rust/tree/main/14_return_error)\n\n\n## Option 返回值\n\n```rust\nlet mut s = String::from(\"A\");\nlet p1 = s.pop();\ndbg!(p1); // Some('A')\nlet p2 = s.pop();\ndbg!(p2); // None\n```\n\n### 解构 Option\n\n```rust\nenum Option<T> {\n    Some(T),\n    None,\n}\n```\n\n### 匹配 `Option`\n\n```rust\nfn plus_one(x: Option<i32>) -> Option<i32> {\n    match x {\n        None => None,\n        Some(i) => Some(i + 1),\n    }\n}\nfn main() {\n    let five = Some(5);\n    let six = plus_one(five); // Some(6)\n    let none = plus_one(None); // None\n}\n```\n\n### `Option<T>` 的辅助函数\n\n>  Method overview https://doc.rust-lang.org/std/option/\n\n#### 使用 unwrap\n\n如果确定 Option 存在值，可以使用 `unwrap` 方法来获取该值；如果 Option 不存在值，则会触发 panic\n\n```rust\nlet mut s = String::from(\"A\");\nlet p1 = s.pop().unwrap(); // \"A\"\n// let p2 = s.pop().unwrap(); // panic: called `Option::unwrap()` on a `None` value\n```\n\n#### 使用 is_some 和 is_none\n\n可以使用 `is_some` 和 `is_none` 方法来判断 Option 中是否存在值。\n\n```rust\nlet v = [10, 40, 30];\nif v.get(1).is_some() {\n    println!(\"{}\", v[1]); // 40\n}\n```\n\n#### 使用 unwrap_or 提供默认值\n\n```rust\nfn div(a: i32, b: i32) -> Option<f64> {\n    if b != 0 {\n        Some(a as f64 / b as f64)\n    } else {\n        None\n    }\n}\nfn main() {\n    let a = 10;\n    let b = 0;\n    let result = div(a, b).unwrap_or(0.0); // 0.0\n}\n```\n\n## 错误处理\n\nRust 中的错误主要分为两类：\n\n- **可恢复错误**，通常是从系统全局角度看可以接受的错误，例如处理用户的访问、操作等错误，这些错误只会影响某用户自身的操作进程，而不会影响系统的全局稳定性\n- **不可恢复错误**，通常是全局性或者系统性的错误，例如数组越界访问，系统启动时发生了影响启动流程的错误等，这些错误对系统来说往往是致命的\n\n- `Result<T, E>` 用于可恢复错误\n- `panic!` 用于不可恢复错误\n\n## 用 `panic!` 处理不可恢复的错误\n\n### 触发\n\n#### 被动触发\n\nC 语言中，读取数据结构未定义的值，会得到对应数据结构中这个元素内存位置的值（这些内存可能并不属于该数据结构），这被称为**缓冲区溢出**，并会导致安全漏洞，比如攻击者可以通过操作索引，读取储存在数据结构之后不被允许的数据\n\n为防范此类漏洞，如果读取索引不存在的元素，Rust 会停止执行，发生 panic\n\n```rust\nlet v = vec![1, 2, 3];\nv[99];\n```\n\n#### 主动调用\n\nRust 提供了 `panic!` 宏，当调用执行该宏时，程序会打印出错误信息，展开报错点之前的函数调用堆栈，并退出程序\n\n```rust\npanic!(\"crash and burn\");\n```\n\n### backtrace 栈展开\n\n```shell\nRUST_BACKTRACE=1 cargo run\n```\n\n在栈展开（或栈回溯）中，函数调用按照逆序排列：最近调用的排在最上方\n\n要获取栈回溯信息，还需要开启 `debug` 标志。当不使用 `--release` 参数运行 `cargo build` 或 `cargo run` 时， `debug` 标识会默认启用\n\n### panic 的两种终止方式\n\n- **栈展开（*unwinding*）（默认）**: Rust 会回溯栈上数据和函数调用，可以给出充分的报错和栈调用信息，便于问题复盘，不过也意味着更多的善后工作\n- **直接终止（*abort*）**: 不清理数据就直接退出程序，善后工作交与操作系统负责\n\n大多数情况，使用默认选择最好；当关心编译出的二进制可执行文件大小时，可以使用直接终止的方式，例如下面的 `Cargo.toml` 配置文件，可以实现在 `release` 模式下，遇到 `panic` 直接终止：\n\n```toml\n[profile.release]\npanic = 'abort'\n```\n```shell\nRUST_BACKTRACE=1 cargo run --release\n```\n\n## 用 `Result` 处理可恢复的错误\n\n大部分错误并没有严重到需要程序完全停止执行，例如，如果因为打开一个并不存在的文件而失败，此时我们可能想创建这个文件，而不是终止进程\n\n- `Ok(T)`：泛型参数 `T` 代表成功时存入的正确值的类型\n- `Err(E)`：`E` 代表错误时存入的错误值，存放方式是\n\n```rust\nenum Result<T, E> {\n    Ok(T),\n    Err(E),\n}\n```\n\n### 返回 `Result`\n\n#### 例1\n\n```rust\nfn div(x: f64, y: f64) -> Result<f64, String> {\n    if y == 0.0 {\n        // 此操作将会失败，那么（与其让程序崩溃）不如把失败的原因包装在 Err 中并返回\n        Err((\"y is zero\").to_string())\n    } else {\n        // 此操作是有效的，返回包装在 Ok 中的结果\n        Ok(x / y)\n    }\n}\n```\n\n#### 例2\n\n```rust\n#[derive(Debug)]\npub enum MathError {\n    DivisionByZero,\n    NegativeSquareRoot,\n}\nfn div(x: f64, y: f64) -> Result<f64, MathError> {\n    if y == 0.0 {\n        Err(MathError::DivisionByZero)\n    } else {\n        Ok(x / y)\n    }\n}\nfn sqrt(x: f64) -> Result<f64, MathError> {\n    if x < 0.0 {\n        Err(MathError::NegativeSquareRoot)\n    } else {\n        Ok(x.sqrt())\n    }\n}\n```\n\n### 处理 `Result` \n\n```rust\nuse std::fs::File;\nfn main() {\n    let f = File::open(\"hello.txt\");\n    let f = match f {\n        Ok(file) => file,\n        Err(error) => {\n            panic!(\"Problem opening the file: {:?}\", error)\n        },\n    };\n}\n```\n\n#### 对返回的错误进行处理\n\n对不同的错误原因采取不同的行为：\n\n- 如果 `File::open `因为文件不存在而失败，我们希望创建这个文件并返回新文件的句柄\n- 如果 `File::open` 因为任何其他原因失败，例如没有打开文件的权限，我们仍然 `panic!`\n\n```rust\nuse std::fs::File;\nuse std::io::ErrorKind;\nfn main() {\n    let greeting_file_result = File::open(\"hello.txt\");\n    // `File::open` 返回的 `Err` 成员中的值类型 `io::Error` 是一个标准库中提供的结构体\n    // 该结构体有一个返回 `io::ErrorKind` 值的 `kind` 方法可供调用\n    // `io::ErrorKind` 是一个标准库提供的枚举，其成员对应 `io` 操作可能导致的不同错误类型\n    let greeting_file = match greeting_file_result {\n        Ok(file) => file,\n        Err(error) => match error.kind() {\n            ErrorKind::NotFound => match File::create(\"hello.txt\") {\n                Ok(fc) => fc,\n                Err(e) => panic!(\"Problem creating the file: {e:?}\"),\n            },\n            other_error => {\n                panic!(\"Problem opening the file: {other_error:?}\");\n            }\n        },\n    };\n}\n```\n\n### `Result<T, E>` 的辅助方法\n\n`match` 能够胜任，不过可能有点冗长且不总能很好的表明其意图`Result<T, E>` 类型定义了很多辅助方法来处理各种情况\n\n> Method overview: https://doc.rust-lang.org/std/result/index.html\n\n#### unwrap\n\n- 如果 `Result` 值是成员 `Ok`，`unwrap` 会返回 `Ok` 中的值\n- 如果 `Result` 是成员 `Err`，`unwrap` 会调用 `panic!`\n\n```rust\nuse std::fs::File;\nfn main() {\n    let f = File::open(\"hello.txt\").unwrap();\n}\n```\n\n#### expect\n\n`expect` 跟 `unwrap` 很像，也是遇到错误直接 `panic`, 但会有自定义的错误提示信息，相当于重载了错误打印的函数：\n\n```rust\nuse std::fs::File;\nfn main() {\n    let f = File::open(\"hello.txt\").expect(\"Failed to open hello.txt\");\n}\n```\n\n#### map\n\n`Result<T, E>` -> `Result<U, E>`\n\n```rust\nlet line = \"1\\n2\\n3\\n4\\n\";\nfor num in line.lines() {\n    match num.parse::<i32>().map(|i| i * 2) {\n        Ok(n) => println!(\"{n}\"),\n        Err(..) => {}\n    }\n}\n```\n\n#### map_err\n\n`Result<T, E>` ->`Result<T, F>`\n\n```rust\nfn x() -> Result<(), String> {\n    let f = File::open(\"hello.txt\").map_err(|e: std::io::Error| format!(\"{e}\") );\n    match f{\n        Err(e)=>Err(e),\n        Ok(_)=>{\n            Ok(())\n        }\n    }\n}\n```\n\n### 传播错误\n\n可以使用 `?` 运算符来简写\n\n对于 Result\n\n- 如果结果是 `Ok(T)`，则把 `T` 赋值给 `f`\n- 如果结果是 `Err(E)`，则返回该错误\n\n对于 Option\n\n- 如果值是 `Some`，`Some` 中的值作为表达式的返回值同时函数继续\n- 如果值是 `None`，此时 `None` 会从函数中提前返回\n\n```rust\nuse std::fs::File;\nuse std::io::Read;\nfn read_username_from_file() -> Result<String, std::io::Error> {\n    // // 打开文件，f是`Result<文件句柄,io::Error>`\n    // let f = File::open(\"hello.txt\");\n    // let mut f = match f {\n    //     // 打开文件成功，将file句柄赋值给f\n    //     Ok(file) => file,\n    //     // 打开文件失败，将错误返回(向上传播)\n    //     Err(e) => return Err(e),\n    // };\n    let mut f = File::open(\"hello.txt\")?;\n\n    // 创建动态字符串s\n    let mut s = String::new();\n\n    // // 从f文件句柄读取数据并写入s中\n    // match f.read_to_string(&mut s) {\n    //     // 读取成功，返回Ok封装的字符串\n    //     Ok(_) => Ok(s),\n    //     // 将错误向上传播\n    //     Err(e) => Err(e),\n    // }\n    f.read_to_string(&mut s)?;\n    Ok(s)\n}\n```\n\n### 链式方法调用\n\n```rust\nfn read_username_from_file() -> Result<String, std::io::Error> {\n    let mut s = String::new();\n    File::open(\"hello.txt\")?.read_to_string(&mut s)?;\n    Ok(s)\n}\n```\n\n### 常见错误\n\n```rust\nfn first(arr: &[i32]) -> Option<&i32> {\n   arr.get(0)?\n   // 正确\n   // let a = arr.get(0)?;\n   // return a;\n}\n```\n\n这段代码无法通过编译：`?` 操作符需要一个变量来承载值，这个函数只会返回 `Some(&i32)` 或者 `None`。而事实上，只有错误值能直接返回，正确的值不行，因为如果数组存在 0 号元素，函数第二行使用 `?` 后的返回类型是 `&i32` 而不是 `Some(&i32)`\n\n## Option 与 Result 的互相转换\n\n### `Option` -> `Result`: `ok_or()`\n\n-  `Some(v)` to `Ok(v)`\n-  `None` to `Err(err)` \n\n```rust\nfn first(arr: &[i32]) -> Result<&i32, &str> {\n    arr.get(0).ok_or(\"out of index\")\n}\n```\n\n### `Result` -> `Opiton`: `err()`\n\n- `Err(e)` to `Some(e)` \n- `Ok(v)` to `None`\n\n```rust\nlet f = File::open(\"hello.txt\").err();\nif f.is_some() {\n    println!(\"no file\");\n}\n```\n\n### `Result` -> `Opiton`: `ok()`\n\n- `Ok(e)` to `Some(e)` \n- `Err(v)` to `None`\n\n```rust\nlet f = File::open(\"hello.txt\").ok();\nif f.is_none(){\n    println!(\"no file\");\n}\n```\n\n## 课后习题\n\n```rust\n// 修复 call 函数的错误\n// 当 b 为 None 时，按默认值 1\nfn call(a: i32, b: i32) -> Result<f64, String> {\n    let r = divide(a, b); \n    let s = sqrt(r);\n    \n    Ok(s);\n}\n\nfn divide(a: i32, b: i32) -> Option<f64> {\n    if b != 0 {\n        Some(a as f64 / b as f64)\n    } else {\n        None\n    }\n}\n\npub enum MathError {\n    DivisionByZero,\n    NegativeSquareRoot,\n}\n\nfn sqrt(x: f64) -> Result<f64, MathError> {\n    if x < 0.0 {\n        Err(MathError::NegativeSquareRoot)\n    } else {\n        Ok(x.sqrt())\n    }\n}\n```\n\n#### 答案\n\n```rust\nfn call(a: i32, b: Option<i32>) -> Result<f64, String> {\n    let r = divide(a, b.unwrap_or(1)).ok_or(\"Division by zero\".to_string())?;\n    let s = sqrt(r).map_err(|e: MathError| -> String {\n        match e {\n            MathError::DivisionByZero => {\n                return \"DivisionByZero\".to_string();\n            }\n            MathError::NegativeSquareRoot => {\n                return \"NegativeSquareRoot\".to_string();\n            }\n        }\n    })?;\n    return Ok(s);\n}\n```\n","slug":"72-IB-Rust-返回值与错误处理","published":1,"updated":"2025-06-03T09:02:52.882Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmbgajp0w0000ttprdwkl7c2n","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/14_return_error\" >Codes in lesson14<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"Option-返回值\"><a href=\"#Option-返回值\" class=\"headerlink\" title=\"Option 返回值\"></a>Option 返回值</h2><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">p1</span> = s.<span class=\"title function_ invoke__\">pop</span>();</span><br><span class=\"line\">dbg!(p1); <span class=\"comment\">// Some(&#x27;A&#x27;)</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">p2</span> = s.<span class=\"title function_ invoke__\">pop</span>();</span><br><span class=\"line\">dbg!(p2); <span class=\"comment\">// None</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"解构-Option\"><a href=\"#解构-Option\" class=\"headerlink\" title=\"解构 Option\"></a>解构 Option</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Option</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Some</span>(T),</span><br><span class=\"line\">    <span class=\"literal\">None</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"匹配-Option\"><a href=\"#匹配-Option\" class=\"headerlink\" title=\"匹配 Option\"></a>匹配 <code>Option</code></h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">plus_one</span>(x: <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt;) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">match</span> x &#123;</span><br><span class=\"line\">        <span class=\"literal\">None</span> =&gt; <span class=\"literal\">None</span>,</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Some</span>(i) =&gt; <span class=\"title function_ invoke__\">Some</span>(i + <span class=\"number\">1</span>),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">five</span> = <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">5</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">six</span> = <span class=\"title function_ invoke__\">plus_one</span>(five); <span class=\"comment\">// Some(6)</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">none</span> = <span class=\"title function_ invoke__\">plus_one</span>(<span class=\"literal\">None</span>); <span class=\"comment\">// None</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"Option-的辅助函数\"><a href=\"#Option-的辅助函数\" class=\"headerlink\" title=\"Option&lt;T&gt; 的辅助函数\"></a><code>Option&lt;T&gt;</code> 的辅助函数</h3><blockquote>\n<p> Method overview <a class=\"link\"   href=\"https://doc.rust-lang.org/std/option/\" >https://doc.rust-lang.org/std/option/<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</blockquote>\n<h4 id=\"使用-unwrap\"><a href=\"#使用-unwrap\" class=\"headerlink\" title=\"使用 unwrap\"></a>使用 unwrap</h4><p>如果确定 Option 存在值，可以使用 <code>unwrap</code> 方法来获取该值；如果 Option 不存在值，则会触发 panic</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">p1</span> = s.<span class=\"title function_ invoke__\">pop</span>().<span class=\"title function_ invoke__\">unwrap</span>(); <span class=\"comment\">// &quot;A&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// let p2 = s.pop().unwrap(); // panic: called `Option::unwrap()` on a `None` value</span></span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"使用-is-some-和-is-none\"><a href=\"#使用-is-some-和-is-none\" class=\"headerlink\" title=\"使用 is_some 和 is_none\"></a>使用 is_some 和 is_none</h4><p>可以使用 <code>is_some</code> 和 <code>is_none</code> 方法来判断 Option 中是否存在值。</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">v</span> = [<span class=\"number\">10</span>, <span class=\"number\">40</span>, <span class=\"number\">30</span>];</span><br><span class=\"line\"><span class=\"keyword\">if</span> v.<span class=\"title function_ invoke__\">get</span>(<span class=\"number\">1</span>).<span class=\"title function_ invoke__\">is_some</span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, v[<span class=\"number\">1</span>]); <span class=\"comment\">// 40</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"使用-unwrap-or-提供默认值\"><a href=\"#使用-unwrap-or-提供默认值\" class=\"headerlink\" title=\"使用 unwrap_or 提供默认值\"></a>使用 unwrap_or 提供默认值</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">div</span>(a: <span class=\"type\">i32</span>, b: <span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Option</span>&lt;<span class=\"type\">f64</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> b != <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Some</span>(a <span class=\"keyword\">as</span> <span class=\"type\">f64</span> / b <span class=\"keyword\">as</span> <span class=\"type\">f64</span>)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"literal\">None</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">a</span> = <span class=\"number\">10</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">b</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">result</span> = <span class=\"title function_ invoke__\">div</span>(a, b).<span class=\"title function_ invoke__\">unwrap_or</span>(<span class=\"number\">0.0</span>); <span class=\"comment\">// 0.0</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"错误处理\"><a href=\"#错误处理\" class=\"headerlink\" title=\"错误处理\"></a>错误处理</h2><p>Rust 中的错误主要分为两类：</p>\n<ul>\n<li><p><strong>可恢复错误</strong>，通常是从系统全局角度看可以接受的错误，例如处理用户的访问、操作等错误，这些错误只会影响某用户自身的操作进程，而不会影响系统的全局稳定性</p>\n</li>\n<li><p><strong>不可恢复错误</strong>，通常是全局性或者系统性的错误，例如数组越界访问，系统启动时发生了影响启动流程的错误等，这些错误对系统来说往往是致命的</p>\n</li>\n<li><p><code>Result&lt;T, E&gt;</code> 用于可恢复错误</p>\n</li>\n<li><p><code>panic!</code> 用于不可恢复错误</p>\n</li>\n</ul>\n<h2 id=\"用-panic-处理不可恢复的错误\"><a href=\"#用-panic-处理不可恢复的错误\" class=\"headerlink\" title=\"用 panic! 处理不可恢复的错误\"></a>用 <code>panic!</code> 处理不可恢复的错误</h2><h3 id=\"触发\"><a href=\"#触发\" class=\"headerlink\" title=\"触发\"></a>触发</h3><h4 id=\"被动触发\"><a href=\"#被动触发\" class=\"headerlink\" title=\"被动触发\"></a>被动触发</h4><p>C 语言中，读取数据结构未定义的值，会得到对应数据结构中这个元素内存位置的值（这些内存可能并不属于该数据结构），这被称为<strong>缓冲区溢出</strong>，并会导致安全漏洞，比如攻击者可以通过操作索引，读取储存在数据结构之后不被允许的数据</p>\n<p>为防范此类漏洞，如果读取索引不存在的元素，Rust 会停止执行，发生 panic</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">v</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\">v[<span class=\"number\">99</span>];</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"主动调用\"><a href=\"#主动调用\" class=\"headerlink\" title=\"主动调用\"></a>主动调用</h4><p>Rust 提供了 <code>panic!</code> 宏，当调用执行该宏时，程序会打印出错误信息，展开报错点之前的函数调用堆栈，并退出程序</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">panic!</span>(<span class=\"string\">&quot;crash and burn&quot;</span>);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"backtrace-栈展开\"><a href=\"#backtrace-栈展开\" class=\"headerlink\" title=\"backtrace 栈展开\"></a>backtrace 栈展开</h3><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RUST_BACKTRACE=1 cargo run</span><br></pre></td></tr></table></figure></div>\n\n<p>在栈展开（或栈回溯）中，函数调用按照逆序排列：最近调用的排在最上方</p>\n<p>要获取栈回溯信息，还需要开启 <code>debug</code> 标志。当不使用 <code>--release</code> 参数运行 <code>cargo build</code> 或 <code>cargo run</code> 时， <code>debug</code> 标识会默认启用</p>\n<h3 id=\"panic-的两种终止方式\"><a href=\"#panic-的两种终止方式\" class=\"headerlink\" title=\"panic 的两种终止方式\"></a>panic 的两种终止方式</h3><ul>\n<li><strong>栈展开（<em>unwinding</em>）（默认）</strong>: Rust 会回溯栈上数据和函数调用，可以给出充分的报错和栈调用信息，便于问题复盘，不过也意味着更多的善后工作</li>\n<li><strong>直接终止（<em>abort</em>）</strong>: 不清理数据就直接退出程序，善后工作交与操作系统负责</li>\n</ul>\n<p>大多数情况，使用默认选择最好；当关心编译出的二进制可执行文件大小时，可以使用直接终止的方式，例如下面的 <code>Cargo.toml</code> 配置文件，可以实现在 <code>release</code> 模式下，遇到 <code>panic</code> 直接终止：</p>\n<div class=\"code-container\" data-rel=\"Toml\"><figure class=\"iseeu highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[profile.release]</span></span><br><span class=\"line\"><span class=\"attr\">panic</span> = <span class=\"string\">&#x27;abort&#x27;</span></span><br></pre></td></tr></table></figure></div>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RUST_BACKTRACE=1 cargo run --release</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"用-Result-处理可恢复的错误\"><a href=\"#用-Result-处理可恢复的错误\" class=\"headerlink\" title=\"用 Result 处理可恢复的错误\"></a>用 <code>Result</code> 处理可恢复的错误</h2><p>大部分错误并没有严重到需要程序完全停止执行，例如，如果因为打开一个并不存在的文件而失败，此时我们可能想创建这个文件，而不是终止进程</p>\n<ul>\n<li><code>Ok(T)</code>：泛型参数 <code>T</code> 代表成功时存入的正确值的类型</li>\n<li><code>Err(E)</code>：<code>E</code> 代表错误时存入的错误值，存放方式是</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Result</span>&lt;T, E&gt; &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Ok</span>(T),</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Err</span>(E),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"返回-Result\"><a href=\"#返回-Result\" class=\"headerlink\" title=\"返回 Result\"></a>返回 <code>Result</code></h3><h4 id=\"例1\"><a href=\"#例1\" class=\"headerlink\" title=\"例1\"></a>例1</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">div</span>(x: <span class=\"type\">f64</span>, y: <span class=\"type\">f64</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;<span class=\"type\">f64</span>, <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> y == <span class=\"number\">0.0</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 此操作将会失败，那么（与其让程序崩溃）不如把失败的原因包装在 Err 中并返回</span></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>((<span class=\"string\">&quot;y is zero&quot;</span>).<span class=\"title function_ invoke__\">to_string</span>())</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 此操作是有效的，返回包装在 Ok 中的结果</span></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(x / y)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"例2\"><a href=\"#例2\" class=\"headerlink\" title=\"例2\"></a>例2</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#[derive(Debug)]</span></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">enum</span> <span class=\"title class_\">MathError</span> &#123;</span><br><span class=\"line\">    DivisionByZero,</span><br><span class=\"line\">    NegativeSquareRoot,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">div</span>(x: <span class=\"type\">f64</span>, y: <span class=\"type\">f64</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;<span class=\"type\">f64</span>, MathError&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> y == <span class=\"number\">0.0</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(MathError::DivisionByZero)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(x / y)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">sqrt</span>(x: <span class=\"type\">f64</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;<span class=\"type\">f64</span>, MathError&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> x &lt; <span class=\"number\">0.0</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(MathError::NegativeSquareRoot)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(x.<span class=\"title function_ invoke__\">sqrt</span>())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"处理-Result\"><a href=\"#处理-Result\" class=\"headerlink\" title=\"处理 Result\"></a>处理 <code>Result</code></h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::fs::File;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">f</span> = File::<span class=\"title function_ invoke__\">open</span>(<span class=\"string\">&quot;hello.txt&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">f</span> = <span class=\"keyword\">match</span> f &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(file) =&gt; file,</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(error) =&gt; &#123;</span><br><span class=\"line\">            <span class=\"built_in\">panic!</span>(<span class=\"string\">&quot;Problem opening the file: &#123;:?&#125;&quot;</span>, error)</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"对返回的错误进行处理\"><a href=\"#对返回的错误进行处理\" class=\"headerlink\" title=\"对返回的错误进行处理\"></a>对返回的错误进行处理</h4><p>对不同的错误原因采取不同的行为：</p>\n<ul>\n<li>如果 <code>File::open </code>因为文件不存在而失败，我们希望创建这个文件并返回新文件的句柄</li>\n<li>如果 <code>File::open</code> 因为任何其他原因失败，例如没有打开文件的权限，我们仍然 <code>panic!</code></li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::fs::File;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::io::ErrorKind;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">greeting_file_result</span> = File::<span class=\"title function_ invoke__\">open</span>(<span class=\"string\">&quot;hello.txt&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">// `File::open` 返回的 `Err` 成员中的值类型 `io::Error` 是一个标准库中提供的结构体</span></span><br><span class=\"line\">    <span class=\"comment\">// 该结构体有一个返回 `io::ErrorKind` 值的 `kind` 方法可供调用</span></span><br><span class=\"line\">    <span class=\"comment\">// `io::ErrorKind` 是一个标准库提供的枚举，其成员对应 `io` 操作可能导致的不同错误类型</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">greeting_file</span> = <span class=\"keyword\">match</span> greeting_file_result &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(file) =&gt; file,</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(error) =&gt; <span class=\"keyword\">match</span> error.<span class=\"title function_ invoke__\">kind</span>() &#123;</span><br><span class=\"line\">            ErrorKind::NotFound =&gt; <span class=\"keyword\">match</span> File::<span class=\"title function_ invoke__\">create</span>(<span class=\"string\">&quot;hello.txt&quot;</span>) &#123;</span><br><span class=\"line\">                <span class=\"title function_ invoke__\">Ok</span>(fc) =&gt; fc,</span><br><span class=\"line\">                <span class=\"title function_ invoke__\">Err</span>(e) =&gt; <span class=\"built_in\">panic!</span>(<span class=\"string\">&quot;Problem creating the file: &#123;e:?&#125;&quot;</span>),</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            other_error =&gt; &#123;</span><br><span class=\"line\">                <span class=\"built_in\">panic!</span>(<span class=\"string\">&quot;Problem opening the file: &#123;other_error:?&#125;&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"Result-的辅助方法\"><a href=\"#Result-的辅助方法\" class=\"headerlink\" title=\"Result&lt;T, E&gt; 的辅助方法\"></a><code>Result&lt;T, E&gt;</code> 的辅助方法</h3><p><code>match</code> 能够胜任，不过可能有点冗长且不总能很好的表明其意图<code>Result&lt;T, E&gt;</code> 类型定义了很多辅助方法来处理各种情况</p>\n<blockquote>\n<p>Method overview: <a class=\"link\"   href=\"https://doc.rust-lang.org/std/result/index.html\" >https://doc.rust-lang.org/std/result/index.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</blockquote>\n<h4 id=\"unwrap\"><a href=\"#unwrap\" class=\"headerlink\" title=\"unwrap\"></a>unwrap</h4><ul>\n<li>如果 <code>Result</code> 值是成员 <code>Ok</code>，<code>unwrap</code> 会返回 <code>Ok</code> 中的值</li>\n<li>如果 <code>Result</code> 是成员 <code>Err</code>，<code>unwrap</code> 会调用 <code>panic!</code></li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::fs::File;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">f</span> = File::<span class=\"title function_ invoke__\">open</span>(<span class=\"string\">&quot;hello.txt&quot;</span>).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"expect\"><a href=\"#expect\" class=\"headerlink\" title=\"expect\"></a>expect</h4><p><code>expect</code> 跟 <code>unwrap</code> 很像，也是遇到错误直接 <code>panic</code>, 但会有自定义的错误提示信息，相当于重载了错误打印的函数：</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::fs::File;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">f</span> = File::<span class=\"title function_ invoke__\">open</span>(<span class=\"string\">&quot;hello.txt&quot;</span>).<span class=\"title function_ invoke__\">expect</span>(<span class=\"string\">&quot;Failed to open hello.txt&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"map\"><a href=\"#map\" class=\"headerlink\" title=\"map\"></a>map</h4><p><code>Result&lt;T, E&gt;</code> -&gt; <code>Result&lt;U, E&gt;</code></p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">line</span> = <span class=\"string\">&quot;1\\n2\\n3\\n4\\n&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> <span class=\"variable\">num</span> <span class=\"keyword\">in</span> line.<span class=\"title function_ invoke__\">lines</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">match</span> num.parse::&lt;<span class=\"type\">i32</span>&gt;().<span class=\"title function_ invoke__\">map</span>(|i| i * <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(n) =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;n&#125;&quot;</span>),</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(..) =&gt; &#123;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"map-err\"><a href=\"#map-err\" class=\"headerlink\" title=\"map_err\"></a>map_err</h4><p><code>Result&lt;T, E&gt;</code> -&gt;<code>Result&lt;T, F&gt;</code></p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">x</span>() <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;(), <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">f</span> = File::<span class=\"title function_ invoke__\">open</span>(<span class=\"string\">&quot;hello.txt&quot;</span>).<span class=\"title function_ invoke__\">map_err</span>(|e: std::io::Error| <span class=\"built_in\">format!</span>(<span class=\"string\">&quot;&#123;e&#125;&quot;</span>) );</span><br><span class=\"line\">    <span class=\"keyword\">match</span> f&#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(e)=&gt;<span class=\"title function_ invoke__\">Err</span>(e),</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(_)=&gt;&#123;</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">Ok</span>(())</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"传播错误\"><a href=\"#传播错误\" class=\"headerlink\" title=\"传播错误\"></a>传播错误</h3><p>可以使用 <code>?</code> 运算符来简写</p>\n<p>对于 Result</p>\n<ul>\n<li>如果结果是 <code>Ok(T)</code>，则把 <code>T</code> 赋值给 <code>f</code></li>\n<li>如果结果是 <code>Err(E)</code>，则返回该错误</li>\n</ul>\n<p>对于 Option</p>\n<ul>\n<li>如果值是 <code>Some</code>，<code>Some</code> 中的值作为表达式的返回值同时函数继续</li>\n<li>如果值是 <code>None</code>，此时 <code>None</code> 会从函数中提前返回</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::fs::File;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::io::Read;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">read_username_from_file</span>() <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;<span class=\"type\">String</span>, std::io::Error&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">// // 打开文件，f是`Result&lt;文件句柄,io::Error&gt;`</span></span><br><span class=\"line\">    <span class=\"comment\">// let f = File::open(&quot;hello.txt&quot;);</span></span><br><span class=\"line\">    <span class=\"comment\">// let mut f = match f &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     // 打开文件成功，将file句柄赋值给f</span></span><br><span class=\"line\">    <span class=\"comment\">//     Ok(file) =&gt; file,</span></span><br><span class=\"line\">    <span class=\"comment\">//     // 打开文件失败，将错误返回(向上传播)</span></span><br><span class=\"line\">    <span class=\"comment\">//     Err(e) =&gt; return Err(e),</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;;</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">f</span> = File::<span class=\"title function_ invoke__\">open</span>(<span class=\"string\">&quot;hello.txt&quot;</span>)?;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建动态字符串s</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// // 从f文件句柄读取数据并写入s中</span></span><br><span class=\"line\">    <span class=\"comment\">// match f.read_to_string(&amp;mut s) &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     // 读取成功，返回Ok封装的字符串</span></span><br><span class=\"line\">    <span class=\"comment\">//     Ok(_) =&gt; Ok(s),</span></span><br><span class=\"line\">    <span class=\"comment\">//     // 将错误向上传播</span></span><br><span class=\"line\">    <span class=\"comment\">//     Err(e) =&gt; Err(e),</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">    f.<span class=\"title function_ invoke__\">read_to_string</span>(&amp;<span class=\"keyword\">mut</span> s)?;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Ok</span>(s)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"链式方法调用\"><a href=\"#链式方法调用\" class=\"headerlink\" title=\"链式方法调用\"></a>链式方法调用</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">read_username_from_file</span>() <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;<span class=\"type\">String</span>, std::io::Error&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">    File::<span class=\"title function_ invoke__\">open</span>(<span class=\"string\">&quot;hello.txt&quot;</span>)?.<span class=\"title function_ invoke__\">read_to_string</span>(&amp;<span class=\"keyword\">mut</span> s)?;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Ok</span>(s)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"常见错误\"><a href=\"#常见错误\" class=\"headerlink\" title=\"常见错误\"></a>常见错误</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">first</span>(arr: &amp;[<span class=\"type\">i32</span>]) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Option</span>&lt;&amp;<span class=\"type\">i32</span>&gt; &#123;</span><br><span class=\"line\">   arr.<span class=\"title function_ invoke__\">get</span>(<span class=\"number\">0</span>)?</span><br><span class=\"line\">   <span class=\"comment\">// 正确</span></span><br><span class=\"line\">   <span class=\"comment\">// let a = arr.get(0)?;</span></span><br><span class=\"line\">   <span class=\"comment\">// return a;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>这段代码无法通过编译：<code>?</code> 操作符需要一个变量来承载值，这个函数只会返回 <code>Some(&amp;i32)</code> 或者 <code>None</code>。而事实上，只有错误值能直接返回，正确的值不行，因为如果数组存在 0 号元素，函数第二行使用 <code>?</code> 后的返回类型是 <code>&amp;i32</code> 而不是 <code>Some(&amp;i32)</code></p>\n<h2 id=\"Option-与-Result-的互相转换\"><a href=\"#Option-与-Result-的互相转换\" class=\"headerlink\" title=\"Option 与 Result 的互相转换\"></a>Option 与 Result 的互相转换</h2><h3 id=\"Option-Result-ok-or\"><a href=\"#Option-Result-ok-or\" class=\"headerlink\" title=\"Option -&gt; Result: ok_or()\"></a><code>Option</code> -&gt; <code>Result</code>: <code>ok_or()</code></h3><ul>\n<li><code>Some(v)</code> to <code>Ok(v)</code></li>\n<li><code>None</code> to <code>Err(err)</code></li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">first</span>(arr: &amp;[<span class=\"type\">i32</span>]) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;&amp;<span class=\"type\">i32</span>, &amp;<span class=\"type\">str</span>&gt; &#123;</span><br><span class=\"line\">    arr.<span class=\"title function_ invoke__\">get</span>(<span class=\"number\">0</span>).<span class=\"title function_ invoke__\">ok_or</span>(<span class=\"string\">&quot;out of index&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"Result-Opiton-err\"><a href=\"#Result-Opiton-err\" class=\"headerlink\" title=\"Result -&gt; Opiton: err()\"></a><code>Result</code> -&gt; <code>Opiton</code>: <code>err()</code></h3><ul>\n<li><code>Err(e)</code> to <code>Some(e)</code> </li>\n<li><code>Ok(v)</code> to <code>None</code></li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">f</span> = File::<span class=\"title function_ invoke__\">open</span>(<span class=\"string\">&quot;hello.txt&quot;</span>).<span class=\"title function_ invoke__\">err</span>();</span><br><span class=\"line\"><span class=\"keyword\">if</span> f.<span class=\"title function_ invoke__\">is_some</span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;no file&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"Result-Opiton-ok\"><a href=\"#Result-Opiton-ok\" class=\"headerlink\" title=\"Result -&gt; Opiton: ok()\"></a><code>Result</code> -&gt; <code>Opiton</code>: <code>ok()</code></h3><ul>\n<li><code>Ok(e)</code> to <code>Some(e)</code> </li>\n<li><code>Err(v)</code> to <code>None</code></li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">f</span> = File::<span class=\"title function_ invoke__\">open</span>(<span class=\"string\">&quot;hello.txt&quot;</span>).<span class=\"title function_ invoke__\">ok</span>();</span><br><span class=\"line\"><span class=\"keyword\">if</span> f.<span class=\"title function_ invoke__\">is_none</span>()&#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;no file&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"课后习题\"><a href=\"#课后习题\" class=\"headerlink\" title=\"课后习题\"></a>课后习题</h2><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 修复 call 函数的错误</span></span><br><span class=\"line\"><span class=\"comment\">// 当 b 为 None 时，按默认值 1</span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">call</span>(a: <span class=\"type\">i32</span>, b: <span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;<span class=\"type\">f64</span>, <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">r</span> = <span class=\"title function_ invoke__\">divide</span>(a, b); </span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"title function_ invoke__\">sqrt</span>(r);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Ok</span>(s);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">divide</span>(a: <span class=\"type\">i32</span>, b: <span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Option</span>&lt;<span class=\"type\">f64</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> b != <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Some</span>(a <span class=\"keyword\">as</span> <span class=\"type\">f64</span> / b <span class=\"keyword\">as</span> <span class=\"type\">f64</span>)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"literal\">None</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">enum</span> <span class=\"title class_\">MathError</span> &#123;</span><br><span class=\"line\">    DivisionByZero,</span><br><span class=\"line\">    NegativeSquareRoot,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">sqrt</span>(x: <span class=\"type\">f64</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;<span class=\"type\">f64</span>, MathError&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> x &lt; <span class=\"number\">0.0</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(MathError::NegativeSquareRoot)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(x.<span class=\"title function_ invoke__\">sqrt</span>())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"答案\"><a href=\"#答案\" class=\"headerlink\" title=\"答案\"></a>答案</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">call</span>(a: <span class=\"type\">i32</span>, b: <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt;) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;<span class=\"type\">f64</span>, <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">r</span> = <span class=\"title function_ invoke__\">divide</span>(a, b.<span class=\"title function_ invoke__\">unwrap_or</span>(<span class=\"number\">1</span>)).<span class=\"title function_ invoke__\">ok_or</span>(<span class=\"string\">&quot;Division by zero&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>())?;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"title function_ invoke__\">sqrt</span>(r).<span class=\"title function_ invoke__\">map_err</span>(|e: MathError| <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">match</span> e &#123;</span><br><span class=\"line\">            MathError::DivisionByZero =&gt; &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"string\">&quot;DivisionByZero&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            MathError::NegativeSquareRoot =&gt; &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"string\">&quot;NegativeSquareRoot&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)?;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">Ok</span>(s);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/14_return_error\" >Codes in lesson14<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"Option-返回值\"><a href=\"#Option-返回值\" class=\"headerlink\" title=\"Option 返回值\"></a>Option 返回值</h2><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">p1</span> = s.<span class=\"title function_ invoke__\">pop</span>();</span><br><span class=\"line\">dbg!(p1); <span class=\"comment\">// Some(&#x27;A&#x27;)</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">p2</span> = s.<span class=\"title function_ invoke__\">pop</span>();</span><br><span class=\"line\">dbg!(p2); <span class=\"comment\">// None</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"解构-Option\"><a href=\"#解构-Option\" class=\"headerlink\" title=\"解构 Option\"></a>解构 Option</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Option</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Some</span>(T),</span><br><span class=\"line\">    <span class=\"literal\">None</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"匹配-Option\"><a href=\"#匹配-Option\" class=\"headerlink\" title=\"匹配 Option\"></a>匹配 <code>Option</code></h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">plus_one</span>(x: <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt;) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">match</span> x &#123;</span><br><span class=\"line\">        <span class=\"literal\">None</span> =&gt; <span class=\"literal\">None</span>,</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Some</span>(i) =&gt; <span class=\"title function_ invoke__\">Some</span>(i + <span class=\"number\">1</span>),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">five</span> = <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">5</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">six</span> = <span class=\"title function_ invoke__\">plus_one</span>(five); <span class=\"comment\">// Some(6)</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">none</span> = <span class=\"title function_ invoke__\">plus_one</span>(<span class=\"literal\">None</span>); <span class=\"comment\">// None</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Option-的辅助函数\"><a href=\"#Option-的辅助函数\" class=\"headerlink\" title=\"Option&lt;T&gt; 的辅助函数\"></a><code>Option&lt;T&gt;</code> 的辅助函数</h3><blockquote>\n<p> Method overview <a class=\"link\"   href=\"https://doc.rust-lang.org/std/option/\" >https://doc.rust-lang.org/std/option/<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</blockquote>\n<h4 id=\"使用-unwrap\"><a href=\"#使用-unwrap\" class=\"headerlink\" title=\"使用 unwrap\"></a>使用 unwrap</h4><p>如果确定 Option 存在值，可以使用 <code>unwrap</code> 方法来获取该值；如果 Option 不存在值，则会触发 panic</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">p1</span> = s.<span class=\"title function_ invoke__\">pop</span>().<span class=\"title function_ invoke__\">unwrap</span>(); <span class=\"comment\">// &quot;A&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// let p2 = s.pop().unwrap(); // panic: called `Option::unwrap()` on a `None` value</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"使用-is-some-和-is-none\"><a href=\"#使用-is-some-和-is-none\" class=\"headerlink\" title=\"使用 is_some 和 is_none\"></a>使用 is_some 和 is_none</h4><p>可以使用 <code>is_some</code> 和 <code>is_none</code> 方法来判断 Option 中是否存在值。</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">v</span> = [<span class=\"number\">10</span>, <span class=\"number\">40</span>, <span class=\"number\">30</span>];</span><br><span class=\"line\"><span class=\"keyword\">if</span> v.<span class=\"title function_ invoke__\">get</span>(<span class=\"number\">1</span>).<span class=\"title function_ invoke__\">is_some</span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, v[<span class=\"number\">1</span>]); <span class=\"comment\">// 40</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"使用-unwrap-or-提供默认值\"><a href=\"#使用-unwrap-or-提供默认值\" class=\"headerlink\" title=\"使用 unwrap_or 提供默认值\"></a>使用 unwrap_or 提供默认值</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">div</span>(a: <span class=\"type\">i32</span>, b: <span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Option</span>&lt;<span class=\"type\">f64</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> b != <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Some</span>(a <span class=\"keyword\">as</span> <span class=\"type\">f64</span> / b <span class=\"keyword\">as</span> <span class=\"type\">f64</span>)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"literal\">None</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">a</span> = <span class=\"number\">10</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">b</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">result</span> = <span class=\"title function_ invoke__\">div</span>(a, b).<span class=\"title function_ invoke__\">unwrap_or</span>(<span class=\"number\">0.0</span>); <span class=\"comment\">// 0.0</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"错误处理\"><a href=\"#错误处理\" class=\"headerlink\" title=\"错误处理\"></a>错误处理</h2><p>Rust 中的错误主要分为两类：</p>\n<ul>\n<li><p><strong>可恢复错误</strong>，通常是从系统全局角度看可以接受的错误，例如处理用户的访问、操作等错误，这些错误只会影响某用户自身的操作进程，而不会影响系统的全局稳定性</p>\n</li>\n<li><p><strong>不可恢复错误</strong>，通常是全局性或者系统性的错误，例如数组越界访问，系统启动时发生了影响启动流程的错误等，这些错误对系统来说往往是致命的</p>\n</li>\n<li><p><code>Result&lt;T, E&gt;</code> 用于可恢复错误</p>\n</li>\n<li><p><code>panic!</code> 用于不可恢复错误</p>\n</li>\n</ul>\n<h2 id=\"用-panic-处理不可恢复的错误\"><a href=\"#用-panic-处理不可恢复的错误\" class=\"headerlink\" title=\"用 panic! 处理不可恢复的错误\"></a>用 <code>panic!</code> 处理不可恢复的错误</h2><h3 id=\"触发\"><a href=\"#触发\" class=\"headerlink\" title=\"触发\"></a>触发</h3><h4 id=\"被动触发\"><a href=\"#被动触发\" class=\"headerlink\" title=\"被动触发\"></a>被动触发</h4><p>C 语言中，读取数据结构未定义的值，会得到对应数据结构中这个元素内存位置的值（这些内存可能并不属于该数据结构），这被称为<strong>缓冲区溢出</strong>，并会导致安全漏洞，比如攻击者可以通过操作索引，读取储存在数据结构之后不被允许的数据</p>\n<p>为防范此类漏洞，如果读取索引不存在的元素，Rust 会停止执行，发生 panic</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">v</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\">v[<span class=\"number\">99</span>];</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"主动调用\"><a href=\"#主动调用\" class=\"headerlink\" title=\"主动调用\"></a>主动调用</h4><p>Rust 提供了 <code>panic!</code> 宏，当调用执行该宏时，程序会打印出错误信息，展开报错点之前的函数调用堆栈，并退出程序</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">panic!</span>(<span class=\"string\">&quot;crash and burn&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"backtrace-栈展开\"><a href=\"#backtrace-栈展开\" class=\"headerlink\" title=\"backtrace 栈展开\"></a>backtrace 栈展开</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RUST_BACKTRACE=1 cargo run</span><br></pre></td></tr></table></figure>\n\n<p>在栈展开（或栈回溯）中，函数调用按照逆序排列：最近调用的排在最上方</p>\n<p>要获取栈回溯信息，还需要开启 <code>debug</code> 标志。当不使用 <code>--release</code> 参数运行 <code>cargo build</code> 或 <code>cargo run</code> 时， <code>debug</code> 标识会默认启用</p>\n<h3 id=\"panic-的两种终止方式\"><a href=\"#panic-的两种终止方式\" class=\"headerlink\" title=\"panic 的两种终止方式\"></a>panic 的两种终止方式</h3><ul>\n<li><strong>栈展开（<em>unwinding</em>）（默认）</strong>: Rust 会回溯栈上数据和函数调用，可以给出充分的报错和栈调用信息，便于问题复盘，不过也意味着更多的善后工作</li>\n<li><strong>直接终止（<em>abort</em>）</strong>: 不清理数据就直接退出程序，善后工作交与操作系统负责</li>\n</ul>\n<p>大多数情况，使用默认选择最好；当关心编译出的二进制可执行文件大小时，可以使用直接终止的方式，例如下面的 <code>Cargo.toml</code> 配置文件，可以实现在 <code>release</code> 模式下，遇到 <code>panic</code> 直接终止：</p>\n<figure class=\"highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[profile.release]</span></span><br><span class=\"line\"><span class=\"attr\">panic</span> = <span class=\"string\">&#x27;abort&#x27;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RUST_BACKTRACE=1 cargo run --release</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"用-Result-处理可恢复的错误\"><a href=\"#用-Result-处理可恢复的错误\" class=\"headerlink\" title=\"用 Result 处理可恢复的错误\"></a>用 <code>Result</code> 处理可恢复的错误</h2><p>大部分错误并没有严重到需要程序完全停止执行，例如，如果因为打开一个并不存在的文件而失败，此时我们可能想创建这个文件，而不是终止进程</p>\n<ul>\n<li><code>Ok(T)</code>：泛型参数 <code>T</code> 代表成功时存入的正确值的类型</li>\n<li><code>Err(E)</code>：<code>E</code> 代表错误时存入的错误值，存放方式是</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Result</span>&lt;T, E&gt; &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Ok</span>(T),</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Err</span>(E),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"返回-Result\"><a href=\"#返回-Result\" class=\"headerlink\" title=\"返回 Result\"></a>返回 <code>Result</code></h3><h4 id=\"例1\"><a href=\"#例1\" class=\"headerlink\" title=\"例1\"></a>例1</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">div</span>(x: <span class=\"type\">f64</span>, y: <span class=\"type\">f64</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;<span class=\"type\">f64</span>, <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> y == <span class=\"number\">0.0</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 此操作将会失败，那么（与其让程序崩溃）不如把失败的原因包装在 Err 中并返回</span></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>((<span class=\"string\">&quot;y is zero&quot;</span>).<span class=\"title function_ invoke__\">to_string</span>())</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 此操作是有效的，返回包装在 Ok 中的结果</span></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(x / y)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"例2\"><a href=\"#例2\" class=\"headerlink\" title=\"例2\"></a>例2</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#[derive(Debug)]</span></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">enum</span> <span class=\"title class_\">MathError</span> &#123;</span><br><span class=\"line\">    DivisionByZero,</span><br><span class=\"line\">    NegativeSquareRoot,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">div</span>(x: <span class=\"type\">f64</span>, y: <span class=\"type\">f64</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;<span class=\"type\">f64</span>, MathError&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> y == <span class=\"number\">0.0</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(MathError::DivisionByZero)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(x / y)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">sqrt</span>(x: <span class=\"type\">f64</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;<span class=\"type\">f64</span>, MathError&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> x &lt; <span class=\"number\">0.0</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(MathError::NegativeSquareRoot)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(x.<span class=\"title function_ invoke__\">sqrt</span>())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"处理-Result\"><a href=\"#处理-Result\" class=\"headerlink\" title=\"处理 Result\"></a>处理 <code>Result</code></h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::fs::File;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">f</span> = File::<span class=\"title function_ invoke__\">open</span>(<span class=\"string\">&quot;hello.txt&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">f</span> = <span class=\"keyword\">match</span> f &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(file) =&gt; file,</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(error) =&gt; &#123;</span><br><span class=\"line\">            <span class=\"built_in\">panic!</span>(<span class=\"string\">&quot;Problem opening the file: &#123;:?&#125;&quot;</span>, error)</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"对返回的错误进行处理\"><a href=\"#对返回的错误进行处理\" class=\"headerlink\" title=\"对返回的错误进行处理\"></a>对返回的错误进行处理</h4><p>对不同的错误原因采取不同的行为：</p>\n<ul>\n<li>如果 <code>File::open </code>因为文件不存在而失败，我们希望创建这个文件并返回新文件的句柄</li>\n<li>如果 <code>File::open</code> 因为任何其他原因失败，例如没有打开文件的权限，我们仍然 <code>panic!</code></li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::fs::File;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::io::ErrorKind;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">greeting_file_result</span> = File::<span class=\"title function_ invoke__\">open</span>(<span class=\"string\">&quot;hello.txt&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">// `File::open` 返回的 `Err` 成员中的值类型 `io::Error` 是一个标准库中提供的结构体</span></span><br><span class=\"line\">    <span class=\"comment\">// 该结构体有一个返回 `io::ErrorKind` 值的 `kind` 方法可供调用</span></span><br><span class=\"line\">    <span class=\"comment\">// `io::ErrorKind` 是一个标准库提供的枚举，其成员对应 `io` 操作可能导致的不同错误类型</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">greeting_file</span> = <span class=\"keyword\">match</span> greeting_file_result &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(file) =&gt; file,</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(error) =&gt; <span class=\"keyword\">match</span> error.<span class=\"title function_ invoke__\">kind</span>() &#123;</span><br><span class=\"line\">            ErrorKind::NotFound =&gt; <span class=\"keyword\">match</span> File::<span class=\"title function_ invoke__\">create</span>(<span class=\"string\">&quot;hello.txt&quot;</span>) &#123;</span><br><span class=\"line\">                <span class=\"title function_ invoke__\">Ok</span>(fc) =&gt; fc,</span><br><span class=\"line\">                <span class=\"title function_ invoke__\">Err</span>(e) =&gt; <span class=\"built_in\">panic!</span>(<span class=\"string\">&quot;Problem creating the file: &#123;e:?&#125;&quot;</span>),</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            other_error =&gt; &#123;</span><br><span class=\"line\">                <span class=\"built_in\">panic!</span>(<span class=\"string\">&quot;Problem opening the file: &#123;other_error:?&#125;&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Result-的辅助方法\"><a href=\"#Result-的辅助方法\" class=\"headerlink\" title=\"Result&lt;T, E&gt; 的辅助方法\"></a><code>Result&lt;T, E&gt;</code> 的辅助方法</h3><p><code>match</code> 能够胜任，不过可能有点冗长且不总能很好的表明其意图<code>Result&lt;T, E&gt;</code> 类型定义了很多辅助方法来处理各种情况</p>\n<blockquote>\n<p>Method overview: <a class=\"link\"   href=\"https://doc.rust-lang.org/std/result/index.html\" >https://doc.rust-lang.org/std/result/index.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</blockquote>\n<h4 id=\"unwrap\"><a href=\"#unwrap\" class=\"headerlink\" title=\"unwrap\"></a>unwrap</h4><ul>\n<li>如果 <code>Result</code> 值是成员 <code>Ok</code>，<code>unwrap</code> 会返回 <code>Ok</code> 中的值</li>\n<li>如果 <code>Result</code> 是成员 <code>Err</code>，<code>unwrap</code> 会调用 <code>panic!</code></li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::fs::File;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">f</span> = File::<span class=\"title function_ invoke__\">open</span>(<span class=\"string\">&quot;hello.txt&quot;</span>).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"expect\"><a href=\"#expect\" class=\"headerlink\" title=\"expect\"></a>expect</h4><p><code>expect</code> 跟 <code>unwrap</code> 很像，也是遇到错误直接 <code>panic</code>, 但会有自定义的错误提示信息，相当于重载了错误打印的函数：</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::fs::File;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">f</span> = File::<span class=\"title function_ invoke__\">open</span>(<span class=\"string\">&quot;hello.txt&quot;</span>).<span class=\"title function_ invoke__\">expect</span>(<span class=\"string\">&quot;Failed to open hello.txt&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"map\"><a href=\"#map\" class=\"headerlink\" title=\"map\"></a>map</h4><p><code>Result&lt;T, E&gt;</code> -&gt; <code>Result&lt;U, E&gt;</code></p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">line</span> = <span class=\"string\">&quot;1\\n2\\n3\\n4\\n&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> <span class=\"variable\">num</span> <span class=\"keyword\">in</span> line.<span class=\"title function_ invoke__\">lines</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">match</span> num.parse::&lt;<span class=\"type\">i32</span>&gt;().<span class=\"title function_ invoke__\">map</span>(|i| i * <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(n) =&gt; <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;n&#125;&quot;</span>),</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(..) =&gt; &#123;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"map-err\"><a href=\"#map-err\" class=\"headerlink\" title=\"map_err\"></a>map_err</h4><p><code>Result&lt;T, E&gt;</code> -&gt;<code>Result&lt;T, F&gt;</code></p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">x</span>() <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;(), <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">f</span> = File::<span class=\"title function_ invoke__\">open</span>(<span class=\"string\">&quot;hello.txt&quot;</span>).<span class=\"title function_ invoke__\">map_err</span>(|e: std::io::Error| <span class=\"built_in\">format!</span>(<span class=\"string\">&quot;&#123;e&#125;&quot;</span>) );</span><br><span class=\"line\">    <span class=\"keyword\">match</span> f&#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(e)=&gt;<span class=\"title function_ invoke__\">Err</span>(e),</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(_)=&gt;&#123;</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">Ok</span>(())</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"传播错误\"><a href=\"#传播错误\" class=\"headerlink\" title=\"传播错误\"></a>传播错误</h3><p>可以使用 <code>?</code> 运算符来简写</p>\n<p>对于 Result</p>\n<ul>\n<li>如果结果是 <code>Ok(T)</code>，则把 <code>T</code> 赋值给 <code>f</code></li>\n<li>如果结果是 <code>Err(E)</code>，则返回该错误</li>\n</ul>\n<p>对于 Option</p>\n<ul>\n<li>如果值是 <code>Some</code>，<code>Some</code> 中的值作为表达式的返回值同时函数继续</li>\n<li>如果值是 <code>None</code>，此时 <code>None</code> 会从函数中提前返回</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::fs::File;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::io::Read;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">read_username_from_file</span>() <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;<span class=\"type\">String</span>, std::io::Error&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">// // 打开文件，f是`Result&lt;文件句柄,io::Error&gt;`</span></span><br><span class=\"line\">    <span class=\"comment\">// let f = File::open(&quot;hello.txt&quot;);</span></span><br><span class=\"line\">    <span class=\"comment\">// let mut f = match f &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     // 打开文件成功，将file句柄赋值给f</span></span><br><span class=\"line\">    <span class=\"comment\">//     Ok(file) =&gt; file,</span></span><br><span class=\"line\">    <span class=\"comment\">//     // 打开文件失败，将错误返回(向上传播)</span></span><br><span class=\"line\">    <span class=\"comment\">//     Err(e) =&gt; return Err(e),</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;;</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">f</span> = File::<span class=\"title function_ invoke__\">open</span>(<span class=\"string\">&quot;hello.txt&quot;</span>)?;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建动态字符串s</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// // 从f文件句柄读取数据并写入s中</span></span><br><span class=\"line\">    <span class=\"comment\">// match f.read_to_string(&amp;mut s) &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     // 读取成功，返回Ok封装的字符串</span></span><br><span class=\"line\">    <span class=\"comment\">//     Ok(_) =&gt; Ok(s),</span></span><br><span class=\"line\">    <span class=\"comment\">//     // 将错误向上传播</span></span><br><span class=\"line\">    <span class=\"comment\">//     Err(e) =&gt; Err(e),</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">    f.<span class=\"title function_ invoke__\">read_to_string</span>(&amp;<span class=\"keyword\">mut</span> s)?;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Ok</span>(s)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"链式方法调用\"><a href=\"#链式方法调用\" class=\"headerlink\" title=\"链式方法调用\"></a>链式方法调用</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">read_username_from_file</span>() <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;<span class=\"type\">String</span>, std::io::Error&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">s</span> = <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">new</span>();</span><br><span class=\"line\">    File::<span class=\"title function_ invoke__\">open</span>(<span class=\"string\">&quot;hello.txt&quot;</span>)?.<span class=\"title function_ invoke__\">read_to_string</span>(&amp;<span class=\"keyword\">mut</span> s)?;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Ok</span>(s)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"常见错误\"><a href=\"#常见错误\" class=\"headerlink\" title=\"常见错误\"></a>常见错误</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">first</span>(arr: &amp;[<span class=\"type\">i32</span>]) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Option</span>&lt;&amp;<span class=\"type\">i32</span>&gt; &#123;</span><br><span class=\"line\">   arr.<span class=\"title function_ invoke__\">get</span>(<span class=\"number\">0</span>)?</span><br><span class=\"line\">   <span class=\"comment\">// 正确</span></span><br><span class=\"line\">   <span class=\"comment\">// let a = arr.get(0)?;</span></span><br><span class=\"line\">   <span class=\"comment\">// return a;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这段代码无法通过编译：<code>?</code> 操作符需要一个变量来承载值，这个函数只会返回 <code>Some(&amp;i32)</code> 或者 <code>None</code>。而事实上，只有错误值能直接返回，正确的值不行，因为如果数组存在 0 号元素，函数第二行使用 <code>?</code> 后的返回类型是 <code>&amp;i32</code> 而不是 <code>Some(&amp;i32)</code></p>\n<h2 id=\"Option-与-Result-的互相转换\"><a href=\"#Option-与-Result-的互相转换\" class=\"headerlink\" title=\"Option 与 Result 的互相转换\"></a>Option 与 Result 的互相转换</h2><h3 id=\"Option-Result-ok-or\"><a href=\"#Option-Result-ok-or\" class=\"headerlink\" title=\"Option -&gt; Result: ok_or()\"></a><code>Option</code> -&gt; <code>Result</code>: <code>ok_or()</code></h3><ul>\n<li><code>Some(v)</code> to <code>Ok(v)</code></li>\n<li><code>None</code> to <code>Err(err)</code></li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">first</span>(arr: &amp;[<span class=\"type\">i32</span>]) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;&amp;<span class=\"type\">i32</span>, &amp;<span class=\"type\">str</span>&gt; &#123;</span><br><span class=\"line\">    arr.<span class=\"title function_ invoke__\">get</span>(<span class=\"number\">0</span>).<span class=\"title function_ invoke__\">ok_or</span>(<span class=\"string\">&quot;out of index&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Result-Opiton-err\"><a href=\"#Result-Opiton-err\" class=\"headerlink\" title=\"Result -&gt; Opiton: err()\"></a><code>Result</code> -&gt; <code>Opiton</code>: <code>err()</code></h3><ul>\n<li><code>Err(e)</code> to <code>Some(e)</code> </li>\n<li><code>Ok(v)</code> to <code>None</code></li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">f</span> = File::<span class=\"title function_ invoke__\">open</span>(<span class=\"string\">&quot;hello.txt&quot;</span>).<span class=\"title function_ invoke__\">err</span>();</span><br><span class=\"line\"><span class=\"keyword\">if</span> f.<span class=\"title function_ invoke__\">is_some</span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;no file&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Result-Opiton-ok\"><a href=\"#Result-Opiton-ok\" class=\"headerlink\" title=\"Result -&gt; Opiton: ok()\"></a><code>Result</code> -&gt; <code>Opiton</code>: <code>ok()</code></h3><ul>\n<li><code>Ok(e)</code> to <code>Some(e)</code> </li>\n<li><code>Err(v)</code> to <code>None</code></li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">f</span> = File::<span class=\"title function_ invoke__\">open</span>(<span class=\"string\">&quot;hello.txt&quot;</span>).<span class=\"title function_ invoke__\">ok</span>();</span><br><span class=\"line\"><span class=\"keyword\">if</span> f.<span class=\"title function_ invoke__\">is_none</span>()&#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;no file&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"课后习题\"><a href=\"#课后习题\" class=\"headerlink\" title=\"课后习题\"></a>课后习题</h2><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 修复 call 函数的错误</span></span><br><span class=\"line\"><span class=\"comment\">// 当 b 为 None 时，按默认值 1</span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">call</span>(a: <span class=\"type\">i32</span>, b: <span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;<span class=\"type\">f64</span>, <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">r</span> = <span class=\"title function_ invoke__\">divide</span>(a, b); </span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"title function_ invoke__\">sqrt</span>(r);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Ok</span>(s);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">divide</span>(a: <span class=\"type\">i32</span>, b: <span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Option</span>&lt;<span class=\"type\">f64</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> b != <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Some</span>(a <span class=\"keyword\">as</span> <span class=\"type\">f64</span> / b <span class=\"keyword\">as</span> <span class=\"type\">f64</span>)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"literal\">None</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">enum</span> <span class=\"title class_\">MathError</span> &#123;</span><br><span class=\"line\">    DivisionByZero,</span><br><span class=\"line\">    NegativeSquareRoot,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">sqrt</span>(x: <span class=\"type\">f64</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;<span class=\"type\">f64</span>, MathError&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> x &lt; <span class=\"number\">0.0</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Err</span>(MathError::NegativeSquareRoot)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(x.<span class=\"title function_ invoke__\">sqrt</span>())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"答案\"><a href=\"#答案\" class=\"headerlink\" title=\"答案\"></a>答案</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">call</span>(a: <span class=\"type\">i32</span>, b: <span class=\"type\">Option</span>&lt;<span class=\"type\">i32</span>&gt;) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;<span class=\"type\">f64</span>, <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">r</span> = <span class=\"title function_ invoke__\">divide</span>(a, b.<span class=\"title function_ invoke__\">unwrap_or</span>(<span class=\"number\">1</span>)).<span class=\"title function_ invoke__\">ok_or</span>(<span class=\"string\">&quot;Division by zero&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>())?;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">s</span> = <span class=\"title function_ invoke__\">sqrt</span>(r).<span class=\"title function_ invoke__\">map_err</span>(|e: MathError| <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">match</span> e &#123;</span><br><span class=\"line\">            MathError::DivisionByZero =&gt; &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"string\">&quot;DivisionByZero&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            MathError::NegativeSquareRoot =&gt; &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"string\">&quot;NegativeSquareRoot&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)?;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">Ok</span>(s);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"IB-Rust-模块化","date":"2025-06-03T09:05:46.000Z","_content":"\n[Codes in lesson15](https://github.com/Zoella-w/IB-Rust/tree/main/15_modulization)\n\n## Package & Crate\n\n### 定义和作用\n\n- ​​package 是包含一个或多个 crate 的集合​​：由 Cargo.toml 文件定义\n- ​​项目组织单位​​：对应于文件系统中的一个目录\n​​- 依赖管理​​：通过 Cargo.toml 管理外部 crate 依赖\n​​- 构建管理​​：Cargo 根据包定义构建所有 crate\n\n### 关键规则\n\n- ​​一个 package 最多包含一个 library​​ crate\n- ​​一个 package 可以包含任意数量的 binary crate\n​- ​至少包含一个 crate​​（library crate or binary crate）\n\n``` none\nmy_package/\n├── Cargo.toml       # 包定义文件\n└── src/\n    ├── lib.rs       # library crate（可选）\n    ├── main.rs      # 默认 binary crate\n    └── bin/         # 额外 binary crate\n        ├── tool1.rs\n        └── tool2.rs\n```\n\nCargo.toml 额外 binary crate\n\n``` toml\n[[bin]]\nname = \"tool1\"\npath = \"src/bin/tool1.rs\"\n```\n\n## Visibility\n\n### `private` (default)\n\n默认私有：\n\n``` rust\nstruct PrivateStruct;\nfn private_function() {}\n```\n\n### `pub(crate)`\n\n- 在当前 crate 内的任何位置可见\n- 对外部 crate 不可见\n- 适合内部共享的实用工具（utils）\n\n``` rust\npub(crate) struct CrateVisible; // 当前 crate 内可见\n```\n\n### `pub(in path)`\n\n- 限定在指定的模块路径内可见\n- 比 pub(crate) 更精确的可见性控制\n- 路径必须是当前crate内的模块路径\n\n``` rust\npub(in crate::module) struct ModuleVisible; // 特定模块路径内可见\n```\n\n### `pub use`\n\n- 创建简化的公共 API\n- 在不暴露内部结构的情况下公开功能\n- 组合来自不同模块的相关项\n\n``` rust\npub use some_module::SomeType; // 简化重新导出到当前作用域\n```\n\n## Path\n\n- 绝对路径：`crate`\n- 相对路径：`super` `self`\n\n``` rust\n// 绝对路径访问\ncrate::a::echo(); \n\n// 相对路径访问\na::echo(); \nself::a::echo();\nuse super::echo1;\necho1();\n```\n\n## Workspace\n\n工作区是一组共享同一个 Cargo.lock 文件和 target 输出目录的包（packages），这些包通常：\n\n- 位于同一个代码仓库中\n- 相互关联（如 library crate + binary crate）\n- 需要共享依赖项版本\n\n### 典型目录结构\n\n```\nmy_workspace/\n├── Cargo.toml          # 工作区配置文件\n├── Cargo.lock          # 共享的依赖锁文件\n├── target/             # 共享的构建输出目录\n│\n├── crate1/             # 第一个成员包\n│   ├── Cargo.toml\n│   └── src/\n│\n├── crate2/             # 第二个成员包\n│   ├── Cargo.toml\n│   └── src/\n│\n└── tools/              # 工具包（可选）\n    ├── Cargo.toml\n    └── src/\n```\n\n### 创建工作区\n\n#### 创建根目录配置\n\n`my_workspace/Cargo.toml`:\n\n``` toml\n[workspace]\nmembers = [\n    \"crate1\",       # library crate\n    \"crate2\",       # binary crate\n    \"tools/*\",      # 通配符支持\n]\nresolver = \"2\"      # 使用新版解析器（Cargo 2021+）\n```\n\n#### 创建成员包\n\n``` shell\n# 创建库crate\ncargo new --lib crate1\n\n# 创建二进制crate\ncargo new crate2\n\n# 创建工具包\nmkdir -p tools/tool1\ncargo init --bin tools/tool1\n```\n\n#### 工作区操作命令\n\n``` shell\n# 构建所有成员\ncargo build --workspace\n\n# 测试特定成员\ncargo test -p crate1\n\n# 运行二进制成员\ncargo run -p crate2 -- --args\n\n# 检查所有依赖更新\ncargo update --workspace\n```\n\n## Test\n\n### unit test\n\n- 位置​​：与源码在同一文件（src/ 目录下）\n​- ​作用​​：测试函数或模块内部的实现细节\n​​- 标记​​：`#[cfg(test)] mod tests { }` + `#[test]`\n\n``` rust\n#[cfg(test)]\nmod tests {\n    #[test]\n    fn it_works() {\n        assert_eq!(2 + 2, 4);\n    }\n}\n```\n\n### integration test\n\n- ​​位置​​：单独的 tests/ 目录（与 src/ 同级）\n​- ​作用​​：测试库的公共接口\n​- ​特点​​：每个测试文件都是独立的 crate\n\n``` rust\n// project/tests/integration_test.rs\nuse my_crate;\n#[test]\nfn it_adds_two() {\n    assert!(my_crate::add(2, 2), 4);\n}\n```\n","source":"_posts/73-IB-Rust-模块化.md","raw":"---\ntitle: IB-Rust-模块化\ndate: 2025-06-03 17:05:46\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson15](https://github.com/Zoella-w/IB-Rust/tree/main/15_modulization)\n\n## Package & Crate\n\n### 定义和作用\n\n- ​​package 是包含一个或多个 crate 的集合​​：由 Cargo.toml 文件定义\n- ​​项目组织单位​​：对应于文件系统中的一个目录\n​​- 依赖管理​​：通过 Cargo.toml 管理外部 crate 依赖\n​​- 构建管理​​：Cargo 根据包定义构建所有 crate\n\n### 关键规则\n\n- ​​一个 package 最多包含一个 library​​ crate\n- ​​一个 package 可以包含任意数量的 binary crate\n​- ​至少包含一个 crate​​（library crate or binary crate）\n\n``` none\nmy_package/\n├── Cargo.toml       # 包定义文件\n└── src/\n    ├── lib.rs       # library crate（可选）\n    ├── main.rs      # 默认 binary crate\n    └── bin/         # 额外 binary crate\n        ├── tool1.rs\n        └── tool2.rs\n```\n\nCargo.toml 额外 binary crate\n\n``` toml\n[[bin]]\nname = \"tool1\"\npath = \"src/bin/tool1.rs\"\n```\n\n## Visibility\n\n### `private` (default)\n\n默认私有：\n\n``` rust\nstruct PrivateStruct;\nfn private_function() {}\n```\n\n### `pub(crate)`\n\n- 在当前 crate 内的任何位置可见\n- 对外部 crate 不可见\n- 适合内部共享的实用工具（utils）\n\n``` rust\npub(crate) struct CrateVisible; // 当前 crate 内可见\n```\n\n### `pub(in path)`\n\n- 限定在指定的模块路径内可见\n- 比 pub(crate) 更精确的可见性控制\n- 路径必须是当前crate内的模块路径\n\n``` rust\npub(in crate::module) struct ModuleVisible; // 特定模块路径内可见\n```\n\n### `pub use`\n\n- 创建简化的公共 API\n- 在不暴露内部结构的情况下公开功能\n- 组合来自不同模块的相关项\n\n``` rust\npub use some_module::SomeType; // 简化重新导出到当前作用域\n```\n\n## Path\n\n- 绝对路径：`crate`\n- 相对路径：`super` `self`\n\n``` rust\n// 绝对路径访问\ncrate::a::echo(); \n\n// 相对路径访问\na::echo(); \nself::a::echo();\nuse super::echo1;\necho1();\n```\n\n## Workspace\n\n工作区是一组共享同一个 Cargo.lock 文件和 target 输出目录的包（packages），这些包通常：\n\n- 位于同一个代码仓库中\n- 相互关联（如 library crate + binary crate）\n- 需要共享依赖项版本\n\n### 典型目录结构\n\n```\nmy_workspace/\n├── Cargo.toml          # 工作区配置文件\n├── Cargo.lock          # 共享的依赖锁文件\n├── target/             # 共享的构建输出目录\n│\n├── crate1/             # 第一个成员包\n│   ├── Cargo.toml\n│   └── src/\n│\n├── crate2/             # 第二个成员包\n│   ├── Cargo.toml\n│   └── src/\n│\n└── tools/              # 工具包（可选）\n    ├── Cargo.toml\n    └── src/\n```\n\n### 创建工作区\n\n#### 创建根目录配置\n\n`my_workspace/Cargo.toml`:\n\n``` toml\n[workspace]\nmembers = [\n    \"crate1\",       # library crate\n    \"crate2\",       # binary crate\n    \"tools/*\",      # 通配符支持\n]\nresolver = \"2\"      # 使用新版解析器（Cargo 2021+）\n```\n\n#### 创建成员包\n\n``` shell\n# 创建库crate\ncargo new --lib crate1\n\n# 创建二进制crate\ncargo new crate2\n\n# 创建工具包\nmkdir -p tools/tool1\ncargo init --bin tools/tool1\n```\n\n#### 工作区操作命令\n\n``` shell\n# 构建所有成员\ncargo build --workspace\n\n# 测试特定成员\ncargo test -p crate1\n\n# 运行二进制成员\ncargo run -p crate2 -- --args\n\n# 检查所有依赖更新\ncargo update --workspace\n```\n\n## Test\n\n### unit test\n\n- 位置​​：与源码在同一文件（src/ 目录下）\n​- ​作用​​：测试函数或模块内部的实现细节\n​​- 标记​​：`#[cfg(test)] mod tests { }` + `#[test]`\n\n``` rust\n#[cfg(test)]\nmod tests {\n    #[test]\n    fn it_works() {\n        assert_eq!(2 + 2, 4);\n    }\n}\n```\n\n### integration test\n\n- ​​位置​​：单独的 tests/ 目录（与 src/ 同级）\n​- ​作用​​：测试库的公共接口\n​- ​特点​​：每个测试文件都是独立的 crate\n\n``` rust\n// project/tests/integration_test.rs\nuse my_crate;\n#[test]\nfn it_adds_two() {\n    assert!(my_crate::add(2, 2), 4);\n}\n```\n","slug":"73-IB-Rust-模块化","published":1,"updated":"2025-06-03T10:17:56.815Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmbgd7y8a0000ogpr0xfn8717","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/15_modulization\" >Codes in lesson15<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"Package-Crate\"><a href=\"#Package-Crate\" class=\"headerlink\" title=\"Package &amp; Crate\"></a>Package &amp; Crate</h2><h3 id=\"定义和作用\"><a href=\"#定义和作用\" class=\"headerlink\" title=\"定义和作用\"></a>定义和作用</h3><ul>\n<li>​​package 是包含一个或多个 crate 的集合​​：由 Cargo.toml 文件定义</li>\n<li>​​项目组织单位​​：对应于文件系统中的一个目录<br>​​- 依赖管理​​：通过 Cargo.toml 管理外部 crate 依赖<br>​​- 构建管理​​：Cargo 根据包定义构建所有 crate</li>\n</ul>\n<h3 id=\"关键规则\"><a href=\"#关键规则\" class=\"headerlink\" title=\"关键规则\"></a>关键规则</h3><ul>\n<li>​​一个 package 最多包含一个 library​​ crate</li>\n<li>​​一个 package 可以包含任意数量的 binary crate<br>​- ​至少包含一个 crate​​（library crate or binary crate）</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">my_package/</span><br><span class=\"line\">├── Cargo.toml       # 包定义文件</span><br><span class=\"line\">└── src/</span><br><span class=\"line\">    ├── lib.rs       # library crate（可选）</span><br><span class=\"line\">    ├── main.rs      # 默认 binary crate</span><br><span class=\"line\">    └── bin/         # 额外 binary crate</span><br><span class=\"line\">        ├── tool1.rs</span><br><span class=\"line\">        └── tool2.rs</span><br></pre></td></tr></table></figure></div>\n\n<p>Cargo.toml 额外 binary crate</p>\n<div class=\"code-container\" data-rel=\"Toml\"><figure class=\"iseeu highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[[bin]]</span></span><br><span class=\"line\"><span class=\"attr\">name</span> = <span class=\"string\">&quot;tool1&quot;</span></span><br><span class=\"line\"><span class=\"attr\">path</span> = <span class=\"string\">&quot;src/bin/tool1.rs&quot;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"Visibility\"><a href=\"#Visibility\" class=\"headerlink\" title=\"Visibility\"></a>Visibility</h2><h3 id=\"private-default\"><a href=\"#private-default\" class=\"headerlink\" title=\"private (default)\"></a><code>private</code> (default)</h3><p>默认私有：</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">PrivateStruct</span>;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">private_function</span>() &#123;&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"pub-crate\"><a href=\"#pub-crate\" class=\"headerlink\" title=\"pub(crate)\"></a><code>pub(crate)</code></h3><ul>\n<li>在当前 crate 内的任何位置可见</li>\n<li>对外部 crate 不可见</li>\n<li>适合内部共享的实用工具（utils）</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_ invoke__\">pub</span>(<span class=\"keyword\">crate</span>) <span class=\"keyword\">struct</span> <span class=\"title class_\">CrateVisible</span>; <span class=\"comment\">// 当前 crate 内可见</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"pub-in-path\"><a href=\"#pub-in-path\" class=\"headerlink\" title=\"pub(in path)\"></a><code>pub(in path)</code></h3><ul>\n<li>限定在指定的模块路径内可见</li>\n<li>比 pub(crate) 更精确的可见性控制</li>\n<li>路径必须是当前crate内的模块路径</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_ invoke__\">pub</span>(<span class=\"keyword\">in</span> crate::module) <span class=\"keyword\">struct</span> <span class=\"title class_\">ModuleVisible</span>; <span class=\"comment\">// 特定模块路径内可见</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"pub-use\"><a href=\"#pub-use\" class=\"headerlink\" title=\"pub use\"></a><code>pub use</code></h3><ul>\n<li>创建简化的公共 API</li>\n<li>在不暴露内部结构的情况下公开功能</li>\n<li>组合来自不同模块的相关项</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">use</span> some_module::SomeType; <span class=\"comment\">// 简化重新导出到当前作用域</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"Path\"><a href=\"#Path\" class=\"headerlink\" title=\"Path\"></a>Path</h2><ul>\n<li>绝对路径：<code>crate</code></li>\n<li>相对路径：<code>super</code> <code>self</code></li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 绝对路径访问</span></span><br><span class=\"line\">crate::a::<span class=\"title function_ invoke__\">echo</span>(); </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 相对路径访问</span></span><br><span class=\"line\">a::<span class=\"title function_ invoke__\">echo</span>(); </span><br><span class=\"line\">self::a::<span class=\"title function_ invoke__\">echo</span>();</span><br><span class=\"line\"><span class=\"keyword\">use</span> super::echo1;</span><br><span class=\"line\"><span class=\"title function_ invoke__\">echo1</span>();</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"Workspace\"><a href=\"#Workspace\" class=\"headerlink\" title=\"Workspace\"></a>Workspace</h2><p>工作区是一组共享同一个 Cargo.lock 文件和 target 输出目录的包（packages），这些包通常：</p>\n<ul>\n<li>位于同一个代码仓库中</li>\n<li>相互关联（如 library crate + binary crate）</li>\n<li>需要共享依赖项版本</li>\n</ul>\n<h3 id=\"典型目录结构\"><a href=\"#典型目录结构\" class=\"headerlink\" title=\"典型目录结构\"></a>典型目录结构</h3><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">my_workspace/</span><br><span class=\"line\">├── Cargo.toml          # 工作区配置文件</span><br><span class=\"line\">├── Cargo.lock          # 共享的依赖锁文件</span><br><span class=\"line\">├── target/             # 共享的构建输出目录</span><br><span class=\"line\">│</span><br><span class=\"line\">├── crate1/             # 第一个成员包</span><br><span class=\"line\">│   ├── Cargo.toml</span><br><span class=\"line\">│   └── src/</span><br><span class=\"line\">│</span><br><span class=\"line\">├── crate2/             # 第二个成员包</span><br><span class=\"line\">│   ├── Cargo.toml</span><br><span class=\"line\">│   └── src/</span><br><span class=\"line\">│</span><br><span class=\"line\">└── tools/              # 工具包（可选）</span><br><span class=\"line\">    ├── Cargo.toml</span><br><span class=\"line\">    └── src/</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"创建工作区\"><a href=\"#创建工作区\" class=\"headerlink\" title=\"创建工作区\"></a>创建工作区</h3><h4 id=\"创建根目录配置\"><a href=\"#创建根目录配置\" class=\"headerlink\" title=\"创建根目录配置\"></a>创建根目录配置</h4><p><code>my_workspace/Cargo.toml</code>:</p>\n<div class=\"code-container\" data-rel=\"Toml\"><figure class=\"iseeu highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[workspace]</span></span><br><span class=\"line\"><span class=\"attr\">members</span> = [</span><br><span class=\"line\">    <span class=\"string\">&quot;crate1&quot;</span>,       <span class=\"comment\"># library crate</span></span><br><span class=\"line\">    <span class=\"string\">&quot;crate2&quot;</span>,       <span class=\"comment\"># binary crate</span></span><br><span class=\"line\">    <span class=\"string\">&quot;tools/*&quot;</span>,      <span class=\"comment\"># 通配符支持</span></span><br><span class=\"line\">]</span><br><span class=\"line\"><span class=\"attr\">resolver</span> = <span class=\"string\">&quot;2&quot;</span>      <span class=\"comment\"># 使用新版解析器（Cargo 2021+）</span></span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"创建成员包\"><a href=\"#创建成员包\" class=\"headerlink\" title=\"创建成员包\"></a>创建成员包</h4><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">创建库crate</span></span><br><span class=\"line\">cargo new --lib crate1</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">创建二进制crate</span></span><br><span class=\"line\">cargo new crate2</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">创建工具包</span></span><br><span class=\"line\">mkdir -p tools/tool1</span><br><span class=\"line\">cargo init --bin tools/tool1</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"工作区操作命令\"><a href=\"#工作区操作命令\" class=\"headerlink\" title=\"工作区操作命令\"></a>工作区操作命令</h4><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">构建所有成员</span></span><br><span class=\"line\">cargo build --workspace</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">测试特定成员</span></span><br><span class=\"line\">cargo test -p crate1</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">运行二进制成员</span></span><br><span class=\"line\">cargo run -p crate2 -- --args</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">检查所有依赖更新</span></span><br><span class=\"line\">cargo update --workspace</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"Test\"><a href=\"#Test\" class=\"headerlink\" title=\"Test\"></a>Test</h2><h3 id=\"unit-test\"><a href=\"#unit-test\" class=\"headerlink\" title=\"unit test\"></a>unit test</h3><ul>\n<li>位置​​：与源码在同一文件（src&#x2F; 目录下）<br>​- ​作用​​：测试函数或模块内部的实现细节<br>​​- 标记​​：<code>#[cfg(test)] mod tests &#123; &#125;</code> + <code>#[test]</code></li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#[cfg(test)]</span></span><br><span class=\"line\"><span class=\"keyword\">mod</span> tests &#123;</span><br><span class=\"line\">    <span class=\"meta\">#[test]</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">it_works</span>() &#123;</span><br><span class=\"line\">        <span class=\"built_in\">assert_eq!</span>(<span class=\"number\">2</span> + <span class=\"number\">2</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"integration-test\"><a href=\"#integration-test\" class=\"headerlink\" title=\"integration test\"></a>integration test</h3><ul>\n<li>​​位置​​：单独的 tests&#x2F; 目录（与 src&#x2F; 同级）<br>​- ​作用​​：测试库的公共接口<br>​- ​特点​​：每个测试文件都是独立的 crate</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// project/tests/integration_test.rs</span></span><br><span class=\"line\"><span class=\"keyword\">use</span> my_crate;</span><br><span class=\"line\"><span class=\"meta\">#[test]</span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">it_adds_two</span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">assert!</span>(my_crate::<span class=\"title function_ invoke__\">add</span>(<span class=\"number\">2</span>, <span class=\"number\">2</span>), <span class=\"number\">4</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/15_modulization\" >Codes in lesson15<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"Package-Crate\"><a href=\"#Package-Crate\" class=\"headerlink\" title=\"Package &amp; Crate\"></a>Package &amp; Crate</h2><h3 id=\"定义和作用\"><a href=\"#定义和作用\" class=\"headerlink\" title=\"定义和作用\"></a>定义和作用</h3><ul>\n<li>​​package 是包含一个或多个 crate 的集合​​：由 Cargo.toml 文件定义</li>\n<li>​​项目组织单位​​：对应于文件系统中的一个目录<br>​​- 依赖管理​​：通过 Cargo.toml 管理外部 crate 依赖<br>​​- 构建管理​​：Cargo 根据包定义构建所有 crate</li>\n</ul>\n<h3 id=\"关键规则\"><a href=\"#关键规则\" class=\"headerlink\" title=\"关键规则\"></a>关键规则</h3><ul>\n<li>​​一个 package 最多包含一个 library​​ crate</li>\n<li>​​一个 package 可以包含任意数量的 binary crate<br>​- ​至少包含一个 crate​​（library crate or binary crate）</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">my_package/</span><br><span class=\"line\">├── Cargo.toml       # 包定义文件</span><br><span class=\"line\">└── src/</span><br><span class=\"line\">    ├── lib.rs       # library crate（可选）</span><br><span class=\"line\">    ├── main.rs      # 默认 binary crate</span><br><span class=\"line\">    └── bin/         # 额外 binary crate</span><br><span class=\"line\">        ├── tool1.rs</span><br><span class=\"line\">        └── tool2.rs</span><br></pre></td></tr></table></figure>\n\n<p>Cargo.toml 额外 binary crate</p>\n<figure class=\"highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[[bin]]</span></span><br><span class=\"line\"><span class=\"attr\">name</span> = <span class=\"string\">&quot;tool1&quot;</span></span><br><span class=\"line\"><span class=\"attr\">path</span> = <span class=\"string\">&quot;src/bin/tool1.rs&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Visibility\"><a href=\"#Visibility\" class=\"headerlink\" title=\"Visibility\"></a>Visibility</h2><h3 id=\"private-default\"><a href=\"#private-default\" class=\"headerlink\" title=\"private (default)\"></a><code>private</code> (default)</h3><p>默认私有：</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">PrivateStruct</span>;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">private_function</span>() &#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"pub-crate\"><a href=\"#pub-crate\" class=\"headerlink\" title=\"pub(crate)\"></a><code>pub(crate)</code></h3><ul>\n<li>在当前 crate 内的任何位置可见</li>\n<li>对外部 crate 不可见</li>\n<li>适合内部共享的实用工具（utils）</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_ invoke__\">pub</span>(<span class=\"keyword\">crate</span>) <span class=\"keyword\">struct</span> <span class=\"title class_\">CrateVisible</span>; <span class=\"comment\">// 当前 crate 内可见</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"pub-in-path\"><a href=\"#pub-in-path\" class=\"headerlink\" title=\"pub(in path)\"></a><code>pub(in path)</code></h3><ul>\n<li>限定在指定的模块路径内可见</li>\n<li>比 pub(crate) 更精确的可见性控制</li>\n<li>路径必须是当前crate内的模块路径</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_ invoke__\">pub</span>(<span class=\"keyword\">in</span> crate::module) <span class=\"keyword\">struct</span> <span class=\"title class_\">ModuleVisible</span>; <span class=\"comment\">// 特定模块路径内可见</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"pub-use\"><a href=\"#pub-use\" class=\"headerlink\" title=\"pub use\"></a><code>pub use</code></h3><ul>\n<li>创建简化的公共 API</li>\n<li>在不暴露内部结构的情况下公开功能</li>\n<li>组合来自不同模块的相关项</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">use</span> some_module::SomeType; <span class=\"comment\">// 简化重新导出到当前作用域</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Path\"><a href=\"#Path\" class=\"headerlink\" title=\"Path\"></a>Path</h2><ul>\n<li>绝对路径：<code>crate</code></li>\n<li>相对路径：<code>super</code> <code>self</code></li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 绝对路径访问</span></span><br><span class=\"line\">crate::a::<span class=\"title function_ invoke__\">echo</span>(); </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 相对路径访问</span></span><br><span class=\"line\">a::<span class=\"title function_ invoke__\">echo</span>(); </span><br><span class=\"line\">self::a::<span class=\"title function_ invoke__\">echo</span>();</span><br><span class=\"line\"><span class=\"keyword\">use</span> super::echo1;</span><br><span class=\"line\"><span class=\"title function_ invoke__\">echo1</span>();</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Workspace\"><a href=\"#Workspace\" class=\"headerlink\" title=\"Workspace\"></a>Workspace</h2><p>工作区是一组共享同一个 Cargo.lock 文件和 target 输出目录的包（packages），这些包通常：</p>\n<ul>\n<li>位于同一个代码仓库中</li>\n<li>相互关联（如 library crate + binary crate）</li>\n<li>需要共享依赖项版本</li>\n</ul>\n<h3 id=\"典型目录结构\"><a href=\"#典型目录结构\" class=\"headerlink\" title=\"典型目录结构\"></a>典型目录结构</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">my_workspace/</span><br><span class=\"line\">├── Cargo.toml          # 工作区配置文件</span><br><span class=\"line\">├── Cargo.lock          # 共享的依赖锁文件</span><br><span class=\"line\">├── target/             # 共享的构建输出目录</span><br><span class=\"line\">│</span><br><span class=\"line\">├── crate1/             # 第一个成员包</span><br><span class=\"line\">│   ├── Cargo.toml</span><br><span class=\"line\">│   └── src/</span><br><span class=\"line\">│</span><br><span class=\"line\">├── crate2/             # 第二个成员包</span><br><span class=\"line\">│   ├── Cargo.toml</span><br><span class=\"line\">│   └── src/</span><br><span class=\"line\">│</span><br><span class=\"line\">└── tools/              # 工具包（可选）</span><br><span class=\"line\">    ├── Cargo.toml</span><br><span class=\"line\">    └── src/</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建工作区\"><a href=\"#创建工作区\" class=\"headerlink\" title=\"创建工作区\"></a>创建工作区</h3><h4 id=\"创建根目录配置\"><a href=\"#创建根目录配置\" class=\"headerlink\" title=\"创建根目录配置\"></a>创建根目录配置</h4><p><code>my_workspace/Cargo.toml</code>:</p>\n<figure class=\"highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[workspace]</span></span><br><span class=\"line\"><span class=\"attr\">members</span> = [</span><br><span class=\"line\">    <span class=\"string\">&quot;crate1&quot;</span>,       <span class=\"comment\"># library crate</span></span><br><span class=\"line\">    <span class=\"string\">&quot;crate2&quot;</span>,       <span class=\"comment\"># binary crate</span></span><br><span class=\"line\">    <span class=\"string\">&quot;tools/*&quot;</span>,      <span class=\"comment\"># 通配符支持</span></span><br><span class=\"line\">]</span><br><span class=\"line\"><span class=\"attr\">resolver</span> = <span class=\"string\">&quot;2&quot;</span>      <span class=\"comment\"># 使用新版解析器（Cargo 2021+）</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"创建成员包\"><a href=\"#创建成员包\" class=\"headerlink\" title=\"创建成员包\"></a>创建成员包</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">创建库crate</span></span><br><span class=\"line\">cargo new --lib crate1</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">创建二进制crate</span></span><br><span class=\"line\">cargo new crate2</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">创建工具包</span></span><br><span class=\"line\">mkdir -p tools/tool1</span><br><span class=\"line\">cargo init --bin tools/tool1</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"工作区操作命令\"><a href=\"#工作区操作命令\" class=\"headerlink\" title=\"工作区操作命令\"></a>工作区操作命令</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">构建所有成员</span></span><br><span class=\"line\">cargo build --workspace</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">测试特定成员</span></span><br><span class=\"line\">cargo test -p crate1</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">运行二进制成员</span></span><br><span class=\"line\">cargo run -p crate2 -- --args</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">检查所有依赖更新</span></span><br><span class=\"line\">cargo update --workspace</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Test\"><a href=\"#Test\" class=\"headerlink\" title=\"Test\"></a>Test</h2><h3 id=\"unit-test\"><a href=\"#unit-test\" class=\"headerlink\" title=\"unit test\"></a>unit test</h3><ul>\n<li>位置​​：与源码在同一文件（src&#x2F; 目录下）<br>​- ​作用​​：测试函数或模块内部的实现细节<br>​​- 标记​​：<code>#[cfg(test)] mod tests &#123; &#125;</code> + <code>#[test]</code></li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#[cfg(test)]</span></span><br><span class=\"line\"><span class=\"keyword\">mod</span> tests &#123;</span><br><span class=\"line\">    <span class=\"meta\">#[test]</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">it_works</span>() &#123;</span><br><span class=\"line\">        <span class=\"built_in\">assert_eq!</span>(<span class=\"number\">2</span> + <span class=\"number\">2</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"integration-test\"><a href=\"#integration-test\" class=\"headerlink\" title=\"integration test\"></a>integration test</h3><ul>\n<li>​​位置​​：单独的 tests&#x2F; 目录（与 src&#x2F; 同级）<br>​- ​作用​​：测试库的公共接口<br>​- ​特点​​：每个测试文件都是独立的 crate</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// project/tests/integration_test.rs</span></span><br><span class=\"line\"><span class=\"keyword\">use</span> my_crate;</span><br><span class=\"line\"><span class=\"meta\">#[test]</span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">it_adds_two</span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">assert!</span>(my_crate::<span class=\"title function_ invoke__\">add</span>(<span class=\"number\">2</span>, <span class=\"number\">2</span>), <span class=\"number\">4</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"IB-Rust-智能指针&box","date":"2025-06-04T05:18:38.000Z","_content":"\n[Codes in lesson16](https://github.com/Zoella-w/IB-Rust/tree/main/16_smart_pointer_box)\n\n## 智能指针\n\n### 智能指针概述\n\n智能指针（Smart Pointers）是一类数据结构，不仅包含一个指针，还附带一些额外的元数据和功能。智能指针实现了 `Deref` 和 `Drop` 两个 trait，使得它们可以像指针一样解引用并在离开作用域时自动清理资源\n\n### 智能指针作用\n\n- 资源管理\n  - 自动管理资源的分配和释放，避免内存泄漏\n- 所有权与借用\n  - Rust 的所有权系统通过智能指针来确保内存安全，避免数据竞争和悬垂指针\n- 复杂数据结构\n  - 通过智能指针可以构建复杂的数据结构，如递归结构、共享数据等\n\n## `BOX<T>`\n\n- `Box<T>` 将类型 T 的值分配在堆上，而不是栈上\n- 当 Box 被销毁时，堆上的数据也会被销毁\n\n### Box 的底层实现\n\n- 底层原理\n  - `Box<T>` 实际上是一个智能指针，内部包含一个指向堆上分配内存的裸指针\n  - 当 `Box<T>` 被销毁时，其 `Drop` trait 会被调用，释放堆上的内存\n- 内存分配\n  - Rust 使用系统的全局分配器（如 malloc 和 free）来管理堆内存\n  - Box::new 分配内存，Drop 释放内存\n- 安全性\n  - Rust 的所有权系统确保 `Box<T>` 的内存安全。所有权转移时，堆内存的生命周期也会随之变化\n\n### Box 的使用场景\n\n#### 堆分配\n   \nBox 最常见的用途是将数据分配在堆上，而不是栈上。这在处理较大数据结构、或数据结构的大小在编译时不确定时尤为重要\n\n```rust\nlet b = Box::new(5);\nprintln!(\"b = {}\", b);\n```\n\n#### 动态大小类型（DST）\n\nBox 允许处理动态大小类型，如 `str` 和 `[T]`\n\n```rust\nlet s: Box<str> = \"Hello, world!\".into();\nprintln!(\"s = {}\", s);\nlet arr: Box<[i32]> = vec![1, 2, 3, 4, 5].into_boxed_slice();\nprintln!(\"arr = {:?}\", arr);\n```\n\n#### 递归数据结构\n\n递归数据结构需要指针类型引用自身，而 Box 提供了这一功能\n\n```rust\nenum List {\n    Cons(i32, Box<List>),\n    Nil,\n}\nuse List::{Cons, Nil};\nfn main() {\n    let list = Cons(1, Box::new(Cons(2, Box::new(Cons(3, Box::new(Nil))))));\n}\n```\n\n#### 类型擦除\n\n`Box<dyn Trait>` 用于类型擦除，允许在运行时决定类型\n\n```rust\ntrait Animal {\n    fn speak(&self);\n}\nstruct Dog;\nstruct Cat;\nimpl Animal for Dog {\n    fn speak(&self) {\n        println!(\"Woof!\");\n    }\n}\nimpl Animal for Cat {\n    fn speak(&self) {\n        println!(\"Meow!\");\n    }\n}\nfn main() {\n    let animals: Vec<Box<dyn Animal>> = vec![Box::new(Dog), Box::new(Cat)];\n    for animal in animals.iter() {\n        animal.speak();\n    }\n}\n```\n\n### `dyn` 关键字\n\n`dyn` 关键字用于指定动态分发的类型，允许在运行时决定具体类型，可用于实现动态分发的 trait 对象\n\n### 内存管理和性能优化\n\n通过使用 Box，可以控制内存的分配和释放，从而优化性能和内存使用。例如，将大型数据结构放在堆上，而不是栈上，从而避免栈溢出\n\n```rust\nlet large_array = Box::new([0u8; 1_000_000]);\nprintln!(\"Large array allocated on the heap.\");\n```\n\n## Box 的优缺点\n\n- 优点\n  - 提供堆内存分配，支持复杂数据结构\n  - 与 Rust 的所有权系统完美集成，确保内存安全\n  - 动态分配对象，实现类型擦除\n- 缺点\n  - 需要堆内存分配和释放，可能带来性能开销\n  - 不适合需要频繁分配和释放的场景\n\n## Drop、Derefb 和 DerefMut\n\n- `Drop` Trait\n  - `Drop` trait 定义了当一个值离开作用域时应该执行的操作\n  - 例如：`Box<T>` 在超出作用域时会自动调用其 Drop trait，释放堆上的内存\n- `Deref` Trait\n  - `Deref` trait 定义了如何将一个类型转换为引用\n  - 例如：`Box<T>` 实现了 Deref，所以可以通过 * 运算符解引用获取其内部数据\n\n### `Drop` Trait\n\n`Drop` trait 用于自定义当值离开作用域时执行的代码，通常用于释放资源（例如内存、文件句柄、网络连接等）\n\n#### 定义和实现\n\n`Drop` trait 定义了一个 drop 方法，当值被释放时，Rust 会自动调用这个方法\n\n```rust\npub trait Drop {\n  fn drop(&mut self);\n}\n```\n\n```rust\nstruct Resource {\n    name: String,\n}\n// 正确实现标准库的 Drop trait\nimpl Drop for Resource {\n    fn drop(&mut self) {\n        println!(\"{} is dropped\", self.name);\n    }\n}\nfn box_study() {\n    let _r1 = Resource {\n        name: \"r1\".to_string(),\n    };\n    {\n        let _r2 = Resource {\n            name: \"r2\".to_string(),\n        };\n    }  // r2 在这里离开作用域\n}  // r1 在这里离开作用域\nfn main() {\n    box_study();\n}\n```\n\n### `Deref` Trait\n\n`Deref` trait 用于重载解引用运算符（*），允许定义自定义指针类型的解引用行为\n\n#### 定义和实现\n\n`Deref` trait 定义了一个 deref 方法，该方法返回指向目标类型的引用\n\n```rust\npub trait Deref {\n  type Target: ?Sized;\n  fn deref(&self) -> &Self::Target;\n}\n```\n```rust\nuse std::ops::Deref;\nfn main() {\n  let x = 5;\n  let y = MyBox::new(x);\n  println!(\"x = {}\", x);\n  // 触发解引用运算符重载\n  // 等价于 *(y.deref())（编译器自动转换）\n  println!(\"y = {}\", *y);\n}\nstruct MyBox<T>(T);\n// 构造函数实现\nimpl<T> MyBox<T> {\n    fn new(x: T) -> MyBox<T> {\n        MyBox(x)\n    }\n}\nimpl<T> Deref for MyBox<T> {\n  // 关联类型\n  type Target = T;\n  fn deref(&self) -> &T {\n    println!(\"deref called\");\n    // 访问元组结构体的第一个字段\n    &self.0\n  }\n}\n```\n\n### `DerefMut` Trait\n\n与 Deref 类似，DerefMut 用于重载可变解引用运算符（*），允许对自定义类型进行可变解引用\n\n#### 定义和实现\n\n```rust\npub trait DerefMut: Deref {\n  fn deref_mut(&mut self) -> &mut Self::Target;\n}\n```\n\n```rust\nimpl<T> DerefMut for MyBox<T> {\n  fn deref_mut(&mut self) -> &mut Self::Target {\n    println!(\"deref called\");\n    // 访问元组结构体的第一个字段\n    &mut self.0\n  }\n}\n```\n\n## 课后作业\n\n### 作业 1: 内存管理和性能优化\n\n创建一个大型数组并将其分配到堆上，然后测量和比较分配在堆和栈上的性能差异。\n\n创建一个包含 1_000_000 个元素的数组，分别将其分配在堆和栈上。使用 `std::time::Instant` 来测量分配和访问时间。\n\n```rust\nuse std::time::Instant;\n\nfn main() {\n  test_stack_allocation();\n  test_heap_allocation();\n}\n\nfn test_stack_allocation() {\n  // 栈上分配测试 (1,000,000 个整数)\n  let n = 1_000_000;\n  // 分配\n  let start = Instant::now();\n  let mut arr: [u32; 1_000_000] = [0; 1_000_000]; // 改用u32避免负数问题\n  let duration = start.elapsed();\n  println!(\"分配时间: {:?}\", duration); // 分配时间: 58.75µs\n  // 写入\n  let start = Instant::now();\n  for i in 0..n {\n      arr[i] = i as u32;\n  }\n  let duration = start.elapsed();\n  println!(\"写入时间: {:?}\", duration); // 写入时间: 7.7795ms\n  // 读取和求和\n  let start = Instant::now();\n  let mut sum: u64 = 0; // 使用u64来容纳大数字\n  for i in 0..n {\n      sum += arr[i] as u64; // 将每个元素转为u64\n  }\n  let duration = start.elapsed();\n  println!(\"读取时间: {:?}\\n\", duration); // 读取时间: 7.601417ms\n}\n\nfn test_heap_allocation() {\n  // 堆上分配测试 (1,000,000 个整数)\n  let n = 1_000_000;\n  // 分配\n  let start = Instant::now();\n  let mut arr = Box::new([0u32; 1_000_000]); // 明确类型为u32\n  let duration = start.elapsed();\n  println!(\"分配时间: {:?}\", duration); // 分配时间: 421.75µs\n  // 写入\n  let start = Instant::now();\n  for i in 0..n {\n      arr[i] = i as u32;\n  }\n  let duration = start.elapsed();\n  println!(\"写入时间: {:?}\", duration); // 写入时间: 6.979958ms\n  // 读取和求和\n  let start = Instant::now();\n  let mut sum: u64 = 0;\n  for i in 0..n {\n      sum += arr[i] as u64;\n  }\n  let duration = start.elapsed();\n  println!(\"读取时间: {:?}\", duration); // 读取时间: 7.15825ms\n}\n```\n\n### 作业2：实现一个简单的文件系统模拟\n\n- 目标\n实现一个简单的文件系统模拟，其中包含文件和文件夹的概念。文件夹可以包含文件和其他文件夹。使用 Box 来管理内存，并实现对文件系统的基本操作（如创建文件、创建文件夹、列出文件和文件夹）。\n\n- 作业要求\n  - 定义 `FileSystem` trait 和 Node 枚举\n    - `FileSystem` trait 包含 `create_file`、`create_folder` 和 `list_contents` 方法。\n    - `Node` 枚举包含 `File` 和 `Folder` 变体。\n  - 实现 `FolderNode` 结构体\n    - `FolderNode` 实现 `FileSystem` trait，包含 `name` 和 `contents` 字段。\n    - 使用 `Box` 管理 `contents` 中的子节点。\n  - 实现文件系统的基本操作\n    - `create_file` 方法在文件夹中创建文件。\n    - `create_folder` 方法在文件夹中创建子文件夹。\n    - `list_contents` 方法列出文件夹的所有内容。\n  - 测试文件系统的操作\n    - 创建根文件夹并添加文件和文件夹。\n    - 创建子文件夹并添加文件。\n    - 列出文件夹的内容并输出文件系统结构。\n- 提示\n使用 `Box` 来管理 `Folder` 中的子节点。\n使用递归方法来遍历和列出文件和文件夹的内容。\n考虑使用 `Vec` 来存储文件夹的子节点。\n\n```rust\ntrait FileSystem {\n    fn create_file(&mut self, name: &str) -> Result<(), String>;\n    fn create_folder(&mut self, name: &str) -> Result<(), String>;\n    fn list_contents(&self, indent: usize);\n}\n// 定义 Node 枚举，包含：文件节点 和 文件夹节点\nenum Node {\n    // File 和 Folder 是变体的名称\n    // (FileNode) 和 (FolderNode) 是变体关联的数据类型\n    File(FileNode),\n    Folder(FolderNode),\n}\n// 文件节点结构\nstruct FileNode {\n    name: String,\n}\n// 文件夹节点结构\nstruct FolderNode {\n    name: String,\n    contents: Vec<Box<Node>>, // 使用 Box<Node> 存储子节点\n}\nimpl FileSystem for FolderNode {\n    fn create_file(&mut self, name: &str) -> Result<(), String> {\n        // 检查是否同名节点已存在\n        // *node 对 &Box<Node> 解引用得到 Box<Node>\n        // **node 对 Box<Node> 解引用得到 Node 值\n        // &**Node 取得对 Node 的引用（&Node），为了避免所有权的移动\n        if self.contents.iter().any(|node| match &**node {\n            Node::File(f) => f.name == name,\n            Node::Folder(f) => f.name == name,\n        }) {\n            return Err(\"Name already exists\".to_string());\n        }\n        // 创建新文件\n        self.contents.push(Box::new(Node::File(FileNode {\n            name: name.to_string(),\n        })));\n        Ok(())\n    }\n\n    fn create_folder(&mut self, name: &str) -> Result<(), String> {\n        // 检查是否同名节点已存在\n        if self.contents.iter().any(|node| match &**node {\n            Node::File(f) => f.name == name,\n            Node::Folder(f) => f.name == name,\n        }) {\n            return Err(\"Name already exists\".to_string());\n        }\n        // 创建新文件夹\n        self.contents.push(Box::new(Node::Folder(FolderNode {\n            name: name.to_string(),\n            contents: Vec::new(),\n        })));\n        Ok(())\n    }\n\nfn list_contents(&self, indent: usize) {\n        // 递归列出所有内容\n        // .iter() 遍历 self.contents 中的每个元素（&Box<Node> 类型）\n        // .enumerate() 会将迭代器转换为新的迭代器，新迭代器产生元组 (index, item)\n        for (i, node) in self.contents.iter().enumerate() {\n            let is_last = i == self.contents.len() - 1;\n            let prefix = if is_last { \"└──\" } else { \"├──\" };\n            let item_indent = indent + 2;\n\n            match &**node {\n                // {:indent$} 功能：创建指定数量的空格缩进\n                // indent$ 是一个 ​​命名参数占位符\n                // indents 的值为 item_indent\n                Node::File(file) => println!(\n                    \"{:indent$}{} {} (File)\",\n                    \"\",\n                    prefix,\n                    file.name,\n                    indent = item_indent\n                ),\n                Node::Folder(folder) => {\n                    // 打印子文件夹名称作为父文件夹的子项\n                    println!(\n                        \"{:indent$}{} {} (Folder)\",\n                        \"\",\n                        prefix,\n                        folder.name,\n                        indent = item_indent\n                    );\n                    folder.list_contents(item_indent + 2);\n                }\n            }\n        }\n    }\n}\n\nfn main() {\n    // 创建根文件夹\n    let mut root = FolderNode {\n        name: \"Root\".to_string(),\n        contents: Vec::new(),\n    };\n    // 在根目录添加文件和文件夹\n    // 使用 .unwrap() 使得出现错误后 painc 退出程序\n    root.create_file(\"document.txt\").unwrap();\n    root.create_folder(\"Pictures\").unwrap();\n    root.create_folder(\"Music\").unwrap();\n    // 在 Pictures 文件夹中添加文件\n    // .iter_mut() 获取集合的​​可变引用迭代器\n    // matches! 宏检查是否匹配模式（名字为 Pictures 的文件夹\n    // .map() 将 &mut Box<Node> 类型转为 &mut Node 类型\n    // pictures 的类型为 &mut FolderNode\n    if let Some(Node::Folder(pictures)) = root\n        .contents\n        .iter_mut()\n        .find(|n| matches!(&***n, Node::Folder(f) if f.name == \"Pictures\"))\n        .map(|n| &mut **n)\n    {\n        pictures.create_file(\"photo1.jpg\").unwrap();\n        pictures.create_file(\"photo2.jpg\").unwrap();\n    }\n    // 在 Music 文件夹中添加文件\n    if let Some(Node::Folder(music)) = root\n        .contents\n        .iter_mut()\n        .find(|n| matches!(&***n, Node::Folder(f) if f.name == \"Music\"))\n        .map(|n| &mut **n)\n    {\n        music.create_file(\"song1.mp3\").unwrap();\n        music.create_folder(\"Classical\").unwrap();\n    }\n    // 列出整个文件系统结构\n    println!(\"File System Structure:\");\n    root.list_contents(0);\n}\n```\n","source":"_posts/74-IB-Rust-智能指针-box.md","raw":"---\ntitle: IB-Rust-智能指针&box\ndate: 2025-06-04 13:18:38\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson16](https://github.com/Zoella-w/IB-Rust/tree/main/16_smart_pointer_box)\n\n## 智能指针\n\n### 智能指针概述\n\n智能指针（Smart Pointers）是一类数据结构，不仅包含一个指针，还附带一些额外的元数据和功能。智能指针实现了 `Deref` 和 `Drop` 两个 trait，使得它们可以像指针一样解引用并在离开作用域时自动清理资源\n\n### 智能指针作用\n\n- 资源管理\n  - 自动管理资源的分配和释放，避免内存泄漏\n- 所有权与借用\n  - Rust 的所有权系统通过智能指针来确保内存安全，避免数据竞争和悬垂指针\n- 复杂数据结构\n  - 通过智能指针可以构建复杂的数据结构，如递归结构、共享数据等\n\n## `BOX<T>`\n\n- `Box<T>` 将类型 T 的值分配在堆上，而不是栈上\n- 当 Box 被销毁时，堆上的数据也会被销毁\n\n### Box 的底层实现\n\n- 底层原理\n  - `Box<T>` 实际上是一个智能指针，内部包含一个指向堆上分配内存的裸指针\n  - 当 `Box<T>` 被销毁时，其 `Drop` trait 会被调用，释放堆上的内存\n- 内存分配\n  - Rust 使用系统的全局分配器（如 malloc 和 free）来管理堆内存\n  - Box::new 分配内存，Drop 释放内存\n- 安全性\n  - Rust 的所有权系统确保 `Box<T>` 的内存安全。所有权转移时，堆内存的生命周期也会随之变化\n\n### Box 的使用场景\n\n#### 堆分配\n   \nBox 最常见的用途是将数据分配在堆上，而不是栈上。这在处理较大数据结构、或数据结构的大小在编译时不确定时尤为重要\n\n```rust\nlet b = Box::new(5);\nprintln!(\"b = {}\", b);\n```\n\n#### 动态大小类型（DST）\n\nBox 允许处理动态大小类型，如 `str` 和 `[T]`\n\n```rust\nlet s: Box<str> = \"Hello, world!\".into();\nprintln!(\"s = {}\", s);\nlet arr: Box<[i32]> = vec![1, 2, 3, 4, 5].into_boxed_slice();\nprintln!(\"arr = {:?}\", arr);\n```\n\n#### 递归数据结构\n\n递归数据结构需要指针类型引用自身，而 Box 提供了这一功能\n\n```rust\nenum List {\n    Cons(i32, Box<List>),\n    Nil,\n}\nuse List::{Cons, Nil};\nfn main() {\n    let list = Cons(1, Box::new(Cons(2, Box::new(Cons(3, Box::new(Nil))))));\n}\n```\n\n#### 类型擦除\n\n`Box<dyn Trait>` 用于类型擦除，允许在运行时决定类型\n\n```rust\ntrait Animal {\n    fn speak(&self);\n}\nstruct Dog;\nstruct Cat;\nimpl Animal for Dog {\n    fn speak(&self) {\n        println!(\"Woof!\");\n    }\n}\nimpl Animal for Cat {\n    fn speak(&self) {\n        println!(\"Meow!\");\n    }\n}\nfn main() {\n    let animals: Vec<Box<dyn Animal>> = vec![Box::new(Dog), Box::new(Cat)];\n    for animal in animals.iter() {\n        animal.speak();\n    }\n}\n```\n\n### `dyn` 关键字\n\n`dyn` 关键字用于指定动态分发的类型，允许在运行时决定具体类型，可用于实现动态分发的 trait 对象\n\n### 内存管理和性能优化\n\n通过使用 Box，可以控制内存的分配和释放，从而优化性能和内存使用。例如，将大型数据结构放在堆上，而不是栈上，从而避免栈溢出\n\n```rust\nlet large_array = Box::new([0u8; 1_000_000]);\nprintln!(\"Large array allocated on the heap.\");\n```\n\n## Box 的优缺点\n\n- 优点\n  - 提供堆内存分配，支持复杂数据结构\n  - 与 Rust 的所有权系统完美集成，确保内存安全\n  - 动态分配对象，实现类型擦除\n- 缺点\n  - 需要堆内存分配和释放，可能带来性能开销\n  - 不适合需要频繁分配和释放的场景\n\n## Drop、Derefb 和 DerefMut\n\n- `Drop` Trait\n  - `Drop` trait 定义了当一个值离开作用域时应该执行的操作\n  - 例如：`Box<T>` 在超出作用域时会自动调用其 Drop trait，释放堆上的内存\n- `Deref` Trait\n  - `Deref` trait 定义了如何将一个类型转换为引用\n  - 例如：`Box<T>` 实现了 Deref，所以可以通过 * 运算符解引用获取其内部数据\n\n### `Drop` Trait\n\n`Drop` trait 用于自定义当值离开作用域时执行的代码，通常用于释放资源（例如内存、文件句柄、网络连接等）\n\n#### 定义和实现\n\n`Drop` trait 定义了一个 drop 方法，当值被释放时，Rust 会自动调用这个方法\n\n```rust\npub trait Drop {\n  fn drop(&mut self);\n}\n```\n\n```rust\nstruct Resource {\n    name: String,\n}\n// 正确实现标准库的 Drop trait\nimpl Drop for Resource {\n    fn drop(&mut self) {\n        println!(\"{} is dropped\", self.name);\n    }\n}\nfn box_study() {\n    let _r1 = Resource {\n        name: \"r1\".to_string(),\n    };\n    {\n        let _r2 = Resource {\n            name: \"r2\".to_string(),\n        };\n    }  // r2 在这里离开作用域\n}  // r1 在这里离开作用域\nfn main() {\n    box_study();\n}\n```\n\n### `Deref` Trait\n\n`Deref` trait 用于重载解引用运算符（*），允许定义自定义指针类型的解引用行为\n\n#### 定义和实现\n\n`Deref` trait 定义了一个 deref 方法，该方法返回指向目标类型的引用\n\n```rust\npub trait Deref {\n  type Target: ?Sized;\n  fn deref(&self) -> &Self::Target;\n}\n```\n```rust\nuse std::ops::Deref;\nfn main() {\n  let x = 5;\n  let y = MyBox::new(x);\n  println!(\"x = {}\", x);\n  // 触发解引用运算符重载\n  // 等价于 *(y.deref())（编译器自动转换）\n  println!(\"y = {}\", *y);\n}\nstruct MyBox<T>(T);\n// 构造函数实现\nimpl<T> MyBox<T> {\n    fn new(x: T) -> MyBox<T> {\n        MyBox(x)\n    }\n}\nimpl<T> Deref for MyBox<T> {\n  // 关联类型\n  type Target = T;\n  fn deref(&self) -> &T {\n    println!(\"deref called\");\n    // 访问元组结构体的第一个字段\n    &self.0\n  }\n}\n```\n\n### `DerefMut` Trait\n\n与 Deref 类似，DerefMut 用于重载可变解引用运算符（*），允许对自定义类型进行可变解引用\n\n#### 定义和实现\n\n```rust\npub trait DerefMut: Deref {\n  fn deref_mut(&mut self) -> &mut Self::Target;\n}\n```\n\n```rust\nimpl<T> DerefMut for MyBox<T> {\n  fn deref_mut(&mut self) -> &mut Self::Target {\n    println!(\"deref called\");\n    // 访问元组结构体的第一个字段\n    &mut self.0\n  }\n}\n```\n\n## 课后作业\n\n### 作业 1: 内存管理和性能优化\n\n创建一个大型数组并将其分配到堆上，然后测量和比较分配在堆和栈上的性能差异。\n\n创建一个包含 1_000_000 个元素的数组，分别将其分配在堆和栈上。使用 `std::time::Instant` 来测量分配和访问时间。\n\n```rust\nuse std::time::Instant;\n\nfn main() {\n  test_stack_allocation();\n  test_heap_allocation();\n}\n\nfn test_stack_allocation() {\n  // 栈上分配测试 (1,000,000 个整数)\n  let n = 1_000_000;\n  // 分配\n  let start = Instant::now();\n  let mut arr: [u32; 1_000_000] = [0; 1_000_000]; // 改用u32避免负数问题\n  let duration = start.elapsed();\n  println!(\"分配时间: {:?}\", duration); // 分配时间: 58.75µs\n  // 写入\n  let start = Instant::now();\n  for i in 0..n {\n      arr[i] = i as u32;\n  }\n  let duration = start.elapsed();\n  println!(\"写入时间: {:?}\", duration); // 写入时间: 7.7795ms\n  // 读取和求和\n  let start = Instant::now();\n  let mut sum: u64 = 0; // 使用u64来容纳大数字\n  for i in 0..n {\n      sum += arr[i] as u64; // 将每个元素转为u64\n  }\n  let duration = start.elapsed();\n  println!(\"读取时间: {:?}\\n\", duration); // 读取时间: 7.601417ms\n}\n\nfn test_heap_allocation() {\n  // 堆上分配测试 (1,000,000 个整数)\n  let n = 1_000_000;\n  // 分配\n  let start = Instant::now();\n  let mut arr = Box::new([0u32; 1_000_000]); // 明确类型为u32\n  let duration = start.elapsed();\n  println!(\"分配时间: {:?}\", duration); // 分配时间: 421.75µs\n  // 写入\n  let start = Instant::now();\n  for i in 0..n {\n      arr[i] = i as u32;\n  }\n  let duration = start.elapsed();\n  println!(\"写入时间: {:?}\", duration); // 写入时间: 6.979958ms\n  // 读取和求和\n  let start = Instant::now();\n  let mut sum: u64 = 0;\n  for i in 0..n {\n      sum += arr[i] as u64;\n  }\n  let duration = start.elapsed();\n  println!(\"读取时间: {:?}\", duration); // 读取时间: 7.15825ms\n}\n```\n\n### 作业2：实现一个简单的文件系统模拟\n\n- 目标\n实现一个简单的文件系统模拟，其中包含文件和文件夹的概念。文件夹可以包含文件和其他文件夹。使用 Box 来管理内存，并实现对文件系统的基本操作（如创建文件、创建文件夹、列出文件和文件夹）。\n\n- 作业要求\n  - 定义 `FileSystem` trait 和 Node 枚举\n    - `FileSystem` trait 包含 `create_file`、`create_folder` 和 `list_contents` 方法。\n    - `Node` 枚举包含 `File` 和 `Folder` 变体。\n  - 实现 `FolderNode` 结构体\n    - `FolderNode` 实现 `FileSystem` trait，包含 `name` 和 `contents` 字段。\n    - 使用 `Box` 管理 `contents` 中的子节点。\n  - 实现文件系统的基本操作\n    - `create_file` 方法在文件夹中创建文件。\n    - `create_folder` 方法在文件夹中创建子文件夹。\n    - `list_contents` 方法列出文件夹的所有内容。\n  - 测试文件系统的操作\n    - 创建根文件夹并添加文件和文件夹。\n    - 创建子文件夹并添加文件。\n    - 列出文件夹的内容并输出文件系统结构。\n- 提示\n使用 `Box` 来管理 `Folder` 中的子节点。\n使用递归方法来遍历和列出文件和文件夹的内容。\n考虑使用 `Vec` 来存储文件夹的子节点。\n\n```rust\ntrait FileSystem {\n    fn create_file(&mut self, name: &str) -> Result<(), String>;\n    fn create_folder(&mut self, name: &str) -> Result<(), String>;\n    fn list_contents(&self, indent: usize);\n}\n// 定义 Node 枚举，包含：文件节点 和 文件夹节点\nenum Node {\n    // File 和 Folder 是变体的名称\n    // (FileNode) 和 (FolderNode) 是变体关联的数据类型\n    File(FileNode),\n    Folder(FolderNode),\n}\n// 文件节点结构\nstruct FileNode {\n    name: String,\n}\n// 文件夹节点结构\nstruct FolderNode {\n    name: String,\n    contents: Vec<Box<Node>>, // 使用 Box<Node> 存储子节点\n}\nimpl FileSystem for FolderNode {\n    fn create_file(&mut self, name: &str) -> Result<(), String> {\n        // 检查是否同名节点已存在\n        // *node 对 &Box<Node> 解引用得到 Box<Node>\n        // **node 对 Box<Node> 解引用得到 Node 值\n        // &**Node 取得对 Node 的引用（&Node），为了避免所有权的移动\n        if self.contents.iter().any(|node| match &**node {\n            Node::File(f) => f.name == name,\n            Node::Folder(f) => f.name == name,\n        }) {\n            return Err(\"Name already exists\".to_string());\n        }\n        // 创建新文件\n        self.contents.push(Box::new(Node::File(FileNode {\n            name: name.to_string(),\n        })));\n        Ok(())\n    }\n\n    fn create_folder(&mut self, name: &str) -> Result<(), String> {\n        // 检查是否同名节点已存在\n        if self.contents.iter().any(|node| match &**node {\n            Node::File(f) => f.name == name,\n            Node::Folder(f) => f.name == name,\n        }) {\n            return Err(\"Name already exists\".to_string());\n        }\n        // 创建新文件夹\n        self.contents.push(Box::new(Node::Folder(FolderNode {\n            name: name.to_string(),\n            contents: Vec::new(),\n        })));\n        Ok(())\n    }\n\nfn list_contents(&self, indent: usize) {\n        // 递归列出所有内容\n        // .iter() 遍历 self.contents 中的每个元素（&Box<Node> 类型）\n        // .enumerate() 会将迭代器转换为新的迭代器，新迭代器产生元组 (index, item)\n        for (i, node) in self.contents.iter().enumerate() {\n            let is_last = i == self.contents.len() - 1;\n            let prefix = if is_last { \"└──\" } else { \"├──\" };\n            let item_indent = indent + 2;\n\n            match &**node {\n                // {:indent$} 功能：创建指定数量的空格缩进\n                // indent$ 是一个 ​​命名参数占位符\n                // indents 的值为 item_indent\n                Node::File(file) => println!(\n                    \"{:indent$}{} {} (File)\",\n                    \"\",\n                    prefix,\n                    file.name,\n                    indent = item_indent\n                ),\n                Node::Folder(folder) => {\n                    // 打印子文件夹名称作为父文件夹的子项\n                    println!(\n                        \"{:indent$}{} {} (Folder)\",\n                        \"\",\n                        prefix,\n                        folder.name,\n                        indent = item_indent\n                    );\n                    folder.list_contents(item_indent + 2);\n                }\n            }\n        }\n    }\n}\n\nfn main() {\n    // 创建根文件夹\n    let mut root = FolderNode {\n        name: \"Root\".to_string(),\n        contents: Vec::new(),\n    };\n    // 在根目录添加文件和文件夹\n    // 使用 .unwrap() 使得出现错误后 painc 退出程序\n    root.create_file(\"document.txt\").unwrap();\n    root.create_folder(\"Pictures\").unwrap();\n    root.create_folder(\"Music\").unwrap();\n    // 在 Pictures 文件夹中添加文件\n    // .iter_mut() 获取集合的​​可变引用迭代器\n    // matches! 宏检查是否匹配模式（名字为 Pictures 的文件夹\n    // .map() 将 &mut Box<Node> 类型转为 &mut Node 类型\n    // pictures 的类型为 &mut FolderNode\n    if let Some(Node::Folder(pictures)) = root\n        .contents\n        .iter_mut()\n        .find(|n| matches!(&***n, Node::Folder(f) if f.name == \"Pictures\"))\n        .map(|n| &mut **n)\n    {\n        pictures.create_file(\"photo1.jpg\").unwrap();\n        pictures.create_file(\"photo2.jpg\").unwrap();\n    }\n    // 在 Music 文件夹中添加文件\n    if let Some(Node::Folder(music)) = root\n        .contents\n        .iter_mut()\n        .find(|n| matches!(&***n, Node::Folder(f) if f.name == \"Music\"))\n        .map(|n| &mut **n)\n    {\n        music.create_file(\"song1.mp3\").unwrap();\n        music.create_folder(\"Classical\").unwrap();\n    }\n    // 列出整个文件系统结构\n    println!(\"File System Structure:\");\n    root.list_contents(0);\n}\n```\n","slug":"74-IB-Rust-智能指针-box","published":1,"updated":"2025-06-05T15:37:26.139Z","_id":"cmbjgndec00003fpr53lzbelx","comments":1,"layout":"post","photos":[],"link":"","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/16_smart_pointer_box\" >Codes in lesson16<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"智能指针\"><a href=\"#智能指针\" class=\"headerlink\" title=\"智能指针\"></a>智能指针</h2><h3 id=\"智能指针概述\"><a href=\"#智能指针概述\" class=\"headerlink\" title=\"智能指针概述\"></a>智能指针概述</h3><p>智能指针（Smart Pointers）是一类数据结构，不仅包含一个指针，还附带一些额外的元数据和功能。智能指针实现了 <code>Deref</code> 和 <code>Drop</code> 两个 trait，使得它们可以像指针一样解引用并在离开作用域时自动清理资源</p>\n<h3 id=\"智能指针作用\"><a href=\"#智能指针作用\" class=\"headerlink\" title=\"智能指针作用\"></a>智能指针作用</h3><ul>\n<li>资源管理<ul>\n<li>自动管理资源的分配和释放，避免内存泄漏</li>\n</ul>\n</li>\n<li>所有权与借用<ul>\n<li>Rust 的所有权系统通过智能指针来确保内存安全，避免数据竞争和悬垂指针</li>\n</ul>\n</li>\n<li>复杂数据结构<ul>\n<li>通过智能指针可以构建复杂的数据结构，如递归结构、共享数据等</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"BOX\"><a href=\"#BOX\" class=\"headerlink\" title=\"BOX&lt;T&gt;\"></a><code>BOX&lt;T&gt;</code></h2><ul>\n<li><code>Box&lt;T&gt;</code> 将类型 T 的值分配在堆上，而不是栈上</li>\n<li>当 Box 被销毁时，堆上的数据也会被销毁</li>\n</ul>\n<h3 id=\"Box-的底层实现\"><a href=\"#Box-的底层实现\" class=\"headerlink\" title=\"Box 的底层实现\"></a>Box 的底层实现</h3><ul>\n<li>底层原理<ul>\n<li><code>Box&lt;T&gt;</code> 实际上是一个智能指针，内部包含一个指向堆上分配内存的裸指针</li>\n<li>当 <code>Box&lt;T&gt;</code> 被销毁时，其 <code>Drop</code> trait 会被调用，释放堆上的内存</li>\n</ul>\n</li>\n<li>内存分配<ul>\n<li>Rust 使用系统的全局分配器（如 malloc 和 free）来管理堆内存</li>\n<li>Box::new 分配内存，Drop 释放内存</li>\n</ul>\n</li>\n<li>安全性<ul>\n<li>Rust 的所有权系统确保 <code>Box&lt;T&gt;</code> 的内存安全。所有权转移时，堆内存的生命周期也会随之变化</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Box-的使用场景\"><a href=\"#Box-的使用场景\" class=\"headerlink\" title=\"Box 的使用场景\"></a>Box 的使用场景</h3><h4 id=\"堆分配\"><a href=\"#堆分配\" class=\"headerlink\" title=\"堆分配\"></a>堆分配</h4><p>Box 最常见的用途是将数据分配在堆上，而不是栈上。这在处理较大数据结构、或数据结构的大小在编译时不确定时尤为重要</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">b</span> = <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(<span class=\"number\">5</span>);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;b = &#123;&#125;&quot;</span>, b);</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"动态大小类型（DST）\"><a href=\"#动态大小类型（DST）\" class=\"headerlink\" title=\"动态大小类型（DST）\"></a>动态大小类型（DST）</h4><p>Box 允许处理动态大小类型，如 <code>str</code> 和 <code>[T]</code></p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span>: <span class=\"type\">Box</span>&lt;<span class=\"type\">str</span>&gt; = <span class=\"string\">&quot;Hello, world!&quot;</span>.<span class=\"title function_ invoke__\">into</span>();</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;s = &#123;&#125;&quot;</span>, s);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">arr</span>: <span class=\"type\">Box</span>&lt;[<span class=\"type\">i32</span>]&gt; = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>].<span class=\"title function_ invoke__\">into_boxed_slice</span>();</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;arr = &#123;:?&#125;&quot;</span>, arr);</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"递归数据结构\"><a href=\"#递归数据结构\" class=\"headerlink\" title=\"递归数据结构\"></a>递归数据结构</h4><p>递归数据结构需要指针类型引用自身，而 Box 提供了这一功能</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">List</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Cons</span>(<span class=\"type\">i32</span>, <span class=\"type\">Box</span>&lt;List&gt;),</span><br><span class=\"line\">    Nil,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">use</span> List::&#123;Cons, Nil&#125;;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">list</span> = <span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">1</span>, <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(<span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">2</span>, <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(<span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">3</span>, <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(Nil))))));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"类型擦除\"><a href=\"#类型擦除\" class=\"headerlink\" title=\"类型擦除\"></a>类型擦除</h4><p><code>Box&lt;dyn Trait&gt;</code> 用于类型擦除，允许在运行时决定类型</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">trait</span> <span class=\"title class_\">Animal</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">speak</span>(&amp;<span class=\"keyword\">self</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Dog</span>;</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Cat</span>;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Animal</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Dog</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">speak</span>(&amp;<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Woof!&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Animal</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Cat</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">speak</span>(&amp;<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Meow!&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">animals</span>: <span class=\"type\">Vec</span>&lt;<span class=\"type\">Box</span>&lt;<span class=\"keyword\">dyn</span> Animal&gt;&gt; = <span class=\"built_in\">vec!</span>[<span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(Dog), <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(Cat)];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"variable\">animal</span> <span class=\"keyword\">in</span> animals.<span class=\"title function_ invoke__\">iter</span>() &#123;</span><br><span class=\"line\">        animal.<span class=\"title function_ invoke__\">speak</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"dyn-关键字\"><a href=\"#dyn-关键字\" class=\"headerlink\" title=\"dyn 关键字\"></a><code>dyn</code> 关键字</h3><p><code>dyn</code> 关键字用于指定动态分发的类型，允许在运行时决定具体类型，可用于实现动态分发的 trait 对象</p>\n<h3 id=\"内存管理和性能优化\"><a href=\"#内存管理和性能优化\" class=\"headerlink\" title=\"内存管理和性能优化\"></a>内存管理和性能优化</h3><p>通过使用 Box，可以控制内存的分配和释放，从而优化性能和内存使用。例如，将大型数据结构放在堆上，而不是栈上，从而避免栈溢出</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">large_array</span> = <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>([<span class=\"number\">0u8</span>; <span class=\"number\">1_000_000</span>]);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Large array allocated on the heap.&quot;</span>);</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"Box-的优缺点\"><a href=\"#Box-的优缺点\" class=\"headerlink\" title=\"Box 的优缺点\"></a>Box 的优缺点</h2><ul>\n<li>优点<ul>\n<li>提供堆内存分配，支持复杂数据结构</li>\n<li>与 Rust 的所有权系统完美集成，确保内存安全</li>\n<li>动态分配对象，实现类型擦除</li>\n</ul>\n</li>\n<li>缺点<ul>\n<li>需要堆内存分配和释放，可能带来性能开销</li>\n<li>不适合需要频繁分配和释放的场景</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Drop、Derefb-和-DerefMut\"><a href=\"#Drop、Derefb-和-DerefMut\" class=\"headerlink\" title=\"Drop、Derefb 和 DerefMut\"></a>Drop、Derefb 和 DerefMut</h2><ul>\n<li><code>Drop</code> Trait<ul>\n<li><code>Drop</code> trait 定义了当一个值离开作用域时应该执行的操作</li>\n<li>例如：<code>Box&lt;T&gt;</code> 在超出作用域时会自动调用其 Drop trait，释放堆上的内存</li>\n</ul>\n</li>\n<li><code>Deref</code> Trait<ul>\n<li><code>Deref</code> trait 定义了如何将一个类型转换为引用</li>\n<li>例如：<code>Box&lt;T&gt;</code> 实现了 Deref，所以可以通过 * 运算符解引用获取其内部数据</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Drop-Trait\"><a href=\"#Drop-Trait\" class=\"headerlink\" title=\"Drop Trait\"></a><code>Drop</code> Trait</h3><p><code>Drop</code> trait 用于自定义当值离开作用域时执行的代码，通常用于释放资源（例如内存、文件句柄、网络连接等）</p>\n<h4 id=\"定义和实现\"><a href=\"#定义和实现\" class=\"headerlink\" title=\"定义和实现\"></a>定义和实现</h4><p><code>Drop</code> trait 定义了一个 drop 方法，当值被释放时，Rust 会自动调用这个方法</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">trait</span> <span class=\"title class_\">Drop</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">fn</span> <span class=\"title function_\">drop</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Resource</span> &#123;</span><br><span class=\"line\">    name: <span class=\"type\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 正确实现标准库的 Drop trait</span></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Drop</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Resource</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">drop</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125; is dropped&quot;</span>, <span class=\"keyword\">self</span>.name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">box_study</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">_r1</span> = Resource &#123;</span><br><span class=\"line\">        name: <span class=\"string\">&quot;r1&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"variable\">_r2</span> = Resource &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&quot;r2&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;  <span class=\"comment\">// r2 在这里离开作用域</span></span><br><span class=\"line\">&#125;  <span class=\"comment\">// r1 在这里离开作用域</span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">box_study</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"Deref-Trait\"><a href=\"#Deref-Trait\" class=\"headerlink\" title=\"Deref Trait\"></a><code>Deref</code> Trait</h3><p><code>Deref</code> trait 用于重载解引用运算符（*），允许定义自定义指针类型的解引用行为</p>\n<h4 id=\"定义和实现-1\"><a href=\"#定义和实现-1\" class=\"headerlink\" title=\"定义和实现\"></a>定义和实现</h4><p><code>Deref</code> trait 定义了一个 deref 方法，该方法返回指向目标类型的引用</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">trait</span> <span class=\"title class_\">Deref</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">type</span> <span class=\"title class_\">Target</span>: ?<span class=\"built_in\">Sized</span>;</span><br><span class=\"line\">  <span class=\"keyword\">fn</span> <span class=\"title function_\">deref</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"keyword\">Self</span>::Target;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::ops::Deref;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">x</span> = <span class=\"number\">5</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">y</span> = MyBox::<span class=\"title function_ invoke__\">new</span>(x);</span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;x = &#123;&#125;&quot;</span>, x);</span><br><span class=\"line\">  <span class=\"comment\">// 触发解引用运算符重载</span></span><br><span class=\"line\">  <span class=\"comment\">// 等价于 *(y.deref())（编译器自动转换）</span></span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;y = &#123;&#125;&quot;</span>, *y);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">MyBox</span>&lt;T&gt;(T);</span><br><span class=\"line\"><span class=\"comment\">// 构造函数实现</span></span><br><span class=\"line\"><span class=\"keyword\">impl</span>&lt;T&gt; MyBox&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">new</span>(x: T) <span class=\"punctuation\">-&gt;</span> MyBox&lt;T&gt; &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">MyBox</span>(x)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span>&lt;T&gt; Deref <span class=\"keyword\">for</span> <span class=\"title class_\">MyBox</span>&lt;T&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 关联类型</span></span><br><span class=\"line\">  <span class=\"keyword\">type</span> <span class=\"title class_\">Target</span> = T;</span><br><span class=\"line\">  <span class=\"keyword\">fn</span> <span class=\"title function_\">deref</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> &amp;T &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;deref called&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 访问元组结构体的第一个字段</span></span><br><span class=\"line\">    &amp;<span class=\"keyword\">self</span>.<span class=\"number\">0</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"DerefMut-Trait\"><a href=\"#DerefMut-Trait\" class=\"headerlink\" title=\"DerefMut Trait\"></a><code>DerefMut</code> Trait</h3><p>与 Deref 类似，DerefMut 用于重载可变解引用运算符（*），允许对自定义类型进行可变解引用</p>\n<h4 id=\"定义和实现-2\"><a href=\"#定义和实现-2\" class=\"headerlink\" title=\"定义和实现\"></a>定义和实现</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">trait</span> <span class=\"title class_\">DerefMut</span>: Deref &#123;</span><br><span class=\"line\">  <span class=\"keyword\">fn</span> <span class=\"title function_\">deref_mut</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">Self</span>::Target;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">impl</span>&lt;T&gt; DerefMut <span class=\"keyword\">for</span> <span class=\"title class_\">MyBox</span>&lt;T&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">fn</span> <span class=\"title function_\">deref_mut</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">Self</span>::Target &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;deref called&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 访问元组结构体的第一个字段</span></span><br><span class=\"line\">    &amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>.<span class=\"number\">0</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"课后作业\"><a href=\"#课后作业\" class=\"headerlink\" title=\"课后作业\"></a>课后作业</h2><h3 id=\"作业-1-内存管理和性能优化\"><a href=\"#作业-1-内存管理和性能优化\" class=\"headerlink\" title=\"作业 1: 内存管理和性能优化\"></a>作业 1: 内存管理和性能优化</h3><p>创建一个大型数组并将其分配到堆上，然后测量和比较分配在堆和栈上的性能差异。</p>\n<p>创建一个包含 1_000_000 个元素的数组，分别将其分配在堆和栈上。使用 <code>std::time::Instant</code> 来测量分配和访问时间。</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::time::Instant;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">  <span class=\"title function_ invoke__\">test_stack_allocation</span>();</span><br><span class=\"line\">  <span class=\"title function_ invoke__\">test_heap_allocation</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">test_stack_allocation</span>() &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 栈上分配测试 (1,000,000 个整数)</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">n</span> = <span class=\"number\">1_000_000</span>;</span><br><span class=\"line\">  <span class=\"comment\">// 分配</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">start</span> = Instant::<span class=\"title function_ invoke__\">now</span>();</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">arr</span>: [<span class=\"type\">u32</span>; <span class=\"number\">1_000_000</span>] = [<span class=\"number\">0</span>; <span class=\"number\">1_000_000</span>]; <span class=\"comment\">// 改用u32避免负数问题</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">duration</span> = start.<span class=\"title function_ invoke__\">elapsed</span>();</span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;分配时间: &#123;:?&#125;&quot;</span>, duration); <span class=\"comment\">// 分配时间: 58.75µs</span></span><br><span class=\"line\">  <span class=\"comment\">// 写入</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">start</span> = Instant::<span class=\"title function_ invoke__\">now</span>();</span><br><span class=\"line\">  <span class=\"keyword\">for</span> <span class=\"variable\">i</span> <span class=\"keyword\">in</span> <span class=\"number\">0</span>..n &#123;</span><br><span class=\"line\">      arr[i] = i <span class=\"keyword\">as</span> <span class=\"type\">u32</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">duration</span> = start.<span class=\"title function_ invoke__\">elapsed</span>();</span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;写入时间: &#123;:?&#125;&quot;</span>, duration); <span class=\"comment\">// 写入时间: 7.7795ms</span></span><br><span class=\"line\">  <span class=\"comment\">// 读取和求和</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">start</span> = Instant::<span class=\"title function_ invoke__\">now</span>();</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">sum</span>: <span class=\"type\">u64</span> = <span class=\"number\">0</span>; <span class=\"comment\">// 使用u64来容纳大数字</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> <span class=\"variable\">i</span> <span class=\"keyword\">in</span> <span class=\"number\">0</span>..n &#123;</span><br><span class=\"line\">      sum += arr[i] <span class=\"keyword\">as</span> <span class=\"type\">u64</span>; <span class=\"comment\">// 将每个元素转为u64</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">duration</span> = start.<span class=\"title function_ invoke__\">elapsed</span>();</span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;读取时间: &#123;:?&#125;\\n&quot;</span>, duration); <span class=\"comment\">// 读取时间: 7.601417ms</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">test_heap_allocation</span>() &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 堆上分配测试 (1,000,000 个整数)</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">n</span> = <span class=\"number\">1_000_000</span>;</span><br><span class=\"line\">  <span class=\"comment\">// 分配</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">start</span> = Instant::<span class=\"title function_ invoke__\">now</span>();</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">arr</span> = <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>([<span class=\"number\">0u32</span>; <span class=\"number\">1_000_000</span>]); <span class=\"comment\">// 明确类型为u32</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">duration</span> = start.<span class=\"title function_ invoke__\">elapsed</span>();</span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;分配时间: &#123;:?&#125;&quot;</span>, duration); <span class=\"comment\">// 分配时间: 421.75µs</span></span><br><span class=\"line\">  <span class=\"comment\">// 写入</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">start</span> = Instant::<span class=\"title function_ invoke__\">now</span>();</span><br><span class=\"line\">  <span class=\"keyword\">for</span> <span class=\"variable\">i</span> <span class=\"keyword\">in</span> <span class=\"number\">0</span>..n &#123;</span><br><span class=\"line\">      arr[i] = i <span class=\"keyword\">as</span> <span class=\"type\">u32</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">duration</span> = start.<span class=\"title function_ invoke__\">elapsed</span>();</span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;写入时间: &#123;:?&#125;&quot;</span>, duration); <span class=\"comment\">// 写入时间: 6.979958ms</span></span><br><span class=\"line\">  <span class=\"comment\">// 读取和求和</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">start</span> = Instant::<span class=\"title function_ invoke__\">now</span>();</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">sum</span>: <span class=\"type\">u64</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> <span class=\"variable\">i</span> <span class=\"keyword\">in</span> <span class=\"number\">0</span>..n &#123;</span><br><span class=\"line\">      sum += arr[i] <span class=\"keyword\">as</span> <span class=\"type\">u64</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">duration</span> = start.<span class=\"title function_ invoke__\">elapsed</span>();</span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;读取时间: &#123;:?&#125;&quot;</span>, duration); <span class=\"comment\">// 读取时间: 7.15825ms</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"作业2：实现一个简单的文件系统模拟\"><a href=\"#作业2：实现一个简单的文件系统模拟\" class=\"headerlink\" title=\"作业2：实现一个简单的文件系统模拟\"></a>作业2：实现一个简单的文件系统模拟</h3><ul>\n<li><p>目标<br>实现一个简单的文件系统模拟，其中包含文件和文件夹的概念。文件夹可以包含文件和其他文件夹。使用 Box 来管理内存，并实现对文件系统的基本操作（如创建文件、创建文件夹、列出文件和文件夹）。</p>\n</li>\n<li><p>作业要求</p>\n<ul>\n<li>定义 <code>FileSystem</code> trait 和 Node 枚举<ul>\n<li><code>FileSystem</code> trait 包含 <code>create_file</code>、<code>create_folder</code> 和 <code>list_contents</code> 方法。</li>\n<li><code>Node</code> 枚举包含 <code>File</code> 和 <code>Folder</code> 变体。</li>\n</ul>\n</li>\n<li>实现 <code>FolderNode</code> 结构体<ul>\n<li><code>FolderNode</code> 实现 <code>FileSystem</code> trait，包含 <code>name</code> 和 <code>contents</code> 字段。</li>\n<li>使用 <code>Box</code> 管理 <code>contents</code> 中的子节点。</li>\n</ul>\n</li>\n<li>实现文件系统的基本操作<ul>\n<li><code>create_file</code> 方法在文件夹中创建文件。</li>\n<li><code>create_folder</code> 方法在文件夹中创建子文件夹。</li>\n<li><code>list_contents</code> 方法列出文件夹的所有内容。</li>\n</ul>\n</li>\n<li>测试文件系统的操作<ul>\n<li>创建根文件夹并添加文件和文件夹。</li>\n<li>创建子文件夹并添加文件。</li>\n<li>列出文件夹的内容并输出文件系统结构。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>提示<br>使用 <code>Box</code> 来管理 <code>Folder</code> 中的子节点。<br>使用递归方法来遍历和列出文件和文件夹的内容。<br>考虑使用 <code>Vec</code> 来存储文件夹的子节点。</p>\n</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">trait</span> <span class=\"title class_\">FileSystem</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">create_file</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>, name: &amp;<span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;(), <span class=\"type\">String</span>&gt;;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">create_folder</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>, name: &amp;<span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;(), <span class=\"type\">String</span>&gt;;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">list_contents</span>(&amp;<span class=\"keyword\">self</span>, indent: <span class=\"type\">usize</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 定义 Node 枚举，包含：文件节点 和 文件夹节点</span></span><br><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Node</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// File 和 Folder 是变体的名称</span></span><br><span class=\"line\">    <span class=\"comment\">// (FileNode) 和 (FolderNode) 是变体关联的数据类型</span></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">File</span>(FileNode),</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Folder</span>(FolderNode),</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 文件节点结构</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">FileNode</span> &#123;</span><br><span class=\"line\">    name: <span class=\"type\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 文件夹节点结构</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">FolderNode</span> &#123;</span><br><span class=\"line\">    name: <span class=\"type\">String</span>,</span><br><span class=\"line\">    contents: <span class=\"type\">Vec</span>&lt;<span class=\"type\">Box</span>&lt;Node&gt;&gt;, <span class=\"comment\">// 使用 Box&lt;Node&gt; 存储子节点</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">FileSystem</span> <span class=\"keyword\">for</span> <span class=\"title class_\">FolderNode</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">create_file</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>, name: &amp;<span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;(), <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 检查是否同名节点已存在</span></span><br><span class=\"line\">        <span class=\"comment\">// *node 对 &amp;Box&lt;Node&gt; 解引用得到 Box&lt;Node&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">// **node 对 Box&lt;Node&gt; 解引用得到 Node 值</span></span><br><span class=\"line\">        <span class=\"comment\">// &amp;**Node 取得对 Node 的引用（&amp;Node），为了避免所有权的移动</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">self</span>.contents.<span class=\"title function_ invoke__\">iter</span>().<span class=\"title function_ invoke__\">any</span>(|node| <span class=\"keyword\">match</span> &amp;**node &#123;</span><br><span class=\"line\">            Node::<span class=\"title function_ invoke__\">File</span>(f) =&gt; f.name == name,</span><br><span class=\"line\">            Node::<span class=\"title function_ invoke__\">Folder</span>(f) =&gt; f.name == name,</span><br><span class=\"line\">        &#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">Err</span>(<span class=\"string\">&quot;Name already exists&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 创建新文件</span></span><br><span class=\"line\">        <span class=\"keyword\">self</span>.contents.<span class=\"title function_ invoke__\">push</span>(<span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(Node::<span class=\"title function_ invoke__\">File</span>(FileNode &#123;</span><br><span class=\"line\">            name: name.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">        &#125;)));</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">create_folder</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>, name: &amp;<span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;(), <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 检查是否同名节点已存在</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">self</span>.contents.<span class=\"title function_ invoke__\">iter</span>().<span class=\"title function_ invoke__\">any</span>(|node| <span class=\"keyword\">match</span> &amp;**node &#123;</span><br><span class=\"line\">            Node::<span class=\"title function_ invoke__\">File</span>(f) =&gt; f.name == name,</span><br><span class=\"line\">            Node::<span class=\"title function_ invoke__\">Folder</span>(f) =&gt; f.name == name,</span><br><span class=\"line\">        &#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">Err</span>(<span class=\"string\">&quot;Name already exists&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 创建新文件夹</span></span><br><span class=\"line\">        <span class=\"keyword\">self</span>.contents.<span class=\"title function_ invoke__\">push</span>(<span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(Node::<span class=\"title function_ invoke__\">Folder</span>(FolderNode &#123;</span><br><span class=\"line\">            name: name.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">            contents: <span class=\"type\">Vec</span>::<span class=\"title function_ invoke__\">new</span>(),</span><br><span class=\"line\">        &#125;)));</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">list_contents</span>(&amp;<span class=\"keyword\">self</span>, indent: <span class=\"type\">usize</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 递归列出所有内容</span></span><br><span class=\"line\">        <span class=\"comment\">// .iter() 遍历 self.contents 中的每个元素（&amp;Box&lt;Node&gt; 类型）</span></span><br><span class=\"line\">        <span class=\"comment\">// .enumerate() 会将迭代器转换为新的迭代器，新迭代器产生元组 (index, item)</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (i, node) <span class=\"keyword\">in</span> <span class=\"keyword\">self</span>.contents.<span class=\"title function_ invoke__\">iter</span>().<span class=\"title function_ invoke__\">enumerate</span>() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"variable\">is_last</span> = i == <span class=\"keyword\">self</span>.contents.<span class=\"title function_ invoke__\">len</span>() - <span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"variable\">prefix</span> = <span class=\"keyword\">if</span> is_last &#123; <span class=\"string\">&quot;└──&quot;</span> &#125; <span class=\"keyword\">else</span> &#123; <span class=\"string\">&quot;├──&quot;</span> &#125;;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"variable\">item_indent</span> = indent + <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">match</span> &amp;**node &#123;</span><br><span class=\"line\">                <span class=\"comment\">// &#123;:indent$&#125; 功能：创建指定数量的空格缩进</span></span><br><span class=\"line\">                <span class=\"comment\">// indent$ 是一个 ​​命名参数占位符</span></span><br><span class=\"line\">                <span class=\"comment\">// indents 的值为 item_indent</span></span><br><span class=\"line\">                Node::<span class=\"title function_ invoke__\">File</span>(file) =&gt; <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">                    <span class=\"string\">&quot;&#123;:indent$&#125;&#123;&#125; &#123;&#125; (File)&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">                    prefix,</span><br><span class=\"line\">                    file.name,</span><br><span class=\"line\">                    indent = item_indent</span><br><span class=\"line\">                ),</span><br><span class=\"line\">                Node::<span class=\"title function_ invoke__\">Folder</span>(folder) =&gt; &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 打印子文件夹名称作为父文件夹的子项</span></span><br><span class=\"line\">                    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">                        <span class=\"string\">&quot;&#123;:indent$&#125;&#123;&#125; &#123;&#125; (Folder)&quot;</span>,</span><br><span class=\"line\">                        <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">                        prefix,</span><br><span class=\"line\">                        folder.name,</span><br><span class=\"line\">                        indent = item_indent</span><br><span class=\"line\">                    );</span><br><span class=\"line\">                    folder.<span class=\"title function_ invoke__\">list_contents</span>(item_indent + <span class=\"number\">2</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 创建根文件夹</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">root</span> = FolderNode &#123;</span><br><span class=\"line\">        name: <span class=\"string\">&quot;Root&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">        contents: <span class=\"type\">Vec</span>::<span class=\"title function_ invoke__\">new</span>(),</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 在根目录添加文件和文件夹</span></span><br><span class=\"line\">    <span class=\"comment\">// 使用 .unwrap() 使得出现错误后 painc 退出程序</span></span><br><span class=\"line\">    root.<span class=\"title function_ invoke__\">create_file</span>(<span class=\"string\">&quot;document.txt&quot;</span>).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\">    root.<span class=\"title function_ invoke__\">create_folder</span>(<span class=\"string\">&quot;Pictures&quot;</span>).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\">    root.<span class=\"title function_ invoke__\">create_folder</span>(<span class=\"string\">&quot;Music&quot;</span>).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\">    <span class=\"comment\">// 在 Pictures 文件夹中添加文件</span></span><br><span class=\"line\">    <span class=\"comment\">// .iter_mut() 获取集合的​​可变引用迭代器</span></span><br><span class=\"line\">    <span class=\"comment\">// matches! 宏检查是否匹配模式（名字为 Pictures 的文件夹</span></span><br><span class=\"line\">    <span class=\"comment\">// .map() 将 &amp;mut Box&lt;Node&gt; 类型转为 &amp;mut Node 类型</span></span><br><span class=\"line\">    <span class=\"comment\">// pictures 的类型为 &amp;mut FolderNode</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Some</span>(Node::<span class=\"title function_ invoke__\">Folder</span>(pictures)) = root</span><br><span class=\"line\">        .contents</span><br><span class=\"line\">        .<span class=\"title function_ invoke__\">iter_mut</span>()</span><br><span class=\"line\">        .<span class=\"title function_ invoke__\">find</span>(|n| matches!(&amp;***n, Node::<span class=\"title function_ invoke__\">Folder</span>(f) <span class=\"keyword\">if</span> f.name == <span class=\"string\">&quot;Pictures&quot;</span>))</span><br><span class=\"line\">        .<span class=\"title function_ invoke__\">map</span>(|n| &amp;<span class=\"keyword\">mut</span> **n)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        pictures.<span class=\"title function_ invoke__\">create_file</span>(<span class=\"string\">&quot;photo1.jpg&quot;</span>).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\">        pictures.<span class=\"title function_ invoke__\">create_file</span>(<span class=\"string\">&quot;photo2.jpg&quot;</span>).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 在 Music 文件夹中添加文件</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Some</span>(Node::<span class=\"title function_ invoke__\">Folder</span>(music)) = root</span><br><span class=\"line\">        .contents</span><br><span class=\"line\">        .<span class=\"title function_ invoke__\">iter_mut</span>()</span><br><span class=\"line\">        .<span class=\"title function_ invoke__\">find</span>(|n| matches!(&amp;***n, Node::<span class=\"title function_ invoke__\">Folder</span>(f) <span class=\"keyword\">if</span> f.name == <span class=\"string\">&quot;Music&quot;</span>))</span><br><span class=\"line\">        .<span class=\"title function_ invoke__\">map</span>(|n| &amp;<span class=\"keyword\">mut</span> **n)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        music.<span class=\"title function_ invoke__\">create_file</span>(<span class=\"string\">&quot;song1.mp3&quot;</span>).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\">        music.<span class=\"title function_ invoke__\">create_folder</span>(<span class=\"string\">&quot;Classical&quot;</span>).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 列出整个文件系统结构</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;File System Structure:&quot;</span>);</span><br><span class=\"line\">    root.<span class=\"title function_ invoke__\">list_contents</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/16_smart_pointer_box\" >Codes in lesson16<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"智能指针\"><a href=\"#智能指针\" class=\"headerlink\" title=\"智能指针\"></a>智能指针</h2><h3 id=\"智能指针概述\"><a href=\"#智能指针概述\" class=\"headerlink\" title=\"智能指针概述\"></a>智能指针概述</h3><p>智能指针（Smart Pointers）是一类数据结构，不仅包含一个指针，还附带一些额外的元数据和功能。智能指针实现了 <code>Deref</code> 和 <code>Drop</code> 两个 trait，使得它们可以像指针一样解引用并在离开作用域时自动清理资源</p>\n<h3 id=\"智能指针作用\"><a href=\"#智能指针作用\" class=\"headerlink\" title=\"智能指针作用\"></a>智能指针作用</h3><ul>\n<li>资源管理<ul>\n<li>自动管理资源的分配和释放，避免内存泄漏</li>\n</ul>\n</li>\n<li>所有权与借用<ul>\n<li>Rust 的所有权系统通过智能指针来确保内存安全，避免数据竞争和悬垂指针</li>\n</ul>\n</li>\n<li>复杂数据结构<ul>\n<li>通过智能指针可以构建复杂的数据结构，如递归结构、共享数据等</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"BOX\"><a href=\"#BOX\" class=\"headerlink\" title=\"BOX&lt;T&gt;\"></a><code>BOX&lt;T&gt;</code></h2><ul>\n<li><code>Box&lt;T&gt;</code> 将类型 T 的值分配在堆上，而不是栈上</li>\n<li>当 Box 被销毁时，堆上的数据也会被销毁</li>\n</ul>\n<h3 id=\"Box-的底层实现\"><a href=\"#Box-的底层实现\" class=\"headerlink\" title=\"Box 的底层实现\"></a>Box 的底层实现</h3><ul>\n<li>底层原理<ul>\n<li><code>Box&lt;T&gt;</code> 实际上是一个智能指针，内部包含一个指向堆上分配内存的裸指针</li>\n<li>当 <code>Box&lt;T&gt;</code> 被销毁时，其 <code>Drop</code> trait 会被调用，释放堆上的内存</li>\n</ul>\n</li>\n<li>内存分配<ul>\n<li>Rust 使用系统的全局分配器（如 malloc 和 free）来管理堆内存</li>\n<li>Box::new 分配内存，Drop 释放内存</li>\n</ul>\n</li>\n<li>安全性<ul>\n<li>Rust 的所有权系统确保 <code>Box&lt;T&gt;</code> 的内存安全。所有权转移时，堆内存的生命周期也会随之变化</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Box-的使用场景\"><a href=\"#Box-的使用场景\" class=\"headerlink\" title=\"Box 的使用场景\"></a>Box 的使用场景</h3><h4 id=\"堆分配\"><a href=\"#堆分配\" class=\"headerlink\" title=\"堆分配\"></a>堆分配</h4><p>Box 最常见的用途是将数据分配在堆上，而不是栈上。这在处理较大数据结构、或数据结构的大小在编译时不确定时尤为重要</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">b</span> = <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(<span class=\"number\">5</span>);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;b = &#123;&#125;&quot;</span>, b);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"动态大小类型（DST）\"><a href=\"#动态大小类型（DST）\" class=\"headerlink\" title=\"动态大小类型（DST）\"></a>动态大小类型（DST）</h4><p>Box 允许处理动态大小类型，如 <code>str</code> 和 <code>[T]</code></p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">s</span>: <span class=\"type\">Box</span>&lt;<span class=\"type\">str</span>&gt; = <span class=\"string\">&quot;Hello, world!&quot;</span>.<span class=\"title function_ invoke__\">into</span>();</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;s = &#123;&#125;&quot;</span>, s);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">arr</span>: <span class=\"type\">Box</span>&lt;[<span class=\"type\">i32</span>]&gt; = <span class=\"built_in\">vec!</span>[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>].<span class=\"title function_ invoke__\">into_boxed_slice</span>();</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;arr = &#123;:?&#125;&quot;</span>, arr);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"递归数据结构\"><a href=\"#递归数据结构\" class=\"headerlink\" title=\"递归数据结构\"></a>递归数据结构</h4><p>递归数据结构需要指针类型引用自身，而 Box 提供了这一功能</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">List</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Cons</span>(<span class=\"type\">i32</span>, <span class=\"type\">Box</span>&lt;List&gt;),</span><br><span class=\"line\">    Nil,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">use</span> List::&#123;Cons, Nil&#125;;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">list</span> = <span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">1</span>, <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(<span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">2</span>, <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(<span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">3</span>, <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(Nil))))));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"类型擦除\"><a href=\"#类型擦除\" class=\"headerlink\" title=\"类型擦除\"></a>类型擦除</h4><p><code>Box&lt;dyn Trait&gt;</code> 用于类型擦除，允许在运行时决定类型</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">trait</span> <span class=\"title class_\">Animal</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">speak</span>(&amp;<span class=\"keyword\">self</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Dog</span>;</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Cat</span>;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Animal</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Dog</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">speak</span>(&amp;<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Woof!&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Animal</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Cat</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">speak</span>(&amp;<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Meow!&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">animals</span>: <span class=\"type\">Vec</span>&lt;<span class=\"type\">Box</span>&lt;<span class=\"keyword\">dyn</span> Animal&gt;&gt; = <span class=\"built_in\">vec!</span>[<span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(Dog), <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(Cat)];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"variable\">animal</span> <span class=\"keyword\">in</span> animals.<span class=\"title function_ invoke__\">iter</span>() &#123;</span><br><span class=\"line\">        animal.<span class=\"title function_ invoke__\">speak</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"dyn-关键字\"><a href=\"#dyn-关键字\" class=\"headerlink\" title=\"dyn 关键字\"></a><code>dyn</code> 关键字</h3><p><code>dyn</code> 关键字用于指定动态分发的类型，允许在运行时决定具体类型，可用于实现动态分发的 trait 对象</p>\n<h3 id=\"内存管理和性能优化\"><a href=\"#内存管理和性能优化\" class=\"headerlink\" title=\"内存管理和性能优化\"></a>内存管理和性能优化</h3><p>通过使用 Box，可以控制内存的分配和释放，从而优化性能和内存使用。例如，将大型数据结构放在堆上，而不是栈上，从而避免栈溢出</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">large_array</span> = <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>([<span class=\"number\">0u8</span>; <span class=\"number\">1_000_000</span>]);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Large array allocated on the heap.&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Box-的优缺点\"><a href=\"#Box-的优缺点\" class=\"headerlink\" title=\"Box 的优缺点\"></a>Box 的优缺点</h2><ul>\n<li>优点<ul>\n<li>提供堆内存分配，支持复杂数据结构</li>\n<li>与 Rust 的所有权系统完美集成，确保内存安全</li>\n<li>动态分配对象，实现类型擦除</li>\n</ul>\n</li>\n<li>缺点<ul>\n<li>需要堆内存分配和释放，可能带来性能开销</li>\n<li>不适合需要频繁分配和释放的场景</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Drop、Derefb-和-DerefMut\"><a href=\"#Drop、Derefb-和-DerefMut\" class=\"headerlink\" title=\"Drop、Derefb 和 DerefMut\"></a>Drop、Derefb 和 DerefMut</h2><ul>\n<li><code>Drop</code> Trait<ul>\n<li><code>Drop</code> trait 定义了当一个值离开作用域时应该执行的操作</li>\n<li>例如：<code>Box&lt;T&gt;</code> 在超出作用域时会自动调用其 Drop trait，释放堆上的内存</li>\n</ul>\n</li>\n<li><code>Deref</code> Trait<ul>\n<li><code>Deref</code> trait 定义了如何将一个类型转换为引用</li>\n<li>例如：<code>Box&lt;T&gt;</code> 实现了 Deref，所以可以通过 * 运算符解引用获取其内部数据</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Drop-Trait\"><a href=\"#Drop-Trait\" class=\"headerlink\" title=\"Drop Trait\"></a><code>Drop</code> Trait</h3><p><code>Drop</code> trait 用于自定义当值离开作用域时执行的代码，通常用于释放资源（例如内存、文件句柄、网络连接等）</p>\n<h4 id=\"定义和实现\"><a href=\"#定义和实现\" class=\"headerlink\" title=\"定义和实现\"></a>定义和实现</h4><p><code>Drop</code> trait 定义了一个 drop 方法，当值被释放时，Rust 会自动调用这个方法</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">trait</span> <span class=\"title class_\">Drop</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">fn</span> <span class=\"title function_\">drop</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Resource</span> &#123;</span><br><span class=\"line\">    name: <span class=\"type\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 正确实现标准库的 Drop trait</span></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Drop</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Resource</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">drop</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125; is dropped&quot;</span>, <span class=\"keyword\">self</span>.name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">box_study</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">_r1</span> = Resource &#123;</span><br><span class=\"line\">        name: <span class=\"string\">&quot;r1&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"variable\">_r2</span> = Resource &#123;</span><br><span class=\"line\">            name: <span class=\"string\">&quot;r2&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;  <span class=\"comment\">// r2 在这里离开作用域</span></span><br><span class=\"line\">&#125;  <span class=\"comment\">// r1 在这里离开作用域</span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">box_study</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Deref-Trait\"><a href=\"#Deref-Trait\" class=\"headerlink\" title=\"Deref Trait\"></a><code>Deref</code> Trait</h3><p><code>Deref</code> trait 用于重载解引用运算符（*），允许定义自定义指针类型的解引用行为</p>\n<h4 id=\"定义和实现-1\"><a href=\"#定义和实现-1\" class=\"headerlink\" title=\"定义和实现\"></a>定义和实现</h4><p><code>Deref</code> trait 定义了一个 deref 方法，该方法返回指向目标类型的引用</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">trait</span> <span class=\"title class_\">Deref</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">type</span> <span class=\"title class_\">Target</span>: ?<span class=\"built_in\">Sized</span>;</span><br><span class=\"line\">  <span class=\"keyword\">fn</span> <span class=\"title function_\">deref</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"keyword\">Self</span>::Target;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::ops::Deref;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">x</span> = <span class=\"number\">5</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">y</span> = MyBox::<span class=\"title function_ invoke__\">new</span>(x);</span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;x = &#123;&#125;&quot;</span>, x);</span><br><span class=\"line\">  <span class=\"comment\">// 触发解引用运算符重载</span></span><br><span class=\"line\">  <span class=\"comment\">// 等价于 *(y.deref())（编译器自动转换）</span></span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;y = &#123;&#125;&quot;</span>, *y);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">MyBox</span>&lt;T&gt;(T);</span><br><span class=\"line\"><span class=\"comment\">// 构造函数实现</span></span><br><span class=\"line\"><span class=\"keyword\">impl</span>&lt;T&gt; MyBox&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">new</span>(x: T) <span class=\"punctuation\">-&gt;</span> MyBox&lt;T&gt; &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">MyBox</span>(x)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span>&lt;T&gt; Deref <span class=\"keyword\">for</span> <span class=\"title class_\">MyBox</span>&lt;T&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 关联类型</span></span><br><span class=\"line\">  <span class=\"keyword\">type</span> <span class=\"title class_\">Target</span> = T;</span><br><span class=\"line\">  <span class=\"keyword\">fn</span> <span class=\"title function_\">deref</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> &amp;T &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;deref called&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 访问元组结构体的第一个字段</span></span><br><span class=\"line\">    &amp;<span class=\"keyword\">self</span>.<span class=\"number\">0</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"DerefMut-Trait\"><a href=\"#DerefMut-Trait\" class=\"headerlink\" title=\"DerefMut Trait\"></a><code>DerefMut</code> Trait</h3><p>与 Deref 类似，DerefMut 用于重载可变解引用运算符（*），允许对自定义类型进行可变解引用</p>\n<h4 id=\"定义和实现-2\"><a href=\"#定义和实现-2\" class=\"headerlink\" title=\"定义和实现\"></a>定义和实现</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">trait</span> <span class=\"title class_\">DerefMut</span>: Deref &#123;</span><br><span class=\"line\">  <span class=\"keyword\">fn</span> <span class=\"title function_\">deref_mut</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">Self</span>::Target;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">impl</span>&lt;T&gt; DerefMut <span class=\"keyword\">for</span> <span class=\"title class_\">MyBox</span>&lt;T&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">fn</span> <span class=\"title function_\">deref_mut</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">Self</span>::Target &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;deref called&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 访问元组结构体的第一个字段</span></span><br><span class=\"line\">    &amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>.<span class=\"number\">0</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"课后作业\"><a href=\"#课后作业\" class=\"headerlink\" title=\"课后作业\"></a>课后作业</h2><h3 id=\"作业-1-内存管理和性能优化\"><a href=\"#作业-1-内存管理和性能优化\" class=\"headerlink\" title=\"作业 1: 内存管理和性能优化\"></a>作业 1: 内存管理和性能优化</h3><p>创建一个大型数组并将其分配到堆上，然后测量和比较分配在堆和栈上的性能差异。</p>\n<p>创建一个包含 1_000_000 个元素的数组，分别将其分配在堆和栈上。使用 <code>std::time::Instant</code> 来测量分配和访问时间。</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::time::Instant;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">  <span class=\"title function_ invoke__\">test_stack_allocation</span>();</span><br><span class=\"line\">  <span class=\"title function_ invoke__\">test_heap_allocation</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">test_stack_allocation</span>() &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 栈上分配测试 (1,000,000 个整数)</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">n</span> = <span class=\"number\">1_000_000</span>;</span><br><span class=\"line\">  <span class=\"comment\">// 分配</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">start</span> = Instant::<span class=\"title function_ invoke__\">now</span>();</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">arr</span>: [<span class=\"type\">u32</span>; <span class=\"number\">1_000_000</span>] = [<span class=\"number\">0</span>; <span class=\"number\">1_000_000</span>]; <span class=\"comment\">// 改用u32避免负数问题</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">duration</span> = start.<span class=\"title function_ invoke__\">elapsed</span>();</span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;分配时间: &#123;:?&#125;&quot;</span>, duration); <span class=\"comment\">// 分配时间: 58.75µs</span></span><br><span class=\"line\">  <span class=\"comment\">// 写入</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">start</span> = Instant::<span class=\"title function_ invoke__\">now</span>();</span><br><span class=\"line\">  <span class=\"keyword\">for</span> <span class=\"variable\">i</span> <span class=\"keyword\">in</span> <span class=\"number\">0</span>..n &#123;</span><br><span class=\"line\">      arr[i] = i <span class=\"keyword\">as</span> <span class=\"type\">u32</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">duration</span> = start.<span class=\"title function_ invoke__\">elapsed</span>();</span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;写入时间: &#123;:?&#125;&quot;</span>, duration); <span class=\"comment\">// 写入时间: 7.7795ms</span></span><br><span class=\"line\">  <span class=\"comment\">// 读取和求和</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">start</span> = Instant::<span class=\"title function_ invoke__\">now</span>();</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">sum</span>: <span class=\"type\">u64</span> = <span class=\"number\">0</span>; <span class=\"comment\">// 使用u64来容纳大数字</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> <span class=\"variable\">i</span> <span class=\"keyword\">in</span> <span class=\"number\">0</span>..n &#123;</span><br><span class=\"line\">      sum += arr[i] <span class=\"keyword\">as</span> <span class=\"type\">u64</span>; <span class=\"comment\">// 将每个元素转为u64</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">duration</span> = start.<span class=\"title function_ invoke__\">elapsed</span>();</span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;读取时间: &#123;:?&#125;\\n&quot;</span>, duration); <span class=\"comment\">// 读取时间: 7.601417ms</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">test_heap_allocation</span>() &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 堆上分配测试 (1,000,000 个整数)</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">n</span> = <span class=\"number\">1_000_000</span>;</span><br><span class=\"line\">  <span class=\"comment\">// 分配</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">start</span> = Instant::<span class=\"title function_ invoke__\">now</span>();</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">arr</span> = <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>([<span class=\"number\">0u32</span>; <span class=\"number\">1_000_000</span>]); <span class=\"comment\">// 明确类型为u32</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">duration</span> = start.<span class=\"title function_ invoke__\">elapsed</span>();</span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;分配时间: &#123;:?&#125;&quot;</span>, duration); <span class=\"comment\">// 分配时间: 421.75µs</span></span><br><span class=\"line\">  <span class=\"comment\">// 写入</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">start</span> = Instant::<span class=\"title function_ invoke__\">now</span>();</span><br><span class=\"line\">  <span class=\"keyword\">for</span> <span class=\"variable\">i</span> <span class=\"keyword\">in</span> <span class=\"number\">0</span>..n &#123;</span><br><span class=\"line\">      arr[i] = i <span class=\"keyword\">as</span> <span class=\"type\">u32</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">duration</span> = start.<span class=\"title function_ invoke__\">elapsed</span>();</span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;写入时间: &#123;:?&#125;&quot;</span>, duration); <span class=\"comment\">// 写入时间: 6.979958ms</span></span><br><span class=\"line\">  <span class=\"comment\">// 读取和求和</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">start</span> = Instant::<span class=\"title function_ invoke__\">now</span>();</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">sum</span>: <span class=\"type\">u64</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> <span class=\"variable\">i</span> <span class=\"keyword\">in</span> <span class=\"number\">0</span>..n &#123;</span><br><span class=\"line\">      sum += arr[i] <span class=\"keyword\">as</span> <span class=\"type\">u64</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"variable\">duration</span> = start.<span class=\"title function_ invoke__\">elapsed</span>();</span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;读取时间: &#123;:?&#125;&quot;</span>, duration); <span class=\"comment\">// 读取时间: 7.15825ms</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"作业2：实现一个简单的文件系统模拟\"><a href=\"#作业2：实现一个简单的文件系统模拟\" class=\"headerlink\" title=\"作业2：实现一个简单的文件系统模拟\"></a>作业2：实现一个简单的文件系统模拟</h3><ul>\n<li><p>目标<br>实现一个简单的文件系统模拟，其中包含文件和文件夹的概念。文件夹可以包含文件和其他文件夹。使用 Box 来管理内存，并实现对文件系统的基本操作（如创建文件、创建文件夹、列出文件和文件夹）。</p>\n</li>\n<li><p>作业要求</p>\n<ul>\n<li>定义 <code>FileSystem</code> trait 和 Node 枚举<ul>\n<li><code>FileSystem</code> trait 包含 <code>create_file</code>、<code>create_folder</code> 和 <code>list_contents</code> 方法。</li>\n<li><code>Node</code> 枚举包含 <code>File</code> 和 <code>Folder</code> 变体。</li>\n</ul>\n</li>\n<li>实现 <code>FolderNode</code> 结构体<ul>\n<li><code>FolderNode</code> 实现 <code>FileSystem</code> trait，包含 <code>name</code> 和 <code>contents</code> 字段。</li>\n<li>使用 <code>Box</code> 管理 <code>contents</code> 中的子节点。</li>\n</ul>\n</li>\n<li>实现文件系统的基本操作<ul>\n<li><code>create_file</code> 方法在文件夹中创建文件。</li>\n<li><code>create_folder</code> 方法在文件夹中创建子文件夹。</li>\n<li><code>list_contents</code> 方法列出文件夹的所有内容。</li>\n</ul>\n</li>\n<li>测试文件系统的操作<ul>\n<li>创建根文件夹并添加文件和文件夹。</li>\n<li>创建子文件夹并添加文件。</li>\n<li>列出文件夹的内容并输出文件系统结构。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>提示<br>使用 <code>Box</code> 来管理 <code>Folder</code> 中的子节点。<br>使用递归方法来遍历和列出文件和文件夹的内容。<br>考虑使用 <code>Vec</code> 来存储文件夹的子节点。</p>\n</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">trait</span> <span class=\"title class_\">FileSystem</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">create_file</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>, name: &amp;<span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;(), <span class=\"type\">String</span>&gt;;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">create_folder</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>, name: &amp;<span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;(), <span class=\"type\">String</span>&gt;;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">list_contents</span>(&amp;<span class=\"keyword\">self</span>, indent: <span class=\"type\">usize</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 定义 Node 枚举，包含：文件节点 和 文件夹节点</span></span><br><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Node</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// File 和 Folder 是变体的名称</span></span><br><span class=\"line\">    <span class=\"comment\">// (FileNode) 和 (FolderNode) 是变体关联的数据类型</span></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">File</span>(FileNode),</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Folder</span>(FolderNode),</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 文件节点结构</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">FileNode</span> &#123;</span><br><span class=\"line\">    name: <span class=\"type\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 文件夹节点结构</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">FolderNode</span> &#123;</span><br><span class=\"line\">    name: <span class=\"type\">String</span>,</span><br><span class=\"line\">    contents: <span class=\"type\">Vec</span>&lt;<span class=\"type\">Box</span>&lt;Node&gt;&gt;, <span class=\"comment\">// 使用 Box&lt;Node&gt; 存储子节点</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">FileSystem</span> <span class=\"keyword\">for</span> <span class=\"title class_\">FolderNode</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">create_file</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>, name: &amp;<span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;(), <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 检查是否同名节点已存在</span></span><br><span class=\"line\">        <span class=\"comment\">// *node 对 &amp;Box&lt;Node&gt; 解引用得到 Box&lt;Node&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">// **node 对 Box&lt;Node&gt; 解引用得到 Node 值</span></span><br><span class=\"line\">        <span class=\"comment\">// &amp;**Node 取得对 Node 的引用（&amp;Node），为了避免所有权的移动</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">self</span>.contents.<span class=\"title function_ invoke__\">iter</span>().<span class=\"title function_ invoke__\">any</span>(|node| <span class=\"keyword\">match</span> &amp;**node &#123;</span><br><span class=\"line\">            Node::<span class=\"title function_ invoke__\">File</span>(f) =&gt; f.name == name,</span><br><span class=\"line\">            Node::<span class=\"title function_ invoke__\">Folder</span>(f) =&gt; f.name == name,</span><br><span class=\"line\">        &#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">Err</span>(<span class=\"string\">&quot;Name already exists&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 创建新文件</span></span><br><span class=\"line\">        <span class=\"keyword\">self</span>.contents.<span class=\"title function_ invoke__\">push</span>(<span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(Node::<span class=\"title function_ invoke__\">File</span>(FileNode &#123;</span><br><span class=\"line\">            name: name.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">        &#125;)));</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">create_folder</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>, name: &amp;<span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Result</span>&lt;(), <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 检查是否同名节点已存在</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">self</span>.contents.<span class=\"title function_ invoke__\">iter</span>().<span class=\"title function_ invoke__\">any</span>(|node| <span class=\"keyword\">match</span> &amp;**node &#123;</span><br><span class=\"line\">            Node::<span class=\"title function_ invoke__\">File</span>(f) =&gt; f.name == name,</span><br><span class=\"line\">            Node::<span class=\"title function_ invoke__\">Folder</span>(f) =&gt; f.name == name,</span><br><span class=\"line\">        &#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">Err</span>(<span class=\"string\">&quot;Name already exists&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 创建新文件夹</span></span><br><span class=\"line\">        <span class=\"keyword\">self</span>.contents.<span class=\"title function_ invoke__\">push</span>(<span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(Node::<span class=\"title function_ invoke__\">Folder</span>(FolderNode &#123;</span><br><span class=\"line\">            name: name.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">            contents: <span class=\"type\">Vec</span>::<span class=\"title function_ invoke__\">new</span>(),</span><br><span class=\"line\">        &#125;)));</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Ok</span>(())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">list_contents</span>(&amp;<span class=\"keyword\">self</span>, indent: <span class=\"type\">usize</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 递归列出所有内容</span></span><br><span class=\"line\">        <span class=\"comment\">// .iter() 遍历 self.contents 中的每个元素（&amp;Box&lt;Node&gt; 类型）</span></span><br><span class=\"line\">        <span class=\"comment\">// .enumerate() 会将迭代器转换为新的迭代器，新迭代器产生元组 (index, item)</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (i, node) <span class=\"keyword\">in</span> <span class=\"keyword\">self</span>.contents.<span class=\"title function_ invoke__\">iter</span>().<span class=\"title function_ invoke__\">enumerate</span>() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"variable\">is_last</span> = i == <span class=\"keyword\">self</span>.contents.<span class=\"title function_ invoke__\">len</span>() - <span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"variable\">prefix</span> = <span class=\"keyword\">if</span> is_last &#123; <span class=\"string\">&quot;└──&quot;</span> &#125; <span class=\"keyword\">else</span> &#123; <span class=\"string\">&quot;├──&quot;</span> &#125;;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> <span class=\"variable\">item_indent</span> = indent + <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">match</span> &amp;**node &#123;</span><br><span class=\"line\">                <span class=\"comment\">// &#123;:indent$&#125; 功能：创建指定数量的空格缩进</span></span><br><span class=\"line\">                <span class=\"comment\">// indent$ 是一个 ​​命名参数占位符</span></span><br><span class=\"line\">                <span class=\"comment\">// indents 的值为 item_indent</span></span><br><span class=\"line\">                Node::<span class=\"title function_ invoke__\">File</span>(file) =&gt; <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">                    <span class=\"string\">&quot;&#123;:indent$&#125;&#123;&#125; &#123;&#125; (File)&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">                    prefix,</span><br><span class=\"line\">                    file.name,</span><br><span class=\"line\">                    indent = item_indent</span><br><span class=\"line\">                ),</span><br><span class=\"line\">                Node::<span class=\"title function_ invoke__\">Folder</span>(folder) =&gt; &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 打印子文件夹名称作为父文件夹的子项</span></span><br><span class=\"line\">                    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">                        <span class=\"string\">&quot;&#123;:indent$&#125;&#123;&#125; &#123;&#125; (Folder)&quot;</span>,</span><br><span class=\"line\">                        <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">                        prefix,</span><br><span class=\"line\">                        folder.name,</span><br><span class=\"line\">                        indent = item_indent</span><br><span class=\"line\">                    );</span><br><span class=\"line\">                    folder.<span class=\"title function_ invoke__\">list_contents</span>(item_indent + <span class=\"number\">2</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 创建根文件夹</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">root</span> = FolderNode &#123;</span><br><span class=\"line\">        name: <span class=\"string\">&quot;Root&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">        contents: <span class=\"type\">Vec</span>::<span class=\"title function_ invoke__\">new</span>(),</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 在根目录添加文件和文件夹</span></span><br><span class=\"line\">    <span class=\"comment\">// 使用 .unwrap() 使得出现错误后 painc 退出程序</span></span><br><span class=\"line\">    root.<span class=\"title function_ invoke__\">create_file</span>(<span class=\"string\">&quot;document.txt&quot;</span>).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\">    root.<span class=\"title function_ invoke__\">create_folder</span>(<span class=\"string\">&quot;Pictures&quot;</span>).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\">    root.<span class=\"title function_ invoke__\">create_folder</span>(<span class=\"string\">&quot;Music&quot;</span>).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\">    <span class=\"comment\">// 在 Pictures 文件夹中添加文件</span></span><br><span class=\"line\">    <span class=\"comment\">// .iter_mut() 获取集合的​​可变引用迭代器</span></span><br><span class=\"line\">    <span class=\"comment\">// matches! 宏检查是否匹配模式（名字为 Pictures 的文件夹</span></span><br><span class=\"line\">    <span class=\"comment\">// .map() 将 &amp;mut Box&lt;Node&gt; 类型转为 &amp;mut Node 类型</span></span><br><span class=\"line\">    <span class=\"comment\">// pictures 的类型为 &amp;mut FolderNode</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Some</span>(Node::<span class=\"title function_ invoke__\">Folder</span>(pictures)) = root</span><br><span class=\"line\">        .contents</span><br><span class=\"line\">        .<span class=\"title function_ invoke__\">iter_mut</span>()</span><br><span class=\"line\">        .<span class=\"title function_ invoke__\">find</span>(|n| matches!(&amp;***n, Node::<span class=\"title function_ invoke__\">Folder</span>(f) <span class=\"keyword\">if</span> f.name == <span class=\"string\">&quot;Pictures&quot;</span>))</span><br><span class=\"line\">        .<span class=\"title function_ invoke__\">map</span>(|n| &amp;<span class=\"keyword\">mut</span> **n)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        pictures.<span class=\"title function_ invoke__\">create_file</span>(<span class=\"string\">&quot;photo1.jpg&quot;</span>).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\">        pictures.<span class=\"title function_ invoke__\">create_file</span>(<span class=\"string\">&quot;photo2.jpg&quot;</span>).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 在 Music 文件夹中添加文件</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Some</span>(Node::<span class=\"title function_ invoke__\">Folder</span>(music)) = root</span><br><span class=\"line\">        .contents</span><br><span class=\"line\">        .<span class=\"title function_ invoke__\">iter_mut</span>()</span><br><span class=\"line\">        .<span class=\"title function_ invoke__\">find</span>(|n| matches!(&amp;***n, Node::<span class=\"title function_ invoke__\">Folder</span>(f) <span class=\"keyword\">if</span> f.name == <span class=\"string\">&quot;Music&quot;</span>))</span><br><span class=\"line\">        .<span class=\"title function_ invoke__\">map</span>(|n| &amp;<span class=\"keyword\">mut</span> **n)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        music.<span class=\"title function_ invoke__\">create_file</span>(<span class=\"string\">&quot;song1.mp3&quot;</span>).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\">        music.<span class=\"title function_ invoke__\">create_folder</span>(<span class=\"string\">&quot;Classical&quot;</span>).<span class=\"title function_ invoke__\">unwrap</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 列出整个文件系统结构</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;File System Structure:&quot;</span>);</span><br><span class=\"line\">    root.<span class=\"title function_ invoke__\">list_contents</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"IB-Rust-泛型","date":"2025-06-05T14:21:27.000Z","_content":"\n[Codes in lesson17](https://github.com/Zoella-w/IB-Rust/tree/main/17_generics)\n\n## 泛型的例子\n\n用同一功能的函数处理不同类型的数据，例如两个数的加法，无论是整数、浮点数、还是自定义类型，都能支持。在不支持泛型的编程语言中，需要为每种类型编写一个函数：\n\n```rust\nfn add_i8(a:i8, b:i8) -> i8 {\n    a + b\n}\nfn add_i32(a:i32, b:i32) -> i32 {\n    a + b\n}\nfn add_f64(a:f64, b:f64) -> f64 {\n    a + b\n}\nfn main() {\n    println!(\"add i8: {}\", add_i8(2i8, 3i8));\n    println!(\"add i32: {}\", add_i32(20, 30));\n    println!(\"add f64: {}\", add_f64(1.23, 1.23));\n}\n```\n\n### 泛型\n\n当使用泛型定义函数时，本来在函数签名中指定参数和返回值的类型的地方，会改用泛型来表示。这种技术能使代码适应性更强，从而为函数调用者提供更多的功能，同时也避免了代码重复\n\n```rust\nfn add<T>(a:T, b:T) -> T {\n    a + b\n}\n```\n\n上面代码的 `T` 就是**泛型参数**，泛型参数的名称可以为任意，但是惯例一般用 `T`作为首选。该名称越短越好，除非需要表达含义\n\n不是所有 `T` 类型都能进行相加操作，因此需要用 `std::ops::Add<Output = T>` 对 `T` 进行限制：\n\n```rust\nfn add<T: std::ops::Add<Output = T>>(a: T, b: T) -> T {\n    a + b\n}\nfn main() {\n    println!(\"add i8: {}\", add(2i8, 3i8));\n    println!(\"add i32: {}\", add(20, 30));\n    println!(\"add f64: {}\", add(1.23, 1.23));\n}\n```\n\n## 在函数定义中使用泛型\n\n不是所有的类型都能进行比较，使用标准库中定义的 `std::cmp::PartialOrd` trait 可以实现类型的比较功能，限制 `T` 只对实现了 `PartialOrd` 的类型有效（`i32` 和 `char`）\n\n```rust\nfn largest<T: std::cmp::PartialOrd>(list: &[T]) -> &T {\n    let mut largest = &list[0];\n    for item in list {\n        if item > largest {\n            largest = item;\n        }\n    }\n    largest\n}\nfn main() {\n    let number_list = vec![34, 50, 25, 100, 65];\n    let result = largest(&number_list);\n    println!(\"The largest number is {}\", result);\n    let char_list = vec!['y', 'm', 'a', 'q'];\n    let result = largest(&char_list);\n    println!(\"The largest char is {}\", result);\n}\n```\n\n## 结构体定义中的泛型\n\n- 结构体名称后面的尖括号中声明泛型参数的名称，结构体定义中可以指定具体数据类型的位置\n- x 和 y 是相同的类型\n\n```rust\nstruct Point<T> {\n    x: T,\n    y: T,\n}\nfn main() {\n    let integer = Point { x: 5, y: 10 };\n    let float = Point { x: 1.0, y: 4.0 };\n    // let wont_work = Point { x: 5, y: 4.0 }; // error: mismatched types\n}\n```\n\n定义一个 `x` 和 `y` 有不同类型且仍是泛型的 `Point` 结构体：\n\n```rust\nstruct Point<T, U> {\n    x: T,\n    y: U,\n}\nfn main() {\n    let both_integer = Point { x: 5, y: 10 };\n    let both_float = Point { x: 1.0, y: 4.0 };\n    let integer_and_float = Point { x: 5, y: 4.0 };\n}\n```\n\n## 枚举中使用泛型\n\n```rust\nenum Option<T> {\n    Some(T),\n    None,\n}\nenum Result<T, E> {\n    Ok(T),\n    Err(E),\n}\n```\n\n## 方法中使用泛型\n\n其他 `T` 不是 `i32` 类型的 `Point<T>` 实例没有定义此方法\n\n```rust\nstruct Point<T> {\n    x: T,\n    y: T,\n}\n\nimpl Point<i32> {\n    fn x(&self) -> &i32 {\n        &self.x\n    }\n}\n```\n\n#### `impl` 之后声明泛型 `T`\n\n泛型参数可以与结构体定义中声明的泛型参数不同\n\n```rust\nstruct Point<T> {\n    x: T,\n    y: T,\n}\nimpl<T> Point<T> {\n    fn x(&self) -> &T {\n        &self.x\n    }\n}\n```\n\n#### 方法使用了与结构体定义中不同类型的泛型\n\n```rust\nstruct Point<X1, Y1> {\n    x: X1,\n    y: Y1,\n}\nimpl<X1, Y1> Point<X1, Y1> {\n    fn mixup<X2, Y2>(self, other: Point<X2, Y2>) -> Point<X1, Y2> {\n        Point {\n            x: self.x,\n            y: other.y,\n        }\n    }\n}\nfn main() {\n    let p1 = Point { x: 5, y: 10.4 };\n    let p2 = Point { x: \"Hello\", y: 'c' };\n    let p3 = p1.mixup(p2); // {x: 5, y: c}\n}\n```\n\n## const 泛型（Rust 1.51 版本引入的重要特性）\n\n`[i32; 3]` 和 `[i32; 2]` 确实是两个完全不同的类型，因此无法用同一个函数调用\n\n```rust\nfn display_array(arr: [i32; 3]) {\n    println!(\"{:?}\", arr);\n}\nfn main() {\n    let arr: [i32; 3] = [1, 2, 3];\n    display_array(arr);\n    let arr: [i32; 2] = [1,2];\n    // display_array(arr); // error: mismatched types\n}\n```\n\n### 方式1: 切片+泛型\n\n- 使用数组切片，传入 `arr` 的不可变引用\n- `i32` 改成所有类型T的数组\n- 需要对 `T` 加一个限制 `std::fmt::Debug`，表明 `T` 可以用在 `println!(\"{:?}\", arr)` 中，因为 `{:?}` 形式的格式化输出需要 `arr` 实现该特征\n\n```rust\nfn display_array<T: std::fmt::Debug>(arr: &[T]) {\n    println!(\"{:?}\", arr);\n}\nfn main() {\n    let arr: [i32; 3] = [1, 2, 3];\n    display_array(&arr);\n\n    let arr: [i32;2] = [1,2];\n    display_array(&arr);\n}\n```\n\n### 方式2: const 泛型\n\n`const N: usize`，表示 const 泛型 `N` 基于的值类型是 `usize`\n\n定义一个类型为 `[T; N]` 的数组：其中的 `N` 是一个基于值的泛型参数，因为它用来替代数组的长度\n\n```rust\nfn display_array<T: std::fmt::Debug, const N: usize>(arr: [T; N]) {\n    println!(\"{:?}\", arr);\n}\nfn main() {\n    let arr: [i32; 3] = [1, 2, 3];\n    display_array(arr);\n    let arr: [i32; 2] = [1, 2];\n    display_array(arr);\n}\n```\n\n## 泛型代码的性能\n\n> Rust 通过在编译时进行泛型代码的 **单态化**（*monomorphization*）来保证效率\n\n对于标准库中的 `Option` 枚举：\n\n```rust\nlet integer = Some(5);\nlet float = Some(5.0);\n```\n\n编译器生成的单态化版本的代码看起来像这样（名字为假想的）：\n\n```rust\nenum Option_i32 {\n    Some(i32),\n    None,\n}\nenum Option_f64 {\n    Some(f64),\n    None,\n}\nfn main() {\n    let integer = Option_i32::Some(5);\n    let float = Option_f64::Some(5.0);\n}\n```\n\n泛型 `Option<T>` 被编译器替换为了具体的定义。Rust 会将每种情况下的泛型代码编译为具体类型，使用泛型没有运行时开销。代码运行的执行效率和手写每个具体定义的重复代码一样。单态化正是 Rust 泛型在运行时极其高效的原因\n\n但是，Rust 在编译期为泛型对应的多个类型，生成各自的代码，因此损失了编译速度，且增大了最终生成文件的大小\n","source":"_posts/75-IB-Rust-泛型.md","raw":"---\ntitle: IB-Rust-泛型\ndate: 2025-06-05 22:21:27\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson17](https://github.com/Zoella-w/IB-Rust/tree/main/17_generics)\n\n## 泛型的例子\n\n用同一功能的函数处理不同类型的数据，例如两个数的加法，无论是整数、浮点数、还是自定义类型，都能支持。在不支持泛型的编程语言中，需要为每种类型编写一个函数：\n\n```rust\nfn add_i8(a:i8, b:i8) -> i8 {\n    a + b\n}\nfn add_i32(a:i32, b:i32) -> i32 {\n    a + b\n}\nfn add_f64(a:f64, b:f64) -> f64 {\n    a + b\n}\nfn main() {\n    println!(\"add i8: {}\", add_i8(2i8, 3i8));\n    println!(\"add i32: {}\", add_i32(20, 30));\n    println!(\"add f64: {}\", add_f64(1.23, 1.23));\n}\n```\n\n### 泛型\n\n当使用泛型定义函数时，本来在函数签名中指定参数和返回值的类型的地方，会改用泛型来表示。这种技术能使代码适应性更强，从而为函数调用者提供更多的功能，同时也避免了代码重复\n\n```rust\nfn add<T>(a:T, b:T) -> T {\n    a + b\n}\n```\n\n上面代码的 `T` 就是**泛型参数**，泛型参数的名称可以为任意，但是惯例一般用 `T`作为首选。该名称越短越好，除非需要表达含义\n\n不是所有 `T` 类型都能进行相加操作，因此需要用 `std::ops::Add<Output = T>` 对 `T` 进行限制：\n\n```rust\nfn add<T: std::ops::Add<Output = T>>(a: T, b: T) -> T {\n    a + b\n}\nfn main() {\n    println!(\"add i8: {}\", add(2i8, 3i8));\n    println!(\"add i32: {}\", add(20, 30));\n    println!(\"add f64: {}\", add(1.23, 1.23));\n}\n```\n\n## 在函数定义中使用泛型\n\n不是所有的类型都能进行比较，使用标准库中定义的 `std::cmp::PartialOrd` trait 可以实现类型的比较功能，限制 `T` 只对实现了 `PartialOrd` 的类型有效（`i32` 和 `char`）\n\n```rust\nfn largest<T: std::cmp::PartialOrd>(list: &[T]) -> &T {\n    let mut largest = &list[0];\n    for item in list {\n        if item > largest {\n            largest = item;\n        }\n    }\n    largest\n}\nfn main() {\n    let number_list = vec![34, 50, 25, 100, 65];\n    let result = largest(&number_list);\n    println!(\"The largest number is {}\", result);\n    let char_list = vec!['y', 'm', 'a', 'q'];\n    let result = largest(&char_list);\n    println!(\"The largest char is {}\", result);\n}\n```\n\n## 结构体定义中的泛型\n\n- 结构体名称后面的尖括号中声明泛型参数的名称，结构体定义中可以指定具体数据类型的位置\n- x 和 y 是相同的类型\n\n```rust\nstruct Point<T> {\n    x: T,\n    y: T,\n}\nfn main() {\n    let integer = Point { x: 5, y: 10 };\n    let float = Point { x: 1.0, y: 4.0 };\n    // let wont_work = Point { x: 5, y: 4.0 }; // error: mismatched types\n}\n```\n\n定义一个 `x` 和 `y` 有不同类型且仍是泛型的 `Point` 结构体：\n\n```rust\nstruct Point<T, U> {\n    x: T,\n    y: U,\n}\nfn main() {\n    let both_integer = Point { x: 5, y: 10 };\n    let both_float = Point { x: 1.0, y: 4.0 };\n    let integer_and_float = Point { x: 5, y: 4.0 };\n}\n```\n\n## 枚举中使用泛型\n\n```rust\nenum Option<T> {\n    Some(T),\n    None,\n}\nenum Result<T, E> {\n    Ok(T),\n    Err(E),\n}\n```\n\n## 方法中使用泛型\n\n其他 `T` 不是 `i32` 类型的 `Point<T>` 实例没有定义此方法\n\n```rust\nstruct Point<T> {\n    x: T,\n    y: T,\n}\n\nimpl Point<i32> {\n    fn x(&self) -> &i32 {\n        &self.x\n    }\n}\n```\n\n#### `impl` 之后声明泛型 `T`\n\n泛型参数可以与结构体定义中声明的泛型参数不同\n\n```rust\nstruct Point<T> {\n    x: T,\n    y: T,\n}\nimpl<T> Point<T> {\n    fn x(&self) -> &T {\n        &self.x\n    }\n}\n```\n\n#### 方法使用了与结构体定义中不同类型的泛型\n\n```rust\nstruct Point<X1, Y1> {\n    x: X1,\n    y: Y1,\n}\nimpl<X1, Y1> Point<X1, Y1> {\n    fn mixup<X2, Y2>(self, other: Point<X2, Y2>) -> Point<X1, Y2> {\n        Point {\n            x: self.x,\n            y: other.y,\n        }\n    }\n}\nfn main() {\n    let p1 = Point { x: 5, y: 10.4 };\n    let p2 = Point { x: \"Hello\", y: 'c' };\n    let p3 = p1.mixup(p2); // {x: 5, y: c}\n}\n```\n\n## const 泛型（Rust 1.51 版本引入的重要特性）\n\n`[i32; 3]` 和 `[i32; 2]` 确实是两个完全不同的类型，因此无法用同一个函数调用\n\n```rust\nfn display_array(arr: [i32; 3]) {\n    println!(\"{:?}\", arr);\n}\nfn main() {\n    let arr: [i32; 3] = [1, 2, 3];\n    display_array(arr);\n    let arr: [i32; 2] = [1,2];\n    // display_array(arr); // error: mismatched types\n}\n```\n\n### 方式1: 切片+泛型\n\n- 使用数组切片，传入 `arr` 的不可变引用\n- `i32` 改成所有类型T的数组\n- 需要对 `T` 加一个限制 `std::fmt::Debug`，表明 `T` 可以用在 `println!(\"{:?}\", arr)` 中，因为 `{:?}` 形式的格式化输出需要 `arr` 实现该特征\n\n```rust\nfn display_array<T: std::fmt::Debug>(arr: &[T]) {\n    println!(\"{:?}\", arr);\n}\nfn main() {\n    let arr: [i32; 3] = [1, 2, 3];\n    display_array(&arr);\n\n    let arr: [i32;2] = [1,2];\n    display_array(&arr);\n}\n```\n\n### 方式2: const 泛型\n\n`const N: usize`，表示 const 泛型 `N` 基于的值类型是 `usize`\n\n定义一个类型为 `[T; N]` 的数组：其中的 `N` 是一个基于值的泛型参数，因为它用来替代数组的长度\n\n```rust\nfn display_array<T: std::fmt::Debug, const N: usize>(arr: [T; N]) {\n    println!(\"{:?}\", arr);\n}\nfn main() {\n    let arr: [i32; 3] = [1, 2, 3];\n    display_array(arr);\n    let arr: [i32; 2] = [1, 2];\n    display_array(arr);\n}\n```\n\n## 泛型代码的性能\n\n> Rust 通过在编译时进行泛型代码的 **单态化**（*monomorphization*）来保证效率\n\n对于标准库中的 `Option` 枚举：\n\n```rust\nlet integer = Some(5);\nlet float = Some(5.0);\n```\n\n编译器生成的单态化版本的代码看起来像这样（名字为假想的）：\n\n```rust\nenum Option_i32 {\n    Some(i32),\n    None,\n}\nenum Option_f64 {\n    Some(f64),\n    None,\n}\nfn main() {\n    let integer = Option_i32::Some(5);\n    let float = Option_f64::Some(5.0);\n}\n```\n\n泛型 `Option<T>` 被编译器替换为了具体的定义。Rust 会将每种情况下的泛型代码编译为具体类型，使用泛型没有运行时开销。代码运行的执行效率和手写每个具体定义的重复代码一样。单态化正是 Rust 泛型在运行时极其高效的原因\n\n但是，Rust 在编译期为泛型对应的多个类型，生成各自的代码，因此损失了编译速度，且增大了最终生成文件的大小\n","slug":"75-IB-Rust-泛型","published":1,"updated":"2025-06-05T15:36:21.044Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmbjjhnhw0000rvpr4ohqfcc2","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/17_generics\" >Codes in lesson17<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"泛型的例子\"><a href=\"#泛型的例子\" class=\"headerlink\" title=\"泛型的例子\"></a>泛型的例子</h2><p>用同一功能的函数处理不同类型的数据，例如两个数的加法，无论是整数、浮点数、还是自定义类型，都能支持。在不支持泛型的编程语言中，需要为每种类型编写一个函数：</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">add_i8</span>(a:<span class=\"type\">i8</span>, b:<span class=\"type\">i8</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">i8</span> &#123;</span><br><span class=\"line\">    a + b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">add_i32</span>(a:<span class=\"type\">i32</span>, b:<span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">i32</span> &#123;</span><br><span class=\"line\">    a + b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">add_f64</span>(a:<span class=\"type\">f64</span>, b:<span class=\"type\">f64</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">f64</span> &#123;</span><br><span class=\"line\">    a + b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;add i8: &#123;&#125;&quot;</span>, <span class=\"title function_ invoke__\">add_i8</span>(<span class=\"number\">2i8</span>, <span class=\"number\">3i8</span>));</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;add i32: &#123;&#125;&quot;</span>, <span class=\"title function_ invoke__\">add_i32</span>(<span class=\"number\">20</span>, <span class=\"number\">30</span>));</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;add f64: &#123;&#125;&quot;</span>, <span class=\"title function_ invoke__\">add_f64</span>(<span class=\"number\">1.23</span>, <span class=\"number\">1.23</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"泛型\"><a href=\"#泛型\" class=\"headerlink\" title=\"泛型\"></a>泛型</h3><p>当使用泛型定义函数时，本来在函数签名中指定参数和返回值的类型的地方，会改用泛型来表示。这种技术能使代码适应性更强，从而为函数调用者提供更多的功能，同时也避免了代码重复</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">add</span>&lt;T&gt;(a:T, b:T) <span class=\"punctuation\">-&gt;</span> T &#123;</span><br><span class=\"line\">    a + b</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>上面代码的 <code>T</code> 就是<strong>泛型参数</strong>，泛型参数的名称可以为任意，但是惯例一般用 <code>T</code>作为首选。该名称越短越好，除非需要表达含义</p>\n<p>不是所有 <code>T</code> 类型都能进行相加操作，因此需要用 <code>std::ops::Add&lt;Output = T&gt;</code> 对 <code>T</code> 进行限制：</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">add</span>&lt;T: std::ops::Add&lt;Output = T&gt;&gt;(a: T, b: T) <span class=\"punctuation\">-&gt;</span> T &#123;</span><br><span class=\"line\">    a + b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;add i8: &#123;&#125;&quot;</span>, <span class=\"title function_ invoke__\">add</span>(<span class=\"number\">2i8</span>, <span class=\"number\">3i8</span>));</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;add i32: &#123;&#125;&quot;</span>, <span class=\"title function_ invoke__\">add</span>(<span class=\"number\">20</span>, <span class=\"number\">30</span>));</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;add f64: &#123;&#125;&quot;</span>, <span class=\"title function_ invoke__\">add</span>(<span class=\"number\">1.23</span>, <span class=\"number\">1.23</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"在函数定义中使用泛型\"><a href=\"#在函数定义中使用泛型\" class=\"headerlink\" title=\"在函数定义中使用泛型\"></a>在函数定义中使用泛型</h2><p>不是所有的类型都能进行比较，使用标准库中定义的 <code>std::cmp::PartialOrd</code> trait 可以实现类型的比较功能，限制 <code>T</code> 只对实现了 <code>PartialOrd</code> 的类型有效（<code>i32</code> 和 <code>char</code>）</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">largest</span>&lt;T: std::cmp::<span class=\"built_in\">PartialOrd</span>&gt;(list: &amp;[T]) <span class=\"punctuation\">-&gt;</span> &amp;T &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">largest</span> = &amp;list[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"variable\">item</span> <span class=\"keyword\">in</span> list &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> item &gt; largest &#123;</span><br><span class=\"line\">            largest = item;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    largest</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">number_list</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">34</span>, <span class=\"number\">50</span>, <span class=\"number\">25</span>, <span class=\"number\">100</span>, <span class=\"number\">65</span>];</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">result</span> = <span class=\"title function_ invoke__\">largest</span>(&amp;number_list);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;The largest number is &#123;&#125;&quot;</span>, result);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">char_list</span> = <span class=\"built_in\">vec!</span>[<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"string\">&#x27;m&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;q&#x27;</span>];</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">result</span> = <span class=\"title function_ invoke__\">largest</span>(&amp;char_list);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;The largest char is &#123;&#125;&quot;</span>, result);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"结构体定义中的泛型\"><a href=\"#结构体定义中的泛型\" class=\"headerlink\" title=\"结构体定义中的泛型\"></a>结构体定义中的泛型</h2><ul>\n<li>结构体名称后面的尖括号中声明泛型参数的名称，结构体定义中可以指定具体数据类型的位置</li>\n<li>x 和 y 是相同的类型</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Point</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    x: T,</span><br><span class=\"line\">    y: T,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">integer</span> = Point &#123; x: <span class=\"number\">5</span>, y: <span class=\"number\">10</span> &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">float</span> = Point &#123; x: <span class=\"number\">1.0</span>, y: <span class=\"number\">4.0</span> &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// let wont_work = Point &#123; x: 5, y: 4.0 &#125;; // error: mismatched types</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>定义一个 <code>x</code> 和 <code>y</code> 有不同类型且仍是泛型的 <code>Point</code> 结构体：</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Point</span>&lt;T, U&gt; &#123;</span><br><span class=\"line\">    x: T,</span><br><span class=\"line\">    y: U,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">both_integer</span> = Point &#123; x: <span class=\"number\">5</span>, y: <span class=\"number\">10</span> &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">both_float</span> = Point &#123; x: <span class=\"number\">1.0</span>, y: <span class=\"number\">4.0</span> &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">integer_and_float</span> = Point &#123; x: <span class=\"number\">5</span>, y: <span class=\"number\">4.0</span> &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"枚举中使用泛型\"><a href=\"#枚举中使用泛型\" class=\"headerlink\" title=\"枚举中使用泛型\"></a>枚举中使用泛型</h2><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Option</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Some</span>(T),</span><br><span class=\"line\">    <span class=\"literal\">None</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Result</span>&lt;T, E&gt; &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Ok</span>(T),</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Err</span>(E),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"方法中使用泛型\"><a href=\"#方法中使用泛型\" class=\"headerlink\" title=\"方法中使用泛型\"></a>方法中使用泛型</h2><p>其他 <code>T</code> 不是 <code>i32</code> 类型的 <code>Point&lt;T&gt;</code> 实例没有定义此方法</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Point</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    x: T,</span><br><span class=\"line\">    y: T,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Point</span>&lt;<span class=\"type\">i32</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">x</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"type\">i32</span> &#123;</span><br><span class=\"line\">        &amp;<span class=\"keyword\">self</span>.x</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"impl-之后声明泛型-T\"><a href=\"#impl-之后声明泛型-T\" class=\"headerlink\" title=\"impl 之后声明泛型 T\"></a><code>impl</code> 之后声明泛型 <code>T</code></h4><p>泛型参数可以与结构体定义中声明的泛型参数不同</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Point</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    x: T,</span><br><span class=\"line\">    y: T,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span>&lt;T&gt; Point&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">x</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> &amp;T &#123;</span><br><span class=\"line\">        &amp;<span class=\"keyword\">self</span>.x</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"方法使用了与结构体定义中不同类型的泛型\"><a href=\"#方法使用了与结构体定义中不同类型的泛型\" class=\"headerlink\" title=\"方法使用了与结构体定义中不同类型的泛型\"></a>方法使用了与结构体定义中不同类型的泛型</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Point</span>&lt;X1, Y1&gt; &#123;</span><br><span class=\"line\">    x: X1,</span><br><span class=\"line\">    y: Y1,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span>&lt;X1, Y1&gt; Point&lt;X1, Y1&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">mixup</span>&lt;X2, Y2&gt;(<span class=\"keyword\">self</span>, other: Point&lt;X2, Y2&gt;) <span class=\"punctuation\">-&gt;</span> Point&lt;X1, Y2&gt; &#123;</span><br><span class=\"line\">        Point &#123;</span><br><span class=\"line\">            x: <span class=\"keyword\">self</span>.x,</span><br><span class=\"line\">            y: other.y,</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">p1</span> = Point &#123; x: <span class=\"number\">5</span>, y: <span class=\"number\">10.4</span> &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">p2</span> = Point &#123; x: <span class=\"string\">&quot;Hello&quot;</span>, y: <span class=\"string\">&#x27;c&#x27;</span> &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">p3</span> = p1.<span class=\"title function_ invoke__\">mixup</span>(p2); <span class=\"comment\">// &#123;x: 5, y: c&#125;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"const-泛型（Rust-1-51-版本引入的重要特性）\"><a href=\"#const-泛型（Rust-1-51-版本引入的重要特性）\" class=\"headerlink\" title=\"const 泛型（Rust 1.51 版本引入的重要特性）\"></a>const 泛型（Rust 1.51 版本引入的重要特性）</h2><p><code>[i32; 3]</code> 和 <code>[i32; 2]</code> 确实是两个完全不同的类型，因此无法用同一个函数调用</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">display_array</span>(arr: [<span class=\"type\">i32</span>; <span class=\"number\">3</span>]) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;:?&#125;&quot;</span>, arr);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">arr</span>: [<span class=\"type\">i32</span>; <span class=\"number\">3</span>] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">display_array</span>(arr);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">arr</span>: [<span class=\"type\">i32</span>; <span class=\"number\">2</span>] = [<span class=\"number\">1</span>,<span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"comment\">// display_array(arr); // error: mismatched types</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"方式1-切片-泛型\"><a href=\"#方式1-切片-泛型\" class=\"headerlink\" title=\"方式1: 切片+泛型\"></a>方式1: 切片+泛型</h3><ul>\n<li>使用数组切片，传入 <code>arr</code> 的不可变引用</li>\n<li><code>i32</code> 改成所有类型T的数组</li>\n<li>需要对 <code>T</code> 加一个限制 <code>std::fmt::Debug</code>，表明 <code>T</code> 可以用在 <code>println!(&quot;&#123;:?&#125;&quot;, arr)</code> 中，因为 <code>&#123;:?&#125;</code> 形式的格式化输出需要 <code>arr</code> 实现该特征</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">display_array</span>&lt;T: std::fmt::<span class=\"built_in\">Debug</span>&gt;(arr: &amp;[T]) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;:?&#125;&quot;</span>, arr);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">arr</span>: [<span class=\"type\">i32</span>; <span class=\"number\">3</span>] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">display_array</span>(&amp;arr);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">arr</span>: [<span class=\"type\">i32</span>;<span class=\"number\">2</span>] = [<span class=\"number\">1</span>,<span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">display_array</span>(&amp;arr);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"方式2-const-泛型\"><a href=\"#方式2-const-泛型\" class=\"headerlink\" title=\"方式2: const 泛型\"></a>方式2: const 泛型</h3><p><code>const N: usize</code>，表示 const 泛型 <code>N</code> 基于的值类型是 <code>usize</code></p>\n<p>定义一个类型为 <code>[T; N]</code> 的数组：其中的 <code>N</code> 是一个基于值的泛型参数，因为它用来替代数组的长度</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">display_array</span>&lt;T: std::fmt::<span class=\"built_in\">Debug</span>, <span class=\"keyword\">const</span> N: <span class=\"type\">usize</span>&gt;(arr: [T; N]) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;:?&#125;&quot;</span>, arr);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">arr</span>: [<span class=\"type\">i32</span>; <span class=\"number\">3</span>] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">display_array</span>(arr);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">arr</span>: [<span class=\"type\">i32</span>; <span class=\"number\">2</span>] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">display_array</span>(arr);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"泛型代码的性能\"><a href=\"#泛型代码的性能\" class=\"headerlink\" title=\"泛型代码的性能\"></a>泛型代码的性能</h2><blockquote>\n<p>Rust 通过在编译时进行泛型代码的 <strong>单态化</strong>（<em>monomorphization</em>）来保证效率</p>\n</blockquote>\n<p>对于标准库中的 <code>Option</code> 枚举：</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">integer</span> = <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">5</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">float</span> = <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">5.0</span>);</span><br></pre></td></tr></table></figure></div>\n\n<p>编译器生成的单态化版本的代码看起来像这样（名字为假想的）：</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Option_i32</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Some</span>(<span class=\"type\">i32</span>),</span><br><span class=\"line\">    <span class=\"literal\">None</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Option_f64</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Some</span>(<span class=\"type\">f64</span>),</span><br><span class=\"line\">    <span class=\"literal\">None</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">integer</span> = Option_i32::<span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">5</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">float</span> = Option_f64::<span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">5.0</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>泛型 <code>Option&lt;T&gt;</code> 被编译器替换为了具体的定义。Rust 会将每种情况下的泛型代码编译为具体类型，使用泛型没有运行时开销。代码运行的执行效率和手写每个具体定义的重复代码一样。单态化正是 Rust 泛型在运行时极其高效的原因</p>\n<p>但是，Rust 在编译期为泛型对应的多个类型，生成各自的代码，因此损失了编译速度，且增大了最终生成文件的大小</p>\n","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/17_generics\" >Codes in lesson17<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"泛型的例子\"><a href=\"#泛型的例子\" class=\"headerlink\" title=\"泛型的例子\"></a>泛型的例子</h2><p>用同一功能的函数处理不同类型的数据，例如两个数的加法，无论是整数、浮点数、还是自定义类型，都能支持。在不支持泛型的编程语言中，需要为每种类型编写一个函数：</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">add_i8</span>(a:<span class=\"type\">i8</span>, b:<span class=\"type\">i8</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">i8</span> &#123;</span><br><span class=\"line\">    a + b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">add_i32</span>(a:<span class=\"type\">i32</span>, b:<span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">i32</span> &#123;</span><br><span class=\"line\">    a + b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">add_f64</span>(a:<span class=\"type\">f64</span>, b:<span class=\"type\">f64</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">f64</span> &#123;</span><br><span class=\"line\">    a + b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;add i8: &#123;&#125;&quot;</span>, <span class=\"title function_ invoke__\">add_i8</span>(<span class=\"number\">2i8</span>, <span class=\"number\">3i8</span>));</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;add i32: &#123;&#125;&quot;</span>, <span class=\"title function_ invoke__\">add_i32</span>(<span class=\"number\">20</span>, <span class=\"number\">30</span>));</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;add f64: &#123;&#125;&quot;</span>, <span class=\"title function_ invoke__\">add_f64</span>(<span class=\"number\">1.23</span>, <span class=\"number\">1.23</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"泛型\"><a href=\"#泛型\" class=\"headerlink\" title=\"泛型\"></a>泛型</h3><p>当使用泛型定义函数时，本来在函数签名中指定参数和返回值的类型的地方，会改用泛型来表示。这种技术能使代码适应性更强，从而为函数调用者提供更多的功能，同时也避免了代码重复</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">add</span>&lt;T&gt;(a:T, b:T) <span class=\"punctuation\">-&gt;</span> T &#123;</span><br><span class=\"line\">    a + b</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上面代码的 <code>T</code> 就是<strong>泛型参数</strong>，泛型参数的名称可以为任意，但是惯例一般用 <code>T</code>作为首选。该名称越短越好，除非需要表达含义</p>\n<p>不是所有 <code>T</code> 类型都能进行相加操作，因此需要用 <code>std::ops::Add&lt;Output = T&gt;</code> 对 <code>T</code> 进行限制：</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">add</span>&lt;T: std::ops::Add&lt;Output = T&gt;&gt;(a: T, b: T) <span class=\"punctuation\">-&gt;</span> T &#123;</span><br><span class=\"line\">    a + b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;add i8: &#123;&#125;&quot;</span>, <span class=\"title function_ invoke__\">add</span>(<span class=\"number\">2i8</span>, <span class=\"number\">3i8</span>));</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;add i32: &#123;&#125;&quot;</span>, <span class=\"title function_ invoke__\">add</span>(<span class=\"number\">20</span>, <span class=\"number\">30</span>));</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;add f64: &#123;&#125;&quot;</span>, <span class=\"title function_ invoke__\">add</span>(<span class=\"number\">1.23</span>, <span class=\"number\">1.23</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"在函数定义中使用泛型\"><a href=\"#在函数定义中使用泛型\" class=\"headerlink\" title=\"在函数定义中使用泛型\"></a>在函数定义中使用泛型</h2><p>不是所有的类型都能进行比较，使用标准库中定义的 <code>std::cmp::PartialOrd</code> trait 可以实现类型的比较功能，限制 <code>T</code> 只对实现了 <code>PartialOrd</code> 的类型有效（<code>i32</code> 和 <code>char</code>）</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">largest</span>&lt;T: std::cmp::<span class=\"built_in\">PartialOrd</span>&gt;(list: &amp;[T]) <span class=\"punctuation\">-&gt;</span> &amp;T &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">largest</span> = &amp;list[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"variable\">item</span> <span class=\"keyword\">in</span> list &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> item &gt; largest &#123;</span><br><span class=\"line\">            largest = item;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    largest</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">number_list</span> = <span class=\"built_in\">vec!</span>[<span class=\"number\">34</span>, <span class=\"number\">50</span>, <span class=\"number\">25</span>, <span class=\"number\">100</span>, <span class=\"number\">65</span>];</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">result</span> = <span class=\"title function_ invoke__\">largest</span>(&amp;number_list);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;The largest number is &#123;&#125;&quot;</span>, result);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">char_list</span> = <span class=\"built_in\">vec!</span>[<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"string\">&#x27;m&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;q&#x27;</span>];</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">result</span> = <span class=\"title function_ invoke__\">largest</span>(&amp;char_list);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;The largest char is &#123;&#125;&quot;</span>, result);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"结构体定义中的泛型\"><a href=\"#结构体定义中的泛型\" class=\"headerlink\" title=\"结构体定义中的泛型\"></a>结构体定义中的泛型</h2><ul>\n<li>结构体名称后面的尖括号中声明泛型参数的名称，结构体定义中可以指定具体数据类型的位置</li>\n<li>x 和 y 是相同的类型</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Point</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    x: T,</span><br><span class=\"line\">    y: T,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">integer</span> = Point &#123; x: <span class=\"number\">5</span>, y: <span class=\"number\">10</span> &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">float</span> = Point &#123; x: <span class=\"number\">1.0</span>, y: <span class=\"number\">4.0</span> &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// let wont_work = Point &#123; x: 5, y: 4.0 &#125;; // error: mismatched types</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>定义一个 <code>x</code> 和 <code>y</code> 有不同类型且仍是泛型的 <code>Point</code> 结构体：</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Point</span>&lt;T, U&gt; &#123;</span><br><span class=\"line\">    x: T,</span><br><span class=\"line\">    y: U,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">both_integer</span> = Point &#123; x: <span class=\"number\">5</span>, y: <span class=\"number\">10</span> &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">both_float</span> = Point &#123; x: <span class=\"number\">1.0</span>, y: <span class=\"number\">4.0</span> &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">integer_and_float</span> = Point &#123; x: <span class=\"number\">5</span>, y: <span class=\"number\">4.0</span> &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"枚举中使用泛型\"><a href=\"#枚举中使用泛型\" class=\"headerlink\" title=\"枚举中使用泛型\"></a>枚举中使用泛型</h2><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Option</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Some</span>(T),</span><br><span class=\"line\">    <span class=\"literal\">None</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Result</span>&lt;T, E&gt; &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Ok</span>(T),</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Err</span>(E),</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"方法中使用泛型\"><a href=\"#方法中使用泛型\" class=\"headerlink\" title=\"方法中使用泛型\"></a>方法中使用泛型</h2><p>其他 <code>T</code> 不是 <code>i32</code> 类型的 <code>Point&lt;T&gt;</code> 实例没有定义此方法</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Point</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    x: T,</span><br><span class=\"line\">    y: T,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Point</span>&lt;<span class=\"type\">i32</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">x</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"type\">i32</span> &#123;</span><br><span class=\"line\">        &amp;<span class=\"keyword\">self</span>.x</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"impl-之后声明泛型-T\"><a href=\"#impl-之后声明泛型-T\" class=\"headerlink\" title=\"impl 之后声明泛型 T\"></a><code>impl</code> 之后声明泛型 <code>T</code></h4><p>泛型参数可以与结构体定义中声明的泛型参数不同</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Point</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    x: T,</span><br><span class=\"line\">    y: T,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span>&lt;T&gt; Point&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">x</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> &amp;T &#123;</span><br><span class=\"line\">        &amp;<span class=\"keyword\">self</span>.x</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"方法使用了与结构体定义中不同类型的泛型\"><a href=\"#方法使用了与结构体定义中不同类型的泛型\" class=\"headerlink\" title=\"方法使用了与结构体定义中不同类型的泛型\"></a>方法使用了与结构体定义中不同类型的泛型</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Point</span>&lt;X1, Y1&gt; &#123;</span><br><span class=\"line\">    x: X1,</span><br><span class=\"line\">    y: Y1,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span>&lt;X1, Y1&gt; Point&lt;X1, Y1&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">mixup</span>&lt;X2, Y2&gt;(<span class=\"keyword\">self</span>, other: Point&lt;X2, Y2&gt;) <span class=\"punctuation\">-&gt;</span> Point&lt;X1, Y2&gt; &#123;</span><br><span class=\"line\">        Point &#123;</span><br><span class=\"line\">            x: <span class=\"keyword\">self</span>.x,</span><br><span class=\"line\">            y: other.y,</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">p1</span> = Point &#123; x: <span class=\"number\">5</span>, y: <span class=\"number\">10.4</span> &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">p2</span> = Point &#123; x: <span class=\"string\">&quot;Hello&quot;</span>, y: <span class=\"string\">&#x27;c&#x27;</span> &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">p3</span> = p1.<span class=\"title function_ invoke__\">mixup</span>(p2); <span class=\"comment\">// &#123;x: 5, y: c&#125;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"const-泛型（Rust-1-51-版本引入的重要特性）\"><a href=\"#const-泛型（Rust-1-51-版本引入的重要特性）\" class=\"headerlink\" title=\"const 泛型（Rust 1.51 版本引入的重要特性）\"></a>const 泛型（Rust 1.51 版本引入的重要特性）</h2><p><code>[i32; 3]</code> 和 <code>[i32; 2]</code> 确实是两个完全不同的类型，因此无法用同一个函数调用</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">display_array</span>(arr: [<span class=\"type\">i32</span>; <span class=\"number\">3</span>]) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;:?&#125;&quot;</span>, arr);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">arr</span>: [<span class=\"type\">i32</span>; <span class=\"number\">3</span>] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">display_array</span>(arr);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">arr</span>: [<span class=\"type\">i32</span>; <span class=\"number\">2</span>] = [<span class=\"number\">1</span>,<span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"comment\">// display_array(arr); // error: mismatched types</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"方式1-切片-泛型\"><a href=\"#方式1-切片-泛型\" class=\"headerlink\" title=\"方式1: 切片+泛型\"></a>方式1: 切片+泛型</h3><ul>\n<li>使用数组切片，传入 <code>arr</code> 的不可变引用</li>\n<li><code>i32</code> 改成所有类型T的数组</li>\n<li>需要对 <code>T</code> 加一个限制 <code>std::fmt::Debug</code>，表明 <code>T</code> 可以用在 <code>println!(&quot;&#123;:?&#125;&quot;, arr)</code> 中，因为 <code>&#123;:?&#125;</code> 形式的格式化输出需要 <code>arr</code> 实现该特征</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">display_array</span>&lt;T: std::fmt::<span class=\"built_in\">Debug</span>&gt;(arr: &amp;[T]) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;:?&#125;&quot;</span>, arr);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">arr</span>: [<span class=\"type\">i32</span>; <span class=\"number\">3</span>] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">display_array</span>(&amp;arr);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">arr</span>: [<span class=\"type\">i32</span>;<span class=\"number\">2</span>] = [<span class=\"number\">1</span>,<span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">display_array</span>(&amp;arr);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"方式2-const-泛型\"><a href=\"#方式2-const-泛型\" class=\"headerlink\" title=\"方式2: const 泛型\"></a>方式2: const 泛型</h3><p><code>const N: usize</code>，表示 const 泛型 <code>N</code> 基于的值类型是 <code>usize</code></p>\n<p>定义一个类型为 <code>[T; N]</code> 的数组：其中的 <code>N</code> 是一个基于值的泛型参数，因为它用来替代数组的长度</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">display_array</span>&lt;T: std::fmt::<span class=\"built_in\">Debug</span>, <span class=\"keyword\">const</span> N: <span class=\"type\">usize</span>&gt;(arr: [T; N]) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;:?&#125;&quot;</span>, arr);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">arr</span>: [<span class=\"type\">i32</span>; <span class=\"number\">3</span>] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">display_array</span>(arr);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">arr</span>: [<span class=\"type\">i32</span>; <span class=\"number\">2</span>] = [<span class=\"number\">1</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">display_array</span>(arr);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"泛型代码的性能\"><a href=\"#泛型代码的性能\" class=\"headerlink\" title=\"泛型代码的性能\"></a>泛型代码的性能</h2><blockquote>\n<p>Rust 通过在编译时进行泛型代码的 <strong>单态化</strong>（<em>monomorphization</em>）来保证效率</p>\n</blockquote>\n<p>对于标准库中的 <code>Option</code> 枚举：</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">integer</span> = <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">5</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">float</span> = <span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">5.0</span>);</span><br></pre></td></tr></table></figure>\n\n<p>编译器生成的单态化版本的代码看起来像这样（名字为假想的）：</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Option_i32</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Some</span>(<span class=\"type\">i32</span>),</span><br><span class=\"line\">    <span class=\"literal\">None</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">Option_f64</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Some</span>(<span class=\"type\">f64</span>),</span><br><span class=\"line\">    <span class=\"literal\">None</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">integer</span> = Option_i32::<span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">5</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">float</span> = Option_f64::<span class=\"title function_ invoke__\">Some</span>(<span class=\"number\">5.0</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>泛型 <code>Option&lt;T&gt;</code> 被编译器替换为了具体的定义。Rust 会将每种情况下的泛型代码编译为具体类型，使用泛型没有运行时开销。代码运行的执行效率和手写每个具体定义的重复代码一样。单态化正是 Rust 泛型在运行时极其高效的原因</p>\n<p>但是，Rust 在编译期为泛型对应的多个类型，生成各自的代码，因此损失了编译速度，且增大了最终生成文件的大小</p>\n","_processedHighlight":true},{"title":"IB-Rust-生命周期","date":"2025-06-05T15:40:26.000Z","_content":"\n[Codes in lesson18](https://github.com/Zoella-w/IB-Rust/tree/main/18_lifetime)\n\n\n## 创建生命周期\n\n⽣命周期主要通过⽣命周期注解来创建和使⽤。⽣命周期注解是⼀种显式声明引⽤有效时间的⽅式，通常⽤'a、'b 这样的符号表示\n\n## 生命周期类别\n\n### fn\n\n'a ⽣命周期注解 表明返回值的⽣命周期与输⼊参数的⽣命周期相同：\n\n```rust\nfn longest<'a>(x: &'a str, y: &'a str) -> &'a str {\n    if x.len() > y.len() { x } else { y }\n}\n```\n\n### struct\n\n```rust\nstruct Example<'a> {\n    part: &'a str,\n}\n```\n\n### enum\n\n```rust\nenum StringOption<'a> {\n    Some(&'a str),\n    None,\n}\n```\n\n## 生命周期消除（Lifetime Elision）\n\n> rust 编译期自动推理，无需手动重复添加\n\n- 每个引⽤参数都有⾃⼰的⽣命周期参数\n- 如果只有⼀个输⼊引⽤参数，那么它的⽣命周期会被赋予所有输出引⽤\n- 如果有多个输⼊⽣命周期参数，但其中⼀个是 `&self` 或 `&mut self`，那么 `self` 的⽣命周期会被赋予所有输出引⽤\n\n```rust\nfn _first_word(s: &str) -> &str {\n    &s[..1]\n}\n// 返回值不包含引⽤，⽆需标注\nfn _add(a: &i32, b: &i32) -> i32 {\n    *a + *b\n}\n// 只包含⼀个 输入引⽤参数，输出引用的⽣命周期与其⼀致\nfn _identity(a: &i32) -> &i32 {\n    a\n}\n```\n\n## 特殊生命周期标注\n\n`'static` ⽣命周期表示整个程序运⾏期间都有效的⽣命周期，通常⽤于**全局变量**或**字符串字⾯量**\n\n```rust\n let s: &'static str = \"hello\";\n\nconst SOME_COORDINATE: (i32, i32) = (7, 4);\nlet static_reference: &'static (i32, i32) = &SOME_COORDINATE;\n\nstruct Counter<'a> {\n    counter: &'a mut i32,\n}\n// 方法中没有需要显示指定的生命周期，可以用占位符默认匹配\nimpl Counter<'_> {\n    fn increment(&mut self) {\n        *self.counter += 1;\n    }\n}\n```\n\n## 生命周期约束\n\n生命周期注解可以用来约束多个引用之间的关系\n\n'b: 'a 表示⽣命周期'b 必须不短于'a：\n\n```rust\nfn example<'a, 'b>(x: &'a str, y: &'b str) -> &'a str\nwhere\n    'b: 'a,\n{\n    x\n}\n```\n\n## ⽣命周期⼦类型和协变\n\n⽣命周期可以有⼦类型关系，较短的⽣命周期可以被视为较⻓⽣命周期的⼦类型。这在协变（convariance）中尤为重要\n\n```rust\nfn _example1<'a, 'b>(x: &'a str, y: &'b str) -> &'a str\nwhere\n    'a: 'b,\n{\n    x\n}\n```\n\n## 课后习题\n\n修改如下代码，使得编译通过，并解释为什么？\n\n进阶： 还有⼏种解法可以实现，你能通过修改⼀个⽣命周期参数实现吗？\n\n```rust\nfn test_lifetime_multiple() {\n    fn insert_value<'a, 'b>(my_vec: &'a mut Vec<&'a i32>, value: &'b i32) {\n        my_vec.push(value)\n    }\n    let mut my_vec: Vec<&i32> = vec![];\n    let val1 = 1;\n    let val2 = 2;\n    let a = &mut my_vec;\n    insert_value(a, &val1);\n    println!(\"a is {:?} \", a);\n    let b = &mut my_vec;\n    insert_value(b, &val2);\n    println!(\"b is {:?}\", b);\n    println!(\"{my_vec:?}\");\n}\n```\n\n### 解决方法：\n\n\n`&'a mut Vec<&'a i32>` 是错误的，`my_vec` 和 `其中存储的元素引用` 的生命周期不能相同，因为有如下冲突：\n- 第一次调用后，向量要求所有元素具有生命周期'α1\n- 但第二次调用要求元素具有生命周期'α2\n- 'α1和'α2是不同的具体生命周期实例\n- 向量不能存储具有不同生命周期的引用\n\n```rust\nlet a = &mut my_vec;  // [1] 借用开始，设为生命周期'α1\ninsert_value(a, &val1); // [2] 要求val1生命周期 ≥ 'α1\n                        // 并强制存储元素的生命周期为'α1\nprintln!(\"a is {:?} \", a); // [3] a最后一次使用\n\nlet b = &mut my_vec;  // [4] 新借用开始，设为生命周期'α2\ninsert_value(b, &val2); // [5] 要求存储元素生命周期为'α2\n```\n\n#### 正确代码：\n\n```rust\nfn _test_lifetime_multiple() {\n    fn insert_value<'a>(my_vec: &mut Vec<&'a i32>, value: &'a i32) {\n        my_vec.push(value)\n    }\n    let mut my_vec: Vec<&i32> = vec![];\n    let val1 = 1;\n    let val2 = 2;\n    let a = &mut my_vec;\n    insert_value(a, &val1);\n    println!(\"a is {:?} \", a);\n    let b = &mut my_vec;\n    insert_value(b, &val2);\n    println!(\"b is {:?}\", b);\n    println!(\"{my_vec:?}\");\n}\n```\n","source":"_posts/76-IB-Rust-生命周期.md","raw":"---\ntitle: IB-Rust-生命周期\ndate: 2025-06-05 23:40:26\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson18](https://github.com/Zoella-w/IB-Rust/tree/main/18_lifetime)\n\n\n## 创建生命周期\n\n⽣命周期主要通过⽣命周期注解来创建和使⽤。⽣命周期注解是⼀种显式声明引⽤有效时间的⽅式，通常⽤'a、'b 这样的符号表示\n\n## 生命周期类别\n\n### fn\n\n'a ⽣命周期注解 表明返回值的⽣命周期与输⼊参数的⽣命周期相同：\n\n```rust\nfn longest<'a>(x: &'a str, y: &'a str) -> &'a str {\n    if x.len() > y.len() { x } else { y }\n}\n```\n\n### struct\n\n```rust\nstruct Example<'a> {\n    part: &'a str,\n}\n```\n\n### enum\n\n```rust\nenum StringOption<'a> {\n    Some(&'a str),\n    None,\n}\n```\n\n## 生命周期消除（Lifetime Elision）\n\n> rust 编译期自动推理，无需手动重复添加\n\n- 每个引⽤参数都有⾃⼰的⽣命周期参数\n- 如果只有⼀个输⼊引⽤参数，那么它的⽣命周期会被赋予所有输出引⽤\n- 如果有多个输⼊⽣命周期参数，但其中⼀个是 `&self` 或 `&mut self`，那么 `self` 的⽣命周期会被赋予所有输出引⽤\n\n```rust\nfn _first_word(s: &str) -> &str {\n    &s[..1]\n}\n// 返回值不包含引⽤，⽆需标注\nfn _add(a: &i32, b: &i32) -> i32 {\n    *a + *b\n}\n// 只包含⼀个 输入引⽤参数，输出引用的⽣命周期与其⼀致\nfn _identity(a: &i32) -> &i32 {\n    a\n}\n```\n\n## 特殊生命周期标注\n\n`'static` ⽣命周期表示整个程序运⾏期间都有效的⽣命周期，通常⽤于**全局变量**或**字符串字⾯量**\n\n```rust\n let s: &'static str = \"hello\";\n\nconst SOME_COORDINATE: (i32, i32) = (7, 4);\nlet static_reference: &'static (i32, i32) = &SOME_COORDINATE;\n\nstruct Counter<'a> {\n    counter: &'a mut i32,\n}\n// 方法中没有需要显示指定的生命周期，可以用占位符默认匹配\nimpl Counter<'_> {\n    fn increment(&mut self) {\n        *self.counter += 1;\n    }\n}\n```\n\n## 生命周期约束\n\n生命周期注解可以用来约束多个引用之间的关系\n\n'b: 'a 表示⽣命周期'b 必须不短于'a：\n\n```rust\nfn example<'a, 'b>(x: &'a str, y: &'b str) -> &'a str\nwhere\n    'b: 'a,\n{\n    x\n}\n```\n\n## ⽣命周期⼦类型和协变\n\n⽣命周期可以有⼦类型关系，较短的⽣命周期可以被视为较⻓⽣命周期的⼦类型。这在协变（convariance）中尤为重要\n\n```rust\nfn _example1<'a, 'b>(x: &'a str, y: &'b str) -> &'a str\nwhere\n    'a: 'b,\n{\n    x\n}\n```\n\n## 课后习题\n\n修改如下代码，使得编译通过，并解释为什么？\n\n进阶： 还有⼏种解法可以实现，你能通过修改⼀个⽣命周期参数实现吗？\n\n```rust\nfn test_lifetime_multiple() {\n    fn insert_value<'a, 'b>(my_vec: &'a mut Vec<&'a i32>, value: &'b i32) {\n        my_vec.push(value)\n    }\n    let mut my_vec: Vec<&i32> = vec![];\n    let val1 = 1;\n    let val2 = 2;\n    let a = &mut my_vec;\n    insert_value(a, &val1);\n    println!(\"a is {:?} \", a);\n    let b = &mut my_vec;\n    insert_value(b, &val2);\n    println!(\"b is {:?}\", b);\n    println!(\"{my_vec:?}\");\n}\n```\n\n### 解决方法：\n\n\n`&'a mut Vec<&'a i32>` 是错误的，`my_vec` 和 `其中存储的元素引用` 的生命周期不能相同，因为有如下冲突：\n- 第一次调用后，向量要求所有元素具有生命周期'α1\n- 但第二次调用要求元素具有生命周期'α2\n- 'α1和'α2是不同的具体生命周期实例\n- 向量不能存储具有不同生命周期的引用\n\n```rust\nlet a = &mut my_vec;  // [1] 借用开始，设为生命周期'α1\ninsert_value(a, &val1); // [2] 要求val1生命周期 ≥ 'α1\n                        // 并强制存储元素的生命周期为'α1\nprintln!(\"a is {:?} \", a); // [3] a最后一次使用\n\nlet b = &mut my_vec;  // [4] 新借用开始，设为生命周期'α2\ninsert_value(b, &val2); // [5] 要求存储元素生命周期为'α2\n```\n\n#### 正确代码：\n\n```rust\nfn _test_lifetime_multiple() {\n    fn insert_value<'a>(my_vec: &mut Vec<&'a i32>, value: &'a i32) {\n        my_vec.push(value)\n    }\n    let mut my_vec: Vec<&i32> = vec![];\n    let val1 = 1;\n    let val2 = 2;\n    let a = &mut my_vec;\n    insert_value(a, &val1);\n    println!(\"a is {:?} \", a);\n    let b = &mut my_vec;\n    insert_value(b, &val2);\n    println!(\"b is {:?}\", b);\n    println!(\"{my_vec:?}\");\n}\n```\n","slug":"76-IB-Rust-生命周期","published":1,"updated":"2025-06-09T06:38:22.373Z","_id":"cmbomsf5400005rprhhgs6eb9","comments":1,"layout":"post","photos":[],"link":"","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/18_lifetime\" >Codes in lesson18<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"创建生命周期\"><a href=\"#创建生命周期\" class=\"headerlink\" title=\"创建生命周期\"></a>创建生命周期</h2><p>⽣命周期主要通过⽣命周期注解来创建和使⽤。⽣命周期注解是⼀种显式声明引⽤有效时间的⽅式，通常⽤’a、’b 这样的符号表示</p>\n<h2 id=\"生命周期类别\"><a href=\"#生命周期类别\" class=\"headerlink\" title=\"生命周期类别\"></a>生命周期类别</h2><h3 id=\"fn\"><a href=\"#fn\" class=\"headerlink\" title=\"fn\"></a>fn</h3><p>‘a ⽣命周期注解 表明返回值的⽣命周期与输⼊参数的⽣命周期相同：</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">longest</span>&lt;<span class=\"symbol\">&#x27;a</span>&gt;(x: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span>, y: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> x.<span class=\"title function_ invoke__\">len</span>() &gt; y.<span class=\"title function_ invoke__\">len</span>() &#123; x &#125; <span class=\"keyword\">else</span> &#123; y &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"struct\"><a href=\"#struct\" class=\"headerlink\" title=\"struct\"></a>struct</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Example</span>&lt;<span class=\"symbol\">&#x27;a</span>&gt; &#123;</span><br><span class=\"line\">    part: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"enum\"><a href=\"#enum\" class=\"headerlink\" title=\"enum\"></a>enum</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">StringOption</span>&lt;<span class=\"symbol\">&#x27;a</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span>),</span><br><span class=\"line\">    <span class=\"literal\">None</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"生命周期消除（Lifetime-Elision）\"><a href=\"#生命周期消除（Lifetime-Elision）\" class=\"headerlink\" title=\"生命周期消除（Lifetime Elision）\"></a>生命周期消除（Lifetime Elision）</h2><blockquote>\n<p>rust 编译期自动推理，无需手动重复添加</p>\n</blockquote>\n<ul>\n<li>每个引⽤参数都有⾃⼰的⽣命周期参数</li>\n<li>如果只有⼀个输⼊引⽤参数，那么它的⽣命周期会被赋予所有输出引⽤</li>\n<li>如果有多个输⼊⽣命周期参数，但其中⼀个是 <code>&amp;self</code> 或 <code>&amp;mut self</code>，那么 <code>self</code> 的⽣命周期会被赋予所有输出引⽤</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">_first_word</span>(s: &amp;<span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"type\">str</span> &#123;</span><br><span class=\"line\">    &amp;s[..<span class=\"number\">1</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 返回值不包含引⽤，⽆需标注</span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">_add</span>(a: &amp;<span class=\"type\">i32</span>, b: &amp;<span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">i32</span> &#123;</span><br><span class=\"line\">    *a + *b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 只包含⼀个 输入引⽤参数，输出引用的⽣命周期与其⼀致</span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">_identity</span>(a: &amp;<span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"type\">i32</span> &#123;</span><br><span class=\"line\">    a</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"特殊生命周期标注\"><a href=\"#特殊生命周期标注\" class=\"headerlink\" title=\"特殊生命周期标注\"></a>特殊生命周期标注</h2><p><code>&#39;static</code> ⽣命周期表示整个程序运⾏期间都有效的⽣命周期，通常⽤于<strong>全局变量</strong>或<strong>字符串字⾯量</strong></p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">let</span> <span class=\"variable\">s</span>: &amp;<span class=\"symbol\">&#x27;static</span> <span class=\"type\">str</span> = <span class=\"string\">&quot;hello&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> SOME_COORDINATE: (<span class=\"type\">i32</span>, <span class=\"type\">i32</span>) = (<span class=\"number\">7</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">static_reference</span>: &amp;<span class=\"symbol\">&#x27;static</span> (<span class=\"type\">i32</span>, <span class=\"type\">i32</span>) = &amp;SOME_COORDINATE;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Counter</span>&lt;<span class=\"symbol\">&#x27;a</span>&gt; &#123;</span><br><span class=\"line\">    counter: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"keyword\">mut</span> <span class=\"type\">i32</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 方法中没有需要显示指定的生命周期，可以用占位符默认匹配</span></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Counter</span>&lt;<span class=\"symbol\">&#x27;_</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">increment</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        *<span class=\"keyword\">self</span>.counter += <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"生命周期约束\"><a href=\"#生命周期约束\" class=\"headerlink\" title=\"生命周期约束\"></a>生命周期约束</h2><p>生命周期注解可以用来约束多个引用之间的关系</p>\n<p>‘b: ‘a 表示⽣命周期’b 必须不短于’a：</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">example</span>&lt;<span class=\"symbol\">&#x27;a</span>, <span class=\"symbol\">&#x27;b</span>&gt;(x: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span>, y: &amp;<span class=\"symbol\">&#x27;b</span> <span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span></span><br><span class=\"line\"><span class=\"keyword\">where</span></span><br><span class=\"line\">    <span class=\"symbol\">&#x27;b</span>: <span class=\"symbol\">&#x27;a</span>,</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    x</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"⽣命周期⼦类型和协变\"><a href=\"#⽣命周期⼦类型和协变\" class=\"headerlink\" title=\"⽣命周期⼦类型和协变\"></a>⽣命周期⼦类型和协变</h2><p>⽣命周期可以有⼦类型关系，较短的⽣命周期可以被视为较⻓⽣命周期的⼦类型。这在协变（convariance）中尤为重要</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">_example1</span>&lt;<span class=\"symbol\">&#x27;a</span>, <span class=\"symbol\">&#x27;b</span>&gt;(x: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span>, y: &amp;<span class=\"symbol\">&#x27;b</span> <span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span></span><br><span class=\"line\"><span class=\"keyword\">where</span></span><br><span class=\"line\">    <span class=\"symbol\">&#x27;a</span>: <span class=\"symbol\">&#x27;b</span>,</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    x</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"课后习题\"><a href=\"#课后习题\" class=\"headerlink\" title=\"课后习题\"></a>课后习题</h2><p>修改如下代码，使得编译通过，并解释为什么？</p>\n<p>进阶： 还有⼏种解法可以实现，你能通过修改⼀个⽣命周期参数实现吗？</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">test_lifetime_multiple</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">insert_value</span>&lt;<span class=\"symbol\">&#x27;a</span>, <span class=\"symbol\">&#x27;b</span>&gt;(my_vec: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"keyword\">mut</span> <span class=\"type\">Vec</span>&lt;&amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">i32</span>&gt;, value: &amp;<span class=\"symbol\">&#x27;b</span> <span class=\"type\">i32</span>) &#123;</span><br><span class=\"line\">        my_vec.<span class=\"title function_ invoke__\">push</span>(value)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">my_vec</span>: <span class=\"type\">Vec</span>&lt;&amp;<span class=\"type\">i32</span>&gt; = <span class=\"built_in\">vec!</span>[];</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">val1</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">val2</span> = <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">a</span> = &amp;<span class=\"keyword\">mut</span> my_vec;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">insert_value</span>(a, &amp;val1);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;a is &#123;:?&#125; &quot;</span>, a);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">b</span> = &amp;<span class=\"keyword\">mut</span> my_vec;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">insert_value</span>(b, &amp;val2);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;b is &#123;:?&#125;&quot;</span>, b);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;my_vec:?&#125;&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"解决方法：\"><a href=\"#解决方法：\" class=\"headerlink\" title=\"解决方法：\"></a>解决方法：</h3><p><code>&amp;&#39;a mut Vec&lt;&amp;&#39;a i32&gt;</code> 是错误的，<code>my_vec</code> 和 <code>其中存储的元素引用</code> 的生命周期不能相同，因为有如下冲突：</p>\n<ul>\n<li>第一次调用后，向量要求所有元素具有生命周期’α1</li>\n<li>但第二次调用要求元素具有生命周期’α2</li>\n<li>‘α1和’α2是不同的具体生命周期实例</li>\n<li>向量不能存储具有不同生命周期的引用</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">a</span> = &amp;<span class=\"keyword\">mut</span> my_vec;  <span class=\"comment\">// [1] 借用开始，设为生命周期&#x27;α1</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">insert_value</span>(a, &amp;val1); <span class=\"comment\">// [2] 要求val1生命周期 ≥ &#x27;α1</span></span><br><span class=\"line\">                        <span class=\"comment\">// 并强制存储元素的生命周期为&#x27;α1</span></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;a is &#123;:?&#125; &quot;</span>, a); <span class=\"comment\">// [3] a最后一次使用</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">b</span> = &amp;<span class=\"keyword\">mut</span> my_vec;  <span class=\"comment\">// [4] 新借用开始，设为生命周期&#x27;α2</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">insert_value</span>(b, &amp;val2); <span class=\"comment\">// [5] 要求存储元素生命周期为&#x27;α2</span></span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"正确代码：\"><a href=\"#正确代码：\" class=\"headerlink\" title=\"正确代码：\"></a>正确代码：</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">_test_lifetime_multiple</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">insert_value</span>&lt;<span class=\"symbol\">&#x27;a</span>&gt;(my_vec: &amp;<span class=\"keyword\">mut</span> <span class=\"type\">Vec</span>&lt;&amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">i32</span>&gt;, value: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">i32</span>) &#123;</span><br><span class=\"line\">        my_vec.<span class=\"title function_ invoke__\">push</span>(value)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">my_vec</span>: <span class=\"type\">Vec</span>&lt;&amp;<span class=\"type\">i32</span>&gt; = <span class=\"built_in\">vec!</span>[];</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">val1</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">val2</span> = <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">a</span> = &amp;<span class=\"keyword\">mut</span> my_vec;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">insert_value</span>(a, &amp;val1);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;a is &#123;:?&#125; &quot;</span>, a);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">b</span> = &amp;<span class=\"keyword\">mut</span> my_vec;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">insert_value</span>(b, &amp;val2);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;b is &#123;:?&#125;&quot;</span>, b);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;my_vec:?&#125;&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/18_lifetime\" >Codes in lesson18<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"创建生命周期\"><a href=\"#创建生命周期\" class=\"headerlink\" title=\"创建生命周期\"></a>创建生命周期</h2><p>⽣命周期主要通过⽣命周期注解来创建和使⽤。⽣命周期注解是⼀种显式声明引⽤有效时间的⽅式，通常⽤’a、’b 这样的符号表示</p>\n<h2 id=\"生命周期类别\"><a href=\"#生命周期类别\" class=\"headerlink\" title=\"生命周期类别\"></a>生命周期类别</h2><h3 id=\"fn\"><a href=\"#fn\" class=\"headerlink\" title=\"fn\"></a>fn</h3><p>‘a ⽣命周期注解 表明返回值的⽣命周期与输⼊参数的⽣命周期相同：</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">longest</span>&lt;<span class=\"symbol\">&#x27;a</span>&gt;(x: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span>, y: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> x.<span class=\"title function_ invoke__\">len</span>() &gt; y.<span class=\"title function_ invoke__\">len</span>() &#123; x &#125; <span class=\"keyword\">else</span> &#123; y &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"struct\"><a href=\"#struct\" class=\"headerlink\" title=\"struct\"></a>struct</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Example</span>&lt;<span class=\"symbol\">&#x27;a</span>&gt; &#123;</span><br><span class=\"line\">    part: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"enum\"><a href=\"#enum\" class=\"headerlink\" title=\"enum\"></a>enum</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">StringOption</span>&lt;<span class=\"symbol\">&#x27;a</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Some</span>(&amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span>),</span><br><span class=\"line\">    <span class=\"literal\">None</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"生命周期消除（Lifetime-Elision）\"><a href=\"#生命周期消除（Lifetime-Elision）\" class=\"headerlink\" title=\"生命周期消除（Lifetime Elision）\"></a>生命周期消除（Lifetime Elision）</h2><blockquote>\n<p>rust 编译期自动推理，无需手动重复添加</p>\n</blockquote>\n<ul>\n<li>每个引⽤参数都有⾃⼰的⽣命周期参数</li>\n<li>如果只有⼀个输⼊引⽤参数，那么它的⽣命周期会被赋予所有输出引⽤</li>\n<li>如果有多个输⼊⽣命周期参数，但其中⼀个是 <code>&amp;self</code> 或 <code>&amp;mut self</code>，那么 <code>self</code> 的⽣命周期会被赋予所有输出引⽤</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">_first_word</span>(s: &amp;<span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"type\">str</span> &#123;</span><br><span class=\"line\">    &amp;s[..<span class=\"number\">1</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 返回值不包含引⽤，⽆需标注</span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">_add</span>(a: &amp;<span class=\"type\">i32</span>, b: &amp;<span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">i32</span> &#123;</span><br><span class=\"line\">    *a + *b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 只包含⼀个 输入引⽤参数，输出引用的⽣命周期与其⼀致</span></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">_identity</span>(a: &amp;<span class=\"type\">i32</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"type\">i32</span> &#123;</span><br><span class=\"line\">    a</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"特殊生命周期标注\"><a href=\"#特殊生命周期标注\" class=\"headerlink\" title=\"特殊生命周期标注\"></a>特殊生命周期标注</h2><p><code>&#39;static</code> ⽣命周期表示整个程序运⾏期间都有效的⽣命周期，通常⽤于<strong>全局变量</strong>或<strong>字符串字⾯量</strong></p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">let</span> <span class=\"variable\">s</span>: &amp;<span class=\"symbol\">&#x27;static</span> <span class=\"type\">str</span> = <span class=\"string\">&quot;hello&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> SOME_COORDINATE: (<span class=\"type\">i32</span>, <span class=\"type\">i32</span>) = (<span class=\"number\">7</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">static_reference</span>: &amp;<span class=\"symbol\">&#x27;static</span> (<span class=\"type\">i32</span>, <span class=\"type\">i32</span>) = &amp;SOME_COORDINATE;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Counter</span>&lt;<span class=\"symbol\">&#x27;a</span>&gt; &#123;</span><br><span class=\"line\">    counter: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"keyword\">mut</span> <span class=\"type\">i32</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 方法中没有需要显示指定的生命周期，可以用占位符默认匹配</span></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Counter</span>&lt;<span class=\"symbol\">&#x27;_</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">increment</span>(&amp;<span class=\"keyword\">mut</span> <span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        *<span class=\"keyword\">self</span>.counter += <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"生命周期约束\"><a href=\"#生命周期约束\" class=\"headerlink\" title=\"生命周期约束\"></a>生命周期约束</h2><p>生命周期注解可以用来约束多个引用之间的关系</p>\n<p>‘b: ‘a 表示⽣命周期’b 必须不短于’a：</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">example</span>&lt;<span class=\"symbol\">&#x27;a</span>, <span class=\"symbol\">&#x27;b</span>&gt;(x: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span>, y: &amp;<span class=\"symbol\">&#x27;b</span> <span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span></span><br><span class=\"line\"><span class=\"keyword\">where</span></span><br><span class=\"line\">    <span class=\"symbol\">&#x27;b</span>: <span class=\"symbol\">&#x27;a</span>,</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    x</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"⽣命周期⼦类型和协变\"><a href=\"#⽣命周期⼦类型和协变\" class=\"headerlink\" title=\"⽣命周期⼦类型和协变\"></a>⽣命周期⼦类型和协变</h2><p>⽣命周期可以有⼦类型关系，较短的⽣命周期可以被视为较⻓⽣命周期的⼦类型。这在协变（convariance）中尤为重要</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">_example1</span>&lt;<span class=\"symbol\">&#x27;a</span>, <span class=\"symbol\">&#x27;b</span>&gt;(x: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span>, y: &amp;<span class=\"symbol\">&#x27;b</span> <span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">str</span></span><br><span class=\"line\"><span class=\"keyword\">where</span></span><br><span class=\"line\">    <span class=\"symbol\">&#x27;a</span>: <span class=\"symbol\">&#x27;b</span>,</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    x</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"课后习题\"><a href=\"#课后习题\" class=\"headerlink\" title=\"课后习题\"></a>课后习题</h2><p>修改如下代码，使得编译通过，并解释为什么？</p>\n<p>进阶： 还有⼏种解法可以实现，你能通过修改⼀个⽣命周期参数实现吗？</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">test_lifetime_multiple</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">insert_value</span>&lt;<span class=\"symbol\">&#x27;a</span>, <span class=\"symbol\">&#x27;b</span>&gt;(my_vec: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"keyword\">mut</span> <span class=\"type\">Vec</span>&lt;&amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">i32</span>&gt;, value: &amp;<span class=\"symbol\">&#x27;b</span> <span class=\"type\">i32</span>) &#123;</span><br><span class=\"line\">        my_vec.<span class=\"title function_ invoke__\">push</span>(value)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">my_vec</span>: <span class=\"type\">Vec</span>&lt;&amp;<span class=\"type\">i32</span>&gt; = <span class=\"built_in\">vec!</span>[];</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">val1</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">val2</span> = <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">a</span> = &amp;<span class=\"keyword\">mut</span> my_vec;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">insert_value</span>(a, &amp;val1);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;a is &#123;:?&#125; &quot;</span>, a);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">b</span> = &amp;<span class=\"keyword\">mut</span> my_vec;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">insert_value</span>(b, &amp;val2);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;b is &#123;:?&#125;&quot;</span>, b);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;my_vec:?&#125;&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"解决方法：\"><a href=\"#解决方法：\" class=\"headerlink\" title=\"解决方法：\"></a>解决方法：</h3><p><code>&amp;&#39;a mut Vec&lt;&amp;&#39;a i32&gt;</code> 是错误的，<code>my_vec</code> 和 <code>其中存储的元素引用</code> 的生命周期不能相同，因为有如下冲突：</p>\n<ul>\n<li>第一次调用后，向量要求所有元素具有生命周期’α1</li>\n<li>但第二次调用要求元素具有生命周期’α2</li>\n<li>‘α1和’α2是不同的具体生命周期实例</li>\n<li>向量不能存储具有不同生命周期的引用</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">a</span> = &amp;<span class=\"keyword\">mut</span> my_vec;  <span class=\"comment\">// [1] 借用开始，设为生命周期&#x27;α1</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">insert_value</span>(a, &amp;val1); <span class=\"comment\">// [2] 要求val1生命周期 ≥ &#x27;α1</span></span><br><span class=\"line\">                        <span class=\"comment\">// 并强制存储元素的生命周期为&#x27;α1</span></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;a is &#123;:?&#125; &quot;</span>, a); <span class=\"comment\">// [3] a最后一次使用</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">b</span> = &amp;<span class=\"keyword\">mut</span> my_vec;  <span class=\"comment\">// [4] 新借用开始，设为生命周期&#x27;α2</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">insert_value</span>(b, &amp;val2); <span class=\"comment\">// [5] 要求存储元素生命周期为&#x27;α2</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"正确代码：\"><a href=\"#正确代码：\" class=\"headerlink\" title=\"正确代码：\"></a>正确代码：</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">_test_lifetime_multiple</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">insert_value</span>&lt;<span class=\"symbol\">&#x27;a</span>&gt;(my_vec: &amp;<span class=\"keyword\">mut</span> <span class=\"type\">Vec</span>&lt;&amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">i32</span>&gt;, value: &amp;<span class=\"symbol\">&#x27;a</span> <span class=\"type\">i32</span>) &#123;</span><br><span class=\"line\">        my_vec.<span class=\"title function_ invoke__\">push</span>(value)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut </span><span class=\"variable\">my_vec</span>: <span class=\"type\">Vec</span>&lt;&amp;<span class=\"type\">i32</span>&gt; = <span class=\"built_in\">vec!</span>[];</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">val1</span> = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">val2</span> = <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">a</span> = &amp;<span class=\"keyword\">mut</span> my_vec;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">insert_value</span>(a, &amp;val1);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;a is &#123;:?&#125; &quot;</span>, a);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">b</span> = &amp;<span class=\"keyword\">mut</span> my_vec;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">insert_value</span>(b, &amp;val2);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;b is &#123;:?&#125;&quot;</span>, b);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;my_vec:?&#125;&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"IB-Rust-智能指针2","date":"2025-06-09T05:08:47.000Z","_content":"\n[Codes in lesson19](https://github.com/Zoella-w/IB-Rust/tree/main/19_smart_pointer2)\n\n\n## 课程概述\n\n- `Rc<T>`\n- `RefCell<T>`\n- `Weak<T>`\n\n## `Rc<T>` 引用计数指针\n\n### 什么是 `Rc<T>`？\n\n- Rc 是 Reference Counted（引用计数） 的缩写\n- 允许多所有者的共享所有权模型\n\n### 举例说明\n\n使用 `Box<T>` 定义 cons list 的例子。这一次，我们希望创建两个共享第三个列表所有权的列表\n\n尝试使用 `Box<T>` 定义的 List：\n\n```rust\nuse crate::List::{Cons, Nil};\nfn main() {\n    let a = Cons(5, Box::new(Cons(10, Box::new(Nil))));\n    let b = Cons(3, Box::new(a));\n    let c = Cons(4, Box::new(a)); // use of moved value: `a`\n}\nenum List {\n    Cons(i32, Box<List>),\n    Nil,\n}\n```\n\n### 使用 `Rc<T>` 实现\n\n```rust\nuse crate::List::{Cons, Nil};\nuse std::rc::Rc;\nfn main() {\n    let a = Rc::new(Cons(5, Rc::new(Cons(10, Rc::new(Nil)))));\n    println!(\"a: {}\", Rc::strong_count(&a));\n    let b = Cons(3, Rc::clone(&a));\n    println!(\"a: {}\", Rc::strong_count(&a));\n    let c = Cons(4, Rc::clone(&a));\n    println!(\"a: {}\", Rc::strong_count(&a));\n}\nenum List {\n    Cons(i32, Rc<List>),\n    Nil,\n}\n```\n\n## `RefCell<T>`\n\n### 什么是`RefCell<T>`？\n\n`RefCell<T>` 是一个智能指针类型，允许在编译时无法确定的情况下，在运行时进行借用检查\n\n### 主要特征\n\n- 内部可变性:\n  - `RefCell<T>` 允许你在其拥有的 `T` 内部进行修改，即使 `RefCell` 本身是不可变的。这是通过在运行时进行借用检查实现的\n- 运行时借用检查:\n  - `RefCell` 使用动态借用检查，确保在运行时遵循 Rust 的借用规则，即在任何时刻，`RefCell` 只能有一个可变借用或多个不可变借用，但不能同时存在\n- `borrow` 和 `borrow_mut` 方法:\n  - `RefCell` 提供了两个方法来获取对内部数据的借用：\n    - `borrow()`：获取不可变借用（`Ref<T>`），可以同时有多个\n    - `borrow_mut()`：获取可变借用（`RefMut<T>`），在同一时间只能有一个\n\n### 关键点\n\n- 借用规则:\n  - `RefCell` 在运行时检查借用规则，以防止数据竞争和未定义行为。编译器不进行这些检查，而是依赖 `RefCell` 在运行时进行\n- 运行时开销:\n  - 因为 `RefCell` 需要在运行时检查借用规则，所以它会引入一定的性能开销。这在需要在编译时确定所有借用规则的场景中不可替代\n- 错误处理:\n  - 如果违反了借用规则（例如，尝试同时获取多个可变借用），`RefCell` 会在运行时引发 panic\n\n### 使用场景\n\n- 数据结构:\n  - 在需要可变性但又受限于 Rust 的所有权系统时，`RefCell` 允许在数据结构中使用内部可变性。例如，实现需要共享但修改的数据结构（如图、树）\n- 单线程环境:\n  - `RefCell` 主要用于单线程环境。如果你需要在多线程环境中处理内部可变性，应该使用 Mutex 或 RwLock 这类类型。\n\n## 引用循环与内存泄漏\n\n引用计数（`Rc<T>`）和原子引用计数（`Arc<T>`）可以让多个所有者共享同一个数据。然而，这种共享机制如果不当使用，可能会导致引用循环（reference cycle），从而造成内存泄漏\n\n### 例子\n\n```rust\nuse std::rc::Rc;\nuse std::cell::RefCell;\n#[derive(Debug)]\nstruct Node {\n    value: i32,\n    next: Option<Rc<RefCell<Node>>>,\n}\nfn main() {\n    let first = Rc::new(RefCell::new(Node { value: 1, next: None }));\n    let second = Rc::new(RefCell::new(Node { value: 2, next: None }));\n    // 创建引用循环\n    first.borrow_mut().next = Some(Rc::clone(&second));\n    second.borrow_mut().next = Some(Rc::clone(&first));\n    // 如果尝试打印引用计数，将看到引用循环已经发生\n    println!(\"first strong = {}, weak = {}\", Rc::strong_count(&first), Rc::weak_count(&first));\n    println!(\"second strong = {}, weak = {}\", Rc::strong_count(&second), Rc::weak_count(&second));\n    // println!(\"{:?}\", &first); // stack overflow\n}\n```\n\n## `Weak<T>` 弱引用\n\n### `Weak<T>` 的特点\n\n- 非所有权引用: `Weak<T>` 并不拥有数据的所有权，因此它不会影响 `Rc<T>` 的引用计数\n- 不会引发内存泄漏: 由于 `Weak<T>` 不增加引用计数，可以避免引用循环问题，从而避免内存泄漏\n- 必须升级: `Weak<T>` 是一个非所有权引用，因此在使用数据之前，需要通过 `upgrade()` 方法将其升级为 `Rc<T>`。如果数据已经被释放，`upgrade()` 会返回 `None`\n\n### 解决循环引用\n\n```rust\nuse std::cell::RefCell;\nuse std::rc::{Rc, Weak};\n#[derive(Debug)]\nstruct Node {\n    value: i32,\n    next: Option<Rc<RefCell<Node>>>,\n    prev: Option<Weak<RefCell<Node>>>, // 添加一个弱引用来指向前一个节点\n}\nfn main() {\n    let first = Rc::new(RefCell::new(Node {\n        value: 1,\n        next: None,\n        prev: None,\n    }));\n    let second = Rc::new(RefCell::new(Node {\n        value: 2,\n        next: None,\n        prev: None,\n    }));\n    // 创建非循环引用\n    first.borrow_mut().next = Some(Rc::clone(&second));\n    second.borrow_mut().prev = Some(Rc::downgrade(&first));\n    // 如果尝试打印引用计数\n    println!(\n        \"first strong = {}, weak = {}\",\n        Rc::strong_count(&first),\n        Rc::weak_count(&first)\n    ); // first strong = 1, weak = 1\n    println!(\n        \"second strong = {}, weak = {}\",\n        Rc::strong_count(&second),\n        Rc::weak_count(&second)\n    ); // second strong = 2, weak = 0\n    // 因为 second 还拥有 first.borrow_mut().next 的所有权\n    println!(\"{:?}\", &first);\n}\n```\n\n### 强引用与弱引用的主要区别\n\n1. **所有权**:\n   - 强引用 (`Rc<T>`): 持有数据的所有权，保证数据在作用域内不会被释放。\n   - 弱引用 (`Weak<T>`): 不持有数据的所有权，不影响数据的生命周期。\n\n2. **引用计数**:\n   - 强引用: 增加引用计数，数据被多个所有者共享。\n   - 弱引用: 不增加引用计数，不干扰 `Rc<T>` 的生命周期管理。\n\n3. **内存管理**:\n   - 强引用: 只有当所有强引用都被丢弃时，数据才会被释放。\n   - 弱引用: 只能通过升级 (`upgrade()`) 来访问数据，如果数据已经被释放，则升级会失败。\n\n4. **适用场景**:\n   - 强引用: 当你希望共享数据并确保数据在至少一个强引用存在时不会被释放。\n   - 弱引用: 当你需要避免引用循环或只需要偶尔访问数据，不想持有其所有权时。\n\n## 课后作业\n\n任务: 实现一个简单的社交网络系统，包含用户和朋友关系。使用 `Rc<T>`, `RefCell<T>`, `Weak<T>` 来处理用户和朋友之间的关系，并避免循环引用导致的内存泄漏\n\n要求:\n- 用户结构: 每个用户拥有一个名字和一个朋友列表。\n- 添加朋友: 支持在两个用户之间建立朋友关系。\n- 展示朋友关系: 能够展示每个用户的朋友列表。\n- 循环引用: 处理用户之间的双向引用，确保不产生循环引用。\n\n```rust\nuse std::cell::RefCell;\nuse std::rc::{Rc, Weak};\n\nstruct User {\n    name: String,\n    // 一个用户拥有一个朋友列表（Vec），这个列表存储的是对其他用户的弱引用（Weak）\n    // 每个朋友用户（即其他用户）需要具有内部可变性，所以每个朋友用户被包裹在 RefCell 中\n    // 用户自己需要能够修改朋友列表（添加朋友），所以整个列表被包裹在 RefCell 中以提供内部可变性\n    friends: RefCell<Vec<Weak<RefCell<User>>>>,\n}\n\nimpl User {\n    // 用户对象需要：共享所有权（Rc）、提供内部可变性（RefCell）\n    fn new(name: &str) -> Rc<RefCell<Self>> {\n        Rc::new(RefCell::new(User {\n            name: name.to_string(),\n            friends: RefCell::new(Vec::new()),\n        }))\n    }\n\n    // 添加好友：在 user1 和 user2 之间建立好友关系\n    fn add_friend(user1: &Rc<RefCell<Self>>, user2: &Rc<RefCell<Self>>) {\n        // 在 user1 的朋友列表中添加 user2 的弱引用\n        user1\n            .borrow_mut() // 获取 user1 的可变借用\n            .friends\n            .borrow_mut() // 获取 user1 好友列表的可变借用\n            .push(Rc::downgrade(user2)); // 添加 user2 的弱引用\n        // 在 user2 的朋友列表中添加 user1 的弱引用\n        user2\n            .borrow_mut()\n            .friends\n            .borrow_mut()\n            .push(Rc::downgrade((user1)));\n    }\n\n    // 显示用户的好友列表\n    fn show_friends(&self) {\n        println!(\"{} 的朋友:\", self.name);\n        // 遍历好友列表中的每个弱引用\n        for (i, friend) in self.friends.borrow().iter().enumerate() {\n            // 将弱引用升级为强引用\n            if let Some(friend_rc) = friend.upgrade() {\n                let friend_ref = friend_rc.borrow();\n                // 打印朋友名称\n                println!(\"  {}. {}\", i + 1, friend_ref.name);\n            }\n            // 朋友已释放（异常情况）\n            else {\n                println!(\"  {}. [已移除的朋友]\", i + 1);\n            }\n        }\n        println!(); // 添加空行分隔\n    }\n}\n\nfn main() {\n    // 创建用户 Alice\n    let alice = User::new(\"Alice\");\n    println!(\n        \"[创建] Alice, 初始强引用计数 = {}\",\n        Rc::strong_count(&alice)\n    );\n    // 创建用户 Bob\n    let bob = User::new(\"Bob\");\n    println!(\"[创建] Bob, 初始强引用计数 = {}\", Rc::strong_count(&bob));\n    // 创建用户 Charlie\n    let charlie = User::new(\"Charlie\");\n    println!(\n        \"[创建] Charlie, 初始强引用计数 = {}\",\n        Rc::strong_count(&charlie)\n    );\n\n    // 建立朋友关系\n    // 添加 Alice 和 Bob 为朋友\n    User::add_friend(&alice, &bob);\n    println!(\"[添加好友] Alice 和 Bob\");\n    println!(\n        \"  Alice 强引用计数 = {}, 弱引用计数 = {}\",\n        Rc::strong_count(&alice),\n        Rc::weak_count(&alice)\n    );\n    println!(\n        \"  Bob 强引用计数 = {}, 弱引用计数 = {}\",\n        Rc::strong_count(&bob),\n        Rc::weak_count(&bob)\n    );\n    // 添加 Alice 和 Charlie 为朋友\n    User::add_friend(&alice, &charlie);\n    println!(\"[添加好友] Alice 和 Charlie\");\n    println!(\n        \"  Alice 强引用计数 = {}, 弱引用计数 = {}\",\n        Rc::strong_count(&alice),\n        Rc::weak_count(&alice)\n    );\n    println!(\n        \"  Charlie 强引用计数 = {}, 弱引用计数 = {}\",\n        Rc::strong_count(&charlie),\n        Rc::weak_count(&charlie)\n    );\n    // 添加 Bob 和 Charlie 为朋友\n    User::add_friend(&bob, &charlie);\n    println!(\"[添加好友] Bob 和 Charlie\");\n    println!(\n        \"  Bob 强引用计数 = {}, 弱引用计数 = {}\",\n        Rc::strong_count(&bob),\n        Rc::weak_count(&bob)\n    );\n    println!(\n        \"  Charlie 强引用计数 = {}, 弱引用计数 = {}\",\n        Rc::strong_count(&charlie),\n        Rc::weak_count(&charlie)\n    );\n\n    // 创建临时用户 Dave 来演示弱引用\n    {\n        let dave = User::new(\"Dave\");\n        println!(\n            \"[创建临时用户] Dave, 初始强引用计数 = {}\",\n            Rc::strong_count(&dave)\n        );\n        // 添加 Alice 和 Dave 为朋友\n        // 注意：这里只单向添加，避免循环引用\n        alice\n            .borrow_mut()\n            .friends\n            .borrow_mut()\n            .push(Rc::downgrade(&dave));\n        println!(\"[添加好友] Alice 和 Dave（弱引用）\");\n        println!(\n            \"  Alice 强引用计数 = {}, 弱引用计数 = {}\",\n            Rc::strong_count(&alice),\n            Rc::weak_count(&alice)\n        );\n        println!(\n            \"  Dave 强引用计数 = {}, 弱引用计数 = {}\",\n            Rc::strong_count(&dave),\n            Rc::weak_count(&dave)\n        );\n        // 展示 Alice 的朋友（包括 Dave）\n        println!(\"[展示 Alice 的完整朋友列表]\");\n        alice.borrow().show_friends();\n        // 作用域结束，Dave 将被销毁\n        println!(\"[临时用户 Dave 离开作用域]\");\n    }\n\n    // 展示最终朋友关系\n    // 展示 Alice 的朋友列表（Dave 已消失）\n    println!(\"[Alice 的最终朋友列表]\");\n    alice.borrow().show_friends();\n    // 展示 Bob 的朋友列表\n    println!(\"[Bob 的朋友列表]\");\n    bob.borrow().show_friends();\n    // 展示 Charlie 的朋友列表\n    println!(\"[Charlie 的朋友列表]\");\n    charlie.borrow().show_friends();\n\n    // 最终引用计数状态\n    println!(\"程序结束前引用计数状态:\");\n    println!(\n        \"Alice: 强引用计数 = {}, 弱引用计数 = {}\",\n        Rc::strong_count(&alice),\n        Rc::weak_count(&alice)\n    );\n    println!(\n        \"Bob: 强引用计数 = {}, 弱引用计数 = {}\",\n        Rc::strong_count(&bob),\n        Rc::weak_count(&bob)\n    );\n    println!(\n        \"Charlie: 强引用计数 = {}, 弱引用计数 = {}\",\n        Rc::strong_count(&charlie),\n        Rc::weak_count(&charlie)\n    );\n}\n```\n","source":"_posts/77-IB-Rust-智能指针2.md","raw":"---\ntitle: IB-Rust-智能指针2\ndate: 2025-06-09 13:08:47\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson19](https://github.com/Zoella-w/IB-Rust/tree/main/19_smart_pointer2)\n\n\n## 课程概述\n\n- `Rc<T>`\n- `RefCell<T>`\n- `Weak<T>`\n\n## `Rc<T>` 引用计数指针\n\n### 什么是 `Rc<T>`？\n\n- Rc 是 Reference Counted（引用计数） 的缩写\n- 允许多所有者的共享所有权模型\n\n### 举例说明\n\n使用 `Box<T>` 定义 cons list 的例子。这一次，我们希望创建两个共享第三个列表所有权的列表\n\n尝试使用 `Box<T>` 定义的 List：\n\n```rust\nuse crate::List::{Cons, Nil};\nfn main() {\n    let a = Cons(5, Box::new(Cons(10, Box::new(Nil))));\n    let b = Cons(3, Box::new(a));\n    let c = Cons(4, Box::new(a)); // use of moved value: `a`\n}\nenum List {\n    Cons(i32, Box<List>),\n    Nil,\n}\n```\n\n### 使用 `Rc<T>` 实现\n\n```rust\nuse crate::List::{Cons, Nil};\nuse std::rc::Rc;\nfn main() {\n    let a = Rc::new(Cons(5, Rc::new(Cons(10, Rc::new(Nil)))));\n    println!(\"a: {}\", Rc::strong_count(&a));\n    let b = Cons(3, Rc::clone(&a));\n    println!(\"a: {}\", Rc::strong_count(&a));\n    let c = Cons(4, Rc::clone(&a));\n    println!(\"a: {}\", Rc::strong_count(&a));\n}\nenum List {\n    Cons(i32, Rc<List>),\n    Nil,\n}\n```\n\n## `RefCell<T>`\n\n### 什么是`RefCell<T>`？\n\n`RefCell<T>` 是一个智能指针类型，允许在编译时无法确定的情况下，在运行时进行借用检查\n\n### 主要特征\n\n- 内部可变性:\n  - `RefCell<T>` 允许你在其拥有的 `T` 内部进行修改，即使 `RefCell` 本身是不可变的。这是通过在运行时进行借用检查实现的\n- 运行时借用检查:\n  - `RefCell` 使用动态借用检查，确保在运行时遵循 Rust 的借用规则，即在任何时刻，`RefCell` 只能有一个可变借用或多个不可变借用，但不能同时存在\n- `borrow` 和 `borrow_mut` 方法:\n  - `RefCell` 提供了两个方法来获取对内部数据的借用：\n    - `borrow()`：获取不可变借用（`Ref<T>`），可以同时有多个\n    - `borrow_mut()`：获取可变借用（`RefMut<T>`），在同一时间只能有一个\n\n### 关键点\n\n- 借用规则:\n  - `RefCell` 在运行时检查借用规则，以防止数据竞争和未定义行为。编译器不进行这些检查，而是依赖 `RefCell` 在运行时进行\n- 运行时开销:\n  - 因为 `RefCell` 需要在运行时检查借用规则，所以它会引入一定的性能开销。这在需要在编译时确定所有借用规则的场景中不可替代\n- 错误处理:\n  - 如果违反了借用规则（例如，尝试同时获取多个可变借用），`RefCell` 会在运行时引发 panic\n\n### 使用场景\n\n- 数据结构:\n  - 在需要可变性但又受限于 Rust 的所有权系统时，`RefCell` 允许在数据结构中使用内部可变性。例如，实现需要共享但修改的数据结构（如图、树）\n- 单线程环境:\n  - `RefCell` 主要用于单线程环境。如果你需要在多线程环境中处理内部可变性，应该使用 Mutex 或 RwLock 这类类型。\n\n## 引用循环与内存泄漏\n\n引用计数（`Rc<T>`）和原子引用计数（`Arc<T>`）可以让多个所有者共享同一个数据。然而，这种共享机制如果不当使用，可能会导致引用循环（reference cycle），从而造成内存泄漏\n\n### 例子\n\n```rust\nuse std::rc::Rc;\nuse std::cell::RefCell;\n#[derive(Debug)]\nstruct Node {\n    value: i32,\n    next: Option<Rc<RefCell<Node>>>,\n}\nfn main() {\n    let first = Rc::new(RefCell::new(Node { value: 1, next: None }));\n    let second = Rc::new(RefCell::new(Node { value: 2, next: None }));\n    // 创建引用循环\n    first.borrow_mut().next = Some(Rc::clone(&second));\n    second.borrow_mut().next = Some(Rc::clone(&first));\n    // 如果尝试打印引用计数，将看到引用循环已经发生\n    println!(\"first strong = {}, weak = {}\", Rc::strong_count(&first), Rc::weak_count(&first));\n    println!(\"second strong = {}, weak = {}\", Rc::strong_count(&second), Rc::weak_count(&second));\n    // println!(\"{:?}\", &first); // stack overflow\n}\n```\n\n## `Weak<T>` 弱引用\n\n### `Weak<T>` 的特点\n\n- 非所有权引用: `Weak<T>` 并不拥有数据的所有权，因此它不会影响 `Rc<T>` 的引用计数\n- 不会引发内存泄漏: 由于 `Weak<T>` 不增加引用计数，可以避免引用循环问题，从而避免内存泄漏\n- 必须升级: `Weak<T>` 是一个非所有权引用，因此在使用数据之前，需要通过 `upgrade()` 方法将其升级为 `Rc<T>`。如果数据已经被释放，`upgrade()` 会返回 `None`\n\n### 解决循环引用\n\n```rust\nuse std::cell::RefCell;\nuse std::rc::{Rc, Weak};\n#[derive(Debug)]\nstruct Node {\n    value: i32,\n    next: Option<Rc<RefCell<Node>>>,\n    prev: Option<Weak<RefCell<Node>>>, // 添加一个弱引用来指向前一个节点\n}\nfn main() {\n    let first = Rc::new(RefCell::new(Node {\n        value: 1,\n        next: None,\n        prev: None,\n    }));\n    let second = Rc::new(RefCell::new(Node {\n        value: 2,\n        next: None,\n        prev: None,\n    }));\n    // 创建非循环引用\n    first.borrow_mut().next = Some(Rc::clone(&second));\n    second.borrow_mut().prev = Some(Rc::downgrade(&first));\n    // 如果尝试打印引用计数\n    println!(\n        \"first strong = {}, weak = {}\",\n        Rc::strong_count(&first),\n        Rc::weak_count(&first)\n    ); // first strong = 1, weak = 1\n    println!(\n        \"second strong = {}, weak = {}\",\n        Rc::strong_count(&second),\n        Rc::weak_count(&second)\n    ); // second strong = 2, weak = 0\n    // 因为 second 还拥有 first.borrow_mut().next 的所有权\n    println!(\"{:?}\", &first);\n}\n```\n\n### 强引用与弱引用的主要区别\n\n1. **所有权**:\n   - 强引用 (`Rc<T>`): 持有数据的所有权，保证数据在作用域内不会被释放。\n   - 弱引用 (`Weak<T>`): 不持有数据的所有权，不影响数据的生命周期。\n\n2. **引用计数**:\n   - 强引用: 增加引用计数，数据被多个所有者共享。\n   - 弱引用: 不增加引用计数，不干扰 `Rc<T>` 的生命周期管理。\n\n3. **内存管理**:\n   - 强引用: 只有当所有强引用都被丢弃时，数据才会被释放。\n   - 弱引用: 只能通过升级 (`upgrade()`) 来访问数据，如果数据已经被释放，则升级会失败。\n\n4. **适用场景**:\n   - 强引用: 当你希望共享数据并确保数据在至少一个强引用存在时不会被释放。\n   - 弱引用: 当你需要避免引用循环或只需要偶尔访问数据，不想持有其所有权时。\n\n## 课后作业\n\n任务: 实现一个简单的社交网络系统，包含用户和朋友关系。使用 `Rc<T>`, `RefCell<T>`, `Weak<T>` 来处理用户和朋友之间的关系，并避免循环引用导致的内存泄漏\n\n要求:\n- 用户结构: 每个用户拥有一个名字和一个朋友列表。\n- 添加朋友: 支持在两个用户之间建立朋友关系。\n- 展示朋友关系: 能够展示每个用户的朋友列表。\n- 循环引用: 处理用户之间的双向引用，确保不产生循环引用。\n\n```rust\nuse std::cell::RefCell;\nuse std::rc::{Rc, Weak};\n\nstruct User {\n    name: String,\n    // 一个用户拥有一个朋友列表（Vec），这个列表存储的是对其他用户的弱引用（Weak）\n    // 每个朋友用户（即其他用户）需要具有内部可变性，所以每个朋友用户被包裹在 RefCell 中\n    // 用户自己需要能够修改朋友列表（添加朋友），所以整个列表被包裹在 RefCell 中以提供内部可变性\n    friends: RefCell<Vec<Weak<RefCell<User>>>>,\n}\n\nimpl User {\n    // 用户对象需要：共享所有权（Rc）、提供内部可变性（RefCell）\n    fn new(name: &str) -> Rc<RefCell<Self>> {\n        Rc::new(RefCell::new(User {\n            name: name.to_string(),\n            friends: RefCell::new(Vec::new()),\n        }))\n    }\n\n    // 添加好友：在 user1 和 user2 之间建立好友关系\n    fn add_friend(user1: &Rc<RefCell<Self>>, user2: &Rc<RefCell<Self>>) {\n        // 在 user1 的朋友列表中添加 user2 的弱引用\n        user1\n            .borrow_mut() // 获取 user1 的可变借用\n            .friends\n            .borrow_mut() // 获取 user1 好友列表的可变借用\n            .push(Rc::downgrade(user2)); // 添加 user2 的弱引用\n        // 在 user2 的朋友列表中添加 user1 的弱引用\n        user2\n            .borrow_mut()\n            .friends\n            .borrow_mut()\n            .push(Rc::downgrade((user1)));\n    }\n\n    // 显示用户的好友列表\n    fn show_friends(&self) {\n        println!(\"{} 的朋友:\", self.name);\n        // 遍历好友列表中的每个弱引用\n        for (i, friend) in self.friends.borrow().iter().enumerate() {\n            // 将弱引用升级为强引用\n            if let Some(friend_rc) = friend.upgrade() {\n                let friend_ref = friend_rc.borrow();\n                // 打印朋友名称\n                println!(\"  {}. {}\", i + 1, friend_ref.name);\n            }\n            // 朋友已释放（异常情况）\n            else {\n                println!(\"  {}. [已移除的朋友]\", i + 1);\n            }\n        }\n        println!(); // 添加空行分隔\n    }\n}\n\nfn main() {\n    // 创建用户 Alice\n    let alice = User::new(\"Alice\");\n    println!(\n        \"[创建] Alice, 初始强引用计数 = {}\",\n        Rc::strong_count(&alice)\n    );\n    // 创建用户 Bob\n    let bob = User::new(\"Bob\");\n    println!(\"[创建] Bob, 初始强引用计数 = {}\", Rc::strong_count(&bob));\n    // 创建用户 Charlie\n    let charlie = User::new(\"Charlie\");\n    println!(\n        \"[创建] Charlie, 初始强引用计数 = {}\",\n        Rc::strong_count(&charlie)\n    );\n\n    // 建立朋友关系\n    // 添加 Alice 和 Bob 为朋友\n    User::add_friend(&alice, &bob);\n    println!(\"[添加好友] Alice 和 Bob\");\n    println!(\n        \"  Alice 强引用计数 = {}, 弱引用计数 = {}\",\n        Rc::strong_count(&alice),\n        Rc::weak_count(&alice)\n    );\n    println!(\n        \"  Bob 强引用计数 = {}, 弱引用计数 = {}\",\n        Rc::strong_count(&bob),\n        Rc::weak_count(&bob)\n    );\n    // 添加 Alice 和 Charlie 为朋友\n    User::add_friend(&alice, &charlie);\n    println!(\"[添加好友] Alice 和 Charlie\");\n    println!(\n        \"  Alice 强引用计数 = {}, 弱引用计数 = {}\",\n        Rc::strong_count(&alice),\n        Rc::weak_count(&alice)\n    );\n    println!(\n        \"  Charlie 强引用计数 = {}, 弱引用计数 = {}\",\n        Rc::strong_count(&charlie),\n        Rc::weak_count(&charlie)\n    );\n    // 添加 Bob 和 Charlie 为朋友\n    User::add_friend(&bob, &charlie);\n    println!(\"[添加好友] Bob 和 Charlie\");\n    println!(\n        \"  Bob 强引用计数 = {}, 弱引用计数 = {}\",\n        Rc::strong_count(&bob),\n        Rc::weak_count(&bob)\n    );\n    println!(\n        \"  Charlie 强引用计数 = {}, 弱引用计数 = {}\",\n        Rc::strong_count(&charlie),\n        Rc::weak_count(&charlie)\n    );\n\n    // 创建临时用户 Dave 来演示弱引用\n    {\n        let dave = User::new(\"Dave\");\n        println!(\n            \"[创建临时用户] Dave, 初始强引用计数 = {}\",\n            Rc::strong_count(&dave)\n        );\n        // 添加 Alice 和 Dave 为朋友\n        // 注意：这里只单向添加，避免循环引用\n        alice\n            .borrow_mut()\n            .friends\n            .borrow_mut()\n            .push(Rc::downgrade(&dave));\n        println!(\"[添加好友] Alice 和 Dave（弱引用）\");\n        println!(\n            \"  Alice 强引用计数 = {}, 弱引用计数 = {}\",\n            Rc::strong_count(&alice),\n            Rc::weak_count(&alice)\n        );\n        println!(\n            \"  Dave 强引用计数 = {}, 弱引用计数 = {}\",\n            Rc::strong_count(&dave),\n            Rc::weak_count(&dave)\n        );\n        // 展示 Alice 的朋友（包括 Dave）\n        println!(\"[展示 Alice 的完整朋友列表]\");\n        alice.borrow().show_friends();\n        // 作用域结束，Dave 将被销毁\n        println!(\"[临时用户 Dave 离开作用域]\");\n    }\n\n    // 展示最终朋友关系\n    // 展示 Alice 的朋友列表（Dave 已消失）\n    println!(\"[Alice 的最终朋友列表]\");\n    alice.borrow().show_friends();\n    // 展示 Bob 的朋友列表\n    println!(\"[Bob 的朋友列表]\");\n    bob.borrow().show_friends();\n    // 展示 Charlie 的朋友列表\n    println!(\"[Charlie 的朋友列表]\");\n    charlie.borrow().show_friends();\n\n    // 最终引用计数状态\n    println!(\"程序结束前引用计数状态:\");\n    println!(\n        \"Alice: 强引用计数 = {}, 弱引用计数 = {}\",\n        Rc::strong_count(&alice),\n        Rc::weak_count(&alice)\n    );\n    println!(\n        \"Bob: 强引用计数 = {}, 弱引用计数 = {}\",\n        Rc::strong_count(&bob),\n        Rc::weak_count(&bob)\n    );\n    println!(\n        \"Charlie: 强引用计数 = {}, 弱引用计数 = {}\",\n        Rc::strong_count(&charlie),\n        Rc::weak_count(&charlie)\n    );\n}\n```\n","slug":"77-IB-Rust-智能指针2","published":1,"updated":"2025-06-10T13:55:47.474Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmbrop9kl00004jprexaj4lnx","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/19_smart_pointer2\" >Codes in lesson19<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"课程概述\"><a href=\"#课程概述\" class=\"headerlink\" title=\"课程概述\"></a>课程概述</h2><ul>\n<li><code>Rc&lt;T&gt;</code></li>\n<li><code>RefCell&lt;T&gt;</code></li>\n<li><code>Weak&lt;T&gt;</code></li>\n</ul>\n<h2 id=\"Rc-引用计数指针\"><a href=\"#Rc-引用计数指针\" class=\"headerlink\" title=\"Rc&lt;T&gt; 引用计数指针\"></a><code>Rc&lt;T&gt;</code> 引用计数指针</h2><h3 id=\"什么是-Rc？\"><a href=\"#什么是-Rc？\" class=\"headerlink\" title=\"什么是 Rc&lt;T&gt;？\"></a>什么是 <code>Rc&lt;T&gt;</code>？</h3><ul>\n<li>Rc 是 Reference Counted（引用计数） 的缩写</li>\n<li>允许多所有者的共享所有权模型</li>\n</ul>\n<h3 id=\"举例说明\"><a href=\"#举例说明\" class=\"headerlink\" title=\"举例说明\"></a>举例说明</h3><p>使用 <code>Box&lt;T&gt;</code> 定义 cons list 的例子。这一次，我们希望创建两个共享第三个列表所有权的列表</p>\n<p>尝试使用 <code>Box&lt;T&gt;</code> 定义的 List：</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> crate::List::&#123;Cons, Nil&#125;;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">a</span> = <span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">5</span>, <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(<span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">10</span>, <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(Nil))));</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">b</span> = <span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">3</span>, <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(a));</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">c</span> = <span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">4</span>, <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(a)); <span class=\"comment\">// use of moved value: `a`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">List</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Cons</span>(<span class=\"type\">i32</span>, <span class=\"type\">Box</span>&lt;List&gt;),</span><br><span class=\"line\">    Nil,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"使用-Rc-实现\"><a href=\"#使用-Rc-实现\" class=\"headerlink\" title=\"使用 Rc&lt;T&gt; 实现\"></a>使用 <code>Rc&lt;T&gt;</code> 实现</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> crate::List::&#123;Cons, Nil&#125;;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::rc::Rc;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">a</span> = Rc::<span class=\"title function_ invoke__\">new</span>(<span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">5</span>, Rc::<span class=\"title function_ invoke__\">new</span>(<span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">10</span>, Rc::<span class=\"title function_ invoke__\">new</span>(Nil)))));</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;a: &#123;&#125;&quot;</span>, Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;a));</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">b</span> = <span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">3</span>, Rc::<span class=\"title function_ invoke__\">clone</span>(&amp;a));</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;a: &#123;&#125;&quot;</span>, Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;a));</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">c</span> = <span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">4</span>, Rc::<span class=\"title function_ invoke__\">clone</span>(&amp;a));</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;a: &#123;&#125;&quot;</span>, Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;a));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">List</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Cons</span>(<span class=\"type\">i32</span>, Rc&lt;List&gt;),</span><br><span class=\"line\">    Nil,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"RefCell\"><a href=\"#RefCell\" class=\"headerlink\" title=\"RefCell&lt;T&gt;\"></a><code>RefCell&lt;T&gt;</code></h2><h3 id=\"什么是RefCell？\"><a href=\"#什么是RefCell？\" class=\"headerlink\" title=\"什么是RefCell&lt;T&gt;？\"></a>什么是<code>RefCell&lt;T&gt;</code>？</h3><p><code>RefCell&lt;T&gt;</code> 是一个智能指针类型，允许在编译时无法确定的情况下，在运行时进行借用检查</p>\n<h3 id=\"主要特征\"><a href=\"#主要特征\" class=\"headerlink\" title=\"主要特征\"></a>主要特征</h3><ul>\n<li>内部可变性:<ul>\n<li><code>RefCell&lt;T&gt;</code> 允许你在其拥有的 <code>T</code> 内部进行修改，即使 <code>RefCell</code> 本身是不可变的。这是通过在运行时进行借用检查实现的</li>\n</ul>\n</li>\n<li>运行时借用检查:<ul>\n<li><code>RefCell</code> 使用动态借用检查，确保在运行时遵循 Rust 的借用规则，即在任何时刻，<code>RefCell</code> 只能有一个可变借用或多个不可变借用，但不能同时存在</li>\n</ul>\n</li>\n<li><code>borrow</code> 和 <code>borrow_mut</code> 方法:<ul>\n<li><code>RefCell</code> 提供了两个方法来获取对内部数据的借用：<ul>\n<li><code>borrow()</code>：获取不可变借用（<code>Ref&lt;T&gt;</code>），可以同时有多个</li>\n<li><code>borrow_mut()</code>：获取可变借用（<code>RefMut&lt;T&gt;</code>），在同一时间只能有一个</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"关键点\"><a href=\"#关键点\" class=\"headerlink\" title=\"关键点\"></a>关键点</h3><ul>\n<li>借用规则:<ul>\n<li><code>RefCell</code> 在运行时检查借用规则，以防止数据竞争和未定义行为。编译器不进行这些检查，而是依赖 <code>RefCell</code> 在运行时进行</li>\n</ul>\n</li>\n<li>运行时开销:<ul>\n<li>因为 <code>RefCell</code> 需要在运行时检查借用规则，所以它会引入一定的性能开销。这在需要在编译时确定所有借用规则的场景中不可替代</li>\n</ul>\n</li>\n<li>错误处理:<ul>\n<li>如果违反了借用规则（例如，尝试同时获取多个可变借用），<code>RefCell</code> 会在运行时引发 panic</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h3><ul>\n<li>数据结构:<ul>\n<li>在需要可变性但又受限于 Rust 的所有权系统时，<code>RefCell</code> 允许在数据结构中使用内部可变性。例如，实现需要共享但修改的数据结构（如图、树）</li>\n</ul>\n</li>\n<li>单线程环境:<ul>\n<li><code>RefCell</code> 主要用于单线程环境。如果你需要在多线程环境中处理内部可变性，应该使用 Mutex 或 RwLock 这类类型。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"引用循环与内存泄漏\"><a href=\"#引用循环与内存泄漏\" class=\"headerlink\" title=\"引用循环与内存泄漏\"></a>引用循环与内存泄漏</h2><p>引用计数（<code>Rc&lt;T&gt;</code>）和原子引用计数（<code>Arc&lt;T&gt;</code>）可以让多个所有者共享同一个数据。然而，这种共享机制如果不当使用，可能会导致引用循环（reference cycle），从而造成内存泄漏</p>\n<h3 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::rc::Rc;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::cell::RefCell;</span><br><span class=\"line\"><span class=\"meta\">#[derive(Debug)]</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Node</span> &#123;</span><br><span class=\"line\">    value: <span class=\"type\">i32</span>,</span><br><span class=\"line\">    next: <span class=\"type\">Option</span>&lt;Rc&lt;RefCell&lt;Node&gt;&gt;&gt;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">first</span> = Rc::<span class=\"title function_ invoke__\">new</span>(RefCell::<span class=\"title function_ invoke__\">new</span>(Node &#123; value: <span class=\"number\">1</span>, next: <span class=\"literal\">None</span> &#125;));</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">second</span> = Rc::<span class=\"title function_ invoke__\">new</span>(RefCell::<span class=\"title function_ invoke__\">new</span>(Node &#123; value: <span class=\"number\">2</span>, next: <span class=\"literal\">None</span> &#125;));</span><br><span class=\"line\">    <span class=\"comment\">// 创建引用循环</span></span><br><span class=\"line\">    first.<span class=\"title function_ invoke__\">borrow_mut</span>().next = <span class=\"title function_ invoke__\">Some</span>(Rc::<span class=\"title function_ invoke__\">clone</span>(&amp;second));</span><br><span class=\"line\">    second.<span class=\"title function_ invoke__\">borrow_mut</span>().next = <span class=\"title function_ invoke__\">Some</span>(Rc::<span class=\"title function_ invoke__\">clone</span>(&amp;first));</span><br><span class=\"line\">    <span class=\"comment\">// 如果尝试打印引用计数，将看到引用循环已经发生</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;first strong = &#123;&#125;, weak = &#123;&#125;&quot;</span>, Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;first), Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;first));</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;second strong = &#123;&#125;, weak = &#123;&#125;&quot;</span>, Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;second), Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;second));</span><br><span class=\"line\">    <span class=\"comment\">// println!(&quot;&#123;:?&#125;&quot;, &amp;first); // stack overflow</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"Weak-弱引用\"><a href=\"#Weak-弱引用\" class=\"headerlink\" title=\"Weak&lt;T&gt; 弱引用\"></a><code>Weak&lt;T&gt;</code> 弱引用</h2><h3 id=\"Weak-的特点\"><a href=\"#Weak-的特点\" class=\"headerlink\" title=\"Weak&lt;T&gt; 的特点\"></a><code>Weak&lt;T&gt;</code> 的特点</h3><ul>\n<li>非所有权引用: <code>Weak&lt;T&gt;</code> 并不拥有数据的所有权，因此它不会影响 <code>Rc&lt;T&gt;</code> 的引用计数</li>\n<li>不会引发内存泄漏: 由于 <code>Weak&lt;T&gt;</code> 不增加引用计数，可以避免引用循环问题，从而避免内存泄漏</li>\n<li>必须升级: <code>Weak&lt;T&gt;</code> 是一个非所有权引用，因此在使用数据之前，需要通过 <code>upgrade()</code> 方法将其升级为 <code>Rc&lt;T&gt;</code>。如果数据已经被释放，<code>upgrade()</code> 会返回 <code>None</code></li>\n</ul>\n<h3 id=\"解决循环引用\"><a href=\"#解决循环引用\" class=\"headerlink\" title=\"解决循环引用\"></a>解决循环引用</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::cell::RefCell;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::rc::&#123;Rc, Weak&#125;;</span><br><span class=\"line\"><span class=\"meta\">#[derive(Debug)]</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Node</span> &#123;</span><br><span class=\"line\">    value: <span class=\"type\">i32</span>,</span><br><span class=\"line\">    next: <span class=\"type\">Option</span>&lt;Rc&lt;RefCell&lt;Node&gt;&gt;&gt;,</span><br><span class=\"line\">    prev: <span class=\"type\">Option</span>&lt;Weak&lt;RefCell&lt;Node&gt;&gt;&gt;, <span class=\"comment\">// 添加一个弱引用来指向前一个节点</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">first</span> = Rc::<span class=\"title function_ invoke__\">new</span>(RefCell::<span class=\"title function_ invoke__\">new</span>(Node &#123;</span><br><span class=\"line\">        value: <span class=\"number\">1</span>,</span><br><span class=\"line\">        next: <span class=\"literal\">None</span>,</span><br><span class=\"line\">        prev: <span class=\"literal\">None</span>,</span><br><span class=\"line\">    &#125;));</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">second</span> = Rc::<span class=\"title function_ invoke__\">new</span>(RefCell::<span class=\"title function_ invoke__\">new</span>(Node &#123;</span><br><span class=\"line\">        value: <span class=\"number\">2</span>,</span><br><span class=\"line\">        next: <span class=\"literal\">None</span>,</span><br><span class=\"line\">        prev: <span class=\"literal\">None</span>,</span><br><span class=\"line\">    &#125;));</span><br><span class=\"line\">    <span class=\"comment\">// 创建非循环引用</span></span><br><span class=\"line\">    first.<span class=\"title function_ invoke__\">borrow_mut</span>().next = <span class=\"title function_ invoke__\">Some</span>(Rc::<span class=\"title function_ invoke__\">clone</span>(&amp;second));</span><br><span class=\"line\">    second.<span class=\"title function_ invoke__\">borrow_mut</span>().prev = <span class=\"title function_ invoke__\">Some</span>(Rc::<span class=\"title function_ invoke__\">downgrade</span>(&amp;first));</span><br><span class=\"line\">    <span class=\"comment\">// 如果尝试打印引用计数</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;first strong = &#123;&#125;, weak = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;first),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;first)</span><br><span class=\"line\">    ); <span class=\"comment\">// first strong = 1, weak = 1</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;second strong = &#123;&#125;, weak = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;second),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;second)</span><br><span class=\"line\">    ); <span class=\"comment\">// second strong = 2, weak = 0</span></span><br><span class=\"line\">    <span class=\"comment\">// 因为 second 还拥有 first.borrow_mut().next 的所有权</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;:?&#125;&quot;</span>, &amp;first);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"强引用与弱引用的主要区别\"><a href=\"#强引用与弱引用的主要区别\" class=\"headerlink\" title=\"强引用与弱引用的主要区别\"></a>强引用与弱引用的主要区别</h3><ol>\n<li><p><strong>所有权</strong>:</p>\n<ul>\n<li>强引用 (<code>Rc&lt;T&gt;</code>): 持有数据的所有权，保证数据在作用域内不会被释放。</li>\n<li>弱引用 (<code>Weak&lt;T&gt;</code>): 不持有数据的所有权，不影响数据的生命周期。</li>\n</ul>\n</li>\n<li><p><strong>引用计数</strong>:</p>\n<ul>\n<li>强引用: 增加引用计数，数据被多个所有者共享。</li>\n<li>弱引用: 不增加引用计数，不干扰 <code>Rc&lt;T&gt;</code> 的生命周期管理。</li>\n</ul>\n</li>\n<li><p><strong>内存管理</strong>:</p>\n<ul>\n<li>强引用: 只有当所有强引用都被丢弃时，数据才会被释放。</li>\n<li>弱引用: 只能通过升级 (<code>upgrade()</code>) 来访问数据，如果数据已经被释放，则升级会失败。</li>\n</ul>\n</li>\n<li><p><strong>适用场景</strong>:</p>\n<ul>\n<li>强引用: 当你希望共享数据并确保数据在至少一个强引用存在时不会被释放。</li>\n<li>弱引用: 当你需要避免引用循环或只需要偶尔访问数据，不想持有其所有权时。</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"课后作业\"><a href=\"#课后作业\" class=\"headerlink\" title=\"课后作业\"></a>课后作业</h2><p>任务: 实现一个简单的社交网络系统，包含用户和朋友关系。使用 <code>Rc&lt;T&gt;</code>, <code>RefCell&lt;T&gt;</code>, <code>Weak&lt;T&gt;</code> 来处理用户和朋友之间的关系，并避免循环引用导致的内存泄漏</p>\n<p>要求:</p>\n<ul>\n<li>用户结构: 每个用户拥有一个名字和一个朋友列表。</li>\n<li>添加朋友: 支持在两个用户之间建立朋友关系。</li>\n<li>展示朋友关系: 能够展示每个用户的朋友列表。</li>\n<li>循环引用: 处理用户之间的双向引用，确保不产生循环引用。</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::cell::RefCell;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::rc::&#123;Rc, Weak&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">User</span> &#123;</span><br><span class=\"line\">    name: <span class=\"type\">String</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 一个用户拥有一个朋友列表（Vec），这个列表存储的是对其他用户的弱引用（Weak）</span></span><br><span class=\"line\">    <span class=\"comment\">// 每个朋友用户（即其他用户）需要具有内部可变性，所以每个朋友用户被包裹在 RefCell 中</span></span><br><span class=\"line\">    <span class=\"comment\">// 用户自己需要能够修改朋友列表（添加朋友），所以整个列表被包裹在 RefCell 中以提供内部可变性</span></span><br><span class=\"line\">    friends: RefCell&lt;<span class=\"type\">Vec</span>&lt;Weak&lt;RefCell&lt;User&gt;&gt;&gt;&gt;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">User</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 用户对象需要：共享所有权（Rc）、提供内部可变性（RefCell）</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">new</span>(name: &amp;<span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> Rc&lt;RefCell&lt;<span class=\"keyword\">Self</span>&gt;&gt; &#123;</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">new</span>(RefCell::<span class=\"title function_ invoke__\">new</span>(User &#123;</span><br><span class=\"line\">            name: name.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">            friends: RefCell::<span class=\"title function_ invoke__\">new</span>(<span class=\"type\">Vec</span>::<span class=\"title function_ invoke__\">new</span>()),</span><br><span class=\"line\">        &#125;))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 添加好友：在 user1 和 user2 之间建立好友关系</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">add_friend</span>(user1: &amp;Rc&lt;RefCell&lt;<span class=\"keyword\">Self</span>&gt;&gt;, user2: &amp;Rc&lt;RefCell&lt;<span class=\"keyword\">Self</span>&gt;&gt;) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 在 user1 的朋友列表中添加 user2 的弱引用</span></span><br><span class=\"line\">        user1</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">borrow_mut</span>() <span class=\"comment\">// 获取 user1 的可变借用</span></span><br><span class=\"line\">            .friends</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">borrow_mut</span>() <span class=\"comment\">// 获取 user1 好友列表的可变借用</span></span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">push</span>(Rc::<span class=\"title function_ invoke__\">downgrade</span>(user2)); <span class=\"comment\">// 添加 user2 的弱引用</span></span><br><span class=\"line\">        <span class=\"comment\">// 在 user2 的朋友列表中添加 user1 的弱引用</span></span><br><span class=\"line\">        user2</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">borrow_mut</span>()</span><br><span class=\"line\">            .friends</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">borrow_mut</span>()</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">push</span>(Rc::<span class=\"title function_ invoke__\">downgrade</span>((user1)));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 显示用户的好友列表</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">show_friends</span>(&amp;<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125; 的朋友:&quot;</span>, <span class=\"keyword\">self</span>.name);</span><br><span class=\"line\">        <span class=\"comment\">// 遍历好友列表中的每个弱引用</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (i, friend) <span class=\"keyword\">in</span> <span class=\"keyword\">self</span>.friends.<span class=\"title function_ invoke__\">borrow</span>().<span class=\"title function_ invoke__\">iter</span>().<span class=\"title function_ invoke__\">enumerate</span>() &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 将弱引用升级为强引用</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Some</span>(friend_rc) = friend.<span class=\"title function_ invoke__\">upgrade</span>() &#123;</span><br><span class=\"line\">                <span class=\"keyword\">let</span> <span class=\"variable\">friend_ref</span> = friend_rc.<span class=\"title function_ invoke__\">borrow</span>();</span><br><span class=\"line\">                <span class=\"comment\">// 打印朋友名称</span></span><br><span class=\"line\">                <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;  &#123;&#125;. &#123;&#125;&quot;</span>, i + <span class=\"number\">1</span>, friend_ref.name);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// 朋友已释放（异常情况）</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;  &#123;&#125;. [已移除的朋友]&quot;</span>, i + <span class=\"number\">1</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(); <span class=\"comment\">// 添加空行分隔</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 创建用户 Alice</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">alice</span> = User::<span class=\"title function_ invoke__\">new</span>(<span class=\"string\">&quot;Alice&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;[创建] Alice, 初始强引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;alice)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"comment\">// 创建用户 Bob</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">bob</span> = User::<span class=\"title function_ invoke__\">new</span>(<span class=\"string\">&quot;Bob&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[创建] Bob, 初始强引用计数 = &#123;&#125;&quot;</span>, Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;bob));</span><br><span class=\"line\">    <span class=\"comment\">// 创建用户 Charlie</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">charlie</span> = User::<span class=\"title function_ invoke__\">new</span>(<span class=\"string\">&quot;Charlie&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;[创建] Charlie, 初始强引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;charlie)</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 建立朋友关系</span></span><br><span class=\"line\">    <span class=\"comment\">// 添加 Alice 和 Bob 为朋友</span></span><br><span class=\"line\">    User::<span class=\"title function_ invoke__\">add_friend</span>(&amp;alice, &amp;bob);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[添加好友] Alice 和 Bob&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;  Alice 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;alice),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;alice)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;  Bob 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;bob),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;bob)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"comment\">// 添加 Alice 和 Charlie 为朋友</span></span><br><span class=\"line\">    User::<span class=\"title function_ invoke__\">add_friend</span>(&amp;alice, &amp;charlie);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[添加好友] Alice 和 Charlie&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;  Alice 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;alice),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;alice)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;  Charlie 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;charlie),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;charlie)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"comment\">// 添加 Bob 和 Charlie 为朋友</span></span><br><span class=\"line\">    User::<span class=\"title function_ invoke__\">add_friend</span>(&amp;bob, &amp;charlie);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[添加好友] Bob 和 Charlie&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;  Bob 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;bob),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;bob)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;  Charlie 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;charlie),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;charlie)</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建临时用户 Dave 来演示弱引用</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"variable\">dave</span> = User::<span class=\"title function_ invoke__\">new</span>(<span class=\"string\">&quot;Dave&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">            <span class=\"string\">&quot;[创建临时用户] Dave, 初始强引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">            Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;dave)</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"comment\">// 添加 Alice 和 Dave 为朋友</span></span><br><span class=\"line\">        <span class=\"comment\">// 注意：这里只单向添加，避免循环引用</span></span><br><span class=\"line\">        alice</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">borrow_mut</span>()</span><br><span class=\"line\">            .friends</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">borrow_mut</span>()</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">push</span>(Rc::<span class=\"title function_ invoke__\">downgrade</span>(&amp;dave));</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[添加好友] Alice 和 Dave（弱引用）&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">            <span class=\"string\">&quot;  Alice 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">            Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;alice),</span><br><span class=\"line\">            Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;alice)</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">            <span class=\"string\">&quot;  Dave 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">            Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;dave),</span><br><span class=\"line\">            Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;dave)</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"comment\">// 展示 Alice 的朋友（包括 Dave）</span></span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[展示 Alice 的完整朋友列表]&quot;</span>);</span><br><span class=\"line\">        alice.<span class=\"title function_ invoke__\">borrow</span>().<span class=\"title function_ invoke__\">show_friends</span>();</span><br><span class=\"line\">        <span class=\"comment\">// 作用域结束，Dave 将被销毁</span></span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[临时用户 Dave 离开作用域]&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 展示最终朋友关系</span></span><br><span class=\"line\">    <span class=\"comment\">// 展示 Alice 的朋友列表（Dave 已消失）</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[Alice 的最终朋友列表]&quot;</span>);</span><br><span class=\"line\">    alice.<span class=\"title function_ invoke__\">borrow</span>().<span class=\"title function_ invoke__\">show_friends</span>();</span><br><span class=\"line\">    <span class=\"comment\">// 展示 Bob 的朋友列表</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[Bob 的朋友列表]&quot;</span>);</span><br><span class=\"line\">    bob.<span class=\"title function_ invoke__\">borrow</span>().<span class=\"title function_ invoke__\">show_friends</span>();</span><br><span class=\"line\">    <span class=\"comment\">// 展示 Charlie 的朋友列表</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[Charlie 的朋友列表]&quot;</span>);</span><br><span class=\"line\">    charlie.<span class=\"title function_ invoke__\">borrow</span>().<span class=\"title function_ invoke__\">show_friends</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 最终引用计数状态</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;程序结束前引用计数状态:&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;Alice: 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;alice),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;alice)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;Bob: 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;bob),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;bob)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;Charlie: 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;charlie),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;charlie)</span><br><span class=\"line\">    );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/19_smart_pointer2\" >Codes in lesson19<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"课程概述\"><a href=\"#课程概述\" class=\"headerlink\" title=\"课程概述\"></a>课程概述</h2><ul>\n<li><code>Rc&lt;T&gt;</code></li>\n<li><code>RefCell&lt;T&gt;</code></li>\n<li><code>Weak&lt;T&gt;</code></li>\n</ul>\n<h2 id=\"Rc-引用计数指针\"><a href=\"#Rc-引用计数指针\" class=\"headerlink\" title=\"Rc&lt;T&gt; 引用计数指针\"></a><code>Rc&lt;T&gt;</code> 引用计数指针</h2><h3 id=\"什么是-Rc？\"><a href=\"#什么是-Rc？\" class=\"headerlink\" title=\"什么是 Rc&lt;T&gt;？\"></a>什么是 <code>Rc&lt;T&gt;</code>？</h3><ul>\n<li>Rc 是 Reference Counted（引用计数） 的缩写</li>\n<li>允许多所有者的共享所有权模型</li>\n</ul>\n<h3 id=\"举例说明\"><a href=\"#举例说明\" class=\"headerlink\" title=\"举例说明\"></a>举例说明</h3><p>使用 <code>Box&lt;T&gt;</code> 定义 cons list 的例子。这一次，我们希望创建两个共享第三个列表所有权的列表</p>\n<p>尝试使用 <code>Box&lt;T&gt;</code> 定义的 List：</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> crate::List::&#123;Cons, Nil&#125;;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">a</span> = <span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">5</span>, <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(<span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">10</span>, <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(Nil))));</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">b</span> = <span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">3</span>, <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(a));</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">c</span> = <span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">4</span>, <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(a)); <span class=\"comment\">// use of moved value: `a`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">List</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Cons</span>(<span class=\"type\">i32</span>, <span class=\"type\">Box</span>&lt;List&gt;),</span><br><span class=\"line\">    Nil,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用-Rc-实现\"><a href=\"#使用-Rc-实现\" class=\"headerlink\" title=\"使用 Rc&lt;T&gt; 实现\"></a>使用 <code>Rc&lt;T&gt;</code> 实现</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> crate::List::&#123;Cons, Nil&#125;;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::rc::Rc;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">a</span> = Rc::<span class=\"title function_ invoke__\">new</span>(<span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">5</span>, Rc::<span class=\"title function_ invoke__\">new</span>(<span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">10</span>, Rc::<span class=\"title function_ invoke__\">new</span>(Nil)))));</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;a: &#123;&#125;&quot;</span>, Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;a));</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">b</span> = <span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">3</span>, Rc::<span class=\"title function_ invoke__\">clone</span>(&amp;a));</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;a: &#123;&#125;&quot;</span>, Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;a));</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">c</span> = <span class=\"title function_ invoke__\">Cons</span>(<span class=\"number\">4</span>, Rc::<span class=\"title function_ invoke__\">clone</span>(&amp;a));</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;a: &#123;&#125;&quot;</span>, Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;a));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">enum</span> <span class=\"title class_\">List</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Cons</span>(<span class=\"type\">i32</span>, Rc&lt;List&gt;),</span><br><span class=\"line\">    Nil,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"RefCell\"><a href=\"#RefCell\" class=\"headerlink\" title=\"RefCell&lt;T&gt;\"></a><code>RefCell&lt;T&gt;</code></h2><h3 id=\"什么是RefCell？\"><a href=\"#什么是RefCell？\" class=\"headerlink\" title=\"什么是RefCell&lt;T&gt;？\"></a>什么是<code>RefCell&lt;T&gt;</code>？</h3><p><code>RefCell&lt;T&gt;</code> 是一个智能指针类型，允许在编译时无法确定的情况下，在运行时进行借用检查</p>\n<h3 id=\"主要特征\"><a href=\"#主要特征\" class=\"headerlink\" title=\"主要特征\"></a>主要特征</h3><ul>\n<li>内部可变性:<ul>\n<li><code>RefCell&lt;T&gt;</code> 允许你在其拥有的 <code>T</code> 内部进行修改，即使 <code>RefCell</code> 本身是不可变的。这是通过在运行时进行借用检查实现的</li>\n</ul>\n</li>\n<li>运行时借用检查:<ul>\n<li><code>RefCell</code> 使用动态借用检查，确保在运行时遵循 Rust 的借用规则，即在任何时刻，<code>RefCell</code> 只能有一个可变借用或多个不可变借用，但不能同时存在</li>\n</ul>\n</li>\n<li><code>borrow</code> 和 <code>borrow_mut</code> 方法:<ul>\n<li><code>RefCell</code> 提供了两个方法来获取对内部数据的借用：<ul>\n<li><code>borrow()</code>：获取不可变借用（<code>Ref&lt;T&gt;</code>），可以同时有多个</li>\n<li><code>borrow_mut()</code>：获取可变借用（<code>RefMut&lt;T&gt;</code>），在同一时间只能有一个</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"关键点\"><a href=\"#关键点\" class=\"headerlink\" title=\"关键点\"></a>关键点</h3><ul>\n<li>借用规则:<ul>\n<li><code>RefCell</code> 在运行时检查借用规则，以防止数据竞争和未定义行为。编译器不进行这些检查，而是依赖 <code>RefCell</code> 在运行时进行</li>\n</ul>\n</li>\n<li>运行时开销:<ul>\n<li>因为 <code>RefCell</code> 需要在运行时检查借用规则，所以它会引入一定的性能开销。这在需要在编译时确定所有借用规则的场景中不可替代</li>\n</ul>\n</li>\n<li>错误处理:<ul>\n<li>如果违反了借用规则（例如，尝试同时获取多个可变借用），<code>RefCell</code> 会在运行时引发 panic</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h3><ul>\n<li>数据结构:<ul>\n<li>在需要可变性但又受限于 Rust 的所有权系统时，<code>RefCell</code> 允许在数据结构中使用内部可变性。例如，实现需要共享但修改的数据结构（如图、树）</li>\n</ul>\n</li>\n<li>单线程环境:<ul>\n<li><code>RefCell</code> 主要用于单线程环境。如果你需要在多线程环境中处理内部可变性，应该使用 Mutex 或 RwLock 这类类型。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"引用循环与内存泄漏\"><a href=\"#引用循环与内存泄漏\" class=\"headerlink\" title=\"引用循环与内存泄漏\"></a>引用循环与内存泄漏</h2><p>引用计数（<code>Rc&lt;T&gt;</code>）和原子引用计数（<code>Arc&lt;T&gt;</code>）可以让多个所有者共享同一个数据。然而，这种共享机制如果不当使用，可能会导致引用循环（reference cycle），从而造成内存泄漏</p>\n<h3 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::rc::Rc;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::cell::RefCell;</span><br><span class=\"line\"><span class=\"meta\">#[derive(Debug)]</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Node</span> &#123;</span><br><span class=\"line\">    value: <span class=\"type\">i32</span>,</span><br><span class=\"line\">    next: <span class=\"type\">Option</span>&lt;Rc&lt;RefCell&lt;Node&gt;&gt;&gt;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">first</span> = Rc::<span class=\"title function_ invoke__\">new</span>(RefCell::<span class=\"title function_ invoke__\">new</span>(Node &#123; value: <span class=\"number\">1</span>, next: <span class=\"literal\">None</span> &#125;));</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">second</span> = Rc::<span class=\"title function_ invoke__\">new</span>(RefCell::<span class=\"title function_ invoke__\">new</span>(Node &#123; value: <span class=\"number\">2</span>, next: <span class=\"literal\">None</span> &#125;));</span><br><span class=\"line\">    <span class=\"comment\">// 创建引用循环</span></span><br><span class=\"line\">    first.<span class=\"title function_ invoke__\">borrow_mut</span>().next = <span class=\"title function_ invoke__\">Some</span>(Rc::<span class=\"title function_ invoke__\">clone</span>(&amp;second));</span><br><span class=\"line\">    second.<span class=\"title function_ invoke__\">borrow_mut</span>().next = <span class=\"title function_ invoke__\">Some</span>(Rc::<span class=\"title function_ invoke__\">clone</span>(&amp;first));</span><br><span class=\"line\">    <span class=\"comment\">// 如果尝试打印引用计数，将看到引用循环已经发生</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;first strong = &#123;&#125;, weak = &#123;&#125;&quot;</span>, Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;first), Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;first));</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;second strong = &#123;&#125;, weak = &#123;&#125;&quot;</span>, Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;second), Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;second));</span><br><span class=\"line\">    <span class=\"comment\">// println!(&quot;&#123;:?&#125;&quot;, &amp;first); // stack overflow</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Weak-弱引用\"><a href=\"#Weak-弱引用\" class=\"headerlink\" title=\"Weak&lt;T&gt; 弱引用\"></a><code>Weak&lt;T&gt;</code> 弱引用</h2><h3 id=\"Weak-的特点\"><a href=\"#Weak-的特点\" class=\"headerlink\" title=\"Weak&lt;T&gt; 的特点\"></a><code>Weak&lt;T&gt;</code> 的特点</h3><ul>\n<li>非所有权引用: <code>Weak&lt;T&gt;</code> 并不拥有数据的所有权，因此它不会影响 <code>Rc&lt;T&gt;</code> 的引用计数</li>\n<li>不会引发内存泄漏: 由于 <code>Weak&lt;T&gt;</code> 不增加引用计数，可以避免引用循环问题，从而避免内存泄漏</li>\n<li>必须升级: <code>Weak&lt;T&gt;</code> 是一个非所有权引用，因此在使用数据之前，需要通过 <code>upgrade()</code> 方法将其升级为 <code>Rc&lt;T&gt;</code>。如果数据已经被释放，<code>upgrade()</code> 会返回 <code>None</code></li>\n</ul>\n<h3 id=\"解决循环引用\"><a href=\"#解决循环引用\" class=\"headerlink\" title=\"解决循环引用\"></a>解决循环引用</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::cell::RefCell;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::rc::&#123;Rc, Weak&#125;;</span><br><span class=\"line\"><span class=\"meta\">#[derive(Debug)]</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Node</span> &#123;</span><br><span class=\"line\">    value: <span class=\"type\">i32</span>,</span><br><span class=\"line\">    next: <span class=\"type\">Option</span>&lt;Rc&lt;RefCell&lt;Node&gt;&gt;&gt;,</span><br><span class=\"line\">    prev: <span class=\"type\">Option</span>&lt;Weak&lt;RefCell&lt;Node&gt;&gt;&gt;, <span class=\"comment\">// 添加一个弱引用来指向前一个节点</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">first</span> = Rc::<span class=\"title function_ invoke__\">new</span>(RefCell::<span class=\"title function_ invoke__\">new</span>(Node &#123;</span><br><span class=\"line\">        value: <span class=\"number\">1</span>,</span><br><span class=\"line\">        next: <span class=\"literal\">None</span>,</span><br><span class=\"line\">        prev: <span class=\"literal\">None</span>,</span><br><span class=\"line\">    &#125;));</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">second</span> = Rc::<span class=\"title function_ invoke__\">new</span>(RefCell::<span class=\"title function_ invoke__\">new</span>(Node &#123;</span><br><span class=\"line\">        value: <span class=\"number\">2</span>,</span><br><span class=\"line\">        next: <span class=\"literal\">None</span>,</span><br><span class=\"line\">        prev: <span class=\"literal\">None</span>,</span><br><span class=\"line\">    &#125;));</span><br><span class=\"line\">    <span class=\"comment\">// 创建非循环引用</span></span><br><span class=\"line\">    first.<span class=\"title function_ invoke__\">borrow_mut</span>().next = <span class=\"title function_ invoke__\">Some</span>(Rc::<span class=\"title function_ invoke__\">clone</span>(&amp;second));</span><br><span class=\"line\">    second.<span class=\"title function_ invoke__\">borrow_mut</span>().prev = <span class=\"title function_ invoke__\">Some</span>(Rc::<span class=\"title function_ invoke__\">downgrade</span>(&amp;first));</span><br><span class=\"line\">    <span class=\"comment\">// 如果尝试打印引用计数</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;first strong = &#123;&#125;, weak = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;first),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;first)</span><br><span class=\"line\">    ); <span class=\"comment\">// first strong = 1, weak = 1</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;second strong = &#123;&#125;, weak = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;second),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;second)</span><br><span class=\"line\">    ); <span class=\"comment\">// second strong = 2, weak = 0</span></span><br><span class=\"line\">    <span class=\"comment\">// 因为 second 还拥有 first.borrow_mut().next 的所有权</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;:?&#125;&quot;</span>, &amp;first);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"强引用与弱引用的主要区别\"><a href=\"#强引用与弱引用的主要区别\" class=\"headerlink\" title=\"强引用与弱引用的主要区别\"></a>强引用与弱引用的主要区别</h3><ol>\n<li><p><strong>所有权</strong>:</p>\n<ul>\n<li>强引用 (<code>Rc&lt;T&gt;</code>): 持有数据的所有权，保证数据在作用域内不会被释放。</li>\n<li>弱引用 (<code>Weak&lt;T&gt;</code>): 不持有数据的所有权，不影响数据的生命周期。</li>\n</ul>\n</li>\n<li><p><strong>引用计数</strong>:</p>\n<ul>\n<li>强引用: 增加引用计数，数据被多个所有者共享。</li>\n<li>弱引用: 不增加引用计数，不干扰 <code>Rc&lt;T&gt;</code> 的生命周期管理。</li>\n</ul>\n</li>\n<li><p><strong>内存管理</strong>:</p>\n<ul>\n<li>强引用: 只有当所有强引用都被丢弃时，数据才会被释放。</li>\n<li>弱引用: 只能通过升级 (<code>upgrade()</code>) 来访问数据，如果数据已经被释放，则升级会失败。</li>\n</ul>\n</li>\n<li><p><strong>适用场景</strong>:</p>\n<ul>\n<li>强引用: 当你希望共享数据并确保数据在至少一个强引用存在时不会被释放。</li>\n<li>弱引用: 当你需要避免引用循环或只需要偶尔访问数据，不想持有其所有权时。</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"课后作业\"><a href=\"#课后作业\" class=\"headerlink\" title=\"课后作业\"></a>课后作业</h2><p>任务: 实现一个简单的社交网络系统，包含用户和朋友关系。使用 <code>Rc&lt;T&gt;</code>, <code>RefCell&lt;T&gt;</code>, <code>Weak&lt;T&gt;</code> 来处理用户和朋友之间的关系，并避免循环引用导致的内存泄漏</p>\n<p>要求:</p>\n<ul>\n<li>用户结构: 每个用户拥有一个名字和一个朋友列表。</li>\n<li>添加朋友: 支持在两个用户之间建立朋友关系。</li>\n<li>展示朋友关系: 能够展示每个用户的朋友列表。</li>\n<li>循环引用: 处理用户之间的双向引用，确保不产生循环引用。</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::cell::RefCell;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::rc::&#123;Rc, Weak&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">User</span> &#123;</span><br><span class=\"line\">    name: <span class=\"type\">String</span>,</span><br><span class=\"line\">    <span class=\"comment\">// 一个用户拥有一个朋友列表（Vec），这个列表存储的是对其他用户的弱引用（Weak）</span></span><br><span class=\"line\">    <span class=\"comment\">// 每个朋友用户（即其他用户）需要具有内部可变性，所以每个朋友用户被包裹在 RefCell 中</span></span><br><span class=\"line\">    <span class=\"comment\">// 用户自己需要能够修改朋友列表（添加朋友），所以整个列表被包裹在 RefCell 中以提供内部可变性</span></span><br><span class=\"line\">    friends: RefCell&lt;<span class=\"type\">Vec</span>&lt;Weak&lt;RefCell&lt;User&gt;&gt;&gt;&gt;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">User</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 用户对象需要：共享所有权（Rc）、提供内部可变性（RefCell）</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">new</span>(name: &amp;<span class=\"type\">str</span>) <span class=\"punctuation\">-&gt;</span> Rc&lt;RefCell&lt;<span class=\"keyword\">Self</span>&gt;&gt; &#123;</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">new</span>(RefCell::<span class=\"title function_ invoke__\">new</span>(User &#123;</span><br><span class=\"line\">            name: name.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">            friends: RefCell::<span class=\"title function_ invoke__\">new</span>(<span class=\"type\">Vec</span>::<span class=\"title function_ invoke__\">new</span>()),</span><br><span class=\"line\">        &#125;))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 添加好友：在 user1 和 user2 之间建立好友关系</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">add_friend</span>(user1: &amp;Rc&lt;RefCell&lt;<span class=\"keyword\">Self</span>&gt;&gt;, user2: &amp;Rc&lt;RefCell&lt;<span class=\"keyword\">Self</span>&gt;&gt;) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 在 user1 的朋友列表中添加 user2 的弱引用</span></span><br><span class=\"line\">        user1</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">borrow_mut</span>() <span class=\"comment\">// 获取 user1 的可变借用</span></span><br><span class=\"line\">            .friends</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">borrow_mut</span>() <span class=\"comment\">// 获取 user1 好友列表的可变借用</span></span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">push</span>(Rc::<span class=\"title function_ invoke__\">downgrade</span>(user2)); <span class=\"comment\">// 添加 user2 的弱引用</span></span><br><span class=\"line\">        <span class=\"comment\">// 在 user2 的朋友列表中添加 user1 的弱引用</span></span><br><span class=\"line\">        user2</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">borrow_mut</span>()</span><br><span class=\"line\">            .friends</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">borrow_mut</span>()</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">push</span>(Rc::<span class=\"title function_ invoke__\">downgrade</span>((user1)));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 显示用户的好友列表</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">show_friends</span>(&amp;<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125; 的朋友:&quot;</span>, <span class=\"keyword\">self</span>.name);</span><br><span class=\"line\">        <span class=\"comment\">// 遍历好友列表中的每个弱引用</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (i, friend) <span class=\"keyword\">in</span> <span class=\"keyword\">self</span>.friends.<span class=\"title function_ invoke__\">borrow</span>().<span class=\"title function_ invoke__\">iter</span>().<span class=\"title function_ invoke__\">enumerate</span>() &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 将弱引用升级为强引用</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> <span class=\"variable\">Some</span>(friend_rc) = friend.<span class=\"title function_ invoke__\">upgrade</span>() &#123;</span><br><span class=\"line\">                <span class=\"keyword\">let</span> <span class=\"variable\">friend_ref</span> = friend_rc.<span class=\"title function_ invoke__\">borrow</span>();</span><br><span class=\"line\">                <span class=\"comment\">// 打印朋友名称</span></span><br><span class=\"line\">                <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;  &#123;&#125;. &#123;&#125;&quot;</span>, i + <span class=\"number\">1</span>, friend_ref.name);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// 朋友已释放（异常情况）</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;  &#123;&#125;. [已移除的朋友]&quot;</span>, i + <span class=\"number\">1</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(); <span class=\"comment\">// 添加空行分隔</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 创建用户 Alice</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">alice</span> = User::<span class=\"title function_ invoke__\">new</span>(<span class=\"string\">&quot;Alice&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;[创建] Alice, 初始强引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;alice)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"comment\">// 创建用户 Bob</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">bob</span> = User::<span class=\"title function_ invoke__\">new</span>(<span class=\"string\">&quot;Bob&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[创建] Bob, 初始强引用计数 = &#123;&#125;&quot;</span>, Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;bob));</span><br><span class=\"line\">    <span class=\"comment\">// 创建用户 Charlie</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">charlie</span> = User::<span class=\"title function_ invoke__\">new</span>(<span class=\"string\">&quot;Charlie&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;[创建] Charlie, 初始强引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;charlie)</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 建立朋友关系</span></span><br><span class=\"line\">    <span class=\"comment\">// 添加 Alice 和 Bob 为朋友</span></span><br><span class=\"line\">    User::<span class=\"title function_ invoke__\">add_friend</span>(&amp;alice, &amp;bob);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[添加好友] Alice 和 Bob&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;  Alice 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;alice),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;alice)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;  Bob 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;bob),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;bob)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"comment\">// 添加 Alice 和 Charlie 为朋友</span></span><br><span class=\"line\">    User::<span class=\"title function_ invoke__\">add_friend</span>(&amp;alice, &amp;charlie);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[添加好友] Alice 和 Charlie&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;  Alice 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;alice),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;alice)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;  Charlie 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;charlie),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;charlie)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"comment\">// 添加 Bob 和 Charlie 为朋友</span></span><br><span class=\"line\">    User::<span class=\"title function_ invoke__\">add_friend</span>(&amp;bob, &amp;charlie);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[添加好友] Bob 和 Charlie&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;  Bob 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;bob),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;bob)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;  Charlie 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;charlie),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;charlie)</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建临时用户 Dave 来演示弱引用</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"variable\">dave</span> = User::<span class=\"title function_ invoke__\">new</span>(<span class=\"string\">&quot;Dave&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">            <span class=\"string\">&quot;[创建临时用户] Dave, 初始强引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">            Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;dave)</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"comment\">// 添加 Alice 和 Dave 为朋友</span></span><br><span class=\"line\">        <span class=\"comment\">// 注意：这里只单向添加，避免循环引用</span></span><br><span class=\"line\">        alice</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">borrow_mut</span>()</span><br><span class=\"line\">            .friends</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">borrow_mut</span>()</span><br><span class=\"line\">            .<span class=\"title function_ invoke__\">push</span>(Rc::<span class=\"title function_ invoke__\">downgrade</span>(&amp;dave));</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[添加好友] Alice 和 Dave（弱引用）&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">            <span class=\"string\">&quot;  Alice 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">            Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;alice),</span><br><span class=\"line\">            Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;alice)</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">            <span class=\"string\">&quot;  Dave 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">            Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;dave),</span><br><span class=\"line\">            Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;dave)</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"comment\">// 展示 Alice 的朋友（包括 Dave）</span></span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[展示 Alice 的完整朋友列表]&quot;</span>);</span><br><span class=\"line\">        alice.<span class=\"title function_ invoke__\">borrow</span>().<span class=\"title function_ invoke__\">show_friends</span>();</span><br><span class=\"line\">        <span class=\"comment\">// 作用域结束，Dave 将被销毁</span></span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[临时用户 Dave 离开作用域]&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 展示最终朋友关系</span></span><br><span class=\"line\">    <span class=\"comment\">// 展示 Alice 的朋友列表（Dave 已消失）</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[Alice 的最终朋友列表]&quot;</span>);</span><br><span class=\"line\">    alice.<span class=\"title function_ invoke__\">borrow</span>().<span class=\"title function_ invoke__\">show_friends</span>();</span><br><span class=\"line\">    <span class=\"comment\">// 展示 Bob 的朋友列表</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[Bob 的朋友列表]&quot;</span>);</span><br><span class=\"line\">    bob.<span class=\"title function_ invoke__\">borrow</span>().<span class=\"title function_ invoke__\">show_friends</span>();</span><br><span class=\"line\">    <span class=\"comment\">// 展示 Charlie 的朋友列表</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;[Charlie 的朋友列表]&quot;</span>);</span><br><span class=\"line\">    charlie.<span class=\"title function_ invoke__\">borrow</span>().<span class=\"title function_ invoke__\">show_friends</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 最终引用计数状态</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;程序结束前引用计数状态:&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;Alice: 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;alice),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;alice)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;Bob: 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;bob),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;bob)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;Charlie: 强引用计数 = &#123;&#125;, 弱引用计数 = &#123;&#125;&quot;</span>,</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">strong_count</span>(&amp;charlie),</span><br><span class=\"line\">        Rc::<span class=\"title function_ invoke__\">weak_count</span>(&amp;charlie)</span><br><span class=\"line\">    );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","_processedHighlight":true},{"title":"IB-Rust-trait特性","date":"2025-06-10T14:00:54.000Z","_content":"\n[Codes in lesson20](https://github.com/Zoella-w/IB-Rust/tree/main/20_trait)\n\n## trait 定义\n\ntrait 定义了某个特定类型拥有可能与其他类型共享的功能\n\n>  *trait* 类似于其他语言中 **接口**（*interfaces*）的功能\n\n## trait 实现\n\n### 普通实现\n\n- 使用 `trait` 关键字声明一个特征\n- 在大括号中定义该特征的所有方法\n- 只定义特征方法的签名，而不进行实现，此时方法签名结尾是 `;`，而不是 `{}`\n\n```rust\npub trait Summary {\n    fn summarize(&self) -> String;\n}\n```\n\n#### 为类型实现特征\n\n```rust\npub trait Summary {\n    fn summarize(&self) -> String;\n}\n\npub struct Post {\n    pub title: String, // 标题\n    pub author: String, // 作者\n    pub content: String, // 内容\n}\nimpl Summary for Post {\n    fn summarize(&self) -> String {\n        format!(\"文章{}, 作者是{}\", self.title, self.author)\n    }\n}\n\npub struct Weibo {\n    pub username: String,\n    pub content: String\n}\nimpl Summary for Weibo {\n    fn summarize(&self) -> String {\n        format!(\"{}发表了微博{}\", self.username, self.content)\n    }\n}\n```\n\n#### 特征定义与实现的位置（孤儿规则）\n\n如果你想要为类型 `A` 实现特征 `T`，那么 `A` 或者 `T` 至少有一个是在当前作用域中定义的\n\n- 可以为上面的 `Post` 类型实现标准库中的 `Display` 特征，这是因为 `Post` 类型定义在当前的作用域中\n- 可以在当前包中为 `String` 类型实现 `Summary` 特征，因为 `Summary` 定义在当前作用域中\n- 无法在当前作用域中，为 `String` 类型实现 `Display` 特征，因为它们俩都定义在标准库中，而不是当前的作用域\n\n### 默认实现\n\n#### 1、其它类型无需再实现该方法，也可以选择重载该方法\n\n```rust\npub trait Summary {\n    fn summarize(&self) -> String {\n        String::from(\"(Read more...)\")\n    }\n}\n```\n\nPost 选择了默认实现，而 Weibo 重载了该方法\n\n```rust\nimpl Summary for Post {}\n\nimpl Summary for Weibo {\n    fn summarize(&self) -> String {\n        format!(\"{}发表了微博{}\", self.username, self.content)\n    }\n}\n```\n\n#### 2、默认实现 允许调用 相同特征中的其他方法，哪怕这些方法没有默认实现\n\n```rust\npub trait Summary {\n    fn summarize_author(&self) -> String;\n    fn summarize(&self) -> String {\n        format!(\"(Read more from {}...)\", self.summarize_author())\n    }\n}\n\nimpl Summary for Weibo {\n    fn summarize_author(&self) -> String {\n        format!(\"@{}\", self.username)\n    }\n}\nprintln!(\"1 new weibo: {}\", weibo.summarize());\n```\n\n### 带泛型的 trait\n\n- 可以对同一个目标类型，多次 impl 此 trait，每次提供不同的泛型参数\n- 在具体方法调用的时候，必须通过**类型标注**明确使用的是哪一个具体的实现\n\n```rust\n// 将元组结构体中的数据，转换为类型 T\ntrait Converter<T> {\n    fn convert(&self) -> T;\n}\n\nstruct MyInt(i32);\n\nimpl Converter<String> for MyInt {\n    fn convert(&self) -> String {\n        // self.0 访问元组结构体的第 0 个元素\n        self.0.to_string()\n    }\n}\nimpl Converter<f32> for MyInt {\n    fn convert(&self) -> f32 {\n        self.0 as f32\n    }\n}\n\nfn main() {\n    let my_int = MyInt(42);\n    let output: String = my_int.convert();\n    println!(\"output is: {}\", output);\n    let output: f32 = my_int.convert();\n    println!(\"output is: {}\", output);\n}\n```\n\n### 关联类型\n\n关联类型是 trait 定义中的类型占位符，定义时不指定其具体的类型，在实现（impl）该 trait 时，才为这个关联类型赋予确定的类型\n\n**关联类型方式只允许对目标类型实现一次**\n\n```rust\ntrait Converter {\n    type Output;\n    fn convert(&self) -> Self::Output;\n}\nimpl Converter for MyInt {\n    type Output = String;\n    fn convert(&self) -> Self::Output {\n        self.0.to_string()\n    }\n}\n```\n\n### 默认泛型类型参数\n\n#### 默认泛型的例子\n\n```rust\nfn add<T: std::ops::Add<Output = T>>(a: T, b: T) -> T {\n// 相当于 fn add<T: std::ops::Add<T, Output = T>>(a: T, b: T) -> T {\n    a + b\n}\nprintln!(\"add i8: {}\", add(2i8, 3i8));\nprintln!(\"add f64: {}\", add(1.23, 1.23));\n```\n\n#### 默认泛型类型参数\n\n加法之所以设置默认参数​，​是因为相同类型相加是最常见的情况\n\n```rust\ntrait Add<Rhs=Self> {\n    type Output;\n    fn add(self, rhs: Rhs) -> Self::Output;\n}\n```\n\n`<Rhs=Self>` 定义了加法操作的​​右操作数类型​​：\n- `Rhs` 是 \"Right-hand side\"（右操作数）的缩写\n- `=Self` 表示默认情况下右操作数与左操作数相同\n- 这是一个​​默认泛型参数​​语法，允许在实现时不显式指定类型\n\n`type Output;` 定义加法操作的​​结果类型​​，具体类型在实现时确定\n\n`fn add(self, rhs: Rhs) -> Self::Output;`\n- 接受两个参数：左操作数（self）和右操作数（rhs）\n- 返回 Output 关联类型定义的类型\n使用 move 语义转移所有权\n\n#### 使用默认泛型类型参数\n\n```rust\nuse std::ops::Add;\nstruct Point {\n    x: i32,\n    y: i32,\n}\nimpl Add for Point {\n    type Output = Point;\n    fn add(self, other: Point) -> Point {\n        Point {\n            x: self.x + other.x,\n            y: self.y + other.y,\n        }\n    }\n}\nfn main() {\n    assert_eq!(\n        Point { x: 1, y: 0 } + Point { x: 2, y: 3 },\n        Point { x: 3, y: 3 }\n    );\n}\n```\n\n#### 自定义 Rhs 类型而不使用默认类型\n\n```rust\nuse std::ops::Add;\n\nstruct Millimeters(u32);\nstruct Meters(u32);\n\nimpl Add<Meters> for Millimeters {\n    type Output = Millimeters;\n    fn add(self, other: Meters) -> Millimeters {\n        Millimeters(self.0 + (other.0 * 1000))\n    }\n}\n```\n\n## 使用特征作为函数参数\n\n### impl Trait 语法\n\n可以使用任何实现了 `Summary` 特征的类型作为该函数的参数\n\n```rust\npub fn notify(item: &impl Summary) {\n    println!(\"Breaking news! {}\", item.summarize());\n}\n```\n\n除了单个约束条件，还可以通过 `+` 语法指定多个约束条件\n\n```rust\npub fn notify(item: &(impl Summary + Display)) {}\n```\n\n### Trait Bound 语法\n\n- `impl Trait` 适用于短小的例子，它是 trait bound 语法的语法糖\n- 更长的 trait bound 则适用于更复杂的场景\n- 除了单个约束条件，我们还可以通过 `+` 语法指定多个约束条件\n\n```rust\npub fn notify<T: Summary>(item: &T) {\n    println!(\"Breaking news! {}\", item.summarize());\n}\n\npub fn notify<T: Summary + Display>(item: &T) {}\n```\n\n#### Trait Bound 能做到而 impl Trait 做不到的能力\n\n```rust\npub fn notify(item1: &impl Summary, item2: &impl Summary) {}\n```\n\n这适用于 `item1` 和 `item2` 允许是不同类型的情况（只要都实现了 `Summary`）。如果希望它们都是相同类型，就只能使用 trait bound 才能实现：\n\n```rust\npub fn notify<T: Summary>(item1: &T, item2: &T) {\n```\n\n### 通过 `where` 简化 trait bound\n\n```rust\nfn some_function<T: Display + Clone, U: Clone + Debug>(t: &T, u: &U) -> i32 {}\n```\n\n```rust\nfn some_function<T, U>(t: &T, u: &U) -> i32\n    where T: Display + Clone,\n          U: Clone + Debug\n{}\n```\n\n### 使用特征约束有条件地实现方法或特征\n#### 实现方法\n\n可以有条件地只为那些实现了特定 trait 的类型实现方法\n\n只有那些为 `T` 类型实现了 `PartialOrd` trait（允许比较）和 `Display` trait（允许打印）的 `Pair<T>` 才会实现 `cmp_display` 方法\n\n```rust\nuse std::fmt::Display;\nstruct Pair<T> {\n    x: T,\n    y: T,\n}\n// impl Pair<i32> {\n//     fn new(x: i32, y: i32) -> Self {\n//         Self { x, y }\n//     }\n// }\nimpl<T> Pair<T> {\n    fn new(x: T, y: T) -> Self {\n        Self { x, y }\n    }\n}\nimpl<T: Display + PartialOrd> Pair<T> {\n    fn cmp_display(&self) {\n        if self.x >= self.y {\n            println!(\"The largest member is x = {}\", self.x);\n        } else {\n            println!(\"The largest member is y = {}\", self.y);\n        }\n    }\n}\n```\n\n## 返回实现了 trait 的类型\n###  `impl Trait` 语法\n\n在返回值中使用 `impl Trait` 语法，来返回实现了某个 trait 的类型\n\n```rust\nfn returns_summarizable() -> impl Summary {\n    Weibo {\n        username: String::from(\"horse_ebooks\"),\n        content: String::from(\"of course, as you probably already know, people\"),\n    }\n}\n```\n\n### `dyn trait` 语法\n\n返回实现了某个 trait（动态 trait） 的类型\n\n#### 动态 trait 对象\n\n指定某种指针例如 `&` 引用或 `Box<T>` 智能指针，还有 `dyn` keyword，以及指定相关的 trait 来创建 trait 对象\n\n```rust\nfn returns_summarizable(switch: bool) -> Box<dyn Summary>  {\n    if switch {\n        Box::new(Post {\n            title: String::from(\n                \"Penguins win the Stanley Cup Championship!\",\n            ),\n            author: String::from(\"Iceburgh\"),\n            content: String::from(\n                \"The Pittsburgh Penguins once again are the best \\\n                 hockey team in the NHL.\",\n            ),\n        })\n    } else {\n        Box::new(Weibo {\n            username: String::from(\"horse_ebooks\"),\n            content: String::from(\n                \"of course, as you probably already know, people\",\n            ),\n        })\n    }\n}\n```\n\n## 通过 `derive` 派生特征\n\n形如 `#[derive(Debug)]` 的代码是一种特征派生语法，被 `derive` 标记的对象会自动实现对应的默认特征代码，继承相应的功能\n\n- `Debug` 特征有一套自动实现的默认代码，当给一个结构体标记后，就可以使用 `println!(\"{:?}\", s)` 的形式打印该结构体的对象\n- `Copy` 特征也有一套自动实现的默认代码，当标记到一个类型上时，可以让这个类型自动实现 `Copy` 特征，进而可以调用 `copy` 方法，进行自我复制\n\n```rust\n#[derive(Debug, Clone)]\nstruct Point {\n    x: i32,\n    y: i32,\n}\nfn main() {\n    let p1 = { x: 0, y: 1};\n    let p2 = p1;\n    println!(\"p1: {:?}\", p1); // 可以打印，因为实现了 Copy 特征\n}\n```\n\n### 用于程序员输出的 `Debug`\n\n`Debug` trait 用于开启格式化字符串中的调试格式，允许以调试目的来打印一个类型的实例，可以在程序执行的特定时间点观察其实例\n\n例如，在使用 `assert_eq!` 宏时，`Debug` trait 是必须的。如果等式断言失败，这个宏就把给定实例的值作为参数打印出来，就能看到两个实例为什么不相等\n\n### 默认值的 `Default`\n\n`Default` trait 会创建一个类型的默认值，`Default` 派生的实现调用了类型每部分的 `default` 函数，这意味着类型中所有的字段或值必须实现了 `Default` 才能派生 `Default` \n\n```rust\n#[derive(Default)]\npub struct Post {\n    pub title: String,   // 标题\n    pub author: String,  // 作者\n    pub content: String, // 内容\n}\nlet post1 = Post::default();\n```\n\n在 `Option<T>` 实例上使用 `unwrap_or_default` 方法时，`Default` trait 是必须的。如果 `Option<T>` 是 `None`，`unwrap_or_default` 将返回存储在 `Option<T>` 中 `T` 类型的 `Default::default` 的结果\n\n```rust\nlet post2 = None.unwrap_or_default();\n```\n\n## 练习题\n\n#### trait 的定义与实现\n\n```rust\nuse std::fmt::Display;\n\n// 不要需改 Item 的定义\ntrait Item<T = String> {\n    type Output: Display;\n    fn summarize(&self) -> Self::Output;\n}\n\n// 不要需改 Apple 结构的定义\nstruct Apple {\n    name: String,\n}\n\nimpl Item for Apple {\n    type Output = String; // 增加\n    fn summarize(&self) -> String {\n        self.name.to_string()\n    }\n}\n\n// 不要需改 weibo 结构的定义\nstruct Weibo {\n    author: String,\n    content: String,\n}\n\nimpl Item for Weibo {\n    type Output = String; // 增加\n    fn summarize(&self) -> String {\n        format!(\"@{}:{}\", self.author, self.content)\n    }\n}\n\npub struct Container {\n    // items: Vec<Item>,\n    items: Vec<Box<dyn Item<Output = String>>>, // 修改\n}\n\nimpl Container {\n    pub fn iterator(&self) {\n        // for item in self.items {\n        for item in &self.items { // 修改\n            println!(\"{}\", item.summarize());\n        }\n    }\n}\n\nfn main() {\n    let apple = Apple {\n        name: \"Apple\".to_string(),\n    };\n    let w = Weibo {\n        author: \"weibo\".to_string(),\n        content: \"hello\".to_string(),\n    };\n    let container = Container {\n        // items: vec![apple, w],\n        items: vec![Box::new(apple), Box::new(w)], // 修改\n    };\n    container.iterator();\n}\n```\n","source":"_posts/78-IB-Rust-trait特性.md","raw":"---\ntitle: IB-Rust-trait特性\ndate: 2025-06-10 22:00:54\ntags:\n    - Rust\ncategories:\n    - Rust\n      - IB课程\n---\n\n[Codes in lesson20](https://github.com/Zoella-w/IB-Rust/tree/main/20_trait)\n\n## trait 定义\n\ntrait 定义了某个特定类型拥有可能与其他类型共享的功能\n\n>  *trait* 类似于其他语言中 **接口**（*interfaces*）的功能\n\n## trait 实现\n\n### 普通实现\n\n- 使用 `trait` 关键字声明一个特征\n- 在大括号中定义该特征的所有方法\n- 只定义特征方法的签名，而不进行实现，此时方法签名结尾是 `;`，而不是 `{}`\n\n```rust\npub trait Summary {\n    fn summarize(&self) -> String;\n}\n```\n\n#### 为类型实现特征\n\n```rust\npub trait Summary {\n    fn summarize(&self) -> String;\n}\n\npub struct Post {\n    pub title: String, // 标题\n    pub author: String, // 作者\n    pub content: String, // 内容\n}\nimpl Summary for Post {\n    fn summarize(&self) -> String {\n        format!(\"文章{}, 作者是{}\", self.title, self.author)\n    }\n}\n\npub struct Weibo {\n    pub username: String,\n    pub content: String\n}\nimpl Summary for Weibo {\n    fn summarize(&self) -> String {\n        format!(\"{}发表了微博{}\", self.username, self.content)\n    }\n}\n```\n\n#### 特征定义与实现的位置（孤儿规则）\n\n如果你想要为类型 `A` 实现特征 `T`，那么 `A` 或者 `T` 至少有一个是在当前作用域中定义的\n\n- 可以为上面的 `Post` 类型实现标准库中的 `Display` 特征，这是因为 `Post` 类型定义在当前的作用域中\n- 可以在当前包中为 `String` 类型实现 `Summary` 特征，因为 `Summary` 定义在当前作用域中\n- 无法在当前作用域中，为 `String` 类型实现 `Display` 特征，因为它们俩都定义在标准库中，而不是当前的作用域\n\n### 默认实现\n\n#### 1、其它类型无需再实现该方法，也可以选择重载该方法\n\n```rust\npub trait Summary {\n    fn summarize(&self) -> String {\n        String::from(\"(Read more...)\")\n    }\n}\n```\n\nPost 选择了默认实现，而 Weibo 重载了该方法\n\n```rust\nimpl Summary for Post {}\n\nimpl Summary for Weibo {\n    fn summarize(&self) -> String {\n        format!(\"{}发表了微博{}\", self.username, self.content)\n    }\n}\n```\n\n#### 2、默认实现 允许调用 相同特征中的其他方法，哪怕这些方法没有默认实现\n\n```rust\npub trait Summary {\n    fn summarize_author(&self) -> String;\n    fn summarize(&self) -> String {\n        format!(\"(Read more from {}...)\", self.summarize_author())\n    }\n}\n\nimpl Summary for Weibo {\n    fn summarize_author(&self) -> String {\n        format!(\"@{}\", self.username)\n    }\n}\nprintln!(\"1 new weibo: {}\", weibo.summarize());\n```\n\n### 带泛型的 trait\n\n- 可以对同一个目标类型，多次 impl 此 trait，每次提供不同的泛型参数\n- 在具体方法调用的时候，必须通过**类型标注**明确使用的是哪一个具体的实现\n\n```rust\n// 将元组结构体中的数据，转换为类型 T\ntrait Converter<T> {\n    fn convert(&self) -> T;\n}\n\nstruct MyInt(i32);\n\nimpl Converter<String> for MyInt {\n    fn convert(&self) -> String {\n        // self.0 访问元组结构体的第 0 个元素\n        self.0.to_string()\n    }\n}\nimpl Converter<f32> for MyInt {\n    fn convert(&self) -> f32 {\n        self.0 as f32\n    }\n}\n\nfn main() {\n    let my_int = MyInt(42);\n    let output: String = my_int.convert();\n    println!(\"output is: {}\", output);\n    let output: f32 = my_int.convert();\n    println!(\"output is: {}\", output);\n}\n```\n\n### 关联类型\n\n关联类型是 trait 定义中的类型占位符，定义时不指定其具体的类型，在实现（impl）该 trait 时，才为这个关联类型赋予确定的类型\n\n**关联类型方式只允许对目标类型实现一次**\n\n```rust\ntrait Converter {\n    type Output;\n    fn convert(&self) -> Self::Output;\n}\nimpl Converter for MyInt {\n    type Output = String;\n    fn convert(&self) -> Self::Output {\n        self.0.to_string()\n    }\n}\n```\n\n### 默认泛型类型参数\n\n#### 默认泛型的例子\n\n```rust\nfn add<T: std::ops::Add<Output = T>>(a: T, b: T) -> T {\n// 相当于 fn add<T: std::ops::Add<T, Output = T>>(a: T, b: T) -> T {\n    a + b\n}\nprintln!(\"add i8: {}\", add(2i8, 3i8));\nprintln!(\"add f64: {}\", add(1.23, 1.23));\n```\n\n#### 默认泛型类型参数\n\n加法之所以设置默认参数​，​是因为相同类型相加是最常见的情况\n\n```rust\ntrait Add<Rhs=Self> {\n    type Output;\n    fn add(self, rhs: Rhs) -> Self::Output;\n}\n```\n\n`<Rhs=Self>` 定义了加法操作的​​右操作数类型​​：\n- `Rhs` 是 \"Right-hand side\"（右操作数）的缩写\n- `=Self` 表示默认情况下右操作数与左操作数相同\n- 这是一个​​默认泛型参数​​语法，允许在实现时不显式指定类型\n\n`type Output;` 定义加法操作的​​结果类型​​，具体类型在实现时确定\n\n`fn add(self, rhs: Rhs) -> Self::Output;`\n- 接受两个参数：左操作数（self）和右操作数（rhs）\n- 返回 Output 关联类型定义的类型\n使用 move 语义转移所有权\n\n#### 使用默认泛型类型参数\n\n```rust\nuse std::ops::Add;\nstruct Point {\n    x: i32,\n    y: i32,\n}\nimpl Add for Point {\n    type Output = Point;\n    fn add(self, other: Point) -> Point {\n        Point {\n            x: self.x + other.x,\n            y: self.y + other.y,\n        }\n    }\n}\nfn main() {\n    assert_eq!(\n        Point { x: 1, y: 0 } + Point { x: 2, y: 3 },\n        Point { x: 3, y: 3 }\n    );\n}\n```\n\n#### 自定义 Rhs 类型而不使用默认类型\n\n```rust\nuse std::ops::Add;\n\nstruct Millimeters(u32);\nstruct Meters(u32);\n\nimpl Add<Meters> for Millimeters {\n    type Output = Millimeters;\n    fn add(self, other: Meters) -> Millimeters {\n        Millimeters(self.0 + (other.0 * 1000))\n    }\n}\n```\n\n## 使用特征作为函数参数\n\n### impl Trait 语法\n\n可以使用任何实现了 `Summary` 特征的类型作为该函数的参数\n\n```rust\npub fn notify(item: &impl Summary) {\n    println!(\"Breaking news! {}\", item.summarize());\n}\n```\n\n除了单个约束条件，还可以通过 `+` 语法指定多个约束条件\n\n```rust\npub fn notify(item: &(impl Summary + Display)) {}\n```\n\n### Trait Bound 语法\n\n- `impl Trait` 适用于短小的例子，它是 trait bound 语法的语法糖\n- 更长的 trait bound 则适用于更复杂的场景\n- 除了单个约束条件，我们还可以通过 `+` 语法指定多个约束条件\n\n```rust\npub fn notify<T: Summary>(item: &T) {\n    println!(\"Breaking news! {}\", item.summarize());\n}\n\npub fn notify<T: Summary + Display>(item: &T) {}\n```\n\n#### Trait Bound 能做到而 impl Trait 做不到的能力\n\n```rust\npub fn notify(item1: &impl Summary, item2: &impl Summary) {}\n```\n\n这适用于 `item1` 和 `item2` 允许是不同类型的情况（只要都实现了 `Summary`）。如果希望它们都是相同类型，就只能使用 trait bound 才能实现：\n\n```rust\npub fn notify<T: Summary>(item1: &T, item2: &T) {\n```\n\n### 通过 `where` 简化 trait bound\n\n```rust\nfn some_function<T: Display + Clone, U: Clone + Debug>(t: &T, u: &U) -> i32 {}\n```\n\n```rust\nfn some_function<T, U>(t: &T, u: &U) -> i32\n    where T: Display + Clone,\n          U: Clone + Debug\n{}\n```\n\n### 使用特征约束有条件地实现方法或特征\n#### 实现方法\n\n可以有条件地只为那些实现了特定 trait 的类型实现方法\n\n只有那些为 `T` 类型实现了 `PartialOrd` trait（允许比较）和 `Display` trait（允许打印）的 `Pair<T>` 才会实现 `cmp_display` 方法\n\n```rust\nuse std::fmt::Display;\nstruct Pair<T> {\n    x: T,\n    y: T,\n}\n// impl Pair<i32> {\n//     fn new(x: i32, y: i32) -> Self {\n//         Self { x, y }\n//     }\n// }\nimpl<T> Pair<T> {\n    fn new(x: T, y: T) -> Self {\n        Self { x, y }\n    }\n}\nimpl<T: Display + PartialOrd> Pair<T> {\n    fn cmp_display(&self) {\n        if self.x >= self.y {\n            println!(\"The largest member is x = {}\", self.x);\n        } else {\n            println!(\"The largest member is y = {}\", self.y);\n        }\n    }\n}\n```\n\n## 返回实现了 trait 的类型\n###  `impl Trait` 语法\n\n在返回值中使用 `impl Trait` 语法，来返回实现了某个 trait 的类型\n\n```rust\nfn returns_summarizable() -> impl Summary {\n    Weibo {\n        username: String::from(\"horse_ebooks\"),\n        content: String::from(\"of course, as you probably already know, people\"),\n    }\n}\n```\n\n### `dyn trait` 语法\n\n返回实现了某个 trait（动态 trait） 的类型\n\n#### 动态 trait 对象\n\n指定某种指针例如 `&` 引用或 `Box<T>` 智能指针，还有 `dyn` keyword，以及指定相关的 trait 来创建 trait 对象\n\n```rust\nfn returns_summarizable(switch: bool) -> Box<dyn Summary>  {\n    if switch {\n        Box::new(Post {\n            title: String::from(\n                \"Penguins win the Stanley Cup Championship!\",\n            ),\n            author: String::from(\"Iceburgh\"),\n            content: String::from(\n                \"The Pittsburgh Penguins once again are the best \\\n                 hockey team in the NHL.\",\n            ),\n        })\n    } else {\n        Box::new(Weibo {\n            username: String::from(\"horse_ebooks\"),\n            content: String::from(\n                \"of course, as you probably already know, people\",\n            ),\n        })\n    }\n}\n```\n\n## 通过 `derive` 派生特征\n\n形如 `#[derive(Debug)]` 的代码是一种特征派生语法，被 `derive` 标记的对象会自动实现对应的默认特征代码，继承相应的功能\n\n- `Debug` 特征有一套自动实现的默认代码，当给一个结构体标记后，就可以使用 `println!(\"{:?}\", s)` 的形式打印该结构体的对象\n- `Copy` 特征也有一套自动实现的默认代码，当标记到一个类型上时，可以让这个类型自动实现 `Copy` 特征，进而可以调用 `copy` 方法，进行自我复制\n\n```rust\n#[derive(Debug, Clone)]\nstruct Point {\n    x: i32,\n    y: i32,\n}\nfn main() {\n    let p1 = { x: 0, y: 1};\n    let p2 = p1;\n    println!(\"p1: {:?}\", p1); // 可以打印，因为实现了 Copy 特征\n}\n```\n\n### 用于程序员输出的 `Debug`\n\n`Debug` trait 用于开启格式化字符串中的调试格式，允许以调试目的来打印一个类型的实例，可以在程序执行的特定时间点观察其实例\n\n例如，在使用 `assert_eq!` 宏时，`Debug` trait 是必须的。如果等式断言失败，这个宏就把给定实例的值作为参数打印出来，就能看到两个实例为什么不相等\n\n### 默认值的 `Default`\n\n`Default` trait 会创建一个类型的默认值，`Default` 派生的实现调用了类型每部分的 `default` 函数，这意味着类型中所有的字段或值必须实现了 `Default` 才能派生 `Default` \n\n```rust\n#[derive(Default)]\npub struct Post {\n    pub title: String,   // 标题\n    pub author: String,  // 作者\n    pub content: String, // 内容\n}\nlet post1 = Post::default();\n```\n\n在 `Option<T>` 实例上使用 `unwrap_or_default` 方法时，`Default` trait 是必须的。如果 `Option<T>` 是 `None`，`unwrap_or_default` 将返回存储在 `Option<T>` 中 `T` 类型的 `Default::default` 的结果\n\n```rust\nlet post2 = None.unwrap_or_default();\n```\n\n## 练习题\n\n#### trait 的定义与实现\n\n```rust\nuse std::fmt::Display;\n\n// 不要需改 Item 的定义\ntrait Item<T = String> {\n    type Output: Display;\n    fn summarize(&self) -> Self::Output;\n}\n\n// 不要需改 Apple 结构的定义\nstruct Apple {\n    name: String,\n}\n\nimpl Item for Apple {\n    type Output = String; // 增加\n    fn summarize(&self) -> String {\n        self.name.to_string()\n    }\n}\n\n// 不要需改 weibo 结构的定义\nstruct Weibo {\n    author: String,\n    content: String,\n}\n\nimpl Item for Weibo {\n    type Output = String; // 增加\n    fn summarize(&self) -> String {\n        format!(\"@{}:{}\", self.author, self.content)\n    }\n}\n\npub struct Container {\n    // items: Vec<Item>,\n    items: Vec<Box<dyn Item<Output = String>>>, // 修改\n}\n\nimpl Container {\n    pub fn iterator(&self) {\n        // for item in self.items {\n        for item in &self.items { // 修改\n            println!(\"{}\", item.summarize());\n        }\n    }\n}\n\nfn main() {\n    let apple = Apple {\n        name: \"Apple\".to_string(),\n    };\n    let w = Weibo {\n        author: \"weibo\".to_string(),\n        content: \"hello\".to_string(),\n    };\n    let container = Container {\n        // items: vec![apple, w],\n        items: vec![Box::new(apple), Box::new(w)], // 修改\n    };\n    container.iterator();\n}\n```\n","slug":"78-IB-Rust-trait特性","published":1,"updated":"2025-06-11T08:23:30.247Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cmbrop9km00014jpr2gf1erdd","content":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/20_trait\" >Codes in lesson20<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"trait-定义\"><a href=\"#trait-定义\" class=\"headerlink\" title=\"trait 定义\"></a>trait 定义</h2><p>trait 定义了某个特定类型拥有可能与其他类型共享的功能</p>\n<blockquote>\n<p> <em>trait</em> 类似于其他语言中 <strong>接口</strong>（<em>interfaces</em>）的功能</p>\n</blockquote>\n<h2 id=\"trait-实现\"><a href=\"#trait-实现\" class=\"headerlink\" title=\"trait 实现\"></a>trait 实现</h2><h3 id=\"普通实现\"><a href=\"#普通实现\" class=\"headerlink\" title=\"普通实现\"></a>普通实现</h3><ul>\n<li>使用 <code>trait</code> 关键字声明一个特征</li>\n<li>在大括号中定义该特征的所有方法</li>\n<li>只定义特征方法的签名，而不进行实现，此时方法签名结尾是 <code>;</code>，而不是 <code>&#123;&#125;</code></li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">trait</span> <span class=\"title class_\">Summary</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"为类型实现特征\"><a href=\"#为类型实现特征\" class=\"headerlink\" title=\"为类型实现特征\"></a>为类型实现特征</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">trait</span> <span class=\"title class_\">Summary</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">struct</span> <span class=\"title class_\">Post</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">pub</span> title: <span class=\"type\">String</span>, <span class=\"comment\">// 标题</span></span><br><span class=\"line\">    <span class=\"keyword\">pub</span> author: <span class=\"type\">String</span>, <span class=\"comment\">// 作者</span></span><br><span class=\"line\">    <span class=\"keyword\">pub</span> content: <span class=\"type\">String</span>, <span class=\"comment\">// 内容</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Post</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">format!</span>(<span class=\"string\">&quot;文章&#123;&#125;, 作者是&#123;&#125;&quot;</span>, <span class=\"keyword\">self</span>.title, <span class=\"keyword\">self</span>.author)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">struct</span> <span class=\"title class_\">Weibo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">pub</span> username: <span class=\"type\">String</span>,</span><br><span class=\"line\">    <span class=\"keyword\">pub</span> content: <span class=\"type\">String</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Weibo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">format!</span>(<span class=\"string\">&quot;&#123;&#125;发表了微博&#123;&#125;&quot;</span>, <span class=\"keyword\">self</span>.username, <span class=\"keyword\">self</span>.content)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"特征定义与实现的位置（孤儿规则）\"><a href=\"#特征定义与实现的位置（孤儿规则）\" class=\"headerlink\" title=\"特征定义与实现的位置（孤儿规则）\"></a>特征定义与实现的位置（孤儿规则）</h4><p>如果你想要为类型 <code>A</code> 实现特征 <code>T</code>，那么 <code>A</code> 或者 <code>T</code> 至少有一个是在当前作用域中定义的</p>\n<ul>\n<li>可以为上面的 <code>Post</code> 类型实现标准库中的 <code>Display</code> 特征，这是因为 <code>Post</code> 类型定义在当前的作用域中</li>\n<li>可以在当前包中为 <code>String</code> 类型实现 <code>Summary</code> 特征，因为 <code>Summary</code> 定义在当前作用域中</li>\n<li>无法在当前作用域中，为 <code>String</code> 类型实现 <code>Display</code> 特征，因为它们俩都定义在标准库中，而不是当前的作用域</li>\n</ul>\n<h3 id=\"默认实现\"><a href=\"#默认实现\" class=\"headerlink\" title=\"默认实现\"></a>默认实现</h3><h4 id=\"1、其它类型无需再实现该方法，也可以选择重载该方法\"><a href=\"#1、其它类型无需再实现该方法，也可以选择重载该方法\" class=\"headerlink\" title=\"1、其它类型无需再实现该方法，也可以选择重载该方法\"></a>1、其它类型无需再实现该方法，也可以选择重载该方法</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">trait</span> <span class=\"title class_\">Summary</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;(Read more...)&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>Post 选择了默认实现，而 Weibo 重载了该方法</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Post</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Weibo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">format!</span>(<span class=\"string\">&quot;&#123;&#125;发表了微博&#123;&#125;&quot;</span>, <span class=\"keyword\">self</span>.username, <span class=\"keyword\">self</span>.content)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"2、默认实现-允许调用-相同特征中的其他方法，哪怕这些方法没有默认实现\"><a href=\"#2、默认实现-允许调用-相同特征中的其他方法，哪怕这些方法没有默认实现\" class=\"headerlink\" title=\"2、默认实现 允许调用 相同特征中的其他方法，哪怕这些方法没有默认实现\"></a>2、默认实现 允许调用 相同特征中的其他方法，哪怕这些方法没有默认实现</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">trait</span> <span class=\"title class_\">Summary</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize_author</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span>;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">format!</span>(<span class=\"string\">&quot;(Read more from &#123;&#125;...)&quot;</span>, <span class=\"keyword\">self</span>.<span class=\"title function_ invoke__\">summarize_author</span>())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Weibo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize_author</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">format!</span>(<span class=\"string\">&quot;@&#123;&#125;&quot;</span>, <span class=\"keyword\">self</span>.username)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;1 new weibo: &#123;&#125;&quot;</span>, weibo.<span class=\"title function_ invoke__\">summarize</span>());</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"带泛型的-trait\"><a href=\"#带泛型的-trait\" class=\"headerlink\" title=\"带泛型的 trait\"></a>带泛型的 trait</h3><ul>\n<li>可以对同一个目标类型，多次 impl 此 trait，每次提供不同的泛型参数</li>\n<li>在具体方法调用的时候，必须通过<strong>类型标注</strong>明确使用的是哪一个具体的实现</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 将元组结构体中的数据，转换为类型 T</span></span><br><span class=\"line\"><span class=\"keyword\">trait</span> <span class=\"title class_\">Converter</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">convert</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> T;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">MyInt</span>(<span class=\"type\">i32</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Converter</span>&lt;<span class=\"type\">String</span>&gt; <span class=\"keyword\">for</span> <span class=\"title class_\">MyInt</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">convert</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// self.0 访问元组结构体的第 0 个元素</span></span><br><span class=\"line\">        <span class=\"keyword\">self</span>.<span class=\"number\">0</span>.<span class=\"title function_ invoke__\">to_string</span>()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Converter</span>&lt;<span class=\"type\">f32</span>&gt; <span class=\"keyword\">for</span> <span class=\"title class_\">MyInt</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">convert</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">f32</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.<span class=\"number\">0</span> <span class=\"keyword\">as</span> <span class=\"type\">f32</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">my_int</span> = <span class=\"title function_ invoke__\">MyInt</span>(<span class=\"number\">42</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">output</span>: <span class=\"type\">String</span> = my_int.<span class=\"title function_ invoke__\">convert</span>();</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;output is: &#123;&#125;&quot;</span>, output);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">output</span>: <span class=\"type\">f32</span> = my_int.<span class=\"title function_ invoke__\">convert</span>();</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;output is: &#123;&#125;&quot;</span>, output);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"关联类型\"><a href=\"#关联类型\" class=\"headerlink\" title=\"关联类型\"></a>关联类型</h3><p>关联类型是 trait 定义中的类型占位符，定义时不指定其具体的类型，在实现（impl）该 trait 时，才为这个关联类型赋予确定的类型</p>\n<p><strong>关联类型方式只允许对目标类型实现一次</strong></p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">trait</span> <span class=\"title class_\">Converter</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> <span class=\"title class_\">Output</span>;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">convert</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"keyword\">Self</span>::Output;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Converter</span> <span class=\"keyword\">for</span> <span class=\"title class_\">MyInt</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> <span class=\"title class_\">Output</span> = <span class=\"type\">String</span>;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">convert</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"keyword\">Self</span>::Output &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.<span class=\"number\">0</span>.<span class=\"title function_ invoke__\">to_string</span>()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"默认泛型类型参数\"><a href=\"#默认泛型类型参数\" class=\"headerlink\" title=\"默认泛型类型参数\"></a>默认泛型类型参数</h3><h4 id=\"默认泛型的例子\"><a href=\"#默认泛型的例子\" class=\"headerlink\" title=\"默认泛型的例子\"></a>默认泛型的例子</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">add</span>&lt;T: std::ops::Add&lt;Output = T&gt;&gt;(a: T, b: T) <span class=\"punctuation\">-&gt;</span> T &#123;</span><br><span class=\"line\"><span class=\"comment\">// 相当于 fn add&lt;T: std::ops::Add&lt;T, Output = T&gt;&gt;(a: T, b: T) -&gt; T &#123;</span></span><br><span class=\"line\">    a + b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;add i8: &#123;&#125;&quot;</span>, <span class=\"title function_ invoke__\">add</span>(<span class=\"number\">2i8</span>, <span class=\"number\">3i8</span>));</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;add f64: &#123;&#125;&quot;</span>, <span class=\"title function_ invoke__\">add</span>(<span class=\"number\">1.23</span>, <span class=\"number\">1.23</span>));</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"默认泛型类型参数-1\"><a href=\"#默认泛型类型参数-1\" class=\"headerlink\" title=\"默认泛型类型参数\"></a>默认泛型类型参数</h4><p>加法之所以设置默认参数​，​是因为相同类型相加是最常见的情况</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">trait</span> <span class=\"title class_\">Add</span>&lt;Rhs=<span class=\"keyword\">Self</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> <span class=\"title class_\">Output</span>;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">add</span>(<span class=\"keyword\">self</span>, rhs: Rhs) <span class=\"punctuation\">-&gt;</span> <span class=\"keyword\">Self</span>::Output;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p><code>&lt;Rhs=Self&gt;</code> 定义了加法操作的​​右操作数类型​​：</p>\n<ul>\n<li><code>Rhs</code> 是 “Right-hand side”（右操作数）的缩写</li>\n<li><code>=Self</code> 表示默认情况下右操作数与左操作数相同</li>\n<li>这是一个​​默认泛型参数​​语法，允许在实现时不显式指定类型</li>\n</ul>\n<p><code>type Output;</code> 定义加法操作的​​结果类型​​，具体类型在实现时确定</p>\n<p><code>fn add(self, rhs: Rhs) -&gt; Self::Output;</code></p>\n<ul>\n<li>接受两个参数：左操作数（self）和右操作数（rhs）</li>\n<li>返回 Output 关联类型定义的类型<br>使用 move 语义转移所有权</li>\n</ul>\n<h4 id=\"使用默认泛型类型参数\"><a href=\"#使用默认泛型类型参数\" class=\"headerlink\" title=\"使用默认泛型类型参数\"></a>使用默认泛型类型参数</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::ops::Add;</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Point</span> &#123;</span><br><span class=\"line\">    x: <span class=\"type\">i32</span>,</span><br><span class=\"line\">    y: <span class=\"type\">i32</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Add</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Point</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> <span class=\"title class_\">Output</span> = Point;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">add</span>(<span class=\"keyword\">self</span>, other: Point) <span class=\"punctuation\">-&gt;</span> Point &#123;</span><br><span class=\"line\">        Point &#123;</span><br><span class=\"line\">            x: <span class=\"keyword\">self</span>.x + other.x,</span><br><span class=\"line\">            y: <span class=\"keyword\">self</span>.y + other.y,</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(</span><br><span class=\"line\">        Point &#123; x: <span class=\"number\">1</span>, y: <span class=\"number\">0</span> &#125; + Point &#123; x: <span class=\"number\">2</span>, y: <span class=\"number\">3</span> &#125;,</span><br><span class=\"line\">        Point &#123; x: <span class=\"number\">3</span>, y: <span class=\"number\">3</span> &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"自定义-Rhs-类型而不使用默认类型\"><a href=\"#自定义-Rhs-类型而不使用默认类型\" class=\"headerlink\" title=\"自定义 Rhs 类型而不使用默认类型\"></a>自定义 Rhs 类型而不使用默认类型</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::ops::Add;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Millimeters</span>(<span class=\"type\">u32</span>);</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Meters</span>(<span class=\"type\">u32</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Add</span>&lt;Meters&gt; <span class=\"keyword\">for</span> <span class=\"title class_\">Millimeters</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> <span class=\"title class_\">Output</span> = Millimeters;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">add</span>(<span class=\"keyword\">self</span>, other: Meters) <span class=\"punctuation\">-&gt;</span> Millimeters &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Millimeters</span>(<span class=\"keyword\">self</span>.<span class=\"number\">0</span> + (other.<span class=\"number\">0</span> * <span class=\"number\">1000</span>))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"使用特征作为函数参数\"><a href=\"#使用特征作为函数参数\" class=\"headerlink\" title=\"使用特征作为函数参数\"></a>使用特征作为函数参数</h2><h3 id=\"impl-Trait-语法\"><a href=\"#impl-Trait-语法\" class=\"headerlink\" title=\"impl Trait 语法\"></a>impl Trait 语法</h3><p>可以使用任何实现了 <code>Summary</code> 特征的类型作为该函数的参数</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">notify</span>(item: &amp;<span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Breaking news! &#123;&#125;&quot;</span>, item.<span class=\"title function_ invoke__\">summarize</span>());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>除了单个约束条件，还可以通过 <code>+</code> 语法指定多个约束条件</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">notify</span>(item: &amp;(<span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span> + Display)) &#123;&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"Trait-Bound-语法\"><a href=\"#Trait-Bound-语法\" class=\"headerlink\" title=\"Trait Bound 语法\"></a>Trait Bound 语法</h3><ul>\n<li><code>impl Trait</code> 适用于短小的例子，它是 trait bound 语法的语法糖</li>\n<li>更长的 trait bound 则适用于更复杂的场景</li>\n<li>除了单个约束条件，我们还可以通过 <code>+</code> 语法指定多个约束条件</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">notify</span>&lt;T: Summary&gt;(item: &amp;T) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Breaking news! &#123;&#125;&quot;</span>, item.<span class=\"title function_ invoke__\">summarize</span>());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">notify</span>&lt;T: Summary + Display&gt;(item: &amp;T) &#123;&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"Trait-Bound-能做到而-impl-Trait-做不到的能力\"><a href=\"#Trait-Bound-能做到而-impl-Trait-做不到的能力\" class=\"headerlink\" title=\"Trait Bound 能做到而 impl Trait 做不到的能力\"></a>Trait Bound 能做到而 impl Trait 做不到的能力</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">notify</span>(item1: &amp;<span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span>, item2: &amp;<span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span>) &#123;&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>这适用于 <code>item1</code> 和 <code>item2</code> 允许是不同类型的情况（只要都实现了 <code>Summary</code>）。如果希望它们都是相同类型，就只能使用 trait bound 才能实现：</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">notify</span>&lt;T: Summary&gt;(item1: &amp;T, item2: &amp;T) &#123;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"通过-where-简化-trait-bound\"><a href=\"#通过-where-简化-trait-bound\" class=\"headerlink\" title=\"通过 where 简化 trait bound\"></a>通过 <code>where</code> 简化 trait bound</h3><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">some_function</span>&lt;T: Display + <span class=\"built_in\">Clone</span>, U: <span class=\"built_in\">Clone</span> + <span class=\"built_in\">Debug</span>&gt;(t: &amp;T, u: &amp;U) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">i32</span> &#123;&#125;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">some_function</span>&lt;T, U&gt;(t: &amp;T, u: &amp;U) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">i32</span></span><br><span class=\"line\">    <span class=\"keyword\">where</span> T: Display + <span class=\"built_in\">Clone</span>,</span><br><span class=\"line\">          U: <span class=\"built_in\">Clone</span> + <span class=\"built_in\">Debug</span></span><br><span class=\"line\">&#123;&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"使用特征约束有条件地实现方法或特征\"><a href=\"#使用特征约束有条件地实现方法或特征\" class=\"headerlink\" title=\"使用特征约束有条件地实现方法或特征\"></a>使用特征约束有条件地实现方法或特征</h3><h4 id=\"实现方法\"><a href=\"#实现方法\" class=\"headerlink\" title=\"实现方法\"></a>实现方法</h4><p>可以有条件地只为那些实现了特定 trait 的类型实现方法</p>\n<p>只有那些为 <code>T</code> 类型实现了 <code>PartialOrd</code> trait（允许比较）和 <code>Display</code> trait（允许打印）的 <code>Pair&lt;T&gt;</code> 才会实现 <code>cmp_display</code> 方法</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::fmt::Display;</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Pair</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    x: T,</span><br><span class=\"line\">    y: T,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// impl Pair&lt;i32&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//     fn new(x: i32, y: i32) -&gt; Self &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//         Self &#123; x, y &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//     &#125;</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br><span class=\"line\"><span class=\"keyword\">impl</span>&lt;T&gt; Pair&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">new</span>(x: T, y: T) <span class=\"punctuation\">-&gt;</span> <span class=\"keyword\">Self</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">Self</span> &#123; x, y &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span>&lt;T: Display + <span class=\"built_in\">PartialOrd</span>&gt; Pair&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">cmp_display</span>(&amp;<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">self</span>.x &gt;= <span class=\"keyword\">self</span>.y &#123;</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;The largest member is x = &#123;&#125;&quot;</span>, <span class=\"keyword\">self</span>.x);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;The largest member is y = &#123;&#125;&quot;</span>, <span class=\"keyword\">self</span>.y);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"返回实现了-trait-的类型\"><a href=\"#返回实现了-trait-的类型\" class=\"headerlink\" title=\"返回实现了 trait 的类型\"></a>返回实现了 trait 的类型</h2><h3 id=\"impl-Trait-语法-1\"><a href=\"#impl-Trait-语法-1\" class=\"headerlink\" title=\"impl Trait 语法\"></a><code>impl Trait</code> 语法</h3><p>在返回值中使用 <code>impl Trait</code> 语法，来返回实现了某个 trait 的类型</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">returns_summarizable</span>() <span class=\"punctuation\">-&gt;</span> <span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span> &#123;</span><br><span class=\"line\">    Weibo &#123;</span><br><span class=\"line\">        username: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;horse_ebooks&quot;</span>),</span><br><span class=\"line\">        content: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;of course, as you probably already know, people&quot;</span>),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"dyn-trait-语法\"><a href=\"#dyn-trait-语法\" class=\"headerlink\" title=\"dyn trait 语法\"></a><code>dyn trait</code> 语法</h3><p>返回实现了某个 trait（动态 trait） 的类型</p>\n<h4 id=\"动态-trait-对象\"><a href=\"#动态-trait-对象\" class=\"headerlink\" title=\"动态 trait 对象\"></a>动态 trait 对象</h4><p>指定某种指针例如 <code>&amp;</code> 引用或 <code>Box&lt;T&gt;</code> 智能指针，还有 <code>dyn</code> keyword，以及指定相关的 trait 来创建 trait 对象</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">returns_summarizable</span>(switch: <span class=\"type\">bool</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Box</span>&lt;<span class=\"keyword\">dyn</span> Summary&gt;  &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> switch &#123;</span><br><span class=\"line\">        <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(Post &#123;</span><br><span class=\"line\">            title: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(</span><br><span class=\"line\">                <span class=\"string\">&quot;Penguins win the Stanley Cup Championship!&quot;</span>,</span><br><span class=\"line\">            ),</span><br><span class=\"line\">            author: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Iceburgh&quot;</span>),</span><br><span class=\"line\">            content: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(</span><br><span class=\"line\">                <span class=\"string\">&quot;The Pittsburgh Penguins once again are the best \\</span></span><br><span class=\"line\"><span class=\"string\">                 hockey team in the NHL.&quot;</span>,</span><br><span class=\"line\">            ),</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(Weibo &#123;</span><br><span class=\"line\">            username: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;horse_ebooks&quot;</span>),</span><br><span class=\"line\">            content: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(</span><br><span class=\"line\">                <span class=\"string\">&quot;of course, as you probably already know, people&quot;</span>,</span><br><span class=\"line\">            ),</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"通过-derive-派生特征\"><a href=\"#通过-derive-派生特征\" class=\"headerlink\" title=\"通过 derive 派生特征\"></a>通过 <code>derive</code> 派生特征</h2><p>形如 <code>#[derive(Debug)]</code> 的代码是一种特征派生语法，被 <code>derive</code> 标记的对象会自动实现对应的默认特征代码，继承相应的功能</p>\n<ul>\n<li><code>Debug</code> 特征有一套自动实现的默认代码，当给一个结构体标记后，就可以使用 <code>println!(&quot;&#123;:?&#125;&quot;, s)</code> 的形式打印该结构体的对象</li>\n<li><code>Copy</code> 特征也有一套自动实现的默认代码，当标记到一个类型上时，可以让这个类型自动实现 <code>Copy</code> 特征，进而可以调用 <code>copy</code> 方法，进行自我复制</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#[derive(Debug, Clone)]</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Point</span> &#123;</span><br><span class=\"line\">    x: <span class=\"type\">i32</span>,</span><br><span class=\"line\">    y: <span class=\"type\">i32</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">p1</span> = &#123; x: <span class=\"number\">0</span>, y: <span class=\"number\">1</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">p2</span> = p1;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;p1: &#123;:?&#125;&quot;</span>, p1); <span class=\"comment\">// 可以打印，因为实现了 Copy 特征</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"用于程序员输出的-Debug\"><a href=\"#用于程序员输出的-Debug\" class=\"headerlink\" title=\"用于程序员输出的 Debug\"></a>用于程序员输出的 <code>Debug</code></h3><p><code>Debug</code> trait 用于开启格式化字符串中的调试格式，允许以调试目的来打印一个类型的实例，可以在程序执行的特定时间点观察其实例</p>\n<p>例如，在使用 <code>assert_eq!</code> 宏时，<code>Debug</code> trait 是必须的。如果等式断言失败，这个宏就把给定实例的值作为参数打印出来，就能看到两个实例为什么不相等</p>\n<h3 id=\"默认值的-Default\"><a href=\"#默认值的-Default\" class=\"headerlink\" title=\"默认值的 Default\"></a>默认值的 <code>Default</code></h3><p><code>Default</code> trait 会创建一个类型的默认值，<code>Default</code> 派生的实现调用了类型每部分的 <code>default</code> 函数，这意味着类型中所有的字段或值必须实现了 <code>Default</code> 才能派生 <code>Default</code> </p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#[derive(Default)]</span></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">struct</span> <span class=\"title class_\">Post</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">pub</span> title: <span class=\"type\">String</span>,   <span class=\"comment\">// 标题</span></span><br><span class=\"line\">    <span class=\"keyword\">pub</span> author: <span class=\"type\">String</span>,  <span class=\"comment\">// 作者</span></span><br><span class=\"line\">    <span class=\"keyword\">pub</span> content: <span class=\"type\">String</span>, <span class=\"comment\">// 内容</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">post1</span> = Post::<span class=\"title function_ invoke__\">default</span>();</span><br></pre></td></tr></table></figure></div>\n\n<p>在 <code>Option&lt;T&gt;</code> 实例上使用 <code>unwrap_or_default</code> 方法时，<code>Default</code> trait 是必须的。如果 <code>Option&lt;T&gt;</code> 是 <code>None</code>，<code>unwrap_or_default</code> 将返回存储在 <code>Option&lt;T&gt;</code> 中 <code>T</code> 类型的 <code>Default::default</code> 的结果</p>\n<div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">post2</span> = <span class=\"literal\">None</span>.<span class=\"title function_ invoke__\">unwrap_or_default</span>();</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"练习题\"><a href=\"#练习题\" class=\"headerlink\" title=\"练习题\"></a>练习题</h2><h4 id=\"trait-的定义与实现\"><a href=\"#trait-的定义与实现\" class=\"headerlink\" title=\"trait 的定义与实现\"></a>trait 的定义与实现</h4><div class=\"code-container\" data-rel=\"Rust\"><figure class=\"iseeu highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::fmt::Display;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 不要需改 Item 的定义</span></span><br><span class=\"line\"><span class=\"keyword\">trait</span> <span class=\"title class_\">Item</span>&lt;T = <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> <span class=\"title class_\">Output</span>: Display;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"keyword\">Self</span>::Output;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 不要需改 Apple 结构的定义</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Apple</span> &#123;</span><br><span class=\"line\">    name: <span class=\"type\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Item</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Apple</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> <span class=\"title class_\">Output</span> = <span class=\"type\">String</span>; <span class=\"comment\">// 增加</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.name.<span class=\"title function_ invoke__\">to_string</span>()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 不要需改 weibo 结构的定义</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Weibo</span> &#123;</span><br><span class=\"line\">    author: <span class=\"type\">String</span>,</span><br><span class=\"line\">    content: <span class=\"type\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Item</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Weibo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> <span class=\"title class_\">Output</span> = <span class=\"type\">String</span>; <span class=\"comment\">// 增加</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">format!</span>(<span class=\"string\">&quot;@&#123;&#125;:&#123;&#125;&quot;</span>, <span class=\"keyword\">self</span>.author, <span class=\"keyword\">self</span>.content)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">struct</span> <span class=\"title class_\">Container</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// items: Vec&lt;Item&gt;,</span></span><br><span class=\"line\">    items: <span class=\"type\">Vec</span>&lt;<span class=\"type\">Box</span>&lt;<span class=\"keyword\">dyn</span> Item&lt;Output = <span class=\"type\">String</span>&gt;&gt;&gt;, <span class=\"comment\">// 修改</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Container</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">iterator</span>(&amp;<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// for item in self.items &#123;</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> <span class=\"variable\">item</span> <span class=\"keyword\">in</span> &amp;<span class=\"keyword\">self</span>.items &#123; <span class=\"comment\">// 修改</span></span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, item.<span class=\"title function_ invoke__\">summarize</span>());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">apple</span> = Apple &#123;</span><br><span class=\"line\">        name: <span class=\"string\">&quot;Apple&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">w</span> = Weibo &#123;</span><br><span class=\"line\">        author: <span class=\"string\">&quot;weibo&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">        content: <span class=\"string\">&quot;hello&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">container</span> = Container &#123;</span><br><span class=\"line\">        <span class=\"comment\">// items: vec![apple, w],</span></span><br><span class=\"line\">        items: <span class=\"built_in\">vec!</span>[<span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(apple), <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(w)], <span class=\"comment\">// 修改</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    container.<span class=\"title function_ invoke__\">iterator</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n","site":{"data":{}},"excerpt":"","more":"<p><a class=\"link\"   href=\"https://github.com/Zoella-w/IB-Rust/tree/main/20_trait\" >Codes in lesson20<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"trait-定义\"><a href=\"#trait-定义\" class=\"headerlink\" title=\"trait 定义\"></a>trait 定义</h2><p>trait 定义了某个特定类型拥有可能与其他类型共享的功能</p>\n<blockquote>\n<p> <em>trait</em> 类似于其他语言中 <strong>接口</strong>（<em>interfaces</em>）的功能</p>\n</blockquote>\n<h2 id=\"trait-实现\"><a href=\"#trait-实现\" class=\"headerlink\" title=\"trait 实现\"></a>trait 实现</h2><h3 id=\"普通实现\"><a href=\"#普通实现\" class=\"headerlink\" title=\"普通实现\"></a>普通实现</h3><ul>\n<li>使用 <code>trait</code> 关键字声明一个特征</li>\n<li>在大括号中定义该特征的所有方法</li>\n<li>只定义特征方法的签名，而不进行实现，此时方法签名结尾是 <code>;</code>，而不是 <code>&#123;&#125;</code></li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">trait</span> <span class=\"title class_\">Summary</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"为类型实现特征\"><a href=\"#为类型实现特征\" class=\"headerlink\" title=\"为类型实现特征\"></a>为类型实现特征</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">trait</span> <span class=\"title class_\">Summary</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">struct</span> <span class=\"title class_\">Post</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">pub</span> title: <span class=\"type\">String</span>, <span class=\"comment\">// 标题</span></span><br><span class=\"line\">    <span class=\"keyword\">pub</span> author: <span class=\"type\">String</span>, <span class=\"comment\">// 作者</span></span><br><span class=\"line\">    <span class=\"keyword\">pub</span> content: <span class=\"type\">String</span>, <span class=\"comment\">// 内容</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Post</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">format!</span>(<span class=\"string\">&quot;文章&#123;&#125;, 作者是&#123;&#125;&quot;</span>, <span class=\"keyword\">self</span>.title, <span class=\"keyword\">self</span>.author)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">struct</span> <span class=\"title class_\">Weibo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">pub</span> username: <span class=\"type\">String</span>,</span><br><span class=\"line\">    <span class=\"keyword\">pub</span> content: <span class=\"type\">String</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Weibo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">format!</span>(<span class=\"string\">&quot;&#123;&#125;发表了微博&#123;&#125;&quot;</span>, <span class=\"keyword\">self</span>.username, <span class=\"keyword\">self</span>.content)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"特征定义与实现的位置（孤儿规则）\"><a href=\"#特征定义与实现的位置（孤儿规则）\" class=\"headerlink\" title=\"特征定义与实现的位置（孤儿规则）\"></a>特征定义与实现的位置（孤儿规则）</h4><p>如果你想要为类型 <code>A</code> 实现特征 <code>T</code>，那么 <code>A</code> 或者 <code>T</code> 至少有一个是在当前作用域中定义的</p>\n<ul>\n<li>可以为上面的 <code>Post</code> 类型实现标准库中的 <code>Display</code> 特征，这是因为 <code>Post</code> 类型定义在当前的作用域中</li>\n<li>可以在当前包中为 <code>String</code> 类型实现 <code>Summary</code> 特征，因为 <code>Summary</code> 定义在当前作用域中</li>\n<li>无法在当前作用域中，为 <code>String</code> 类型实现 <code>Display</code> 特征，因为它们俩都定义在标准库中，而不是当前的作用域</li>\n</ul>\n<h3 id=\"默认实现\"><a href=\"#默认实现\" class=\"headerlink\" title=\"默认实现\"></a>默认实现</h3><h4 id=\"1、其它类型无需再实现该方法，也可以选择重载该方法\"><a href=\"#1、其它类型无需再实现该方法，也可以选择重载该方法\" class=\"headerlink\" title=\"1、其它类型无需再实现该方法，也可以选择重载该方法\"></a>1、其它类型无需再实现该方法，也可以选择重载该方法</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">trait</span> <span class=\"title class_\">Summary</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;(Read more...)&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Post 选择了默认实现，而 Weibo 重载了该方法</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Post</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Weibo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">format!</span>(<span class=\"string\">&quot;&#123;&#125;发表了微博&#123;&#125;&quot;</span>, <span class=\"keyword\">self</span>.username, <span class=\"keyword\">self</span>.content)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2、默认实现-允许调用-相同特征中的其他方法，哪怕这些方法没有默认实现\"><a href=\"#2、默认实现-允许调用-相同特征中的其他方法，哪怕这些方法没有默认实现\" class=\"headerlink\" title=\"2、默认实现 允许调用 相同特征中的其他方法，哪怕这些方法没有默认实现\"></a>2、默认实现 允许调用 相同特征中的其他方法，哪怕这些方法没有默认实现</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">trait</span> <span class=\"title class_\">Summary</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize_author</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span>;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">format!</span>(<span class=\"string\">&quot;(Read more from &#123;&#125;...)&quot;</span>, <span class=\"keyword\">self</span>.<span class=\"title function_ invoke__\">summarize_author</span>())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Weibo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize_author</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">format!</span>(<span class=\"string\">&quot;@&#123;&#125;&quot;</span>, <span class=\"keyword\">self</span>.username)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;1 new weibo: &#123;&#125;&quot;</span>, weibo.<span class=\"title function_ invoke__\">summarize</span>());</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"带泛型的-trait\"><a href=\"#带泛型的-trait\" class=\"headerlink\" title=\"带泛型的 trait\"></a>带泛型的 trait</h3><ul>\n<li>可以对同一个目标类型，多次 impl 此 trait，每次提供不同的泛型参数</li>\n<li>在具体方法调用的时候，必须通过<strong>类型标注</strong>明确使用的是哪一个具体的实现</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 将元组结构体中的数据，转换为类型 T</span></span><br><span class=\"line\"><span class=\"keyword\">trait</span> <span class=\"title class_\">Converter</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">convert</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> T;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">MyInt</span>(<span class=\"type\">i32</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Converter</span>&lt;<span class=\"type\">String</span>&gt; <span class=\"keyword\">for</span> <span class=\"title class_\">MyInt</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">convert</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// self.0 访问元组结构体的第 0 个元素</span></span><br><span class=\"line\">        <span class=\"keyword\">self</span>.<span class=\"number\">0</span>.<span class=\"title function_ invoke__\">to_string</span>()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Converter</span>&lt;<span class=\"type\">f32</span>&gt; <span class=\"keyword\">for</span> <span class=\"title class_\">MyInt</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">convert</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">f32</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.<span class=\"number\">0</span> <span class=\"keyword\">as</span> <span class=\"type\">f32</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">my_int</span> = <span class=\"title function_ invoke__\">MyInt</span>(<span class=\"number\">42</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">output</span>: <span class=\"type\">String</span> = my_int.<span class=\"title function_ invoke__\">convert</span>();</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;output is: &#123;&#125;&quot;</span>, output);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">output</span>: <span class=\"type\">f32</span> = my_int.<span class=\"title function_ invoke__\">convert</span>();</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;output is: &#123;&#125;&quot;</span>, output);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"关联类型\"><a href=\"#关联类型\" class=\"headerlink\" title=\"关联类型\"></a>关联类型</h3><p>关联类型是 trait 定义中的类型占位符，定义时不指定其具体的类型，在实现（impl）该 trait 时，才为这个关联类型赋予确定的类型</p>\n<p><strong>关联类型方式只允许对目标类型实现一次</strong></p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">trait</span> <span class=\"title class_\">Converter</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> <span class=\"title class_\">Output</span>;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">convert</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"keyword\">Self</span>::Output;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Converter</span> <span class=\"keyword\">for</span> <span class=\"title class_\">MyInt</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> <span class=\"title class_\">Output</span> = <span class=\"type\">String</span>;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">convert</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"keyword\">Self</span>::Output &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.<span class=\"number\">0</span>.<span class=\"title function_ invoke__\">to_string</span>()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"默认泛型类型参数\"><a href=\"#默认泛型类型参数\" class=\"headerlink\" title=\"默认泛型类型参数\"></a>默认泛型类型参数</h3><h4 id=\"默认泛型的例子\"><a href=\"#默认泛型的例子\" class=\"headerlink\" title=\"默认泛型的例子\"></a>默认泛型的例子</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">add</span>&lt;T: std::ops::Add&lt;Output = T&gt;&gt;(a: T, b: T) <span class=\"punctuation\">-&gt;</span> T &#123;</span><br><span class=\"line\"><span class=\"comment\">// 相当于 fn add&lt;T: std::ops::Add&lt;T, Output = T&gt;&gt;(a: T, b: T) -&gt; T &#123;</span></span><br><span class=\"line\">    a + b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;add i8: &#123;&#125;&quot;</span>, <span class=\"title function_ invoke__\">add</span>(<span class=\"number\">2i8</span>, <span class=\"number\">3i8</span>));</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">&quot;add f64: &#123;&#125;&quot;</span>, <span class=\"title function_ invoke__\">add</span>(<span class=\"number\">1.23</span>, <span class=\"number\">1.23</span>));</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"默认泛型类型参数-1\"><a href=\"#默认泛型类型参数-1\" class=\"headerlink\" title=\"默认泛型类型参数\"></a>默认泛型类型参数</h4><p>加法之所以设置默认参数​，​是因为相同类型相加是最常见的情况</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">trait</span> <span class=\"title class_\">Add</span>&lt;Rhs=<span class=\"keyword\">Self</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> <span class=\"title class_\">Output</span>;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">add</span>(<span class=\"keyword\">self</span>, rhs: Rhs) <span class=\"punctuation\">-&gt;</span> <span class=\"keyword\">Self</span>::Output;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>&lt;Rhs=Self&gt;</code> 定义了加法操作的​​右操作数类型​​：</p>\n<ul>\n<li><code>Rhs</code> 是 “Right-hand side”（右操作数）的缩写</li>\n<li><code>=Self</code> 表示默认情况下右操作数与左操作数相同</li>\n<li>这是一个​​默认泛型参数​​语法，允许在实现时不显式指定类型</li>\n</ul>\n<p><code>type Output;</code> 定义加法操作的​​结果类型​​，具体类型在实现时确定</p>\n<p><code>fn add(self, rhs: Rhs) -&gt; Self::Output;</code></p>\n<ul>\n<li>接受两个参数：左操作数（self）和右操作数（rhs）</li>\n<li>返回 Output 关联类型定义的类型<br>使用 move 语义转移所有权</li>\n</ul>\n<h4 id=\"使用默认泛型类型参数\"><a href=\"#使用默认泛型类型参数\" class=\"headerlink\" title=\"使用默认泛型类型参数\"></a>使用默认泛型类型参数</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::ops::Add;</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Point</span> &#123;</span><br><span class=\"line\">    x: <span class=\"type\">i32</span>,</span><br><span class=\"line\">    y: <span class=\"type\">i32</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Add</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Point</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> <span class=\"title class_\">Output</span> = Point;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">add</span>(<span class=\"keyword\">self</span>, other: Point) <span class=\"punctuation\">-&gt;</span> Point &#123;</span><br><span class=\"line\">        Point &#123;</span><br><span class=\"line\">            x: <span class=\"keyword\">self</span>.x + other.x,</span><br><span class=\"line\">            y: <span class=\"keyword\">self</span>.y + other.y,</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(</span><br><span class=\"line\">        Point &#123; x: <span class=\"number\">1</span>, y: <span class=\"number\">0</span> &#125; + Point &#123; x: <span class=\"number\">2</span>, y: <span class=\"number\">3</span> &#125;,</span><br><span class=\"line\">        Point &#123; x: <span class=\"number\">3</span>, y: <span class=\"number\">3</span> &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"自定义-Rhs-类型而不使用默认类型\"><a href=\"#自定义-Rhs-类型而不使用默认类型\" class=\"headerlink\" title=\"自定义 Rhs 类型而不使用默认类型\"></a>自定义 Rhs 类型而不使用默认类型</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::ops::Add;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Millimeters</span>(<span class=\"type\">u32</span>);</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Meters</span>(<span class=\"type\">u32</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Add</span>&lt;Meters&gt; <span class=\"keyword\">for</span> <span class=\"title class_\">Millimeters</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> <span class=\"title class_\">Output</span> = Millimeters;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">add</span>(<span class=\"keyword\">self</span>, other: Meters) <span class=\"punctuation\">-&gt;</span> Millimeters &#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Millimeters</span>(<span class=\"keyword\">self</span>.<span class=\"number\">0</span> + (other.<span class=\"number\">0</span> * <span class=\"number\">1000</span>))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用特征作为函数参数\"><a href=\"#使用特征作为函数参数\" class=\"headerlink\" title=\"使用特征作为函数参数\"></a>使用特征作为函数参数</h2><h3 id=\"impl-Trait-语法\"><a href=\"#impl-Trait-语法\" class=\"headerlink\" title=\"impl Trait 语法\"></a>impl Trait 语法</h3><p>可以使用任何实现了 <code>Summary</code> 特征的类型作为该函数的参数</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">notify</span>(item: &amp;<span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Breaking news! &#123;&#125;&quot;</span>, item.<span class=\"title function_ invoke__\">summarize</span>());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>除了单个约束条件，还可以通过 <code>+</code> 语法指定多个约束条件</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">notify</span>(item: &amp;(<span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span> + Display)) &#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Trait-Bound-语法\"><a href=\"#Trait-Bound-语法\" class=\"headerlink\" title=\"Trait Bound 语法\"></a>Trait Bound 语法</h3><ul>\n<li><code>impl Trait</code> 适用于短小的例子，它是 trait bound 语法的语法糖</li>\n<li>更长的 trait bound 则适用于更复杂的场景</li>\n<li>除了单个约束条件，我们还可以通过 <code>+</code> 语法指定多个约束条件</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">notify</span>&lt;T: Summary&gt;(item: &amp;T) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;Breaking news! &#123;&#125;&quot;</span>, item.<span class=\"title function_ invoke__\">summarize</span>());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">notify</span>&lt;T: Summary + Display&gt;(item: &amp;T) &#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Trait-Bound-能做到而-impl-Trait-做不到的能力\"><a href=\"#Trait-Bound-能做到而-impl-Trait-做不到的能力\" class=\"headerlink\" title=\"Trait Bound 能做到而 impl Trait 做不到的能力\"></a>Trait Bound 能做到而 impl Trait 做不到的能力</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">notify</span>(item1: &amp;<span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span>, item2: &amp;<span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span>) &#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这适用于 <code>item1</code> 和 <code>item2</code> 允许是不同类型的情况（只要都实现了 <code>Summary</code>）。如果希望它们都是相同类型，就只能使用 trait bound 才能实现：</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">notify</span>&lt;T: Summary&gt;(item1: &amp;T, item2: &amp;T) &#123;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"通过-where-简化-trait-bound\"><a href=\"#通过-where-简化-trait-bound\" class=\"headerlink\" title=\"通过 where 简化 trait bound\"></a>通过 <code>where</code> 简化 trait bound</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">some_function</span>&lt;T: Display + <span class=\"built_in\">Clone</span>, U: <span class=\"built_in\">Clone</span> + <span class=\"built_in\">Debug</span>&gt;(t: &amp;T, u: &amp;U) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">i32</span> &#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">some_function</span>&lt;T, U&gt;(t: &amp;T, u: &amp;U) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">i32</span></span><br><span class=\"line\">    <span class=\"keyword\">where</span> T: Display + <span class=\"built_in\">Clone</span>,</span><br><span class=\"line\">          U: <span class=\"built_in\">Clone</span> + <span class=\"built_in\">Debug</span></span><br><span class=\"line\">&#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用特征约束有条件地实现方法或特征\"><a href=\"#使用特征约束有条件地实现方法或特征\" class=\"headerlink\" title=\"使用特征约束有条件地实现方法或特征\"></a>使用特征约束有条件地实现方法或特征</h3><h4 id=\"实现方法\"><a href=\"#实现方法\" class=\"headerlink\" title=\"实现方法\"></a>实现方法</h4><p>可以有条件地只为那些实现了特定 trait 的类型实现方法</p>\n<p>只有那些为 <code>T</code> 类型实现了 <code>PartialOrd</code> trait（允许比较）和 <code>Display</code> trait（允许打印）的 <code>Pair&lt;T&gt;</code> 才会实现 <code>cmp_display</code> 方法</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::fmt::Display;</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Pair</span>&lt;T&gt; &#123;</span><br><span class=\"line\">    x: T,</span><br><span class=\"line\">    y: T,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// impl Pair&lt;i32&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//     fn new(x: i32, y: i32) -&gt; Self &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//         Self &#123; x, y &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//     &#125;</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br><span class=\"line\"><span class=\"keyword\">impl</span>&lt;T&gt; Pair&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">new</span>(x: T, y: T) <span class=\"punctuation\">-&gt;</span> <span class=\"keyword\">Self</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">Self</span> &#123; x, y &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">impl</span>&lt;T: Display + <span class=\"built_in\">PartialOrd</span>&gt; Pair&lt;T&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">cmp_display</span>(&amp;<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">self</span>.x &gt;= <span class=\"keyword\">self</span>.y &#123;</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;The largest member is x = &#123;&#125;&quot;</span>, <span class=\"keyword\">self</span>.x);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;The largest member is y = &#123;&#125;&quot;</span>, <span class=\"keyword\">self</span>.y);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"返回实现了-trait-的类型\"><a href=\"#返回实现了-trait-的类型\" class=\"headerlink\" title=\"返回实现了 trait 的类型\"></a>返回实现了 trait 的类型</h2><h3 id=\"impl-Trait-语法-1\"><a href=\"#impl-Trait-语法-1\" class=\"headerlink\" title=\"impl Trait 语法\"></a><code>impl Trait</code> 语法</h3><p>在返回值中使用 <code>impl Trait</code> 语法，来返回实现了某个 trait 的类型</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">returns_summarizable</span>() <span class=\"punctuation\">-&gt;</span> <span class=\"keyword\">impl</span> <span class=\"title class_\">Summary</span> &#123;</span><br><span class=\"line\">    Weibo &#123;</span><br><span class=\"line\">        username: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;horse_ebooks&quot;</span>),</span><br><span class=\"line\">        content: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;of course, as you probably already know, people&quot;</span>),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"dyn-trait-语法\"><a href=\"#dyn-trait-语法\" class=\"headerlink\" title=\"dyn trait 语法\"></a><code>dyn trait</code> 语法</h3><p>返回实现了某个 trait（动态 trait） 的类型</p>\n<h4 id=\"动态-trait-对象\"><a href=\"#动态-trait-对象\" class=\"headerlink\" title=\"动态 trait 对象\"></a>动态 trait 对象</h4><p>指定某种指针例如 <code>&amp;</code> 引用或 <code>Box&lt;T&gt;</code> 智能指针，还有 <code>dyn</code> keyword，以及指定相关的 trait 来创建 trait 对象</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">returns_summarizable</span>(switch: <span class=\"type\">bool</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">Box</span>&lt;<span class=\"keyword\">dyn</span> Summary&gt;  &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> switch &#123;</span><br><span class=\"line\">        <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(Post &#123;</span><br><span class=\"line\">            title: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(</span><br><span class=\"line\">                <span class=\"string\">&quot;Penguins win the Stanley Cup Championship!&quot;</span>,</span><br><span class=\"line\">            ),</span><br><span class=\"line\">            author: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;Iceburgh&quot;</span>),</span><br><span class=\"line\">            content: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(</span><br><span class=\"line\">                <span class=\"string\">&quot;The Pittsburgh Penguins once again are the best \\</span></span><br><span class=\"line\"><span class=\"string\">                 hockey team in the NHL.&quot;</span>,</span><br><span class=\"line\">            ),</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(Weibo &#123;</span><br><span class=\"line\">            username: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(<span class=\"string\">&quot;horse_ebooks&quot;</span>),</span><br><span class=\"line\">            content: <span class=\"type\">String</span>::<span class=\"title function_ invoke__\">from</span>(</span><br><span class=\"line\">                <span class=\"string\">&quot;of course, as you probably already know, people&quot;</span>,</span><br><span class=\"line\">            ),</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"通过-derive-派生特征\"><a href=\"#通过-derive-派生特征\" class=\"headerlink\" title=\"通过 derive 派生特征\"></a>通过 <code>derive</code> 派生特征</h2><p>形如 <code>#[derive(Debug)]</code> 的代码是一种特征派生语法，被 <code>derive</code> 标记的对象会自动实现对应的默认特征代码，继承相应的功能</p>\n<ul>\n<li><code>Debug</code> 特征有一套自动实现的默认代码，当给一个结构体标记后，就可以使用 <code>println!(&quot;&#123;:?&#125;&quot;, s)</code> 的形式打印该结构体的对象</li>\n<li><code>Copy</code> 特征也有一套自动实现的默认代码，当标记到一个类型上时，可以让这个类型自动实现 <code>Copy</code> 特征，进而可以调用 <code>copy</code> 方法，进行自我复制</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#[derive(Debug, Clone)]</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Point</span> &#123;</span><br><span class=\"line\">    x: <span class=\"type\">i32</span>,</span><br><span class=\"line\">    y: <span class=\"type\">i32</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">p1</span> = &#123; x: <span class=\"number\">0</span>, y: <span class=\"number\">1</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">p2</span> = p1;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;p1: &#123;:?&#125;&quot;</span>, p1); <span class=\"comment\">// 可以打印，因为实现了 Copy 特征</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"用于程序员输出的-Debug\"><a href=\"#用于程序员输出的-Debug\" class=\"headerlink\" title=\"用于程序员输出的 Debug\"></a>用于程序员输出的 <code>Debug</code></h3><p><code>Debug</code> trait 用于开启格式化字符串中的调试格式，允许以调试目的来打印一个类型的实例，可以在程序执行的特定时间点观察其实例</p>\n<p>例如，在使用 <code>assert_eq!</code> 宏时，<code>Debug</code> trait 是必须的。如果等式断言失败，这个宏就把给定实例的值作为参数打印出来，就能看到两个实例为什么不相等</p>\n<h3 id=\"默认值的-Default\"><a href=\"#默认值的-Default\" class=\"headerlink\" title=\"默认值的 Default\"></a>默认值的 <code>Default</code></h3><p><code>Default</code> trait 会创建一个类型的默认值，<code>Default</code> 派生的实现调用了类型每部分的 <code>default</code> 函数，这意味着类型中所有的字段或值必须实现了 <code>Default</code> 才能派生 <code>Default</code> </p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#[derive(Default)]</span></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">struct</span> <span class=\"title class_\">Post</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">pub</span> title: <span class=\"type\">String</span>,   <span class=\"comment\">// 标题</span></span><br><span class=\"line\">    <span class=\"keyword\">pub</span> author: <span class=\"type\">String</span>,  <span class=\"comment\">// 作者</span></span><br><span class=\"line\">    <span class=\"keyword\">pub</span> content: <span class=\"type\">String</span>, <span class=\"comment\">// 内容</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">post1</span> = Post::<span class=\"title function_ invoke__\">default</span>();</span><br></pre></td></tr></table></figure>\n\n<p>在 <code>Option&lt;T&gt;</code> 实例上使用 <code>unwrap_or_default</code> 方法时，<code>Default</code> trait 是必须的。如果 <code>Option&lt;T&gt;</code> 是 <code>None</code>，<code>unwrap_or_default</code> 将返回存储在 <code>Option&lt;T&gt;</code> 中 <code>T</code> 类型的 <code>Default::default</code> 的结果</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"variable\">post2</span> = <span class=\"literal\">None</span>.<span class=\"title function_ invoke__\">unwrap_or_default</span>();</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"练习题\"><a href=\"#练习题\" class=\"headerlink\" title=\"练习题\"></a>练习题</h2><h4 id=\"trait-的定义与实现\"><a href=\"#trait-的定义与实现\" class=\"headerlink\" title=\"trait 的定义与实现\"></a>trait 的定义与实现</h4><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::fmt::Display;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 不要需改 Item 的定义</span></span><br><span class=\"line\"><span class=\"keyword\">trait</span> <span class=\"title class_\">Item</span>&lt;T = <span class=\"type\">String</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> <span class=\"title class_\">Output</span>: Display;</span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"keyword\">Self</span>::Output;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 不要需改 Apple 结构的定义</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Apple</span> &#123;</span><br><span class=\"line\">    name: <span class=\"type\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Item</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Apple</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> <span class=\"title class_\">Output</span> = <span class=\"type\">String</span>; <span class=\"comment\">// 增加</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.name.<span class=\"title function_ invoke__\">to_string</span>()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 不要需改 weibo 结构的定义</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Weibo</span> &#123;</span><br><span class=\"line\">    author: <span class=\"type\">String</span>,</span><br><span class=\"line\">    content: <span class=\"type\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Item</span> <span class=\"keyword\">for</span> <span class=\"title class_\">Weibo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> <span class=\"title class_\">Output</span> = <span class=\"type\">String</span>; <span class=\"comment\">// 增加</span></span><br><span class=\"line\">    <span class=\"keyword\">fn</span> <span class=\"title function_\">summarize</span>(&amp;<span class=\"keyword\">self</span>) <span class=\"punctuation\">-&gt;</span> <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">format!</span>(<span class=\"string\">&quot;@&#123;&#125;:&#123;&#125;&quot;</span>, <span class=\"keyword\">self</span>.author, <span class=\"keyword\">self</span>.content)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"keyword\">struct</span> <span class=\"title class_\">Container</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// items: Vec&lt;Item&gt;,</span></span><br><span class=\"line\">    items: <span class=\"type\">Vec</span>&lt;<span class=\"type\">Box</span>&lt;<span class=\"keyword\">dyn</span> Item&lt;Output = <span class=\"type\">String</span>&gt;&gt;&gt;, <span class=\"comment\">// 修改</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> <span class=\"title class_\">Container</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">pub</span> <span class=\"keyword\">fn</span> <span class=\"title function_\">iterator</span>(&amp;<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// for item in self.items &#123;</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> <span class=\"variable\">item</span> <span class=\"keyword\">in</span> &amp;<span class=\"keyword\">self</span>.items &#123; <span class=\"comment\">// 修改</span></span><br><span class=\"line\">            <span class=\"built_in\">println!</span>(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, item.<span class=\"title function_ invoke__\">summarize</span>());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fn</span> <span class=\"title function_\">main</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">apple</span> = Apple &#123;</span><br><span class=\"line\">        name: <span class=\"string\">&quot;Apple&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">w</span> = Weibo &#123;</span><br><span class=\"line\">        author: <span class=\"string\">&quot;weibo&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">        content: <span class=\"string\">&quot;hello&quot;</span>.<span class=\"title function_ invoke__\">to_string</span>(),</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"variable\">container</span> = Container &#123;</span><br><span class=\"line\">        <span class=\"comment\">// items: vec![apple, w],</span></span><br><span class=\"line\">        items: <span class=\"built_in\">vec!</span>[<span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(apple), <span class=\"type\">Box</span>::<span class=\"title function_ invoke__\">new</span>(w)], <span class=\"comment\">// 修改</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    container.<span class=\"title function_ invoke__\">iterator</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","_processedHighlight":true}],"PostAsset":[],"PostCategory":[{"post_id":"cmb0ffvu400086kprgqazh7xs","category_id":"cmb0ffvu300046kpre1lyeaso","_id":"cmb0ffvu5000e6kpr23vtfofc"},{"post_id":"cmb0ffvu100016kpre02t1xfg","category_id":"cmb0ffvu300046kpre1lyeaso","_id":"cmb0ffvu6000j6kprbi9ig868"},{"post_id":"cmb0ffvu400096kpr6tzu5owl","category_id":"cmb0ffvu300046kpre1lyeaso","_id":"cmb0ffvu6000m6kpreiesf87s"},{"post_id":"cmb0ffvu5000c6kpr0mi2bxee","category_id":"cmb0ffvu300046kpre1lyeaso","_id":"cmb0ffvu6000q6kpr7clrbmm8"},{"post_id":"cmb0ffvu300036kpra4362192","category_id":"cmb0ffvu5000a6kprf18408rs","_id":"cmb0ffvu7000t6kprd1yah65k"},{"post_id":"cmb0ffvu5000d6kpr8bnlek9i","category_id":"cmb0ffvu300046kpre1lyeaso","_id":"cmb0ffvu7000x6kpr09267pe8"},{"post_id":"cmb0ffvu5000i6kprbi1g1ln2","category_id":"cmb0ffvu300046kpre1lyeaso","_id":"cmb0ffvu700106kpr8jro6td0"},{"post_id":"cmb0ffvu400076kpr7h945avy","category_id":"cmb0ffvu300046kpre1lyeaso","_id":"cmb0ffvu700146kprbznfdvbm"},{"post_id":"cmb0ffvu6000l6kpr49a611m6","category_id":"cmb0ffvu300046kpre1lyeaso","_id":"cmb0ffvu700176kprh4v18s46"},{"post_id":"cmb0ffvu6000p6kprfj01f2hy","category_id":"cmb0ffvu300046kpre1lyeaso","_id":"cmb0ffvu8001c6kpreny5b9cf"},{"post_id":"cmb0ffvu6000s6kprcb33697k","category_id":"cmb0ffvu5000a6kprf18408rs","_id":"cmb0ffvu8001f6kprd0jg5n9x"},{"post_id":"cmb0ffvu7000w6kprelt60cte","category_id":"cmb0ffvu5000a6kprf18408rs","_id":"cmb0ffvu8001k6kprgryv49jr"},{"post_id":"cmb0ffvu7000z6kpr41la11m2","category_id":"cmb0ffvu300046kpre1lyeaso","_id":"cmb0ffvu8001n6kpr41fh73e5"},{"post_id":"cmb0ffvu700136kprcdao3ht6","category_id":"cmb0ffvu800196kpr90lggvka","_id":"cmb0ffvu9001r6kpr7imcbjct"},{"post_id":"cmb0ffvu700166kprbgo43vym","category_id":"cmb0ffvu8001j6kprbsxa6s4w","_id":"cmb0ffvu9001z6kpr2drn65qz"},{"post_id":"cmb0ffvu8001b6kpr20s16is7","category_id":"cmb0ffvu8001j6kprbsxa6s4w","_id":"cmb0ffvua00256kpr6kdoegvb"},{"post_id":"cmb0ffvu900216kpr3ub66hab","category_id":"cmb0ffvu300046kpre1lyeaso","_id":"cmb0ffvua002b6kpr16ln4hey"},{"post_id":"cmb0ffvu8001i6kprb6h5a4q5","category_id":"cmb0ffvua00266kpr55az6zlu","_id":"cmb0ffvua002j6kpr2hjd0r6q"},{"post_id":"cmb0ffvu8001m6kprep0tfity","category_id":"cmb0ffvua002d6kpr4knh45zf","_id":"cmb0ffvub002s6kprdipr6oxa"},{"post_id":"cmb0ffvu8001q6kprf4hy8gjd","category_id":"cmb0ffvub002m6kprd64f82ql","_id":"cmb0ffvub00306kpr77o7f5lj"},{"post_id":"cmb0ffvu9001x6kpr2lqz1azi","category_id":"cmb0ffvub002m6kprd64f82ql","_id":"cmb0ffvuc00366kpr5qjz3ixe"},{"post_id":"cmb0ffvub00326kpr5akp9njo","category_id":"cmb0ffvu300046kpre1lyeaso","_id":"cmb0ffvuc003d6kprexcdcwy4"},{"post_id":"cmb0ffvu8001e6kpr20sv87a1","category_id":"cmb0ffvu9001y6kprdfyw1sd7","_id":"cmb0ffvuc003h6kprav6wbvrw"},{"post_id":"cmb0ffvu8001e6kpr20sv87a1","category_id":"cmb0ffvub002z6kpr0oybhrsc","_id":"cmb0ffvuc003l6kpr9q0y4kgb"},{"post_id":"cmb0ffvuc00396kprgco4029s","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvud003p6kpr5or32tg6"},{"post_id":"cmb0ffvu900236kpr72y884l4","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvud003t6kprallu6av3"},{"post_id":"cmb0ffvuc003c6kpr66dq8hg6","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvud003x6kpr04ov1f18"},{"post_id":"cmb0ffvuc003g6kprhc7c8mtt","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvud00416kprhoq5f1b8"},{"post_id":"cmb0ffvua00286kpr8mm3194h","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvud00456kpr09eb9rwb"},{"post_id":"cmb0ffvuc003k6kprbpe04ljc","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvud00486kprd3ns0ur8"},{"post_id":"cmb0ffvuc003o6kpr5wqg1zm3","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvue004b6kpr8tzkc90s"},{"post_id":"cmb0ffvua002a6kpr44li94c2","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvue004f6kpr38nednzz"},{"post_id":"cmb0ffvud003s6kprgtd30rb0","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvue004j6kprem5b8tl2"},{"post_id":"cmb0ffvud003w6kpr8wj7c4tt","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvue004m6kpra52l8zq4"},{"post_id":"cmb0ffvua002f6kpr54t79ab8","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvue004q6kpr94hzhaxn"},{"post_id":"cmb0ffvud00406kpree2ldmbp","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvue004u6kpr9ytc4whz"},{"post_id":"cmb0ffvud00446kpr63rl9tew","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvuf004y6kpreldtaxhd"},{"post_id":"cmb0ffvua002h6kprf1uo3y7n","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvuf00516kprfy2h7nbe"},{"post_id":"cmb0ffvue004a6kpr1lsacpz9","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvuf00566kprf8h8gxob"},{"post_id":"cmb0ffvua002l6kprd7zrdxel","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvuf00596kpr5tpb7idx"},{"post_id":"cmb0ffvue004e6kprd5qfdmx0","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvuf005e6kpr54l5685o"},{"post_id":"cmb0ffvue004i6kprbo76eof2","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvuf005h6kprg448fqcp"},{"post_id":"cmb0ffvub002o6kpr3c02cmwh","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvug005m6kpr4kwresib"},{"post_id":"cmb0ffvue004l6kprgafb5f12","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvug005p6kprgqvg4bmk"},{"post_id":"cmb0ffvue004p6kpr8r2631xj","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvug005t6kpr1y3t2ozm"},{"post_id":"cmb0ffvub002r6kpr7gpjbu3f","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvug005x6kpr7hss7479"},{"post_id":"cmb0ffvue004t6kpr5rjzh6ay","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvug00616kpr8wlzclpm"},{"post_id":"cmb0ffvub002v6kprdpal7ngb","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvug00656kprav635epf"},{"post_id":"cmb0ffvub002y6kpre4gn0f40","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvug00696kpr6boi76v8"},{"post_id":"cmb0ffvuc00356kprhqqm2mxc","category_id":"cmb0ffvuc00376kpr0zhr5y5s","_id":"cmb0ffvuh006d6kpr1q4k1zk6"},{"post_id":"cmb0ffvud00476kpr0nk2gg4d","category_id":"cmb0ffvuf005k6kpr5iqc2ffn","_id":"cmb0ffvuh006g6kpr15x62ms9"},{"post_id":"cmb0ffvuf004x6kpr8p6t1dul","category_id":"cmb0ffvug005u6kpr8sbc8yuu","_id":"cmb0ffvuh006j6kpr5mnsh19n"},{"post_id":"cmb0ffvuf00506kpr1kp49ham","category_id":"cmb0ffvug005u6kpr8sbc8yuu","_id":"cmb0ffvuh006l6kprcnd58bra"},{"post_id":"cmb0ffvug00686kprfkn0c08i","category_id":"cmb0ffvu5000a6kprf18408rs","_id":"cmb0ffvuh006p6kprgxh6gg6t"},{"post_id":"cmb0ffvuf00556kprbqya38ii","category_id":"cmb0ffvug005u6kpr8sbc8yuu","_id":"cmb0ffvuh006r6kpr1t50avp0"},{"post_id":"cmb0ffvuf00586kpr08nec301","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmb0ffvuh006v6kpr6rys1uqx"},{"post_id":"cmb0ffvuf005g6kpr7tuc3l9o","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmb0ffvuh00736kprdmt0awyo"},{"post_id":"cmb0ffvuf005l6kprh8ih1vh9","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmb0ffvuh00756kpr4pz34h0p"},{"post_id":"cmb0ffvug005o6kpr8j8r9f8p","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmb0ffvuh007a6kprfzdw1sec"},{"post_id":"cmb0ffvug005s6kprevgn4c4h","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmb0ffvuh007d6kpr4g4ug86p"},{"post_id":"cmb0ffvug005w6kprb35o35u5","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmb0ffvuh007h6kprdrv92f0q"},{"post_id":"cmb0ffvug00606kpr625zhdfd","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmb0ffvui007l6kpr96baa5x8"},{"post_id":"cmb0ffvug00646kpr0fnm64i5","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmb0ffvui007o6kpral78hcbz"},{"post_id":"cmb0ffvug006c6kpr5cxphaim","category_id":"cmb0ffvui007k6kprgmwage6b","_id":"cmb0ffvui007s6kprgyl0ex26"},{"post_id":"cmb0ffvuf005d6kpr7x28epn8","category_id":"cmb0ffvuf005k6kpr5iqc2ffn","_id":"cmb0ffvui007x6kpr4kjpdxaa"},{"post_id":"cmb0ffvuf005d6kpr7x28epn8","category_id":"cmb0ffvui007q6kprer7qaajt","_id":"cmb0ffvui007y6kpr3r9b2w7d"},{"post_id":"cmb0ffvul00ar6kprear795zh","category_id":"cmb0ffvu5000a6kprf18408rs","_id":"cmb0ffvum00at6kprffyperrv"},{"post_id":"cmb21qots0000vypr0xt21n8e","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmb21qotu0002vypr94lx4uze"},{"post_id":"cmb6c8z8y0000p9pr9jz459uf","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmb6c8z900004p9pr74v23u74"},{"post_id":"cmb6c8z8z0001p9prbhys297b","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmb6c8z900005p9prc1j6hdce"},{"post_id":"cmb81918u0000oxpr3x9ngjmy","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmb81918y0002oxpr8ri18wm9"},{"post_id":"cmb9jnf050000ebpr4eda9i9m","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmb9jnf0i0002ebpr75p9251w"},{"post_id":"cmbgajp0w0000ttprdwkl7c2n","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmbgajp0x0002ttprbapgcf6u"},{"post_id":"cmbgd7y8a0000ogpr0xfn8717","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmbgd7y8h0002ogprfdfk692e"},{"post_id":"cmbjgndec00003fpr53lzbelx","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmbjgndee00023fpr6f3s1gt4"},{"post_id":"cmbjjhnhw0000rvpr4ohqfcc2","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmbjjhnhz0002rvpr7z2972mm"},{"post_id":"cmbomsf5400005rprhhgs6eb9","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmbomsf5700025rpr92qjfm3d"},{"post_id":"cmbrop9kl00004jprexaj4lnx","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmbrop9km00044jpraxi7bid1"},{"post_id":"cmbrop9km00014jpr2gf1erdd","category_id":"cmb0ffvuh006h6kpr88qy16s1","_id":"cmbrop9km00054jprcwvvd3ms"}],"PostTag":[{"post_id":"cmb0ffvu5000c6kpr0mi2bxee","tag_id":"cmb0ffvu400056kpr90ol20bs","_id":"cmb0ffvu5000h6kprh6zr1wkf"},{"post_id":"cmb0ffvu5000c6kpr0mi2bxee","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvu6000k6kpr9r9igxbf"},{"post_id":"cmb0ffvu100016kpre02t1xfg","tag_id":"cmb0ffvu400056kpr90ol20bs","_id":"cmb0ffvu6000o6kprda2a8hfc"},{"post_id":"cmb0ffvu100016kpre02t1xfg","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvu6000r6kpra5dm4gmg"},{"post_id":"cmb0ffvu5000d6kpr8bnlek9i","tag_id":"cmb0ffvu400056kpr90ol20bs","_id":"cmb0ffvu7000v6kprdnpd6bxu"},{"post_id":"cmb0ffvu5000d6kpr8bnlek9i","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvu7000y6kpr4b6a7ovd"},{"post_id":"cmb0ffvu5000i6kprbi1g1ln2","tag_id":"cmb0ffvu400056kpr90ol20bs","_id":"cmb0ffvu700126kpr6mrm7grr"},{"post_id":"cmb0ffvu5000i6kprbi1g1ln2","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvu700156kpr9asdhdna"},{"post_id":"cmb0ffvu300036kpra4362192","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvu8001a6kpr4x057ta2"},{"post_id":"cmb0ffvu6000l6kpr49a611m6","tag_id":"cmb0ffvu400056kpr90ol20bs","_id":"cmb0ffvu8001d6kprcygw5mpb"},{"post_id":"cmb0ffvu6000l6kpr49a611m6","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvu8001h6kpr9adcezwg"},{"post_id":"cmb0ffvu6000p6kprfj01f2hy","tag_id":"cmb0ffvu400056kpr90ol20bs","_id":"cmb0ffvu8001l6kpr258ie2ly"},{"post_id":"cmb0ffvu6000p6kprfj01f2hy","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvu8001p6kpr2ojdcxl2"},{"post_id":"cmb0ffvu6000s6kprcb33697k","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvu9001t6kprc02n4ofp"},{"post_id":"cmb0ffvu7000w6kprelt60cte","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvu9001v6kpr0o0d61v9"},{"post_id":"cmb0ffvu400076kpr7h945avy","tag_id":"cmb0ffvu400056kpr90ol20bs","_id":"cmb0ffvu900206kpr1jkiek7e"},{"post_id":"cmb0ffvu400076kpr7h945avy","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvu900226kprf11x80ij"},{"post_id":"cmb0ffvu7000z6kpr41la11m2","tag_id":"cmb0ffvu400056kpr90ol20bs","_id":"cmb0ffvua00276kprb7u6329c"},{"post_id":"cmb0ffvu7000z6kpr41la11m2","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvua00296kpr6n4cdx9l"},{"post_id":"cmb0ffvu400086kprgqazh7xs","tag_id":"cmb0ffvu400056kpr90ol20bs","_id":"cmb0ffvua002e6kpr696rczfa"},{"post_id":"cmb0ffvu400086kprgqazh7xs","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvua002g6kpralikeymb"},{"post_id":"cmb0ffvu400096kpr6tzu5owl","tag_id":"cmb0ffvu400056kpr90ol20bs","_id":"cmb0ffvua002k6kprd5nx3i8z"},{"post_id":"cmb0ffvu400096kpr6tzu5owl","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvub002n6kprh56oafee"},{"post_id":"cmb0ffvu900216kpr3ub66hab","tag_id":"cmb0ffvu400056kpr90ol20bs","_id":"cmb0ffvub002q6kpr088hg3rb"},{"post_id":"cmb0ffvu900216kpr3ub66hab","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvub002u6kprdno49bwi"},{"post_id":"cmb0ffvu700136kprcdao3ht6","tag_id":"cmb0ffvu8001g6kpr8hjrhi7a","_id":"cmb0ffvub002x6kpr1qjqbnwb"},{"post_id":"cmb0ffvu700136kprcdao3ht6","tag_id":"cmb0ffvu8001o6kprelseg2m7","_id":"cmb0ffvub00316kpr6tr8fxaz"},{"post_id":"cmb0ffvu700136kprcdao3ht6","tag_id":"cmb0ffvu9001w6kpr1ebr6rmo","_id":"cmb0ffvuc00346kprbafvagd7"},{"post_id":"cmb0ffvu700166kprbgo43vym","tag_id":"cmb0ffvu8001g6kpr8hjrhi7a","_id":"cmb0ffvuc00386kprciwp6y0k"},{"post_id":"cmb0ffvu700166kprbgo43vym","tag_id":"cmb0ffvu8001o6kprelseg2m7","_id":"cmb0ffvuc003b6kpra6gihshm"},{"post_id":"cmb0ffvu700166kprbgo43vym","tag_id":"cmb0ffvu9001w6kpr1ebr6rmo","_id":"cmb0ffvuc003f6kprex1r63gk"},{"post_id":"cmb0ffvub00326kpr5akp9njo","tag_id":"cmb0ffvu400056kpr90ol20bs","_id":"cmb0ffvuc003j6kprfmz79l6a"},{"post_id":"cmb0ffvub00326kpr5akp9njo","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvuc003n6kpr5c8t1gpd"},{"post_id":"cmb0ffvu8001b6kpr20s16is7","tag_id":"cmb0ffvu8001g6kpr8hjrhi7a","_id":"cmb0ffvud003r6kpr3urqci2i"},{"post_id":"cmb0ffvu8001b6kpr20s16is7","tag_id":"cmb0ffvu8001o6kprelseg2m7","_id":"cmb0ffvud003v6kpr954chj8v"},{"post_id":"cmb0ffvu8001b6kpr20s16is7","tag_id":"cmb0ffvu9001w6kpr1ebr6rmo","_id":"cmb0ffvud003z6kprd6jrhfxq"},{"post_id":"cmb0ffvu8001b6kpr20s16is7","tag_id":"cmb0ffvuc003a6kpr4i5wdhjx","_id":"cmb0ffvud00436kprapho65ol"},{"post_id":"cmb0ffvud00476kpr0nk2gg4d","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvue004d6kprg2qndao8"},{"post_id":"cmb0ffvud00476kpr0nk2gg4d","tag_id":"cmb0ffvuc003a6kpr4i5wdhjx","_id":"cmb0ffvue004g6kpra6a10moq"},{"post_id":"cmb0ffvu8001e6kpr20sv87a1","tag_id":"cmb0ffvu8001g6kpr8hjrhi7a","_id":"cmb0ffvue004n6kpr3hqygdv7"},{"post_id":"cmb0ffvu8001e6kpr20sv87a1","tag_id":"cmb0ffvu8001o6kprelseg2m7","_id":"cmb0ffvue004r6kpr5gzm9fux"},{"post_id":"cmb0ffvu8001e6kpr20sv87a1","tag_id":"cmb0ffvu9001w6kpr1ebr6rmo","_id":"cmb0ffvue004v6kpr03ti9mvc"},{"post_id":"cmb0ffvu8001e6kpr20sv87a1","tag_id":"cmb0ffvud00466kprf62b35tu","_id":"cmb0ffvuf004z6kpre91scstq"},{"post_id":"cmb0ffvu8001e6kpr20sv87a1","tag_id":"cmb0ffvue004c6kpr7txchsl7","_id":"cmb0ffvuf00536kprf1t99uau"},{"post_id":"cmb0ffvu8001i6kprb6h5a4q5","tag_id":"cmb0ffvu8001g6kpr8hjrhi7a","_id":"cmb0ffvuf00576kprf3y8di56"},{"post_id":"cmb0ffvu8001i6kprb6h5a4q5","tag_id":"cmb0ffvu8001o6kprelseg2m7","_id":"cmb0ffvuf005b6kpra1i98r84"},{"post_id":"cmb0ffvu8001i6kprb6h5a4q5","tag_id":"cmb0ffvue004s6kpr98mk3ood","_id":"cmb0ffvuf005f6kpr8l0zdt4p"},{"post_id":"cmb0ffvuf005d6kpr7x28epn8","tag_id":"cmb0ffvu400056kpr90ol20bs","_id":"cmb0ffvuf005j6kpr5ka61q9i"},{"post_id":"cmb0ffvuf005d6kpr7x28epn8","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvug005n6kprebeofztb"},{"post_id":"cmb0ffvu8001m6kprep0tfity","tag_id":"cmb0ffvu8001g6kpr8hjrhi7a","_id":"cmb0ffvug005r6kpr2zef3g08"},{"post_id":"cmb0ffvu8001m6kprep0tfity","tag_id":"cmb0ffvu8001o6kprelseg2m7","_id":"cmb0ffvug005v6kpraqq74p99"},{"post_id":"cmb0ffvu8001m6kprep0tfity","tag_id":"cmb0ffvuf005a6kprdlfq82av","_id":"cmb0ffvug005z6kprctr2gq1g"},{"post_id":"cmb0ffvu8001q6kprf4hy8gjd","tag_id":"cmb0ffvu8001g6kpr8hjrhi7a","_id":"cmb0ffvug00636kpratlmaomc"},{"post_id":"cmb0ffvu8001q6kprf4hy8gjd","tag_id":"cmb0ffvu8001o6kprelseg2m7","_id":"cmb0ffvug00666kprbiqa1hom"},{"post_id":"cmb0ffvu8001q6kprf4hy8gjd","tag_id":"cmb0ffvuf005i6kpr7t2a4dft","_id":"cmb0ffvug006b6kprbaku3txn"},{"post_id":"cmb0ffvu9001x6kpr2lqz1azi","tag_id":"cmb0ffvu8001g6kpr8hjrhi7a","_id":"cmb0ffvuh006e6kpr08vc0pzb"},{"post_id":"cmb0ffvu9001x6kpr2lqz1azi","tag_id":"cmb0ffvu8001o6kprelseg2m7","_id":"cmb0ffvuh006i6kpr2xzz3nml"},{"post_id":"cmb0ffvu9001x6kpr2lqz1azi","tag_id":"cmb0ffvuf005i6kpr7t2a4dft","_id":"cmb0ffvuh006k6kpr1mr34wrj"},{"post_id":"cmb0ffvu900236kpr72y884l4","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvuh006o6kpr5oidh2kc"},{"post_id":"cmb0ffvug00686kprfkn0c08i","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvuh006q6kprgkjj3zqn"},{"post_id":"cmb0ffvua00286kpr8mm3194h","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvuh006u6kpr8lgv31rv"},{"post_id":"cmb0ffvua00286kpr8mm3194h","tag_id":"cmb0ffvuh006f6kprcomo9s58","_id":"cmb0ffvuh006w6kprh1xt1a0z"},{"post_id":"cmb0ffvua002a6kpr44li94c2","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvuh006z6kprd6gg1kaw"},{"post_id":"cmb0ffvua002a6kpr44li94c2","tag_id":"cmb0ffvuh006s6kpra6bq3l0c","_id":"cmb0ffvuh00706kpr1zukck6e"},{"post_id":"cmb0ffvua002f6kpr54t79ab8","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvuh00776kpr19eva0ns"},{"post_id":"cmb0ffvua002f6kpr54t79ab8","tag_id":"cmb0ffvuh00716kpr77yoge6s","_id":"cmb0ffvuh00786kpr23k20dcm"},{"post_id":"cmb0ffvua002h6kprf1uo3y7n","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvuh007f6kpr5ycz7l2a"},{"post_id":"cmb0ffvua002h6kprf1uo3y7n","tag_id":"cmb0ffvuh007b6kpr8e004ip2","_id":"cmb0ffvuh007i6kpr6q1h2plk"},{"post_id":"cmb0ffvua002l6kprd7zrdxel","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvui007n6kpr5cgf4nkw"},{"post_id":"cmb0ffvua002l6kprd7zrdxel","tag_id":"cmb0ffvuh007b6kpr8e004ip2","_id":"cmb0ffvui007p6kpr6liqfmwd"},{"post_id":"cmb0ffvub002o6kpr3c02cmwh","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvui007u6kpr2w7s51jb"},{"post_id":"cmb0ffvub002o6kpr3c02cmwh","tag_id":"cmb0ffvuh007b6kpr8e004ip2","_id":"cmb0ffvui007v6kprdq3f3ck7"},{"post_id":"cmb0ffvub002r6kpr7gpjbu3f","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvui00806kprb0ww4bla"},{"post_id":"cmb0ffvub002r6kpr7gpjbu3f","tag_id":"cmb0ffvuh007b6kpr8e004ip2","_id":"cmb0ffvui00816kpr0x3nepbd"},{"post_id":"cmb0ffvub002v6kprdpal7ngb","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvui00846kpr92w9406x"},{"post_id":"cmb0ffvub002v6kprdpal7ngb","tag_id":"cmb0ffvuh007b6kpr8e004ip2","_id":"cmb0ffvui00856kpr7huqfmaq"},{"post_id":"cmb0ffvub002y6kpre4gn0f40","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvui00886kpr5pbe14xo"},{"post_id":"cmb0ffvub002y6kpre4gn0f40","tag_id":"cmb0ffvuh007b6kpr8e004ip2","_id":"cmb0ffvui00896kpr03at67vh"},{"post_id":"cmb0ffvuc00356kprhqqm2mxc","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvui008b6kpr5zrhgnn1"},{"post_id":"cmb0ffvuc00396kprgco4029s","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvui008e6kpr739w7beb"},{"post_id":"cmb0ffvuc00396kprgco4029s","tag_id":"cmb0ffvuh007b6kpr8e004ip2","_id":"cmb0ffvui008f6kprgb8va0w7"},{"post_id":"cmb0ffvuc003g6kprhc7c8mtt","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvui008i6kprd5jc5mh9"},{"post_id":"cmb0ffvuc003g6kprhc7c8mtt","tag_id":"cmb0ffvui008g6kprgbq054q8","_id":"cmb0ffvui008j6kpr87z0a9wk"},{"post_id":"cmb0ffvuc003k6kprbpe04ljc","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvui008m6kpra70q01vg"},{"post_id":"cmb0ffvuc003k6kprbpe04ljc","tag_id":"cmb0ffvui008g6kprgbq054q8","_id":"cmb0ffvui008n6kpra364800q"},{"post_id":"cmb0ffvuc003o6kpr5wqg1zm3","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvui008q6kpr1ckz8i28"},{"post_id":"cmb0ffvuc003o6kpr5wqg1zm3","tag_id":"cmb0ffvui008g6kprgbq054q8","_id":"cmb0ffvui008r6kpr0t9gaa4i"},{"post_id":"cmb0ffvud003s6kprgtd30rb0","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvui008u6kpr9zaf7st0"},{"post_id":"cmb0ffvud003s6kprgtd30rb0","tag_id":"cmb0ffvui008g6kprgbq054q8","_id":"cmb0ffvui008v6kpr8i7nazev"},{"post_id":"cmb0ffvud003w6kpr8wj7c4tt","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvuj008y6kpr9ead0fnw"},{"post_id":"cmb0ffvud003w6kpr8wj7c4tt","tag_id":"cmb0ffvui008g6kprgbq054q8","_id":"cmb0ffvuj008z6kpr1t5pcomq"},{"post_id":"cmb0ffvud00406kpree2ldmbp","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvuj00926kpr9k8j8j8o"},{"post_id":"cmb0ffvud00406kpree2ldmbp","tag_id":"cmb0ffvui008g6kprgbq054q8","_id":"cmb0ffvuj00936kprg3tu5dav"},{"post_id":"cmb0ffvud00446kpr63rl9tew","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvuj00966kpr4n000vk2"},{"post_id":"cmb0ffvud00446kpr63rl9tew","tag_id":"cmb0ffvui008g6kprgbq054q8","_id":"cmb0ffvuj00976kpr6s09h3ul"},{"post_id":"cmb0ffvue004a6kpr1lsacpz9","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvuj009b6kpr04wk55v0"},{"post_id":"cmb0ffvue004a6kpr1lsacpz9","tag_id":"cmb0ffvui008g6kprgbq054q8","_id":"cmb0ffvuj009c6kpr5bnjh25d"},{"post_id":"cmb0ffvue004a6kpr1lsacpz9","tag_id":"cmb0ffvuj00996kpra6rjh8o8","_id":"cmb0ffvuj009e6kprgd6tegr3"},{"post_id":"cmb0ffvue004e6kprd5qfdmx0","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvuj009h6kprco9wes1w"},{"post_id":"cmb0ffvue004e6kprd5qfdmx0","tag_id":"cmb0ffvui008g6kprgbq054q8","_id":"cmb0ffvuj009i6kpr7jia6baq"},{"post_id":"cmb0ffvue004e6kprd5qfdmx0","tag_id":"cmb0ffvuj009f6kpr5fkf99y0","_id":"cmb0ffvuj009k6kprc7yn18l6"},{"post_id":"cmb0ffvue004i6kprbo76eof2","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvuj009n6kpr68ygc62u"},{"post_id":"cmb0ffvue004i6kprbo76eof2","tag_id":"cmb0ffvui008g6kprgbq054q8","_id":"cmb0ffvuj009o6kpr4us226s8"},{"post_id":"cmb0ffvue004i6kprbo76eof2","tag_id":"cmb0ffvuj009f6kpr5fkf99y0","_id":"cmb0ffvuj009q6kprh2v5hez8"},{"post_id":"cmb0ffvue004l6kprgafb5f12","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvuj009t6kprgdn2g7u3"},{"post_id":"cmb0ffvue004l6kprgafb5f12","tag_id":"cmb0ffvui008g6kprgbq054q8","_id":"cmb0ffvuj009u6kpr0rjmgnub"},{"post_id":"cmb0ffvue004l6kprgafb5f12","tag_id":"cmb0ffvuj009f6kpr5fkf99y0","_id":"cmb0ffvuj009w6kprgsin4px3"},{"post_id":"cmb0ffvue004p6kpr8r2631xj","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvuk009y6kprft366vd5"},{"post_id":"cmb0ffvue004p6kpr8r2631xj","tag_id":"cmb0ffvui008g6kprgbq054q8","_id":"cmb0ffvuk009z6kpr8p1ea55g"},{"post_id":"cmb0ffvue004t6kpr5rjzh6ay","tag_id":"cmb0ffvug005y6kpr6jyqd5sb","_id":"cmb0ffvuk00a26kprf82993nr"},{"post_id":"cmb0ffvue004t6kpr5rjzh6ay","tag_id":"cmb0ffvui008g6kprgbq054q8","_id":"cmb0ffvuk00a36kprgmiuaxkq"},{"post_id":"cmb0ffvuf004x6kpr8p6t1dul","tag_id":"cmb0ffvuk00a16kprcx7t8dg5","_id":"cmb0ffvuk00a56kpr6hgxdqu6"},{"post_id":"cmb0ffvuf00506kpr1kp49ham","tag_id":"cmb0ffvuk00a16kprcx7t8dg5","_id":"cmb0ffvuk00a76kprd10t0o2s"},{"post_id":"cmb0ffvuf00556kprbqya38ii","tag_id":"cmb0ffvuk00a16kprcx7t8dg5","_id":"cmb0ffvuk00a96kpr22cn8ru5"},{"post_id":"cmb0ffvuf00586kpr08nec301","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmb0ffvuk00ab6kpr2qxn4m2z"},{"post_id":"cmb0ffvuf005g6kpr7tuc3l9o","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmb0ffvuk00ad6kpr3bsh3q07"},{"post_id":"cmb0ffvuf005l6kprh8ih1vh9","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmb0ffvuk00af6kprdzqf6dmy"},{"post_id":"cmb0ffvug005o6kpr8j8r9f8p","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmb0ffvuk00ah6kpr9gwd87ae"},{"post_id":"cmb0ffvug005s6kprevgn4c4h","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmb0ffvuk00aj6kpre4065jf8"},{"post_id":"cmb0ffvug005w6kprb35o35u5","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmb0ffvuk00al6kpr8wum4r9h"},{"post_id":"cmb0ffvug00606kpr625zhdfd","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmb0ffvuk00an6kprfg5lfg5r"},{"post_id":"cmb0ffvug00646kpr0fnm64i5","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmb0ffvuk00ap6kpray6ub7mh"},{"post_id":"cmb0ffvug006c6kpr5cxphaim","tag_id":"cmb0ffvuk00ao6kprcrir0v4y","_id":"cmb0ffvuk00aq6kpr972h18yv"},{"post_id":"cmb0ffvul00ar6kprear795zh","tag_id":"cmb0ffvu5000b6kprcw0q4s9h","_id":"cmb0ffvum00as6kpr3kjt9ogw"},{"post_id":"cmb21qots0000vypr0xt21n8e","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmb21qotu0001vypraodg7mpk"},{"post_id":"cmb6c8z8y0000p9pr9jz459uf","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmb6c8z8z0002p9prep0r9gf6"},{"post_id":"cmb6c8z8z0001p9prbhys297b","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmb6c8z900003p9prctzg8zzx"},{"post_id":"cmb81918u0000oxpr3x9ngjmy","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmb81918y0001oxprh5b6949a"},{"post_id":"cmb9jnf050000ebpr4eda9i9m","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmb9jnf0i0001ebpr1x3t7714"},{"post_id":"cmbgajp0w0000ttprdwkl7c2n","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmbgajp0x0001ttpr8hsgaw3b"},{"post_id":"cmbgd7y8a0000ogpr0xfn8717","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmbgd7y8h0001ogprgew329f8"},{"post_id":"cmbjgndec00003fpr53lzbelx","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmbjgndee00013fpralzj46ab"},{"post_id":"cmbjjhnhw0000rvpr4ohqfcc2","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmbjjhnhz0001rvpr0b3o7kjy"},{"post_id":"cmbomsf5400005rprhhgs6eb9","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmbomsf5600015rpr0naudjov"},{"post_id":"cmbrop9kl00004jprexaj4lnx","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmbrop9km00024jpr6zwy3woi"},{"post_id":"cmbrop9km00014jpr2gf1erdd","tag_id":"cmb0ffvuk00a86kpr6t1ncvxm","_id":"cmbrop9km00034jprb925hg8z"}],"Tag":[{"name":"vue3","_id":"cmb0ffvu400056kpr90ol20bs"},{"name":"vue","_id":"cmb0ffvu5000b6kprcw0q4s9h"},{"name":"面经","_id":"cmb0ffvu8001g6kpr8hjrhi7a"},{"name":"计算机网络","_id":"cmb0ffvu8001o6kprelseg2m7"},{"name":"url","_id":"cmb0ffvu9001w6kpr1ebr6rmo"},{"name":"实践问题","_id":"cmb0ffvuc003a6kpr4i5wdhjx"},{"name":"状态码","_id":"cmb0ffvud00466kprf62b35tu"},{"name":"浏览器","_id":"cmb0ffvue004c6kpr7txchsl7"},{"name":"DNS","_id":"cmb0ffvue004s6kpr98mk3ood"},{"name":"CDN","_id":"cmb0ffvuf005a6kprdlfq82av"},{"name":"TCP","_id":"cmb0ffvuf005i6kpr7t2a4dft"},{"name":"web3","_id":"cmb0ffvug005y6kpr6jyqd5sb"},{"name":"密码学","_id":"cmb0ffvuh006f6kprcomo9s58"},{"name":"数据结构","_id":"cmb0ffvuh006s6kpra6bq3l0c"},{"name":"共识协议","_id":"cmb0ffvuh00716kpr77yoge6s"},{"name":"BTC","_id":"cmb0ffvuh007b6kpr8e004ip2"},{"name":"ETH","_id":"cmb0ffvui008g6kprgbq054q8"},{"name":"POS","_id":"cmb0ffvuj00996kpra6rjh8o8"},{"name":"智能合约","_id":"cmb0ffvuj009f6kpr5fkf99y0"},{"name":"React","_id":"cmb0ffvuk00a16kprcx7t8dg5"},{"name":"Rust","_id":"cmb0ffvuk00a86kpr6t1ncvxm"},{"name":"JavaScript","_id":"cmb0ffvuk00ao6kprcrir0v4y"}]}}