---
title: 北大区块链-共识协议
date: 2025-01-02 21:59:43
tags:
    - web3
    - 共识协议
categories:
    - Web3
      - 北大肖臻-区块链技术与应用
---

## 区块链技术与应用-共识协议

### 一、Double spending attack（双花攻击）

双花攻击指同一笔资金被重复支付的情况，也是数字货币面临的主要挑战

中心化解决方案：数字货币上添加唯一编号，并由央行维护一个数据结构，展示每个编号的货币由谁持有；如果付费方的货币在表中对应的持有人与此人不符，则证明该货币已支付给其他人

去中心化的解决方案：比特币

关注：货币的发行（挖矿）、交易的有效性验证（防范双花攻击）

### 二、交易的有效性验证

通过一个由所有用户共同维护的数据结构——区块链 来实现

### 三、区块链简易结构

Note：以下为简易版的区块链，每个区块都只有一个交易，实际上每个区块的交易记录都构成一个 Merkle tree

![图1](../images/33/1.png)

存在两种哈希指针：将区块串联成链表的指针，和指向前面某个交易的指针（为了说明币的来源，避免凭空捏造和重复交易）

1、用户A 具有发行货币的权利（铸币权），并发行了10个比特币（coin  base transaction，铸币交易）
2、用户A 分别给 用户B、用户C 5个比特币
3、用户B 分别给 用户C 2个比特币、用户D 3个比特币
4、用户C 转给 用户E 7个比特币
5、假设用户B 继续给 用户F 5个比特币，通过区块的回溯，校验出其已经在先前的交易中支付过了，所以交易不合法（避免双花攻击）

在 用户A 向 用户B 的交易中，需要记录 「输入」A的公钥、A的签名 和 「输出」B的地址（通过B的公钥取哈希等操作得到，可类比为银行卡账号）
A 需要 B的公钥 知道向哪里转账，所有节点都 需要 A的公钥 来验签

##### BitCoin Scripts

交易中的A的公钥（该交易的输入脚本），需要与 币的来源的A的公钥的哈希（前一交易的输出脚本） 相符（两脚本拼在一起能顺利执行）；否则说明币的来源有问题，A被冒名顶替了

### 四、区块结构

#### 1、Block header

包含区块的宏信息，比如：version（协议版本）、hash of privious block header（前一区块头的哈希）、merkle root hash（Merkle树 根哈希），还有和挖矿相关的 target（挖矿的难度目标域值）、nonce（随机数）

Note：
（1）hash of privious block header 取的只是前一区块头的哈希，不包含块体
（2）Merkle树 根哈希 保证了块体中的交易列表不会被篡改
（3）target 满足 H(block header)≤target，块头中存的是该目标域值的编码 nBits

#### 2、Block body
